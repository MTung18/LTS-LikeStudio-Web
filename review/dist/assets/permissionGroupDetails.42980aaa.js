import{d as pe,s as ve,l as he,ad as be,af as Ge,m as Ie,dW as De,dX as Se,dY as ye,k as ge,dU as Te,bA as Ve,cr as Le,dZ as Ae,Q as Fe,j as c,b as oe,e as xe,a1 as z,b2 as Ne,r as l,aM as we,o as u,f as m,w as s,a as n,ai as j,c as q,I as y,g as e,u as i,ak as ke,F as Ce,z as Ue,a2 as S,D as I,y as $e,at as Ee,W as Me,aa as Be,bx as Oe,d_ as ze,aE as qe,ci as Re,aH as le,bp as We,aj as _e,a3 as je,ax as He,ay as Qe,_ as Ye}from"./index.611fe570.js";import{u as de,a as Xe}from"./permissionGroupStore.a1288023.js";import{S as Ze}from"./grid.module.3b00878a.js";import{B as Je}from"./BryntumGrid.2c4be387.js";import{_ as Ke}from"./permissionItemEditor.vue_vue_type_script_setup_true_lang.df02ab22.js";import{u as me}from"./userStore.52ce8b56.js";import{_ as Pe}from"./emptyGridLayout.vue_vue_type_script_setup_true_lang.16e4a64a.js";import{s as H}from"./SorterFunctions.d9cfdebe.js";import{f as es}from"./filterStoreDataBySearchText.3eea2082.js";import{d as ss}from"./debounce.cf77a06e.js";import"./index.0faf2598.js";import"./isObject.c4ad145e.js";const ts={class:"me-3 d-flex align-items-center"},as={class:"h5 ps-2 my-auto fw-bold",title:"Moving users to this permission group will remove them from their current permission group."},os={class:"d-flex align-items-center float-end p-2"},ls={key:0,class:"d-flex flex-column h-100"},ns={class:"p-2 border-bottom"},rs=pe({__name:"usersPanel",props:{showUsersPanel:{type:Boolean},currentPermissionGroupId:null},emits:["loadData","update:showUsersPanel"],setup($,{emit:Q}){const D=$,{fetchUsersNotPartOfPermissionGroup:Y}=me(),{usersNotPartOfPermissionGroup:X}=ve(me()),{moveUsersToPermissionGroup:Z}=de();he.add(be,Ge,Ie,De,Se,ye,ge,Te,Ve,Le,Ae);const{notifyError:V,notifySuccess:f}=Fe(),g=c(!1),x=c([{text:"Available",value:"available"},{text:"Selected",value:"selected"}]),w=c("available"),U=c(""),E=c(""),k=c(!1),J=oe(()=>{const a=w.value==="available"?ne.value:h.value,t=U.value.toLowerCase();return t?a.filter(d=>d.name.toLocaleLowerCase().includes(t)):a}),v=c([]),P=c(!1),b=c("Failed to process your request"),h=oe(()=>v.value.filter(a=>a.selected===!0)),ne=oe(()=>v.value.filter(a=>a.selected!==!0)),R=oe(()=>h.value.length);xe(async()=>{L()}),z(()=>D.showUsersPanel,async()=>{g.value=D.showUsersPanel}),z(g,()=>{Q("update:showUsersPanel",g.value)}),z(()=>D.currentPermissionGroupId,async()=>{L()}),z(R,async(a,t)=>{a===0?x.value[1].text="Selected":x.value[1].text="Selected ("+a+")"});const re=Ne.debounce(()=>{U.value=E.value}),L=async a=>{if(k.value=!1,D.currentPermissionGroupId!==0){try{let t;a?t=X.value.filter(d=>!a.users.find(F=>F.employeeId===d.employeeId)):(await Y(D.currentPermissionGroupId),t=X.value),v.value=t.sort((d,F)=>H(d.lastFirstName,F.lastFirstName)).map(d=>({...d,selected:!1}))}catch(t){P.value=!0,t.statusCode==403?b.value="You do not have access to this functionality":b.value="Failed to process your request"}w.value="available"}k.value=!0},K=()=>{E.value="",U.value=""},ie=a=>{w.value==="available"?ee(a):r(a),K()},ee=a=>{v.value[o(a,v.value)].selected=!0},r=a=>{v.value[o(a,v.value)].selected=!1},o=(a,t)=>t.indexOf(v.value.find(d=>d.employeeId===a)),A=async()=>{k.value=!1;let a=v.value.filter(t=>t.selected===!0).map(t=>t.employeeId);try{const t=await Z(a,D.currentPermissionGroupId);f("User have been moved to this permission group."),Q("loadData",t),L(t)}catch{V("Failed to process your request.")}k.value=!0,g.value=!1};function G(){g.value=!1,v.value.filter(a=>a.selected===!0).forEach(a=>a.selected=!1),w.value="available"}return(a,t)=>{const d=l("font-awesome-icon"),F=l("fs-link"),C=l("fs-button"),se=l("fs-overlay"),N=l("fs-form-radio-group"),M=l("fs-form-group"),te=l("fs-form-input"),B=l("fs-col"),O=l("fs-row"),W=l("fs-container"),ue=l("fs-sidebar"),ce=we("fs-tooltip");return u(),m(ue,{"sidebar-class":"fsi-sidebar help-center","body-class":"help-center__body",right:"","no-close-on-esc":"","no-close-on-backdrop":"","bg-variant":"white",width:"425px",shadow:"sm","header-class":"border-bottom","footer-class":"border-top","aria-label":"help center","no-header-close":"",modelValue:g.value,"onUpdate:modelValue":t[4]||(t[4]=_=>g.value=_)},{title:s(({hide:_})=>[n("div",ts,[j((u(),q("div",as,[y(" Move Users To This Permission Group "),e(d,{icon:["fal","info-circle"],size:"sm",id:"move-user-info"})])),[[ce,void 0,void 0,{hover:!0,leftbottom:!0}]]),e(F,{class:"ms-auto text-secondary",tag:"a",onClick:t[0]||(t[0]=ae=>G())},{default:s(()=>[e(d,{icon:["fal","times"],size:"sm"})]),_:1})])]),footer:s(({hide:_})=>[n("div",os,[e(C,{onClick:t[1]||(t[1]=ae=>G())},{default:s(()=>[y("Cancel")]),_:1}),e(C,{variant:"primary",onClick:A,disabled:i(R)===0},{default:s(()=>[y("Move Users")]),_:1},8,["disabled"])])]),default:s(()=>[e(se,{show:!k.value,"spinner-variant":"primary",class:"fsi-pg__overlay","no-wrap":""},null,8,["show"]),k.value?(u(),q("div",ls,[e(M,{class:"border-bottom m-0 px-1"},{default:s(()=>[e(N,{class:"d-flex p-2",id:"btn-radios-users",modelValue:w.value,"onUpdate:modelValue":t[2]||(t[2]=_=>w.value=_),options:x.value,"button-variant":"outline-cyan",name:"radio-btn-outline",buttons:""},null,8,["modelValue","options"])]),_:1}),n("div",ns,[e(M,{class:"fs-input__form-group fs-input__form-group--search"},{default:s(()=>[e(te,{type:"text",class:"fs-input__input mb-0",modelValue:E.value,"onUpdate:modelValue":t[3]||(t[3]=_=>E.value=_),onInput:i(re),placeholder:"Search Users..."},null,8,["modelValue","onInput"]),e(C,{variant:"link",class:"fs-input__button fs-input__button--right",disabled:U.value==="",onClick:K},{default:s(()=>[e(ke,{name:"iconSwitch","enter-active-class":"animate__animated animate__fadeInDown animate__faster","leave-active-class":"animate__animated animate__fadeOutDown animate__faster"},{default:s(()=>[U.value===""?(u(),m(d,{icon:["fal","search"],class:"fs-input__button-icon fs-input__button-icon--right",key:"search"})):(u(),m(d,{icon:["fal","times"],class:"fs-input__button-icon fs-input__button-icon--right",key:"times"}))]),_:1})]),_:1},8,["disabled"])]),_:1})]),e(W,{class:"flex-grow-1"},{default:s(()=>[(u(!0),q(Ce,null,Ue(i(J),_=>(u(),m(O,{"align-v":"center",key:_.employeeId,class:"py-1 border-bottom position-relative"},{default:s(()=>[e(B,{cols:"auto",class:"d-flex justify-content-center"},{default:s(()=>[e(d,{icon:["fal","user"],class:"h3 mt-1 text-primary"})]),_:1}),e(B,{cols:"auto"},{default:s(()=>[e(O,{class:"fw-bold"},{default:s(()=>[y(I(_.name),1)]),_:2},1024),e(O,null,{default:s(()=>[y(I(_.permissionGroup),1)]),_:2},1024)]),_:2},1024),e(B,{cols:"auto",class:"ms-auto"},{default:s(()=>[e(C,{variant:"link",onClick:ae=>ie(_.employeeId)},{default:s(()=>[w.value==="available"?(u(),m(d,{key:0,icon:["fal","plus-circle"],class:"fs-input__button fs-input__button--right",size:"lg"})):(u(),m(d,{key:1,icon:["fal","minus-circle"],class:"fs-input__button-icon fs-input__button-icon--right text-charming-coral",size:"lg"}))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),i(R)===0&&w.value==="selected"&&P.value===!1?(u(),m(Pe,{key:0,emptyMessage:"There are no users selected to move to this permission group.",icon:"users"})):S("",!0)]),_:1})])):S("",!0)]),_:1},8,["modelValue"])}}}),T=$=>(He("data-v-6fe98f96"),$=$(),Qe(),$),is={class:"hq-pg d-flex flex-column"},us={class:"d-flex flex-wrap align-items-center"},cs={class:"hq-pg__title"},ds={id:"edit-permission-group",class:"ms-auto me-2"},fs=T(()=>n("span",{class:"d-none d-lg-inline"},"Edit",-1)),_s={id:"move-users",class:"ms-auto"},ms=T(()=>n("span",{class:"ms-2"},"Details",-1)),ps=T(()=>n("strong",null,"Name",-1)),vs=T(()=>n("strong",null,"Description",-1)),hs=T(()=>n("span",{class:"ms-2"},"User Count By Status",-1)),bs=T(()=>n("div",{class:"text-center"},[n("strong",null,"Total")],-1)),ys=T(()=>n("div",{class:"text-center"},[n("strong",null,"Active")],-1)),gs=T(()=>n("div",{class:"text-center"},[n("strong",null,"Inactive")],-1)),xs={class:"h-100 list"},ws={class:"list__table m-3 border rounded"},ks={class:"h-100 list"},Cs={key:0,class:"list__table overflow-auto"},Us=pe({__name:"permissionGroupDetails",setup($){const{fetchPermissionGroupLookup:Q,fetchPermissionGroupDetails:D}=de(),{permissionGroupLookup:Y,permissionGroupDetails:X}=ve(de()),Z=$e(),V=Ee(),f=c(new Xe),g=c(!1),x=c(!1),w=Me("$providePermissions"),U=c(new Ze);let E={name:"userAndPermissions"},k=c(0),J=c(0),v=c(0),P=c(!1),b=c(0),h=c("");xe(async()=>{g.value=!1,x.value=!0,await Q(),Y.value.sort((r,o)=>H(r.name,o.name)),await L(),V.hash.toLocaleLowerCase()==="#users"?b.value=0:V.hash.toLocaleLowerCase()==="#pg"&&(b.value=1),x.value=!1,g.value=!0}),he.add(Be,Oe,ze,qe,ye,ge,be,Re),z(()=>V.params.permissionGroupId,async(r,o)=>{r!==void 0&&r!==o&&await L()},{flush:"pre",immediate:!1,deep:!0});const ne=async function(r){if(r===f.value.id)return;let o={name:"permissionGroupDetails",params:{permissionGroupId:r}};b.value===1&&(o.hash="#pg"),Z.push(o)},R=function(){Z.push({name:"permissionGroupForm",query:{id:f.value.id}})},re=c({autoHeight:!0,emptyText:"",columnLines:!1,columns:[{flex:1,id:"name",field:"name",text:"Name",editor:!1,htmlEncode:!1,cellCls:"ps-3",cls:"ps-3",sortable:(r,o)=>H(r.lastFirstName,o.lastFirstName)},{flex:1,id:"emailAddress",field:"emailAddress",text:"Email",sortable:(r,o)=>H(r.emailAddress,o.emailAddress)},{flex:1,text:"Status",id:"status",field:"status",htmlEncode:!1,groupable:!1,sortable:(r,o)=>H(r.status,o.status),renderer:({record:r})=>`<span class="rounded-pill badge status-${r.status.toLowerCase()}"> ${r.status} </span>`}],sortFeature:{prioritizeColumns:!0}});async function L(r){x.value=!0,r?f.value=r:(await D(Number(V.params.permissionGroupId)),f.value=X.value);let o=f.value.users;U.value.data=o,U.value.sort({field:"name",ascending:!0}),k.value=o.length,J.value=o.filter(A=>A.isActive).length,v.value=o.filter(A=>!A.isActive).length,b.value=0,h.value="",x.value=!1}const K=ss(()=>{ee()},500,{maxWait:1e3});z(h,K);function ie(){h.value="",ee()}function ee(){es(f.value.users,["status"],h.value,U.value)}return(r,o)=>{const A=l("fs-overlay"),G=l("font-awesome-icon"),a=l("fs-link"),t=l("fs-col"),d=l("fs-dropdown-item"),F=l("fs-dropdown"),C=l("fs-button"),se=l("fs-tooltip"),N=l("fs-row"),M=l("fs-container"),te=l("fs-card-header"),B=l("fs-card-body"),O=l("fs-card"),W=l("fs-aspect"),ue=l("fs-form-input"),ce=l("fs-form-group"),_=l("fs-tab"),ae=l("fs-tabs"),fe=we("fs-tooltip");return u(),q("div",is,[e(A,{show:x.value,"spinner-variant":"primary",class:"fsi-pg__overlay","no-wrap":""},null,8,["show"]),e(M,{fluid:"",class:"hq-pg__header contain border-bottom"},{default:s(()=>[e(N,{"align-v":"center",class:"py-3"},{default:s(()=>[e(t,{cols:"auto"},{default:s(()=>[e(a,{variant:"link",to:i(E)},{default:s(()=>[e(G,{icon:["fal","arrow-circle-left"],size:"2x"})]),_:1},8,["to"])]),_:1}),e(t,{col:"",lg:"auto"},{default:s(()=>[n("section",us,[e(F,{id:"dropdown-offset",variant:"outline-secondary","toggle-class":"text-decoration-none",offset:"25"},{"button-content":s(()=>[n("h2",cs,I(f.value.name),1)]),default:s(()=>[(u(!0),q(Ce,null,Ue(i(Y),p=>(u(),m(d,{key:p.id,onClick:Ps=>ne(p.id)},{default:s(()=>[p.name==f.value.name?(u(),m(G,{key:0,size:"lg",icon:["fas","check"],class:"text-primary"})):S("",!0),y(" "+I(p.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})])]),_:1}),x.value?S("",!0):(u(),m(t,{key:0,cols:"auto",class:"ms-auto d-flex"},{default:s(()=>[n("div",ds,[e(C,{variant:"outline-primary",onClick:R,disabled:f.value.isDefaultPermissionGroup},{default:s(()=>[e(G,{icon:["fal","edit"]}),fs]),_:1},8,["disabled"]),f.value.isDefaultPermissionGroup?j((u(),m(se,{key:0,target:"edit-permission-group"},{default:s(()=>[y(" The Admin permission group is not editable. ")]),_:1})),[[fe,void 0,void 0,{hover:!0,bottom:!0}]]):S("",!0)]),n("div",_s,[e(C,{variant:"primary",onClick:o[0]||(o[0]=p=>le(P)?P.value=!0:P=!0),disabled:f.value.isAdminGroup?!i(w).WHQ_247_3115:!1},{default:s(()=>[y(" Add Users ")]),_:1},8,["disabled"]),f.value.isAdminGroup&&!i(w).WHQ_247_3115?j((u(),m(se,{key:0,target:"move-users"},{default:s(()=>[y(" You do not have permission to add users to this group. ")]),_:1})),[[fe,void 0,void 0,{hover:!0,bottom:!0}]]):S("",!0)])]),_:1}))]),_:1})]),_:1}),e(M,{fluid:"",class:"contain"},{default:s(()=>[e(N,{class:"mt-4"},{default:s(()=>[e(t,{xl:"6",class:"mb-3"},{default:s(()=>[e(O,{class:"dashboard-card dashboard-card--no-min-height","no-body":""},{default:s(()=>[e(te,{class:"dashboard-card__header"},{default:s(()=>[e(G,{icon:["fal","info-circle"],class:"fa-2x details-card__info-circle-icon"}),ms]),_:1}),e(B,{class:"mb-3 mt-2"},{default:s(()=>[e(N,{class:"mb-2"},{default:s(()=>[e(t,{md:"2"},{default:s(()=>[ps]),_:1}),e(t,{xl:"6"},{default:s(()=>[n("span",null,I(f.value.name),1)]),_:1})]),_:1}),e(N,null,{default:s(()=>[e(t,{md:"2"},{default:s(()=>[vs]),_:1}),e(t,{xl:"10"},{default:s(()=>[n("span",null,I(f.value.description),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(t,{xl:"6",class:"mb-3"},{default:s(()=>[e(O,{class:"dashboard-card dashboard-card--no-min-height","no-body":""},{default:s(()=>[e(te,{class:"dashboard-card__header"},{default:s(()=>[e(G,{icon:["fal","users"],class:"fa-2x user-count-card__users-icon"}),hs]),_:1}),e(B,{class:"mb-3 mt-2"},{default:s(()=>[e(N,null,{default:s(()=>[e(t,null,{default:s(()=>[bs,e(W,{aspect:"1:1",class:"user-count-card__category-circle"},{default:s(()=>[e(C,{pill:"",variant:"outline-cat-open",class:"h-100 w-100"},{default:s(()=>[y(I(i(k)),1)]),_:1})]),_:1})]),_:1}),e(t,null,{default:s(()=>[ys,e(W,{aspect:"1:1",class:"user-count-card__category-circle"},{default:s(()=>[e(C,{pill:"",variant:"outline-cat-all",class:"h-100 w-100"},{default:s(()=>[y(I(i(J)),1)]),_:1})]),_:1})]),_:1}),e(t,null,{default:s(()=>[gs,e(W,{aspect:"1:1",class:"user-count-card__category-circle"},{default:s(()=>[e(C,{pill:"",variant:"outline-grey--400",class:"h-100 w-100"},{default:s(()=>[y(I(i(v)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(M,{fluid:"",class:"p-0 flex-fill d-flex flex-column overflow-hidden"},{default:s(()=>[e(ae,{pills:"",modelValue:i(b),"onUpdate:modelValue":o[2]||(o[2]=p=>le(b)?b.value=p:b=p),class:"filter-tabs d-flex flex-column flex-fill overflow-hidden","content-class":"d-flex flex-column flex-fill overflow-hidden","nav-class":"contain"},We({default:s(()=>[e(_,{title:"Users",class:"position-relative flex-fill overflow-hidden"},{default:s(()=>[n("div",xs,[n("div",ws,[j(e(i(Je),je({ref:"grid",readOnly:!0},re.value,{store:U.value}),null,16,["store"]),[[_e,i(k)>0]]),i(k)===0?(u(),m(Pe,{key:0,emptyMessage:"There are no users for this permission group.",icon:"users"})):S("",!0)])])]),_:1}),e(_,{title:"Permissions",class:"position-relative flex-fill overflow-hidden"},{default:s(()=>[n("div",ks,[g.value?j((u(),q("div",Cs,[e(Ke,{currentPermissionGroup:f.value,isReadOnly:!0},null,8,["currentPermissionGroup"])],512)),[[_e,!x.value]]):S("",!0)])]),_:1})]),_:2},[i(b)==0?{name:"tabs-end",fn:s(()=>[e(ce,{class:"input__search-users fs-input__form-group fs-input__form-group--search ms-auto py-1"},{default:s(()=>[e(ue,{type:"text",class:"fs-input__input",modelValue:i(h),"onUpdate:modelValue":o[1]||(o[1]=p=>le(h)?h.value=p:h=p),modelModifiers:{trim:!0},showClear:!0,placeholder:"Search Users..."},null,8,["modelValue"]),e(C,{variant:"link",class:"fs-input__button fs-input__button--right",disabled:i(h)==="",onClick:ie,style:{top:"5px"}},{default:s(()=>[e(ke,{name:"iconSwitch","enter-active-class":"animate__animated animate__fadeInDown animate__faster","leave-active-class":"animate__animated animate__fadeOutDown animate__faster"},{default:s(()=>[i(h)===""?(u(),m(G,{icon:["fal","search"],class:"fs-input__button-icon fs-input__button-icon--right",key:"search"})):(u(),m(G,{icon:["fal","times"],class:"fs-input__button-icon fs-input__button-icon--right",key:"times"}))]),_:1})]),_:1},8,["disabled"])]),_:1})]),key:"0"}:void 0]),1032,["modelValue"])]),_:1}),e(rs,{showUsersPanel:i(P),"onUpdate:showUsersPanel":o[3]||(o[3]=p=>le(P)?P.value=p:P=p),currentPermissionGroupId:Number(i(V).params.permissionGroupId),onLoadData:L},null,8,["showUsersPanel","currentPermissionGroupId"])])}}});const Ms=Ye(Us,[["__scopeId","data-v-6fe98f96"]]);export{Ms as default};
