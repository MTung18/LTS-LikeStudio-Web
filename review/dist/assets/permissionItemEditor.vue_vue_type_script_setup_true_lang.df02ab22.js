import{d as Y,l as J,d$ as ae,e0 as le,cf as ge,e1 as ve,b as C,r as O,o as f,c as k,u as l,a as c,D as de,a2 as $,A as L,g as S,ai as K,aj as X,j as G,f as j,I as U,F as Q,z as q,R as ye,U as ne,s as me,aU as Se,dY as Pe,Q as we,e as be,dc as Ce,a1 as W,b2 as te,w as T,ak as ke}from"./index.611fe570.js";import{a as ce}from"./index.0faf2598.js";var I=(e=>(e[e.Indeterminate=0]="Indeterminate",e[e.NoAccess=1]="NoAccess",e[e.Access=2]="Access",e[e["No Access"]=1]="No Access",e))(I||{});class ue{permissionGroupPermissionItemId;permissionGroupId;permissionItemId;permissionSettingId;constructor(o){o&&Object.assign(this,o)}}var V=(e=>(e[e.Access=0]="Access",e[e.Limited=1]="Limited",e))(V||{});const pe="main-bus";var Z=(e=>(e.Validate="validate",e.ScrollToSection="scrollToSection",e.FocusSection="focusSection",e.ActivateHeader="activateHeader",e.Save="save",e.ResetSaveButton="resetSaveButton",e.ShowCloseSaveModal="showCloseSaveModal",e.CloseSaveModalOpen="closeSaveModalOpen",e.ActivateSideNavLink="activateSideNavLink",e.ResetDailyLogsDate="resetDailyLogsDate",e.ReachedTop="reachedTop",e.CloseDocument="closeDocument",e.CancelClicked="cancelClicked",e.SaveFailed="saveFailed",e.ResetFroalaFullscreen="resetFroalaFullscreen",e.CancelEdits="cancelEdits",e.DeletedItem="deletedItem",e.LinkItem="linkItem",e.ShowSubmenu="showSubmenu",e.UpdateFailed="updateFailed",e.SetDocumentInfo="setDocumentInfo",e.CheckForValidDate="checkForValidDate",e.SetParentDateMessages="setParentDateMessages",e.UpdateOptionList="updateOptionList",e.GetWeather="getWeather",e.MultiSelectOpen="multiSelectOpen",e.MultiSelectClose="multiSelectClose",e.PermissionSettingIdChange="permissionSettingIdChange",e))(Z||{});const Ae={key:0},se=Y({__name:"permissionSettingInput",props:{permissionSettingType:null,depth:null,node:null,isReadOnly:null},setup(e){const o=e;J.add(ae,le,ge,ve);const v=ce(pe),d=C(()=>{let p="check",h="text--pm-blue";return o.node.currentPermissionSettingId===u.value.Indeterminate&&(p="minus",h="text-yellow"),{type:["fal",p],style:h}}),P=C(()=>o.node.permissionItem.isLabel),a=C(()=>I[o.permissionSettingType]),w=C(()=>o.permissionSettingType),R=C(()=>w.value===I.NoAccess?I.Access:I.NoAccess),u=C(()=>I);function y(p){v.emit(Z.PermissionSettingIdChange,{permissionItemTreeNode:o.node,newPermissionSettingId:p})}return(p,h)=>{const _=O("font-awesome-icon"),M=O("fs-form-checkbox");return f(),k("div",null,[e.node.depth===0||l(P)?(f(),k("div",Ae,[c("strong",null,de(l(a)),1)])):$("",!0),(e.node.currentPermissionSettingId===l(w)||e.node.currentPermissionSettingId===l(u).Indeterminate)&&e.isReadOnly&&!l(P)?(f(),k("div",{key:1,class:L(e.node.depth>0?"pt-3":null)},[S(_,{size:"2x",class:L(l(d).style),icon:l(d).type},null,8,["class","icon"])],2)):$("",!0),K(S(M,{modelValue:e.node.currentPermissionSettingId,"onUpdate:modelValue":h[0]||(h[0]=F=>e.node.currentPermissionSettingId=F),class:L([e.node.depth>0?"pt-3":null,"px-0 mx-0 permission-check"]),value:l(w),uncheckedValue:l(R),disabled:e.node.currentPermissionSettingId===l(w)&&e.node.currentPermissionSettingId!==l(u).Indeterminate,indeterminate:e.node.currentPermissionSettingId===l(u).Indeterminate,inline:!0,onChange:h[1]||(h[1]=F=>y(l(w)))},null,8,["modelValue","class","value","uncheckedValue","disabled","indeterminate"]),[[X,!l(P)&&!e.isReadOnly]])])}}});const _e=["role"],Oe={class:"w-50 d-inline-flex px-0"},Le={class:"border-start w-50 text-center"},re=Y({__name:"permissionItemEditorItem",props:{node:null,parentIsLabel:null,isReadOnly:null},setup(e){const o=e;J.add(ae,le);const v=G(!1),d=C(()=>I),P=C(()=>o.node.children&&o.node.children.length>0),a=C(()=>{let u="row border ",y="bg-grey--000",p="bg-grey--100";return o.node.permissionItem.isLabel?u+p:o.node.depth===0?u+y:u}),w=C(()=>{let u="w-50 ";return(o.parentIsLabel?o.node.depth-1:o.node.depth)>1?u+"ps-4":u+"fw-bold"});function R(){v.value=!v.value}return(u,y)=>{const p=O("font-awesome-icon"),h=O("permission-item-editor-item",!0);return f(),k("div",null,[c("div",{class:L(l(a))},[c("div",{class:L(l(w))},[c("div",{class:L(e.node.permissionItem.isLabel?"ps-3 text-break":"p-3 text-break"),role:l(P)&&!e.node.permissionItem.isLabel?"button":null,onClick:y[0]||(y[0]=_=>R())},[l(P)&&!e.node.permissionItem.isLabel?(f(),j(p,{key:0,class:"text-primary",icon:["fal",v.value?"chevron-up":"chevron-down"]},null,8,["icon"])):$("",!0),U(" "+de(e.node.permissionItem.permissionItemName),1)],10,_e)],2),c("div",Oe,[c("div",Le,[S(se,{permissionSettingType:l(d).Access,node:e.node,isReadOnly:e.isReadOnly},null,8,["permissionSettingType","node","isReadOnly"])]),c("div",{class:L(e.node.depth>0&&!e.node.permissionItem.isLabel?"border-start w-50 text-center bg-grey--0000":"border-start w-50 text-center")},[S(se,{permissionSettingType:l(d).NoAccess,node:e.node,isReadOnly:e.isReadOnly},null,8,["permissionSettingType","node","isReadOnly"])],2)])],2),K(c("div",null,[(f(!0),k(Q,null,q(e.node.children,_=>(f(),j(h,{key:_.permissionItem.permissionItemId,node:_,parentIsLabel:e.node.permissionItem.isLabel,isReadOnly:e.isReadOnly},null,8,["node","parentIsLabel","isReadOnly"]))),128))],512),[[X,v.value||e.node.permissionItem.isLabel]])])}}}),oe=ye("permissionItemEditor",()=>{const{fetchPermissionItems:e}=ne(),{permissionItems:o}=me(ne()),v=G([]),d=G([]),P=G([]),a=Se({initial:d,current:P}),w=C(()=>a.initial.length===a.current.length?a.current.filter((s,g)=>a.initial[g].permissionSettingId!==s.permissionSettingId).length:Math.abs(a.current.length-a.initial.length));async function R(s){return a.current.find(g=>g.permissionItemId===s)}async function u(){await e(),v.value=o.value}async function y(s){let g=[];s.forEach(x=>g.push(new ue(x))),a.initial=g}async function p(s){a.current=s}async function h(s){let g=a.current.findIndex(x=>x.permissionItemId===s.permissionItemId);g>-1?Object.assign(a.current[g],s):console.error(`Permission item with id ${s.permissionItemId} wasn't found!`)}async function _(){await M(),await F(),await A()}async function M(){v.value=[]}async function F(){a.current=[]}async function A(){a.initial=[]}return{permissionItems:v,permissionGroupPermissionItems:a,updatedItemsCount:w,current:P,getPermissionGroupPermissionItem:R,setPermissionItems:u,setInitialPermissionItems:y,setCurrentPermissionItems:p,updatePermissionItems:h,resetAll:_}}),Ge={key:0},Re={class:"p-3 w-100 d-inline-block bg-grey--000"},Fe={class:"float-start"},xe=c("strong",null,"Full Access for All Features",-1),Te={class:"float-end"},De={class:"p-3 w-100 d-inline-block bg-grey--000"},Ve={class:"float-start"},Me=c("strong",null,"Limited Access",-1),Ue={class:"float-end"},$e={key:0,class:"ps-5 pe-5"},je={key:1,class:"contain"},Ne=Y({__name:"permissionItemEditor",props:{isReadOnly:null,currentPermissionGroup:null,copiedFromPermissionGroup:null,permissionsUpdated:{type:Boolean}},emits:["update:permissionsUpdated"],setup(e,{expose:o,emit:v}){const d=e,{setPermissionItems:P,setInitialPermissionItems:a,setCurrentPermissionItems:w,updatePermissionItems:R,resetAll:u,getPermissionGroupPermissionItem:y}=oe(),{permissionItems:p,updatedItemsCount:h,current:_}=me(oe());J.add(Pe),o({updatedPermissionItems:_});const{notifyError:M}=we(),F=ce(pe),A=G(V.Access),s=G([]),g=G(!1),x=G([]);be(async()=>{F.on(E),await z()}),Ce(()=>{F.off(E)}),W(()=>d.copiedFromPermissionGroup,()=>{d.copiedFromPermissionGroup?.id!==0&&z()},{deep:!0,immediate:!0}),W(()=>d.currentPermissionGroup.id,()=>{z()},{deep:!0,immediate:!1}),W(h,()=>{v("update:permissionsUpdated",h.value>0)});function E(i,n){switch(i){case Z.PermissionSettingIdChange:N(n);break}}async function z(){g.value=!0,await u(),await P(),!p.value||p.value.length===0?M("Failed to load permission items."):(await Ie(),await fe()),A.value=s.value.every(i=>i.currentPermissionSettingId===I.Access)?V.Access:V.Limited,g.value=!1}async function Ie(){let i=[],n=p.value.filter(t=>t.isChildmost);d.isReadOnly?i=d.currentPermissionGroup.permissionGroupPermissionItems:n.forEach(t=>{let m=new ue,r;d.copiedFromPermissionGroup&&(r=te.cloneDeep(d.copiedFromPermissionGroup.permissionGroupPermissionItems.find(D=>D.permissionItemId===t.permissionItemId))),d.currentPermissionGroup.id>0?(m=te.cloneDeep(d.currentPermissionGroup.permissionGroupPermissionItems.find(D=>D.permissionItemId===t.permissionItemId)),m?m.permissionSettingId=r?r.permissionSettingId:m.permissionSettingId:m={permissionItemId:t.permissionItemId,permissionGroupId:d.currentPermissionGroup.id,permissionGroupPermissionItemId:0,permissionSettingId:r?r.permissionSettingId:I.Access}):(m.permissionItemId=t.permissionItemId,m.permissionGroupId=0,m.permissionGroupPermissionItemId=0,m.permissionSettingId=r?r.permissionSettingId:I.Access),i.push(m)}),await a(i),await w(i)}function B(i){if(A.value=i,i===V.Access)for(const n of s.value)N({permissionItemTreeNode:n,newPermissionSettingId:I.Access});else if(i===V.Limited)for(const n of s.value)N({permissionItemTreeNode:n,newPermissionSettingId:I.NoAccess})}async function fe(){s.value=p.value.map(i=>({permissionItem:i,currentPermissionSettingId:null,parent:null,children:null,depth:null})),s.value.sort((i,n)=>i.permissionItem.menuOrdinal-n.permissionItem.menuOrdinal);for(let i=0;i<s.value.length;i+=1){let n=s.value[i],t=s.value.find(r=>r.permissionItem.permissionItemId===n.permissionItem.parent_PermissionItemId),m=s.value.filter(r=>r.permissionItem.parent_PermissionItemId===n.permissionItem.permissionItemId);if(n.parent=t,n.children=m,n.depth=t?t.depth+1:0,n.permissionItem.isChildmost){let r=await y(n.permissionItem.permissionItemId);n.currentPermissionSettingId=r?r.permissionSettingId:I.Access}t&&!n.parent.children.includes(n)&&n.parent.children.push(n)}he(),x.value=s.value.filter(i=>i.depth===0)}function he(){s.value.filter(n=>!n.permissionItem.isChildmost).sort((n,t)=>t.permissionItem.menuOrdinal-n.permissionItem.menuOrdinal).forEach(async n=>{let t=n.children.every(m=>m.currentPermissionSettingId===n.children[0].currentPermissionSettingId);n.currentPermissionSettingId=t?n.children[0].currentPermissionSettingId:I.Indeterminate})}async function H(i,n){if(!i.permissionItem.isChildmost)return;let t=await y(i.permissionItem.permissionItemId);t&&(t.permissionSettingId=n,await R(t))}async function N(i){!i.permissionItemTreeNode.permissionItem.isChildmost&&i.newPermissionSettingId===I.Indeterminate||(await H(i.permissionItemTreeNode,i.newPermissionSettingId),i.permissionItemTreeNode.children&&i.permissionItemTreeNode.children.length>0&&await ee(i.permissionItemTreeNode,i.newPermissionSettingId),i.permissionItemTreeNode.parent&&await ie(i.permissionItemTreeNode,i.newPermissionSettingId),!i.permissionItemTreeNode.parent&&(!i.permissionItemTreeNode.children||i.permissionItemTreeNode.children?.length===0)&&(i.permissionItemTreeNode.currentPermissionSettingId=i.newPermissionSettingId))}async function ee(i,n){i.children.forEach(async t=>{t.currentPermissionSettingId=n,await H(t,n),t.children&&t.children.length>0&&await ee(t,n)})}async function ie(i,n){if(!i.parent)return;i.parent.children.filter(r=>r.permissionItem.permissionItemId!==i.permissionItem.permissionItemId).every(r=>r.currentPermissionSettingId===n)?i.parent.currentPermissionSettingId=n:i.parent.currentPermissionSettingId=I.Indeterminate,await H(i.parent,i.parent.currentPermissionSettingId),i.parent&&await ie(i.parent,n)}return(i,n)=>{const t=O("fs-overlay"),m=O("fs-form-radio"),r=O("font-awesome-icon"),D=O("fs-popover");return f(),k("div",null,[S(t,{"spinner-variant":"primary",show:g.value,class:"fsi-pg__overlay","no-wrap":""},null,8,["show"]),e.isReadOnly?(f(),k("div",je,[(f(!0),k(Q,null,q(x.value,b=>(f(),j(re,{class:"mt-3 mb-3",key:b.permissionItem.permissionItemId,node:b,depth:0,isReadOnly:e.isReadOnly},null,8,["node","isReadOnly"]))),128))])):(f(),k("div",Ge,[c("div",null,[c("div",Re,[c("div",Fe,[S(m,{modelValue:A.value,"onUpdate:modelValue":n[0]||(n[0]=b=>A.value=b),value:0,onChange:n[1]||(n[1]=b=>B(0))},{default:T(()=>[xe]),_:1},8,["modelValue"])]),c("div",Te,[S(r,{id:"popover-target-owner-access",icon:["fal","info-circle"],class:"fa-lg"}),S(D,{target:"popover-target-owner-access",triggers:"hover",placement:"right",boundary:"viewport"},{title:T(()=>[U("Full Access For All Features")]),default:T(()=>[U(" Grants full access to all features within WorkforceHQ. ")]),_:1})])])]),c("div",{class:L(A.value===0?"mt-3 mb-5":"mt-3 mb-5 border")},[c("div",De,[c("div",Ve,[S(m,{modelValue:A.value,"onUpdate:modelValue":n[2]||(n[2]=b=>A.value=b),value:1,onChange:n[3]||(n[3]=b=>B(1))},{default:T(()=>[Me]),_:1},8,["modelValue"])]),c("div",Ue,[S(r,{id:"popover-target-limited-access",icon:["fal","info-circle"],class:"fa-lg"}),S(D,{target:"popover-target-limited-access",triggers:"hover",placement:"right",boundary:"viewport"},{title:T(()=>[U("Limited Access")]),default:T(()=>[U(" Access can be defined by feature within WorkforceHQ. ")]),_:1})])]),S(ke,{name:"fade-transition","enter-active-class":"animate__animated animate__fadeIn animate","leave-active-class":"animate__animated animate__fadeOut animate__faster animate"},{default:T(()=>[s.value.length>0?K((f(),k("div",$e,[(f(!0),k(Q,null,q(x.value,b=>(f(),j(re,{class:"mt-3 mb-3",key:b.permissionItem.permissionItemId,node:b,depth:0,isReadOnly:e.isReadOnly},null,8,["node","isReadOnly"]))),128))],512)),[[X,A.value===1]]):$("",!0)]),_:1})],2)]))])}}});export{Ne as _};
