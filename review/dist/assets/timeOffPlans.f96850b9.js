import{J as we,K as Se,L as ke,N as Ie,R as Ae,d as se,a0 as ce,j as n,l as le,bL as Oe,bM as Ce,bN as Fe,b as te,bO as de,at as ne,a1 as G,s as X,h as Ee,r as x,o as T,c as E,g as l,bp as De,u as S,w as d,a as i,f as ae,a2 as $e,C as ee,D as J,a3 as ue,ax as Be,ay as Le,_ as fe,af as Ve,by as Me,Q as Ne,aU as He,I as z,aY as oe,F as je,bc as qe,bf as Re,bg as Ge,i as re,e as Ue}from"./index.611fe570.js";import{S as pe,D as Ye,f as Ke}from"./grid.module.3b00878a.js";import{B as me}from"./BryntumGrid.2c4be387.js";import{B as ve}from"./bryntumSearchBar.3bdd630f.js";import{f as Q}from"./gridConfigDefaults.8c72c19b.js";import{f as ye}from"./filterStoreDataBySearchText.3eea2082.js";import{g as _e,a as ge}from"./statefulSortFeature.3df4a43a.js";import{e as Je,u as Z}from"./timeOffPlanStore.16eb3c13.js";import{d as We}from"./darkThemeModal.413e0de8.js";import{e as ze}from"./employeeHeader.c061ea79.js";import"./foundationCompanyCasConnectionStore.b3301598.js";import"./debounce.cf77a06e.js";import"./isObject.c4ad145e.js";class Xe extends ke{constructor(y){const u=Ie().ClientSide.WorkforceEmployeeManagement+"/api/v1";super(y,u)}async getRestTimeOff(y,u){let a;try{const p=await this.axiosInstance.get(`timeOffRequests/planTypeFigure/${y}`,{params:{accrualCodeFsNo:u}});if(p&&p.data&&p.status===200)a=p.data;else throw new Error("Failed to parse time-off plan list")}catch(p){console.error("An unexpected error occurred attempting to retrieve the time-off plan list.",p)}return a}}const Qe=new Xe([we,Se]),Ze=Ae("employeeAssignedPlan",()=>{async function k(u,a){return await Qe.getRestTimeOff(u,a)}async function y(u,a){return await Je.getAccrualUsages(u,a)}return{getRestTimeOff:k,getPlanTypeHistories:y}}),ie=k=>(Be("data-v-dd90d52c"),k=k(),Le(),k),et={class:"large-header",id:"assigned-time-off-plans"},tt={class:"flex-grow-1 ms-4 d-flex justify-content-end"},at={class:"w-100 py-3"},st={class:"d-flex justify-content-between py-3 gap-6 w-100"},lt={class:"block-item d-flex gap-2"},nt={class:"block-item__circle block-item__circle__blue"},it={class:"block-item d-flex flex-column justify-content-between"},ot=ie(()=>i("span",{class:"block-item__title"},"Current Balance",-1)),rt={key:0,class:"block-item__value"},ct={key:1,class:"block-item__value"},dt={class:"block-item d-flex gap-2"},ut={class:"block-item__circle block-item__circle__green"},ft={class:"block-item d-flex flex-column justify-content-between"},pt=ie(()=>i("span",{class:"block-item__title"},"Projected Balance",-1)),mt={key:0,class:"block-item__value"},vt={key:1,class:"block-item__value"},yt={class:"block-item d-flex gap-2"},_t={class:"block-item__circle block-item__circle__orange"},gt={class:"block-item d-flex flex-column justify-content-between"},ht=ie(()=>i("span",{class:"block-item__title"},"Scheduling",-1)),bt={key:0,class:"block-item__value"},Pt={key:1,class:"block-item__value"},xt={class:"list-table"},Tt=se({__name:"historyOfPlanType",setup(k){const{responsive:y}=ce(),u=n(0);le.add(Oe,Ce,Fe);const a="historyPlan",p={field:"planType",ascending:!0},O=n(null),C=te(()=>O.value?.instance.value.features),{setLoading:D}=de(),V=ne(),$=n({...Q.gridConfig,..._e(a),...ge(a,p),emptyText:"<div class='w-100 d-flex flex-column align-items-center'><div>No Plan Type has been selected</div><div class='sub-emptyText mt-3'>Please select a plan type to view leave history of that plan.</div></div>",columns:[{text:"Plan",field:"accrualId",flex:1},{text:"Transaction Date",field:"dateString",type:"date",flex:2},{text:"Hours Adjusted",field:"hours",flex:2},{text:"Comments",field:"comment",flex:2,hidden:!1,responsiveLevels:{small:{hidden:!0}}}]}),I=n(localStorage.getItem(`${a}SearchText`)??"");G(I,()=>{L()});const _=n(new pe({...Q.gridStoreConfig,sorters:[p],onFilter:()=>{I.value&&_.value.filters.count<N.value&&L(),N.value=_.value.filters.count},onChange:()=>{g.value.length>0?$.value.emptyText="":$.value.emptyText="<div class='w-100 d-flex flex-column align-items-center'><div>No Plan Type has been selected</div><div class='sub-emptyText mt-3'>Please select a plan type to view leave history of that plan.</div></div>"}})),b=n(null),m=n(new Array),g=n(null),{fetchListOfEmployeePlanType:R}=Z(),{employeePlanType:U}=X(Z()),{getPlanTypeHistories:e,getRestTimeOff:B}=Ze(),v=n(null);Ee(async()=>{await R(V.params.id),m.value=U.value}),G(b,h=>{h&&P(V.params.id,h.code)},{deep:!0});async function P(h,r){try{D(!0),g.value=await e(h,r),v.value=await B(h,r)}finally{_.value.data=g.value,D(!1)}}function M(){_.value.clearFilters(),C.value.filterBar.hideFilterBar()}const N=n(0),Y=["id"],H=n(new Array);function L(){ye(H.value,Y,I.value,_.value)}function F(){localStorage.setItem(`${a}State`,JSON.stringify(_.value.state)),localStorage.setItem(`${a}SearchText`,I.value)}function j(){_.value.clearFilters(),_.value.clearSorters(),localStorage.removeItem(`${a}State`),localStorage.removeItem(`${a}SearchText`)}return G(()=>y.breakpoint,()=>{y.breakpoint==="sm"&&$.value.columns.forEach(h=>{h.field==="comments"&&(h.hidden=!0)}),u.value++}),(h,r)=>{const q=x("fs-input"),c=x("fs-col"),t=x("fs-row");return T(),E("div",et,[l(ve,{title:"History of Plan Type","local-storage-key":a,"show-settings-button":!0,"show-search-button":!1,"show-filter-button":!0,onSaveSettings:r[2]||(r[2]=f=>F()),onClearSettings:r[3]||(r[3]=f=>j()),onHideFilterBar:r[4]||(r[4]=f=>M()),onShowFilterBar:r[5]||(r[5]=f=>S(C).filterBar.showFilterBar()),onSearchTextInput:r[6]||(r[6]=f=>I.value=f)},De({footer:d(()=>[l(t,null,{default:d(()=>[S(y).breakpoint!=="sm"?(T(),ae(c,{key:0,lg:"12",xl:"5"},{default:d(()=>[i("div",at,[l(q,{type:"fsMultiselectList",label:"Plan type",typeaheaddata:m.value,typeaheadkey:"name",modelValue:b.value,"onUpdate:modelValue":r[1]||(r[1]=f=>b.value=f),typeaheadvalueattribute:"id",name:"historyPlan",autocomplete:"donotfill"},null,8,["typeaheaddata","modelValue"])])]),_:1})):$e("",!0),l(c,{lg:"12",xl:"7",class:"overflow-auto",style:{"max-width":"100vw"}},{default:d(()=>[i("div",st,[i("div",lt,[i("div",nt,[l(S(ee),{class:"icon icon__white",icon:"fa-light fa-calendar-star"})]),i("div",it,[ot,v.value?(T(),E("span",rt,J(v.value?.currentBalance)+" hrs",1)):(T(),E("span",ct," --- hrs"))])]),i("div",dt,[i("div",ut,[l(S(ee),{class:"icon icon__green",icon:"fa-light fa-calendar-pen"})]),i("div",ft,[pt,v.value?(T(),E("span",mt,J(Number(v.value?.projectedBalance))+" hrs",1)):(T(),E("span",vt," --- hrs"))])]),i("div",yt,[i("div",_t,[l(S(ee),{class:"icon icon__orange",icon:"fa-light fa-calendar-xmark"})]),i("div",gt,[ht,v.value?(T(),E("span",bt,J(v.value?.schedulingBalance)+" hrs",1)):(T(),E("span",Pt," --- hrs"))])])])]),_:1})]),_:1})]),_:2},[S(y).breakpoint==="sm"?{name:"buttons",fn:d(()=>[i("div",tt,[l(q,{type:"fsMultiselectList",label:"Plan type",typeaheaddata:m.value,typeaheadkey:"name",modelValue:b.value,"onUpdate:modelValue":r[0]||(r[0]=f=>b.value=f),typeaheadvalueattribute:"id",name:"historyPlan",autocomplete:"donotfill"},null,8,["typeaheaddata","modelValue"])])]),key:"0"}:void 0]),1024),i("div",xt,[(T(),ae(S(me),ue($.value,{store:_.value,ref_key:"grid",ref:O,key:u.value}),null,16,["store"]))])])}}});const wt=fe(Tt,[["__scopeId","data-v-dd90d52c"]]),St={class:"mr-3 d-flex align-items-center"},kt={class:"h5 pl-2 my-auto fw-bold"},It={class:"ms-auto"},At={class:"d-flex align-items-center float-right p-2"},Ot={class:"d-flex flex-column h-100 w-100 pt-3"},Ct={class:"d-flex my-2"},Ft=i("span",{class:"text-lg"}," There's already an active plan under this plan type. Still assign this plan and inactivate the existing plan? ",-1),Et=se({__name:"timeOffPlanPanel",props:{showAssignTimeOffPlan:{default:null},isEdit:{type:Boolean,default:null}},emits:["editTimeOff","refreshEmployeesList"],setup(k,{expose:y,emit:u}){const a=k;le.add(Ve,Me);const p=Ne(),O=Z(),C=ne(),{vacationPlanName:D,vacationType:V}=X(O),{fetchVacationList:$,updateListPlanOfEmployee:I,addListPlanOfEmployee:_}=O,b=n(null),m=n(null),g=n(!1);y({isOpen:g});const R=Number(C.params.id),e=He({...{planTypeOption:null,planTypeId:null,planNameOption:null,startDate:null,isActive:!0,employeeId:R,vacationPlanId:null}}),B=n(new Array),v=n(new Array),P=n(null);G([g,a],async()=>{!g.value||(a.isEdit?a.showAssignTimeOffPlan&&(await M(!0),e.planTypeId=B.value.find(c=>c.id==a?.showAssignTimeOffPlan?.planTypeId),e.vacationPlanId=v.value.find(c=>c.id==a?.showAssignTimeOffPlan?.vacationPlanId),e.startDate=a?.showAssignTimeOffPlan?.startDate,e.isActive=a?.showAssignTimeOffPlan?.isActive,e.employeeId=a?.showAssignTimeOffPlan?.employeeId,m.value=oe.exports.cloneDeep(e)):await M(!1))});async function M(c){await $(C.params.id,c),B.value=V.value.map(t=>({id:t.id,name:t.name})),v.value=D.value.map(t=>({id:t.id,name:t.planName,planTypeId:t.planTypeId})),P.value=v.value}const N=async()=>{const c={isActive:e.isActive,startDate:e.startDate,employeeAccrualPlanId:a?.showAssignTimeOffPlan?.id,employeeId:e.employeeId};await I(c)?(await H(),p.notifySuccess("Plan updated."),u("refreshEmployeesList")):p.notifyError("An error occurred while updating the plan.")};async function Y(){const c={isActive:e.isActive,startDate:e.startDate,employeeId:e.employeeId,vacationPlanId:e.vacationPlanId.id};await _(c)?(await H(),p.notifySuccess("Plan assigned.")):p.notifyError("An error occurred while assigning the plan."),u("refreshEmployeesList")}const H=()=>{e.planTypeId={},e.vacationPlanId={},e.startDate=qe("").format("YYYY-MM-DD"),e.isActive=!0,setTimeout(()=>b.value.resetForm())},L=async()=>{H(),g.value=!g.value},F=async c=>{c.preventDefault();const{valid:t}=await b.value.validate();if(!!t){if(e.isActive&&await O.hasActivePlanWithType(C.params.id,e.vacationPlanId.id)){j.value=!0;return}await r()}},j=n(!1),h=()=>{j.value=!1},r=async()=>{if(a.isEdit){await N(),u("refreshEmployeesList"),h(),g.value=!1;return}u("refreshEmployeesList"),Y(),h(),g.value=!1},q=c=>{v.value=D.value.map(({id:t,planName:f,planTypeId:K})=>({id:t,name:f,planTypeId:K})).filter(t=>t.planTypeId===c?.id),e.vacationPlanId&&c?.id!==e.vacationPlanId.planTypeId&&(e.vacationPlanId=null,setTimeout(()=>b.value.resetForm()))};return(c,t)=>{const f=x("font-awesome-icon"),K=x("fs-link"),s=x("fs-button"),o=x("fs-input"),W=x("fs-form-checkbox"),A=x("fs-col"),he=x("fs-row"),be=x("fs-container"),Pe=x("fs-sidebar"),xe=x("VeeForm");return T(),E(je,null,[l(xe,{ref_key:"formPlan",ref:b,id:"submitTimeOffPlanForm"},{default:d(({meta:Te})=>[l(Pe,{visible:g.value,id:"timeOffPlanForm-right",class:"timeOffPlanForm",right:"","sidebar-class":"fsi-sidebar help-center","body-class":"help-center__body","no-close-on-esc":"","no-close-on-backdrop":"","bg-variant":"white",width:"425px",shadow:"","header-class":"border-bottom","footer-class":"border-top","no-header-close":""},{title:d(()=>[i("div",St,[i("div",kt,J(a.isEdit?"Edit Plan":"Assign Plan"),1),i("div",It,[l(K,{class:"text-secondary",tag:"a",onClick:L},{default:d(()=>[l(f,{icon:["fal","times"],size:"sm"})]),_:1})])])]),footer:d(()=>[i("div",At,[l(s,{variant:"outline-secondary",class:"btn btn-outline-gray",onClick:L},{default:d(()=>[z("Cancel")]),_:1}),l(s,{variant:"btn-primary",class:"btn btn-primary ms-auto",type:"submit",onClick:t[0]||(t[0]=w=>F(w)),disabled:!(Te.valid&&!S(oe.exports.isEqual)(m.value,e))},{default:d(()=>[z("SAVE")]),_:2},1032,["disabled"])])]),default:d(()=>[i("div",Ot,[l(A,null,{default:d(()=>[l(be,{fluid:""},{default:d(()=>[l(he,null,{default:d(()=>[l(A,null,{default:d(()=>[l(o,{modelValue:e.planTypeId,"onUpdate:modelValue":t[1]||(t[1]=w=>e.planTypeId=w),type:"fsMultiselectList",id:"prefixId",labelId:"prefixLabelId",label:"Plan Type",typeaheadkey:"name",rules:"required",typeaheadvalueattribute:"id",name:"PlanType",showClear:!0,typeaheaddata:B.value,disabled:!!a.isEdit,autocomplete:"donotfill",required:!0,onSelect:t[2]||(t[2]=w=>q(w))},null,8,["modelValue","typeaheaddata","disabled"]),l(o,{modelValue:e.vacationPlanId,"onUpdate:modelValue":t[3]||(t[3]=w=>e.vacationPlanId=w),label:"Plan",type:"fsMultiselectList",typeaheadkey:"name",labelId:"lblPlanId",rules:"required",typeaheadvalueattribute:"id",name:"Plan",showClear:!0,typeaheaddata:v.value,disabled:!!(e.planTypeId===null||a.isEdit),autocomplete:"donotfill",required:!0},null,8,["modelValue","typeaheaddata","disabled"]),l(o,{required:!0,label:"Start Date for time-off calculation",rules:"required",type:"fsDateInput",class:"w-75",name:"StartDate",modelValue:e.startDate,"onUpdate:modelValue":t[4]||(t[4]=w=>e.startDate=w)},null,8,["modelValue"]),l(W,{modelValue:e.isActive,"onUpdate:modelValue":t[5]||(t[5]=w=>e.isActive=w),name:"check-button",switch:"",size:"lg"},{default:d(()=>[z(J(e.isActive?"Active":"Inactive"),1)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})])]),_:2},1032,["visible"])]),_:1},512),l(We,{title:"Assign Plan","show-modal":j.value,"cancel-btn-variant":"light",okText:"OK",okTextVariant:"danger",cancelText:"CANCEL",cancelTextVariant:"outline",onClose:h,onOk:r},{content:d(()=>[i("div",Ct,[l(f,{icon:["fas","circle-exclamation"],class:"text-danger me-2 mt-1"}),Ft])]),_:1},8,["show-modal"])],64)}}}),Dt={class:"hq-pg"},$t={class:"list-table b-stripe-vertical b-stripe-horizontal b-grid-header-no-border mb-4"},Bt={class:"large-header",id:"assigned-time-off-plans"},Lt={class:"action-grid list__table list__table--onpage list__b-grid--hover container-fluid"},Vt=se({__name:"timeOffPlans",setup(k){const{setLoading:y}=de();le.add(Re,Ge);const u=n(null),{fetchEmployeeDetails:a}=re(),{getEmployeeDetails:p}=X(re()),O=te(()=>_.params?.id?.toString()),C=n(0),{responsive:D}=ce(),V=Z(),{timeOffPlanTree:$}=X(V),{fetchTimeOffPlantList:I}=V,_=ne(),b=n(null),m="timeOffPlansGrid",g=n(null),R=te(()=>g.value?.instance.value.features),U={field:"planType",ascending:!0};class e extends Ke{static idField="name";static fields=["name","region","value"]}const B={type:"combo",valueField:"name",displayField:"name",chipView:{iconTpl:()=>'<i class="b-icon b-fa-city"></i>'},listItemTpl:({name:s})=>`<div style="margin-left:20px">${s}</div>`,picker:{allowGroupSelect:!1},store:{modelClass:e,groupers:[{field:"region",ascending:!0}],data:[{name:"Active",region:"Status",value:!0},{name:"Inactive",region:"Status",value:!1}]}},v=n({...Q.gridConfig,..._e(m),...ge(m,U),autoHeight:!0,emptyText:"",features:{tree:!0},columns:[{flex:2,text:"Plan",id:"plan",type:"tree",leafIconCls:"",field:"planName",touchConfig:{editor:!1},hidden:!1,collapseIconCls:"b-fa b-fa-circle-minus",expandOnCellClick:!0,expandIconCls:"b-fa b-fa-circle-plus"},{flex:2,text:"Start date for calculation",type:"date",id:"startDate",field:"startDate",groupable:!1,htmlEncode:!1,filterable:{filterFn:({record:s,value:o})=>{if(Ye.format(new Date(o),"MM/DD/YYYY")==s.data.startDate)return s}},responsiveLevels:{small:{hidden:!0}}},{flex:2,text:"Active",id:"isActive",field:"isActive",groupable:!1,htmlEncode:!1,editor:B,align:"center",filterable:{filterField:Object.assign(B,{multiSelect:!1}),filterFn:({record:s,value:o})=>{if(o==="Active"&&s.data.isActive||o==="Inactive"&&!s.data.isActive)return s}},renderer:({record:s})=>s.data.parentId===null?"":s.data.isActive?'<i class="b-fa b-fa-check text-success"></i>':'<i class="b-fa b-fa-xmark text-danger"></i>'},{flex:1,text:"Actions",type:"action",id:"action",field:"action",columnDragToolbar:!1,enableHeaderContextMenu:!1,enableCellContextMenu:!1,cellCls:"b-action-cell--hover",actions:[{visible:!0,renderer:({record:s})=>s.data.parentId===null?"":`
          <div class="b-action-item b-fa b-fa-arrow-up-right-from-square btn-edit updateContactBtn btn-link"><span>Edit</span></div>`,onClick:({record:s})=>{f(s)}}]}]}),P=n(new pe({...Q.gridStoreConfig,sorters:[U],onFilter:()=>{F.value&&P.value.filters.count<N.value&&L(),N.value=P.value.filters.count}}));async function M(){P.value.data=[...$.value];const s=localStorage.getItem(`${m}State`);s&&(P.value.state=JSON.parse(s))}G(()=>D.breakpoint,()=>{D.breakpoint==="sm"&&v.value.columns.forEach(s=>{["startDate"].includes(s.id)&&(s.hidden=!0)}),C.value++}),Ue(async()=>{try{y(!0),await I(_.params.id),M(),a(O.value).then(()=>{u.value=p.value})}finally{y(!1)}});const N=n(0),Y=["id"],H=n(new Array);function L(){ye(H.value,Y,F.value,P.value)}const F=n(localStorage.getItem(`${m}SearchText`)??"");G(F,()=>{L()});function j(){localStorage.setItem(`${m}State`,JSON.stringify(P.value.state)),localStorage.setItem(`${m}SearchText`,F.value)}function h(){P.value.clearFilters(),P.value.clearSorters(),localStorage.removeItem(`${m}State`),localStorage.removeItem(`${m}SearchText`)}function r(){P.value.clearFilters(),R.value.filterBar.hideFilterBar()}const q=n(null),c=n(null);async function t(){await I(_.params.id),M()}const f=async s=>{b.value.isOpen=!0,q.value={...s.data},c.value=!0};function K(){b.value.isOpen=!0,c.value=!1}return(s,o)=>{const W=x("fs-button");return T(),E("div",Dt,[l(ze,{employeeId:S(O),class:"position-relative"},null,8,["employeeId"]),i("div",$t,[i("div",Bt,[l(ve,{title:"Assigned Plans","local-storage-key":m,"show-settings-button":!0,"show-search-button":!1,"show-filter-button":!0,onSaveSettings:o[1]||(o[1]=A=>j()),onClearSettings:o[2]||(o[2]=A=>h()),onHideFilterBar:o[3]||(o[3]=A=>r()),onShowFilterBar:o[4]||(o[4]=A=>S(R).filterBar.showFilterBar()),onSearchTextInput:o[5]||(o[5]=A=>F.value=A),onRefreshGrid:o[6]||(o[6]=A=>t())},{buttons:d(()=>[l(W,{variant:"btn-primary",class:"ms-2 btn btn-primary",onClick:o[0]||(o[0]=A=>K())},{default:d(()=>[z("Assign plan")]),_:1})]),_:1}),i("div",Lt,[(T(),ae(S(me),ue({ref_key:"grid",ref:g},v.value,{store:P.value,key:C.value}),null,16,["store"]))])]),l(Et,{ref_key:"timeOffPlan",ref:b,showAssignTimeOffPlan:q.value,isEdit:c.value,onRefreshEmployeesList:t},null,8,["showAssignTimeOffPlan","isEdit"]),l(wt)])])}}});const Xt=fe(Vt,[["__scopeId","data-v-3415a2b0"]]);export{Xt as default};
