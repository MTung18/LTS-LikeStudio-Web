import{B as we}from"./bryntumSearchBar.3bdd630f.js";import"./grid.module.3b00878a.js";import{B as Ce}from"./BryntumGrid.2c4be387.js";import{f as Ee}from"./filterStoreDataBySearchText.3eea2082.js";import{P as Se,a as ge,A as he,D as _e}from"./panelConfig.9fc2559c.js";import{R as xe,j as l,al as q,aZ as K,d as H,l as ee,af as De,at as W,Q as te,T as Te,b as x,r as k,o as g,f as ae,w as m,a as w,g as n,I as $,u as s,ao as Be,aH as G,ap as ke,b2 as Oe,M as S,bP as Pe,bQ as Ve,bR as Ae,s as oe,bk as Q,e as le,c as O,bp as Fe,a3 as $e,F as Z,D as J,a2 as F,i as X}from"./index.611fe570.js";import{_ as Me}from"./deleteConfirmationModal.vue_vue_type_script_setup_true_lang.7d561088.js";import{_ as Ue}from"./detailsPanel.vue_vue_type_style_index_0_lang.36fd0cd3.js";import{u as Ie}from"./useBryntumGridSearchFilter.628f2003.js";import{e as Le}from"./employeeHeader.c061ea79.js";import"./foundationCompanyCasConnectionStore.b3301598.js";import"./debounce.cf77a06e.js";import"./isObject.c4ad145e.js";import"./statefulSortFeature.3df4a43a.js";import"./gridConfigDefaults.8c72c19b.js";const ne=xe("employeeNote",()=>{const r=l([]);async function f(c){r.value=await q.getEmployeeNotesAsync(c)}async function p(c){return await q.deleteEmployeeNoteAsync(c)}async function C(c,d){return d.title=K(d.title),d.note=K(d.note),await q.createEmployeeNoteAsync(c,d)}return{fetchEmployeeNotes:f,deleteEmployeeNote:p,createEmployeeNote:C,employeeNotes:r}});class Y{id;title;note;date;createdBy;constructor(f){Object.assign(this,f)}}const Re={class:"d-flex py-3 contain"},qe={class:"d-flex flex-column h-100 w-100 pt-3"},Ge=H({__name:"employeeCreateNotePanel",props:{showCreateNotePanel:{type:Boolean,default:!1}},emits:["update:showCreateNotePanel","noteUpdated"],setup(r,{emit:f}){const p=r;ee.add(De);const C=W(),{notifySuccess:c}=te(),d=ne(),P=Te(),i=l(),v=l(!1),b=l(!0),t=l(new Y),V=x(()=>C.params?.id?.toString());l();const A=x(()=>!!(t.value.date||t.value.title||t.value.note)),D=async()=>{t.value=new Y({title:"",note:""}),setTimeout(async()=>{await i.value?.setFieldTouched(!1),await i.value?.resetForm()},25)},h=x({get(){return p.showCreateNotePanel},set(E){D(),f("update:showCreateNotePanel",E)}});async function T(E){try{const a=await i.value.validate();if(v.value=!0,!a.valid){ke("observer");return}b.value=!0,t.value.createdBy=P.activeUserAccount.name,await d.createEmployeeNote(+V.value,Oe.cloneDeep(t.value)),c(S.NOTES.SAVE_SUCCESS),await D(),h.value=E,f("noteUpdated")}catch(a){console.debug(a)}finally{b.value=!1}}return(E,a)=>{const B=k("fs-button"),_=k("fs-input"),M=k("fs-container"),U=k("fs-sidebar");return g(),ae(U,{"sidebar-class":"fsi-sidebar help-center","body-class":"help-center__body",right:"","no-close-on-esc":"","no-close-on-backdrop":"","bg-variant":"white",width:"425px",shadow:"sm","header-class":"border-bottom","footer-class":"border-top","aria-label":"onboarding plan",modelValue:s(h),"onUpdate:modelValue":a[5]||(a[5]=y=>G(h)?h.value=y:null),title:"Add Note"},{footer:m(({hide:y})=>[w("div",Re,[n(B,{variant:"outline-secondary",class:"btn btn-outline-gray",onClick:y},{default:m(()=>[$("Cancel")]),_:2},1032,["onClick"]),n(B,{variant:"outline-green",disabled:!s(A),class:"ms-auto",onClick:a[0]||(a[0]=N=>T(!1))},{default:m(()=>[$("SAVE & DONE")]),_:1},8,["disabled"]),n(B,{variant:"btn-primary",disabled:!s(A),class:"btn btn-primary",onClick:a[1]||(a[1]=N=>T(!0))},{default:m(()=>[$("SAVE & NEW")]),_:1},8,["disabled"])])]),default:m(()=>[w("div",qe,[n(M,{fluid:"",class:"contain"},{default:m(()=>[n(s(Be),{ref_key:"observer",ref:i,id:"observer"},{default:m(({meta:y})=>[n(_,{required:!0,type:"fsDateInput",label:"Date",rules:{required:!0},modelValue:t.value.date,"onUpdate:modelValue":a[2]||(a[2]=N=>t.value.date=N),name:"Date",formMeta:{...y,validated:v.value}},null,8,["modelValue","formMeta"]),n(_,{required:!0,type:"fsTextInput",label:"Title",maxlength:100,rules:{required:!0,max:100},modelValue:t.value.title,"onUpdate:modelValue":a[3]||(a[3]=N=>t.value.title=N),name:"Title",formMeta:{...y,validated:v.value}},null,8,["modelValue","formMeta"]),n(_,{required:!0,type:"fsTextArea",label:"Notes",maxlength:500,rules:{required:!0,max:500},modelValue:t.value.note,"onUpdate:modelValue":a[4]||(a[4]=N=>t.value.note=N),name:"Notes",formMeta:{...y,validated:v.value}},null,8,["modelValue","formMeta"])]),_:1},512)]),_:1})])]),_:1},8,["modelValue"])}}}),He={class:"pg-grid large-header"},We={class:"action-grid list__table list__table--onpage list__b-grid--hover"},je=w("br",null,null,-1),ze={key:0},Ke=w("i",{class:"me-2 mt-2 b-fa b-fa-sticky-note text-success no-underline"},null,-1),Qe=H({__name:"noteList",props:{readOnly:{type:Boolean},showCreate:{type:Boolean,default:!0}},setup(r){const f=r;ee.add(Pe,Ve,Ae);const p=ne(),{employeeNotes:C}=oe(p),c=W(),{notifySuccess:d,notifyError:P}=te();let i=l(!1);const v=l(!1),b=l(!1),t=l(),V=l(),A=x(()=>c.params?.id?.toString()),D=l(new Se({showFooter:!0,showHeader:!1,title:S.NOTES.VIEW_NOTE,actions:[new ge({name:S.NOTES.DELETE_NOTE,icon:["fal","fa-trash-can"],handler:pe,placement:he.Footer,variant:"danger"})]})),h={flex:1,type:"action",id:"action",text:"Actions",minWidth:200,columnDragToolbar:!1,enableHeaderContextMenu:!1,enableCellContextMenu:!1,cellCls:"b-action-cell--hover",actions:[{visible:!0,renderer:()=>'<i class="b-action-item b-fa b-fa-external-link btn btn-link text-success no-underline"><span>View</span></i>',onClick:fe},{visible:!0,renderer:()=>'<i class="b-action-item b-fa b-fa-trash-alt btn btn-link text-red no-underline"><span>Delete</span></i>',onClick:me}]},T=l(null),E=x(()=>T.value?.instance.value.features),a="noteListGrid",B={field:"date",descending:!0},{filteredData:_,defaultGridConfig:M,statefulFilterFeature:U,statefulSortFeature:y,filterCount:N,searchText:I,gridStore:j,saveGridSettings:se,clearGridSettings:re,hideFilterBar:ie,populateBryntumStore:ue}=Ie(E,a,B,z),de=l({...M,...U,...y,minHeight:"100%",emptyText:S.NOTES.NO_RECORD,columns:[{flex:1,text:"Date",id:"date",field:"date",groupable:!1,renderer:({row:o,value:e})=>Q(e)},{flex:1,text:"Created By",id:"createdBy",field:"createdBy",groupable:!1},{flex:1,text:"Title",id:"title",field:"title",groupable:!1,renderer:({row:o,value:e})=>(o.eachElement(R=>R.style.background="#ffffff"),e)},{flex:2,text:"Notes",id:"note",field:"note",groupable:!1},...f.readOnly?[]:[h]]}),ce=["id"];function z(){Ee(_.value,ce,I.value,j.value)}function fe(o){o.record.data&&(D.value.source=o.record.data,V.value=_e.ConvertNotes(o.record.data),v.value=!0)}async function me(o){o.record.data&&(t.value=o.record.data,b.value=!0)}async function pe(o){o&&(t.value=o,b.value=!0,v.value=!1)}async function ve(){t.value&&(await be(t.value.id),await L())}function ye(){b.value=!1,t.value=null}async function be(o){await p.deleteEmployeeNote(o)?d(S.NOTES.DELETE_SUCCESS):P(S.NOTES.DELETE_ERROR)}async function Ne(){L()}async function L(){await p.fetchEmployeeNotes(+A.value),_.value=C.value,ue(),I.value!==""&&z()}return le(async()=>{await L()}),(o,e)=>{const R=k("fs-button");return g(),O("div",He,[n(we,{title:"Notes","local-storage-key":a,"show-settings-button":!0,"show-search-button":!0,"show-filter-button":!0,"show-refresh-button":!1,"show-footer-search":!1,onSaveSettings:e[1]||(e[1]=u=>s(se)()),onClearSettings:e[2]||(e[2]=u=>s(re)()),onHideFilterBar:e[3]||(e[3]=u=>s(ie)()),onShowFilterBar:e[4]||(e[4]=u=>s(E).filterBar.showFilterBar()),onSearchTextInput:e[5]||(e[5]=u=>I.value=u)},Fe({_:2},[r.showCreate?{name:"buttons",fn:m(()=>[n(R,{variant:"btn-primary",class:"btn btn-primary ms-3",onClick:e[0]||(e[0]=u=>G(i)?i.value=!0:i=!0)},{default:m(()=>[$("Create Note")]),_:1})]),key:"0"}:void 0]),1024),w("div",We,[n(s(Ce),$e(de.value,{store:s(j),ref_key:"grid",ref:T}),null,16,["store"])]),r.readOnly?F("",!0):(g(),O(Z,{key:0},[n(Ue,{details:V.value,showPanel:v.value,"onUpdate:showPanel":e[6]||(e[6]=u=>v.value=u),config:D.value},null,8,["details","showPanel","config"]),n(Me,{showDeleteModal:b.value,"onUpdate:showDeleteModal":e[7]||(e[7]=u=>b.value=u),title:"Delete Note Confirmation",type:"Note",onOK:ve,onCANCEL:ye},{default:m(()=>[w("span",null,J(s(S).NOTES.DELETE_MESSAGE),1),je,t.value?(g(),O("span",ze,[Ke,w("b",null,J(`${s(Q)(t.value.date)} | ${t.value.title} `),1)])):F("",!0)]),_:1},8,["showDeleteModal"])],64)),r.showCreate?(g(),O(Z,{key:1},[r.showCreate?(g(),ae(Ge,{key:0,showCreateNotePanel:s(i),"onUpdate:showCreateNotePanel":e[8]||(e[8]=u=>G(i)?i.value=u:i=u),onNoteUpdated:Ne},null,8,["showCreateNotePanel"])):F("",!0)],64)):F("",!0)])}}}),Ze={class:"hq-pg list"},Je={class:"list__table"},mt=H({__name:"notes",props:{readOnly:{type:Boolean,default:!1}},setup(r){const f=l(null),{fetchEmployeeDetails:p}=X(),{getEmployeeDetails:C}=oe(X()),c=W(),d=x(()=>c.params?.id?.toString());return le(()=>{p(d.value).then(()=>{f.value=C.value})}),(P,i)=>(g(),O("div",Ze,[n(Le,{employeeId:s(d),class:"position-relative"},null,8,["employeeId"]),w("div",Je,[n(Qe,{readOnly:r.readOnly,showCreate:!0},null,8,["readOnly"])])]))}});export{mt as default};
