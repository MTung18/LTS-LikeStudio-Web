import{d as z,l as q,bV as X,af as re,by as De,bW as Ee,b1 as ue,Q as ce,j as o,s as de,y as Le,a1 as Y,r as T,o as p,c as _,g as l,w as b,a as t,u as i,C as S,I as L,bm as N,F as J,z as fe,A,D as B,bX as ae,ax as Te,ay as Fe,bY as Ne,_ as Q,bZ as Ae,b as pe,e as me,a5 as Ue,bc as Oe,f as H,a2 as oe,B as Me,Y as U,b_ as Ve,b$ as We,c0 as Re,c1 as Ge,c2 as Ye,a0 as ze,bO as je,bb as He,aX as qe,a3 as Xe}from"./index.611fe570.js";import{S as Je,i as Qe}from"./grid.module.3b00878a.js";import{B as Ke}from"./BryntumGrid.2c4be387.js";import{B as ne}from"./bryntumSearchBar.3bdd630f.js";import{f as ie}from"./gridConfigDefaults.8c72c19b.js";import{g as Ze,a as et}from"./statefulSortFeature.3df4a43a.js";import{f as tt}from"./filterStoreDataBySearchText.3eea2082.js";import{u as ve}from"./bulletinBoardStore.4a56183b.js";import{d as st}from"./debounce.cf77a06e.js";import"./foundationCompanyCasConnectionStore.b3301598.js";import"./isObject.c4ad145e.js";const lt=a=>(Te("data-v-a77c6b2b"),a=a(),Fe(),a),at={id:"publishBulletinPanel"},ot={class:"mr-3 d-flex align-items-center"},nt={class:"h5 pl-2 my-auto fw-bold"},it={class:"ms-auto"},rt={class:"d-flex flex-column h-100 w-100 pt-3"},ut=lt(()=>t("div",{class:"title mb-0"},[t("p",null," Published posts on employee\u2019s dashboard are arranged according to posting time. Maximum 3 publish posts at a time.")],-1)),ct={class:"my-table"},dt=["onClick"],ft={class:"idx"},pt={class:"data-title"},mt=["onClick"],vt=z({__name:"publishBulletinPanel",props:{showPublishBulletin:null},setup(a,{expose:C}){const h=a;q.add(X,re,De,Ee,ue);const{notifySuccess:w,notifyError:k}=ce(),v=o(null),P=ve(),{bulletinBoardDetail:m}=de(P),I=Le(),f=o(!1);C({isOpen:f});const x=o(),r=async()=>{f.value=!f.value};Y(h,async()=>{x.value=h.showPublishBulletin});const c=async g=>{await P.fetchBulletinBoardDetail(g);try{if(await P.updateBulletinBoardDetail(g,{essDashboardPublishDate:m.value.essDashboardPublishDate,essDashboardExpirationDate:m.value.essDashboardPublishDate,title:m.value.title,postStatusId:m.value.postStatusId,thumbnailUrl:m.value.thumbnailUrl,postContent:Ne(m.value.postContent),postDocumentMetadata:m.value.postDocumentMetadata,postCategoryId:m.value.postCategoryId,documentCategoryName:"General",isPublishedOnESSDashboard:!1})){const d=x.value.findIndex(n=>n.postId===g);d>-1&&x.value.splice(d,1)}w("Change publish updated.")}catch{k("Change publish fail.")}},F=g=>{I.push({name:"viewBulletinDetail",params:{id:g}})};return(g,D)=>{const d=T("fs-link"),n=T("fs-sidebar"),j=T("fs-form");return p(),_("div",at,[l(j,{ref_key:"formPlan",ref:v,class:"publishBulletinPanel"},{default:b(()=>[l(n,{visible:f.value,id:"publishPostForm-right",class:"publishPostForm",right:"","sidebar-class":"fsi-sidebar help-center","body-class":"help-center__body","no-close-on-esc":"","no-close-on-backdrop":"","bg-variant":"white",width:"425px",shadow:"","header-class":"border-bottom","footer-class":"border-top","no-header-close":""},{title:b(()=>[t("div",ot,[t("div",nt,[l(i(S),{icon:["fal","fa-bullhorn"],class:"text-black"}),L(" Manage Published Posts ")]),t("div",it,[l(d,{class:"text-secondary",tag:"a",onClick:D[0]||(D[0]=N(u=>r(),["prevent"]))},{default:b(()=>[l(i(S),{icon:["fal","times"],size:"sm"})]),_:1})])])]),default:b(()=>[t("div",rt,[ut,t("div",ct,[(p(!0),_(J,null,fe(x.value,(u,$)=>(p(),_("div",{key:u.postId},[t("div",{onClick:M=>F(u.postId),class:A(["subject","id-"+u.postId])},[t("div",ft,B($+1),1),t("div",pt,[t("strong",null,B(u.title),1),t("p",null,B(i(ae)(u.essDashboardPublishDate))+" - "+B(i(ae)(u.essDashboardExpirationDate)),1)]),t("a",{role:"button",class:"ms-auto py-2 px-3",onClick:N(M=>c(u.postId),["stop"])},[l(i(S),{icon:["fal","fa-circle-xmark"],class:"text-red"})],8,mt)],10,dt)]))),128))])])]),_:1},8,["visible"])]),_:1},512)])}}});const bt=Q(vt,[["__scopeId","data-v-a77c6b2b"]]),ht={id:"grid-item"},gt={class:"post__image overflow-hidden"},_t=["src"],yt={class:"post__body"},Bt={class:"d-flex justify-content-between align-items-center"},St={class:"name-icon"},wt=["src"],Ct={class:"name ms-1"},xt={class:"date"},kt={class:"post__body--title d-flex justify-content-between align-items-center"},$t={class:"title-post"},Pt={key:0,class:A(["position-absolute shadow  dropdown-btn"])},It={class:"post__body--description trim-text"},Dt={class:"w-100 d-flex align-items-center justify-content-between"},Et=t("div",{class:"title"},"Delete Post",-1),Lt={class:"p-3"},Tt={class:"lh-base"},Ft=t("br",null,null,-1),Nt={class:"fw-bold dataTitle"},At=z({__name:"gridItem",props:{post:null},setup(a){q.add(Ae,re,X,ue);const C="/images/default-thumbnail.png",h=o(!1),w=pe(()=>r=>r),k=o(null),v=r=>{!k.value||r.target!==k.value&&r.composedPath().includes(k.value)||(h.value=!1)};me(()=>{window.addEventListener("click",v)}),Ue(()=>{window.removeEventListener("click",v)});const P=o(null),m=o(!1),I=r=>{U.push({name:"viewBulletinDetail",params:{id:r.postId}})},f=r=>{r.postStatusId===2?U.push({name:"editDraftPost",params:{id:r.postId}}):r.postStatusId===1&&U.push({name:"editPost",params:{id:r.postId}})};function x(r){return Boolean(r?.startsWith("data:application/octet-stream;base64,"))}return(r,c)=>{const F=T("fs-link"),g=T("fs-button"),D=T("fs-modal");return p(),_("div",ht,[t("div",{class:"post",onClick:c[3]||(c[3]=d=>I(a.post))},[t("div",gt,[t("img",{class:"img-fluid",src:x(a.post.thumbnailUrl)?a.post.thumbnailUrl:C},null,8,_t)]),t("div",yt,[t("div",Bt,[t("div",St,[t("img",{class:"thumbnail",src:x(a.post.thumbnailUrl)?a.post.thumbnailUrl:C},null,8,wt),t("span",Ct,B(a.post?.createdEmployeeFullName),1)]),t("span",xt,B(i(Oe)(a.post?.createdDateUTC).format("MM/DD/YYYY")),1)]),t("div",kt,[t("span",$t,[a.post?.isPublishedOnESSDashboard?(p(),H(i(S),{key:0,class:"me-2 icon-bullhorn",icon:["fal","bullhorn"]})):oe("",!0),L(B(a.post?.title),1)]),t("div",{class:"position-relative",ref_key:"componentRef",ref:k},[t("span",{onClick:c[0]||(c[0]=N(d=>h.value=!h.value,["stop"])),class:A(["icon px-2",{visible:h.value}])},[l(i(S),{icon:["fal","ellipsis-vertical"],size:"sm"})],2),h.value?(p(),_("div",Pt,[t("div",{class:"block",onClick:c[1]||(c[1]=N(d=>f(a.post),["stop"]))},"Edit..."),t("div",{class:"text-danger",onClick:c[2]||(c[2]=N(d=>m.value=!0,["stop"]))}," Delete ")])):oe("",!0)],512)]),t("p",It,B(a.post?.postContent),1),t("span",{class:"category1",style:Me(`background-color: ${i(w)(a.post?.categoriesColor)}`)},B(a.post?.categoryName),5)])]),l(D,{id:"delete-modal",ref:"modal","content-class":"content-fsModal","body-class":"body-fsModal","header-bg-variant":"blue","header-close-variant":"light","header-text-variant":"white","hide-header-close":"true",modelValue:m.value,"onUpdate:modelValue":c[4]||(c[4]=d=>m.value=d),onClose:c[5]||(c[5]=d=>m.value=!1)},{"modal-header":b(({cancel:d})=>[t("div",Dt,[Et,l(F,{class:"text-secondary",tag:"a",onClick:d},{default:b(()=>[l(i(S),{icon:["fal","times"],size:"lg",class:"text-white"})]),_:2},1032,["onClick"])])]),default:b(()=>[t("div",Lt,[t("h5",Tt,[l(i(S),{icon:["fal","fa-circle-exclamation"],class:"me-2 text-danger"}),L(" Are you sure you want to delete the following post? "),Ft,t("span",Nt,B(a.post?.title),1)])])]),"modal-footer":b(({ok:d,cancel:n})=>[l(g,{onClick:n,variant:"light",class:"px-4 py-2 fw-semibold"},{default:b(()=>[L("CANCEL ")]),_:2},1032,["onClick"]),l(g,{onClick:()=>{P.value=a.post?.postId,r.$emit("delete",P.value),d()},variant:"danger",class:"px-4 py-2 fw-semibold"},{default:b(()=>[L("DELETE ")]),_:2},1032,["onClick"])]),_:1},8,["modelValue"])])}}}),Ut={id:"item-overflow"},Ot={class:"container-item"},Mt=z({__name:"gridList",props:{posts:null},emits:["delete"],setup(a,{emit:C}){function h(w){C("delete",w)}return(w,k)=>(p(),_("div",Ut,[t("div",Ot,[(p(!0),_(J,null,fe(a.posts,v=>(p(),_("div",{key:v.postId,class:"item"},[l(At,{post:v,onDelete:h},null,8,["post"])]))),128))])]))}});const Vt=Q(Mt,[["__scopeId","data-v-cc67f3ad"]]),Wt={class:"dashboard-card__content mb-5",id:"bulletin-board"},Rt={class:"d-flex justify-content-between w-sm-100"},Gt={class:"form-search"},Yt=["onSubmit"],zt={class:"tabs"},jt={key:2,class:"list__table"},Ht={key:3},qt=z({__name:"bulletinBoard",props:{modelValue:{default:null}},setup(a){q.add(Ve,We,X,Re,Ge,Ye);const{responsive:C}=ze(),h=o(null),{setLoading:w}=je(),{notifySuccess:k}=ce(),v=ve(),P=He(),{listOfBulletinBoards:m,listOfBulletinBoardsWithImage:I}=de(v),f="BulletinBoardList",x="postType",r="bulletinBoardType",c={field:"date",ascending:!0},F=o(null),g=pe(()=>F.value?.instance.value.features),D=o({...ie.gridConfig,...Ze(f),...et(f,c),height:"100%",emptyText:"",features:{search:!0,regionResize:!1,columnPicker:{groupByRegion:!0}},columns:[{autoWidth:!1,flex:1,text:"Title",field:"title",htmlEncode:!1,renderer:({record:e})=>`<div class="title">${be(e.isPublishedOnESSDashboard)} ${e.title}</div>`},{autoWidth:!1,flex:1,text:"Category",field:"categoryName",htmlEncode:!1,renderer:({record:e})=>`${he(e)}`},{autoWidth:!1,flex:1,text:"Description",field:"postContent",htmlEncode:!1,renderer:({record:e})=>`<div class="description">${e.postContent}</div>`},{autoWidth:!1,flex:1,text:"Date",field:"createdDateUTC",sortable:!0,cellCls:"ellipsis-text",renderer:({record:e})=>e.data.createdDateUTC},{autoWidth:!1,flex:1,text:"Posted By",field:"createdEmployeeFullName",htmlEncode:!1,renderer:({record:e})=>e.data.createdEmployeeFullName},{autoWidth:!1,locked:C.breakpoint==="md",flex:1,text:"Actions",id:"action",type:"action",region:!1,htmlEncode:!1,responsiveLevels:{small:{region:"right"}},actions:[{renderer:()=>$.value===1?'<div class="b-action-item b-fa b-fa-arrow-up-right-from-square btn-view viewBulletinBtn btn-link"></div>':"",onClick:({record:e})=>Ce(e)},{renderer:()=>`
              <div class="b-action-item b-fa b-fa-edit btn-edit updateBulletinBtn btn-link"></div>`,onClick:({record:e})=>xe(e)},{renderer:()=>`
              <div class="b-action-item b-fa b-fa-trash-alt btn-delete deleteBulletinBtn"></div>`,onClick:({record:e})=>ke(e)}]}]});function d(e){e.postStatusId===2?U.push({name:"editDraftPost",params:{id:e.postId}}):e.postStatusId===1&&U.push({name:"editPost",params:{id:e.postId}})}const n=o(new Je({...ie.gridStoreConfig,sorters:[c],onFilter:()=>{V.value&&n.value.filters.count<K.value&&ye(),K.value=n.value.filters.count}}));function j(e){const s=document.createElement("div");return s.innerHTML=e,s.innerText.substring(0,200)}const u=o(null),$=o(1),M=async e=>{localStorage.setItem(x,JSON.stringify(e)),$.value=e,n.value.data=u.value,E.value=""};me(async()=>{try{w(!0),$.value=+localStorage.getItem(x)||1,await v.fetchListOfBulletinBoards();const e=await P.getAllImageInListPost(v.listOfBulletinBoards.map(s=>s.thumbnailUrl));await v.mapListBulletinWithImage(e)}finally{w(!1)}n.value.data=u.value});const be=e=>{switch(e){case!0:return'<i class="b-fa b-fa-bullhorn bullhorn"></i>&nbsp';default:return""}},he=e=>`<div class="category" style="background-color:${e.categoryColor};">${e.categoryName}</div>`,K=o(0),ge=["id"],_e=o(new Array);function ye(){tt(_e.value,ge,V.value,n.value)}const V=o(localStorage.getItem(`${f}SearchText`)??""),Be=()=>{localStorage.setItem(`${f}State`,JSON.stringify(n.value.state)),localStorage.setItem(`${f}SearchText`,V.value)};function Se(){n.value.clearFilters(),n.value.clearSorters(),localStorage.removeItem(`${f}State`),localStorage.removeItem(`${f}SearchText`)}function we(){n.value.clearFilters(),g.value.filterBar.hideFilterBar()}const Ce=e=>{U.push({name:"viewBulletinDetail",params:{id:e.postId}})},xe=async e=>{d(e)},ke=async e=>{const s=new Qe({header:"Delete Post",autoShow:!1,centered:!0,closeAction:"destroy",closable:!0,autoClose:!1,width:"500px",cls:"popup-delete",modal:!0,bbar:{items:{cancel:{text:"CANCEL",minWidth:100,onAction:()=>{s.close()}},delete:{text:"DELETE",minWidth:100,cls:"b-raised b-red",onAction:async()=>{try{v.deletePost(e.postId),k("Post deleted."),n.value.remove(e)}catch(O){console.log(O)}s.close()}}}},html:`<i class="b-fa b-fa-exclamation-circle icon-exclamation-circle"></i>
            <div class="item-text">
              <p>Are you sure you want to delete the following post?</p>
              <strong>${e.title}</strong>
            </div>`});s.show()},Z=o([]);async function ee(){Z.value=m.value.filter(e=>e.isPublishedOnESSDashboard===!0&&e.postStatusId===1),h.value.isOpen=!0}const te=o(!1),W=o(localStorage.getItem(r)||"list");function se(e){localStorage.setItem(r,e),W.value=e,V.value="",e?te.value=!1:te.value=!0,n.value.clearFilters()}async function $e(e){try{w(!0),await v.deletePost(e),u.value=u.value.filter(s=>s.postId!==e),n.value.data=u.value}finally{w(!1)}}const R=o(!1),E=o(""),le=o(null),Pe=()=>{R.value=!R.value,setTimeout(()=>{le.value.focus()},100)},Ie=async()=>{u.value=G(I?.value).filter(e=>e.title.toLocaleLowerCase().includes(E.value.toLocaleLowerCase()))};Y(()=>E.value,st(async()=>{u.value=G(I?.value).filter(e=>e.title.toLocaleLowerCase().includes(E.value.toLocaleLowerCase()))},500));function G(e){return e.map(s=>({...s,postContent:j(s.postContent)})).filter(s=>s.postStatusId===$.value)||[]}return Y(()=>I?.value,e=>{u.value=G(e)},{deep:!0}),Y(()=>$.value,()=>{n.value.clearFilters(),u.value=G(I?.value),n.value.data=u.value}),(e,s)=>{const O=T("RouterLink");return p(),_(J,null,[t("div",Wt,[W.value=="list"?(p(),H(ne,{key:0,title:"Bulletin Board","local-storage-key":f,"show-settings-button":!0,"show-filter-button":!0,onSaveSettings:s[2]||(s[2]=y=>Be()),onClearSettings:s[3]||(s[3]=y=>Se()),onHideFilterBar:s[4]||(s[4]=y=>we()),onShowFilterBar:s[5]||(s[5]=y=>i(g).filterBar.showFilterBar())},{buttons:b(()=>[t("div",null,[t("button",{class:"btn-typeBulletin",onClick:s[0]||(s[0]=y=>se("grid"))},[l(i(S),{icon:["fal","fa-grid-2"],class:"icons"})]),t("button",{class:"btn-sidebar",onClick:s[1]||(s[1]=y=>ee())},[l(i(S),{icon:["fal","fa-bullhorn"],class:"text-violet"})]),l(O,{to:{name:"addPost"},variant:"btn-primary",class:"btn btn-primary btn-add"},{default:b(()=>[L("NEW "+B(i(C).mobile?"":"POST"),1)]),_:1})])]),_:1})):(p(),H(ne,{key:1,title:"Bulletin Board","local-storage-key":f,showRefreshButton:!1,showFilterButton:!1,showSearchButton:!1,onShowFilterBar:s[10]||(s[10]=y=>i(g).filterBar.showFilterBar())},{buttons:b(()=>[t("div",Rt,[t("div",Gt,[R.value?(p(),_("form",{key:0,onSubmit:N(Ie,["prevent"])},[l(qe,{type:"fsTextInput",modelValue:E.value,"onUpdate:modelValue":s[6]||(s[6]=y=>E.value=y),placeholder:"Search...",ref_key:"inputRef",ref:le,onBlur:s[7]||(s[7]=()=>{E.value||(R.value=!1)})},null,8,["modelValue"])],40,Yt)):(p(),_("div",{key:1,class:"icon-search",onClick:Pe},[l(i(S),{class:"icon",icon:["fal","fa-magnifying-glass"]})]))]),t("div",null,[t("button",{class:"btn-typeBulletin",onClick:s[8]||(s[8]=y=>se("list"))},[l(i(S),{icon:["fal","fa-list-ul"],class:"icons"})]),t("button",{class:"btn-sidebar",onClick:s[9]||(s[9]=y=>ee())},[l(i(S),{icon:["fal","fa-bullhorn"],class:"text-violet"})]),l(O,{to:{name:"addPost"},variant:"btn-primary",class:"btn btn-primary btn-add"},{default:b(()=>[L("NEW "+B(i(C).mobile?"":"POST"),1)]),_:1})])])]),_:1})),t("div",zt,[t("button",{class:A({active:$.value===1}),onClick:s[11]||(s[11]=y=>M(1))}," Posted ",2),t("button",{class:A({active:$.value===2}),onClick:s[12]||(s[12]=y=>M(2))}," Drafts ",2)]),t("hr",{class:A({"mb-0":W.value==="list"})},null,2),W.value=="list"?(p(),_("div",jt,[l(i(Ke),Xe(D.value,{store:n.value,ref_key:"grid",ref:F}),null,16,["store"])])):(p(),_("div",Ht,[l(Vt,{posts:u.value,onDelete:$e},null,8,["posts"])]))]),l(bt,{ref_key:"publishBulletin",ref:h,showPublishBulletin:Z.value},null,8,["showPublishBulletin"])],64)}}});const ns=Q(qt,[["__scopeId","data-v-0bec42f0"]]);export{ns as default};
