import{a4 as sv,_ as Ta,j as gt,e as Ma,a5 as Kl,o as yi,c as Er,a6 as Of,a7 as Pf,a1 as $f,a as br,F as _f,z as av,f as hc,a8 as ov,a3 as Hf,a9 as lv,N as Nf,T as dv,cl as cv,J as uv,K as hv,L as fv,R as gv,d as Bf,Q as mv,aU as pv,r as Cr,g as ni,u as vv,w as pi,I as fc,ai as yv,cj as bv,bm as Cv}from"./index.611fe570.js";import{u as wv}from"./timeoffStore.c5e247f0.js";import{j as Bt,D as ut}from"./grid.module.3b00878a.js";/*!
 *
 * Bryntum Calendar 5.3.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */const Sv="calendar";function gc(c,e){var t=Object.keys(c);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(c);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(c,r).enumerable})),t.push.apply(t,i)}return t}function F(c){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?gc(Object(t),!0).forEach(function(i){M(c,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(t)):gc(Object(t)).forEach(function(i){Object.defineProperty(c,i,Object.getOwnPropertyDescriptor(t,i))})}return c}function M(c,e,t){return e=Ev(e),e in c?Object.defineProperty(c,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):c[e]=t,c}function Dv(c,e){if(typeof c!="object"||c===null)return c;var t=c[Symbol.toPrimitive];if(t!==void 0){var i=t.call(c,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(c)}function Ev(c){var e=Dv(c,"string");return typeof e=="symbol"?e:String(e)}class K{static cacheFlags(e=navigator.platform,t=navigator.userAgent){const i=this;i._isLinux=Boolean(e.match(/Linux/)),i._isMac=Boolean(e.match(/Mac/)),i._isWindows=Boolean(e.match(/Win32/)),i._isWebkit=Boolean(t.match(/WebKit/)&&!t.match(/Edg/)),i._firefoxVersion=i.getVersion(t,/Firefox\/(\d+)\./),i._isFirefox=i._firefoxVersion>0,i._chromeVersion=i.getVersion(t,/Chrom(?:e|ium)\/(\d+)\./),i._isChrome=i._chromeVersion>0,i._isSafari=Boolean(t.match(/Safari/))&&!i._isChrome,i._isMobileSafari=Boolean(t.match(/Mobile.*Safari/)),i._safariVersion=i.getVersion(t,/Version\/(.*).Safari/),i._isAndroid=Boolean(t.match(/Android/g))}static get supportsOverflowClip(){if(this._supportsOverflowClip==null){const e=document.createElement("div");e.style.overflow="clip",e.style.display="none",document.documentElement.appendChild(e),this._supportsOverflowClip=e.ownerDocument.defaultView.getComputedStyle(e).getPropertyValue("overflow")==="clip",e.remove()}return this._supportsOverflowClip}static get supportsSticky(){return!0}static getVersion(e,t){const i=e.match(t);return i?parseFloat(i[1]):0}static get isTouchDevice(){return this._isTouchDevice===void 0&&(this._isTouchDevice=globalThis.matchMedia("(pointer:coarse)").matches),this._isTouchDevice}static get isHoverableDevice(){return this._isHoverableDevice===void 0&&(this._isHoverableDevice=globalThis.matchMedia("(any-hover: hover)").matches),this._isHoverableDevice}static get isBrowserEnv(){return typeof window<"u"}static get isMac(){return this._isMac}static get isWindows(){return this._isWindows}static get isLinux(){return this._isLinux}static get isAndroid(){return this._isAndroid}static get isWebkit(){return this._isWebkit}static get isChrome(){return this._isChrome}static get chromeVersion(){return this._chromeVersion}static get isFirefox(){return this._isFirefox}static get firefoxVersion(){return this._firefoxVersion}static get isSafari(){return this._isSafari}static get safariVersion(){return this._safariVersion}static get isMobileSafari(){return this._isMobileSafari}static get platform(){const e=this;return e._isLinux?"linux":e._isMac?"mac":e._isWindows?"windows":e._isAndroid?"android":e._isMobileSafari?"ios":null}static get supportsPassive(){return!0}static get supportsRandomUUID(){if(this._supportsRandomUUID===void 0)try{this._supportsRandomUUID=Boolean(globalThis.crypto.randomUUID().length>0)}catch{this._supportsRandomUUID=!1}return this._supportsRandomUUID}static get storageAvailable(){let e,t;try{return e=localStorage,t="__storage_test__",e.setItem(t,t),e.removeItem(t),!0}catch(i){return i instanceof DOMException&&(i.code===22||i.code===1014||i.name==="QuotaExceededError"||i.name==="NS_ERROR_DOM_QUOTA_REACHED")&&e.length!==0}}static setLocalStorageItem(e,t){this.storageAvailable&&localStorage.setItem(e,t)}static getLocalStorageItem(e){return this.storageAvailable&&localStorage.getItem(e)}static removeLocalStorageItem(e){this.storageAvailable&&localStorage.removeItem(e)}static searchParam(e,t=null,i=document.location.search){const r=new RegExp(`[?&]${e}=?([^&]*)`),n=i.match(r);return n&&n[1]||t}static getCookie(e){const t=encodeURIComponent(e)+"=",i=document.cookie.split(";");for(let r=0;r<i.length;r++){let n=i[r];for(;n.charAt(0)===" ";)n=n.substring(1,n.length);if(n.indexOf(t)===0)return decodeURIComponent(n.substring(t.length,n.length))}return""}static download(e,t){const i=document.createElement("a");i.download=e,i.href=t||e,i.style.cssText="display:none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}static downloadBlob(e,t){const i=globalThis.URL.createObjectURL(e);this.download(t,i),globalThis.URL.revokeObjectURL(i)}static get queryString(){var e;const t=new URL(globalThis.location.href).searchParams;return(e=Object.fromEntries)===null||e===void 0?void 0:e.call(Object,t.entries())}static copyToClipboard(e){let t=!0;const i=document.createElement("textarea");i.value=e,i.style.height=i.style.width=0,document.body.appendChild(i),i.select();try{document.execCommand("copy")}catch{t=!1}return i.remove(),t}static isBryntumOnline(e){var t;return e=Array.isArray(e)?e:[e],Boolean(/^(www\.)?bryntum\.com/.test(globalThis.location.host)||((t=e)===null||t===void 0?void 0:t.some(i=>this.queryString[i]!=null)))}static get isCSP(){const{bryntum:e,document:t}=globalThis;return e.CSP==null&&(e.CSP=Boolean(t.querySelector('meta[http-equiv="Content-Security-Policy"]'))),e.CSP}static async setupClipboard(){return window.bryntum.clipboard||(window.bryntum.clipboard={hasNativeAccess:!0,async writeText(e,t){if(t&&this.hasNativeAccess)try{await navigator.clipboard.writeText(e)}catch{this.hasNativeAccess=!1}this._content=e},async readText(e){if(e&&this.hasNativeAccess)try{return await navigator.clipboard.readText()}catch{this.hasNativeAccess=!1}return this._content}}),window.bryntum.clipboard}static async writeToClipboard(e,t=!0){return await(await this.setupClipboard()).writeText(e,t)}static async readFromClipboard(e=!0){return await(await this.setupClipboard()).readText(e)}}M(K,"supportsPointerEvents",Boolean(globalThis.PointerEvent||globalThis.MSPointerEvent));M(K,"supportsPointerEventConstructor",typeof PointerEvent<"u");K.isBrowserEnv&&K.cacheFlags();K._$name="BrowserHelper";let zf,Vf,mc,pc;const vc=/([a-z])([A-Z])/g,xv=/[\n\r]/g,Rv=/[.*+?^${}()|[\]\\]/g,Tv=/[&<]/,Mv=/(^[^a-z]+[^\w]+)/gi,kv=/\s+/,Iv=/^[^a-z]+|[^\w:.-]+/gi,Fv=(c,e)=>Vf[e.toLowerCase()]||String.fromCharCode(parseInt(e.substr(2),10)),Av=(c,e)=>zf[e],Lv=(c,e,t)=>`${e}-${t.toLowerCase()}`,Ov=(c,e,t)=>`${e} ${t.toLowerCase()}`,Pv=c=>c?`_x${[...c].map(e=>e.charCodeAt(0).toString(16)).join("")}`:"__blank__",yc={},bc={};class z{static capitalize(e){return e&&e[0].toUpperCase()+e.substr(1)}static uncapitalize(e){return e&&e[0].toLowerCase()+e.substr(1)}static hyphenate(e){const t=yc[e];return t||(yc[e]=e.replace(vc,Lv))}static separate(e){const t=bc[e];return t||(bc[e]=this.capitalize(e.replace(vc,Ov)))}static createId(e){return String(e).replace(Mv,Pv)}static makeValidDomId(e,t=""){return e==null?null:String(e).replace(Iv,t)}static escapeRegExp(e,t){let i=e.replace(Rv,"\\$&");return t!==void 0&&(i=new RegExp(i,t)),i}static decodeHtml(e){return e&&String(e).replace(pc,Fv)}static encodeHtml(e=""){return e&&String(e).replace(mc,Av)}static encodeHtmlBR(e){var t;return(t=z.encodeHtml(e))===null||t===void 0?void 0:t.replace(xv,"<br>")}static isHtml(e){return typeof e=="string"&&Tv.test(e||"")}static initHtmlEntities(e){e=e||{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};const t=Object.keys(e);zf=e,Vf=t.reduce((i,r)=>(i[e[r]]=r,i),{}),mc=new RegExp(`([${t.map(i=>"[-]".includes(i)?"\\"+i:i).join("")}])`,"g"),pc=new RegExp(`(${Object.values(e).join("|")}|&#[0-9]+;)`,"ig")}static safeJsonParse(e){let t=null;try{t=JSON.parse(e)}catch{}return t}static safeJsonStringify(e,t=null,i=null){let r=null;try{r=JSON.stringify(e,t,i)}catch{}return r}static joinPaths(e,t="/"){return e.join(t).replace(new RegExp("\\"+t+"+","g"),t)}static split(e,t=kv){let i=e;return typeof i=="string"&&(i=e.trim(),i=i?i.split(t):[]),i}static xss(e,...t){const i=[];let r=t.length;for(i[r]=e[r];r-- >0;)i[r]=e[r]+z.encodeHtml(t[r]);return i.join("")}static xssBR(e,...t){const i=[];let r=t.length;for(i[r]=e[r];r-- >0;)i[r]=e[r]+z.encodeHtmlBR(t[r]);return i.join("")}static toJavaScriptValue(e,t){const i=U.typeOf(e);if(i==="boolean"||i==="string"||i==="number"||e===null)return z.safeJsonStringify(e);if(e===globalThis)return"window";if(i==="date")return`new Date(${e.getFullYear()}, ${e.getMonth()}, ${e.getDate()}, ${e.getHours()}, ${e.getMinutes()}, ${e.getSeconds()}, ${e.getMilliseconds()})`;if(i==="array")return`[${e.map(r=>z.toJavaScriptValue(r,t))}]`;if(i==="object"||i==="instance")return this.toJavaScriptString(e,t);if(i==="function"){let r=e.toString();return r.match(/^async (\w+?)\(/)?r=r.replace(/^async (\w+?)\(/,"async function("):!r.startsWith("async(")&&r.match(/^(\w+?)\(/)&&(r=r.replace(/^(\w+?)\(/,"function(")),r}if(i==="class")return e.toJavaScriptValue?e.toJavaScriptValue(t):Object.prototype.hasOwnProperty.call(e,"$name")?e.$name:e.name}static toJavaScriptString(e,t={}){var i;const r=(i=t.level)!==null&&i!==void 0?i:0,n=2;return`{
`+Object.keys(e).map(s=>" ".repeat((r+1)*n)+(s.match(/[- *]/)?`"${s}"`:s)+`: ${z.toJavaScriptValue(e[s],F(F({},t),{},{level:r+1}))}`).join(`,
`)+`
`+" ".repeat(r*n)+"}"}static encodeAttributeSelector(e,t){return`[${e}="${String(t).replace(/["\\]/g,"\\$&")}"]`}static generateUUID(){var e;return K.supportsRandomUUID?globalThis.crypto.randomUUID():(e=globalThis.crypto)!==null&&e!==void 0&&e.getRandomValues?([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t=>(t^globalThis.crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)):`${Date.now()}-${++z.fakeNodeUUIDIndex}`}}M(z,"fakeNodeUUIDIndex",0);z.initHtmlEntities();z._$name="StringHelper";const{hasOwnProperty:$v,toString:_v}=Object.prototype,{isFrozen:Cc}=Object,Hv=/\s*<\s*/,Nv=/\s*>\s*/,wc={},Sc={},Dc=Object.freeze({});class U{static assign(e,...t){for(let i,r,n=0;n<t.length;n++)if(i=t[n],i)for(r in i)e[r]=i[r];return e}static assignIf(e,...t){for(let i,r,n=0;n<t.length;n++)if(i=t[n],i)for(r in i)(!(r in e)||e[r]===void 0)&&(e[r]=i[r]);return e}static blend(e,t,i){i=i||wc,e=e||{};const{clone:r=U.clone,merge:n=U.blend}=i;if(Array.isArray(t)){if(t.length>1)return t.forEach(s=>{e=U.blend(e,s,i)}),e;t=t[0]}if(t){let s,a,o;for(a in t)o=t[a],o&&U.isObject(o)&&(s=e[a],i.key=a,s&&U.isObject(s)?(Cc(s)&&(e[a]=s=r(s,i)),o=n(s,o,i)):o=Cc(o)?o:r(o,i)),e[a]=o}return e}static clone(e,t){let i=e,r;if(e&&typeof e=="object")if(t&&typeof t=="object"&&t&&(t=null),U.isObject(e))if(e.skipClone)i=e;else{i={};for(r in e)i[r]=U.clone(e[r])}else if(Array.isArray(e))for(i=[],r=e.length;r-- >0;)i[r]=U.clone(e[r]);else U.isDate(e)?i=new Date(e.getTime()):t&&(i=t(e));return i}static createTruthyKeys(e){const t=z.split(e),i=t&&{};if(t)for(const r of t)r&&(i[r]=!0);return i}static getPath(e,t){return t.split(".").reduce((i,r)=>(i||Dc)[r],e)}static getPathDefault(e,t,i){const r=Array.isArray(t)?t:typeof t=="string"?t.split("."):[t],n=r.length-1;return r.reduce((s,a,o)=>(i&&!(a in s)&&(s[a]=o===n?i:{}),(s||Dc)[a]),e)}static hasPath(e,t){return t.split(".").every(i=>i in e?(e=e[i],!0):!1)}static getTruthyKeys(e){const t=[];for(const i in e)e[i]&&t.push(i);return t}static getTruthyValues(e){const t=[];for(const i in e)e[i]&&t.push(e[i]);return t}static isClass(e){var t;return typeof e=="function"&&((t=e.prototype)===null||t===void 0?void 0:t.constructor)===e}static isDate(e){return Boolean(e?.getUTCDate)&&U.typeOf(e)==="date"}static isPromise(e){if(Promise&&Promise.resolve)return Promise.resolve(e)===e||typeof e?.then=="function";throw new Error("Promise not supported in your environment")}static isEmpty(e){if(e&&typeof e=="object")for(const t in e)return!1;return!0}static isObject(e){const t=e?.constructor;return Boolean(t?t===Object||t.getPrototypeOf&&t.prototype&&!Object.getPrototypeOf(t.prototype):e&&typeof e=="object")}static isInstantiated(e){return e?typeof e=="object"&&!U.isObject(e):!1}static merge(e,...t){return U.blend(e,t)}static mergeItems(e,t,i){i=i||wc;let r,n,s,a,o,l,d;const{merge:u=U.blend}=i;if(e=e||{},Array.isArray(t))t.forEach(f=>{e=U.mergeItems(e,f,i)});else if(t)for(o in t)if(d=t[o],r=null,o.includes(">")?([o,r]=o.split(Nv),n=0):o.includes("<")&&([r,o]=o.split(Hv),n=1),o in e)d&&e[o]&&u&&(i.key=o,d=u(e[o],d,i)),e[o]=d;else if(r){if(!a){a=new Map,s=0;for(const f in e)a.set(f,s++)}if(s=a.get(r),e[o]=d,s==null&&n)s=a.size;else{l=l||[],s=(s||0)+n;for(const f of a){const[g,m]=f;s<=m&&(l&&(l[a.size-m-1]=g),a.set(g,m+1))}if(l)for(;l.length;){const f=l.pop(),g=e[f];delete e[f],e[f]=g}}a.set(o,s)}else{var h;e[o]=d,(h=a)===null||h===void 0||h.set(o,a.size)}return e}static setPath(e,t,i){return t.split(".").reduce((r,n,s,a)=>s===a.length-1?r[n]=i:(r[n]instanceof Object||(r[n]={}),r[n]),e),e}static typeOf(e){let t,i;return e===null?i="null":e!==e?i="nan":(i=typeof e,i==="object"?e.isBase?i="instance":Array.isArray(e)?i="array":(i=Sc[t=_v.call(e)])||(Sc[t]=i=t.slice(8,-1).toLowerCase()):i==="function"&&e.isBase&&(i="class")),i}}Object.defineProperty(U,"hasOwn",{value:Object.hasOwn||((c,e)=>$v.call(c,e))});U._$name="Objects";class ae{static setVersion(e,t){e=e.toLowerCase(),Et[e]={version:t,isNewerThan(n){return ae.semanticCompareVersion(n,t,"<")},isOlderThan(n){return ae.semanticCompareVersion(n,t,">")}};let i="";i=Sv;const r=`${i}.${e}${t.replace(/\./g,"-")}`;if(K.isBrowserEnv&&!globalThis.bryntum.silenceBundleException)if(globalThis.bryntum[r]===!0)if(this.isTestEnv)globalThis.BUNDLE_EXCEPTION=!0;else{let n=i||e;n==="core"&&(n="grid");let s=z.capitalize(n);throw n==="schedulerpro"&&(s="SchedulerPro"),new Error(`The Bryntum ${s} bundle was loaded multiple times by the application.

Common reasons you are getting this error includes:

* Imports point to different types of the bundle (e.g. *.module.js and *.umd.js)
* Imports point to both sources and bundle
* Imports do not use the shortest relative path, JS treats them as different files
* Cache busters differ between imports, JS treats ${n}.module.js?1 and ${n}.module.js?2 as different files
* Imports missing file type, verify they all end in .js

See https://bryntum.com/products/${n}/docs/guide/${s}/gettingstarted/es6bundle#troubleshooting for more information

`)}else globalThis.bryntum[r]=!0}static getVersion(e){if(e=e.toLowerCase(),!Et[e])throw new Error("No version specified! Please check that you import VersionHelper correctly into the class from where you call `deprecate` function.");return Et[e].version}static semanticCompareVersion(e,t,i="="){e=e||"",t=t||"";const r=e.split(/[-.]/),n=t.split(/[-.]/),s=i.includes("<"),a=(l,d)=>{const u=["rc","beta","alpha"],h=l.map(f=>{if(u.includes(f))return-u.indexOf(f)-2;const g=Number.parseInt(f);return Number.isNaN(g)?-u.length:g});for(;h.length<d;)h.push(-1);return h},o=()=>{const l=Math.max(r.length,n.length),d=a(r,l),u=a(n,l);for(let h=0;h<l;h++)if(d[h]!==u[h])return s?d[h]<u[h]:d[h]>u[h];return!0};switch(i){case"=":return e===t;case"<=":case">=":return e===t||o();case"<":case">":return e!==t&&o()}return!1}static checkVersion(e,t,i){return ae.semanticCompareVersion(Et.getVersion(e),t,i)}static deprecate(e,t,i){if(Et.checkVersion(e,t,"<"))console.warn(`Deprecation warning: You are using a deprecated API which will change in v${t}. ${i}`);else throw new Error(`Deprecated API use. ${i}`)}static get isTestEnv(){var e;const t=Boolean((e=globalThis.bryntum)===null||e===void 0?void 0:e.isTestEnv);try{var i,r;return t||Boolean((i=globalThis.parent)===null||i===void 0||(r=i.bryntum)===null||r===void 0?void 0:r.isTestEnv)}catch{return t}}static get isDebug(){return!1}}const Et=ae;K.isBrowserEnv&&(Et.isTestEnv&&(K._isHoverableDevice=!0),globalThis.bryntum=Object.assign(globalThis.bryntum||{},{getVersion:Et.getVersion.bind(Et),checkVersion:Et.checkVersion.bind(Et),deprecate:Et.deprecate.bind(Et),license:"4d9731b5-52a4-11ec-a6ac-d094663d5c88"}));ae._$name="VersionHelper";const{defineProperty:Is,getOwnPropertyDescriptor:Ec}=Reflect,{hasOwnProperty:xc,toString:Il}=Object.prototype,Fl=Symbol("instanceProperties"),jf=Symbol("configuring"),pr=Symbol("lazyConfigValues"),Rc=Il.call(new Date),Bv=/\s+/,zv=(c,e)=>(c[e]=1,c);class pe{static get(e,t){const{cache:i}=this,r=i[e]||(i[e]=new pe(e));let n=r,s;return t&&(s=pe.makeCacheKey(e,t),(n=s&&i[s])||(n=r.extend(t),s&&(i[s]=n))),n}constructor(e){const t=this,i=e[0].toUpperCase()+e.substr(1);t.base=t,t.name=e,t.field="_"+e,t.capName=i,t.changer="change"+i,t.initializing="initializing"+i,t.updater="update"+i}get descriptor(){let e=this._descriptor;return(!e||!xc.call(this,"_descriptor"))&&(this._descriptor=e=this.makeDescriptor()),e}get initDescriptor(){let e=this._initDescriptor;return(!e||!xc.call(this,"_initDescriptor"))&&(this._initDescriptor=e=this.makeInitter()),e}equal(e,t){return e===t}extend(e){const t=Object.assign(Object.create(this),e),{equal:i,merge:r}=e,{equalityMethods:n}=pe;return typeof i=="string"&&(i.endsWith("[]")?t.equal=pe.makeArrayEquals(n[i.substr(0,i.length-2)]):t.equal=n[i]),typeof r=="string"&&(t.merge=pe.mergeMethods[r]),t}define(e){const t=Ec(e,this.name);let i=this.descriptor;t&&t.get&&(i=Object.assign({},i),i.get=t.get),Is(e,this.name,i)}defineInitter(e,t){const{name:i}=this,r=e[Fl];let n,s;!r[i]&&(s=Ec(e,i))&&!("value"in s)&&(r[i]=s),Is(e,i,this.initDescriptor),this.lazy&&(n=e[pr]||(e[pr]=new Map),n.set(i,t))}static makeArrayEquals(e){return(t,i)=>{let r,n=t&&i&&t.length===(r=i.length);if(n&&Array.isArray(t)&&Array.isArray(i))if(e)for(;n&&r-- >0;)n=e(t[r],i[r]);else for(;n&&r-- >0;)n=t[r]===i[r];else n=e?e(t,i):t===i;return n}}static makeCacheKey(e,t){const i=Object.keys(t).sort();for(let r,n,s,a=i.length;a-- >0;)if(s=t[r=i[a]],s==null&&s===!1)i.splice(a,1);else{if(n=typeof s,n==="function")return null;n==="string"?i[a]=`${r}:"${s}"`:n==="number"&&(i[a]=`${r}:${s}`)}return i.length?`${e}>${i.join("|")}`:e}makeDescriptor(){const e=this,{base:t,field:i,changer:r,updater:n,name:s}=e;return t!==e&&t.equal===e.equal?t.descriptor:{get(){var a;return(a=this.configObserver)===null||a===void 0||a.get(s,this),this[i]},set(a){const o=this;let l=o[i],d,u;if(typeof a=="string"){let g=a;if(a.startsWith("up.")){var h;g=(h=o.owner)===null||h===void 0?void 0:h.resolveProperty(a.substr(3))}else a.startsWith("this.")&&(g=o.resolveProperty(a.substr(5)));g!==void 0&&typeof g!="function"&&(a=g)}if(o[r]&&(d=(u=o[r](a,l))===void 0,d||(a=u,l=o[i])),!d&&!(e.equal===Wf?l===a:e.equal(l,a))){var f;o[i]=a,d=!0,(f=o[n])===null||f===void 0||f.call(o,a,l)}d&&!o.onConfigChange.$nullFn&&o.onConfigChange({name:s,value:a,was:l,config:e})}}}makeInitter(){const e=this;return e!==e.base?e.lazy?e.makeLazyInitter():e.base.initDescriptor:e.makeBasicInitter()}makeBasicInitter(){const e=this,{initializing:t,name:i}=e;return{configurable:!0,get(){const r=this;return e.removeInitter(r),r[t]=!0,r[i]=r[jf][i],r[t]=!1,r.configDone[i]=!0,r[i]},set(r){e.removeInitter(this),this.configDone[i]=!0,this[i]=r}}}makeLazyInitter(){const e=this,{initializing:t,name:i}=e;return{configurable:!0,get(){const r=this,n=r[pr].get(i);return e.removeInitter(r),r.isDestroying||(r[t]=!0,r[i]=n,r[t]=!1),r[i]},set(r){e.removeInitter(this),this[i]=r}}}removeInitter(e){const{name:t}=this,i=e[Fl][t],r=e[pr];i?Is(e,t,i):delete e[t],r!=null&&r.delete(t)&&!r.size&&delete e[pr]}setDefault(e,t){Is(e.prototype,this.field,{configurable:!0,writable:!0,value:t})}merge(e,t){if(t&&e&&U.isObject(e)){if(t.isBase)return t.setConfig(e);U.isObject(t)&&(e=U.merge(U.clone(t),e))}return e}}const{prototype:Tn}=pe,{equal:Wf}=Tn;pe.symbols={configuring:jf,instanceProperties:Fl,lazyConfigs:pr};pe.cache=Object.create(null);pe.equalityMethods={array:pe.makeArrayEquals(),date(c,e){return c===e?!0:c&&e&&Il.call(c)===Rc&&Il.call(e)===Rc?c.getTime()===e.getTime():!1},strict:pe.equal=Wf};pe.mergeMethods={distinct(c,e){let t=e?e.slice():[];if(c!=null)if(U.isObject(c))if(e===void 0)t=c;else{let i,r;for(i in c)r=t.indexOf(i),c[i]?r<0&&t.push(i):r>-1&&t.splice(r,1)}else Array.isArray(c)?c.forEach(i=>!t.includes(i)&&t.push(i)):t.includes(c)||t.push(c);return t},merge:pe.merge=Tn.merge,classList(c,e){if(typeof c=="string"){if(!c.length)return e;c=c.split(Bv)}return Array.isArray(c)&&(c=c.reduce(zv,{})),pe.merge(c,e)},objects(c,e){return c===!0?e||{}:pe.merge(c,e)},replace(c){return c},items(c,e,t,i){return i?U.mergeItems(e,c,{merge:(r,n)=>Tn.merge(n,r)}):Tn.merge(c,e)}};Object.assign(Tn,{_descriptor:null,_initDescriptor:null,lazy:!1,nullify:!1,render:!1});pe._$name="Config";class Vv{constructor(e){e&&Object.assign(this,e)}getInherited(e,t=!0){let i=this[e];if(!(e in this)){var r;i=(r=this.super)===null||r===void 0?void 0:r.getInherited(e,t),(i||t)&&(this[e]=i=Object.create(i||null))}return i}}const{getPrototypeOf:Tc}=Object,{hasOwn:Tt}=U,{defineProperty:Mc}=Reflect,ra=Symbol("classMetaData"),kc=Symbol("mixinTag"),Eo=Symbol("originalConfig"),Jt=pe.symbols.configuring,jv=pe.symbols.instanceProperties,an=pe.symbols.lazyConfigs,Wv={merge:"replace",simple:!0},ga=()=>{},Uf=c=>new Vv(c),Ic={},Uv=Object.freeze({}),Fc=Object.freeze([]);class P{static get isBase(){return!0}get isBase(){return!0}static get declarable(){return["declarable","configurable","defaultConfig","properties","prototypeProperties"]}constructor(...e){const t=this,i=t.constructor;t.$meta.class!==i&&ga(i.$meta),t.construct(...e),t.afterConstruct(),t.isConstructing=!1}static new(...e){return e=e.filter(t=>t),new this(e.length>1?this.mergeConfigs(...e):e[0])}construct(...e){e[0]!==null&&this.configure(...e),this.afterConfigure()}static destroy(...e){const t=i=>{i!=null&&i.destroy?i.destroy():Array.isArray(i)&&i.forEach(t)};t(e)}destroy(){const e=this,{id:t}=e;e.isDestroying=!0,e.destroy=ga,e.doDestroy(),Object.setPrototypeOf(e,null);for(const i in e)i!=="destroy"&&i!=="isDestroying"&&delete e[i];delete e[Eo],e.isDestroyed=!0,e.id=t}_thisIsAUsedExpression(e){}static get $$name(){return Tt(this,"$name")&&this.$name||Tt(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}startConfigure(e){}finishConfigure(e){}afterConfigure(){}afterConstruct(){}callback(e,t,i=Fc){const{handler:r,thisObj:n}=this.resolveCallback(e,t==="this"?this:t)||Uv;return r?.apply(n,i)}resolveProperty(e){let t=this;for(;t;){if(U.hasPath(t,e))return U.getPath(t,e);t=t.owner}}resolveCallback(e,t=this,i=!0){var r;if((r=e)!==null&&r!==void 0&&r.substring){if(e.endsWith("?")&&(i=!1,e=e.substring(0,e.length-1)),e.startsWith("up.")){for(e=e.substring(3),t=this.owner;t&&!t[e];t=t.owner);if(!t)return}else e.startsWith("this.")&&(e=e.substring(5),t=this);if(!t||!(t instanceof Object))return;e=t[e]}if(typeof e=="function")return{handler:e,thisObj:t};if(i)throw new Error(`No method named ${e} on ${t.$$name||"thisObj object"}`)}bindCallback(e,t=this){if(e){const{handler:i,thisObj:r}=this.resolveCallback(e,t);if(i)return i.bind(r)}}delay(e,t,i=e.name||e){return e=this.setTimeout?e:e.bind(this),(this.setTimeout?this:globalThis)[typeof t=="number"?"setTimeout":"requestAnimationFrame"](e,t,i)}doDestroy(){const e=this,{nullify:t}=e.$meta;if(t)for(let i=0;i<t.length;++i)e[t[i].field]!=null&&(e[t[i].name]=null)}destroyProperties(...e){const t=this;let i,r;for(i of e)if(i in t&&(!t[Jt]||!t[Jt][i])){var n;r=t[i],(n=r)!==null&&n!==void 0&&n.destroy&&r.destroy(),delete t[i]}}configure(e={}){const t=this,i=t.$meta,{beforeConfigure:r}=e,n=i.configs,s=t.getDefaultConfiguration();let a,o,l;t.initialConfig=e,t.isConfiguring=!0,Object.assign(t,t.getProperties());for(o in e)l=e[o],a=n[o],s[o]=a?a.merge(l,s[o],null,i):l;r&&(delete s.beforeConfigure,r(t,s)),t.setConfig(t[Eo]=s,!0),t.isConfiguring=!1}getConfig(e){return this[e]}setConfig(e,t){const i=this,r=i[Jt],n=r?i.configDone:i.configDone={},s=i.$meta.configs;let a,o;i[jv]={},i[Jt]=r?Object.setPrototypeOf(Object.assign({},e),r):e;for(o in e)e[o]!=null||Tt(e,o)?(a=s[o]||pe.get(o),a.defineInitter(i,e[o]),t||(n[o]=!1)):n[o]=!0;t&&i.startConfigure(e);for(o in e){var l;!n[o]&&!((l=s[o])!==null&&l!==void 0&&l.lazy)&&(i[o]=e[o])}return r?i[Jt]=r:delete i[Jt],t&&i.finishConfigure(e),i}hasConfig(e){var t;const i=this,r=i[Jt];return Boolean(i["_"+e]!=null||((t=i[an])===null||t===void 0?void 0:t.get(e))!=null||!i.configDone[e]&&r&&(r[e]!=null||Tt(r,e)))}peekConfig(e){const t=this,i=t[an],r=t[Jt];if(i!=null&&i.has(e))return i.get(e);if(t.configDone[e])return t[e];if(r?.[e]!=null||Tt(r,e))return r[e]}triggerConfig(e){const t=this,{configDone:i}=t,r=t[an],n=t[Jt],s=r!=null&&r.has(e)||n&&(n[e]!=null||Tt(n,e))?!i[e]:null;return s&&t.getConfig(e),s}triggerConfigs(e){const t=this,i=t.$meta.configs,r=t[an],n=r?[...r.keys()].filter(s=>i[s].lazy===e):Fc;for(const s of n)t.triggerConfig(s);return n.length?n:null}onConfigChange(){}get config(){const e={},t=this[Eo];for(const i in t)e[i]=t[i];return e}static processConfigValue(e,t){if(e===globalThis)return globalThis;if(Array.isArray(e))return e.map(i=>P.processConfigValue(i,t));if(e instanceof P)return t.visited.has(e)?void 0:e.getCurrentConfig(t);if(e instanceof HTMLElement||e instanceof DocumentFragment)return null;if(U.isObject(e)){const i={};for(const r in e)i[r]=P.processConfigValue(e[r],t);return i}return e}getConfigValue(e,t){var i;const r=this,n=r[an];if(!((i=r.$meta.configs[e])!==null&&i!==void 0&&i.lazy))return P.processConfigValue(r[e],t);if(n!=null&&n.has(e))return P.processConfigValue(n.get(e),t)}preProcessCurrentConfigs(){}getCurrentConfig(e={}){const t=this,i=e.configs==="all"?t.config:U.clone(t.initialConfig),r=e.visited||(e.visited=new Set),n=e.depth||(e.depth=0),s={};if(!r.has(t)){r.add(t),this.preProcessCurrentConfigs(i);for(const a in i){const o=t.getConfigValue(a,F(F({},e),{},{depth:n+1}));o!==void 0&&(s[a]=o)}return s}}getConfigString(e={}){return z.toJavaScriptString(this.getCurrentConfig(e))}getTestCase(e={}){const t=this.isGantt?"Gantt":this.isSchedulerPro?"SchedulerPro":this.isCalendar?"Calendar":this.isScheduler?"Scheduler":this.isGrid?"Grid":this.isTaskBoard?"TaskBoard":null;if(t){const i=t.toLowerCase(),r=`../../build/${i}.module.js`;let n,s;e.import==="static"?(n=`import * as module from "${r}";Object.assign(window, module);`,s=""):(n=`import("${r}").then(module => { Object.assign(window, module);
`,s="});");const a=ae.getVersion(i);return a&&(n+=`
console.log('${t} ${a}');
`),`${n}      
const ${i} = new ${t}(${this.getConfigString(e)});
${s}`}}downloadTestCase(e={}){e.output="return";const t=this.getTestCase(e);K.download("app.js","data:application/javascript;charset=utf-8,"+escape(t))}static initClass(){return this.$meta.class}static get $meta(){const e=this;let t=e[ra];return Tt(e,ra)||(e[ra]=t=Uf(),t.class=e,e.setupClass(t)),t}static onClassMixedIn(){}static mergeConfigs(e,...t){const i=this.$meta.configs,r=U.clone(e)||{};let n,s,a,o;for(s=0;s<t.length;++s)if(n=t[s],n)for(a in n)o=n[a],i[a]?o=i[a].merge(o,r[a]):r[a]&&o&&(o=pe.merge(o,r[a])),r[a]=o;return r}static mixin(...e){let t=this,i;for(i=0;i<e.length;++i){const r=e[i],n=r[kc]||(r[kc]=Symbol("mixinTag"));t[n]||(t=r(t),t[n]=!0,Tt(t,"onClassMixedIn")&&t.onClassMixedIn())}return t}static setupClass(e){var t;const i=e.class,r=Tc(i).$meta,n=i.$$name,s=r.names,a=i.prototype;if(Mc(a,"$meta",{value:e}),Object.assign(e,{super:r,config:Object.create(r.config),configs:Object.create(r.configs),declarables:r.declarables,forkConfigs:r.forkConfigs,hierarchy:Object.freeze([...r.hierarchy,i]),names:s.includes(n)?s:Object.freeze([...s,n]),properties:r.properties,nullify:(t=r.nullify)===null||t===void 0?void 0:t.slice()}),s!==e.names){const o=`is${n}`,l=d=>{Tt(d,o)||Mc(d,o,{get(){return Tt(typeof d=="object"?d.constructor:d,"$name")||console.warn(`$name static property or getter required for class ${n} to provide class name for minified sources.`+(ae.isTestEnv?"":`
https://bryntum.com/products/grid/docs/api/Core/widget/Widget#property-$name-static`)),!0}})};l(a),l(i)}for(let o,l,d=0;d<e.declarables.length;++d)o=e.declarables[d],Tt(i,o)&&(l=Ic[o]||(Ic[o]=`setup${z.capitalize(o)}`),i[l](i,e))}static setupConfigs(e,t,i){const r=e.config,n=e.configs,s=e.class,a=e.super;let{nullify:o}=e,l,d,u,h,f,g;for(const m in t)f=t[m],i?(l=n[m])?f=l.merge(f,r[m],e,a):l=pe.get(m,Wv):(d=u=h=void 0,f&&typeof f=="object"&&"$config"in f&&(u=f.$config,u&&!U.isObject(u)&&(u=U.createTruthyKeys(u)),h="default"in f,d=h?f.default:d,f=f.value),(l=n[m])?(g=l.nullify,u&&(l=l.extend(u)),f=l.merge(f,r[m],e,a)):(l=pe.get(m,u),l.define(s.prototype),h=!(l.field in s.prototype),g=!1),h&&l.setDefault(s,d),l.nullify&&!g&&(o||(o=e.nullify||(e.nullify=[]))).push(l)),f&&(U.isObject(f)||Array.isArray(f))&&!Object.isFrozen(f)&&(e.forkConfigs=!0),n[m]=l,r[m]=f}static setupConfigurable(e,t){e.setupConfigs(t,e.configurable,!1)}static setupDefaultConfig(e,t){e.setupConfigs(t,e.defaultConfig,!0)}static setupDeclarable(e,t){const i=e.declarable;let r=t.declarables,n,s;for(s=0;s<i.length;++s)r.includes(i[s])||(n||(t.declarables=n=r=r.slice()),r.push(i[s]))}static setupProperties(e,t){t.properties=t.super.properties.slice(),t.properties.push(e),Object.freeze(t.properties)}static setupPrototypeProperties(e){Object.assign(e.prototype,e.prototypeProperties)}getDefaultConfiguration(){return this.constructor.getDefaultConfiguration()}static getDefaultConfiguration(){const e=this.$meta,t=e.forkConfigs?P.fork(e.config):Object.create(e.config);if(ae.isTestEnv&&K.isBrowserEnv&&t.testConfig&&globalThis.__applyTestConfigs)for(const i in t.testConfig)t[i]=t.testConfig[i];return t}static fork(e){let t=e,i,r;if(e&&U.isObject(e)&&!Object.isFrozen(e)){t=Object.create(e);for(i in e)r=e[i],r&&(U.isObject(r)?t[i]=P.fork(r):Array.isArray(r)&&(t[i]=r.slice()))}return t}getProperties(){const e=this.$meta.properties,t={};for(let i=0;i<e.length;i++)Object.assign(t,e[i].properties);return t}static get superclass(){return Tc(this)}classHierarchy(e){const t=this.$meta.hierarchy,i=e?t.indexOf(e):0;return i>0?t.slice(i):t}static isOfTypeName(e){return this.$meta.names.includes(e)}detachListeners(e){var t;let i=this.$detachers;if(i=(t=i)===null||t===void 0?void 0:t[e],i)for(;i.length;)i.pop()()}trackDetacher(e,t){const i=this.$detachers||(this.$detachers={});(i[e]||(i[e]=[])).push(t)}untrackDetachers(e){const t=this.$detachers;if(t)for(const i in t){const r=t[i];for(let n=r.length;n-- >0;)r[n].eventer===e&&r.splice(n,1)}}}const Xl=P.prototype;Xl.onConfigChange.$nullFn=ga.$nullFn=!0;P[ra]=Xl.$meta=Uf({class:P,config:Object.freeze({}),configs:Object.create(null),declarables:P.declarable,forkConfigs:!1,hierarchy:Object.freeze([P]),names:Object.freeze(["Base"]),nullify:null,properties:Object.freeze([]),super:null});Object.assign(Xl,{$detachers:null,configObserver:null,isConstructing:!0,isDestroyed:!1,isDestroying:!1});P.emptyFn=ga;ae.setVersion("core","5.3.0");P._$name="Base";class W{static clean(e){return e.reduce((t,i)=>(i!=null&&!(Array.isArray(i)&&i.length===0)&&i!==""&&t.push(i),t),[])}static from(e,t,i){const r=[];if(e)for(const n of e)(!t||t(n))&&r.push(i?i(n):n);return r}static remove(e,...t){let i,r,n=!1;for(let s=0;s<t.length;s++)r=t[s],(i=e.indexOf(r))!==-1&&(e.splice(i,1),n=!0);return n}static findInsertionIndex(e,t,i=this.lexicalCompare,r){const n=t.length;let s,a;return r<n&&(s=r>0?i(t[r-1],e):0,a=r<n-1?i(e,t[r]):0,s<1&&a<1)?r:this.binarySearch(t,e,i)}static findLast(e,t,i){for(let{length:r}=e,n=r-1;n>=0;n--)if(t.call(i,e[n],n,e))return e[n]}static binarySearch(e,t,i=0,r=e.length,n=this.lexicalCompare){const s=e.length;let a,o;for(i instanceof Function?(n=i,i=0):r instanceof Function&&(n=r,r=s),--r;i<=r;)a=i+r>>1,o=n(t,e[a]),o>=0?i=a+1:o<0&&(r=a-1);return i}magnitudeCompare(e,t){return e<t?-1:e>t?1:0}lexicalCompare(e,t){return e=String(e),t=String(t),e<t?-1:e>t?1:0}static fill(e,t={},i=null){const r=[],n=Array.isArray(t)?t:[t];for(let s=0;s<e;s++)for(const a of n){const o=Object.assign({},a);i&&i(o,s),r.push(o)}return r}static populate(e,t,i=!1){const r=[];for(let n=0;n<e;n++)r.push(t(n+(i?1:0)));return r}static include(e,...t){for(const i of t)e.includes(i)||e.push(i)}static unique(e){return[...new Set(e)]}static allowNegative(e){return new Proxy(e,{get(t,i,r){if(typeof i!="string")return Reflect.get(t,i,r);const n=Number(i);return Number.isNaN(n)?Reflect.get(t,i,r):t[n<0?t.length+n:n]},set(t,i,r,n){if(typeof i!="string")return Reflect.set(t,i,r,n);const s=Number(i);return Number.isNaN(s)?Reflect.set(t,i,r,n):(t[s<0?t.length+s:s]=r,!0)}})}static delta(e,t,i=!1){if(!t)return i?{toAdd:e,toRemove:[],toKeep:[]}:{onlyInA:e,onlyInB:[],inBoth:[]};const r=[],n=[],s=new Set,a=new Set(t);for(let o=0;o<e.length;o++){const l=e[o];a.has(l)?s.add(l):r.push(l)}for(let o=0;o<t.length;o++){const l=t[o];s.has(l)||n.push(l)}return i?{toAdd:r,toRemove:n,toKeep:s}:{onlyInA:r,onlyInB:n,inBoth:[...s]}}static asArray(e){return e==null?e:e instanceof Set?Array.from(e):Array.isArray(e)?e:[e]}static identity(e){return e}static keyBy(e,t,i=W.identity){const r=typeof t=="string"?s=>s?.[t]:t,n=typeof i=="string"?s=>s?.[i]:i;return e.reduce((s,a)=>(s[r(a)]=n(a),s),{})}}W._$name="ArrayHelper";const Ac=/,\s*/,xo=Symbol("decompiled"),Yv=/^\s*(async\s+)?([a-z_]\w*)\s*=>([\s\S]+)$/i,Gv=/^\s*(async\s*)?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)\s+=>([\s\S]+)$/i,qv=/^(\s*async)?(?:\s*function)?(?:\s*([a-z_]\w*))?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)([\s\S]+)$/i,{hasOwnProperty:Kv}=Object.prototype;class ve{static after(e,t,i,r,n){const s=typeof i=="string",a=n?.return!==!1,o=(...l)=>{const d=o.$nextHook.call(e,...l),u=r!=null&&r.isDestroyed?void 0:a?s?r[i](d,...l):i.call(r,d,...l):s?r[i](...l):i.call(r,...l);return u===void 0?d:u};return ve.hookMethod(e,t,o)}static before(e,t,i,r){const n=typeof i=="string",s=(...a)=>{const o=r!=null&&r.isDestroyed?0:n?r[i](...a):i.call(r,...a);return o===!1?o:s.$nextHook.call(e,...a)};return ve.hookMethod(e,t,s)}static curry(e){return function t(...i){return i.length>=e.length?e.apply(this,i):function(...r){return t.apply(this,i.concat(r))}}}static bindAll(e){for(const t in e)typeof e[t]=="function"&&(e[t]=e[t].bind(e))}static createInterceptor(e,t,i){return function(...r){const n=i||this;return t.call(n,...r)!==!1?e.call(n,...r):!1}}static createSequence(e,t,i){return(...r)=>{const n=e.call(i,...r),s=t.call(i,...r);return s===void 0?n:s}}static createThrottled(e,t,i,r,n){let s=-Number.MAX_VALUE,a,o;const l=()=>{o=0,s=performance.now(),a.push.apply(a,r),e.apply(i,a)},d=function(...u){const h=performance.now()-s;a=u,h>=t?(clearTimeout(o),l()):(o||(o=setTimeout(l,t-h)),n&&(a.push.apply(a,r),n.apply(i,a)))};return d.cancel=()=>clearTimeout(o),d}static createBuffered(e,t,i,r){let n,s;const a=()=>{s=0,o.isPending=!1,n.push.apply(n,r),e.apply(i,n)},o=function(...l){n=l,s&&clearTimeout(s),o.isPending=!0,s=setTimeout(a,t)};return o.cancel=()=>{o.isPending=!1,clearTimeout(s)},o}static decompile(e){if(!(xo in e)){var t,i;const r=e.toString();let n=Yv.exec(r),s,a,o,l,d;n?(s=[n[2]],a=n[3]):(n=Gv.exec(r))?(d=n[2].trim(),s=d?d.split(Ac):[],a=n[3]):(n=qv.exec(r))&&(o=n[2],d=n[3].trim(),s=d?d.split(Ac):[],a=n[4]),a=(t=a)===null||t===void 0?void 0:t.trim(),e[xo]=l=n&&{args:s,async:Boolean(n[1]),body:(i=a)!==null&&i!==void 0&&i.startsWith("{")?a.substring(1,a.length-1).trim():a},o&&(l.name=o)}return e[xo]}static hookMethod(e,t,i){return i.$nextHook=e[t],e[t]=i,()=>{if(Kv.call(e,t)){let s=e[t],a;if(s===i){var r;((r=Object.getPrototypeOf(e))===null||r===void 0?void 0:r[t])===i.$nextHook?delete e[t]:e[t]=i.$nextHook}else for(;a=(n=s)===null||n===void 0?void 0:n.$nextHook;s=a){var n;if(a===i){s.$nextHook=i.$nextHook;break}}}}}static noThrow(e,t,i){const r=e[t];e[t]=(...n)=>{try{return r.apply(e,n)}catch(s){return i?.(s)}}}static returnTrue(){return!0}static animate(e,t,i,r="linear"){let n=!1;const s=new Promise(a=>{const o=performance.now(),l=()=>{const d=Math.min((performance.now()-o)/e,1),u=i&&i.setTimeout?i:globalThis;n||t.call(i,this.easingFunctions[r](d))===!1&&a(),n||d===1?u.requestAnimationFrame(()=>a()):u.requestAnimationFrame(l)};l()});return s.cancel=()=>(n=!0,!1),s}}const Ce=.5,li=1.70158,St=7.5625,Fs=1.525,Ro=2/2.75,To=2.25/2.75,Mo=1/2.75,ko=1.5/2.75,Io=2.5/2.75,Fo=2.625/2.75,Ao=.75,Lo=.9375,Oo=.984375,Xv=1.70158,Zv=1.70158;ve.easingFunctions={linear:c=>c,easeInQuad:c=>Math.pow(c,2),easeOutQuad:c=>-(Math.pow(c-1,2)-1),easeInOutQuad:c=>(c/=Ce)<1?Ce*Math.pow(c,2):-Ce*((c-=2)*c-2),easeInCubic:c=>Math.pow(c,3),easeOutCubic:c=>Math.pow(c-1,3)+1,easeInOutCubic:c=>(c/=Ce)<1?Ce*Math.pow(c,3):Ce*(Math.pow(c-2,3)+2),easeInQuart:c=>Math.pow(c,4),easeOutQuart:c=>-(Math.pow(c-1,4)-1),easeInOutQuart:c=>(c/=Ce)<1?Ce*Math.pow(c,4):-Ce*((c-=2)*Math.pow(c,3)-2),easeInQuint:c=>Math.pow(c,5),easeOutQuint:c=>Math.pow(c-1,5)+1,easeInOutQuint:c=>(c/=Ce)<1?Ce*Math.pow(c,5):Ce*(Math.pow(c-2,5)+2),easeInSine:c=>-Math.cos(c*(Math.PI/2))+1,easeOutSine:c=>Math.sin(c*(Math.PI/2)),easeInOutSine:c=>-Ce*(Math.cos(Math.PI*c)-1),easeInExpo:c=>c===0?0:Math.pow(2,10*(c-1)),easeOutExpo:c=>c===1?1:-Math.pow(2,-10*c)+1,easeInOutExpo:c=>c===0?0:c===1?1:(c/=Ce)<1?Ce*Math.pow(2,10*(c-1)):Ce*(-Math.pow(2,-10*--c)+2),easeInCirc:c=>-(Math.sqrt(1-c*c)-1),easeOutCirc:c=>Math.sqrt(1-Math.pow(c-1,2)),easeInOutCirc:c=>(c/=Ce)<1?-Ce*(Math.sqrt(1-c*c)-1):Ce*(Math.sqrt(1-(c-=2)*c)+1),easeOutBounce:c=>c<Mo?St*c*c:c<Ro?St*(c-=ko)*c+Ao:c<Io?St*(c-=To)*c+Lo:St*(c-=Fo)*c+Oo,easeInBack:c=>c*c*((li+1)*c-li),easeOutBack:c=>(c=c-1)*c*((li+1)*c+li)+1,easeInOutBack:c=>{let e=Xv;return(c/=Ce)<1?Ce*(c*c*(((e*=Fs)+1)*c-e)):Ce*((c-=2)*c*(((e*=Fs)+1)*c+e)+2)},elastic:c=>-1*Math.pow(4,-8*c)*Math.sin((c*6-1)*(2*Math.PI)/2)+1,swingFromTo:c=>{let e=Zv;return(c/=Ce)<1?Ce*(c*c*(((e*=Fs)+1)*c-e)):Ce*((c-=2)*c*(((e*=Fs)+1)*c+e)+2)},swingFrom:c=>c*c*((li+1)*c-li),swingTo:c=>(c-=1)*c*((li+1)*c+li)+1,bounce:c=>c<Mo?St*c*c:c<Ro?St*(c-=ko)*c+Ao:c<Io?St*(c-=To)*c+Lo:St*(c-=Fo)*c+Oo,bouncePast:c=>c<Mo?St*c*c:c<Ro?2-(St*(c-=ko)*c+Ao):c<Io?2-(St*(c-=To)*c+Lo):2-(St*(c-=Fo)*c+Oo),easeFromTo:c=>(c/=Ce)<1?Ce*Math.pow(c,4):-Ce*((c-=2)*Math.pow(c,3)-2),easeFrom:c=>Math.pow(c,4),easeTo:c=>Math.pow(c,.25)};ve._$name="FunctionHelper";const{isArray:Lc}=Array,{hasOwnProperty:Jv}=Object.prototype,Oc={thisObj:1,detachable:1,once:1,detacher:1,prio:1,args:1,expires:1,buffer:1,throttle:1,name:1,$internal:1},Pc=(c,e)=>e.prio-c.prio;var Ie=c=>class Al extends(c||P){constructor(...t){super(...t),M(this,"eventsSuspended",null)}static get $name(){return"Events"}static get declarable(){return["deprecatedEvents"]}static setupDeprecatedEvents(t,i){const r=i.getInherited("deprecatedEvents"),n=t.deprecatedEvents;for(const s in n)r[s.toLowerCase()]=r[s]=n[s]}static get configurable(){return{listeners:{value:null,$config:{merge(t,i){if(t!==null){if(!t)return i;i&&(t=t?[t]:[],t.push[Lc(i)?"apply":"call"](t,i))}return t}}},internalListeners:null,bubbleEvents:null}}destroy(){this.trigger("beforeDestroy"),super.destroy()}construct(t,...i){var r;(this.configuredListeners=(r=t)===null||r===void 0?void 0:r.listeners)&&(t=U.assign({},t),delete t.listeners),super.construct(t,...i),this.processConfiguredListeners()}processConfiguredListeners(){if(this.configuredListeners){const t=this,{isConfiguring:i}=t;t.isConfiguring=!1,t.listeners=t.configuredListeners,t.configuredListeners=null,t.isConfiguring=i}}doDestroy(){this.trigger("destroy"),this.removeAllListeners(!1),super.doDestroy()}static setupClass(t){super.setupClass(t),Al.prototype.onListen.$nullFn=!0,Al.prototype.onUnlisten.$nullFn=!0}addListener(t,i,r){if(Lc(t)){for(let o=0,{length:l}=t;o<l;o++)this.addListener(t[o],i);return}const n=this,s=n.$meta.getInherited("deprecatedEvents");if(typeof t=="string")return n.addListener({[t]:i,detachable:i.detachable!==!1,thisObj:r});{i=t.thisObj=t.thisObj!==void 0?t.thisObj:i;for(const u in t)if(!Oc[u]&&t[u]!=null){const h=u.toLowerCase(),f=s?.[h],g=n.eventListeners||(n.eventListeners={}),m=t[u],p=m.expires||t.expires,v={fn:typeof m=="object"?m.fn:m,thisObj:m.thisObj!==void 0?m.thisObj:i,args:m.args||t.args,prio:m.prio!==void 0?m.prio:t.prio!==void 0?t.prio:0,once:m.once!==void 0?m.once:t.once!==void 0?t.once:!1,buffer:m.buffer||t.buffer,throttle:m.throttle||t.throttle,$internal:t.$internal,catchAll:u==="catchAll"};if(f){const{product:C,invalidAsOfVersion:D,message:w}=f;ae.deprecate(C,D,w)}if(p){const{alt:C}=p,D=C?p.delay:p,w=t.name||u,E=()=>{n.un(h,v),C&&!v.called&&n.callback(C,i)};n.isDelayable?n.setTimeout({fn:E,name:w,cancelOutstanding:!0,delay:D}):globalThis.setTimeout(E,D)}let y=g[h]||(g[h]=[]);y.$firing&&(g[h]=y=y.slice()),y.splice(W.findInsertionIndex(v,y,Pc,y.length),0,v),!n.onListen.$nullFn&&y.length<2&&n.onListen(h)}t.relayAll&&n.relayAll(t.relayAll),i&&i!==n&&n.attachAutoDetacher(t,i);const o=t.detachable!==!1,l=t.name,d=t.expires||o||l?()=>{n.isDestroyed||n.removeListener(t,i)}:null;if(d){var a;if(d.eventer=n,d.listenerName=l,l&&(a=i)!==null&&a!==void 0&&a.trackDetacher&&i.trackDetacher(l,d),t.expires&&n.delay(d,isNaN(t.expires)?t.expires.delay:t.expires,l),o)return d}}}on(t,i,r){return this.addListener(t,i,r)}ion(t){return t.$internal=!0,this.on(t)}un(...t){this.removeListener(...t)}updateInternalListeners(t,i){i?.detach(),t&&(t.detach=this.ion(t))}get listeners(){return this.eventListeners}changeListeners(t){if(this.isConfiguring)this.getConfig("internalListeners"),t&&this.on(t,this);else{if(Array.isArray(t))for(let i=0,r=t[0],{length:n}=t;i<n;r=t[++i])"thisObj"in r||(t[i]=U.assign({thisObj:this},r));else t&&!("thisObj"in t)&&(t=U.assign({thisObj:this},t));return t}}updateListeners(t,i){i&&this.un(i),t&&this.on(t)}removeListener(t,i=t.thisObj,r){const n=this;if(typeof t=="string")return n.removeListener({[t]:i},r);Object.entries(t).forEach(([s,a])=>{if(!Oc[s]&&a!=null){s=s.toLowerCase();const o=n.eventListeners,l=n.findListener(s,a,i);if(l>=0){let d=o[s];d.length>1?(d.$firing&&(o[s]=d=d.slice()),d.splice(l,1)):(delete o[s],n.onUnlisten.$nullFn||n.onUnlisten(s))}}}),t.thisObj&&!t.thisObj.isDestroyed&&n.detachAutoDetacher(t)}findListener(t,i,r){var n;const s=(n=this.eventListeners)===null||n===void 0?void 0:n[t],a=i.fn||i,o=i.thisObj||r;if(s){for(let l,d=0,{length:u}=s;d<u;d++)if(l=s[d],l.fn===a&&l.thisObj===o)return d}return-1}hasListener(t){var i;return Boolean((i=this.eventListeners)===null||i===void 0?void 0:i[t?.toLowerCase()])}relayAll(t,i,r=!0){this.relayAllTargets||(this.relayAllTargets=[]);const n=this.relayAllTargets;t.on({beforeDestroy:({source:s})=>{s===t&&n.filter(o=>o.through===t).forEach(o=>W.remove(n,o))}}),n.push({through:t,prefix:i,transformCase:r})}removeAllListeners(t=!0){const i=this.eventListeners;let r,n;for(const l in i){const d=i[l];for(r=d.length;r-- >0;){const u=d[r];if(!u.$internal||!t){var s,a,o;this.removeListener(l,u),n=u.thisObj,(s=n)===null||s===void 0||(a=(o=s).untrackDetachers)===null||a===void 0||a.call(o,this)}}}}relayEvents(t,i,r=""){const n={detachable:!0,thisObj:this};return i.forEach(s=>{n[s]=(a,...o)=>this.trigger(r+s,a,...o)}),t.on(n)}onListen(){}onUnlisten(){}destructorInterceptor(){const{autoDetachers:t,target:i,oldDestructor:r}=this;for(let n=0;n<t.length;n++){const{dispatcher:s,config:a}=t[n];s.isDestroyed||s.removeListener(a,i)}r.call(i)}attachAutoDetacher(t,i){const r=t.thisObj||i,n="doDestroy"in r?"doDestroy":"destroy";if(n in r){let{$autoDetachers:s}=r;s||(r.$autoDetachers=s=[]),r.$oldDestructor||(r.$oldDestructor=r[n],r[n]=this.destructorInterceptor.bind({autoDetachers:s,oldDestructor:r.$oldDestructor,target:r})),s.push({config:t,dispatcher:this})}else r[n]=()=>{this.removeListener(t)}}detachAutoDetacher(t){const i=t.thisObj;i.$oldDestructor&&!i.isDestroying&&(W.remove(i.$autoDetachers,i.$autoDetachers.find(r=>r.config===t&&r.dispatcher===this)),i.$autoDetachers.length||(i["doDestroy"in i?"doDestroy":"destroy"]=i.$oldDestructor,i.$oldDestructor=null))}await(t,i={checkLog:!0,resetLog:!0,args:null}){const r=this;i===!1&&(i={checkLog:!1});const{args:n}=i;return new Promise(s=>{var a;if(i.checkLog&&(a=r._triggered)!==null&&a!==void 0&&a[t]&&(s(),i.resetLog&&r.clearLog(t)),n){const o=r.on({[t]:(...l)=>{Object.keys(n).every(u=>u in l[0]&&l[0][u]===n[u])&&(s(...l),i.resetLog&&r.clearLog(t),o())},prio:-1e4})}else r.on({[t]:(...o)=>{s(...o),i.resetLog&&r.clearLog(t)},prio:-1e4,once:!0})})}clearLog(t){this._triggered&&(t?delete this._triggered[t]:this._triggered={})}trigger(t,i){var r,n,s,a,o;const l=this,d=t.toLowerCase(),{eventsSuspended:u,relayAllTargets:h,callOnFunctions:f}=l;let g=(r=l.eventListeners)===null||r===void 0?void 0:r[d],m;if(l._triggered||(l._triggered={}),l._triggered[t]=!0,u)return u.shouldQueue&&u.queue.push(arguments),!0;if((n=l.eventListeners)!==null&&n!==void 0&&n.catchall&&((g=g?g.slice():[]).push(...l.eventListeners.catchall),g.sort(Pc)),!g&&!h&&!f)return!0;if(i?"source"in i||(Object.isExtensible(i)?i.source=l:i=Object.setPrototypeOf({source:l},i)):i={source:l},i.type!==d&&(i.constructor!==Object?Reflect.defineProperty(i,"type",{get:()=>d}):i.type=d),!("bubbles"in i)&&(s=l.bubbleEvents)!==null&&s!==void 0&&s[t]&&(i.bubbles=l.bubbleEvents[t]),f){const y="on"+z.capitalize(t);if(y in l){var p;const C=l[y]?l.callback(l[y],l,[i]):!0;let D;if(U.isPromise(C)?(m||(m=[])).push(C):D=C===!1||D,!l.isDestroyed&&Jv.call(l,y)&&!((p=l.pluginFunctionChain)!==null&&p!==void 0&&p[y])){const w=Object.getPrototypeOf(l);if(y in w){const E=w[y].call(l,i);if(U.isPromise(E)?(m||(m=[])).push(E):D=E===!1||D,l.isDestroyed)return}}if(D)return!1}}let v;if(g){let y=0,C=!1;for(g.$firing=!0,y;y<g.length&&!l.isDestroyed&&!C;y++){const D=g[y];if(v===!1&&!D.$internal)continue;let w,E=D.thisObj;if(!E||!E.isDestroyed){if(D.called=!0,D.once&&l.removeListener(d,D),typeof D.fn=="string"){if(E&&(w=E[D.fn]),!w){const x=l.resolveCallback(D.fn);w=x.handler,E=x.thisObj}}else w=D.fn;if(D.buffer){if(!D.bufferFn){const x=Number(D.buffer);if(typeof x!="number"||isNaN(x))throw new Error(`Incorrect type for buffer, got "${x}" (expected a Number)`);D.bufferFn=ve.createBuffered(w,x,E,D.args)}w=D.bufferFn}if(D.throttle){const x=Number(D.throttle);if(typeof x!="number"||isNaN(x))throw new Error(`Incorrect type for throttle, got "${x}" (expected a Number)`);D.throttledFn||(D.throttledFn=ve.createThrottled(w,x,E,D.args)),w=D.throttledFn}const R=w.call(E||l,...D.args||[],i);v!==!1&&(v=R),D.$internal&&R===!1&&(C=!0),U.isPromise(R)&&(R.$internal=D.$internal,(m||(m=[])).push(R))}}if(g.$firing=!1,C)return!1}return h?.forEach(y=>{let C=t;if(y.transformCase&&(C=z.capitalize(C)),y.prefix&&(C=y.prefix+C),y.through.trigger(C,i)===!1)return!1}),i.bubbles&&l.owner&&!l.owner.isDestroyed?l.owner.trigger(t,i):(m=(a=m)===null||a===void 0?void 0:a.filter(y=>v!==!1||y.$internal),(o=m)!==null&&o!==void 0&&o.length?new Promise(y=>{Promise.all(m).then(C=>{const D=!C.some(w=>w===!1);y(D)})}):v!==!1)}suspendEvents(t=!1){const i=this.eventsSuspended||(this.eventsSuspended={shouldQueue:t,queue:[],count:0});i.count++}resumeEvents(){const t=this.eventsSuspended;if(t&&--t.count===0&&(this.eventsSuspended=null,t.shouldQueue))for(const i of t.queue)this.trigger(...i);return!Boolean(this.eventsSuspended)}};class Yf{static animationFrame(){return new Promise(e=>{requestAnimationFrame(e)})}static sleep(e){return new Promise(t=>{setTimeout(()=>{t()},e)})}static yield(){return Promise.resolve()}}Yf._$name="AsyncHelper";const Qv=/^(\w+)=(.*)$/,ey=function(c){const e={},t=c.split("&");for(const i of t){const[r,n,s]=Qv.exec(i),a=decodeURIComponent(n),o=decodeURIComponent(s);if(r){let l=e[a];l?(Array.isArray(l)||(l=e[a]=[l]),l.push(o)):e[a]=o}}return e};class et{static get(e,t){return this.fetch(e,t)}static post(e,t,i={}){return!(t instanceof FormData)&&typeof t!="string"&&(t=JSON.stringify(t),i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json"),this.fetch(e,Object.assign({method:"POST",body:t},i))}static fetch(e,t){let i;if(t=U.merge({},et.DEFAULT_FETCH_OPTIONS,t),typeof AbortController<"u"&&(i=t.abortController=new AbortController,t.signal=i.signal),"credentials"in t||(t.credentials="include"),t.queryParams){const n=Object.entries(t.queryParams);if(n.length){let s=!1;if(t.headers&&t.addQueryParamsToBody===!0){const a=new Headers(t.headers).get("Content-Type");let o;switch(a){case"application/x-www-form-urlencoded":o=URLSearchParams;break;case"multipart/form-data":o=FormData;break}if(o){const l=t.body||(t.body=new o);l instanceof o&&(n.forEach(([d,u])=>l.set(d,u)),s=!0)}}s||(e+=(e.includes("?")?"&":"?")+n.map(([a,o])=>`${a}=${encodeURIComponent(o)}`).join("&"))}}const r=new Promise((n,s)=>{fetch(e,t).then(a=>{t.parseJson?a.json().then(o=>{a.parsedJson=o,n(a)}).catch(o=>{a.parsedJson=null,a.error=o,s(a)}):n(a)}).catch(a=>{a.stack=r.stack,s(a)})});return r.stack=new Error().stack,r.abort=function(){var n;(n=i)===null||n===void 0||n.abort()},r}static mockUrl(e,t){const i=this;(i.mockAjaxMap||(i.mockAjaxMap={}))[e]=t,et.originalFetch||(et.originalFetch=et.fetch,et.fetch=i.mockAjaxFetch.bind(i))}static async mockAjaxFetch(e,t){const i=e.split("?");let r=this.mockAjaxMap[i[0]],n=null;if(r){typeof r=="function"&&(r=await r(i[0],i[1]&&ey(i[1]),t));try{n=t.parseJson&&JSON.parse(r.responseText)}catch(s){n=null,r.error=s}return r=Object.assign({status:200,ok:!0,headers:new Headers,statusText:"OK",url:e,parsedJson:n,text:()=>new Promise(s=>{s(r.responseText)}),json:()=>new Promise(s=>{s(n)})},r),new Promise(function(s,a){r.synchronous?s(r):setTimeout(function(){s(r)},"delay"in r?r.delay:100)})}else return et.originalFetch(e,t)}}M(et,"DEFAULT_FETCH_OPTIONS",{});et._$name="AjaxHelper";class Be{static mergeLocales(...e){const t={};return e.forEach(i=>{Object.keys(i).forEach(r=>{typeof i[r]=="object"?t[r]=F(F({},t[r]),i[r]):t[r]=i[r]})}),t}static trimLocale(e,t){const i=(r,n)=>{e[r]&&(n?e[r][n]&&delete e[r][n]:delete e[r])};Object.keys(t).forEach(r=>{Object.keys(t[r]).length>0?Object.keys(t[r]).forEach(n=>i(r,n)):i(r)})}static normalizeLocale(e,t){if(!e)throw new Error('"nameOrConfig" parameter can not be empty');if(typeof e=="string"){if(!t)throw new Error('"config" parameter can not be empty');t.locale?t.name=e||t.name:t.localeName=e}else t=e;let i={};if(t.name||t.locale)i=Object.assign({localeName:t.name},t.locale),t.desc&&(i.localeDesc=t.desc),t.code&&(i.localeCode=t.code),t.path&&(i.localePath=t.path);else{if(!t.localeName)throw new Error(`"config" parameter doesn't have "localeName" property`);i=Object.assign({},t)}for(const r of["name","desc","code","path"])i[r]&&delete i[r];if(!i.localeName)throw new Error("Locale name can not be empty");return i}static get locales(){return globalThis.bryntum.locales||{}}static set locales(e){globalThis.bryntum.locales=e}static get localeName(){return globalThis.bryntum.locale||"En"}static set localeName(e){globalThis.bryntum.locale=e||Be.localeName}static get locale(){return Be.localeName&&this.locales[Be.localeName]||this.locales.En||Object.values(this.locales)[0]||{localeName:"",localeDesc:"",localeCoode:""}}static publishLocale(e,t){const{locales:i}=globalThis.bryntum,r=Be.normalizeLocale(e,t),{localeName:n}=r;return!i[n]||t===!0?i[n]=r:i[n]=this.mergeLocales(i[n]||{},r||{}),i[n]}}M(Be,"skipLocaleIntegrityCheck",!1);globalThis.bryntum=globalThis.bryntum||{};globalThis.bryntum.locales=globalThis.bryntum.locales||{};Be._$name="LocaleHelper";class ty extends Ie(P){static get defaultConfig(){return{throwOnMissingLocale:ae.isTestEnv}}construct(...e){const t=this;if(super.construct(...e),K.isBrowserEnv){var i;const r=document.querySelector("script[data-default-locale]");r?t.applyLocale(r.dataset.defaultLocale):(i=t.locale)!==null&&i!==void 0&&i.localeName&&t.applyLocale(t.locale.localeName)}}get locales(){return Be.locales}set locales(e){Be.locales=e}set locale(e){this.applyLocale(e)}get locale(){return Be.locale}registerLocale(e,t){ae.deprecate("Core","6.0.0","LocaleManager.registerLocale deprecated, use LocaleHelper.publishLocale instead"),Be.publishLocale(e,t)}extendLocale(e,t){ae.deprecate("Core","6.0.0","LocaleManager.extendLocale deprecated, use LocaleManager.applyLocale instead");const i=Be.publishLocale(e,t);return this.applyLocale(i,!0)}applyLocale(e,t,i=!1){const r=this;let n;if(typeof e=="string")if(typeof t!="object"){if(n=r.locales[e],!n){if(i)return!0;throw new Error(`Locale "${e}" is not published. Publish with LocaleHelper.publishLocale() before applying.`)}}else n=Be.publishLocale(e,t);else n=Be.publishLocale(e);if(r.locale.localeName&&r.locale.localeName===n.localeName&&t!==!0)return r.locale;Be.localeName=n.localeName;const s=()=>{r.trigger("locale",n)};return n.localePath?new Promise((a,o)=>{r.loadLocale(n.localePath).then(l=>{l.text().then(d=>{new Function(d)(),K.isBrowserEnv&&(n=r.locales[n.localeName],n&&delete n.localePath),s(),a(n)})}).catch(l=>o(l))}):(s(),n)}loadLocale(e){return et.get(e)}set throwOnMissingLocale(e){this._throwOnMissingLocale=e}get throwOnMissingLocale(){return this._throwOnMissingLocale}}const He=new ty,iy=Object.getPrototypeOf(Object),$c=/L{.*?}/g,_c=/L{(.*?)}/g,Hc=/((.*?)\.)?(.+)/g,ry=c=>c.replace(/{(\d+)}/gm,"[[$1]]"),Nc=c=>c.replace(/\[\[(\d+)]]/gm,"{$1}"),ny=Object.freeze(Object.create(null));var Kt=c=>class zt extends(c||P){static get $name(){return"Localizable"}static get configurable(){return{localeClass:null,localizable:null,localizableProperties:{value:[],$config:{merge:"distinct"}}}}static clsName(t){var i,r;return typeof t=="string"?t:t===iy?"Object":t.$$name||t.name||((i=t.prototype)===null||i===void 0?void 0:i.$$name)||((r=t.prototype)===null||r===void 0?void 0:r.name)}static parseLocaleString(t){var i;const r=[];let n;if((i=t)!==null&&i!==void 0&&i.includes("L{"))for(t=ry(t),_c.lastIndex=0;(n=_c.exec(t))!=null;){Hc.lastIndex=0;const s=Hc.exec(n[1]);r.push({match:Nc(n[0]),localeKey:Nc(s[3]),localeClass:s[2]})}return r.length>0?r:[{match:t,localeKey:t,localeClass:void 0}]}construct(t={},...i){super.construct(t,...i),He.ion({locale:"updateLocalization",thisObj:this}),this.updateLocalization()}get localeClass(){return this._localeClass||null}localizeProperty(t){var i,r,n;const s=this,a=U.getPath(s,t),o=((i=s.$meta.configs[t])===null||i===void 0?void 0:i.localeKey)||((r=s.fieldMap)===null||r===void 0||(n=r[t])===null||n===void 0?void 0:n.defaultValue);let l;return o?(l=zt.localize(o,s,s.localeClass||s),l&&!(t in(s.initialConfig||ny))&&U.setPath(s.isColumn?s.data:s,t,l)):typeof a=="string"&&(s.originalLocales=s.originalLocales||{},l=U.getPath(s.originalLocales,t),l===void 0&&(U.setPath(s.originalLocales,t,a),l=a),l&&U.setPath(s,t,l=s.optionalL(l,s))),l||a}updateLocalization(){if(this.localizable!==!1){var t,i;(t=this.localizableProperties)===null||t===void 0||t.forEach(this.localizeProperty,this),(i=this.trigger)===null||i===void 0||i.call(this,"localized")}}static getTranslation(t,i,r){const n=He.locale;let s=null,a,o;if(n)for(const{match:l,localeKey:d,localeClass:u}of this.parseLocaleString(t)){const h=g=>{var m;const p=(m=n[g])===null||m===void 0?void 0:m[d];return p&&(typeof p=="function"?s=i!=null?p(i):p:typeof p=="object"||t===l?s=p:s=(s||t).replace(l,p),typeof p=="string"&&p.includes("L{")&&(s=this.getTranslation(p,i,r))),p};let f=!1;for(o=r;o&&(a=zt.clsName(o))&&!(f=h(a));o=Object.getPrototypeOf(o))if(typeof o=="string")break;!f&&u&&h(u)}return s}static localize(t,i=void 0,...r){var n;((n=r)===null||n===void 0?void 0:n.length)===0&&(r=[this]);let s=null;return r.some(a=>(s=zt.getTranslation(t,i,a),s!=null)),s}static L(t,i=void 0,...r){var n;((n=r)===null||n===void 0?void 0:n.length)===0&&(r=[this]);const s=this.localize(t,i,...r);if(s==null&&He.throwOnMissingLocale&&t.includes("L{"))throw new Error(`Localization is not found for '${t}' in '${r.map(a=>zt.clsName(a)).join(", ")}'. ${He.locale.localeName?`Locale : ${He.locale.localeName}`:""}`);return s??t}L(t,i){const{localeClass:r,constructor:n}=this;return r&&zt.clsName(r)!==zt.clsName(n)?zt.L(t,i,r,n):zt.L(t,i,n)}static optionalL(t,i=void 0,...r){var n;const s=He.throwOnMissingLocale;He.throwOnMissingLocale=s&&$c.test(t),((n=r)===null||n===void 0?void 0:n.length)===0&&(r=[this]);const a=zt.L(t,i,...r);return He.throwOnMissingLocale=s,a}optionalL(t,i=this,r=!1){const n=He.throwOnMissingLocale;He.throwOnMissingLocale=n&&$c.test(t)&&!r;const s=this.L(t,i);return He.throwOnMissingLocale=n,s}get localeManager(){return He}get localeHelper(){return Be}};const sy={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",Object:{Yes:"Yes",No:"No",Cancel:"Cancel",Ok:"OK",Week:"Week"},Combo:{noResults:"No results",recordNotCommitted:"Record could not be added",addNewValue:c=>`Add ${c}`},FilePicker:{file:"File"},Field:{badInput:"Invalid field value",patternMismatch:"Value should match a specific pattern",rangeOverflow:c=>`Value must be less than or equal to ${c.max}`,rangeUnderflow:c=>`Value must be greater than or equal to ${c.min}`,stepMismatch:"Value should fit the step",tooLong:"Value should be shorter",tooShort:"Value should be longer",typeMismatch:"Value is required to be in a special format",valueMissing:"This field is required",invalidValue:"Invalid field value",minimumValueViolation:"Minimum value violation",maximumValueViolation:"Maximum value violation",fieldRequired:"This field is required",validateFilter:"Value must be selected from the list"},DateField:{invalidDate:"Invalid date input"},DatePicker:{gotoPrevYear:"Go to previous year",gotoPrevMonth:"Go to previous month",gotoNextMonth:"Go to next month",gotoNextYear:"Go to next year"},NumberFormat:{locale:"en-US",currency:"USD"},DurationField:{invalidUnit:"Invalid unit"},TimeField:{invalidTime:"Invalid time input"},TimePicker:{hour:"Hour",minute:"Minute",second:"Second"},List:{loading:"Loading..."},GridBase:{loadMask:"Loading...",syncMask:"Saving changes, please wait..."},PagingToolbar:{firstPage:"Go to first page",prevPage:"Go to previous page",page:"Page",nextPage:"Go to next page",lastPage:"Go to last page",reload:"Reload current page",noRecords:"No records to display",pageCountTemplate:c=>`of ${c.lastPage}`,summaryTemplate:c=>`Displaying records ${c.start} - ${c.end} of ${c.allCount}`},PanelCollapser:{Collapse:"Collapse",Expand:"Expand"},Popup:{close:"Close"},UndoRedo:{Undo:"Undo",Redo:"Redo",UndoLastAction:"Undo last action",RedoLastAction:"Redo last undone action",NoActions:"No items in the undo queue"},FieldFilterPicker:{equals:"equals",doesNotEqual:"does not equal",isEmpty:"is empty",isNotEmpty:"is not empty",contains:"contains",doesNotContain:"does not contain",startsWith:"starts with",endsWith:"ends with",isOneOf:"is one of",isNotOneOf:"is not one of",isGreaterThan:"is greater than",isLessThan:"is less than",isGreaterThanOrEqualTo:"is greater than or equal to",isLessThanOrEqualTo:"is less than or equal to",isBetween:"is between",isNotBetween:"is not between",isBefore:"is before",isAfter:"is after",isToday:"is today",isTomorrow:"is tomorrow",isYesterday:"is yesterday",isThisWeek:"is this week",isNextWeek:"is next week",isLastWeek:"is last week",isThisMonth:"is this month",isNextMonth:"is next month",isLastMonth:"is last month",isThisYear:"is this year",isNextYear:"is next year",isLastYear:"is last year",isYearToDate:"is year to date",isTrue:"is true",isFalse:"is false",selectAProperty:"Select a property",selectAnOperator:"Select an operator",caseSensitive:"Case-sensitive",and:"and",dateFormat:"D/M/YY",selectOneOrMoreValues:"Select one or more values",enterAValue:"Enter a value",enterANumber:"Enter a number",selectADate:"Select a date"},FieldFilterPickerGroup:{addFilter:"Add filter"},DateHelper:{locale:"en-US",weekStartDay:0,nonWorkingDays:{0:!0,6:!0},weekends:{0:!0,6:!0},unitNames:[{single:"millisecond",plural:"ms",abbrev:"ms"},{single:"second",plural:"seconds",abbrev:"s"},{single:"minute",plural:"minutes",abbrev:"min"},{single:"hour",plural:"hours",abbrev:"h"},{single:"day",plural:"days",abbrev:"d"},{single:"week",plural:"weeks",abbrev:"w"},{single:"month",plural:"months",abbrev:"mon"},{single:"quarter",plural:"quarters",abbrev:"q"},{single:"year",plural:"years",abbrev:"yr"},{single:"decade",plural:"decades",abbrev:"dec"}],unitAbbreviations:[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"],["dec"]],parsers:{L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A"},ordinalSuffix:c=>{const e=["11","12","13"].find(i=>c.endsWith(i));let t="th";if(!e){const i=c[c.length-1];t={1:"st",2:"nd",3:"rd"}[i]||"th"}return c+t}}};Be.publishLocale(sy);const{toString:Gf}=Object.prototype,ay=Gf.call(new Date),As=new Date,Ll=1e3*60*60,Po=(c,e)=>isNaN(c)||c==null?e:c,oy=/([ES]){([^}]+)}/g,qf=c=>{const e=["11","12","13"].find(i=>c.endsWith(i));let t="th";if(!e){const i=c[c.length-1];t={1:"st",2:"nd",3:"rd"}[i]||"th"}return c+t},qe=(c,e,t)=>(bi[c]||(bi[c]=new Intl.DateTimeFormat(mi,e))).format(t),on=(c,e,t,i=!1)=>{let r=qe(c,e,t);return/am|pm/i.test(r)&&(r=r.replace(/^0/,""),i&&(r=r.replace(/:00/,""))),r},ly=(c,e)=>Math.floor((c.getTime()-e.getTime()-(c.getTimezoneOffset()-e.getTimezoneOffset())*st.minute.millisecond)/st.day.millisecond)+1,Bc=c=>c>=0?c:c+7,dy=/([^\w])(S+)/gm,cy=(c,e,t)=>e+"SSS";let mi="en-US",ri=qf,Ls={},Mn={},bi={},$o={};const zc=c=>{const e=Ol[c];if(!e)throw new Error("Only international formats should be used here");if(Mn[c]!==void 0)return Mn[c];const t=new Intl.DateTimeFormat(mi,e),i=t.formatToParts(new Date(2001,1,2,3,4,5,6)).map(r=>{const n=r.type,s=e[n];if(n==="literal")return r.value.replace(/,/g,"");if(n==="day")return s==="numeric"?"D":"DD";if(n==="month")return s==="short"?"MMM":s==="long"?"MMMM":s==="numeric"?"M":"MM";if(n==="year")return s==="numeric"?"YYYY":"YY"}).join("");return Mn[c]=i},Vc=2020,jc=0,Wc=1,Ol={l:{year:"numeric",month:"numeric",day:"numeric"},ll:{year:"numeric",month:"short",day:"numeric"}},je={M:c=>c.getMonth()+1,Mo:c=>ri(je.M(c).toString()),MM:c=>(c.getMonth()+1).toString().padStart(2,"0"),MMM:c=>qe("MMM",{month:"short"},c),MMMM:c=>qe("MMMM",{month:"long"},c),Q:c=>Math.ceil((c.getMonth()+1)/3),Qo:c=>ri(je.Q(c).toString()),D:c=>c.getDate(),Do:c=>ri(je.D(c).toString()),DD:c=>c.getDate().toString().padStart(2,"0"),DDD:c=>Math.ceil((new Date(c.getFullYear(),c.getMonth(),c.getDate(),12,0,0)-new Date(c.getFullYear(),0,0,12,0,0))/st.day.millisecond),DDDo:c=>ri(je.DDD(c).toString()),DDDD:c=>je.DDD(c).toString().padStart(3,"0"),d:c=>c.getDay(),do:c=>ri(c.getDay().toString()),d1:c=>qe("d1",{weekday:"narrow"},c).substr(0,1),dd:c=>je.ddd(c).substring(0,2),ddd:c=>qe("ddd",{weekday:"short"},c),dddd:c=>qe("dddd",{weekday:"long"},c),u:c=>{const e=bi.u||(bi.u=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"})),t=e.formatToParts(c);return`${t[4].value}${t[2].value}${t[0].value}Z`},uu:c=>{const e=bi.uu||(bi.uu=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),t=e.formatToParts(c);return`${t[4].value}${t[2].value}${t[0].value}T${t[6].value}${t[8].value}${t[10].value}Z`},e:c=>c.getDay(),E:c=>c.getDay()+1,W:c=>b.getWeekNumber(c)[1],Wo:c=>ri(je.W(c).toString()),WW:c=>je.W(c).toString().padStart(2,"0"),Wp:c=>`${b.localize("L{Week}")} ${je.W(c)}`,WWp:c=>`${b.localize("L{Week}")} ${je.WW(c)}`,Wp0:c=>`${b.localize("L{Week}")[0]}${je.W(c)}`,WWp0:c=>`${b.localize("L{Week}")[0]}${je.WW(c)}`,Y:c=>c.getFullYear(),YY:c=>c.getFullYear()%100,YYYY:c=>c.getFullYear(),A:c=>c.getHours()<12?"AM":"PM",a:c=>c.getHours()<12?"am":"pm",H:c=>c.getHours(),HH:c=>c.getHours().toString().padStart(2,"0"),h:c=>c.getHours()%12||12,hh:c=>je.h(c).toString().padStart(2,"0"),k:c=>c.getHours()||24,kk:c=>je.k(c).toString().padStart(2,"0"),K:c=>on("K",{hour:"numeric"},c),KK:c=>on("KK",{hour:"2-digit"},c),m:c=>c.getMinutes(),mm:c=>je.m(c).toString().padStart(2,"0"),s:c=>c.getSeconds(),ss:c=>je.s(c).toString().padStart(2,"0"),S:c=>Math.floor(c.getMilliseconds()/100).toString(),SS:c=>Math.floor(c.getMilliseconds()/10).toString().padStart(2,"0"),SSS:c=>c.getMilliseconds().toString().padStart(3,"0"),z:c=>qe("z",{timeZoneName:"short"},c),zz:c=>qe("zz",{timeZoneName:"long"},c),Z:c=>H.getGMTOffset(c),LT:c=>on("LT",{hour:"2-digit",minute:"2-digit"},c),LST:c=>on("LST",{hour:"numeric",minute:"2-digit"},c,!0),LTS:c=>on("LTS",{hour:"2-digit",minute:"2-digit",second:"2-digit"},c),L:c=>qe("L",{year:"numeric",month:"2-digit",day:"2-digit"},c),l:c=>qe("l",Ol.l,c),LL:c=>qe("LL",{year:"numeric",month:"long",day:"numeric"},c),ll:c=>qe("ll",Ol.ll,c),LLL:c=>qe("LLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"},c),lll:c=>qe("lll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"},c),LLLL:c=>qe("LLLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"long"},c),llll:c=>qe("llll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"short"},c)},uy=Object.keys(je).sort((c,e)=>e.length-c.length),hy=`^(?:${uy.join("|")})`,Ge=()=>({}),fy=c=>wy.test(c),_o=c=>fy(c)&&{milliseconds:parseInt(c.padEnd(3,"0").substring(0,3))},Kf={YYYY:c=>{const e=parseInt(c);return{year:e>=1e3&&e<=9999?e:NaN}},Y:c=>({year:parseInt(c)}),YY:c=>{const e=parseInt(c);return{year:e+(e>1968?1900:2e3)}},M:c=>({month:parseInt(c)-1}),MM:c=>({month:parseInt(c)-1}),Mo:c=>({month:parseInt(c)-1}),MMM:c=>{const e=(c||"").toLowerCase();for(const[t,i]of Object.entries(b._monthShortNamesIndex))if(e.startsWith(t))return{month:i.value}},MMMM:Ge,DD:c=>({date:parseInt(c)}),D:c=>({date:parseInt(c)}),Do:c=>({date:parseInt(c)}),DDD:Ge,DDDo:Ge,DDDD:Ge,d:Ge,do:Ge,d1:Ge,dd:Ge,ddd:Ge,dddd:Ge,Q:Ge,Qo:Ge,W:Ge,Wo:Ge,WW:Ge,e:Ge,E:Ge,HH:c=>({hours:parseInt(c)}),hh:c=>({hours:parseInt(c)}),mm:c=>({minutes:parseInt(c)}),H:c=>({hours:parseInt(c)}),m:c=>({minutes:parseInt(c)}),ss:c=>({seconds:parseInt(c)}),s:c=>({seconds:parseInt(c)}),S:_o,SS:_o,SSS:_o,A:c=>({amPm:c.toLowerCase()}),a:c=>({amPm:c.toLowerCase()}),L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A",l:{type:"dynamic",parser:()=>zc("l")},ll:{type:"dynamic",parser:()=>zc("ll")},Z:c=>{if(!c||!Gc.test(c)&&c!=="Z")return null;let e=0;if(c!=="Z"){const t=Gc.exec(c);if(t){const i=t[1]==="+"?1:-1,r=parseInt(t[2])||0,n=parseInt(t[3])||0;e=i*(r*60+n)}else e=-1*new Date().getTimezoneOffset()}return{timeZone:e}}},gy=Object.keys(Kf).sort((c,e)=>e.length-c.length),Uc=new RegExp(`(${gy.join("|")})`),my=new RegExp("^(LL|LLL|lll|LLLL|llll)$"),st={decade:{decade:1,year:10,quarter:40,month:120,week:520,day:3652,hour:24*3652,minute:1440*3652,second:86400*3652,millisecond:864e5*3652},year:{decade:.1,year:1,quarter:4,month:12,week:52,day:365,hour:24*365,minute:1440*365,second:86400*365,millisecond:864e5*365},quarter:{decade:1/40,year:1/4,quarter:1,month:3,week:4,day:91,hour:24*91,minute:1440*91,second:86400*91,millisecond:864e5*91},month:{decade:1/120,year:1/12,quarter:1/3,month:1,week:4,day:-30,hour:-24*30,minute:-1440*30,second:-86400*30,millisecond:-864e5*30},week:{decade:-1/520,year:-1/52,quarter:-1/13,month:-1/4,day:7,hour:168,minute:10080,second:604800,millisecond:6048e5},day:{decade:-1/3652,year:-1/365,quarter:-1/91,month:-1/30,week:1/7,hour:24,minute:1440,second:86400,millisecond:864e5},hour:{decade:-1/(3652*24),year:-1/(365*24),quarter:-1/(91*24),month:-1/(30*24),week:1/168,day:1/24,minute:60,second:3600,millisecond:36e5},minute:{decade:-1/(3652*1440),year:-1/(365*1440),quarter:-1/(91*1440),month:-1/(30*1440),week:1/10080,day:1/1440,hour:1/60,second:60,millisecond:6e4},second:{decade:-1/(3652*86400),year:-1/(365*86400),quarter:-1/(91*86400),month:-1/(30*86400),week:1/604800,day:1/86400,hour:1/3600,minute:1/60,millisecond:1e3},millisecond:{decade:-1/(3652*864e5),year:-1/(365*864e5),quarter:-1/(91*864e5),month:-1/(30*864e5),week:1/6048e5,day:1/864e5,hour:1/36e5,minute:1/6e4,second:1/1e3}},Yc={ms:"millisecond",milliseconds:"millisecond",s:"second",seconds:"second",m:"minute",mi:"minute",min:"minute",minutes:"minute",h:"hour",hours:"hour",d:"day",days:"day",w:"week",weeks:"week",M:"month",mo:"month",mon:"month",months:"month",q:"quarter",quarters:"quarter",y:"year",years:"year",dec:"decade",decades:"decade"},py=/^\s*([-+]?\d+(?:[.,]\d*)?|[-+]?(?:[.,]\d+))\s*([^\s]+)?/i,vy=/^\s*([-+]?\d+)(?![.,])\s*([^\s]+)?/i,or=["millisecond","second","minute","hour","day","week","month","quarter","year","decade"],yy=[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"],["dec"]],Ho=["decade","year","month","week","day","hour","minute","second","millisecond"],by=["milliseconds","seconds","minutes","hours","date","month","year"],Cy=c=>{const e=parseFloat(c);return isNaN(e)?null:e},wy=/^[0-9]+$/,Gc=/([+-])(\d\d):*(\d\d)*$/,kt={millisecond:0,second:1,minute:2,hour:3,day:4,week:5,month:6,quarter:7,year:8,decade:9},Sy={round(c,e=1){return Math.round(c/e)*e},floor(c,e=1){return Math.floor(c/e)*e},ceil(c,e=1){return Math.ceil(c/e)*e}},qc={};class b extends Kt(){static get $name(){return"DateHelper"}static set defaultFormat(e){H._defaultFormat=e}static get defaultFormat(){return H._defaultFormat||"YYYY-MM-DDTHH:mm:ssZ"}static set defaultParseFormat(e){this._defaultParseFormat=e}static get defaultParseFormat(){return this._defaultParseFormat||this._defaultFormat||"YYYY-MM-DDTHH:mm:ss.SSSZ"}static buildParser(e){const t=e.split(Uc),i=[];return t.length===1||my.test(e)?[]:(t.reduce((r,n,s,a)=>{if(s!==0||n!=="")if(Uc.test(n)){const o=this.localize("L{parsers}")||{},l=o[n]||Kf[n];if(n==="Z"&&s<a.length-2)throw new Error(`Invalid format ${e} TimeZone (Z) must be last token`);const d=typeof l=="function"||typeof l=="string"?l:l.parser();if(typeof d=="string"){const u=H.buildParser(d),h=u.pop();delete h.last,i.push(...u),r=h}else r.pattern=n,r.fn=d}else r.splitter=n,i.push(r),r={};else Object.prototype.hasOwnProperty.call(r,"pattern")&&i.push(r);return r},{}),i[i.length-1].last=!0,i)}static makeKey(e){if(e.length===10)return e;e.getTime&&(e=e.getTime());const t=qc[Math.trunc(e/Ll)];if(t)return t;As.setTime(e);const i=As.getMonth()+1,r=As.getDate();return qc[Math.trunc(e/Ll)]=`${As.getFullYear()}-${i<10?"0"+i:i}-${r<10?"0"+r:r}`}static parseKey(e){return H.parse(e,"YYYY-MM-DD")}static parse(e,t=H.defaultParseFormat,i=!1){if(e instanceof Date)return e;if(typeof e!="string"||!e)return null;const r={year:null,month:null,date:null,hours:null,minutes:null,seconds:null,milliseconds:null};t=t.replace(dy,cy);let n=$o[t],s;n||(n=$o[t]=H.buildParser(t)),e.includes("\u202F")&&(e=e.replace(/\s/g," ")),n.reduce((o,l)=>{if(l.last)Object.assign(r,l.fn(o));else{let d;l.splitter==="T"&&o.indexOf("T")===-1?d=o.indexOf(" "):d=l.splitter!==""?o.indexOf(l.splitter):l.pattern&&l.pattern.length||-1;let u,h;if(d===-1||l.pattern==="SSS"&&o.match(/^\d+Z$/)){const f=o.split(/([Z\-+])/);f.length===1?(u=o,h=""):(u=f[0],h=`${f[1]}${f[2]}`)}else u=o.substring(0,d)||o,h=o.substring(d+l.splitter.length);if(l.fn){const f=l.fn(u);f?Object.assign(r,f):h=u+h}return h}},e),r.year&&!r.date&&(r.date=1);const a=H.create(r,i);return a?s=a:i||(s=new Date(e)),s}static create(e,t=!1){const i=F({},e);let r=isNaN(i.year),n=!1;if(!r){let a=!0;by.forEach(o=>{(!(o in i)||isNaN(i[o]))&&(i[o]=0),a=a&&i[o]===null}),r=a}if(i.amPm==="am"?i.hours=i.hours%12:i.amPm==="pm"&&(i.hours=i.hours%12+12),"timeZone"in i&&(n=!0,i.minutes-=i.timeZone),r||t&&(i.year==null||i.month==null||i.date==null))return null;const s=[Po(i.year,Vc),Po(i.month,jc),Po(i.date,Wc),i.hours,i.minutes,i.seconds,i.milliseconds];return n?new Date(Date.UTC(...s)):new Date(...s)}static toUTC(e){return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))}static format(e,t=H.defaultFormat){if(!e||isNaN(e))return null;let i=Ls[t],r="";if(!i){i=Ls[t]=[];for(let n=0;n<t.length;n++){const s=t.slice(n).match(hy),a=s?.[0];if(a){const o=this.localize("L{formats}")||{},l=o[a]||je[a];i.push(l),n+=a.length-1}else if(t[n]==="{"){const o=t.indexOf("}",n+1);o===-1?(i.push(t.substr(n+1)),n=t.length):(i.push(t.substring(n+1,o)),n=o)}else i.push(t[n])}}return i.forEach(n=>{typeof n=="string"?r+=n:r+=n(e)}),r}static formatRange(e,t){return t.replace(oy,(i,r,n)=>b.format(e[r==="S"?0:1],n))}static asMilliseconds(e,t=null){return typeof e=="string"&&(t=e,e=1),H.as("millisecond",e,t)}static asMonths(e){const t=H.as("ms",H.daysInMonth(e),"day"),i=(e.valueOf()-H.startOf(e,"month").valueOf())/t;return e.getYear()*12+e.getMonth()+i}static monthsToDate(e){const t=Math.floor(e),i=e-t,r=new Date(0,t),n=H.as("ms",H.daysInMonth(r),"days");return r.setTime(r.getTime()+i*n),r}static formatDelta(e,t){let i,r;typeof t=="boolean"?i=t:t&&(i=t.abbrev);const n=this.getDelta(e,t),s=[],a=t?.separator||(i?"":" ");for(r in n)s.push(`${n[r]}${a}${r}`);return t?.asString===!1?s:s.join(", ")}static getDelta(e,t){let i,r,n,s,a,o,l;typeof t=="boolean"?i=t:t&&(i=t.abbrev,s=H.normalizeUnit(t.precision),o=t.maxUnit,l=!i&&t.ignoreLocale);const d={},u=i?H.getShortNameOfUnit:H.getLocalizedNameOfUnit,h=o?Ho.slice(Ho.indexOf(o)):Ho;for(a of h)if(r=H.as(a,e),n=s===a,r=Math[n?"round":"floor"](r),(r||n&&!d.length)&&(d[l?a:u.call(H,a,r!==1)]=r,e-=H.as("ms",r,a)),n||!e)break;return d}static as(e,t,i="ms"){return typeof t=="string"&&(t=H.parseDuration(t)),typeof t=="object"&&(i=t.unit,t=t.magnitude),e===i||(e=H.normalizeUnit(e),i=H.normalizeUnit(i),e===i)?t:kt[i]>kt[e]?t*Math.abs(st[i][e]):t/Math.abs(st[e][i])}static formatContainsHourInfo(e){const t=/(\\.)/g;return/([HhKkmSsAa]|LT|L{3,}|l{3,})/.test(e.replace(t,""))}static is24HourFormat(e){return H.format(H.getTime(13,0,0),e).includes("13")}static add(e,t,i="ms",r=!0){let n;if(typeof e=="string"?n=H.parse(e):r?n=new Date(e.getTime()):n=e,typeof t=="string"){const s=b.parseDuration(t);t=s.magnitude,i=s.unit}else t&&typeof t=="object"&&(i=t.unit,t=t.magnitude);if(!i||t===0)return n;switch(i=H.normalizeUnit(i),i){case"millisecond":n.setTime(n.getTime()+t);break;case"second":n.setTime(n.getTime()+t*1e3);break;case"minute":n.setTime(n.getTime()+t*6e4);break;case"hour":n.setTime(n.getTime()+t*36e5);break;case"day":t%1===0?(n.setDate(n.getDate()+t),n.getHours()===23&&e.getHours()===0&&n.setHours(n.getHours()+1)):n.setTime(n.getTime()+t*864e5);break;case"week":n.setDate(n.getDate()+t*7);break;case"month":{let s=n.getDate();s>28&&(s=Math.min(s,H.getLastDateOfMonth(H.add(H.getFirstDateOfMonth(n),t,"month")).getDate())),n.setDate(s),n.setMonth(n.getMonth()+t);break}case"quarter":H.add(n,t*3,"month",!1);break;case"year":n.setFullYear(n.getFullYear()+t);break;case"decade":n.setFullYear(n.getFullYear()+t*10);break}return n}static diff(e,t,i="ms",r=!0){if(i=H.normalizeUnit(i),!e||!t)return 0;let n;switch(i){case"year":n=H.diff(e,t,"month")/12;break;case"quarter":n=H.diff(e,t,"month")/3;break;case"month":n=(t.getFullYear()-e.getFullYear())*12+(t.getMonth()-e.getMonth());break;case"week":n=H.diff(e,t,"day")/7;break;case"day":{const s=e.getTimezoneOffset()-t.getTimezoneOffset();n=(t-e+s*60*1e3)/864e5;break}case"hour":n=(t-e)/36e5;break;case"minute":n=(t-e)/6e4;break;case"second":n=(t-e)/1e3;break;case"millisecond":n=t-e;break}return r?n:Math.round(n)}static startOf(e,t="day",i=!0,r=H.weekStartDay){if(!e)return null;switch(t=H.normalizeUnit(t),i&&(e=H.clone(e)),t){case"year":return e.setMonth(0,1),e.setHours(0,0,0,0),e;case"quarter":return e.setMonth((H.get(e,"quarter")-1)*3,1),e.setHours(0,0,0,0),e;case"month":return e.setDate(1),e.setHours(0,0,0,0),e;case"week":{const n=e.getDay()-r;return e.setDate(e.getDate()-n),e.setHours(0,0,0,0),e}case"day":return e.setHours(0,0,0,0),e;case"hour":e.getMinutes()>0&&e.setMinutes(0);case"minute":e.getSeconds()>0&&e.setSeconds(0);case"second":e.getMilliseconds()>0&&e.setMilliseconds(0);case"millisecond":return e}}static endOf(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+1)}static clone(e){return new Date(e.getTime())}static clearTime(e,t=!0){return e?(t&&(e=new Date(e.getTime())),e.setHours(0,0,0,0),e):null}static midnight(e,t){let i=H.clearTime(e);return t&&i<e&&(i=H.add(i,1,"d")),i}static getTimeOfDay(e,t="ms"){const i=e.getHours()*st.hour.millisecond+e.getMinutes()*st.minute.millisecond+e.getSeconds()*st.second.millisecond+e.getMilliseconds();return t==="ms"?i:H.as(t,i,"ms")}static set(e,t,i){if(!t)return e;if(typeof t=="string")switch(H.normalizeUnit(t)){case"millisecond":(i!==0||e.getMilliseconds()>0)&&e.setMilliseconds(i);break;case"second":(i!==0||e.getSeconds()>0)&&e.setSeconds(i);break;case"minute":(i!==0||e.getMinutes()>0)&&e.setMinutes(i);break;case"hour":e.setHours(i);break;case"day":case"date":e.setDate(i);break;case"week":throw new Error("week not implemented");case"month":e.setMonth(i);break;case"quarter":e.setDate(1),e.setMonth((i-1)*3);break;case"year":e.setFullYear(i);break}else Object.entries(t).sort((r,n)=>kt[r[0]]-kt[n[0]]).forEach(([r,n])=>{H.set(e,r,n)});return e}static setDateToMidday(e,t=!0){return H.set(H.clearTime(e,t),"hour",12)}static constrain(e,t,i){return t!=null&&(e=H.max(e,t)),i==null?e:H.min(e,i)}static getTime(e,t=0,i=0,r=0){return e instanceof Date&&(r=e.getMilliseconds(),i=e.getSeconds(),t=e.getMinutes(),e=e.getHours()),new Date(Vc,jc,Wc,e,t,i,r)}static copyTimeValues(e,t){return e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds()),e.setMilliseconds(t.getMilliseconds()),e}static get isDSTEnabled(){const e=new Date().getFullYear(),t=new Date(e,0,1),i=new Date(e,6,1);return t.getTimezoneOffset()!==i.getTimezoneOffset()}static isDST(e){const t=e.getFullYear(),i=new Date(t,0,1),r=new Date(t,6,1);return e.getTimezoneOffset()<Math.max(i.getTimezoneOffset(),r.getTimezoneOffset())}static isBefore(e,t){return e<t}static isAfter(e,t){return e>t}static isEqual(e,t,i=null){return i===null?e&&t&&e.getTime()===t.getTime():H.startOf(e,i)-H.startOf(t,i)===0}static compare(e,t,i=null){return i&&(e=H.startOf(e,i),t=H.startOf(t,i)),e<t?-1:e>t?1:0}static clamp(e,t,i){if(!isNaN(e))return t!=null&&(e=Math.max(e,t)),i!=null&&(e=Math.min(e,i)),new Date(e)}static isSameDate(e,t){return H.compare(e,t,"d")===0}static isSameTime(e,t){return e.getHours()===t.getHours()&&e.getMinutes()===t.getMinutes()&&e.getSeconds()===t.getSeconds()&&e.getMilliseconds()===t.getMilliseconds()}static isStartOf(e,t){return H.isEqual(e,H.startOf(e,t))}static betweenLesser(e,t,i){return t.getTime()<=e.getTime()&&e.getTime()<i.getTime()}static betweenLesserEqual(e,t,i){return t.getTime()<=e.getTime()&&e.getTime()<=i.getTime()}static intersectSpans(e,t,i,r){return H.betweenLesser(e,i,r)||H.betweenLesser(i,e,t)}static compareUnits(e,t){return Math.sign(kt[H.normalizeUnit(e)]-kt[H.normalizeUnit(t)])}static timeSpanContains(e,t,i,r){return i-e>=0&&t-r>=0}static get weekStartDay(){return H._weekStartDay==null&&(H._weekStartDay=this.localize("L{weekStartDay}")||0),H._weekStartDay}static get nonWorkingDays(){return F({},this.localize("L{nonWorkingDays}"))}static get nonWorkingDaysAsArray(){return Object.keys(this.nonWorkingDays).map(Number)}static get weekends(){return F({},this.localize("L{weekends}"))}static get(e,t){switch(H.normalizeUnit(t)){case"millisecond":return e.getMilliseconds();case"second":return e.getSeconds();case"minute":return e.getMinutes();case"hour":return e.getHours();case"date":case"day":return e.getDate();case"week":return je.W(e);case"month":return e.getMonth();case"quarter":return Math.floor(e.getMonth()/3)+1;case"year":return e.getFullYear()}return null}static daysInYear(e){const t=e.getFullYear(),i=new Date(t+1,0,1)-new Date(t,0,1);return this.as("day",i)}static daysInMonth(e){return 32-new Date(e.getFullYear(),e.getMonth(),32).getDate()}static hoursInDay(e){const t=e.getFullYear(),i=e.getMonth(),r=e.getDate(),n=new Date(t,i,r+1)-new Date(t,i,r);return this.as("hour",n)}static getNormalizedUnitDuration(e,t){let i;switch(t){case"month":i=H.asMilliseconds(H.daysInMonth(e),"day");break;case"year":i=H.asMilliseconds(H.daysInYear(e),"day");break;case"day":i=H.asMilliseconds(H.hoursInDay(e),"hour");break;default:i=H.asMilliseconds(t)}return i}static getFirstDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth(),1)}static getLastDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0)}static min(e,t){return e.getTime()<t.getTime()?e:t}static max(e,t){return e.getTime()>t.getTime()?e:t}static getNext(e,t,i=1,r=H.weekStartDay){if(t==="week"){const n=H.clone(e),s=n.getDay();return H.startOf(n,"day",!1),H.add(n,r-s+7*(i-(r<=s?0:1)),"day",!1),n.getDay()!==r&&H.add(n,1,"hour"),n}return H.startOf(H.add(e,i,t),t,!1)}static isValidDate(e){return H.isDate(e)&&!isNaN(e)}static isDate(e){return e&&Gf.call(e)===ay}static getStartOfNextDay(e,t=!1,i=!1){let r=H.add(i?e:H.clearTime(e,t),1,"day");if(r.getDate()===e.getDate()){const n=H.add(H.clearTime(e,t),2,"day").getTimezoneOffset(),s=e.getTimezoneOffset();r=H.add(r,s-n,"minute")}return r}static getEndOfPreviousDay(e,t=!1){const i=t?e:H.clearTime(e,!0);return i-e?i:H.add(i,-1,"day")}static getWeekDescription(e,t=e){const i=e.getMonth()===t.getMonth()?b.format(e,"MMMM"):`${b.format(e,"MMM")} - ${b.format(t,"MMM")}`,r=b.getWeekNumber(e);return`${r[1]}, ${i} ${r[0]}`}static getWeekNumber(e,t=b.weekStartDay){const i=new Date(e.getFullYear(),0,1),r=new Date(e.getFullYear(),11,31),n=Bc(i.getDay()-t),s=Bc(r.getDay()-t),a=ly(e,i);let o;if(n<4?o=Math.floor((a+n-1)/7)+1:o=Math.floor((a+n-1)/7),o){let d=e.getFullYear();return o===53&&s<3&&(d++,o=1),[d,o]}const l=b.getWeekNumber(new Date(e.getFullYear()-1,11,31))[1];return[e.getFullYear()-1,l]}static formatCount(e,t){return t=H.normalizeUnit(t),e!==1&&(t+="s"),e+" "+t}static getUnitToBaseUnitRatio(e,t,i=!1){return e=H.normalizeUnit(e),t=H.normalizeUnit(t),e===t?1:st[e]&&st[e][t]&&(i||st[e][t]>0)?1/H.as(t,1,e):st[t]&&st[t][e]&&(i||st[t][e]>0)?H.as(e,1,t):-1}static getShortNameOfUnit(e){return e=H.parseTimeUnit(e),H.unitLookup[e].abbrev}static getLocalizedNameOfUnit(e,t=!1){const i=e.charAt(0)===e.charAt(0).toUpperCase();return e=H.normalizeUnit(e),e=H.parseTimeUnit(e),e=H.unitLookup[e][t?"plural":"single"],i&&(e=z.capitalize(e)),e}static normalizeUnit(e){if(!e)return null;const t=e.toLowerCase();return t==="date"||or.includes(t)?t:Yc[e]||Yc[t]}static getUnitByName(e){return H.normalizeUnit(e)||H.normalizeUnit(H.parseTimeUnit(e))}static getDurationInUnit(e,t,i,r){return H.diff(e,t,i,r)}static doesUnitsAlign(e,t){return!(e!==t&&t==="week")}static getSmallerUnit(e){return or[kt[H.normalizeUnit(e)]-1]||null}static getLargerUnit(e){return or[kt[H.normalizeUnit(e)]+1]||null}static round(e,t,i,r){return H.snap("round",e,t,i,r)}static floor(e,t,i,r){return H.snap("floor",e,t,i,r)}static ceil(e,t,i,r){return H.snap("ceil",e,t,i,r)}static snap(e,t,i,r,n=H.weekStartDay){const s=Sy[e];if(typeof i=="string"&&(i=H.parseDuration(i)),U.isObject(i)){const a=i.magnitude||i.increment;switch(i.unit){case"week":{const o=t.getDay();return r=H.add(H.clearTime(t),o>=n?n-o:-(o-n+7),"day"),H[e](t,`${a*7} days`,r)}case"month":{t=H.asMonths(t);let o;return r?(r=H.asMonths(r),o=t+s(t-r,a)):o=s(t,a),H.monthsToDate(o)}case"quarter":return H[e](t,`${a*3} months`,r);case"year":return H[e](t,`${a*12} months`,r);case"decade":return H[e](t,`${a*10} years`,r)}i=H.as("ms",a,i.unit)}if(r){const a=H.as("ms",r.getTimezoneOffset()-t.getTimezoneOffset(),"ms");return new Date(r.valueOf()+s(H.diff(r,t,"ms")+a,i))}else{const a=t.getTimezoneOffset()*60*1e3;return new Date(s(t.valueOf()-a,i)+a)}}static parseDuration(e,t=!0,i){var r;const n=t?py:vy,s=n.exec(e);if(e==null||!s)return null;const a=Cy((r=s[1])===null||r===void 0?void 0:r.replace(",",".")),o=H.parseTimeUnit(s[2])||i;return o?{magnitude:a,unit:o}:null}static parseTimeUnit(e){const t=e==null?null:H.durationRegEx.exec(e.toLowerCase());if(!t)return null;for(let i=0;i<or.length;i++)if(t[i+1])return or[i]}static getGMTOffset(e=new Date){if(!e)return;const t=e.getTimezoneOffset();return t?(t>0?"-":"+")+Math.abs(Math.trunc(t/60)).toString().padStart(2,"0")+":"+Math.abs(t%60).toString().padStart(2,"0"):"Z"}static fillDayNames(){const e=new Date("2000-01-01T12:00:00"),t=H._dayNames||[],i=H._dayShortNames||[];t.length=0,i.length=0;for(let r=2;r<9;r++)e.setDate(r),t.push(H.format(e,"dddd")),i.push(H.format(e,"ddd"));H._dayNames=t,H._dayShortNames=i}static getDayNames(){return H._dayNames}static getDayName(e){return H._dayNames[e]}static getDayShortNames(){return H._dayShortNames}static getDayShortName(e){return H._dayShortNames[e]}static fillMonthNames(){const e=new Date("2000-01-15T12:00:00"),t=H._monthNames||[],i=H._monthShortNames||[],r={},n={};t.length=0,i.length=0;for(let s=0;s<12;s++){e.setMonth(s);const a=H.format(e,"MMMM");t.push(a);const o=H.format(e,"MMM");i.push(o),r[a.toLowerCase()]={name:a,value:s},n[o.toLowerCase()]={name:o,value:s}}H._monthNames=t,H._monthShortNames=i,H._monthNamesIndex=r,H._monthShortNamesIndex=n}static getMonthShortNames(){return H._monthShortNames}static getMonthShortName(e){return H._monthShortNames[e]}static getMonthNames(){return H._monthNames}static getMonthName(e){return H._monthNames[e]}static set locale(e){mi=e,bi={},Ls={},Mn={}}static get locale(){return mi}static setupDurationRegEx(e=[],t=[]){const i=this,r={};let n="";for(let s=0;s<t.length;s++){const a=t[s],o=e[s];o.canonicalUnitName=or[s],r[o.single]=r[o.single.toUpperCase()]=r[o.canonicalUnitName]=r[o.canonicalUnitName.toUpperCase()]=o,n+=`${s?"|":""}(`;for(let l=0;l<a.length;l++)n+=`${a[l]}|`;if(mi=i.localize("L{locale}")||"en-US",mi!=="en-US"){const l=yy[s];for(let d=0;d<l.length;d++)n+=`${l[d]}|`}n+=`${o.single}|${o.plural}|${o.canonicalUnitName}|${o.canonicalUnitName}s)`}i.unitLookup=r,i.durationRegEx=new RegExp(`^(?:${n})$`)}static applyLocale(){const e=this,t=e.localize("L{unitAbbreviations}")||[],i=e.unitNames=e.localize("L{unitNames}");i!=="unitNames"&&(mi=e.localize("L{locale}")||"en-US",mi==="en-US"?ri=qf:ri=e.localize("L{ordinalSuffix}")||ri,Ls={},Mn={},$o={},bi={},H._weekStartDay=null,H.setupDurationRegEx(i,t),H.fillDayNames(),H.fillMonthNames())}}M(b,"MS_PER_DAY",Ll*24);const H=b;H.useIntlFormat=qe;He.ion({locale:"applyLocale",prio:1e3,thisObj:H});He.locale&&H.applyLocale();b._$name="DateHelper";const{hasOwn:No}=U,Kc=1.005 .toFixed(2)==="1.01"?null:function(c,e){const t=c.toString().split("."),i=+(t[1]?t.join(".")+"1":t[0]);return c.toFixed.call(i,e)};class T extends U{static transformArrayToNamedObject(e,t="ref"){const i={};return e.forEach((r,n)=>{const s=r[t]!=null&&r[t].toString().length?r[t]:n;i[s]=r}),i}static transformNamedObjectToArray(e,t="ref"){return Object.keys(e).filter(i=>e[i]).map(i=>{const r=e[i];return r[t]=i,r})}static isEqual(e,t,i=!1){if(e===null&&t!==null||e===void 0&&t!==void 0||t===null&&e!==null||t===void 0&&e!==void 0)return!1;if(e==null&&t==null||e===t)return!0;const r=typeof e;if(r===typeof t){switch(r){case"number":case"string":case"boolean":return e===t}switch(!0){case(e instanceof Date&&t instanceof Date):return e.getTime()===t.getTime();case(Array.isArray(e)&&Array.isArray(t)):return e.length===t.length?e.every((s,a)=>ht.isEqual(s,t[a],i)):!1;case(r==="object"&&e.constructor.prototype===t.constructor.prototype):return i?ht.isDeeplyEqual(e,t,i):JSON.stringify(e)===JSON.stringify(t)}}return String(e)===String(t)}static isDeeplyEqual(e,t,i={}){if(e===t)return!0;if(!e||!t)return!1;const r=ht.keys(e,i.ignore),n=ht.keys(t,i.ignore);if(r.length!==n.length)return!1;for(let s=0;s<r.length;s++){const a=r[s],o=n[s];if(a!==o)return!1;const l=e[a],d=t[o];if(!(i.shouldEvaluate&&i.shouldEvaluate(a,{value:l,object:e},{value:d,object:t})===!1)){if(i.evaluate){const u=i.evaluate(a,{value:l,object:e},{value:d,object:t});if(u===!1)return!1;if(u===!0)continue}if(!ht.isEqual(l,d,i))return!1}}return!0}static isPartial(e,t){return e=String(e).toLowerCase(),t=String(t).toLowerCase(),e.indexOf(t)!==-1}static isLessThan(e,t){return e instanceof Date&&t instanceof Date?b.isBefore(e,t):e<t}static isMoreThan(e,t){return e instanceof Date&&t instanceof Date?b.isAfter(e,t):e>t}static fork(e){let t,i,r;if(e&&e.constructor===Object){t=Object.setPrototypeOf({},e);for(i in e)r=e[i],r&&(r.constructor===Object?t[i]=ht.fork(r):r instanceof Array&&(t[i]=r.slice()))}else t=e;return t}static copyProperties(e,t,i){let r,n;for(n=0;n<i.length;n++)r=i[n],r in t&&(e[r]=t[r]);return e}static copyPropertiesIf(e,t,i){if(t)for(const r of i)r in e||(e[r]=t[r]);return e}static entries(e,t){const i=[],r=typeof t=="function";if(e)for(const n in e)(r?!t(n,e[n]):!(t!=null&&t[n]))&&i.push([n,e[n]]);return i}static fromEntries(e,t){if(t=t||{},e)for(let i=0;i<e.length;++i)t[e[i][0]]=e[i][1];return t}static keys(e,t,i){const r=[],n=typeof t=="function";if(e){let s=0;for(const a in e)(n?!t(a,e[a]):!(t!=null&&t[a]))&&(r.push(i?i(a,s):a),++s)}return r}static values(e,t,i){const r=[],n=typeof t=="function";if(e){let s=0;for(const a in e)(n?!t(a,e[a]):!(t!=null&&t[a]))&&(r.push(i?i(e[a],s):e[a]),++s)}return r}static pathExists(e,t){return t.split(".").every(r=>!e||!(r in e)?!1:(e=e[r],!0))}static pathifyKeys(e){const t={};for(const i in e)if(No(e,i))if(Array.isArray(e[i]))t[i]=e[i].slice();else if(e[i]instanceof Object){const r=this.pathifyKeys(e[i]);for(const n in r)t[`${i}.${n}`]=r[n]}else t[i]=e[i];return t}static deletePath(e,t){t.split(".").reduce((i,r,n,s)=>{if(i==null)return null;if(No(i,r))if(n===s.length-1)delete i[r];else return i[r]},e)}static coerce(e,t){const i=U.typeOf(e),r=U.typeOf(t),n=typeof e=="string";if(i!==r)switch(r){case"string":return String(e);case"number":return Number(e);case"boolean":return n&&(!e||e==="false"||e==="0")?!1:Boolean(e);case"null":return n&&(!e||e==="null")?null:!1;case"undefined":return n&&(!e||e==="undefined")?void 0:!1;case"date":return n&&isNaN(e)?b.parse(e):Date(Number(e))}return e}static wrapProperty(e,t,i,r,n=!0){const s={};let a=Object.getPrototypeOf(e),o=Object.getOwnPropertyDescriptor(a,t);for(;!o&&a&&n;)a=Object.getPrototypeOf(a),a&&(o=Object.getOwnPropertyDescriptor(a,t));o?(o.set?s.set=l=>{o.set.call(e,l),r&&r.call(e,o.get.call(e))}:s.set=r,o.get?s.get=()=>{let l=o.get.call(e);return i&&(l=i.call(e,l)),l}:s.get=i):(s.set=l=>{e[`_${t}`]=l,r&&r.call(e,l)},s.get=()=>{let l=e[`_${t}`];return i&&(l=i.call(e,l)),l}),Object.defineProperty(e,t,s)}static hookProperty(e,t,i){const r=T.getPropertyDescriptor(i.prototype,"value"),n=T.getPropertyDescriptor(e,t),s=`_${t}`,a=class{get value(){return n?n.get.call(this):this[s]}set value(l){n?n.set.call(this,l):this[s]=l}},o=T.getPropertyDescriptor(a.prototype,"value");return Object.setPrototypeOf(i.prototype,a.prototype),Object.defineProperty(e,t,{configurable:!0,get:r.get||o.get,set:r.set||o.set}),()=>delete e[t]}static getPropertyDescriptor(e,t){let i=null;for(let r=e;r&&!i&&!No(r,"isBase");r=Object.getPrototypeOf(r))i=Object.getOwnPropertyDescriptor(r,t);return i}static cleanupProperties(e,t=!1){return Object.entries(e).forEach(([i,r])=>{t?r===void 0&&delete e[i]:r==null&&delete e[i]}),e}static removeAllProperties(e){return Object.keys(e).forEach(t=>delete e[t]),e}static assertType(e,t,i){const r=U.typeOf(e);if(e!=null&&r!==t)throw new Error(`Incorrect type "${r}" for ${i}, expected "${t}"`)}static assertObject(e,t){ht.assertType(e,"object",t)}static assertInstance(e,t){ht.assertType(e,"instance",t)}static assertClass(e,t){ht.assertType(e,"class",t)}static assertFunction(e,t){if(typeof e!="function"||e.isBase||e.$$name)throw new Error(`Incorrect type for ${t}, got "${e}" (expected a function)`)}static assertNumber(e,t){const i=Number(e);if(typeof e!="number"||isNaN(i))throw new Error(`Incorrect type for ${t}, got "${e}" (expected a Number)`)}static assertBoolean(e,t){ht.assertType(e,"boolean",t)}static assertString(e,t){ht.assertType(e,"string",t)}static assertArray(e,t){ht.assertType(e,"array",t)}static toFixed(e,t){return Kc?Kc(e,t):e.toFixed(t)}static roundTo(e,t=1){return Math.round(e/t)*t}static round(e,t){if(t==null)return e;const i=10**t;return Math.round(e*i)/i}static getMapPath(e,t,i){const r=Array.isArray(t)?t:typeof t=="string"?t.split("."):[t],n=r.length===1,s=r[0],a=e.has(s)?e.get(s):e.set(s,n?i:{}).get(s);return n?a:ht.getPathDefault(a,r.slice(1),i)}}const ht=T;T._$name="ObjectHelper";const Xc=["border-top-width","border-right-width","border-bottom-width","border-left-width"],Dy=["margin-top","margin-right","margin-bottom","margin-left"],Ey=["padding-top","padding-right","padding-bottom","padding-left"],di={t:"border-top-width",r:"border-right-width",b:"border-bottom-width",l:"border-left-width"},Os={t:"padding-top",r:"padding-right",b:"padding-bottom",l:"padding-left"},xy=Object.freeze({x:0,y:0}),Ry=/^([trblc])(\d*)-([trblc])(\d*)$/i,Ty=/^([trblc])(\d*)$/i,ma=["top","right","bottom","left"],kn={t:0,r:1,b:2,l:3},Bo=["b-t","l-r","t-b","r-l"],My={bt:1,tb:1,lr:2,rl:2},Xf=Object.freeze([0,0]),ky=["width","height"],na=(c,e=c,t=c,i=e)=>Array.isArray(c)?na.apply(null,c):[c,e,t,i];function Zf(c,e){const t=Ry.exec(c),i=t[1],r=t[3],n=parseInt(t[2]||50),s=parseInt(t[4]||50),a=e&&!(kn[i]&1)?100-n:n,o=e&&!(kn[r]&1)?100-s:s,l=My[i+r];return{myAlignmentPoint:i+a,myEdge:i,myOffset:a,targetAlignmentPoint:r+o,targetEdge:r,targetOffset:o,startZone:kn[r],edgeAligned:l}}function Iy(c){return`${ma[(kn[c.myEdge]+2)%4][0]}${c.myOffset}-${ma[(kn[c.targetEdge]+2)%4][0]}${c.targetOffset}`}function Fy(c){return c==null?Xf:typeof c=="number"?[c,c]:c}class ${get isRectangle(){return!0}static from(e,t,i){var r,n;if(typeof e=="string"?e=document.querySelector(e):((r=e)===null||r===void 0?void 0:r.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&(e=e.host||e.ownerDocument),typeof t=="string"&&(t=document.querySelector(t)),e==null||e.isRectangle)return e;if(e=e.element||e,i===void 0&&typeof t=="boolean"&&(i=t,t=null),!((n=t)!==null&&n!==void 0&&n.isRectangle))if(t){let{scrollLeft:u,scrollTop:h}=t;K.isSafari&&t===document.body&&(u=h=0),t=$.from(t).translate(-u,-h)}else t=xy;const s=e===document||e===globalThis,a=e===document.body&&document.body.offsetHeight===0,o=a&&e.getBoundingClientRect(),l=a?new $(o.left,o.top,o.width,document.body.parentElement.scrollHeight):s?new $(0,0,globalThis.innerWidth,globalThis.innerHeight):e.getBoundingClientRect(),d=i||s?[0,0]:[globalThis.pageXOffset,globalThis.pageYOffset];return new $(l.left+d[0]-t.x,l.top+d[1]-t.y,l.width,l.height)}static fromScreen(e,t){return $.from(e,t,!0)}static inner(e,t,i=!1){const r=this.from(e,t,i);if(document.body.contains(e)){const n=S.getStyleValue(e,Xc);r.x+=parseFloat(n[di.l]),r.y+=parseFloat(n[di.t]),r.right-=parseFloat(n[di.r]),r.bottom-=parseFloat(n[di.b])}return r}static content(e,t,i=!1){const r=this.from(e,t,i);if(document.body.contains(e)){const n=S.getStyleValue(e,Xc),s=S.getStyleValue(e,Ey);r.x+=parseFloat(n[di.l])+parseFloat(s[Os.l]),r.y+=parseFloat(n[di.t])+parseFloat(s[Os.t]),r.right-=parseFloat(n[di.r])+parseFloat(s[Os.r]),r.bottom-=parseFloat(n[di.b])+parseFloat(s[Os.b])}return r}static client(e,t,i=!1){const r=this.content(e,t,i),n=S.scrollBarWidth;let s;return n&&(e.scrollHeight>e.clientHeight&&S.getStyleValue(e,"overflow-y")!=="hidden"&&(s=parseFloat(S.getStyleValue(e,"padding-right")),r.right+=s-Math.max(s,n)),e.scrollWidth>e.clientWidth&&S.getStyleValue(e,"overflow-x")!=="hidden"&&(s=parseFloat(S.getStyleValue(e,"padding-bottom")),r.bottom+=s-Math.max(s,n))),r}static outer(e,t,i=!1){const r=this.from(e,t,i);if(document.body.contains(e)){const n=S.getStyleValue(e,Dy);r.x-=parseFloat(n["margin-left"]),r.y-=parseFloat(n["margin-top"]),r.right+=parseFloat(n["margin-right"]),r.bottom+=parseFloat(n["margin-bottom"])}return r}static union(...e){let{x:t,y:i,right:r,bottom:n}=e[0],s;if(e.length>1)for(let a=1;a<e.length;a++)s=e[a],s.x<t&&(t=s.x),s.y<i&&(i=s.y),s.right>r&&(r=s.right),s.bottom>n&&(n=s.bottom);return new $(t,i,r-t,n-i)}roundPx(e=globalThis.devicePixelRatio||1){const t=this;return t._x=S.roundPx(t._x,e),t._y=S.roundPx(t._y,e),t._width=S.roundPx(t._width,e),t._height=S.roundPx(t._height,e),t}static get $$name(){return hasOwnProperty.call(this,"$name")&&this.$name||hasOwnProperty.call(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}constructor(e,t,i,r){T.assertNumber(e,"Rectangle.x"),T.assertNumber(t,"Rectangle.y"),T.assertNumber(i,"Rectangle.width"),T.assertNumber(r,"Rectangle.height");const n=this;i<0&&(e+=i,i=-i),r<0&&(t+=r,r=-r),n._x=e,n._y=t,n._width=i,n._height=r}clone(){const e=this,t=new $(e.x,e.y,e.width,e.height);return t.isAlignRectangle=e.isAlignRectangle,t.minHeight=e.minHeight,t.minWidth=e.minWidth,t}contains(e){const t=this;return e.isRectangle?e._x>=t._x&&e._y>=t._y&&e.right<=t.right&&e.bottom<=t.bottom:!1}intersect(e,t=!1,i=!1){const r=this,n=Math.max(r.y,e.y),s=Math.min(r.right,e.right),a=Math.min(r.bottom,e.bottom),o=Math.max(r.x,e.x);return(i?a>=n&&s>=o:a>n&&s>o)?t?!0:new $(o,n,s-o,a-n):!1}equals(e,t=!1){const i=t?r=>Math.round(r):r=>r;return e.isRectangle&&i(e.x)===i(this.x)&&i(e.y)===i(this.y)&&i(e.width)===i(this.width)&&i(e.height)===i(this.height)}translate(e,t){return this._x+=e||0,this._y+=t||0,this}moveTo(e,t){return e!=null&&(this._x=e),t!=null&&(this._y=t),this}getDelta(e){return[e.x-this.x,e.y-this.y]}get center(){return new $.Point(this.x+this.width/2,this.y+this.height/2)}set x(e){const t=e-this._x;this._x=e,this._width-=t}get x(){return this._x}get start(){return this.left}set left(e){this.x=e}get left(){return this.x}set top(e){this.y=e}get top(){return this.y}set y(e){const t=e-this._y;this._y=e,this._height-=t}get y(){return this._y}set width(e){this._width=e}get width(){return this._width}set height(e){this._height=e}get height(){return this._height}set right(e){this._width=e-this._x}get right(){return this._x+this._width}get end(){return this.right}set bottom(e){this._height=e-this._y}get bottom(){return this._y+this._height}getStart(e,t=!0){return t?e?this.right:this.left:this.top}getEnd(e,t=!0){return t?e?this.left:this.right:this.bottom}get area(){return this.width*this.height}set minWidth(e){const t=this;isNaN(e)?t._minWidth=null:(t._minWidth=Number(e),t.isAlignRectangle||(t.width=Math.max(t.width,t._minWidth)))}get minWidth(){return this._minWidth}set minHeight(e){const t=this;isNaN(e)?t._minHeight=null:(t._minHeight=Number(e),t.isAlignRectangle||(t.height=Math.max(t.height,t._minHeight)))}get minHeight(){return this._minHeight}adjust(e,t,i,r){const n=this;return n.x+=e,n.y+=t,n.width+=i,n.height+=r,n}inflate(e,t=e,i=e,r=t){return Array.isArray(e)&&([e,t,i,r]=na(e)),this.adjust(-r,-e,t,i)}deflate(e,t=e,i=e,r=t){return Array.isArray(e)&&([e,t,i,r]=na(e)),this.adjust(r,e,-t,-i)}constrainTo(e,t){const i=this,r=i.height,n=i.y,s=i.minWidth||i.width,a=i.minHeight||i.height;if(i.height>=e.height){if(t&&a>e.height)return!1;i._y=e.y,i.height=e.height}if(i.width>=e.width){if(t&&s>e.width)return i.y=n,i.height=r,!1;i._x=e.x,i.width=e.width}let o=i.bottom-e.bottom;return o>0&&i.translate(0,-o),o=i.right-e.right,o>0&&i.translate(-o),o=e.y-i.y,o>0&&i.translate(0,o),o=e.x-i.x,o>0&&i.translate(o),i}alignTo(e){let t=this.clone(),{target:i,constrainTo:r,constrainPadding:n}=e,s,a,o,l;if(i&&!i.isRectangle&&(i=$.from(i.element?i.element:i)),r){if(!r.isRectangle){l=r===globalThis||r===document;const k="ignorePageScroll"in e?e.ignorePageScroll:!l;r=$.from(r.element?r.element:r,null,k)}n&&(n=na(n),n[0]=Math.min(n[0],i.top),n[1]=Math.min(n[1],r.right-i.right),n[2]=Math.min(n[0],r.bottom-i.bottom),n[3]=Math.min(n[0],i.left),r=r.deflate.apply(r.clone(),n))}const d=this,u=Fy(e.offset),{align:h,axisLock:f,anchorSize:g,anchorPosition:m,matchSize:p,position:v,rtl:y}=e,C=Zf(h,y),D=r&&r.clone(),w=[],E=[{zone:a=C.startZone,align:h}],R=p&&ky[C.startZone&1],x=d[R];if(R&&f?t[R]=i[R]:!C.edgeAligned&&p&&(t.width=i.width,t.height=i.height),r&&t.constrainTo(r),r&&C.startZone!=null)if(f)E.push({zone:a=(a+2)%4,align:Iy(C)}),f==="flexible"&&(E.push({zone:a=(C.startZone+1)%4,align:Bo[a]}),E.push({zone:a=(a+2)%4,align:Bo[a]}));else for(let k=1;k<4;k++)E.push({zone:a=(a+1)%4,align:Bo[a]});if(m){const k=C.startZone&1?"y":"x";s={[k]:m[k],edge:ma[(C.startZone+2)%4]}}if(D&&i&&(D.adjust(-i.width,-i.height,i.width,i.height),i.constrainTo(D)),t.minWidth=d.minWidth,t.minHeight=d.minHeight,v)t.moveTo(v.x,v.y),r&&t.constrainTo(r);else{const k=C.myEdge==="c"||C.targetEdge==="c",I=g&&!k?[g[1]+u[0],g[1]+u[1]]:u,A=i.getAlignmentPoint(C.targetAlignmentPoint,I),L=t.getAlignmentPoint(C.myAlignmentPoint);t.translate(A[0]-L[0],A[1]-L[1]);let O=t.intersect(i,!0);if(O)r&&t.constrainTo(r),o=C.startZone,t.translate(...I);else if(r&&!r.contains(t)){const _=t.clone(),V=[];let Y,J;s=null,w[0]=Y=r.clone(),Y.bottom=i.y-I[1],w[1]=Y=r.clone(),Y.x=i.right+I[0],w[2]=Y=r.clone(),Y.y=i.bottom+I[1],w[3]=Y=r.clone(),Y.right=i.x-I[0];for(let X=0;X<E.length;X++){if(R&&X==2&&(t[R]=x),Y=w[o=E[X].zone],t=t.alignTo({target:i,offsets:I,align:E[X].align}),t.constrainTo(Y,!0)&&(V.push({result:t,zone:o}),!J||t.width<d.width||t.height<d.height)){t.align=E[X].align;break}if(!J||Y.area>J.area){const q=t.clone();switch(o){case 0:q.moveTo(null,Y.bottom-q.height);break;case 1:q.moveTo(Y.left);break;case 2:q.moveTo(null,Y.top);break;case 3:q.moveTo(Y.right-q.width);break}J={area:Y.area,result:q,zone:o}}}V.length?(V.length>1&&!f&&V.sort((X,q)=>{const oe=Math.sqrt((_.x-X.result.x)**2+(_.y-X.result.y)**2),xe=Math.sqrt((_.x-q.result.x)**2+(_.y-q.result.y)**2);return oe-xe}),t=V[0].result,o=V[0].zone):(t=J.result,o=J.zone,l&&t.constrainTo(r))}else o=C.startZone;if(t.zone=o,t.overlap=O=t.intersect(i,!0),g&&!O){if(!s){const _=o&1,V=_?"y":"x",Y=_?"bottom":"right",J=Math.max(i[V],t[V]),X=Math.min(i[Y],t[Y]);let q=J+(X-J)/2-g[0]/2;const oe=q+g[0];oe>t[Y]&&(q-=oe-t[Y]),q<t[V]&&(q+=t[V]-q),s={[V]:q-t[V],edge:ma[(o+2)%4]}}t.anchor=s}}return t}getAlignmentPoint(e,t=Xf){const i=this,r=Ty.exec(e),n=r[1].toLowerCase(),s=Math.min(Math.max(parseInt(r[2]||50),0),100)/100;switch(n){case"t":return[i.x+i.width*s,i.y-t[1]];case"r":return[i.right+t[0],i.y+i.height*s];case"b":return[i.x+i.width*s,i.bottom+t[1]];case"l":return[i.x-t[0],i.y+i.height*s];case"c":return[i.x+i.width/2,i.y+i.height/2]}}highlight(){const e=this,t=S.createElement({parent:document.body,style:`position:absolute;z-index:9999999;pointer-events:none;
                            left:${e.x}px;top:${e.y}px;width:${e.width}px;height:${e.height}px`});return S.highlight(t).then(()=>t.remove())}visualize(e,t){const i=this,r=T.merge({style:F({left:`${i.x}px`,top:`${i.y}px`,width:`${i.width}px`,height:`${i.height}px`,pointerEvents:"none"},e.class?{}:{position:"absolute","z-index":9999999})},e);return t?r:S.createElement(r)}toString(e=","){return[`${this.top}px`,`${this.right}px`,`${this.bottom}px`,`${this.left}px`].join(e)}}$._$name="Rectangle";const Fi=Symbol("value"),Zc=Symbol("length");class Q{static change(e,t,i,r="string"){i=Q.normalize(i,"object");const n=Q.normalize(e,"array").filter(s=>!i[s]);if(t){t=Q.normalize(t,"array");for(let s=0;s<t.length;++s)n.includes(t[s])||n.push(t[s])}return Q.normalize(n,r)}static from(e,t){if(e){if(e.isDomClassList){var i;t=(i=t)!==null&&i!==void 0?i:!0}else{var r;t=(r=t)!==null&&r!==void 0?r:U.isObject(e)&&!U.isEmpty(e),e=new Q(e)}!e.value&&!t&&(e=null)}return e||(t?new Q:null)}static normalize(e,t="string"){e=e||"";const i=typeof e,r=t==="array",n=t==="object",s=!r&&!n;let a=i==="string",o,l,d;if(i==="object"){var u;e.nodeType===Element.ELEMENT_NODE&&typeof e.getAttribute=="function"?(e=e.getAttribute("class")||"",a=!0):(u=e)!==null&&u!==void 0&&u.isDomClassList?e=e.values:e instanceof DOMTokenList?e=Array.from(e):e instanceof Map?e=Array.from(e.keys()).filter(h=>e.get(h)):e instanceof Set?e=Array.from(e):Array.isArray(e)||(e=U.getTruthyKeys(e))}for(a&&(e=[...new Set(z.split(e))]),l=e.length;l-- >0;)o=e[l],o.length?o.includes(" ")&&e.splice(l,1,...z.split(o)):e.splice(l,1);if(r)d=e;else if(s)d=e.join(" ");else for(d=Object.create(null),l=0;l<e.length;++l)d[e[l]]=!0;return d}constructor(...e){this.process(1,e)}clear(){for(const e in this)this[e]=!1;return this}set(...e){return this.clear().process(1,e)}get isDomClassList(){return!0}clone(){return new Q(this)}contains(e){return typeof e=="string"&&e?Boolean(this[e]):!1}toString(){return this.length?`${this.value} `:""}toJSON(){return this.toString()}trim(){return this.value}isEqual(e){const t=Q.normalize(e,"array"),i=t.length;if(this.length===i){for(let r=0;r<i;r++)if(!this[t[r]])return!1;return!0}return!1}get value(){let e=this[Fi],t;return e==null&&(t=U.getTruthyKeys(this),this[Zc]=t.length,this[Fi]=e=t.join(" ")),e}set value(e){const t=this,i=Object.keys(t),r=i.length;for(let n=0;n<r;n++)delete t[i[n]];e?t.process(1,[e]):delete t[Fi]}get values(){return U.getTruthyKeys(this)}get length(){return this.value?this[Zc]:0}process(e,t){for(let i,r,n=0;n<t.length;n++)if(t[n])if(i=t[n],i.isDomClassList||U.isObject(i))for(r in i)this[r]=e?i[r]:!i[r];else for(i=Q.normalize(t[n],"array"),r=0;r<i.length;++r)this[i[r]]=e;return delete this[Fi],this}assign(e){for(const t in e)!this[t]!=!e[t]&&(this[t]=e[t],delete this[Fi]);return this}assignTo(e){const t=e.nodeType===Element.ELEMENT_NODE?e.classList:e,i=Q.from(t);i.add(this),t.value=i.value}add(...e){return this.process(1,e)}remove(...e){return this.process(0,e)}toggle(e,t=Boolean(!this[e])){if(t=Boolean(t),Boolean(this[e])!==t)return this[e]=t,delete this[Fi],!0}split(){return U.getTruthyKeys(this)}forEach(e){return U.getTruthyKeys(this).forEach(e)}}Q.prototype[Fi]=null;Q._$name="DomClassList";class si extends ${static from(e){const t=e.changedTouches;return new si(t?t[0].screenX:e.screenX,t?t[0].screenY:e.pageY)}constructor(e,t){super(e,t,0,0)}constrain(e){return this.x=Math.min(Math.max(this.x,e.x),e.right-1),this.y=Math.min(Math.max(this.y,e.y),e.bottom-1),this}toArray(){return[this.x,this.y]}}Object.getPrototypeOf(si).Point=si;si._$name="Point";const Ay=["clientX","clientY","pageX","pageY","screenX","screenY"],Ly={element:1,thisObj:1,once:1,delegate:1,delay:1,capture:1,passive:1,throttled:1,autoDetach:1,expires:1,block:1},fi=!0,Jc={configurable:fi,value:!0},Oy={Spacebar:"Space",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown"},Py={Meta:1,Control:1,Alt:1},$y={Control:"ctrl",Alt:"alt",Shift:"shift"},Qc=5,_y=/^(ctrl|shift|alt|meta)$/;class B{static normalizeEvent(e){return T.copyPropertiesIf(e,e.changedTouches[0]||e.touches[0],Ay)}static getXY(e){return e.touches&&(e=e.touches[0]),[e.clientX,e.clientY]}static getDistanceBetween(e,t){const i=we.getXY(e),r=we.getXY(t);return Math.sqrt(Math.pow(i[0]-r[0],2)+Math.pow(i[1]-r[1],2))}static getPagePoint(e){return new $.Point(e.pageX,e.pageY)}static getClientPoint(e){return new $.Point(e.clientX,e.clientY)}static addListener(e,t,i,r){return e.nodeType?typeof t=="string"?r=Object.assign({element:e,[t]:i},r):r=Object.assign({element:e},t):r=e,we.on(r)}static on(e){const t=e.element,i=e.thisObj,r=[];for(const s in e)if(!Ly[s]){let a=e[s];typeof a!="object"&&(a={handler:a});const o=a.element||t;K.isTouchDevice&&!K.isAndroid&&s==="contextmenu"&&r.push(we.addElementListener(o,"touchstart",{handler:we.createContextMenuWrapper(a.handler,a.thisObj||i)},e)),r.push(we.addElementListener(o,s,a,e))}const n=()=>{for(let s,a=0;a<r.length;a++)s=r[a],we.removeEventListener(s[0],s[1],s[2]);r.length=0};return i&&e.autoDetach!==!1&&(i.doDestroy=ve.createInterceptor(i.doDestroy,n,i)),n}static addElementListener(e,t,i,r){const n=we.createHandler(e,t,i,r),{spec:s}=n,a=i.expires||r.expires,o=s.capture!=null||s.passive!=null?{capture:s.capture,passive:s.passive}:void 0;if(e.addEventListener(t,n,o),a){const l=i.thisObj||r.thisObj,d=l!=null&&l.isDelayable?l:globalThis,{alt:u}=a,h=u?a.delay:a,{spec:f}=n;f.expires=a,f.timerId=d[typeof h=="number"?"setTimeout":"requestAnimationFrame"](()=>{f.timerId=null,we.removeEventListener(e,t,n),u&&!n.called&&(typeof u=="string"?l[u]:u).call(l)},h,`listener-timer-${performance.now()}`)}return[e,t,n,o]}static getComposedPathTarget(e){return e.composedPath()[0]||e.path[0]}static fixEvent(e){var t,i;if(e.fixed)return e;const{type:r,target:n}=e;if((n!=null&&n.shadowRoot||n!=null&&(t=n.getRootNode)!==null&&t!==void 0&&t.call(n).host)&&e.composedPath){const s=this.getComposedPathTarget(e),a=n;Object.defineProperty(e,"target",{value:s,configurable:fi}),Object.defineProperty(e,"originalTarget",{value:a,configurable:fi})}if(Object.defineProperty(e,"fixed",Jc),r.startsWith("key")){const s=Oy[e.key];s&&Object.defineProperty(e,"key",{value:s,configurable:fi}),e.key===" "&&!e.code&&Object.defineProperty(e,"code",{value:"Space",configurable:fi})}if(e.metaKey&&!e.ctrlKey&&Object.defineProperty(e,"ctrlKey",Jc),n&&"offsetX"in e&&(Object.getOwnPropertyDescriptor(e,"borderOffsetX")||Object.defineProperty(e,"borderOffsetX",{get:()=>e.offsetX+(K.isSafari?0:parseInt(n.ownerDocument.defaultView.getComputedStyle(n).getPropertyValue("border-left-width")))}),Object.getOwnPropertyDescriptor(e,"borderOffsetY")||Object.defineProperty(e,"borderOffsetY",{get:()=>e.offsetY+(K.isSafari?0:parseInt(n.ownerDocument.defaultView.getComputedStyle(n).getPropertyValue("border-top-width")))})),n?.nodeType===Element.DOCUMENT_NODE&&"clientX"in e){const s=S.elementFromPoint(e.clientX,e.clientY);Object.defineProperty(e,"target",{value:s,configurable:fi})}if(n?.nodeType===Element.TEXT_NODE){const s=e.target.parentElement;Object.defineProperty(e,"target",{value:s,configurable:fi})}if(((i=e.relatedTarget)===null||i===void 0?void 0:i.nodeType)===Element.TEXT_NODE){const s=e.target.parentElement;Object.defineProperty(e,"relatedTarget",{value:s,configurable:fi})}return r.startsWith("touch")&&e.touches.length&&this.normalizeEvent(e),e}static createHandler(e,t,i,r){const n=i.delay||r.delay,s=i.throttled||r.throttled,a=i.block||r.block,o="once"in i?i.once:r.once,l="capture"in i?i.capture:r.capture,d="passive"in i?i.passive:r.passive,u="delegate"in i?i.delegate:r.delegate,h=i.handler,f=i.expires,g=i.thisObj||r.thisObj,{rtlSource:m=g}=g||{};let p=(v,...y)=>{we.playingDemo&&v.isTrusted||g!=null&&g.isDestroyed||(v=we.fixEvent(v,m?.rtl),p.called=!0,(typeof h=="string"?g[h]:h).call(g,v,...y),delete v.target,delete v.relatedTarget,delete v.originalarget,delete v.key,delete v.code,delete v.ctrlKey,delete v.fixed)};if(a){const v=p;let y,C;p=(D,...w)=>{const E=performance.now();(!y||D.target!==C||E-y>a)&&(C=D.target,y=E,v(D,...w))}}if(n!=null){const v=p,y=g!=null&&g.setTimeout?g:globalThis;p=(...C)=>{y.setTimeout(()=>{v(...C)},n)}}if(s!=null){let v,y=s;s.buffer&&(v=C=>s.alt.call(we,we.fixEvent(C,m?.rtl)),y=s.buffer),g!=null&&g.isDelayable?p=g.throttle(p,{delay:y,throttled:v}):p=ve.createThrottled(p,y,g,null,v)}if(o){const v=p;p=(...y)=>{we.removeEventListener(e,t,p),v(...y)}}if(u){const v=p;p=(y,...C)=>{var D;y=we.fixEvent(y,m?.rtl);const w=((D=y.target.closest)===null||D===void 0?void 0:D.call)&&y.target.closest(u);!w||(Object.defineProperty(y,"currentTarget",{get:()=>w,configurable:!0}),v(y,...C))}}return i.thisObj&&i.autoDetach!==!1&&(g.doDestroy=ve.createInterceptor(g.doDestroy,()=>we.removeEventListener(e,t,p),g)),p.spec={delay:n,throttled:s,block:a,once:o,thisObj:g,capture:l,expires:f,passive:d,delegate:u},p}static removeEventListener(e,t,i){const{expires:r,timerId:n,thisObj:s,capture:a}=i.spec;r!=null&&r.alt&&n&&(s!=null&&s.isDelayable?s:globalThis)[typeof r.delay=="number"?"clearTimeout":"cancelAnimationFrame"](n),e.removeEventListener(t,i,a)}static onTransitionEnd({element:e,animationName:t,property:i,handler:r,mode:n=t?"animation":"transition",duration:s=S[`get${n==="transition"?"Property":""}${z.capitalize(n)}Duration`](e,i),thisObj:a=globalThis,args:o=[],timerSource:l,runOnDestroy:d}){let u;l=l||(a.isDelayable?a:globalThis);const h=[e,i,...o],f=()=>{g(),a.isDestroyed||(a.callback?a.callback(r,a,h):r.apply(a,h))},g=we.on({element:e,[`${n}end`]({animationName:m,propertyName:p,target:v}){v===e&&(p===i||m!=null&&m.match(t))&&(u&&(l.clearTimeout(u),u=null),f())}});return s!=null&&(u=l.setTimeout(f,s+50,"onTransitionEnd",d)),g}static async waitForTransitionEnd(e){return new Promise(t=>{e.handler=t,B.onTransitionEnd(e)})}static createContextMenuWrapper(e,t){return i=>{if(i.touches.length===1){if(i.target.closest("[data-feature]"))return;const r=i.touches[0],n=setTimeout(()=>{a();const o=new MouseEvent("contextmenu",r);Object.defineProperty(o,"target",{get(){return r.target}}),typeof e=="string"&&(e=t[e]),o.browserEvent=i,e.call(t,o),we.contextMenuTouchId=r.identifier},we.longPressTime),s=({clientX:o,clientY:l,type:d})=>{let u=d==="touchend"||d==="pointerup";if(!u){const h=Math.abs(o-r.clientX),f=Math.abs(l-r.clientY);u=h>=Qc||f>=Qc}u&&(we.contextMenuTouchId=null,a(),clearTimeout(n))},a=we.on({element:document,touchmove:s,touchend:s,pointermove:s,pointerup:s,capture:!0})}}}static createDblClickWrapper(e,t,i){let r,n,s;return()=>{n||(n=we.on({element:e,touchstart:a=>{r=a.changedTouches[0].identifier,a.preventDefault()},touchend:a=>{if(a.changedTouches[0].identifier===r){a.preventDefault(),clearTimeout(s),r=n=null;const o=$.from(a.changedTouches[0].target,null,!0),l=a.changedTouches[0].pageX-o.x,d=a.changedTouches[0].pageY-o.y,u=Object.assign({browserEvent:a},a),h=new MouseEvent("dblclick",u);Object.defineProperties(h,{target:{value:a.target},offsetX:{value:l},offsetY:{value:d}}),typeof t=="string"&&(t=i[t]),t.call(i,h)}},once:!0}),s=setTimeout(()=>{n(),r=n=null},we.dblClickTime))}}static toSpecialKey(e,t="ctrlKey"){let i=!1;return e===!0?i=t:typeof e=="string"&&(e=e.toLowerCase(),e.match(_y)&&(i=`${e}Key`)),i}static specialKeyFromEventKey(e){return $y[e]||""}}M(B,"eventNameMap",{mousedown:"MouseDown",mouseup:"MouseUp",click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu",mouseover:"MouseOver",mouseout:"MouseOut",keyup:"KeyUp",keydown:"KeyDown",keypress:"KeyPress"});const we=B;we.longPressTime=500;we.dblClickTime=300;we.globalListenerDetacher=we.on({element:document,capture:!0,passive:!0,pointerdown({target:c}){var e;const t=S.getRootElement(c);S.usingKeyboard=!1,(e=t.classList)===null||e===void 0||e.remove("b-using-keyboard"),S.removeClsGlobally(t,"b-using-keyboard")},keydown({target:c,key:e}){if(!Py[e]){S.usingKeyboard=!0;const t=S.getRootElement(c);t.nodeType===Node.DOCUMENT_FRAGMENT_NODE?Array.from(t.children).forEach(i=>{i.matches(".b-outer")&&i.classList.add("b-using-keyboard")}):t.classList.add("b-using-keyboard")}}});K.isTouchDevice&&we.on({element:document,touchmove:c=>{c.target.closest(".b-dragging")&&c.preventDefault()},passive:!1,capture:!0});B._$name="EventHelper";const Hy=14,Ny={align:"t0-t0"},ln=Node.ELEMENT_NODE,Ps=Node.TEXT_NODE,{isObject:By}=T,Jf=/[+-]?\d*\.?\d+[eE]?-?\d*/g,Vt=Jf.source,zy=new RegExp(`matrix\\((?:${Vt}),\\s?(?:${Vt}),\\s?(?:${Vt}),\\s?(?:${Vt}),\\s?(${Vt}),\\s?(${Vt})`),Vy=new RegExp("matrix3d\\((?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(-?\\d*),\\s?(-?\\d*)"),$s=new RegExp(`(?:${zy.source})|(?:${Vy.source})`),jy=new RegExp(`translate(3d|X)?\\((${Vt})px(?:,\\s?(${Vt})px)?`),Wy=new RegExp(`translate(3d|Y)?\\((${Vt})px(?:,\\s?(${Vt})px)?`),Uy=/\s+/,Yy=/\s*;\s*/,Gy=/\s*:\s*/,qy=/^-?((\d+(\.\d*)?)|(\.?\d+))$/,Ky="$bryntum",Xy={elementData:"",for:"htmlFor",retainElement:""},Zy={tag:1,html:1,text:1,children:1,tooltip:1,style:1,dataset:1,parent:1,nextSibling:1,ns:1,reference:1,class:1,className:1,unmatched:1,onlyChildren:1,listeners:1,compareHtml:1,syncOptions:1,keepChildren:1},eu={length:1,parentRule:1,style:1},Jy={INPUT:1,TEXTAREA:1},Qy={BUTTON:1,IFRAME:1,EMBED:1,INPUT:1,OBJECT:1,SELECT:1,TEXTAREA:1,BODY:1},sa=globalThis,Ae=document,eb=Object.freeze({}),zo=Array.prototype.slice,tb=Promise.resolve(),ib=["font-size","font-size-adjust","font-style","font-weight","font-family","font-kerning","font-stretch","line-height","text-transform","text-decoration","letter-spacing","word-break"],rb=c=>c._hidden,nb=c=>c.parentNode||c.host,sb=(c,e,t)=>t.key==="children"?T.mergeItems(c,e,t):T.blend(c,e,t),Pl=c=>{const e=c.ownerDocument.defaultView.getComputedStyle(c);return e.getPropertyValue("display")!=="none"&&e.getPropertyValue("visibility")!=="hidden"},ab=Ae.documentElement.getRootNode?c=>c.getRootNode():c=>{for(;c.parentNode;)c=c.parentNode;return c},ob=c=>c.host&&c.host instanceof Element,vi=c=>c&&(c===Ae.body||Boolean(c.offsetParent)||(c.ownerDocument.defaultView&&"offsetParent"in c&&S.getStyleValue(c,"position")!=="fixed"?c.offsetParent:vi(c.parentNode))),yr=c=>c&&(Ae.body.contains(c)||(Vo=ab(c))&&ob(Vo)&&yr(Vo.host)),tu=c=>c instanceof Node?c:typeof c=="string"?j.createElementFromTemplate(c):j.createElement(c),bn=Object.create(null),Qf=(c,e)=>{const t=bn[c]||[z.hyphenate(c),e];return bn[c]||(bn[t[0]]=bn[c]=t),t},lb=c=>c.ownerSVGElement?c.ownerSVGElement.parentNode:c.offsetParent,db=/b-slide-in-from-\w+/;["top","right","bottom","left","width","height","maxWidth","maxHeight","minWidth","minHeight","borderSpacing","borderWidth","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","marginTop","marginRight","marginBottom","marginLeft","paddingTop","paddingRight","paddingBottom","paddingLeft","fontSize","letterSpacing","lineHeight","outlineWidth","textIndent","wordSpacing"].forEach(c=>Qf(c,!0));let Cn=null,cb=0,ki=null,Vo,jo,iu,ru;class S{static async slideIn(e,t=1){const i=`b-slide-in-${t>0?"next":"previous"}`,{classList:r}=e,{style:n}=e.parentNode,{overflow:s,overflowX:a,overflowY:o}=n;n.overflow="hidden",r.add(i),await B.waitForTransitionEnd({element:e,animationName:db}),n.overflow=s,n.overflowX=a,n.overflowY=o,r.remove(i)}static isFocusable(e,t=!1){if(!t&&(!j.isVisible(e)||j.Widget.fromElement(e,rb)))return!1;const i=e.nodeName;return Qy[i]||(i==="A"||i==="LINK")&&!!e.href||e.getAttribute("tabIndex")!=null||e.contentEditable==="true"}static isEditable(e){return e.isContentEditable||Jy[e.nodeName]}static isInView(e,t=!1,i){if(!vi(e))return!1;const r=i?.positioned&&S.getStyleValue(i.element,"position")!=="fixed",n=$.from(globalThis),s=t?"contains":"intersect",a=r&&i.element.offsetParent,o=r&&$.from(a);if(n.height=Ae.scrollingElement.scrollHeight,e===Ae.body)return n;const l=this.getViewportIntersection(e,n,s);return l&&r&&l.translate(Ae.scrollingElement.scrollLeft,Ae.scrollingElement.scrollTop),r&&l?l.translate(-o.x+a.scrollLeft,-o.y+a.scrollTop):l}static getViewportIntersection(e,t,i){const{parentNode:r}=e,{parentElement:n}=r.nodeType===Node.DOCUMENT_FRAGMENT_NODE?e.getRootNode().host:e,s=n.ownerDocument.defaultView.getComputedStyle(n),a=s.overflowX!=="visible"||s.overflowY!=="visible",o=lb(e);let l=$.from(e,null,!0);for(let d=a?e.parentNode:o;l&&d!==Ae.documentElement;d=d.parentNode){d.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&d.host&&(d=d.host.parentNode);const u=d===Ae.body,h=d.ownerDocument.defaultView.getComputedStyle(d),f=u?t:$.inner(d,null,!0);(u||h.overflow!=="visible")&&(l=f[i](l,!1,!0))}return l}static isVisible(e){const t=e.ownerDocument;for(;e;e=nb(e)){if(e===t)return!0;if(e.nodeType===e.ELEMENT_NODE&&!Pl(e))return!1}return!1}static isDOMEvent(e){return e instanceof Event}static merge(e,...t){return T.blend(e,t,{merge:sb})}static normalizeChildren(e,t,i){var r;let n=e?.children,s,a,o,l,d;if(e!=null&&(r=e.syncOptions)!==null&&r!==void 0&&r.ignoreRefs&&(i=!0),n&&!(e instanceof Node))if(Array.isArray(n))for(a=0;a<n.length;++a)j.normalizeChildren(n[a],t,i);else{l=n,e.children=n=[];for(o in l){var u;s=l[o],(u=s)!==null&&u!==void 0&&u.isWidget&&(s=s.element),d=!o.startsWith("$")&&!j.isElement(s),d&&t?.(o,!i),s&&(s instanceof Node||(s.reference===!1?delete s.reference:d&&typeof s!="string"&&(s.reference=o),j.normalizeChildren(s,t,i)),n.push(s))}}return e}static roundPx(e,t=globalThis.devicePixelRatio||1){const i=1/t;return Math.round(e/i)*i}static floorPx(e,t=globalThis.devicePixelRatio||1){const i=1/t;return Math.floor(e*i)/i}static isCustomElement(e){return Boolean(e?.shadowRoot)}static elementFromPoint(e,t){let i=document.elementFromPoint(e,t);return j.isCustomElement(i)&&(i=i.shadowRoot.elementFromPoint(e,t)||i),i}static childFromPoint(e,t,i,r=e){const n=i==null?t:new $(t,i,0,0);let s=null;return Array.from(e.children).some(a=>{if($.from(a,r).contains(n))return s=a.children.length&&j.childFromPoint(a,n,null,r)||a,!0}),s}static unitize(e,t,i="px"){const[r,n]=Qf(e);return t!=null&&(t=String(t),t=n&&qy.test(t)?t+i:t),[r,t]}static get activeElement(){let e=document.activeElement;for(;e.shadowRoot;)e=e.shadowRoot.activeElement;return e}static getActiveElement(e){var t,i;(t=e)!==null&&t!==void 0&&t.isWidget&&(e=e.element);let r=(((i=e)===null||i===void 0?void 0:i.getRootNode())||document).activeElement;for(;(n=r)!==null&&n!==void 0&&n.shadowRoot;){var n;r=r.shadowRoot.activeElement}return r}static getRootElement(e){var t;const i=(t=e.getRootNode)===null||t===void 0?void 0:t.call(e),{nodeType:r}=i;return r===Node.DOCUMENT_NODE?i.body:r===Node.DOCUMENT_FRAGMENT_NODE?i:e.ownerDocument.contains(e)?e.ownerDocument.body:null}static getOutermostElement(e){var t,i;const r=(t=(i=e).getRootNode)===null||t===void 0?void 0:t.call(i);if(r!=null&&r.body)return r?.body;for(;e.parentNode!==r&&e.parentNode;)e=e.parentNode;return e}static isValidFloatRootParent(e){return e===document.body||e.constructor.name==="ShadowRoot"}static getId(e){return e.id||(e.id="b-element-"+ ++cb)}static getCommonAncestor(e,t){if(e===t)return e;for(;e&&!((i=(r=e)[e.isWidget?"owns":"contains"])!==null&&i!==void 0&&i.call(r,t)||e===t);){var i,r;e=e.owner||e.parentNode}return e}static getElement(e){return e instanceof Element?e:Ae.querySelector(e)}static setAttributes(e,t){const i=j.getElement(e);if(i&&t)for(const r in t)t[r]==null?i.removeAttribute(r):i.setAttribute(r,t[r])}static setLength(e,t,i){if(arguments.length===1){var r;i=typeof e=="number"?`${e}px`:(r=e)!==null&&r!==void 0?r:""}else{var n;e=j.getElement(e),i=e.style[t]=typeof i=="number"?`${i}px`:(n=i)!==null&&n!==void 0?n:""}return i}static percentify(e,t=2){const i=Math.pow(10,t);return e==null||e===""||isNaN(e)?"":`${Math.round(e*i)/i}%`}static getChild(e,t){return e.querySelector(":scope>"+t)}static hasChild(e,t){return j.getChild(e,t)!=null}static children(e,t){return(t[0]===">"||t.startsWith("# "))&&(t[0]==="#"&&(t=t.substr(2)),t=":scope "+t),Array.from(e.querySelectorAll(t))}static getChildElementCount(e){return e.childElementCount}static down(e,t){return e?e.matches&&e.matches(t)?e:(t=":scope "+t,e.querySelector(t)):null}static isDescendant(e,t){const i=j.getRootElement(e),r=j.getRootElement(t);return r&&i!==r&&r.host?j.isDescendant(i,r.host):e.contains(t)}static getEventElement(e,t="target"){return!e||j.isElement(e)?e:e[t]}static isElement(e){return e?.nodeType===document.ELEMENT_NODE&&j.isNode(e)}static isReactElement(e){return e?.$$typeof===Symbol.for("react.element")}static isNode(e){return Boolean(e)&&typeof e.nodeType=="number"&&!By(e)}static forEachSelector(e,t,i){if(typeof e=="string")throw new Error("DomHelper.forEachSelector must provide a root element context (for shadow root scenario)");j.children(e,t).forEach(i)}static forEachChild(e,t){Array.from(e.children).forEach(t)}static removeEachSelector(e,t){j.forEachSelector(e,t,i=>i.remove())}static removeClsGlobally(e,...t){t.forEach(i=>j.forEachSelector(e,"."+i,r=>r.classList.remove(i)))}static isOrphaned(e){return!yr(e)}static up(e,t){return ae.deprecate("Core","6.0.0","DomHelper.up() deprecated, use native `element.closest()` instead"),e.closest(t)}static getAncestor(e,t,i=null){let r=!1,n,s=e;for(t=W.asArray(t);s=s.parentElement;){if(t.includes(s)){r=!0;break}if(i&&s===i)break;n=s}return r?n||e:null}static getParents(e){const t=[];for(;e.parentElement;)t.push(e.parentElement),e=e.parentElement;return t}static makeValidId(e,t=""){return z.makeValidDomId(e,t)}static createElement(e={},t){var i,r,n;let s=t,a,o,l,d,u,h,f,g,m,p,v;if(typeof s=="boolean")throw new Error("Clean up");t&&(u=t.ignoreRefs,m=t.refOwner,p=t.refs,s=t.returnAll,v=t.syncIdField,u&&(l=!0,u=u!=="children")),typeof e.parent=="string"&&(e.parent=document.getElementById(e.parent));const y=e.parent||e.nextSibling&&e.nextSibling.parentNode,{dataset:C,html:D,reference:w,syncOptions:E,text:R}=e;if(E&&(v=E.syncIdField||v,d=E.ignoreRefs,d&&(l=!0,u=d!=="children",t=F(F({},t),{},{ignoreRefs:!0}))),u&&(m=null),e.ns?a=Ae.createElementNS(e.ns,e.tag||"svg"):a=Ae.createElement(e.tag||"div"),R!=null?j.setInnerText(a,R):D!=null&&(D instanceof DocumentFragment?a.appendChild(D):a.innerHTML=D),e.tooltip&&j.Widget.attachTooltip(a,e.tooltip),e.style&&j.applyStyle(a,e.style),C)for(f in C)g=C[f],g!=null&&(a.dataset[f]=g);y&&this.addChild(y,a,e.nextSibling),m&&(a.$refOwnerId=m.id),w&&!u&&(m?(a.$reference=w,m.attachRef(w,a,e)):(p||(t=Object.assign({},t),t.refs=p={}),p[w]=a,a.setAttribute("data-reference",w)));const x=e.className||e.class,k=Object.keys(e);for(x&&a.setAttribute("class",Q.normalize(x)),o=0;o<k.length;++o)f=k[o],g=e[f],(h=Xy[f])!=null?a[h||f]=g:!Zy[f]&&f&&g!=null&&a.setAttribute(f,g);return!e["aria-hidden"]&&!e.role&&!e.tabIndex&&!S.isFocusable(a,!0)&&!a.htmlFor&&a.setAttribute("role","presentation"),(i=t)===null||i===void 0||(r=i.callback)===null||r===void 0||r.call(i,{action:"newElement",domConfig:e,targetElement:a,syncId:m?w:t.syncIdField&&((n=e.dataset)===null||n===void 0?void 0:n[t.syncIdField])}),s===!0?t.returnAll=s=[a]:Array.isArray(s)&&s.push(a),e.children&&(v&&(a.syncIdMap={}),e.children.forEach(I=>{if(I)if(typeof I=="string"){const _=document.createTextNode(I);m&&(_.$refOwnerId=m.id),a.appendChild(_)}else if(isNaN(I.nodeType)){var A,L,O;I.parent=a,!I.ns&&e.ns&&(I.ns=e.ns);const _=j.createElement(I,F(F({},t),{},{ignoreRefs:(A=(L=e.syncOptions)===null||L===void 0?void 0:L.ignoreRef)!==null&&A!==void 0?A:l})),V=(O=I.dataset)===null||O===void 0?void 0:O[v];V!=null&&(a.syncIdMap[V]=_),delete I.parent}else a.appendChild(I)})),a.lastDomConfig=e,p||s||a}static createElementFromTemplate(e,t=eb){const{array:i,raw:r,fragment:n}=t;let s;if(j.supportsTemplate){if((jo||(jo=Ae.createElement("template"))).innerHTML=e,s=jo.content,n)return s.cloneNode(!0)}else if(s=(iu||(iu=new DOMParser)).parseFromString(e,"text/html").body,n){const a=s.childNodes;for(s=document.createDocumentFragment();a.length;)s.appendChild(a[0]);return s}return r?s=s.childNodes:s=s.children,s.length===1&&!i?s[0]:zo.call(s)}static triggerMouseEvent(e,t="contextmenu"){const i=this.isInView(e),r=i||$.from(e),n=r.center,s=new MouseEvent(t,{clientX:n.x,clientY:n.y,bubbles:!0});e.dispatchEvent(s)}static insertFirst(e,t){return t&&t.nodeType!==ln&&t.tag&&(t=j.createElement(t)),e.insertBefore(t,e.firstElementChild)}static insertBefore(e,t,i){return t&&t.nodeType!==ln&&t.tag&&(t=j.createElement(t)),i?e.insertBefore(t,i):j.insertFirst(e,t)}static insertAt(e,t,i){const r=Array.from(e.children);if(i>=r.length)return j.append(e,t);const n=r[i];return j.insertBefore(e,t,n)}static append(e,t){if(t.forEach){if(Array.isArray(t)&&(t=t.map(i=>tu(i))),e.append)e.append(...t);else{const i=document.createDocumentFragment();t.forEach(function(r){i.appendChild(r)}),e.appendChild(i)}return t}else return e.appendChild(tu(t))}static getTranslateX(e){const t=e.style.transform;let i=jy.exec(t);return i?parseFloat(i[2]):(i=$s.exec(t)||$s.exec(j.getStyleValue(e,"transform")),i?parseFloat(i[1]||i[3]):0)}static getTranslateY(e){const t=e.style.transform;let i=Wy.exec(t);if(i){const r=parseFloat(i[i[1]==="Y"?2:3]);return isNaN(r)?0:r}else return i=$s.exec(t)||$s.exec(j.getStyleValue(e,"transform")),i?parseFloat(i[2]||i[4]):0}static getTranslateXY(e){return[j.getTranslateX(e),j.getTranslateY(e)]}static getOffsetX(e,t=null){return t?e.getBoundingClientRect().left-t.getBoundingClientRect().left:e.offsetLeft}static getOffsetY(e,t=null){return t?e.getBoundingClientRect().top-t.getBoundingClientRect().top:e.offsetTop}static getOffsetXY(e,t=null){return[j.getOffsetX(e,t),j.getOffsetY(e,t)]}static focusWithoutScrolling(e){function t(r){r.forEach(({element:n,scrollLeft:s,scrollTop:a})=>{n.scrollLeft!==s&&(n.scrollLeft=s),n.scrollTop!==a&&(n.scrollTop=a)})}if(!K.isSafari)e.focus({preventScroll:!0});else{const r=j.getParents(e),n=r.map(s=>({element:s,scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}));e.focus(),setTimeout(()=>t(n),0)}}static getPageX(e){return e.getBoundingClientRect().left+sa.pageXOffset}static getPageY(e){return e.getBoundingClientRect().top+sa.pageYOffset}static getExtremalSizePX(e,t){const i=z.hyphenate(t),r=i.split("-")[1];let n=j.getStyleValue(e,i);return/%/.test(n)?e.parentElement?n=parseInt(j.getStyleValue(e.parentElement,r),10):n=NaN:n=parseInt(n,10),n}static setScale(e,t,i=t){const r=j.getStyleValue(e,"transform").split(/,\s*/);r.length>1?(r[0].startsWith("matrix3d")?(r[0]=`matrix3d(${t}`,r[5]=i):(r[0]=`matrix(${t}`,r[3]=i),e.style.transform=r.join(",")):e.style.transform=`scale(${t}, ${i})`}static setTranslateX(e,t){const i=j.getStyleValue(e,"transform").split(/,\s*/);t=j.roundPx(t),i.length>1?(i[i[0].startsWith("matrix3d")?12:4]=t,e.style.transform=i.join(",")):e.style.transform=`translateX(${t}px)`}static setTranslateY(e,t){const i=j.getStyleValue(e,"transform").split(/,\s*/);t=j.roundPx(t),i.length>1?(i[i[0].startsWith("matrix3d")?13:5]=t,e.style.transform=i.join(",")+")"):e.style.transform=`translateY(${t}px)`}static setTop(e,t){j.setLength(e,"top",t)}static setLeft(e,t){j.setLength(e,"left",t)}static setTopLeft(e,t,i){j.setLength(e,"top",t),j.setLength(e,"left",i)}static setRect(e,{x:t,y:i,width:r,height:n}){j.setTopLeft(e,i,t),j.setLength(e,"width",r),j.setLength(e,"height",n)}static setTranslateXY(e,t,i){if(t==null)return j.setTranslateY(e,i);if(i==null)return j.setTranslateX(e,t);t=j.roundPx(t),i=j.roundPx(i);const r=j.getStyleValue(e,"transform").split(/,\s*/),n=r[0].startsWith("matrix3d");r.length>1?(r[n?12:4]=t,r[n?13:5]=i,e.style.transform=r.join(",")+")"):e.style.transform=`translate(${t}px, ${i}px)`}static addTranslateX(e,t){j.setTranslateX(e,j.getTranslateX(e)+t)}static addTranslateY(e,t){j.setTranslateY(e,j.getTranslateY(e)+t)}static addLeft(e,t){j.setLeft(e,j.getOffsetX(e)+t)}static addTop(e,t){j.setTop(e,j.getOffsetY(e)+t)}static alignTo(e,t,i=Ny,r){t=t instanceof $?t:$.from(t,!0);const n=j.getTranslateXY(e),s=$.from(e,!0);r&&(s.roundPx(),t.roundPx());const a=s.alignTo(Object.assign(i,{target:t}));j.setTranslateXY(e,n[0]+a.x-s.x,n[1]+a.y-s.y)}static getStyleValue(e,t,i,r){const n=i?e.style:e.ownerDocument.defaultView.getComputedStyle(e,r);if(Array.isArray(t)){const s={};for(const a of t)s[a]=n.getPropertyValue(z.hyphenate(a));return s}return n.getPropertyValue(z.hyphenate(t))}static getEdgeSize(e,t,i){const r=t==="border"?"-width":"",n={raw:{}};for(const s of["top","right","bottom","left"])(!i||i.includes(s[0]))&&(n[s]=parseFloat(n.raw[s]=j.getStyleValue(e,`${t}-${s}${r}`)));return n.width=(n.left||0)+(n.right||0),n.height=(n.top||0)+(n.bottom||0),n}static parseStyle(e){if(typeof e=="string"){const t=e.split(Yy);e={};for(let i=0,{length:r}=t;i<r;i++){const n=t[i].split(Gy);e[n[0]]=n[1]}}return e||{}}static applyStyle(e,t,i=!1){if(typeof t=="string")i?(t.length||e.style.cssText.length)&&(e.style.cssText=t):e.style.cssText+=t;else if(t){i&&(e.style.cssText=""),t.style&&typeof t.style!="string"&&(t=T.assign({},t,t.style));let r,n;for(r in t)eu[r]||([r,n]=j.unitize(r,t[r]),n==null?e.style.removeProperty(r):e.style.setProperty(r,n));typeof t.style=="string"&&(e.style.cssText+=t.style)}}static getCSSText(e){if(typeof e=="string")return e;let t="";for(const i in e)eu[i]||(t+=`${z.hyphenate(i)}:${e[i]};`);return t}static addClasses(e,t){ae.deprecate("Core","6.0.0","DomHelper.addClasses should be replaced by native classList.add"),e.classList.add(...t)}static removeClasses(e,t){ae.deprecate("Core","6.0.0","DomHelper.removeClasses should be replaced by native classList.remove"),e.classList.remove(...t)}static toggleClasses(e,t,i=null){t=W.asArray(t),i===!0?e.classList.add(...t):i===!1?e.classList.remove(...t):t.forEach(r=>e.classList.toggle(r))}static addTemporaryClass(e,t,i,r=globalThis){i>0&&(e.classList.add(t),r.setTimeout({fn:n=>e.classList.remove(n),delay:i,name:t,args:[t],cancelOutstanding:!0}))}static getPropertyTransitionDuration(e,t){const i=globalThis.getComputedStyle(e),r=i.transitionProperty.split(", "),n=i.transitionDuration.split(", "),s=r.indexOf(z.hyphenate(t));let a;return s!==-1&&(a=parseFloat(n[s])*1e3),a}static getAnimationDuration(e){return parseFloat(j.getStyleValue(e,"animation-duration"))*1e3}static highlight(e,t=globalThis){return e instanceof $?e.highlight():new Promise(i=>{t.setTimeout(()=>{e.classList.add("b-fx-highlight"),t.setTimeout(()=>{e.classList.remove("b-fx-highlight"),i()},1e3)},0)})}static get scrollBarWidth(){if(Cn===null&&Ae.body){const e=ru||(ru=j.createElement({parent:Ae.body,style:"position:absolute;top:-9999em;height:100px;overflow-y:scroll"}));e.parentNode!==Ae.body&&Ae.body.appendChild(e),Cn=e.offsetWidth}return Cn}static get scrollBarPadElement(){return{className:"b-yscroll-pad",children:[{className:"b-yscroll-pad-sizer"}]}}static resetScrollBarWidth(){Cn=null}static measureText(e,t,i=!1,r=void 0){const n=j.getMeasureElement(t,r);n[i?"innerHTML":"innerText"]=e;const s=n.clientWidth;return n.className="",s}static measureSize(e,t,i=!0){if(!e)return 0;if(typeof e=="number")return e;if(!e.length)return 0;if(/^\d+(px)?$/.test(e))return parseInt(e);if(t){const r=j.getMeasureElement(t);r.innerHTML="",r.style.width=j.setLength(e);const n=i?r.offsetWidth:r.getBoundingClientRect().width;return r.style.width=r.className="",n}return/^\d+em$/.test(e)?parseInt(e)*Hy:isNaN(e)?0:parseInt(e)}static getMeasureElement(e,t=Ae.body){const i=sa.getComputedStyle(e),r=t.offScreenDiv=t.offScreenDiv||j.createElement({parent:t,style:"position:fixed;top:-10000px;left:-10000px;visibility:hidden;contain:strict",className:"b-measure-element",children:[{style:"white-space:nowrap;display:inline-block;will-change:contents;width:auto;contain:none"}]},{returnAll:!0})[1];return ib.forEach(n=>{r.style[n]!==i[n]&&(r.style[n]=i[n])}),r.className=e.className,r.parentElement.parentElement!==t&&t.appendChild(r.parentElement),r}static stripTags(e){return(j.$domParser||(j.$domParser=new DOMParser)).parseFromString(e,"text/html").body.textContent}static sync(e,t){if(typeof e=="string")if(e===""){t.innerHTML="";return}else e=j.createElementFromTemplate(e);return j.performSync(e,t),t}static performSync(e,t){return e.outerHTML!==t.outerHTML?(j.syncAttributes(e,t),j.syncContent(e,t),j.syncChildren(e,t),!0):!1}static getSyncAttributes(e){const t={},i=[];for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];if(n.specified){const s=n.name.toLowerCase();t[s]=n.value,i.push(s)}}return{attributes:t,names:i}}static syncAttributes(e,t){const{attributes:i,names:r}=j.getSyncAttributes(e),{attributes:n,names:s}=j.getSyncAttributes(t),a=r.includes("dataset"),o=r.filter(u=>!s.includes(u)),l=s.filter(u=>!r.includes(u)&&(!a||!u.startsWith("data-"))),d=r.filter(u=>s.includes(u));if(o.length>0)for(let u=0;u<o.length;u++){const h=o[u];h==="style"?j.applyStyle(t,i.style,!0):h==="dataset"?Object.assign(t.dataset,i.dataset):t.setAttribute(h,i[h])}if(l.length>0)for(let u=0;u<l.length;u++)t.removeAttribute(l[u]);if(d.length>0)for(let u=0;u<d.length;u++){const h=d[u];if(h==="style")j.applyStyle(t,i.style,!0);else if(h==="dataset")Object.assign(t.dataset,i.dataset);else if(h==="class"&&(i.class.isDomClassList||typeof i.class=="object")){let f;i.class.isDomClassList?f=i.class:f=new Q(i.class),f.isEqual(n.class)||t.setAttribute("class",f)}else n[h]!==i[h]&&t.setAttribute(h,i[h])}}static syncContent(e,t){j.getChildElementCount(e)===0&&(t.innerText=e.innerText)}static setInnerText(e,t){const{firstChild:i}=e;i?.nodeType===Element.TEXT_NODE?i.data=t:e.textContent=t}static syncChildren(e,t){const i=this,r=zo.call(e.childNodes),n=zo.call(t.childNodes);for(;r.length;){const s=r.shift(),a=n.shift();if(s&&s.nodeType!==Ps&&s.nodeType!==ln)throw new Error(`Source node type ${s.nodeType} not supported by DomHelper.sync()`);if(a&&a.nodeType!==Ps&&a.nodeType!==ln)throw new Error(`Target node type ${a.nodeType} not supported by DomHelper.sync()`);if(!a)t.appendChild(s);else if(s.nodeType===a.nodeType)s.nodeType===Ps?a.data=s.data:s.tagName===a.tagName?i.performSync(s,a):(t.insertBefore(s,a),a.remove());else if(s.nodeType===Ps&&a.nodeType===ln)t.innerText=s.data.trim();else{const o=s.parentElement||s;throw new Error(`Currently no support for transforming nodeType.
${o.outerHTML}`)}}n.forEach(s=>{s.remove()})}static syncClassList(e,t){const{classList:i}=e,r=typeof t=="string",n=r?t.split(Uy):Q.normalize(t,"array"),s=n.length;let a=i.length!==s,o;for(o=0;!a&&o<s;o++)a=!i.contains(n[o]);return a&&(e.className=r?t:n.join(" ")),a}static updateClassList(e,t){const{classList:i}=e;let r,n,s=!1;for(r in t)n=Boolean(t[r]),i.contains(r)!==n&&(i[n?"add":"remove"](r),s=!0);return s}static setTheme(e,t){e=e.toLowerCase();const{head:i}=document,r=j.getThemeInfo(t).name.toLowerCase();let n=i.querySelectorAll("[data-bryntum-theme]:not([data-loading])"),s=0;if(r===e)return tb;j.removeEachSelector(i,"#bryntum-theme[data-loading],link[data-bryntum-theme][data-loading]");const a={theme:e,prev:r};function o(l,d,u){const h=S.createElement({tag:"link",rel:"stylesheet",dataset:{loading:!0,bryntumTheme:!0},href:l.href.replace(r,e),nextSibling:l});h.addEventListener("load",()=>{delete h.dataset.loading,ki=null,++s===n.length&&(n.forEach(f=>f.remove()),ue.trigger("theme",a),d(a))}),h.addEventListener("error",f=>{delete h.dataset.loading,u(f)})}if(n.length)return new Promise((l,d)=>{n.forEach((u,h)=>{o(u,l,d,h===n.length-1)})});{const l=i.querySelector("#bryntum-theme:not([data-loading])")||i.querySelector(`[href*="${r}.css"]:not([data-loading])`);if(!(l!=null&&l.href.includes(`${r}.css`)))throw new Error(`Theme link for ${r} not found`);return n=[l],new Promise((d,u)=>o(l,d,u))}}static get themeInfo(){return S.getThemeInfo()}static getThemeInfo(e){if(!ki){const t=j.createElement({parent:document.body,className:"b-theme-info"}),i=j.getStyleValue(t,"content",!1,":before");if(i)try{ki=JSON.parse(i.replace(/^["']|["']$|\\/g,""))}catch{ki=null}ki=ki||(e?{name:e}:null),t.remove()}return ki}static async transition({element:e,selector:t="[data-dom-transition]",duration:i,action:r,thisObj:n=this,addTransition:s={},removeTransition:a={}}){const o=new Set,l=Array.from(e.querySelectorAll(t)),d=new Map(l.map(g=>{let m=0,p=g.parentElement;for(;p&&p!==e;)m++,p=p.parentElement;g.$depth=m,g.scrollHeight>g.offsetHeight&&getComputedStyle(g).overflow==="auto"&&(g.$scrollTop=g.scrollTop,o.add(g));const{parentElement:v}=g,y=$.from(g,e),C=$.from(g,v),D=getComputedStyle(v),w=parseFloat(D.borderLeftWidth);return w&&(y.left-=w,C.left-=w),[g.id,{element:g,globalBounds:y,localBounds:C,depth:m,parentElement:v}]}));r.call(n);const u=Array.from(e.querySelectorAll(t)),h=new Map(u.map(g=>{const m=$.from(g,e),p=$.from(g,g.parentElement),v=globalThis.getComputedStyle(g.parentElement),y=parseFloat(v.borderLeftWidth);return y&&(m.left-=y,p.left-=y),[g.id,{element:g,globalBounds:m,localBounds:p}]})),f=["position","top","left","width","height","padding","margin","zIndex","minWidth","minHeight","opacity","overflow"];for(const[g,m]of d){const p=h.get(g);if(p){const{element:v}=p,{style:y,parentElement:C}=v,D=parseInt(j.getStyleValue(v,"zIndex")),{globalBounds:w,localBounds:E,depth:R,parentElement:x}=m,k=x!==C;T.copyProperties(v.$initial={parentElement:C},y,f);let I;k?(p.bounds=p.globalBounds,I=w,e.appendChild(v)):(p.bounds=p.localBounds,I=E,x.appendChild(v));let A="hidden";o.has(v)&&(v.$scrollPlaceholder=j.createElement({parent:v,style:{height:v.scrollHeight}}),A="auto"),Object.assign(y,{position:"absolute",top:`${I.top}px`,left:`${I.left}px`,width:`${I.width}px`,height:`${I.height}px`,minWidth:0,minHeight:0,padding:0,margin:0,zIndex:R+(D||0),overflow:A}),p.processed=!0}else{const{element:v,localBounds:y,depth:C,parentElement:D}=m;v.$initial={removed:!0},Object.assign(v.style,{position:"absolute",top:`${y.top}px`,left:`${y.left}px`,width:`${y.width}px`,height:`${y.height}px`,minWidth:0,minHeight:0,padding:0,margin:0,zIndex:C,overflow:"hidden"}),D.appendChild(v),h.set(g,{element:v,bounds:y,removed:!0,processed:!0}),u.push(v)}}for(const[,g]of h)if(!g.processed){const{element:m}=g,{style:p,parentElement:v}=m,y=g.bounds=g.localBounds;m.classList.add("b-dom-transition-adding"),T.copyProperties(m.$initial={parentElement:v},p,f),Object.assign(p,{position:"absolute",top:s.top?0:`${y.top}px`,left:s.left?0:`${y.left}px`,width:s.width?0:`${y.width}px`,height:s.height?0:`${y.height}px`,opacity:s.opacity?0:null,zIndex:v.$depth+1,overflow:"hidden"})}for(const g of o)g.scrollTop=g.$scrollTop;e.classList.add("b-dom-transition"),e.firstElementChild.offsetWidth;for(const[,{element:g,bounds:m,removed:p}]of h)p?Object.assign(g.style,{top:a.top?0:`${m.top}px`,left:a.left?0:`${m.left}px`,width:a.width?0:`${m.width}px`,height:a.height?0:`${m.height}px`,opacity:a.opacity?0:g.$initial.opacity}):Object.assign(g.style,{top:`${m.top}px`,left:`${m.left}px`,width:`${m.width}px`,height:`${m.height}px`,opacity:g.$initial.opacity});await Yf.sleep(i),e.classList.remove("b-dom-transition");for(const g of u)g.$initial&&(g.$initial.removed?g.remove():(T.copyProperties(g.style,g.$initial,f),g.$scrollPlaceholder&&(g.$scrollPlaceholder.remove(),delete g.$scrollPlaceholder),g.classList.remove("b-dom-transition-adding"),g.$initial.parentElement.appendChild(g)));for(const g of o)g.scrollTop=g.$scrollTop,delete g.$scrollTop}static async loadScript(e){return new Promise((t,i)=>{const r=document.createElement("script");r.src=e,r.onload=t,r.onerror=i,document.head.appendChild(r)})}static isNamedColor(e){return e&&!/^(#|hsl|rgb|hwb)/.test(e)}static get NodeFilter(){return NodeFilter}static addChild(e,t,i){e.insertBefore(t,i)}}const j=S;let nu;const ub=()=>j.isTouchEvent=!1,eg=()=>{j.isTouchEvent=!0,clearTimeout(nu),nu=setTimeout(ub,400)};Ae.addEventListener("touchstart",eg,!0);Ae.addEventListener("touchend",eg,!0);j.canonicalStyles=bn;j.supportsTemplate="content"in Ae.createElement("template");j.elementPropKey=Ky;j.numberRe=Jf;if(!("children"in Node.prototype)){const c=e=>e.nodeType===e.ELEMENT_NODE;Object.defineProperty(Node.prototype,"children",{get:function(){return Array.prototype.filter.call(this.childNodes,c)}})}Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(c){const e=(this.document||this.ownerDocument).querySelectorAll(c);let t=e.length;for(;--t>=0&&e.item(t)!==this;);return t>-1});sa.Element&&!Element.prototype.closest?Node.prototype.closest=Element.prototype.closest=function(c){let e=this;if(!Ae.documentElement.contains(e))return null;do{if(e.matches(c))return e;e=e.parentElement||e.parentNode}while(e!==null&&e.nodeType===e.ELEMENT_NODE);return null}:Node.prototype.closest=function(c){var e;return(e=this.parentNode)===null||e===void 0?void 0:e.closest(c)};(function(c){c.forEach(function(e){Object.prototype.hasOwnProperty.call(e,"remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode&&this.parentNode.removeChild(this)}})})})([Element.prototype,CharacterData.prototype,DocumentType.prototype]);globalThis.addEventListener("resize",()=>Cn=null);S._$name="DomHelper";const hb=c=>c.floating,ii=new class extends P.mixin(Ie){suspendFocusEvents(){_s=!0}resumeFocusEvents(){_s=!1}setupFocusListenersOnce(c,e){c&&!ii.observedElements.has(c)&&(ii.setupFocusListeners(c,e),ii.observedElements.add(c))}setupFocusListeners(c=document,e,t=!1){var i;const r={element:c,touchstart(n){!ci&&n.changedTouches.length===1?ci=n.changedTouches[0]:ci=null},touchend:{handler:n=>{ci&&(ci.identifier===e.contextMenuTouchId?(n.stopImmediatePropagation(),n.preventDefault()):n.changedTouches.length===1&&n.changedTouches[0].identifier===ci.identifier&&ii.trigger("globaltap",{event:n}),ci=null)},passive:!1},mousedown:{handler:n=>{Hs="mouse",ci||ii.trigger("globaltap",{event:n}),lr=n;const s=n.ctrlKey||n.altKey||n.shiftKey||n.metaKey;!Qe&&s?Qe=new KeyboardEvent("keydown",{key:n.ctrlKey?"Control":n.shiftKey?"Shift":n.altKey?"Alt":"Meta",ctrlKey:n.ctrlKey,altKey:n.altKey,shiftKey:n.shiftKey,metaKey:n.metaKey}):Qe&&!s&&(Qe=null)},passive:!1},mouseup(){lr=null},keydown(n){Hs="key",Qe=n},keypress(){Hs="key"},keyup(){Qe=null},focusin(n){const{Widget:s}=ii;if(s.resetFloatRootScroll(),_s)return;const a=n.relatedTarget?n.relatedTarget instanceof HTMLElement?n.relatedTarget:document.body:null,o=n.target||document.body,l=s.fromElement(a),d=s.fromElement(o),u=S.getCommonAncestor(l,d),h=!!(a&&o.compareDocumentPosition(a)&4),f=s.query(fb);let g=null;if(o&&o!==document.body?g=S.getActiveElement(o):g=S.getActiveElement(document),f&&!f._isRevertingFocus&&(!d||!f.owns(d)&&!(f.element.compareDocumentPosition(d.element)&4&&d.up(hb))))return f.focus();let m=Wo("focusout",a,n.target,l,d,h);for(let C=l,D;C&&C!==u;C=D)if(D=C.owner,!C.isDestroying&&C.onFocusOut&&(C.onFocusOut(m),n.target&&g!==S.getActiveElement(n.target)))return;if(u&&n.target===u.element)!u.isDestroying&&S.getActiveElement(u)===o&&u.focusElement&&u.focusElement!==u.element&&(!u.element.contains(g)||u.focusDescendant)&&u.setTimeout(()=>{var C;return(C=u.focus)===null||C===void 0?void 0:C.call(u)},0);else{m=Wo("focusin",o,a,l,d,h);for(let C=d;C&&C!==u;C=C.owner)if(!C.isDestroying){var p,v;(p=(v=C).onFocusIn)===null||p===void 0||p.call(v,m)}}const y=S.getCommonAncestor(a?.nodeType===Element.ELEMENT_NODE?a:null,o)||o.parentNode;y&&(m=Wo("focusmove",o,a,l,d,h,{bubbles:!0}),y.dispatchEvent(m))},focusout(n){if(!_s&&(!n.relatedTarget||!ii.Widget.fromElement(n.relatedTarget))){const s=n.relatedTarget&&n.relatedTarget instanceof HTMLElement?n.relatedTarget:null;r.focusin({target:s,relatedTarget:n.target}),Qe=lr=null}},blur:{element:window,handler(n){n.target===window&&(Qe=null,lr=null)}},capture:!0,passive:!0};t&&((i=su)===null||i===void 0||i()),su=this.detachEvents=e.on(r)}get lastInteractionType(){return Hs}get shiftKeyDown(){var c;return(c=Qe)===null||c===void 0?void 0:c.shiftKey}get ctrlKeyDown(){var c,e;return((c=Qe)===null||c===void 0?void 0:c.ctrlKey)||((e=Qe)===null||e===void 0?void 0:e.metaKey)}get altKeyDown(){var c;return(c=Qe)===null||c===void 0?void 0:c.altKey}isKeyDown(c){var e;return c?((e=Qe)===null||e===void 0?void 0:e.key)===c||Qe[c?.toLowerCase()+"Key"]===!0:Boolean(Qe)}isMouseDown(c=0){var e;return((e=lr)===null||e===void 0?void 0:e.button)===c}get currentMouseDown(){return lr}get currentKeyDown(){return Qe}},fb=c=>c.isVisible&&c.isTopModal;ii.observedElements=new Set;let ci,_s=!1,Hs,Qe,lr,su;function Wo(c,e,t,i,r,n,s){const a=new CustomEvent(c,s);return Object.defineProperty(a,"_target",{get(){return e}}),Object.defineProperty(a,"relatedTarget",{get(){return t}}),a.fromWidget=i,a.toWidget=r,a.backwards=n,a}var ue=ii;function gb(c,e){const t=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(c),e);return t&&(t.get||t.set)?t:null}class te extends P.mixin(Ie,Kt){static get configurable(){return{clientListeners:null,disabled:!1,client:null,keyMap:null}}updateClient(e){this.owner||(this.owner=e)}updateKeyMap(e){const{client:t}=this;t.keyMap=t.mergeKeyMaps(t.keyMap,e,z.uncapitalize(this.constructor.$name))}static initPlugins(e,...t){const i=e.plugins||(e.plugins={});for(const r of t)i[r.$$name]=new r(e)}get enabled(){return!this.disabled}getFocusRevertTarget(){var e;return(e=this.client)===null||e===void 0?void 0:e.getFocusRevertTarget()}construct(...e){const t=this;let[i,r]=e,n;e.length===1?T.isObject(i)&&(r=i,i=r.client):(r=T.assign({},r),delete r.client),t.client=i,super.construct(r),t.applyPluginConfig(i),n=t.clientListeners,n&&(n=T.assign({},n),n.thisObj=t,i.ion(n))}applyPluginConfig(e){const t=this,i=t.pluginConfig||t.constructor.pluginConfig;if(i){const{assign:r,chain:n,after:s,before:a,override:o}=i;r&&t.applyAssign(e,r),(n||s)&&t.applyChain(e,n||s),a&&t.applyChain(e,a,!1),o&&t.applyOverride(e,o)}}applyAssign(e,t){t.forEach(i=>this.assign(e,i))}applyChain(e,t,i=!0){if(Array.isArray(t))for(const r of t)this.chain(e,r,r,i);else for(const r in t)this.chain(e,r,t[r],i)}applyOverride(e,t){const i=this;i.overridden||(i.overridden={}),t.forEach(r=>{if(!i[r])throw new Error(`Trying to chain fn ${e.$$name}#${r}, but plugin fn ${i.$$name}#${r} does not exist`);typeof e[r]=="function"&&(i.overridden[r]=e[r].bind(e)),e[r]=i[r].bind(i)})}assign(e,t){const i=this,r=gb(i,t);r?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:r.get&&r.get.bind(i),set:r.set&&r.set.bind(i)}):e[t]=i[t].bind(i)}chain(e,t,i,r=!0){let n=0;typeof t=="object"&&(t=t.fn),typeof i=="object"&&(n=i.prio||0,i=i.fn);const s=this,a=e.pluginFunctionChain||(e.pluginFunctionChain={}),o=s[i]&&s[i].bind(s),l=s.functionChainRunner;if(!o)throw new Error(`Trying to chain fn ${e.$$name}#${i}, but plugin fn ${s.$$name}#${i} does not exist`);if(!a[t]){let d=e[t];d&&(d=d.bind(e),d.$this=e,d.$prio=0),a[t]=d?[d]:[],e[t]=(...u)=>l(a[t],u)}o.$this=s,o.$prio=n,a[t][r?"push":"unshift"](o),a[t].$sorted=!1}functionChainRunner(e,t){let i,r,n;for(e.$sorted||(e.sort((s,a)=>a.$prio-s.$prio),e.$sorted=!0),r=0;r<e.length&&(i=e[r],!(!i.$this.isDestroyed&&(n=i(...t),n===!1)));r++);return n}doDisable(e){const t=this,{constructor:i}=t,r="featureClass"in i?i.featureClass:`b-${i.$$name.toLowerCase()}`;if(r){var n,s;(n=t.client)===null||n===void 0||(s=n.element)===null||s===void 0||s.classList[e?"remove":"add"](r)}t.isConfiguring||(e?t.trigger("disable"):t.trigger("enable"))}updateDisabled(e){this.doDisable(e)}throwOverrideIsMissing(e){throw new Error(`Trying to override fn ${e.plugIntoName}#${e.fnName}, but plugin fn ${e.pluginName}#${e.fnName} does not exist`)}get rootElement(){return this.client.rootElement}}M(te,"$name","InstancePlugin");te._$name="InstancePlugin";var tg=c=>class extends(c||P){static get $name(){return"Pluggable"}get plugins(){return this._plugins||(this._plugins={}),this._plugins}set plugins(t){t&&(Array.isArray(t)||(t=[t]),te.initPlugins(this,...t)),this.initPlugins()}initPlugins(){}addPlugins(...t){te.initPlugins(this,...t)}hasPlugin(t){return this.getPlugin(t)!=null}getPlugin(t){var i;return typeof t=="function"&&(t=t.$$name),(i=this.plugins)===null||i===void 0?void 0:i[t]}get widgetClass(){}};const{defineProperty:$l}=Reflect;let pa;K.isBrowserEnv?pa=globalThis.performance:pa={now(){return new Date().getTime()}};let Pe=null;if(ae.isTestEnv){const c=globalThis.bryntum||(globalThis.bryntum={});Pe=c.globalDelays={timeouts:new Map,intervals:new Map,animationFrames:new Map,idleCallbacks:new Map,isEmpty(e=!1){return Pe.timeouts.size+Pe.animationFrames.size+Pe.idleCallbacks.size+(e?Pe.intervals.size:0)===0},getFiltered({ignoreTimeouts:e=[],maxDelay:t=5e3,includeIntervals:i=!1}){const r=[],n=["timeouts","animationFrames","idleCallbacks"];i&&n.push("intervals");for(const s of n){const a=Pe[s];for(const[,o]of a.entries())!e.includes(o.name)&&(!Number.isInteger(o.delay)||o.delay<t)&&r.push(o)}return r}}}const dn=(c,e,t,i)=>{const r=typeof e=="string",n=i?.appendArgs||[],s=()=>{t.timerId=null,t.lastCallTime=pa.now();const a=t.args;t.args=null,r?c[e](...a,...n):e.call(c,...a,...n),t.called=!0,++t.calls};return i&&(c=i.thisObj||c),t.lastCallTime=-9e9,t.calls=0,t.invoker=s,s.wrapFn=t,s},Ns=(c,e,t="clearTimeout")=>(e.cancel=()=>{e.isPending&&(c[t](e.timerId),e.args=e.timerId=null)},e.flush=()=>{e.isPending&&(c[t](e.timerId),e.timerId=null,e.invoker())},e.now=(...i)=>{e.cancel(),e.args=i,e.invoker()},e.resume=i=>{const r=e.suspended;e.suspended=i||r<1?0:r-1},e.suspend=()=>{++e.suspended},e.immediate=!1,e.suspended=0,e.timerId=null,$l(e,"isPending",{get(){return e.timerId!==null}}),e);var he=c=>class extends(c||P){static get $name(){return"Delayable"}static get declarable(){return["delayable"]}doDestroy(){const t=this;super.doDestroy(),t.timeoutIds&&(t.timeoutIds.forEach((i,r)=>{var n;typeof i=="function"&&i(),clearTimeout(r),(n=Pe)===null||n===void 0||n.timeouts.delete(r)}),t.timeoutIds=null),t.timeoutMap&&(t.timeoutMap.forEach((i,r)=>clearTimeout(r)),t.timeoutMap=null),t.intervalIds&&(t.intervalIds.forEach(i=>{var r;clearInterval(i),(r=Pe)===null||r===void 0||r.intervals.delete(i)}),t.intervalIds=null),t.animationFrameIds&&(t.animationFrameIds.forEach(i=>{var r;cancelAnimationFrame(i),(r=Pe)===null||r===void 0||r.animationFrames.delete(i)}),t.animationFrameIds=null),t.idleCallbackIds&&(t.idleCallbackIds.forEach(i=>{var r;cancelIdleCallback(i),(r=Pe)===null||r===void 0||r.idleCallbacks.delete(i)}),t.idleCallbackIds=null)}hasTimeout(t){var i;return Boolean((i=this.timeoutMap)===null||i===void 0?void 0:i.has(t))}setTimeout({fn:t,delay:i,name:r,runOnDestroy:n,cancelOutstanding:s,args:a}){var o;(arguments.length>1||typeof arguments[0]=="function")&&([t,i,r,n]=arguments),typeof t=="string"?r=t:r||(r=t.name||t),s&&this.clearTimeout(r);const l=this,d=l.timeoutIds||(l.timeoutIds=new Map),u=l.timeoutMap||(l.timeoutMap=new Map),h=setTimeout(()=>{var f;typeof t=="string"&&(t=l[r]),d?.delete(h),u?.delete(r),(f=Pe)===null||f===void 0||f.timeouts.delete(h),t.apply(l,a)},i);return d.set(h,n?t:!0),(o=Pe)===null||o===void 0||o.timeouts.set(h,{fn:t,delay:i,name:r}),r&&u.set(r,h),h}clearTimeout(t){var i,r;let n=t;if(typeof n=="string")if(this.timeoutMap)n=this.timeoutMap.get(t),this.timeoutMap.delete(t);else return;clearTimeout(n),(i=this.timeoutIds)===null||i===void 0||i.delete(n),(r=Pe)===null||r===void 0||r.timeouts.delete(n)}clearInterval(t){var i,r;clearInterval(t),(i=this.intervalIds)===null||i===void 0||i.delete(t),(r=Pe)===null||r===void 0||r.intervals.delete(t)}setInterval(t,i,r){var n;const s=setInterval(t,i);return(this.intervalIds||(this.intervalIds=new Set)).add(s),(n=Pe)===null||n===void 0||n.intervals.set(s,{fn:t,delay:i,name:r}),s}requestAnimationFrame(t,i=[],r=this){var n;const s=this.animationFrameIds||(this.animationFrameIds=new Set),a=requestAnimationFrame(()=>{var o;(o=Pe)===null||o===void 0||o.animationFrames.delete(a),s.delete(a)&&t.apply(r,i)});return s.add(a),(n=Pe)===null||n===void 0||n.animationFrames.set(a,{fn:t,extraArgs:i,thisObj:r}),a}requestIdleCallback(t,i=[],r=this){var n;const s=this.idleCallbackIds||(this.idleCallbackIds=new Set),a=requestIdleCallback(()=>{var o;(o=Pe)===null||o===void 0||o.idleCallbacks.delete(a),s.delete(a)&&t.apply(r,i)});return s.add(a),(n=Pe)===null||n===void 0||n.idleCallbacks.set(a,{fn:t,extraArgs:i,thisObj:r}),a}createOnFrame(t,i=[],r=this,n){let s;const a=(...o)=>{s!=null&&n&&(this.cancelAnimationFrame(s),s=null),s==null&&(s=this.requestAnimationFrame(()=>{typeof t=="string"&&(t=r[t]),s=null,o.push(...i),t.apply(r,o)}))};return a.cancel=()=>this.cancelAnimationFrame(s),a}cancelAnimationFrame(t){var i,r;cancelAnimationFrame(t),(i=this.animationFrameIds)===null||i===void 0||i.delete(t),(r=Pe)===null||r===void 0||r.animationFrames.delete(t)}cancelIdleCallback(t){var i,r;cancelIdleCallback(t),(i=this.idleCallbackIds)===null||i===void 0||i.delete(t),(r=Pe)===null||r===void 0||r.idleCallbacks.delete(t)}async nextAnimationFrame(){return new Promise(t=>this.requestAnimationFrame(t))}buffer(t,i){let r=i;i&&typeof i!="number"?r=i.delay:i=null;const n=(...a)=>{if(n.suspended)return;const{delay:o}=n;n.cancel(),n.called=!1,n.args=a,n.immediate||!o?s():n.timerId=this.setTimeout(s,o)},s=dn(this,t,n,i);return n.delay=r,Ns(this,n)}raf(t,i){let r=i;i&&typeof i!="boolean"?r=i.cancelOutstanding:i=null;const n=(...a)=>{n.suspended||(n.cancelOutstanding&&n.cancel(),n.called=!1,n.args=a,n.immediate?s():n.isPending||(n.timerId=this.requestAnimationFrame(s)))},s=dn(this,t,n,i);return n.cancelOutstanding=r,Ns(this,n,"cancelAnimationFrame")}idle(t,i){let r=i;i&&typeof i!="boolean"?r=i.cancelOutstanding:i=null;const n=(...a)=>{n.suspended||(n.cancelOutstanding&&n.cancel(),n.called=!1,n.args=a,n.immediate?s():n.isPending||(n.timerId=this.requestIdleCallback(s)))},s=dn(this,t,n,i);return n.cancelOutstanding=r,this.setTimeout(()=>this.idleCallbackIds.delete(n.timerId)&&n.now(),100),Ns(this,n,"cancelIdleCallback")}throttle(t,i){let r=i,n;i&&typeof i!="number"?(r=i.delay,n=i.throttled):i=null;const s=this,a=(...l)=>{if(a.suspended)return;const{delay:d}=a,u=pa.now()-a.lastCallTime;a.args=l,a.immediate||u>=d?(s.clearTimeout(a.timerId),o()):(a.isPending||(a.timerId=s.setTimeout(o,d-u),a.called=!1),n&&(n.wrapFn.args=l,n()))},o=dn(s,t,a,i);return a.delay=r,n&&(n=dn(s,n,()=>{},i)),Ns(s,a)}static setupDelayable(t){t.setupDelayableMethods(t.delayable)}static setupDelayableMethods(t,i=null){const r=this,n=t.static,s=i||r.prototype;n&&delete t.static;for(const a in t){let o=t[a];const l=a+"Now",d=typeof o;s[l]||(s[l]=s[a]),d==="number"?o={type:"buffer",delay:o}:d==="string"&&(o={type:o}),$l(s,a,{get(){const u=this[o.type]((...h)=>{this[l](...h)},o);return $l(this,a,{value:u}),u}})}}get widgetClass(){}};class Vn{get data(){return Object.create(null)}get keys(){return[]}clear(){}getItem(e){return null}removeItem(e){}setItem(e,t){}}Vn._$name="StateStorage";const ig=()=>Object.create(null),au=(c,e=0)=>{const t=[],i=localStorage.length;for(let r,n=0;n<i;++n)r=localStorage.key(n),r.startsWith(c)&&t.push(r.slice(e));return t},mb=class extends Vn{constructor(c){super(),this.prefix=c.prefix||""}get isLocal(){return!0}get data(){const c=ig(),e=this.keys;for(const t of e)c[t]=this.getItem(t);return c}get keys(){return au(this.prefix,this.prefix.length)}clear(){const c=au(this.prefix);for(const e of c)localStorage.removeItem(e)}getItem(c){const e=localStorage.getItem(this.prefix+c);return e===null?e:JSON.parse(e)}removeItem(c){return localStorage.removeItem(this.prefix+c)}setItem(c,e){return localStorage.setItem(this.prefix+c,JSON.stringify(e))}},pb=class extends Vn{constructor(){super(),this.clear()}get isMemory(){return!0}get data(){return T.clone(this._data)}get keys(){return Object.keys(this._data)}clear(){this._data=ig()}getItem(c){return c in this._data?this._data[c]:null}removeItem(c){delete this._data[c]}setItem(c,e){this._data[c]=e}},rg=new Vn,Uo={local:mb,memory:pb};class Gi extends P.mixin(he,Ie){static get $name(){return"StateProvider"}static get configurable(){return{prefix:"bryntum-state:",storage:"local"}}static get delayable(){return{writeStatefuls:50}}static get instance(){return this._instance}static set instance(e){e==null?e=ng:((typeof e=="string"||T.isClass(e)||e instanceof Vn)&&(e={storage:e}),T.isObject(e)&&(e=new Gi(e))),this._instance=e}static setup(e){return this.instance=e,this.instance}doDestroy(){self.writeStatefuls.flush(),super.doDestroy()}get data(){return this.storage.data}set data(e){if(!e)this.clear();else for(const t in e)this.setValue(t,e[t])}clear(){return this.storage.clear(),this}changeStorage(e){if(e==null)e=rg;else{if(typeof e=="string"){if(!Uo[e])throw new Error(`Invalid storage type "${e}" (expected one of: "${Object.keys(Uo).join('", "')}")`);e=Uo[e]}T.isClass(e)&&(e=new e(this))}return e}saveStateful(e,t){(this.pendingSaves||(this.pendingSaves=[])).push([e,t]),this.writeStatefuls()}writeStatefuls(){const e=this,{pendingSaves:t}=e,i=t?.length,r=[],n=[];if(e.pendingSaves=null,i){for(let s,a,o,l=0;l<i;++l)[a,s]=t[l],!a.isDestroying&&a.isSaveStatePending&&(o=a.saveState(F(F({},s),{},{immediate:!0})),o&&(r.push(o),n.push(a)));r.length&&e.trigger("save",{stateIds:r,saved:n})}}getValue(e){return this.writeStatefuls.flush(),this.storage.getItem(e)}setValue(e,t){const i=this,{storage:r}=i,n=i.getValue(e);return t!=null?(r.setItem(e,t),i.trigger("set",{key:e,value:t,was:n})):n!==null&&(r.removeItem(e),i.trigger("remove",{key:e,was:n})),i}}const ng=new Gi({storage:rg});Gi._instance=ng;Gi._$name="StateProvider";const vb=/boolean|number|string/;var ka=c=>{var e;return e=class extends(c||P){afterConstruct(){super.afterConstruct(),this.loadState()}finalizeInit(){this.loadState(),super.finalizeInit()}get isStateful(){return!0}get isStatefulActive(){return!this.statefulSuspended&&!this.isResponsivePending&&!this.isResponsiveUpdating}get state(){return this._state=this.getState()}set state(i){this._state=i,i&&this.applyState(i)}updateStatefulEvents(i){const r=this,n={name:"statefulEvents",thisObj:r};if(r.detachListeners(n.name),i&&(typeof i=="string"?i=z.split(i):Array.isArray(i)||(i=T.getTruthyKeys(i)),i.length)){var s;for(const a of i)n[a]="onStatefulEvent";(s=r.ion)===null||s===void 0||s.call(r,n)}}get statefulId(){const i=this,{responsiveState:r}=i;let n=i.stateId;return n==null&&i.hasGeneratedId===!1&&i.stateful!==!1&&(n=i.id),n&&r&&(n=`${n}[${r}]`),n}get statefulness(){const{stateful:i}=this;return Array.isArray(i)?T.createTruthyKeys(i):i}get stateProvider(){return this._stateProvider||Gi.instance}applyState(i){i=this.pruneState(i),i&&this.setConfig(i)}getState(){const i=this,{statefulness:r}=i;let n=null,s,a;if(r){n={};for(s in r)if(r[s]){var o,l;if(a=i[s],(o=a)!==null&&o!==void 0&&o.isStateful)a=a.state;else if(a===((l=i.initialConfig)===null||l===void 0?void 0:l[s])||!vb.test(typeof a))continue;n[s]=a}}return n}loadState(i,r){typeof i=="boolean"&&(r=i,i=null);const n=this,{statefulLoaded:s}=n;if(n.isStatefulActive&&(r||!s)){const a=n.loadStatefulData(i||(i=n.statefulId));!s&&i&&(n.defaultState=n.state,n.statefulLoaded=!0),a&&(n.state=a)}}loadStatefulData(i){var r;return i=this.isStatefulActive?i||this.statefulId:null,i&&((r=this.stateProvider)===null||r===void 0?void 0:r.getValue(i))}resetDefaultState(){this.defaultState&&(this.state=this.defaultState)}resumeStateful(i=!1){this.statefulSuspended=i?0:Math.max(this.statefulSuspended-1,0)}saveState(i){typeof i=="string"?i={id:i}:i=i||{};const r=this,{stateProvider:n}=r,s=i.id||r.isStatefulActive&&r.statefulId;if(s&&n)return i.immediate?(r.isSaveStatePending=!1,n.setValue(s,r.state)):r.isSaveStatePending||(r.isSaveStatePending=!0,n.saveStateful(r,i)),s}suspendStateful(){++this.statefulSuspended}onConfigChange({name:i,value:r,was:n,config:s}){if(super.onConfigChange({name:i,value:r,was:n,config:s}),!this.isConstructing&&this.isStatefulActive&&this.statefulId){const{stateful:a}=this;(Array.isArray(a)?a.includes(i):a?.[i])&&this.saveState()}}onStatefulEvent(){this.isConstructing||this.saveState()}pruneState(i){const{statefulness:r}=this;if(r){const n={};for(const s in i)r[s]&&(n[s]=i[s]);i=n}return i}get widgetClass(){}},M(e,"$name","State"),M(e,"configurable",{stateful:null,statefulEvents:{$config:{merge:"classList"},value:["stateChange"]},stateId:null,stateProvider:null}),M(e,"prototypeProperties",{statefulLoaded:!1,statefulSuspended:0}),e};const ou=T.getPathDefault(globalThis,"bryntum.idCounts",Object.create(null)),yb={string:1,number:1};var jn=c=>class extends(c||P){static get $name(){return"Identifiable"}static get declarable(){return["identifiable"]}static get configurable(){return{id:""}}static setupIdentifiable(t,i){const{identifiable:r}=t;r.idMap=Object.create(null),Reflect.defineProperty(t,"identifiable",{get(){return r}})}doDestroy(){this.constructor.unregisterInstance(this),super.doDestroy()}changeId(t){return(this.hasGeneratedId=!t)?this.generateAutoId():t}updateId(t,i){const r=this,n=r.constructor;i&&n.unregisterInstance(r,i),(!r.hasGeneratedId||n.identifiable.registerGeneratedId!==!1)&&n.registerInstance(r,t)}generateAutoId(){return this.constructor.generateId(`b-${this.$$name.toLowerCase()}-`)}static get all(){return Object.values(this.identifiable.idMap)}static generateId(t="generatedId"){return t+(ou[t]=(ou[t]||0)+1)}static registerInstance(t,i=t.id){const{idMap:r}=this.identifiable;if(i in r&&!this.disableThrow)throw new Error("Id "+i+" already in use");r[i]=t}static unregisterInstance(t,i=t.id){const{idMap:r}=this.identifiable;yb[typeof t]?delete r[t]:r[i]===t&&delete r[i]}static getById(t){const i=this.identifiable.idMap;if(i)return i[t]}static get registeredInstances(){const t=this.identifiable.idMap;return t?Object.values(t):[]}};const lu=Symbol("STM_PROP"),Yo={parentIndex:1};var bb=c=>class extends(c||P){static get $name(){return"ModelStm"}static get defaultConfig(){return{stm:null}}joinStore(t){this.stm||(this.stm=t.stm)}unjoinStore(t){var i;this.stm===t.stm&&(this.stm=null),(i=super.unjoinStore)===null||i===void 0||i.call(this,t)}get stm(){return this[lu]}set stm(t){this[lu]=t}beforeChronoFieldSet(t,i){const r=this,{stm:n}=r,s=[];if(!r.inSetting&&n!==null&&n!==void 0&&n.enabled&&!Yo[t]&&!r.constructor.nonPersistableFields[t]&&r.getFieldDefinition(t)){const a={[t]:i},o={[t]:r[t]};s.push([a,o])}return s}beforeSet(t,i,r,n){const{stm:s}=this;if(s!=null&&s.enabled&&!Yo[t]&&!this.constructor.nonPersistableFields[t]){var a;const o=((a=super.beforeSet)===null||a===void 0?void 0:a.call(this,t,i,r,n))||[];let l,d;return typeof t=="object"?[l,d]=Object.keys(t).reduce((u,h)=>(u[0][h]=t[h],u[1][h]=this.get(h),u),[{},{}]):(l={[t]:i},d={[t]:this.get(t)}),o.push([l,d]),o}return[]}afterChronoFieldSet(t,i,r){r!=null&&r[0]&&this.afterSet(t,i,!1,!1,r,r[0][0],!0)}shouldRecordFieldChange(t,i,r){const n=this.firstStore;return!(this.constructor.nonPersistableFields[t]||i==null&&r==null||i===r||i instanceof Date&&r instanceof Date&&i.getTime()===r.getTime()||t==="id"||t==="parentId"&&n&&n.oldIdMap[i]===n.getById(r))}afterSet(t,i,r,n,s,a,o){const{stm:l}=this,d=this.constructor.nonPersistableFields;if(l!=null&&l.isBase&&l.enabled&&!Yo[t]&&!d[t]){const u=s.pop();if(a){let h;const[f,g]=u,[m,p]=Object.keys(a).reduce((v,y)=>{const C=f[y],D=g[y];return this.shouldRecordFieldChange(y,D,C)&&(h=!0,v[0][y]=C,v[1][y]=D),v},[{},{}]);h&&l.onModelUpdate(this,m,p,o)}}}beforeInsertChild(t){var i;const r=((i=super.beforeInsertChild)===null||i===void 0?void 0:i.call(this,t))||[],{stm:n}=this;return n!=null&&n.enabled&&r.push(t.reduce((s,a)=>(a.root===this.root&&s.set(a,{parent:a.parent,index:a.parent?a.parentIndex:void 0}),s),new Map)),r}afterInsertChild(t,i,r,n){var s;const{stm:a}=this;if(a!=null&&a.enabled){const o=r.pop();n&&a.onModelInsertChild(this,t,n,o)}(s=super.afterInsertChild)===null||s===void 0||s.call(this,t,i,r,n)}beforeRemoveChild(t,i){const r=super.beforeRemoveChild?super.beforeRemoveChild(t,i):[],{stm:n}=this;return n!=null&&n.enabled&&!i&&r.push(t.reduce((s,a)=>(s.set(a,a.parentIndex),s),new Map)),r}afterRemoveChild(t,i,r){var n;const{stm:s}=this;if(s!=null&&s.enabled&&!r){const a=i.pop();t&&t.length&&s.onModelRemoveChild(this,t,a)}(n=super.afterRemoveChild)===null||n===void 0||n.call(this,t,i,r)}};const Cb={includeFilteredOutRecords:!1},Go=c=>(c=c||!1,typeof c=="boolean"&&(c={includeFilteredOutRecords:c}),c||Cb);var wb=c=>class extends(c||P){static get $name(){return"TreeNode"}static set convertEmptyParentToLeaf(t){t===!0?t={onLoad:!0,onRemove:!0}:t===!1&&(t={onLoad:!1,onRemove:!1}),this._convertEmptyParentToLeaf=t}static get convertEmptyParentToLeaf(){return this._convertEmptyParentToLeaf||{onLoad:!1,onRemove:!1}}ingestChildren(t,i=this.stores){const{inProcessChildren:r,constructor:n}=this,s=i[0];if(t===!0)return r?!0:[];if(t){t=W.asArray(t);const a=t.length,o=[];for(let l=0,d;l<a;l++)d=t[l],d=d.isModel?d:s?s.createRecord(d,!1,!0):new n(d,null,null,!0),d=s?s.processRecord(d):d,o.push(d);if(this.children===!0&&s){const l=s.createSorterFn(s.sorters);o.sort(l)}return o}}processChildren(t=this.stores){const i=this,{meta:r}=i;i.inProcessChildren=!0;const n=i.ingestChildren(i.data[i.constructor.childrenField],t);if(n){const{convertEmptyParentToLeaf:s}=i.constructor;if(s===!0||s.onLoad?n.length:Array.isArray(n)){if(r.isLeaf=!1,i.children===!0)i.children=[];else if(n.length===0){i.children=n;return}i.appendChild(n)}else n===!0?(r.isLeaf=!1,i.children=!0):i.isRoot||(r.isLeaf=i.constructor.convertEmptyParentToLeaf.onLoad)}i.inProcessChildren=!1}ancestorsExpanded(t=this.firstStore){const{parent:i}=this;return!i||i.isExpanded(t)&&i.ancestorsExpanded(t)}isExpanded(t=this.firstStore){const i=this.instanceMeta(t.id);return Object.prototype.hasOwnProperty.call(i,"collapsed")||(i.collapsed=!this.expanded),!i.collapsed}get expanded(){return this.data.expanded}get childLevel(){let t=this,i=-1;for(;t&&!t.isRoot;)++i,t=t.parent;return i}get isLeaf(){return this.meta.isLeaf!==!1&&!this.isRoot}get isParent(){return!this.isLeaf}get isLoaded(){return this.isParent&&Array.isArray(this.children)}get descendantCount(){return this.getDescendantCount()}get visibleDescendantCount(){return this.getDescendantCount(!0)}getDescendantCount(t=!1,i=this.firstStore){const r=this.children;return!r||!Array.isArray(r)||t&&!this.isExpanded(i)?0:r.reduce((n,s)=>n+s.getDescendantCount(t),r.length)}get allChildren(){const t=this.children;return t?t.reduce((i,r)=>(i.push(r),i.push.apply(i,r.allChildren),i),[]):[]}get firstChild(){const t=this.children;return t?.length&&t[0]||null}get lastChild(){const t=this.children;return t?.length&&t[t.length-1]||null}get previousSiblingsTotalCount(){let t=this.previousSibling,i=this.parentIndex;for(;t;)i+=t.descendantCount,t=t.previousSibling;return i}get previousOrderedSibling(){var t;return(t=this.parent)===null||t===void 0?void 0:t.orderedChildren[this.orderedParentIndex-1]}get nextOrderedSibling(){var t;return(t=this.parent)===null||t===void 0?void 0:t.orderedChildren[this.orderedParentIndex+1]}get root(){var t;return((t=this.parent)===null||t===void 0?void 0:t.root)||this}get parentId(){return this.parent&&!this.parent.isAutoRoot?this.parent.id:null}set parentId(t){const i=this,{parent:r}=i,n=t===null?i.firstStore.rootNode:i.firstStore.getById(t);n===r||!r&&!n||(i.isBatchUpdating?i.meta.batchChanges.parentId=t:n?n.appendChild(i):i.parent.removeChild(i))}static set parentIdField(t){this._parentIdField=t,Object.defineProperty(this.prototype,t,{set:function(i){this.parentId=i},get:function(){return this.parentId}})}static get parentIdField(){return this._parentIdField||"parentId"}getChildren(t){let i;return t.includeFilteredOutRecords?i=this.unfilteredChildren||this.children:t.useOrderedTree?i=this.orderedChildren:i=this.children,i}traverse(t,i,r){r=Go(r);const n=this,s=n.getChildren(r);i||t.call(n,n);for(let a=0,o=s?.length;a<o;a++)s[a].traverse(t,!1,r)}traverseBefore(t,i,r){r=Go(r);const n=this,s=n.getChildren(r);for(let a=0,o=s?.length;a<o;a++)s[a].traverse(t,!1,r);i||t.call(n,n)}traverseWhile(t,i,r){r=Go(r);const n=this;let s=i||t.call(n,n)!==!1;if(s){const a=n.getChildren(r);a!=null&&a.length&&(s=a.every(o=>o.traverseWhile(t,!1,r)))}return s}bubble(t,i=!1){let r=this;for(i||t.call(r,r);r.parent;)r=r.parent,t.call(r,r)}bubbleWhile(t,i=!1){let r=this,n=!0;for(i||(n=t.call(r,r));n&&r.parent;)r=r.parent,n=t.call(r,r);return n}contains(t,i=!1){return t&&typeof t=="object"&&(t=t.id),!this.traverseWhile(r=>r.id!=t,i)}getTopParent(t){let i;return t?(i=[],this.bubbleWhile(r=>(i.push(r),r.parent&&!r.parent.isRoot))):(i=null,this.bubbleWhile(r=>(r.parent||(i=r),r.parent&&!r.parent.isRoot))),i}appendChild(t,i=!1){return this.insertChild(t,null,i)}insertChild(t,i=null,r=!1,n={}){var s,a,o,l,d,u;const h=this,f=Array.isArray(t);if(t=W.asArray(t),typeof i=="number"){var g,m;i=(g=(m=h.children)===null||m===void 0?void 0:m[i])!==null&&g!==void 0?g:null}if(!r&&!h.stores.every(C=>C.trigger("beforeAdd",{records:t,parent:h})!==!1))return null;t=h.ingestChildren(t);const p=(s=(a=(o=i)===null||o===void 0?void 0:o.parentIndex)!==null&&a!==void 0?a:(l=h.children)===null||l===void 0?void 0:l.length)!==null&&s!==void 0?s:0,v=(d=h.beforeInsertChild)===null||d===void 0?void 0:d.call(h,t),y=h.internalAppendInsert(t,i,r,n);return y.length&&h.convertToParent(r),(u=h.afterInsertChild)===null||u===void 0||u.call(h,p,t,v,y),f||!y?y:y[0]}convertToParent(t=!1){const i=this,r=i.isLeaf;i.meta.isLeaf=!1,i.children||(i.children=[]),r&&!i.root.isLoading&&!t&&i.signalNodeChanged({isLeaf:{value:!1,oldValue:!0}})}signalNodeChanged(t){this.stores.forEach(i=>{i.trigger("update",{record:this,records:[this],changes:t}),i.trigger("change",{action:"update",record:this,records:[this],changes:t})})}tryInsertChild(){return this.insertChild(...arguments)}internalAppendInsert(t,i,r,n){const s=this,{stores:a,root:o}=s,{firstStore:l}=o,{parentIdField:d}=s.constructor,u=s.isAutoRoot?null:s.id,h=[],f={};let g,m,p,v;if(!o.isLoading)for(p=0;p<t.length;p++){const y=t[p];f[y.id]=y.root===o,h[p]=y.parentIndex}if(i&&i.parent!==s&&(i=null),s.children){const y=s.children,C=i?i.parentIndex:y.length;if(y[m=C]===t[0]||y[m=C-1]===t[0])for(g=!0,p=0;g&&p<t.length;p++)t[p]!==y[m+p]&&(g=!1)}if(g)return t;for(p=0;p<t.length;p++){const y=t[p],C=y.parent;l&&!o.isLoading&&y.traverse(D=>{D.root===o&&(f[D.id]=!0)}),C?.removeChild(y,f[y.id],r,F({isInserting:!0},n))===!1?(v||(t=t.slice(),v=!0),t.splice(p--,1)):(y.parent=s,y.data[d]=u,C&&(y.meta.oldParentId=C.id))}if(t.length){Array.isArray(s.children)||(s.children=[]),Array.isArray(s.orderedChildren)||(s.orderedChildren=[]);const y=s.addToChildren(i,t,n);a.forEach(C=>{C.isChained||(t.forEach(D=>{D.joinStore(C)}),C.onNodeAddChild(s,t,y,f,r),t.forEach((D,w)=>{if(D.meta.oldParentId!=null&&!(s.inProcessChildren||s.isLoading)){const E={[d]:u,[s.getDataSource("parentIndex")]:D.parentIndex},R={},{modified:x,oldParentId:k}=D.meta,I=h[w];delete D.meta.oldParentId,s.id!==k&&(R[d]={value:u,oldValue:k}),D.parentIndex!==I&&(R.parentIndex={value:D.parentIndex,oldValue:I}),x[d]===s.id?Reflect.deleteProperty(x,d):d in x||(x[d]=k),D.afterChange(E,R)}}))})}return t}removeChild(t,i=!1,r=!1,n={}){var s,a;const o=this,l=[],d=o.isLeaf,{children:u,stores:h}=o;if(t=W.asArray(t),t=t.filter(g=>g.parent===o),!r){for(const g of h)if(!g.isChained&&g.trigger("beforeRemove",{parent:o,records:t,isMove:i})===!1)return!1}const f=(s=o.beforeRemoveChild)===null||s===void 0?void 0:s.call(o,t,i);for(const g of t){const{parentIdField:m}=g.constructor,{modified:p}=g.meta,v=g.parent?g.parent.id:null;!(m in p)&&!g.isLinked&&(p[m]=v);const y=o.removeFromChildren(g,n);h.forEach(C=>{if(!C.isChained){const{isRemoving:D}=C;C.isRemoving=!0,l.push(...C.onNodeRemoveChild(o,[g],y,{isMove:i,silent:r})),C.isRemoving=D}}),i||(g.parent=g.parentIndex=g.unfilteredIndex=g.nextSibling=g.previousSibling=null,g.data[m]=null)}return(o.unfilteredChildren||u).length===0&&o.constructor.convertEmptyParentToLeaf.onRemove&&!o.isRoot&&(o.meta.isLeaf=!0),o.isLeaf!==d&&!r&&o.stores.forEach(g=>{const m={isLeaf:{value:!0,oldValue:!1}};g.trigger("update",{record:o,changes:m}),g.trigger("change",{action:"update",record:o,changes:m})}),(a=o.afterRemoveChild)===null||a===void 0||a.call(o,t,f,i),l}clearParentId(){const t=this;Reflect.deleteProperty(t.data,t.parentIdField),Reflect.deleteProperty(t.originalData,t.parentIdField),t.meta.modified&&Reflect.deleteProperty(t.meta.modified,t.parentIdField)}replaceChildren(t){return this.clearChildren(),this.data[this.constructor.childrenField]=t,this.processChildren(),this.children}clearChildren(t=!1){const i=this,{stores:r}=i,n=i.unfilteredChildren||i.children;i.children=[],i.orderedChildren=[],n&&n!==!0&&(r.forEach(s=>{s.isChained||s.onNodeRemoveChild(i,n,0,{unfiltered:!0,silent:t})}),i.unfilteredChildren&&(i.unfilteredChildren=[]))}clear(){var t;const i=this,{stores:r}=i,n=(t=i.children)===null||t===void 0?void 0:t.slice();if(!(!i.isRoot||!n)){for(const s of r)if(!s.isChained&&s.trigger("beforeRemove",{parent:i,records:n,isMove:!1,removingAll:!0})===!1)return!1;i.children.length=0,i.unfilteredChildren&&(i.unfilteredChildren.length=0),r.forEach(s=>{n.forEach(a=>{a.stores.includes(s)&&a.unjoinStore(s),a.parent=a.parentIndex=a.nextSibling=a.previousSibling=null}),s.storage.suspendEvents(),s.storage.clear(),s.storage.resumeEvents(),s.added.clear(),s.modified.clear(),s.trigger("removeAll"),s.trigger("change",{action:"removeall"})})}}updateChildrenIndices(t,i,r=!1){let n=null;for(let s=0;s<t.length;s++){const a=t[s],o=a[i];i==="parentIndex"||i==="orderedParentIndex"?o===void 0||r?a.setData(i,s):o!==s&&a.set(i,s,!0):a[i]=s,i==="parentIndex"&&(a.previousSibling=n,n&&(n.nextSibling=a),s===t.length-1&&(a.nextSibling=null),n=a)}}addToChildren(t,i,r={}){var n;const s=this,a=[[s.children,"parentIndex",t],[s.unfilteredChildren,"unfilteredIndex",t],[s.orderedChildren,"orderedParentIndex",(n=r?.orderedBeforeNode)!==null&&n!==void 0?n:t]];for(const l of a){const[d,u,h]=l;if(d){var o;const f=h?h[u]:d.length;l.push(f),d.splice(f,0,...i),r!=null&&(o=r[u])!==null&&o!==void 0&&o.skip||s.updateChildrenIndices(d,u)}}return a[0][3]}removeFromChildren(t,i){const r=[[this.children,"parentIndex"],[this.unfilteredChildren,"unfilteredIndex"],[this.orderedChildren,"orderedParentIndex"]];for(const s of r){const[a,o]=s;if(a){const l=a.indexOf(t);if(s.push(l),l>-1){var n;a.splice(l,1),i!=null&&(n=i[o])!==null&&n!==void 0&&n.skip||this.updateChildrenIndices(a,o)}}}return r[0][2]}sortOrderedChildren(t=!0,i=!1){const r=[];return this.isLeaf||(this.orderedChildren.sort((n,s)=>{if(i){var a,o;const l=(a=n.meta.modified.orderedParentIndex)!==null&&a!==void 0?a:n.orderedParentIndex,d=(o=s.meta.modified.orderedParentIndex)!==null&&o!==void 0?o:s.orderedParentIndex,u=l-d;return u!==0&&(r.push(n),r.push(s)),u}else return n.orderedParentIndex-s.orderedParentIndex}),t&&this.orderedChildren.forEach(n=>{r.push(...n.sortOrderedChildren(t,i))}),this.updateChildrenIndices(this.orderedChildren,"orderedParentIndex",!0)),new Set(r)}};const du={id:1,stores:1,parentIndex:1,parent:1,previousSibling:1,nextSibling:1,unfilteredIndex:1},Sb={get(c,e){return e==="proxyMeta"?this.proxyMeta:e==="constructor"?c.constructor:e==="setData"?this.setDataOverride:e==="set"?this.setOverride:du[e]?this.proxyMeta.data[e]:Reflect.get(c,e,this.proxyRecord)},set(c,e,t){return du[e]?this.proxyMeta.data[e]=t:c[e]=t,!0},setDataOverride(c,e){c==="parentIndex"?this.proxyMeta.data.parentIndex=e:this.proxyMeta.originalRecord.setData(c,e)},setOverride(c,e,...t){c==="parentIndex"?this.proxyMeta.data.parentIndex=e:this.proxyMeta.originalRecord.set(c,e,...t)}};var Db=c=>{var e;return e=class extends(c||P){link(){if(this.isLinked)return this.$original.link();const i=this,r=F(F({},Sb),{},{proxyMeta:{originalRecord:i,data:{id:`${i.id}_link_${z.generateUUID()}`,stores:[]}}}),n=new Proxy(i,r);return r.proxyRecord=n,(i.meta.linkedRecords||(i.meta.linkedRecords=[])).push(n),n}get isLinked(){var i;return Boolean((i=this.proxyMeta)===null||i===void 0?void 0:i.originalRecord)}get hasLinks(){return Boolean(!this.proxyMeta&&this.$links.length)}removeLink(i,r=null,n=!1){if(i.hasLinks)for(const s of i.$links.slice())r?W.include(r,s):s.remove(n);else i.isLinked&&W.remove(i.$original.$links,i)}beforeRemove(i){this.removeLink(this,i)}removeChild(i,r,n,s){if(!(s!=null&&s.isInserting)){i=W.asArray(i);for(const a of i)this.removeLink(a,null,n)}return super.removeChild(i,r,n,s)}get $originalId(){return this.$original.id}get $links(){var i;return(i=this.meta.linkedRecords)!==null&&i!==void 0?i:[]}},M(e,"$name","ModelLink"),e};const{defineProperty:cu}=Reflect,qo=Symbol("owner"),Eb=/[\s,]+/;var ai=c=>class extends(c||P){static get $name(){return"Factoryable"}static get declarable(){return["factoryable","alias","type"]}static register(t,i,r=globalThis.__BRYNTUM_EXAMPLE){const{factoryable:n}=this.initClass(),{caseless:s,registry:a}=n,o=z.split(t,Eb);for(let l,d,u=0;u<o.length;++u){if(d=o[u],l=s?d.toLowerCase():d,!r&&l in a)throw new Error(`Type "${d}" already registered with ${n.class.name} factory`);a[d]=a[l]=i.initClass()}}static isA(t,i){return this.isType(t,i,!0)}static isType(t,i,r){const{factoryable:n}=this,{caseless:s,registry:a}=n,o=a[s?i.toLowerCase():i];return o?r?t instanceof o:t.constructor===o:!1}static setupAlias(t){t.register(t.alias,t)}static setupFactoryable(t,i){const r=i.super.class;let{factoryable:n}=t;n=F({caseless:!0,defaultType:null,extends:r.factoryable?[r]:null,typeKey:"type"},n),n.class=t,n.registry=Object.create(null),n.extends&&!Array.isArray(n.extends)&&(n.extends=[n.extends]),cu(t,"factoryable",{get(){return n}})}static setupType(t,i){const{type:r}=t;t.register(r,t,i.replaceType),cu(t.prototype,"type",{value:r})}static create(t,i){return this.reconfigure(null,t,i)}static reconfigure(t,i,r){const n=this,{factoryable:s}=n,{typeKey:a}=s;let o=r,l,d,u,h,f,g,m,p,v;if(r&&!T.isClass(r)&&(o=null,m=typeof r,m==="function"?g=r:m==="string"?o=r:T.isObject(r)?(l=r.cleanup,d=r.defaults,h=r.owner,g=r.setup,o=r.type,p=r.transform):h=r),p&&(i=typeof p=="string"?h[p](i):p(i)),v=i,typeof v=="string")i={};else if(i){if(i===!0&&(i={}),!T.isObject(i)){if(h&&i!==t&&t?.[qo]===h){var y;typeof l=="string"?h[l](t):(y=l)===null||y===void 0||y(t),t.destroy()}return i}v=i[a]}if(v=v&&n.resolveType(v),t){if(i&&(!v||t.constructor===v))return a in i&&(i=T.assign({},i),delete i[a]),t.setConfig(i),t;if(h&&t[qo]===h){var C;typeof l=="string"?h[l](t):(C=l)===null||C===void 0||C(t),t.destroy()}}if(i){if(d){if(!(u=v)){if(!(u=d[a]||o||s.defaultType))throw new Error(`No default mergeType defined for ${s.class.name} factory`);u=n.resolveType(u)}u&&(i=u.mergeConfigs(d,i))}if(g){if(f=typeof g=="string"?h[g](i,v,d):g(i,v,d),f===null)return f;i=f||i}if(!v){if(!(v=i[a]||o||s.defaultType))throw new Error(`No default type defined for ${s.class.name} factory`);v=n.resolveType(v)}d&&!u&&(i=v.mergeConfigs(d,i)),a in i&&(i=T.assign({},i),delete i[a]),i=new v(i),h&&(i[qo]=h)}return i||null}static resolveType(t,i){if(typeof t!="string")return t;const{factoryable:r}=this,n=r.extends;let s=r.registry[r.caseless?t.toLowerCase():t],a;for(a=0;!s&&n&&a<n.length;++a)s=n[a].resolveType(t,!0);if(!s&&!i)throw new Error(`Invalid type name "${t}" passed to ${r.class.name} factory`);return s}};const{getOwnPropertyDescriptor:xb}=Reflect;class Pt extends P.mixin(ai){static get $name(){return"DataField"}static get type(){return"auto"}static get factoryable(){return{defaultType:"auto"}}static get prototypeProperties(){return{compare:null,compareItems:null,dataSource:null,alwaysWrite:!1,nullable:!0,nullText:null,nullValue:void 0,persist:!0,readOnly:!1,internal:!1}}construct(e){const t=this;e&&(t.name=e.name,Object.assign(t,e)),t.compare&&(t.compareItems=(i,r)=>t.compare(i?.[t.name],r?.[t.name]))}defineAccessor(e,t){const{name:i,dataSource:r}=this;!t&&i in e&&e.$meta.hierarchy.some(n=>{var s;return((s=xb(n.prototype,i))===null||s===void 0?void 0:s.enumerable)===!1})||Reflect.defineProperty(e,i,{configurable:!0,enumerable:!0,get:this.complexMapping?function(){return this.complexGet(i,r)}:function(){return this.batching&&i in this.meta.batchChanges?this.meta.batchChanges[i]:r in this.data?this.data[r]:this.data[i]},set(n){const s=this.$meta.fields.map[i];s&&s.readOnly||this.set(i,n)}})}isEqual(e,t){return T.isEqual(e,t)}print(e){return e==null?this.nullText:this.printValue(e)}printValue(e){return String(e)}}Pt._$name="DataField";class sg extends Pt{static get $name(){return"ArrayDataField"}static get type(){return"array"}isEqual(e,t){return e===t}}sg.initClass();sg._$name="ArrayDataField";class ag extends Pt{static get $name(){return"BooleanDataField"}static get type(){return"boolean"}static get alias(){return"bool"}static get prototypeProperties(){return{nullValue:!1}}isEqual(e,t){return e==null&&t==null?!0:super.isEqual(e,t)}convert(e){var t;return e==null?this.nullable?e:this.nullValue:((t=e.toLowerCase)===null||t===void 0?void 0:t.call(e))==="false"?!1:Boolean(e)}}ag.initClass();ag._$name="BooleanDataField";class og extends Pt{static get $name(){return"DateDataField"}static get type(){return"date"}static get prototypeProperties(){return{format:null}}convert(e){return e==null?this.nullable||(e=this.nullValue):e==="now"?e=new Date:e instanceof Date||(e=b.parse(e,this.format||b.defaultParseFormat),(!e||isNaN(e))&&(e=void 0)),e}serialize(e){return e instanceof Date&&(e=b.format(e,this.format||b.defaultFormat)),e}printValue(e){return b.format(e,this.format||b.defaultFormat)}}og.initClass();og._$name="DateDataField";class Zl extends Pt{static get $name(){return"StringDataField"}static get type(){return"string"}static get prototypeProperties(){return{nullValue:""}}convert(e){return e==null?this.nullable?e:this.nullValue:String(e)}}Zl.initClass();Zl._$name="StringDataField";class lg extends Zl{static get $name(){return"DurationUnitDataField"}static get type(){return"durationunit"}isEqual(e,t){return b.compareUnits(e,t)===0}}lg.initClass();lg._$name="DurationUnitDataField";class dg extends Pt{static get $name(){return"IntegerDataField"}static get type(){return"integer"}static get alias(){return"int"}static get prototypeProperties(){return{nullValue:0,rounding:"round"}}convert(e){return e==null?this.nullable?e:this.nullValue:Math[this.rounding](Number(e))}}dg.initClass();dg._$name="IntegerDataField";class cg extends Pt{static get $name(){return"ModelDataField"}static get type(){return"model"}static get prototypeProperties(){return{complexMapping:!0}}isEqual(e,t){return e&&t&&t instanceof e.constructor&&t.id==e.id}}cg.initClass();cg._$name="ModelDataField";class ug extends Pt{static get $name(){return"NumberDataField"}static get type(){return"number"}static get alias(){return"float"}static get prototypeProperties(){return{nullValue:0,precision:null}}isEqual(e,t){return isNaN(Number(e))&&isNaN(Number(t))||super.isEqual(e,t)}convert(e){if(e==null)return this.nullable?e:this.nullValue;if(e=Number(e),isNaN(e))return;let t=this.precision;return t?(t=10**t,e=Math.round(e*t)/t):t===0&&(e=Math.round(e)),e}}ug.initClass();ug._$name="NumberDataField";class hg extends Pt{static get $name(){return"ObjectDataField"}static get type(){return"object"}static get prototypeProperties(){return{complexMapping:!0}}}hg.initClass();hg._$name="ObjectDataField";class Ia extends Pt{init(e,t){var i;const r=this,n=`${r.name}Store`,s={skipStack:!0};if(r.modelClass&&(s.modelClass=r.modelClass),(i=t[`init${z.capitalize(n)}`])===null||i===void 0||i.call(t,s),!s.storeClass&&!r.storeClass)throw new Error(`Field '${r.name}' with type 'store' must have a storeClass configured`);const a=t.meta[n]=new(s.storeClass||r.storeClass)(s);r.complexMapping?T.setPath(e,r.dataSource,a):e[r.dataSource]=a,a.verifyNoGeneratedIds=!1,a.usesId=!a.count||!a.every(o=>o.hasGeneratedId),a.$currentValue=r.getValue(a),a.ion({change:({action:o})=>{const l=r.getValue(a);if(!a.$isSettingStoreFieldData){const d=a.$preserveCurrentDataset;a.$preserveCurrentDataset=r.subStore&&(o==="update"||o==="remove"||o==="add"),t.set(r.name,l),a.$preserveCurrentDataset=d}a.$currentValue=l}})}set(e,t,i){var r,n;const s=this,a=`${s.name}Store`,{[a]:o}=i.meta;if(!o)return i.meta.initableValues.set(s,e),!1;o.$isSettingStoreFieldData||(o.$isSettingStoreFieldData=!0,e=(r=(n=i[`process${z.capitalize(a)}Data`])===null||n===void 0?void 0:n.call(i,e,i))!==null&&r!==void 0?r:e,o.$preserveCurrentDataset||(o.data=e),o.$isSettingStoreFieldData=!1,o.usesId=!o.count||!o.every(l=>l.hasGeneratedId))}serialize(e,t){return t.meta[`${this.name}Store`].$currentValue}getValue(e){return e.allRecords.map(t=>{const i=t.persistableData;return e.usesId||delete i.id,i})}isEqual(e,t){var i,r;return(i=e)!==null&&i!==void 0&&i.isStore&&(e=e.$currentValue),(r=t)!==null&&r!==void 0&&r.isStore&&(t=t.$currentValue),T.isDeeplyEqual(e,t)}}M(Ia,"$name","StoreDataField");M(Ia,"type","store");Ia.initClass();Ia._$name="StoreDataField";const{defineProperty:Rb}=Reflect,{hasOwn:cn}=T,Qt=void 0,Tb={children:1,data:1,meta:1},Mb=["name","title","text","label","description"],kb={boolean:1,number:1,date:1,object:1};class de extends P.mixin(bb,wb,Db){static get $name(){return"Model"}static get declarable(){return["fields"]}static get fields(){return[{name:"parentIndex",type:"number",persist:!1,internal:!0},{name:"orderedParentIndex",type:"number",persist:!1,internal:!0},{name:"readOnly",type:"boolean"}]}static set idField(e){this._assignedIdField=!0,this._idField=e}static get idField(){return this._idField}static set childrenField(e){this._childrenField=e}static get childrenField(){if(!this._childrenField){const e=this.fieldMap.children;this._childrenField=e?.dataSource||"children"}return this._childrenField}get indexPath(){const e=[];let t=this,i=t.childLevel;for(t=this;t&&!t.isRoot;t=t.parent)e[i--]=t.parentIndex+1;return e}construct(e={},t=null,i=null,r=!1,n=!1,s=!1){var a,o;const l=this,d=(a=W.asArray(t))!==null&&a!==void 0?a:[],{constructor:u,fieldMap:h}=l;let f=null;if(t=d[0],l.meta=F(F({modified:{}},u.metaConfig),i),u.applyConfigs)for(const g in l.getDefaultConfiguration())f||(f={},(!l.useRawData||!l.useRawData.enabled)&&(e=F({},e))),g in e&&(e[g]!==void 0&&(f[g]=e[g]),delete e[g]);if(super.construct(f),r||u.exposeProperties(e,s),!cn(u,"idFieldProcessed")){let g=l.meta.idField;g||(u._assignedIdField?g=u.idField:t&&(g=t.idField)),g&&g!==h.id.dataSource&&u.addField({name:"id",dataSource:g,internal:!0}),u._idField=h.id.dataSource,u.idFieldProcessed=!0}l._internalId=de._internalIdCounter++,l.stores=[],l.unjoinedStores=[],l.originalData||(l.originalData=e),l.data=u.processData(e,!1,t,l,n),!((o=l.meta.initableValues)===null||o===void 0)&&o.size&&l.assignInitables(),l.id==null&&l.setData("id",l.generateId(t)),l.data[u.childrenField]&&l.processChildren(d),l.generation=0}set isCreating(e){const t=this;Boolean(t.meta.isCreating)!==e&&(t.meta.isCreating=e,t.stores.forEach(i=>{i.onIsCreatingToggle(t,e)}))}get isCreating(){return Boolean(this.meta.isCreating)}equals(e){if(e instanceof this.constructor){for(let t=this.$meta.fields.defs,i=0,{length:r}=t;i<r;i++){const n=t[i],{name:s}=n;if(s!=="id"&&!n.isEqual(this[s],e[s]))return!1}return!0}return!1}get subclass(){return new this.constructor(Object.setPrototypeOf({id:Qt},this.data),this.stores[0],null,!0)}static processData(e,t=!1,i,r,n){const{fieldMap:s,defaultValues:a}=this,{useRawData:o={enabled:!1}}=i||{},l=n||o.enabled?e:T.clone(e);let d;if(t=t||o.disableDefaultValue||n,!t){for(d in a)if(l[d]===Qt){let u=a[d];Array.isArray(u)&&(u=u.slice()),l[d]=u}}if(!o.disableTypeConversion&&!n)for(d in s){const u=s[d],{name:h,dataSource:f}=u,g=f!==h,m=u.complexMapping,p=g&&(m?T.pathExists(e,f):f in e),v=h in e&&(!g||!p),y=!o.disableTypeConversion&&u.convert;if((v||y)&&(!t||v||p)){const C=v?l[h]:m?T.getPath(l,f):l[f],D=y?u.convert(C,r):C;m?T.setPath(l,f,D):l[f]=D,g&&delete l[h]}}return this.$meta.fields.initable.length&&this.initInitables(r,l),l}static setupClass(e){super.setupClass(e),e.fields||this.setupFields(this,e)}static setupFields(e,t){var i,r,n,s,a;const o=cn(e,"fields")&&e.fields,l=t.super.fields,d=t.fields={defs:(i=l?.defs.slice())!==null&&i!==void 0?i:[],exposedData:!1,defaults:l?F({},l.defaults):{},exposed:Object.create((r=l?.exposed)!==null&&r!==void 0?r:null),ordinals:Object.create((n=l?.ordinals)!==null&&n!==void 0?n:null),map:Object.create((s=l?.map)!==null&&s!==void 0?s:null),sources:Object.create((a=l?.sources)!==null&&a!==void 0?a:null)};cn(e,"defaults")&&Object.assign(d.defaults,e.defaults),cn(e,"idField")&&(e.addField({name:"id",dataSource:e.idField,internal:!0}),d.exposed[e.idField]=!0),o!=null&&o.length&&o.map(e.addField,e),d.initable=d.defs.filter(u=>u.init),e.exposeRelations()}static get defaultValues(){return this.$meta.fields.defaults}static get allFields(){return this.$meta.fields.defs}get allFields(){return this.$meta.fields.defs}static get fieldMap(){return this.$meta.fields.map}get fieldMap(){return this.$meta.fields.map}static get fieldDataSourceMap(){return this.$meta.fields.sources}static exposeProperties(e,t=!0){const i=this,r=i.$meta.fields,n=t?"exposed":"map";if(e&&i.autoExposeFields&&!r.exposedData){let s,a,o;for(s in e)!r[n][s]&&s!==i.childrenField&&(o=T.typeOf(e[s]),a={name:s,dataSource:s,fromData:!0},kb[o]&&(a.type=o),i.addField(a));r.exposedData=!0}i.exposeRelations()}static addField(e){if(e==null)return;typeof e=="string"&&(e={name:e});const t=this.initClass(),i=t.$meta.fields,{ordinals:r}=i,n=i.exposed,{name:s}=e,a=i.map[s],o=e.dataSource||(e.dataSource=s);let l,d;if(!a||e.type&&e.type!==a.type)l=Pt.create(e),l.definedBy=a?a.definedBy:t,l.ordinal=a?a.ordinal:r[s]=i.defs.length;else{l=Object.create(a);for(d in e)d!=="type"&&(l[d]=e[d])}return l.owner=t,i.defs[l.ordinal]=l,i.map[s]=l,i.sources[o]||(i.sources[o]=l),o.includes(".")&&(l.complexMapping=!0),l.complexMapping?n[o.split(".")[0]]=!0:n[o]=!0,"defaultValue"in l&&(i.defaults[o]=l.defaultValue),Tb[s]||l.defineAccessor(t.prototype),t._nonPersistableFields=null,t._alwaysWriteFields=null,l}static removeField(e){const t=this.initClass(),i=t.$meta.fields,r=i.map[e],{ordinals:n}=i,s=n[e];if(r){i.defs.splice(s,1),delete n[e],delete i.defaults[e],delete i.exposed[e],delete i.map[e],delete i.sources[r.dataSource];for(const a in n)n[a]>s&&--n[a];delete t.prototype[e]}}static exposeRelations(){const e=this;if(!cn(e,"exposedRelations")&&e.relations){e.exposedRelations=[];for(const t in e.relations){const i=e.relations[t];i.relationName=t,e.exposedRelations.push(i),Reflect.ownKeys(e.prototype).includes(t)||Rb(e.prototype,t,{enumerable:!0,get:function(){return this.getForeign(t)},set:function(r){this.setForeign(t,r,i)}})}}}static initInitables(e,t){const i=e.meta.initableValues=new Map;for(const r of this.$meta.fields.initable){const n=T.getPath(t,r.dataSource);n!==void 0&&i.set(r,n),!r.lazy&&r.init(t,e)}}assignInitables(){const{initableValues:e}=this.meta;for(const[t,i]of e)t.set(i,this.data,this)!==!1&&e.delete(t)}static get autoExposeFields(){return!0}get fields(){return this.$meta.fields.defs}getFieldDefinition(e){return this.$meta.fields.map[e]}getFieldDefinitionFromDataSource(e){return this.$meta.fields.sources[e]}get fieldNames(){return Object.keys(this.data)}static getFieldDefinition(e){return this.$meta.fields.map[e]}static getFieldDataSource(e){return this.getFieldDefinition(e).dataSource}getDataSource(e){const t=this.constructor.getFieldDefinition(e);return t?.dataSource||t?.name}static processField(e,t,i){const r=this.fieldMap[e];return r!=null&&r.convert?r.convert(t,i):t}initRelations(){const e=this;!e.constructor.exposedRelations||e.stores.forEach(i=>{var r;i.modelRelations||i.initRelations();const n=[];(r=i.modelRelations)===null||r===void 0||r.forEach(s=>{n.push({related:e.initRelation(s),config:s})}),i.updateRecordRelationCache(e,n)})}initRelation(e){const t=this,i=t.get(e.foreignKey),r=i!==Qt&&typeof e.foreignStore!="string"&&e.foreignStore.getById(i),n=t.meta.relationCache||(t.meta.relationCache={});return n[e.relationName]=r||(i!=null?{id:i,placeHolder:!0}:null),r}removeRelation(e){const{relationName:t,foreignKey:i,nullFieldOnRemove:r}=e;this.meta.relationCache[t]&&(delete this.meta.relationCache[t],r&&this.setData(i,null))}getForeign(e){var t;return(t=this.meta.relationCache)===null||t===void 0?void 0:t[e]}setForeign(e,t,i){const r=de.asId(t);return this.set(i.foreignKey,r)}getRelationConfig(e){var t,i;return(t=this.firstStore)===null||t===void 0||(i=t.modelRelations)===null||i===void 0?void 0:i.find(r=>r.foreignKey===e)}flatGet(e,t){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:t in this.data?this.data[t]:this.data[e]}complexGet(e,t){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:T.getPath(this.data,t)}get(e){if(!e)return;const t=this.fieldMap[e];return!t&&e.includes(".")?this.complexGet(e,e):t!=null&&t.complexMapping?this.complexGet(e,t.dataSource):this.flatGet(e,t?.dataSource||e)}setData(e,t){const{data:i,fieldMap:r}=this;if(typeof e=="string"){var n;const a=r[e],o=(n=a?.dataSource)!==null&&n!==void 0?n:e;a!=null&&a.set?a.set(t,this.data,this):a!=null&&a.complexMapping?T.setPath(i,o,t):i[o]=t}else{const a=Object.keys(e);for(let o=0;o<a.length;o++){var s;const l=a[o],d=r[l],u=(s=d?.dataSource)!==null&&s!==void 0?s:l;d!=null&&d.set?d.set(t,this.data,this):u&&(d!=null&&d.complexMapping?T.setPath(i,u,e[l]):i[u]=e[l])}}}getData(e){var t;const i=this.fieldMap[e],r=(t=i?.dataSource)!==null&&t!==void 0?t:e;if(r)return i!=null&&i.complexMapping?T.getPath(this.data,r):this.data[r]}syncId(e){const t=this.id;if(t!==e){this.setData("id",e);const i={id:{value:e,oldValue:t}};this.afterChange(i,i)}}set(e,t,i=!1,r=!1,n=!1,s=!1){const a=this;if(a.isBatchUpdating)return a.inBatchSet(e,t,i||a.$silenceBatch),null;{var o,l;const d=(o=a.beforeSet)===null||o===void 0?void 0:o.call(a,e,t,i,r),u=a.inSet(e,t,i,r,n,s);return(l=a.afterSet)===null||l===void 0||l.call(a,e,t,i,r,d,u),u}}fieldToKeys(e,t){return typeof e!="string"?T.assign({},e):{[e]:t}}inBatchSet(e,t,i){const r=this,{meta:n,constructor:s,fieldMap:a}=r,o={};let l,d=!1;if(typeof e!="string"?Object.keys(r.fieldToKeys(e,t)).forEach(u=>{l=a[u]||T,t=s.processField(u,e[u],r),l.isEqual(n.batchChanges[u],t)||(o[u]={value:t,oldValue:r.get(u)},n.batchChanges[u]=t,d=!0)}):(l=a[e]||T,l.isEqual(n.batchChanges[e],t)||(o[e]={value:t,oldValue:r.get(e)},n.batchChanges[e]=t,d=!0)),d&&(r.generation++,!i)){const u={action:"update",record:r,records:[r],changes:o};r.stores.forEach(h=>{h.trigger("batchedUpdate",F({},u))}),r.forEachLinked((h,f)=>h.trigger("batchedUpdate",F(F({},u),{},{record:f,records:[f]})))}}inSet(e,t,i,r,n=!1,s=!1){const a=this,{data:o,meta:l,fieldMap:d,constructor:u}=a,{prototype:h,childrenField:f}=u,g={},m=a.fieldToKeys(e,t),p=Object.keys(m);let v=!1;if(!i&&!a.triggerBeforeUpdate(m))return null;a.inSetting=!0;for(let C=0;C<p.length;C++){var y;const D=p[C];if(D===f)continue;const w=d[D],E=w||T,R=w?.readOnly,x=(y=w?.dataSource)!==null&&y!==void 0?y:D,k=!n&&!w&&D in h,I=k?a[x]:w!=null&&w.complexMapping?T.getPath(o,x):o[x],A=u.processField(D,m[D],a),L=m[D]={value:A},O=a.getRelationConfig(D);!R&&!E.isEqual(I,A)&&(!s||A!==void 0)&&(a.generation++,L.oldValue=I,v=!0,E.isEqual(a.meta.modified[D],A)?Reflect.deleteProperty(l.modified,D):a.ignoreBag||(D in l.modified||a.storeFieldChange(D,I),L.oldValue===Qt&&Reflect.deleteProperty(L,"oldValue")),g[D]=L,a.applyValue(k,x,A,n,w),O&&!r&&(a.initRelation(O),a.stores.forEach(_=>_.cacheRelatedRecord(a,A,O.relationName,L.oldValue))))}return v&&a.afterChange(m,g,i,r,n),a.inSetting=!1,v?g:null}applyValue(e,t,i,r,n){var s,a;const o=this;let l=(s=n)===null||s===void 0?void 0:s.complexMapping;if(t===o.constructor.parentIdField){(o.firstStore.getById(i)||o.firstStore.rootNode).insertChild(o,null,!1,{orderedParentIndex:{skip:!0}});return}else if(e){var d;o[((d=n)===null||d===void 0?void 0:d.name)||t]=i;return}if((a=n)!==null&&a!==void 0&&a.set){n.set(i,o.data,o);return}if(!n&&t.includes(".")){var u,h;const f=t.split(".")[0];n=o.constructor.fieldMap[f],l=((u=n)===null||u===void 0?void 0:u.complexMapping)||((h=n)===null||h===void 0?void 0:h.type)==="object"}l?T.setPath(o.data,t,i):o.data[t]=i}afterChange(e,t,i,r,n){for(const s of this.stores)s.onModelChange(this,e,t,i,r,n);this.forEachLinked((s,a)=>s.onModelChange(a,e,t,i,r,n))}forEachLinked(e){for(const t of this.$links)for(const i of t.stores)e(i,t)}get isPersistable(){return!this.isBatchUpdating&&!this.isCreating}get isModified(){return Boolean(this.meta.modified&&Object.keys(this.meta.modified).length>0)}get hasPersistableChanges(){return this.isPersistable&&!T.isEmpty(this.rawModificationData)}isFieldModified(e){return this.isModified&&e in this.meta.modified}getFieldPersistentValue(e){const t=typeof e=="string"?this.getFieldDefinition(e):e,i=t?.name||e;let r;return(!t||t.persist)&&(r=this[i],t!=null&&t.serialize&&(r=t.serialize(r,this))),r}get modifications(){const e=this.rawModifications;return e&&Object.keys(e).length&&(e[this.constructor.idField]=this.id),e}get rawModifications(){const e=this,t={};if(!e.isModified)return null;let i=!1;return Object.keys(e.meta.modified).forEach(r=>{const n=e.getFieldPersistentValue(r);n!==Qt&&(t[r]=n,i=!0)}),i?t:null}get modificationData(){const e=this.rawModificationData;return e&&Object.keys(e).length&&T.setPath(e,this.constructor.idField,this.id),e}get rawModificationData(){const e=this,{fieldMap:t}=e.constructor,i={};if(!e.isModified)return null;let r=!1;return Object.keys(e.meta.modified).forEach(n=>{const s=t[n];if(s!=null&&s.persist){const a=e.getFieldPersistentValue(n);a!==Qt&&(T.setPath(i,s.dataSource,a),r=!0)}}),r?i:null}get modificationDataToWrite(){const e=this.constructor.alwaysWriteFields,t=this.modificationData;return e.forEach(i=>{t[this.getFieldDefinition(i).dataSource]=this.getFieldPersistentValue(i)}),t}get persistableData(){const e=this,t={};return e.fields.forEach(i=>{const r=e.getFieldPersistentValue(i);r!==Qt&&(i!=null&&i.complexMapping?T.setPath(t,i.dataSource,r):t[i.dataSource]=r)}),t}get isCommitting(){return Boolean(this.meta.committing)}clearChanges(e=!0,t=!0,i=null){const r=this,{meta:n}=r;if(i)for(const a in i)delete n.modified[a];else n.modified={};const s=T.isEmpty(n.modified);n.committing=!1,t&&r.stores.forEach(a=>{if(s&&a.modified.remove(r),a.added.remove(r),e){const o=a.collectDescendants(r).all;a.added.remove(o),s&&a.modified.remove(o)}})}storeFieldChange(e,t){this.meta.modified[e]=t}revertChanges(e=!1){this.set(this.meta.modified,Qt,e)}applyChangeset(e,t="$PhantomId",i=!0){const r=this,n=r.constructor,{idField:s,fieldDataSourceMap:a}=n,o=T.pathifyKeys(e),l=T.pathifyKeys(r.modificationData),d={},u=t in e;for(const g in o){var h;const m=a[g],p=(h=m?.name)!==null&&h!==void 0?h:g;(i||(m?.name===s?u:o[g]===l[g]))&&(d[p]=o[g])}const f=r.set(d);return r.clearChanges(!1,!0,i?null:d),f?Object.entries(f).reduce((g,[m,p])=>(g[m]=p.value,g),{}):{}}get internalId(){return this._internalId}get isPhantom(){return this.id===""||this.id==null||this.hasGeneratedId}get isModel(){return!0}get hasGeneratedId(){return typeof this.id=="string"&&this.id.startsWith("_generated")}static generateId(e=this.$$name){return`_generated${e}_${z.generateUUID()}`}generateId(){return this.constructor.generateId()}static asId(e){return e!=null&&e.isModel?e.id:T.isObject(e)?e[this.fieldMap.id.dataSource]:e}get json(){return z.safeJsonStringify(this)}toJSON(){const{children:e,unfilteredChildren:t}=this,i=this.persistableData;return(t||e)&&(i[this.constructor.childrenField]=(t||e).map(r=>r.toJSON())),i}toString(){const e=this,t=Mb.find(r=>r in e.constructor.fieldMap),i=t?{[e.constructor.idField]:e.id,[t]:e[t]}:e.data;return z.safeJsonStringify(i)}get isBatchUpdating(){return Boolean(this.batching)}hasBatchedChange(e){var t,i;return(t=this.meta)===null||t===void 0||(i=t.batchChanges)===null||i===void 0?void 0:i[e]}beginBatch(e=!1){const t=this;t.batching||(t.batching=0,t.meta.batchChanges={}),e&&(t.$silenceBatch=(t.$silenceBatch||0)+1),t.batching++}endBatch(e=!1,t=!1){const i=this,{parentIdField:r}=i.constructor;if(!!i.batching&&(i.batching--,i.$silenceBatch&&i.$silenceBatch--,!(i.batching>0)&&!T.isEmpty(i.meta.batchChanges))){const n=F({},i.meta.batchChanges);i.meta.batchChanges=null,n[r]&&(i.parentId=n[r],delete n[r]),i.set(n,Qt,e,!1,t)}}cancelBatch(){if(this.batching){const e=this,{batchChanges:t}=e.meta,i={};if(e.batching=null,e.meta.batchChanges=null,e.generation++,!e.$silenceBatch){Object.entries(t).forEach(([n,s])=>{i[n]={oldValue:s,value:e[n]}});const r={action:"update",record:e,records:[e],changes:i};e.stores.forEach(n=>{n.trigger("batchedUpdate",F({},r))}),e.forEachLinked((n,s)=>{n.trigger("batchedUpdate",F(F({},r),{},{record:s,records:[s]}))})}e.$silenceBatch&&e.$silenceBatch--}}triggerBeforeUpdate(e){var t;return!((t=this.stores)!==null&&t!==void 0&&t.some(i=>i.trigger("beforeUpdate",{record:this,changes:e})===!1))}copy(e=null,t){const i=this,r=T.clone(i.data),n=i.constructor.idField,s=T.isObject(t)?t.deep:t;let a;if(e&&typeof e=="object"?(a=e[n],Object.assign(r,e)):a=e,s&&i.children?r.children=i.children.map(l=>l.copy(void 0,t)):(delete r.children,delete r.expanded),i.$meta.fields.initable.length>0){const l=i.toJSON();for(const d of i.$meta.fields.initable)r[d.name]=l[d.name]}e!==!1&&(r[n]=a||i.generateId(i.firstStore));const o=new i.constructor(r,null,null,!1,!0);return o.originalInternalId=i.internalId,o}copyData(e){const t={};e.allFields.forEach(({name:i})=>{i!==e.constructor.idField&&(t[i]=e[i])}),this.set(t)}remove(e=!1){const t=this,{parent:i}=this;i?i.removeChild(t):t.stores.length&&!t.isSpecialRow&&t.stores.forEach(r=>r.remove(t,e,!1,!0))}beforeRemove(e,t){return super.beforeRemove(e,t)}get isValid(){return!0}get firstStore(){return this.stores.length>0&&this.stores[0]}joinStore(e){const t=this,{stores:i}=t;if(!i.includes(e)){const{unjoinedStores:r}=t;super.joinStore(e),e.register(t),i.push(e),r.includes(e)&&r.splice(r.indexOf(e),1),t.isLoaded&&t.children.forEach(n=>n.joinStore(e)),t.initRelations(),e.tree&&!t.isRoot&&(t.instanceMeta(e.id).collapsed=!t.expanded)}}unjoinStore(e,t=!1){const i=this,{stores:r,unjoinedStores:n}=i;if(r.includes(e)){var s,a,o;e.isDestroying||(e.unregister(i),n.push(e)),(s=i.unfilteredChildren||i.children)===null||s===void 0||(a=s.forEach)===null||a===void 0||a.call(s,l=>l.unjoinStore(e,t)),r.splice(r.indexOf(e),1),(o=super.unjoinStore)===null||o===void 0||o.call(this,e,t),e.uncacheRelatedRecord(i)}}isPartOfStore(e){return e?e.includes(this):this.stores.length>0}get isRemoved(){return!this.isPartOfStore()}instanceMeta(e){const{meta:t}=this,i=e.id||e;return t.map||(t.map={}),t.map[i]||(t.map[i]={})}get isGroupHeader(){return"groupRowFor"in this.meta}get isGroupFooter(){return"groupFooterFor"in this.meta}get isSpecialRow(){var e;return Boolean((e=this.meta)===null||e===void 0?void 0:e.specialRow)}get $original(){return this.isLinked?this.proxyMeta.originalRecord:this}static get nonPersistableFields(){const e=this;return e._nonPersistableFields||(e._nonPersistableFields={},e.allFields.forEach(t=>{(!t.persist||t.calculated)&&(e._nonPersistableFields[t.name]=1)})),e._nonPersistableFields}static get alwaysWriteFields(){const e=this;return e._alwaysWriteFields||(e._alwaysWriteFields=[],e.allFields.forEach(t=>{t.alwaysWrite&&e._alwaysWriteFields.push(t.name)})),e._alwaysWriteFields}get domId(){return typeof this.id=="string"?this.id.replace(/[ .]/g,"-"):this.id}static toJavaScriptValue(e){const{names:t}=this.$meta,i=t[t.length-2],r=t[t.length-3];return`class ${i} extends ${r} { static fields = ${z.toJavaScriptValue(this.fields,e)}; }`}getCurrentConfig(e){const{data:t,children:i}=this,{defaultValues:r,applyConfigs:n}=this.constructor,s=n?super.getCurrentConfig(e):{};if(s){for(const a of this.fields)if(a.persist){const o=T.getPath(t,a.dataSource);a.isEqual(o,r[a.name])||T.setPath(s,a.dataSource,P.processConfigValue(o,e))}if(i)if(Array.isArray(i)){s.children=[];for(const a of i)s.children.push(a.getCurrentConfig(e))}else s.children=i;this.hasGeneratedId&&delete s.id,delete s.parentId,delete s.parentIndex}return s}}M(de,"relations",null);de._idField="id";de._internalIdCounter=1;de._assignedIdField=!1;de.exposeProperties();de._$name="Model";class Ue{constructor(e,t){typeof e=="number"||e===null?(this._magnitude=e,this._unit=t):(typeof e=="string"&&Object.assign(this,b.parseDuration(e)),typeof e=="object"&&Object.assign(this,e))}get magnitude(){return this._magnitude}set magnitude(e){this._magnitude=typeof e=="number"&&e}get unit(){return this._unit}set unit(e){this._unit=b.parseTimeUnit(e)}get isValid(){return this._magnitude!=null&&Boolean(b.normalizeUnit(this._unit))}get milliseconds(){return this.isValid?Math.round(b.asMilliseconds(this._magnitude,this._unit)):0}isEqual(e){return Boolean(e)&&this._magnitude!=null&&e._magnitude!=null&&this.milliseconds===e.milliseconds}toString(e){const t=this,i=e?"getShortNameOfUnit":"getLocalizedNameOfUnit";return t.isValid?`${t._magnitude} ${b[i](t._unit,t._magnitude!==1)}`:""}toJSON(){return this.toString()}valueOf(){return this.milliseconds}}Ue._$name="Duration";const Ib=(c,e)=>c?.[e],Fb=/^is(this|next|last)(week|month|year)$/i,Ab=["isToday","isTomorrow","isYesterday","isThisWeek","isNextWeek","isLastWeek","isThisMonth","isNextMonth","isLastMonth","isThisYear","isNextYear","isLastYear","isYearToDate"];class Le extends P.mixin(jn){static get defaultConfig(){return{value:null,operator:null,filterBy:null,convert:null,caseSensitive:!0,id:null,type:null,internal:null,disabled:!1}}static get configurable(){return{property:null}}construct(e){typeof e=="function"&&(e={filterBy:e}),e.type?e.type==="date"&&e.value!=null&&!Array.isArray(e.value)?e.value=new Date(e.value):e.type==="duration"&&e.value!=null&&!Array.isArray(e.value)&&(e.value=new Ue(e.value)):b.isDate(e.value)||Array.isArray(e.value)&&e.value.every(b.isDate)?e.type="date":e.value instanceof Ue&&(e.type="duration"),super.construct(e)}get id(){return this._id||(this.internal?this._id=Le.generateId(`b-internal-${this.property}-filter-`):this._id=this.property||Le.generateId("b-filter-")),this._id}set id(e){this._id=e}onChange(e){var t;const i=this;!i.isConfiguring&&(t=i.owner)!==null&&t!==void 0&&t.onFilterChanged&&!i.owner.isConfiguring&&i.owner.onFilterChanged(i,e)}get filterBy(){return this._filterBy||this.defaultFilterBy}set filterBy(e){this._filterBy=e}defaultFilterBy(e){const t=this;let i;return t._propertyItems.length>1?i=t._propertyItems.reduce(Ib,e):i=e[t.property],t[t.operator](t.convert(i))}updateProperty(e){this._propertyItems=e.split("."),this.onChange("property")}set value(e){const t=this;t._value=e,Array.isArray(e)&&({date:1,duration:1}[t.type]||e.length>0&&typeof e[0]=="string")?t._filterValue=e.map(i=>t.convert(i)):!t.caseSensitive&&Array.isArray(e)&&e.length>0&&typeof e[0]=="string"?t._filterValue=e.map(i=>i?.toLowerCase()):!t.caseSensitive&&typeof e=="string"?t._filterValue=e.toLowerCase():t._filterValue=t.convert(e),t.onChange("value")}get value(){return this._value}get filterValue(){return this._filterValue}set operator(e){this._operator=e,this.onChange("operator")}get operator(){const e=this;return e._operator?e._operator:Array.isArray(e.filterValue)?"isIncludedIn":typeof e.filterValue=="string"?"*":"="}convert(e){if(this.operator!=="sameTime"&&!(typeof this.filterValue=="string"&&e instanceof Date)){var t,i;this.operator==="sameDay"&&(e=b.clearTime(e)),e=(t=(i=e)===null||i===void 0?void 0:i.valueOf())!==null&&t!==void 0?t:e}return e=!this.caseSensitive&&typeof e=="string"?e.toLowerCase():e,e}filter(e){return this.filterBy(e)}startsWith(e){return String(e).startsWith(this.filterValue)}endsWith(e){return String(e).endsWith(this.filterValue)}isIncludedIn(e){return this.filterValue.length===0||this.filterValue.includes(e)}isNotIncludedIn(e){return!this.isIncludedIn(e)}includes(e){return this.filterValue.length===0||String(e).includes(this.filterValue)}doesNotInclude(e){return!this.includes(e)}sameTime(e){return b.isSameTime(e,this.filterValue)}sameDay(e){return e===this.filterValue}"="(e){return T.isEqual(e,this.filterValue)}"!="(e){return!T.isEqual(e,this.filterValue)}">"(e){return T.isMoreThan(e,this.filterValue)}">="(e){return T.isMoreThan(e,this.filterValue)||T.isEqual(e,this.filterValue)}"<"(e){return T.isLessThan(e,this.filterValue)}"<="(e){return T.isLessThan(e,this.filterValue)||T.isEqual(e,this.filterValue)}"*"(e){return T.isPartial(e,this.filterValue)}between(e){const[t,i]=this._filterValue;return(T.isMoreThan(e,t)||T.isEqual(e,t))&&(T.isLessThan(e,i)||T.isEqual(e,i))}notBetween(e){return!this.between(e)}empty(e){return e==null||String(e).length===0}notEmpty(e){return!this.empty(e)}isToday(e){return this.between(e)}isTomorrow(e){return this.between(e)}isYesterday(e){return this.between(e)}isThisWeek(e){return this.between(e)}isNextWeek(e){return this.between(e)}isLastWeek(e){return this.between(e)}isThisMonth(e){return this.between(e)}isNextMonth(e){return this.between(e)}isLastMonth(e){return this.between(e)}isThisYear(e){return this.between(e)}isNextYear(e){return this.between(e)}isLastYear(e){return this.between(e)}isYearToDate(e){return this.between(e)}isTrue(e){return e===!0}isFalse(e){return e===!1}setRelativeDateValues(){this._filterValue=Le.getRelativeDateRange(this._operator).map(e=>e.valueOf())}static getRelativeDateRange(e,t=new Date){let i,r,n,s,a,o,l;switch(e){case"isYearToDate":return[b.floor(t,"1 year"),t];case"isToday":return i=b.floor(t,"1 day"),[i,b.add(i,1,"day")];case"isYesterday":return i=b.floor(t,"1 day"),[b.add(i,-1,"day"),i];case"isTomorrow":return r=b.getStartOfNextDay(t),[r,b.add(r,1,"day")];case"isThisWeek":case"isNextWeek":case"isLastWeek":case"isThisMonth":case"isNextMonth":case"isLastMonth":case"isThisYear":case"isNextYear":case"isLastYear":if(n=e.toLowerCase().match(Fb),!n)throw new Error(`Unrecognized relative date expression: ${e}`);return[,o,l]=n,s=`1 ${l}`,a=b.floor(t,s),o==="next"?a=b.add(a,1,l):o==="last"&&(a=b.add(a,-1,l)),[a,b.add(a,1,l)]}}static generateFiltersFunction(e){if(!e||!e.length&&!e.count)return ve.returnTrue;for(const t of e)t.type==="date"&&Ab.includes(t._operator)&&t.setRelativeDateValues();return function(t){let i=!0;for(const r of e)if(r.disabled||(i=r.filter(t)),!i)break;return i}}}M(Le,"$name","CollectionFilter");Le._$name="CollectionFilter";const uu=T.getPathDefault(globalThis,"bryntum.idCounts",Object.create(null));class Or{static generateId(e="generatedId"){return e+(uu[e]=(uu[e]||0)+1)}}Or._$name="IdHelper";class aa extends P{static get defaultConfig(){return{property:null,direction:"ASC",sortFn:null,convert:null,id:null,useLocaleSort:null}}construct(e){typeof e=="function"&&(e={sortFn:e}),super.construct(e)}get id(){return this._id||(this._id=this.property||Or.generateId("b-sorter"))}set id(e){this._id=e}set sortFn(e){this._sortFn=e}get sortFn(){return this._sortFn?this._sortFn:this.defaultSortFn}defaultSortFn(e,t){const i=this,{convert:r,property:n,useLocaleSort:s}=i,a=i.direction.toLowerCase()==="desc"?-1:1;if(e=e[n],t=t[n],r&&(e=r(e),t=r(t)),s&&e!=null&&t!=null&&typeof e=="string"){if(s===!0)return String(e).localeCompare(t);if(typeof s=="string")return String(e).localeCompare(t,s);if(typeof s=="object")return String(e).localeCompare(t,s.locale,s)}return(e>t?1:e<t?-1:0)*a}static generateSortFunction(e,t){const i=e.isCollection?e.values:e,r=i.length;return(n,s)=>{let a,o;for(o=0;o<r;++o)if(a=i[o].sortFn(n,s),a)return a;return t?t(n,s):0}}}aa._$name="CollectionSorter";let fg;const Lb=()=>0,Ob=(c,e)=>e-c,Ko=Symbol("filteredIndicesProperty"),wr=Object.freeze([]),Pb=Object.freeze({action:"sort",added:wr,removed:wr,replaced:wr}),$b=Object.freeze({action:"filter",added:wr,removed:wr,replaced:wr}),Oi={string:1,number:1};function gg(c,e,t){if(e.unique!==!1)e.set(t,c);else{let i=e.get(t);i||(i=new Set,e.set(t,i)),i.add(c)}}function _b(c,e,t){e.unique!==!1?e.delete(t):e.has(t)&&(e.get(t).delete(c),e.get(t).size||e.delete(t))}function hu(c,e,t,i){for(let r=0;r<c.length;r++){const n=c[r];for(let s=0;s<i;s++){const a=t[s],o=n[a],l=e[a];gg(n,l,o)}}}fg=Symbol.iterator;class rt extends P.mixin(Ie){constructor(...e){super(...e),M(this,"_sortFunction",null),M(this,"_addedValues",null)}static get configurable(){return{idProperty:"id",extraKeys:null,autoFilter:!0,autoSort:!0,sorters:{$config:["lazy"],value:[]}}}get isCollection(){return!0}construct(e){this.generation=0,this._values=[],super.construct(e)}doDestroy(){var e;super.doDestroy();const t=this;t._values.length=0,t.isFiltered&&(t._filteredValues.length=0,t.filters.destroy()),(e=t._sorters)===null||e===void 0||e.destroy()}clear(){const e=this,t=e._values.slice();e.totalCount&&(e._values.length=0,e._filteredValues&&(e._filteredValues.length=0),e._indicesInvalid=!0,e.generation++,e.trigger("change",{action:"clear",removed:t}))}equals(e,t){if(e.isCollection&&(e=e.values),e.length===this.count){let{values:i}=this;return t&&(e=e.map(t),i=i.map(t)),W.delta(e,i).inBoth.length===this.count}return!1}replaceValues({values:e,filteredValues:t,silent:i=!1,isNewDataset:r=!1}){const n=this;let s,a;n.isFiltered&&!r?(Boolean(t)?e&&(s=n._values,n._values=e.slice()):(t=e.slice(),e=null),a=n._filteredValues,n._filteredValues=t.slice()):(s=n._values,n._values=e.slice(),t=null,n.isFiltered&&r&&n.autoFilter?(n._filterFunction=null,n._filteredValues=n._values.filter(n.filterFunction)):n._filteredValues&&(n._filteredValues.length=0)),n._indicesInvalid=!0,n._addedValues=void 0,n.generation++,i||n.trigger("change",{action:"replaceValues",replacedValues:s,replacedFilteredValues:a,values:e,filteredValues:t})}set values(e){this.invalidateIndices(),this.splice(0,this._values.length,e)}get values(){return this.isFiltered?this._filteredValues:this._values}get filteredValues(){return this._filteredValues}[fg](){return this.values[Symbol.iterator]()}forEach(e,t=!1){(this.isFiltered&&!t?this._filteredValues:this._values).forEach(e)}map(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).map(e)}find(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).find(e)}get first(){return this.values[0]}get last(){return this.values[this.count-1]}get allValues(){return this._values}get addedValues(){return this._addedValues}match(e,t=!0){const i=this,{_values:r}=i,n=[];return i.forEach(s=>{const a=e.get(s.id,!0);if(a){const o=i.indexOf(s,!0),l=r[o];r[o]=a,i.removeFromIndices(l),i.addToIndices(a)}else t&&n.push(s)}),n.length&&i.remove(n),i.isFiltered&&(i._filteredValues=i._values.filter(i.filterFunction)),n}add(...e){e.length===1?this.splice(this._values.length,null,...e):this.splice(this._values.length,null,e)}remove(...e){e.length===1?this.splice(0,...e):this.splice(0,e)}move(e,t){for(e=W.asArray(e);e.length&&e[0]===t;)e.shift();if(!e.length)return;const i=this,{_values:r}=i,n=i.indexOf(e[0],!0);if(e.length===1&&r[n+1]===t)return;i.suspendEvents(),i.remove(e),i.resumeEvents();const s=t?i.indexOf(t,!0):r.length;if(s===-1)throw new Error("Collection move beforeItem parameter must be present in Collection");return r.splice(s,0,...e),i._indicesInvalid=1,i.trigger("change",{action:"move",items:e,from:n,to:s}),s}splice(e=0,t,...i){const r=this,n=r.idProperty,s=r._values,a={},o=[],l=[],d=r.totalCount;let u,h;if(r.trigger("beforeSplice",{index:e,toRemove:t,toAdd:i})!==!1){if(i)if(i.length===1&&Array.isArray(i[0])&&(i=i[0]),d&&i.length){const f=r.indices[n];u=[];for(let g=0;g<i.length;g++){const m=i[g],p=m[n],v=f.get(p),y=v?s.indexOf(v):-1;a[p]=!0,y!==-1?s[y]!==m&&(l.push([s[y],m]),s[y]=m):u.push(m)}}else u=i;if(t){if(typeof t=="number"){t=Math.min(t,s.length-e);for(let f=e;t;--t){const g=s[f][n];a[g]?(e++,f++):(o.push(s[f]),s.splice(f,1),h=!0)}}else{let f=u.length===0,g;t=W.asArray(t);const m=t.reduce((p,v)=>{const y=typeof v=="number",C=y?v:r.indexOf(v,!0);return f&&(g!=null&&C!==g+1||y)&&(f=!1),C>=0&&C<d&&p.push(C),g=C,p},[]).sort(Ob);if(f)m.length&&(o.push.apply(o,t),s.splice(m[m.length-1],m.length),h=!0);else for(let p=0;p<m.length;p++){const v=m[p];if(v!==-1){const y=s[v][n];a[y]||(o.unshift(s[v]),s.splice(v,1),h=!0)}}}o.length&&!r._indicesInvalid&&o.forEach(r.removeFromIndices,r)}if(u.length){s.splice(Math.min(e,s.length),0,...u),h=!0,r._indicesInvalid||u.forEach(r.addToIndices,r),r._addedValues||(r._addedValues=new Set);for(const f of u)r._addedValues.add(f)}if(o.length&&r._addedValues)for(const f of o)r._addedValues.delete(f);l.length&&!r._indicesInvalid&&l.forEach(f=>{r.removeFromIndices(f[0]),r.addToIndices(f[1])}),h||l.length?(r.isSorted?r.onSortersChanged():r.isFiltered&&(r.autoFilter?r.onFiltersChanged({action:"splice",oldCount:1}):r._filteredValues.splice(Math.min(e,r._filteredValues.length),0,...u)),r.generation++,r.trigger("change",{action:"splice",removed:o,added:u,replaced:l,oldCount:d})):r.trigger("noChange",{index:e,toRemove:t,toAdd:i})}}changeId(e,t){const i=this,{idProperty:r}=i,n=Oi[typeof e]?e:e[r],s=i.get(n);if(s){const a=i.get(t);if(a&&s!==a)throw new Error(`Attempt to set item ${n} to already existing member's id ${t}`);i.removeIndexEntry(e,r,n),i.addIndexEntry(e,r,t),s[r]=t}}get(e,t=!1){return this.getBy(this.idProperty,e,t)}getAt(e,t=!1){return this.isFiltered&&!t?this._filteredValues[e]:this._values[e]}getBy(e,t,i=!1){return this.findItem(e,t,this.isFiltered&&i)}get count(){return this.values.length}get totalCount(){return this._values.length}updateIdProperty(e){this.addIndex({property:e,unique:!0})}changeSorters(e){return new rt({values:W.asArray(e),internalListeners:{change:"onSortersChanged",thisObj:this}})}addSorter(e){const t=e instanceof aa?e:new aa(e);return this.sorters.add(t),t}get isSorted(){var e;return Boolean((e=this._sorters)===null||e===void 0?void 0:e.count)}onSortersChanged(){const e=this;e._sortFunction=null,e._addedValues=null,e._values.sort(e.sortFunction),e.trigger("change",Pb)}get sortFunction(){return this._sortFunction||(this.isSorted?this._sortFunction=aa.generateSortFunction(this.sorters.values):this._sortFunction=Lb),this._sortFunction}get filters(){return this._filters||(this._filters=new rt({internalListeners:{change:"onFiltersChanged",thisObj:this}})),this._filters}addFilter(e){const t=e instanceof Le?e:new Le(e);return this.filters.add(t),t}removeFilter(e){const{filters:t}=this;e.isCollectionFilter||(e=t.get(e)),t.remove(e)}clearFilters(){this.filters.clear()}get isFiltered(){return Boolean(this._filters&&this._filters.count)}onFiltersChanged({action:e,removed:t,oldCount:i}){const r=this,n=i||e==="clear"&&t.length?r._filteredValues:r._values;r._filterFunction=null,r._filteredValues=r._values.filter(r.filterFunction),r._indicesInvalid=!0;const{toAdd:s,toRemove:a}=W.delta(r._filteredValues,n,!0);r.trigger("change",F(F({},$b),{},{added:s,removed:a}))}get filterFunction(){return this._filterFunction||(this.isFiltered?this._filterFunction=Le.generateFiltersFunction(this.filters.values):this._filterFunction=ve.returnTrue),this._filterFunction}changeExtraKeys(e){return W.asArray(e).map(i=>typeof i=="string"?{property:i,unique:!0}:i)}updateExtraKeys(e){for(let t=0;t<e.length;t++)this.addIndex(e[t])}addIndex(e){const t=this;e&&((t._indices||(t._indices={}))[e.property]=new Map,Object.assign(t._indices[e.property],e),t.invalidateIndices(),e.dependentOn&&(t.hasCompositeIndex=!0))}findIndex(e,t,i=!1){const r=this.findItem(e,t,i);return r?(this.isFiltered&&!i?this._filteredValues:this._values).indexOf(r):-1}findItem(e,t,i=!1){const r=this,{isFiltered:n}=r,s=n&&!i?r.indices[Ko][e]:r.indices[e];if(s){var a;const o=(a=s.get(t))!==null&&a!==void 0?a:typeof t=="string"&&t.length&&!isNaN(t)&&s.get(Number(t))||null;if(o!=null)return o}else{const o=n&&!i?r._filteredValues:r._values,l=o.length;for(let d=0;d<l;d++){const u=o[d];if(u[e]==t)return u}}return null}removeIndex(e){delete this._indices[e],this.hasCompositeIndex=Object.values(this.indices).some(t=>t.dependentOn)}indexOf(e,t=!1){return this.findIndex(this.idProperty,Oi[typeof e]?e:e[this.idProperty],t)}includes(e,t=!1){return Array.isArray(e)?e.some(i=>this.includes(i)):Boolean(this.findItem(this.idProperty,Oi[typeof e]?e:e[this.idProperty],t))}get indices(){return this._indicesInvalid&&this.rebuildIndices(),this._indices}invalidateIndices(){this._indicesInvalid=!0}rebuildIndices(){const e=this,t=e.isFiltered,i=e._indices||(e._indices={}),r=Object.keys(i),n=r.length,s=e._values;let a;t&&(a=i[Ko]={});for(let o=0;o<n;o++){const l=i[r[o]];if(l.clear(),t){let d=a[r[o]];d?d.clear():(d=a[r[o]]=new Map,d.unique=l.unique)}}hu(s,i,r,n),t&&hu(e._filteredValues,a,r,n),e._indicesInvalid=!1}getIndices(e){const t=[this.indices[e]];return this.isFiltered&&t.push(this.indices[Ko][e]),t}addToIndices(e){Object.keys(this.indices).forEach(t=>{this.addIndexEntry(e,t,e[t])})}removeFromIndices(e){Object.keys(this.indices).forEach(t=>{this.removeIndexEntry(e,t,e[t])})}removeIndexEntry(e,t,i){this.getIndices(t).forEach(r=>_b(e,r,i))}addIndexEntry(e,t,i){this.getIndices(t).forEach(r=>gg(e,r,i))}onItemMutation(e,t){const i=this;!i._indicesInvalid&&Object.keys(i.indices).length>1&&Object.keys(t).forEach(r=>{if(i.indices[r]){const{value:a,oldValue:o}=t[r];i.removeIndexEntry(e,r,o),i.addIndexEntry(e,r,a)}else if(i.hasCompositeIndex){const a=Object.values(i.indices).find(o=>{var l;return(l=o.dependentOn)===null||l===void 0?void 0:l[r]});if(a){const o={};for(const d in a.dependentOn){var s;o[d]=((s=t[d])===null||s===void 0?void 0:s.oldValue)||e[d]}const l=e.buildIndexKey(o);i.removeIndexEntry(e,a.property,l),i.addIndexEntry(e,a.property,e[a.property])}}})}}rt._$name="Collection";const fu=new WeakMap,un=c=>{if(c&&typeof c=="object"){let e=fu.get(c);e===void 0&&(e=Symbol("bscik"),fu.set(c,e)),c=e}return c};class Fn{constructor(e){const t=this;t.generation=0,t.items=new Set,t.idMap={},t.idProperty="id",e&&(e.idProperty&&(t.idProperty=e.idProperty),e.values&&(t.values=e.values))}get(e){return this.idMap[un(e)]}get count(){return this.items.size}add(...e){e.length===1&&Array.isArray(e[0])&&(e=e[0]);const t=this,{items:i,idMap:r,idProperty:n}=t,s=e.length;for(let a=0;a<s;a++){const o=e[a],l=Oi[typeof o]?o:un(o[n]),d=r[l];d==null?(r[l]=o,i.add(o),t.generation++):d!==o&&(r[l]=o,i.delete(d),i.add(o))}}at(e){let t,i;e<0&&(e+=this.count);for(t of this.items)if(!e--){i=t;break}return i}remove(e){e=W.asArray(e);const{items:t,idMap:i,idProperty:r}=this,n=e.length;for(let s=0;s<n;s++){const a=e[s],o=Oi[typeof a]?a:un(a[r]),l=i[o];l!=null&&(t.delete(l),delete i[o],this.generation++)}}clear(){this.items.clear(),this.idMap={},this.generation++}countOf(e){let t=0,i;for(i of this.items)e(i)&&++t;return t}changeId(e,t){const i=this,{idMap:r,idProperty:n}=i,s=Oi[typeof e]?e:un(e[n]),a=i.get(s);if(a){const o=i.get(t);if(o&&a!==o)throw new Error(`Attempt to set item ${s} to already existing member's id ${t}`);a[n]=t,delete r[s],r[t]=a}}filter(e,t){const{items:i}=this,r=[];let n=0;return i.forEach(s=>{e.call(t,s,n++,i)&&r.push(s)}),r}includes(e){const t=Oi[typeof e]?e:un(e[this.idProperty]);return Boolean(this.idMap[t])}map(e,t){const{items:i}=this,r=new Array(i.size);let n=0;return i.forEach(s=>{r[n]=e.call(t,s,n++,i)}),r}forEach(e,t){return this.items.forEach(e,t)}find(e,t=0){let i,r;t<0&&(t+=this.countOf(e));for(i of this.items)if(e(i)&&!t--){r=i;break}return r}[Symbol.iterator](){return this.items[Symbol.iterator]()}indexOf(e,t){let i=-1,r;for(r of this.items)if((!t||t(r))&&(++i,r===e))return i;return-1}get values(){return[...this.items]}set values(e){e=W.asArray(e),this.clear(),this.add.apply(this,e),this.generation++}sort(e){this.values=this.values.sort(e)}some(e,t){return this.values.some(e,t)}}Fn._$name="Bag";class oa extends Fn{add(...e){return e.length===1&&Array.isArray(e[0])&&(e=e[0]),super.add(...e.filter(t=>t.isPersistable))}}oa._$name="StoreBag";var Hb=c=>class extends(c||P){static get $name(){return"StoreCRUD"}static get defaultConfig(){return{autoCommit:!1}}static get properties(){return{isRemoving:!1,suspendCount:0}}remove(t,i=!1){const r=this,{storage:n}=r;if(t=W.asArray(t).reduce((s,a)=>(a=r.getById(a),a&&s.push(a),s),[]),t.length===0)return t;if(r.isRemoving=!0,r.isGrouped){const s=n.count,a=[],o=new Set;for(const l of t){const{groupParent:d}=l.instanceMeta(r);d.meta.collapsed&&a.push(l),W.remove(d.groupChildren,l),d.meta.childCount--,o.add(d)}for(const l of o)l.groupChildren.length>0&&r.onModelChange(l,{},{});a.length&&n.trigger("change",{action:"splice",removed:a,added:[],replaced:[],oldCount:s})}else if(r.tree){const s=[],a=t.length>1,o=t[0],l=a?void 0:n.indexOf(o),d=t.reduce((u,h)=>{const{parent:f}=h;return f&&(u[f.id]||(u[f.id]=[f,[]]),u[f.id][1].push(h)),u},{});if(!i&&r.trigger("beforeRemove",{records:t,isMove:!1,parent:a?void 0:o.parent})===!1)return r.isRemoving=!1,[];for(const u of Object.values(d)){const h=u[0],f=u[1];s.push(...h.removeChild(f,!1,!0))}return i||(r.trigger("remove",{parent:a?void 0:o.parent,index:l,isChild:!0,allRecords:s,isMove:!1,records:t}),r.trigger("change",{action:"remove",records:t}),r.isRemoving=!1),t}for(const s of t)s.beforeRemove(t);return t.length===0?t:!i&&r.trigger("beforeRemove",{records:t})===!1?(r.isRemoving=!1,[]):(i&&r.suspendEvents(),n.remove(t),i&&r.resumeEvents(),r.autoCommit&&r.doAutoCommit(),r.isRemoving=!1,t)}clear(t=!1){var i,r;const n=this,{storage:s}=n;if(n.storage.totalCount||(i=n.rootNode)!==null&&i!==void 0&&(r=i.unfilteredChildren)!==null&&r!==void 0&&r.length){if(!t&&n.trigger("beforeRemove",{records:s.allValues,removingAll:!0})===!1)return null;if(n.rootNode)n.isChained||n.rootNode.clearChildren(t);else if(t){const a=n.registeredRecords;for(let o=a.length-1,l;o>=0;o--)l=a[o],l&&!l.isDestroyed&&l.unjoinStore(n)}t&&(n.removed.clear(),s.suspendEvents()),s.clear(),t&&s.resumeEvents(),n.added.clear(),n.modified.clear()}}removeAll(t=!1){const i=this,r=i.storage;let n;if(i.isRemoving=!0,t){r.suspendEvents();const s=i.registeredRecords;for(let a=s.length-1,o;a>=0;a--)o=s[a],o&&!o.isDestroyed&&!o.isRoot&&o.unjoinStore(i)}return i.tree?n=i.rootNode.clear()!==!1:n=i.clear()!==null,t&&r.resumeEvents(),i.isRemoving=!1,n}add(t,i=!1,r={}){var n;const s=this,{storage:a}=s;if(t=W.asArray(t),!((n=t)!==null&&n!==void 0&&n.length))return;if(s.tree=s.tree||Boolean(s.autoTree&&t[0].children),s.tree){const l=new Map,d=s.modelClass.getFieldDataSource("parentIndex"),{parentIdField:u}=s.modelClass,h=[];return t.forEach(f=>{const g=f[u];l.has(g)||l.set(g,{append:[],insert:[]});const m=l.get(g);!f.isModel&&d in f?m.insert.push(f):m.append.push(f)}),l.forEach(({append:f,insert:g},m)=>{const p=m==null?s.rootNode:s.getById(m);if(!p)throw new Error(`Parent node with id ${m} not found, cannot add children.`);if(f.length&&h.push(...p.appendChild(f,i)),g.length)for(const v of g)h.push(p.insertChild(v,v[d],i,r))}),s.reapplySortersOnAdd&&s.sort(),h}if(!i&&s.trigger("beforeAdd",{records:t})===!1)return null;if(s.tree=s.tree||Boolean(s.autoTree&&t[0].children),s.tree)return s.rootNode.appendChild(t);const o=s.processRecords(t);return i&&s.suspendEvents(),a.add(o),i&&s.resumeEvents(),s.autoCommit&&s.doAutoCommit(),o}processRecords(t,i){return t.map(r=>{const n=this.processRecord(r.isModel?r:this.createRecord(r));return i?.call(this,n),n})}insert(t,i,r=!1){const n=this,s=n.storage,a=n.getAt(t),o=s.values,l=[];if(i=W.asArray(i),!r&&n.trigger("beforeAdd",{records:i})===!1)return null;let d,u,h;if(o[u=t]===i[0]||o[u=t-1]===i[0])for(d=!0,h=0;d&&h<i.length;h++)i[h]!==o[u+h]&&(d=!1);if(d)return null;const f=n.processRecords(i,m=>{const p=s.indexOf(m);m.children&&m.children.length&&n.autoTree&&(n.tree=!0),p>-1&&(p<t&&a&&t--,l.push(p)),m.meta.previousIndex=p});if(n.tree){var g;const m=n.rootNode;return m.insertChild(i,(g=m.children)===null||g===void 0?void 0:g[t],r)}return n.suspendEvents(),n.storage.remove(l),n.resumeEvents(),r&&n.suspendEvents(),s.splice(t,0,...f),r&&n.resumeEvents(),n.autoCommit&&n.doAutoCommit(),f}move(t,i){this.isTree?i.parent.insertChild(t,i):this.storage.move(t,i)}setMultiple(t,i,r){const n=this,s=[],a=[];n.forEach(o=>{t(o)&&(a.push(o.set(i,r,!0)),s.push(o))}),n.trigger("updateMultiple",{records:s,all:n.records.length===s.length}),n.trigger("change",{action:"updatemultiple",records:s,all:n.records.length===s.length}),n.reapplyFilterOnUpdate&&n.isFiltered&&n.filter()}setAll(t,i){const r=this,n=[];r.forEach(s=>{n.push(s.set(t,i,!0))}),r.trigger("updateMultiple",{records:r.records,all:!0}),r.trigger("change",{action:"updatemultiple",records:r.records,all:!0}),r.reapplyFilterOnUpdate&&r.isFiltered&&r.filter()}acceptChanges(){const t=this;t.added.forEach(i=>i.clearChanges(!0,!1)),t.modified.forEach(i=>i.clearChanges(!0,!1)),t.added.clear(),t.modified.clear(),t.removed.clear()}commit(t=!1){const{changes:i}=this;return!t&&this.trigger("beforeCommit",{changes:i})===!1?!1:(this.acceptChanges(),t||this.trigger("commit",{changes:i}),i)}revertChanges(){const t=this,{changes:i}=t;if(i){const r={action:"clearchanges",changes:i};t.add(t.removed.values,!0),t.remove(t.added.values,!0),t.modified.forEach(n=>n.revertChanges(!0)),t.added.clear(),t.modified.clear(),t.removed.clear(),t.trigger("change",r),t.trigger("refresh",r)}}get changes(){const t=this,i=t.modified.values.filter(r=>r.rawModifications);return t.added.count||i.length||t.removed.count?{added:t.added.values.slice(),modified:i,removed:t.removed.values.slice()}:null}get autoCommit(){return this._autoCommit}set autoCommit(t){this._autoCommit=t,t&&this.changes&&this.commit()}suspendAutoCommit(){this.suspendCount++}resumeAutoCommit(t=!0){this.suspendCount--,this.autoCommit&&t&&this.doAutoCommit()}doAutoCommit(){this.suspendCount<=0&&this.commit()}},Nb=c=>class extends(c||P){static get $name(){return"StoreChanges"}static get configurable(){return{applyChangesetFilterSortTarget:"changes"}}applyChangesFromStore(t){const i=this,{changes:r}=t;!r||(r.added&&i.add(r.added),r.removed&&i.remove(r.removed.map(n=>n.id)),r.modified&&r.modified.forEach(n=>{i.getById(n.id).set(n.modifications)}))}applyChangeset(t,i=null,r="$PhantomId",n=!0,s=!1){var a,o;const l=this,{added:d,updated:u,modified:h,removed:f}=(a=i?.(t,l))!==null&&a!==void 0?a:t,g=(o=u??h)!==null&&o!==void 0?o:[],m=l.modelClass.getFieldDataSource("id"),p=s?new Map:null,v=[],y=[];let C=!1,D=[];if(d?.length>0){var w;const R=[],x=[];for(const I of d){var E;l.getById((E=I[r])!==null&&E!==void 0?E:T.getPath(I,m))?R.push(I):x.push(I)}g.unshift.apply(g,R);const k=(w=l.add(x,!1,{orderedParentIndex:{skip:!0}}))!==null&&w!==void 0?w:[];if(v.push(...k),l.tree)for(const I of k){const{parent:A}=I;if(A.isRoot){C=!0,D=[A];break}!A.isRoot&&D.every(L=>!L.contains(A))&&D.push(A)}for(const I of k)p?.set(I.id,I.data),I.clearChanges()}if(g?.length>0)for(const R of g){const x=R[r],k=T.getPath(R,m),I=l.getById(x??k);if(I){const A=I.applyChangeset(R,r,n);l.tree&&!C&&D.every(L=>!L.contains(I))&&(I.parent.isRoot?(C=!0,D=[I.parent]):D.push(I.parent)),p?.set(k,A),y.push(I)}}return f?.length>0&&l.applyRemovals(f),l.afterChangesetApplied(D),l.applyChangesetFilterSortTarget==="changes"&&l.filterChangeset(v,y,l.isSorted?l.createSorterFn(l.sorters):void 0),p}afterChangesetApplied(t){t.forEach(i=>{i.traverse(r=>{r.sortOrderedChildren(!1,!1),r.children&&r.updateChildrenIndices(r.children,"parentIndex",!0),r.unfilteredChildren&&r.updateChildrenIndices(r.unfilteredChildren,"unfilteredIndex",!0)})})}applyRemovals(t){const i=this,{removed:r}=i,n=i.modelClass.idField,s=[];for(const a of t){const o=T.getPath(a,n);r.includes(o)?r.remove(o):s.push(o)}i.remove(s);for(const a of s)r.remove(a)}filterChangeset(t,i,r){const n=this,{isFiltered:s,isGrouped:a,tree:o}=n,{allValues:l,addedValues:d,isSorted:u,filterFunction:h}=n.storage,f=r!=null||u?r??n.storage.sortFunction:null;if(o||!s)return!1;let g=!1,m=!1,p;a&&(p=n.groupers,n.clearGroupers(!0));const{filteredValues:v}=n.storage;if(f){const C=d?v.findLastIndex(E=>!d.has(E))+1:v.length,D=v.slice(0,C),w=new Set(i.filter(h));for(const E of v)w.has(E)&&w.delete(E);for(const E of w)D.push(E);D.sort(f),v.splice(0,C,...D),m=!0}else{const C=new Set(i.filter(R=>h(R)&&!n.storage.includes(R)));let D=0,w=0,E=C.size===0;for(;w<l.length&&!E;){const R=v[D];let x=l[w];for(;R!==x;)C.has(x)&&(v.splice(D,0,x),m=g=!0,D++,C.delete(x),E=C.size===0),x=l[++w];D<v.length&&D++}}const y=new Set(t.filter(C=>!h(C)));for(let C=v.length-1;C>=0;C--){const D=v[C];y.has(D)&&(v.splice(C,1),m=g=!0,y.delete(D))}return p&&(n.group(p[0],null,!1,!0,!0),m=!0),m&&(n._idMap=null,n.trigger("refresh")),g}},Bb=c=>class extends(c||P){static get $name(){return"StoreFilter"}static get defaultConfig(){return{filters:null,reapplyFilterOnAdd:!1,reapplyFilterOnUpdate:!1}}set reapplyFilterOnAdd(t){this.storage.autoFilter=t}get reapplyFilterOnAdd(){return this.storage.autoFilter}set filters(t){const i=this,r=i.filters;if(r.clear(),i._filtersFunction=null,t){if(t.constructor.name==="Object")for(const n of Object.entries(t))n[0]==="filterBy"&&typeof n[1]=="function"?r.add(new Le({filterBy:n[1]})):r.add(new Le(n[1].constructor.name==="Object"?Object.assign({property:n[0]},n[1]):{property:n[0],value:n[1]}));else Array.isArray(t)?r.add(...t.map(n=>n instanceof Le?n:new Le(n))):t.isCollection?r.add(...t.values):r.add(new Le({filterBy:t}));r.forEach(n=>n.owner=i)}}get filters(){return this._filters||(this._filters=new rt({extraKeys:["property"]}))}set filtersFunction(t){this._filtersFunction=t}get filtersFunction(){const t=this,{filters:i,isGrouped:r}=t;if(!t._filtersFunction)if(i.count){const n=Le.generateFiltersFunction(i);t._filtersFunction=s=>r&&s.isSpecialRow?s.groupChildren.some(n):n(s)}else t._filtersFunction=ve.returnTrue;return t._filtersFunction}get isFiltered(){return this.filters.values.some(t=>!t.disabled)}traverseFilter(t){const i=this,r=!t.isRoot&&i.filtersFunction(t),n=t.unfilteredChildren||t.children;return!n||!n.length?r:(t.unfilteredChildren||(t.unfilteredChildren=t.children.slice()),t.children=t.unfilteredChildren.filter(s=>i.traverseFilter(s)),t.updateChildrenIndices(t.unfilteredChildren,"unfilteredIndex",!0),t.updateChildrenIndices(t.children,"parentIndex",!0),r||Boolean(t.children.length))}traverseClearFilter(t){const i=this;t.unfilteredChildren&&(t.children=t.unfilteredChildren.slice(),t.unfilteredChildren=null),t.children&&(t.children.forEach(r=>i.traverseClearFilter(r)),t.updateChildrenIndices(t.children,"parentIndex",!0))}get latestFilterField(){return this.filters.last?this.filters.last.property:null}addFilter(t,i=!1){const r=this;if(t=t instanceof Le?t:new Le(t),t.owner=r,r.filters.add(t),!i){if(r.remoteFilter)return r.filter().then(()=>t);r.filter()}return t}filter(t){const i=this;let r=!1,n;if(t){let s=typeof t;if(s==="object"&&("silent"in t||"replace"in t||t.filters)&&(r=t.silent,t.replace&&i.clearFilters(t.filters.length===0),n=t.internal,t=t.filters,s=typeof t),t){const a=i.isFiltered;if(i.isConfiguring=!0,Array.isArray(t))t.forEach(o=>i.addFilter(o,!0),i);else if(s==="function"){const o=new Le(t);o.internal=n,i.addFilter(o,!0)}else s==="string"?i.addFilter({property:t,value:arguments[1]},!0):i.addFilter(t,!0);if(i.isConfiguring=!1,!i.isFiltered&&!a)return null}}return i.filtersFunction=null,i.performFilter(r)}performFilter(t){const i=this,{storage:r,filters:n,rootNode:s}=i,a=i.count;i.trigger("beforeFilter",{filters:n});let o,l;if(i.tree){const d=r.values;i.isFiltered?i.traverseFilter(s):i.traverseClearFilter(s);const u=i.collectDescendants(s).visible;r.replaceValues({values:u,silent:!0});const h=W.delta(u,d,!0);o=h.toAdd,l=h.toRemove}else r.ion({change({removed:d,added:u}){l=d,o=u},once:!0}),i.isFiltered?(i.isGrouped&&i.includeCollapsed(),r.addFilter({id:"primary-filter",filterBy:i.filtersFunction}),i.isGrouped&&i.excludeCollapsed()):r.filters.clear();i.afterPerformFilter(t||i.isRemoteDataLoading?null:{action:"filter",filters:n,oldCount:a,added:o,removed:l,records:i.storage.values})}afterPerformFilter(t){this.resetRelationCache(),t&&this.triggerFilterEvent(t)}get filtered(){return this.storage.isFiltered}triggerFilterEvent(t){this.trigger("filter",t),this.remoteFilter||(this.trigger("refresh",t),this.trigger("change",t))}filterBy(t){return this.filter(t)}removeFilter(t,i=!1){const r=this,n=t instanceof Le?t:r.filters.get(t);if(n){if(r.filters.remove(n),r._filtersFunction=null,!i){if(r.remoteFilter)return r.filter().then(()=>n);r.filter()}return n}}clearFilters(t=!0){if(this.filters.remove(this.filters.values.filter(i=>!i.internal)),t)return this.filter()}convertFilterToString(t){const i=this.filters.getBy("property",t);return i&&!i.filterBy?String(i):""}doDestroy(){var t;(t=this._filters)===null||t===void 0||t.destroy(),super.doDestroy()}};const zb={add:1,replace:1};var Vb=c=>class extends(c||P){static get $name(){return"StoreGroup"}static get defaultConfig(){return{groupers:null,useGroupFooters:!1}}static get properties(){return{collapsedGroups:new Set}}construct(t){super.construct(t),this.ion({change:"onDataChanged",thisObj:this})}get groupers(){return this._groupers}set groupers(t){this.setGroupers(t)}setGroupers(t,i){const r=this,{storage:n}=r;let s;return t!=null&&t.length?r._groupers=t:r.groupers&&(delete r._groupers,r.includeCollapsed(),n.replaceValues({values:r.removeHeadersAndFooters(n._values),filteredValues:n.isFiltered?r.removeHeadersAndFooters(n._filteredValues):null,silent:!0}),s=r.group(null,null,null,!1,i?.silent)),r._idMap=null,s}get groupRecords(){const t=[];if(this.isGrouped)for(const i of this)i.isSpecialRow&&t.push(i);return t}includeCollapsed(){for(const t of this.collapsedGroups)this.expand(this.getById(t),!1)}excludeCollapsed(){for(const t of this.collapsedGroups)this.collapse(this.getById(t))}onDataChange({source:t,action:i,removed:r}){var n;const s=this,{groupers:a}=s;a&&(a.length?(i==="splice"&&r!==null&&r!==void 0&&r.length||i==="move")&&t.replaceValues({values:s.prepareGroupRecords(),silent:!0}):t.replaceValues({values:s.removeHeadersAndFooters(t.values),silent:!0})),(n=super.onDataChange)===null||n===void 0||n.call(this,...arguments)}move(t,i){const r=this;if(r.isGrouped){var n;if((n=i)!==null&&n!==void 0&&n.isSpecialRow&&(i=r.getPrev(i,!1,!1),!i))return;const s=r.groupers[0].field;let a;i?a=i.isGroupHeader?i.meta.groupRowFor:i[s]:a=r.groupRecords[r.groupRecords.length-1].meta.groupRowFor,r.beginBatch(),t.forEach(o=>o[s]=a),r.endBatch()}super.move(...arguments)}collapse(t){return t&&!t.meta.collapsed?(this.excludeGroupRecords(t),t.meta.collapsed=!0,this.collapsedGroups.add(t.id),!0):!1}expand(t,i=!0){return t!=null&&t.meta.collapsed?(this.includeGroupRecords(t),t.meta.collapsed=!1,i&&this.collapsedGroups.delete(t.id),!0):!1}removeHeadersAndFooters(t){return t.filter(i=>i.isSpecialRow?(this.unregister(i),!1):!0)}prepareGroupRecords(t){var i;const r=this,n=r.collapsedGroups,s=[];let a=(i=r.storage.filteredValues)!==null&&i!==void 0?i:r.storage.values;for(const g of a)g.isGroupHeader&&(g.meta.collapsed||n.has(g.id))&&(n.add(g.id),s.push(g));for(const g of s)r.includeGroupRecords(g);if(a=r.removeHeadersAndFooters(r.storage.values),t&&(a=a.sort(t)),!r.isGrouped)return a;const o=[],l=r.groupers[0].field;let d=null,u=null,h=0;function f(){const g=u.meta.groupRowFor,m=`group-footer-${typeof g=="number"?g:z.createId(g)}`,p=r.getById(m)||new r.modelClass({id:m},r,{specialRow:!0,groupFooterFor:g,groupRecord:u});return p.stores=[r],r.register(p),p.groupChildren=u.groupChildren,u.meta.collapsed||o.push(p),r.allRecords.push(p),u.groupChildren.push(p),h++,p}return a.forEach(g=>{var m;const p=g[l]==null?"__novalue__":g[l],v=`group-header-${typeof p=="number"?p:z.createId(p)}`;if(((m=g.groupChildren)===null||m===void 0?void 0:m.length)===0){r.unregister(g);return}T.isEqual(p,d)||(u&&(r.useGroupFooters&&f(),u.meta.childCount=h),u=r.getById(v)||new r.modelClass({id:v},r,{specialRow:!0,groupRowFor:p,groupField:l}),u.meta.collapsed=n.has(v),u.stores=[r],r.register(u),u.groupChildren=[],o.push(u),r.allRecords.push(u),d=p,h=0),g.instanceMeta(r.id).groupParent=u,n.has(v)||o.push(g),u.groupChildren.push(g),h++}),u&&(r.useGroupFooters&&f(),u.meta.childCount=h),r._idMap=null,o}get isGrouped(){var t;return Boolean((t=this.groupers)===null||t===void 0?void 0:t.length)}group(t,i,r=!1,n=!0,s=!1){const a=this;let o,l;if(t&&typeof t=="object"&&(i=t.ascending,l=t.fn,t=t.field),r)a.groupers.push(o={field:t,ascending:i,complexMapping:t.includes(".")});else if(t){if(i==null){var d,u;i=((d=a.groupInfo)===null||d===void 0?void 0:d.field)===t&&((u=a.groupInfo)===null||u===void 0?void 0:u.fn)===l?!a.groupInfo.ascending:!0}a.groupInfo=o={field:t,ascending:i,fn:l,complexMapping:t.includes(".")},a.groupers=[a.groupInfo]}if(o){const{prototype:h}=a.modelClass;o.complexMapping&&!Object.prototype.hasOwnProperty.call(h,t)&&Object.defineProperty(h,t,{get(){return T.getPath(this,t)}})}if(n!==!1){if(a.remoteSort&&!a.isRemoteDataLoading)return a.sort(null,null,!1,!0).then(()=>a.onAfterGrouping(s));a.sort(null,null,!1,!0)}a.onAfterGrouping(s)}onAfterGrouping(t){if(t)return;const i=this;i.trigger("group",{isGrouped:i.isGrouped,groupers:i.groupers,records:i.storage.values}),i.trigger("refresh",{action:"group",isGrouped:i.isGrouped,groupers:i.groupers,records:i.storage.values})}addGrouper(t,i=!0){return this.group(t,i,!0)}removeGrouper(t){const i=this,{groupers:r}=i,n=r.findIndex(s=>s.field===t);if(n>-1)return r.splice(n,1),r.length?i.group():i.clearGroupers()}clearGroupers(t=!1){return this.setGroupers(null,{silent:t})}isRecordInGroup(t,i){var r;if(!this.isGrouped)return null;const n=(r=this.groupers[0])===null||r===void 0?void 0:r.field;return t[n]===i&&!t.isSpecialRow}isInCollapsedGroup(t){const i=t.instanceMeta(this).groupParent;return i?.meta.collapsed}getGroupRecords(t){return this.isGrouped?this.storage.values.filter(i=>this.isRecordInGroup(i,t)):null}getGroupTitles(){return this.isGrouped?this.getDistinctValues(this.groupers[0].field):null}onDataChanged({changes:t,action:i}){this.isGrouped&&(!t&&zb[i]||t&&this.groupers.some(r=>r.field in t))&&this.sort()}internalIncludeExcludeGroupRecords(t,i){const r=this,n=r.indexOf(t),{id:s,storage:a}=r,{meta:o,groupChildren:l}=t;if(!(n===-1||o.collapsed&&!i||!o.collapsed&&i)){if(l.forEach(d=>d.instanceMeta(s).hiddenByCollapse=!i),i){const d=l.filter(u=>!r.isAvailable(u));a.values.splice(n+1,0,...d)}else a.values.splice(n+1,l.length);a._indicesInvalid=!0,r._idMap=null}}excludeGroupRecords(t){this.internalIncludeExcludeGroupRecords(t,!1)}includeGroupRecords(t){this.internalIncludeExcludeGroupRecords(t,!0)}collectGroupRecords(t,i=!0){return(t?this.storage.allValues:this.storage.values).reduce((n,s)=>(s.isSpecialRow&&(i&&!s.isGroupFooter&&n.push(s),s.isGroupHeader&&n.push.apply(n,s.groupChildren)),n),[])}},jb=c=>class extends(c||P){static get configurable(){return{objectify:null}}initProxy(){if(!globalThis.Proxy)throw new Error("Proxy not supported");return new Proxy(this,{get(i,r){if(r in i)return i[r];if(r==="$store")return i;let n=i.getById(r);return!n&&!isNaN(parseInt(r))&&(n=i.getAt(parseInt(r))),n},set(i,r,n){return r in i||i.isDestroying?i[r]=n:i.add(F({[i.modelClass.idField]:r},n)),!0},deleteProperty(i,r){return i.isDestroying?(delete i[r],!0):Boolean(i.remove(r).length)},has(i,r){if(r in i)return!0;if(r.startsWith("{")&&r.endsWith("}")){const n=z.safeJsonParse(r);r=n?.id}return i.includes(r)}})}},Wb=c=>{var e;return e=class extends(c||P){initRelations(i){const r=this,n=r.modelClass.exposedRelations;i&&r.modelRelations&&r.modelRelations.forEach(s=>{var a;return(a=s.storeDetacher)===null||a===void 0?void 0:a.call(s)}),(!r.modelRelations||r.modelRelations.length===0||i)&&n&&(r.modelRelations=[],n?.forEach(s=>{const a=F({},s),{foreignStore:o,relationName:l,relatedCollectionName:d}=a,u=typeof o=="string"?r[o]:o;if(a.dependentStore=r,r.modelRelations.push(a),u){a.foreignStoreProperty=a.foreignStore,a.foreignStore=u;const h=u.dependentStoreConfigs;if(h.has(r)){const f=h.get(r);if(i){const g=f.find(m=>m.relationName===l);g&&W.remove(f,g)}f.push(a)}else h.set(r,[a]);d&&u.initRelationCollection(a,r),u.count>0&&u.updateDependentStores("dataset",u.records)}}))}initRelationCollection(i,r){const n=this,s=i.relatedCollectionName,a=n.collectionStores||(n.collectionStores={});a[s]={store:r,config:i},n[s+"Store"]||(n[s+"Store"]=r),n.count>0&&n.initModelRelationCollection(s,n.records)}initModelRelationCollection(i,r){const n=this;r.forEach(s=>{s.traverse(a=>{const o=i in a?`$related${z.capitalize(i)}`:i;Object.defineProperty(a,o,{enumerable:!0,configurable:!0,get:function(){return n.getCollection(this,i)},set:function(l){return n.setCollection(this,i,l)}})})})}resetRelationCache(){this.relationCache={},this.forEach(i=>i.initRelations())}updateRecordRelationCache(i,r){r?.forEach(n=>{const{config:s}=n,a=n.related?n.related.id:i.get(s.foreignKey);a!==void 0&&this.cacheRelatedRecord(i,a,s.relationName,a)})}getRelationCollection(i,r){const n=de.asId(r);return this.relationCache[i]&&this.relationCache[i][n]||[]}getCollection(i,r){const{config:n,store:s}=this.collectionStores[r];return s.relationCache[n.relationName]&&s.relationCache[n.relationName][i.id]||[]}setCollection(i,r,n){const{config:s,store:a}=this.collectionStores[r],o=a.relationCache[s.relationName]||(a.relationCache[s.relationName]={}),l=(o[i.id]||[]).slice(),d=[],u=[];a.suspendEvents(),l.forEach(h=>{n.includes(h)||(h[s.foreignKey]=null,a.remove(h),u.push(h))}),n.forEach(h=>{h.isModel instanceof de?h.stores.includes(a)||(a.add(h),d.push(h)):([h]=a.add(h),d.push(h)),h[s.foreignKey]=i.id}),a.resumeEvents(),u.length&&(a.trigger("remove",{records:u}),a.trigger("change",{action:"remove",records:u})),d.length&&(a.trigger("add",{records:d}),a.trigger("change",{action:"add",records:d}))}cacheRelatedRecord(i,r,n,s=null){const a=this,o=a.relationCache[n]||(a.relationCache[n]={});s!==null&&a.uncacheRelatedRecord(i,n,s),r!=null&&W.include(o[r]||(o[r]=[]),i)}uncacheRelatedRecord(i,r=null,n=null){const s=this;function a(o,l){const d=s.relationCache[o],u=d?.[l];if(u){const h=u.indexOf(i);h>=0&&u.splice(h,1),u.length===0&&delete d[l]}}n!=null?a(r,n):i.meta.relationCache&&Object.entries(i.meta.relationCache).forEach(([o,l])=>a(o,l?.id))}updateDependentStores(i,r){this.dependentStoreConfigs.forEach(n=>{n.forEach(s=>{const{dependentStore:a,relatedCollectionName:o,relationName:l,foreignKey:d}=s,u=a.relationCache[l];if(i==="dataset"){o&&this.initModelRelationCollection(o,r),a.forEach(h=>{const f=h.initRelation(s);f&&a.cacheRelatedRecord(h,f.id,l,f.id)});return}if(i==="removeall"){a.forEach(h=>h.removeRelation(s)),delete a.relationCache[l];return}i==="add"&&o&&this.initModelRelationCollection(o,r),(i==="add"||i==="remove")&&r.forEach(h=>{const f=u?.[h.id];switch(i){case"remove":f&&f.forEach(g=>g.removeRelation(s));break;case"add":a.forEach(g=>{g.get(d)==h.id&&(g.initRelation(s),a.cacheRelatedRecord(g,h.id,l))});break}})})})}updateDependentRecordIds(i,r){var n;(n=this.dependentStoreConfigs)===null||n===void 0||n.forEach(s=>{s.forEach(a=>{var o;const{dependentStore:l,relationName:d,foreignKey:u}=a,h=l.relationCache[d],f=h==null||(o=h[i])===null||o===void 0?void 0:o.slice();f?.forEach(g=>{l.cacheRelatedRecord(g,r,d,i),g.set(u,r,!1,!0)})})})}},M(e,"$name","StoreRelation"),e},Ub=c=>class extends(c||P){static get $name(){return"StoreSum"}sum(t,i=this.storage.values){return i?i.reduce((r,n)=>{if(n.isSpecialRow)return r;const s=Number(n[t]);return isNaN(s)?r:r+s},0):0}min(t,i=this.storage.values){return!i||!i.length?0:i.reduce((r,n)=>{var s;return typeof((s=n[t])===null||s===void 0?void 0:s.valueOf())==="number"&&n[t]<r&&(r=n[t]),r},i[0][t])}max(t,i=this.storage.values){return!i||!i.length?0:i.reduce((r,n)=>{var s;return typeof((s=n[t])===null||s===void 0?void 0:s.valueOf())==="number"&&n[t]>r&&(r=n[t]),r},i[0][t])}average(t,i=this.storage.values){if(!i||!i.length)return 0;let r=0;const n=i.reduce((s,a)=>{if(a.isSpecialRow)return s;const o=parseFloat(a[t]);return isNaN(o)?s:(r++,s+o)},0);return r>0?n/r:0}groupSum(t,i){return this.sum(i,this.getGroupRecords(t))}};const Xo=(c,e)=>String(c).toLowerCase().includes(e),gu={string:Xo,number:Xo,boolean:Xo,date:(c,e)=>c instanceof Date&&e instanceof Date?c-e===0:String(c.getMonth()+1).includes(e)||String(c.getDate()).includes(e)||String(c.getFullYear()).includes(e),object:(c,e)=>c===e,undefined:(c,e)=>c===e};var Yb=c=>class extends(c||P){static get $name(){return"StoreSearch"}search(t,i=null,r,n){const s=this.isTree&&!n?this.rootNode.allChildren:this.getAllDataRecords(n),a=s.length,o=[];if(t==null)return[];typeof t=="string"&&(t=t.toLowerCase());let l,d,u,h,f,g;for(l=0;l<a;l++){u=s[l],d=0;for(const p of i||u.fieldNames){var m;h=u[p],f=h instanceof Date?"date":typeof h;const v=r?.[d];v&&(h=v(h),f="string"),g=gu[f],h&&(m=g)!==null&&m!==void 0&&m(h,t)&&o.push({index:l,data:u,field:p,id:u.id}),d++}}return o}findByField(t,i,r=!1,n=!1){const s=this.getAllDataRecords(n),a=s.length,o=new Set,l=[];let d,u,h;for(i!=null&&(i=String(i).toLowerCase()),d=0;d<a;d++)if(u=s[d],h=u[t],!r||!o.has(h)){const f=h instanceof Date?"date":typeof h,g=gu[f];(i==null&&h===i||i&&g(h,i))&&(l.push({id:u.id,index:d,data:u}),r&&o.add(h))}return l}find(t,i=!1){return this.getAllDataRecords(i).find(t)}findRecord(t,i,r=!1){const n=s=>T.isEqual(s[t],i);return this.isTree?this.query(n,r)[0]:this.getAllDataRecords(r).find(n)}query(t,i=!1){if(this.isTree){const r=[];return this.traverse(n=>{t(n)&&r.push(n)},void 0,void 0,i),r}return this.getAllDataRecords(i).filter(t)}some(t,i=!1){return this.getAllDataRecords(i).some(t)}};const Gb=/\./;var qb=c=>class extends(c||P){static get $name(){return"StoreSort"}static get defaultConfig(){return{useLocaleSort:null}}static get configurable(){return{sorters:[],reapplySortersOnAdd:!1}}get isSorted(){return Boolean(this.sorters.length)||this.isGrouped}changeSorters(t){return t.map(i=>this.normalizeSorterConfig(i,!0))}updateReapplySortersOnAdd(t){this.storage.autoSort=t}sort(t,i,r=!1,n=!1){const s=this,a=s.allRecords,o=s.sorters?s.sorters.slice():[];let l=null,d;if(t)if(Array.isArray(t))s.sorters=t.map(u=>s.normalizeSorterConfig(u,typeof u=="string"?!0:i));else{const u=s.normalizeSorterConfig(t,i);r?(d=s.getCurrentSorterByField(u.field),d?(l=d.ascending,d.ascending=u.ascending):s.sorters.push(u)):s.sorters=[u]}return!n&&s.trigger("beforeSort",{sorters:s.sorters,records:a,currentSorters:o})===!1?(s.sorters=o,l!==null&&(d.ascending=l),null):s.performSort(n)}normalizeSorterConfig(t,i){const r=this,n={ascending:i};if(typeof t=="object"){var s;T.assign(n,t),t.fn&&(delete n.fn,n.sortFn=t.fn),n.ascending=(s=t.ascending)!==null&&s!==void 0?s:i}else typeof t=="function"?n.sortFn=t:n.field=t;if(n.ascending==null){const l=r.getCurrentSorterByField(n.field);n.ascending=l?!l.ascending:!0}if(n.sortFn==null){var a,o;const l=(a=r.modelClass)===null||a===void 0||(o=a.$meta.fields.map[n.field])===null||o===void 0?void 0:o.compareItems;l&&(n.sortFn=l)}return n}getCurrentSorterByField(t){return typeof t=="string"&&this.sorters.find(i=>i.field===t)||null}addSorter(t,i=!0){return this.sort(t,i,!0)}removeSorter(t){const i=this.sorters.findIndex(r=>r.field===t||r.sortFn===t);if(i>-1)return this.sorters.splice(i,1),this.sort()}clearSorters(t=!1){if(this.sorters.length)return this.sorters.length=0,this.sort(void 0,void 0,void 0,t)}createSorterFn(t){const i=this.useLocaleSort;return(r,n)=>{for(let s=0;s<t.length;s++){const a=t[s],{field:o,ascending:l=!0,useLocaleSort:d=i}=a,u=a.fn||a.sortFn,h=l?1:-1;if(u){const p=u.call(a,r,n);if(p!==null)return p*h}const f=Gb.test(o),g=f?r.get(o):r[o],m=f?n.get(o):n[o];if(g!==m){if(g==null)return-h;if(m==null)return h;if(d&&typeof g=="string"){if(d===!0)return String(g).localeCompare(m)*h;if(typeof d=="string")return String(g).localeCompare(m,d)*h;if(typeof d=="object")return String(g).localeCompare(m,d.locale,d)*h}if(g>m)return h;if(g<m)return-h}}return 0}}get sorterFn(){const t=this,{sorters:i}=t;return t.createSorterFn(t.remoteSort?[{field:"_remoteSortIndex"}]:t.isGrouped?t.groupers.concat(i):i)}performSort(t){const i=this,{rootNode:r,storage:n,sorterFn:s}=i;i.tree?(!i.isChained&&r.traverse(a=>{a.isLoaded&&a.isParent&&(a.children.sort(s),a.updateChildrenIndices(a.children,"parentIndex",!0))}),n.replaceValues({values:i.collectDescendants(r).visible,silent:!0})):i.isGrouped?n.replaceValues({values:i.prepareGroupRecords(s),silent:!0}):n.replaceValues({values:n.values.sort(s),silent:!0}),i.afterPerformSort(t||i.isRemoteDataLoading)}afterPerformSort(t){if(t)return;const i=this;i._idMap=null;const r={action:"sort",sorters:i.sorters,records:i.allRecords};i.trigger("sort",r),i.trigger("refresh",r)}};const mu=c=>!0;var Kb=c=>class extends(c||P){static get $name(){return"StoreChained"}static get defaultConfig(){return{chainedFilterFn:null,chainedFields:null,masterStore:null,doRelayToMaster:["add","remove","insert"],dontRelayToMaster:[],keepUncommittedChanges:!1,excludeCollapsedRecords:!0}}static get properties(){return{chainedStores:null}}construct(t){super.construct(t);const i=this,{masterStore:r}=i,n=i.syncOrder?"sort":"";r&&(i.methodNamesToRelay.forEach(s=>i[s]=(...a)=>i.relayToMaster(s,a)),i.removeAll=(...s)=>{r.remove(i.getRange(),...s)},r.ion({changePreCommit:i.onMasterDataChangedPreCommit,change:i.onMasterDataChanged,[n]:i.onMasterDataChanged,prio:1,thisObj:i}),r.chainedStores||(r.chainedStores=[]),r.chainedStores.push(i),i.fillFromMaster())}get $master(){return this.masterStore||this}get isChained(){return Boolean(this.masterStore)}set chainedFilterFn(t){this._chainedFilterFn=this.thisObj?t.bind(this.thisObj):t}get chainedFilterFn(){return this._chainedFilterFn||mu}get methodNamesToRelay(){const t=Array.isArray(this.doRelayToMaster),i=Array.isArray(this.dontRelayToMaster);return t&&this.doRelayToMaster.filter(r=>!i||!this.dontRelayToMaster.includes(r))||[]}updateChainedStores(){this.chainedStores&&this.chainedStores.forEach(t=>t.fillFromMaster())}fillFromMaster(){const t=this,{masterStore:i,isTree:r}=t,n=t.chainedFilterFn.length>0||t.chainedFilterFn.toString().length<=10;let s;if(!t.isChained)throw new Error("fillFromMaster only allowed on chained store");if(t.keepUncommittedChanges){if(r)throw new Error("Cannot use keepUncommittedChanges on a chained tree store");n?s=i.allRecords.filter(a=>!t.removed.includes(a)&&!t.added.includes(a)&&t.chainedFilterFn(a)):s=t.chainedFilterFn().filter(a=>!t.removed.includes(a)&&!t.added.includes(a)),s=t.added.values.filter(a=>!t.removed.includes(a)).concat(s)}else if(n?s=i.allRecords.filter(t.chainedFilterFn):s=t.chainedFilterFn(),r&&(t.idRegister={},t.internalIdRegister={},s.forEach(a=>{a.stores.includes(t)?t.register(a):a.joinStore(t)}),t.excludeCollapsedRecords)){const a=t.getChildren(t.rootNode);s=t.doIncludeExclude(a,!0)}t.data=s}commitToMaster(){const t=this,i=t.masterStore;if(!t.isChained)throw new Error("commitToMaster only allowed on chained store");return i.beginBatch(),i.remove(t.removed.values),i.add(t.added.values),i.endBatch(),t.commit()}relayToMaster(t,i){return this.masterStore[t](...i)}onMasterDataChangedPreCommit(t){this.onMasterDataChanged(t),this.$masterEventhandled=!0}onMasterDataChanged({action:t,changes:i,$handled:r,isMove:n}){var s;if(this.$masterEventhandled){this.$masterEventhandled=!1;return}n&&t==="remove"||(t!=="update"||(s=this.chainedFields)!==null&&s!==void 0&&s.some(a=>a in i))&&this.fillFromMaster()}makeChained(t=mu,i,r){return new(r?.storeClass||this.constructor)(F(F({},r||{}),{},{tree:!1,autoTree:!1,masterStore:this.$master,modelClass:this.modelClass,syncDataOnLoad:!1,chainedFilterFn:t,chainedFields:i}))}chain(){return this.makeChained(...arguments)}doDestroy(){var t;(t=this.chainedStores)===null||t===void 0||t.forEach(i=>i.destroy()),super.doDestroy()}},Xb=c=>class extends(c||P){static get $name(){return"StoreState"}getState(){const{sorters:t,groupers:i,filters:r}=this,n={};return t!=null&&t.length&&(n.sorters=t.map(s=>{const a=T.cleanupProperties(T.clone(s));return delete a.fn,delete a.sortFn,a})),i!=null&&i.length&&(n.groupers=i.map(s=>{const a=T.cleanupProperties(T.clone(s));return delete a.fn,a})),r!=null&&r.values.length&&(n.filters=r.values.map(s=>{const a=T.cleanupProperties(T.clone(s.config));return a.value=s.value,a.caseSensitive&&delete a.caseSensitive,a})),n}applyState(t){const i=this,{sorters:r=[],groupers:n=[],filters:s=[]}=t,{sortParamName:a,filterParamName:o}=i;i.sorters=r.filter(l=>l.field||l.sortFn&&!a),i.groupers=n.slice(),i.sort(),i.filters=s.filter(l=>l.property||l.filterBy&&!o),i.filter()}};const Zb=c=>String(c).padStart(6,"0");class ft{constructor(e){this.value=e,this._padded=null}set value(e){this._value=String(e??"")}get value(){return this._value}static from(e){return e==null||e instanceof ft?e:new ft(e)}static pad(e){return e instanceof ft?e.valueOf():ft.split(e).map(Zb).join(".")}static split(e){let t,i;if(e||e===0)switch(typeof e){case"object":e=String(e);case"string":for(i=e.split("."),t=i.length;t-- >0;)i[t]=parseInt(i[t],10);break;case"number":i=[e];break}return i||[]}static compare(e,t){return e===t?0:!e||!t?e?1:t?-1:0:(e=ft.pad(e),t=ft.pad(t),e<t?-1:t<e?1:0)}append(e){const t=this.value;return ft.from(t?`${t}.${e}`:e)}isEqual(e){return!ft.compare(this,e)}match(e){let t=!1;if(e){const i=this.value,r=e[0]==="*",n=e.endsWith("*"),s=e.length;r===n?t=i.indexOf(r?e.substr(1,s-2):e)>-1:r?t=i.endsWith(e.substr(1)):t=i.startsWith(e.substr(0,s-1))}return t}toString(){return this.value}toJSON(){return this.toString()}valueOf(){var e;return(e=this._padded)!==null&&e!==void 0?e:this._padded=ft.pad(this.value)}}ft._$name="Wbs";const Jb=Object.freeze([]);var Qb=c=>{var e;return e=class extends(c||P){get isTree(){return this.tree||this.masterStore&&this.masterStore.tree}get leaves(){const i=this,r=[];return i.isTree?(i.traverse(n=>{n.isLeaf&&r.push(n)}),r):(i.allRecords.forEach(n=>{n.isLeaf&&r.push(n),n.traverse(s=>{s.isLeaf&&r.push(s)},!0)}),r)}async loadChildren(i){}onNodeAddChild(i,r,n,s,a=!1){const o=this,l=i===o.rootNode&&i.isLoading,{storage:d}=o,u=[],h=[],{previousSibling:f}=r[0];let g;if(o.collectDescendants(r,u,h,{inCollapsedBranch:!(i.isExpanded(o)&&i.ancestorsExpanded(o))}),!l&&h.length)for(const p of h)!o.modified.includes(p)&&!s[p.id]&&(o.removed.includes(p)?o.removed.remove(p):p.isLinked||o.added.add(p));if(l&&o.rootVisible&&(u.unshift(i),h.unshift(i)),u.length&&(n===0||!f?g=d.indexOf(i):g=d.indexOf(f)+f.getDescendantCount(!0,o),d.suspendEvents(),o.storage.splice(++g,0,u),d.resumeEvents(),o._idMap=null),o.updateDependentStores("add",r),l&&u.length){var m;if(o.sorters.length&&o.sort(null,null,!1,!0),(m=o.afterLoadData)===null||m===void 0||m.call(o),!a){const p={action:"dataset",data:o._data,records:u};o.trigger("refresh",p),o.trigger("change",p)}}else if(!a){const p={action:"add",parent:i,isChild:!0,isMove:s,records:r,allRecords:h,index:g};if(o.trigger("add",p),o.trigger("change",p),Object.values(s).some(v=>v)){const v={newParent:i,records:r.filter(y=>s[y.id]),oldParents:r.map(y=>{const C=o.getById(y.meta.oldParentId);return C!=null&&C.isRoot?null:C})};o.trigger("move",v)}}}onNodeRemoveChild(i,r,n,s={isMove:!1,silent:!1,unfiltered:!1}){const a=this,{storage:o}=a,l=[],d=[],{isMove:u,silent:h,unfiltered:f}=s,g=f&&a.isFiltered,m=g&&i.unfilteredChildren?i.unfilteredChildren:r;if(a.collectDescendants(m,l,d,{inCollapsedBranch:!(i.isExpanded(a)&&i.ancestorsExpanded(a)),unfiltered:g}),!u){for(const p of r)p.unjoinStore(a);for(const p of d)p.stores.includes(a)&&p.unjoinStore(a),a.added.includes(p)?a.added.remove(p):p.isLinked||a.removed.add(p);a.modified.remove(d)}if(l.length?(n=o.indexOf(l[0]),n>-1&&(o.suspendEvents(),o.splice(n,l.length),o.resumeEvents(),a._idMap=null)):n=-1,!h&&(a.fireRemoveEventForMoveAction||!u)){const p={action:"remove",parent:i,isChild:!0,isMove:u,records:r,allRecords:d,index:n};a.trigger("remove",p),a.trigger("change",p)}return d}collectDescendants(i,r=[],n=[],s){const a=this,{inCollapsedBranch:o=!1,unfiltered:l=!1}=s||0,d=Array.isArray(i)?i:a.getChildren(i,l);if(d)for(let u=0,h=d.length,f;u<h;u++)f=d[u],o||r.push(f),n.push(f),a.collectDescendants(f,r,n,{inCollapsedBranch:o||!f.isExpanded(a),unfiltered:l});return{visible:r,all:n}}getChildren(i,r=!1){const n=this,s=(r||n.isChained)&&i.unfilteredChildren||i.children;return s!=null&&s.length?n.isChained?s.filter(n.chainedFilterFn).sort(n.sorterFn):s:Jb}internalToggleTreeSubRecords(i,r){const n=this,{storage:s}=n,a=s.indexOf(i),o=n.doIncludeExclude(n.getChildren(i),r);if(n.isFiltered&&r&&i.unfilteredChildren&&n.updateChildrenHiddenState(i),o.length&&a!==!1){if(s.suspendEvents(),r){s.splice(a+1,0,...o);const l={action:"add",isExpand:!0,records:o,index:a+1};n.trigger("add",l),n.trigger("change",l)}else{s.splice(a+1,o.length);const l={action:"remove",isCollapse:!0,records:o,index:a+1};n.trigger("remove",l),n.trigger("change",l)}s.resumeEvents(),n._idMap=null}}updateChildrenHiddenState(i){var r;(r=i.unfilteredChildren)===null||r===void 0||r.forEach(n=>{n.instanceMeta(this.id).hidden=!1,n.isLeaf||this.updateChildrenHiddenState(n)})}doIncludeExclude(i,r,n=[]){const s=this,a=i?.length||0;for(let o=0;o<a;o++){const l=i[o];if(!s.isChained||s.chainedFilterFn(l)){const d=l.instanceMeta(s.id);(r||!d.hidden)&&n.push(l),d.hidden=!r,l.isExpanded(s)&&s.doIncludeExclude(s.getChildren(l),r,n)}}return n}async toggleCollapse(i,r){const n=this,s=n.getById(i),a=s.instanceMeta(n);if(r===void 0&&(r=!a.collapsed),!a.isLoadingChildren&&!s.isLeaf&&s.isExpanded(n)===r){if(n.trigger("beforeToggleNode",{record:s,collapse:r}),a.collapsed=r,a.collapsed)return n.onNodeCollapse(s),!0;{n.onNodeExpand(s);let o=!0;if(!s.isLoaded){a.isLoadingChildren=!0;try{await n.loadChildren(s)}catch(l){a.collapsed=!0,o=!1,n.trigger("loadChildrenException",{record:s,exception:l})}finally{a.isLoadingChildren=!1}}return o}}}onNodeCollapse(i){if(i.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(i,!1)}onNodeExpand(i){if(i.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(i,!0)}transformToTree(i){const{parentIdField:r,idField:n,childrenField:s}=this.modelClass,a=new Map,o=[];for(const d of i){const u=d[r];if(u!=null){let h=a.get(u);if(h===void 0){var l;h=(l=i.find(f=>f[n]===u))!==null&&l!==void 0?l:null,a.set(u,h)}h&&(h[s]||(h[s]=[]),h[s].push(d))}else o.push(d)}return o}treeify(i,r,n=!1){const{length:s}=i,a=[],o={};let l,d;for(l=0;l<s;l++){if(!i[l].call){const h=i[l];i[l]=f=>f[h]}a[l]=new Map}this.rootNode.traverse(h=>{if(d=null,h.isLeaf){for(l=0;l<s;l++){var f;const g=((f=d)===null||f===void 0?void 0:f.path)||"",m=a[l],p=i[l](h),v=`${g+p}/`,y=z.makeValidDomId(`generated_${v}`,"_"),C=m.get(y)||m.set(y,{id:y,key:p,path:v,expanded:!0,readOnly:!0,children:[],generatedParent:!0}).get(y);d&&!d.children.includes(C)&&d.children.push(C),d=C}d.children.push(h)}},!0),a.forEach(h=>h.forEach((f,g,m)=>{r?.(f),n&&(f=this.createRecord(f),m.set(g,f))})),o.children=[...a[0].values()];const u=h=>{h.children&&(h.children.sort((f,g)=>{if(f.isLeaf){let m;for(let p=0;!m&&p<s;p++){const v=i[p](f),y=i[p](g);m=v<y?-1:y>v?1:0}return m}else return typeof f.key=="string"||typeof g.key=="string"?f.key.localeCompare(g.key,void 0,{numeric:!0}):f.key<g.key?-1:f.key>g.key?1:0}),h.children.forEach(u))};return u(o),o}treeifyFlatData(i){const{childrenField:r,parentIdField:n}=this.modelClass;let s=!1,a=!0;for(const o of i){if(o.isModel||Array.isArray(o[r])){a=!1;break}o[n]!=null&&(s=!0)}return a&&s&&(i=this.transformToTree(i)),i}async indent(i){const r=this;if(i=Array.isArray(i)?i:[i],i=i.filter(n=>{let s=Boolean(n.previousSibling);for(;s&&!n.isRoot;)s=!i.includes(n.parent),n=n.parent;return s}),i.length&&r.trigger("beforeIndent",{records:i})!==!1){i.sort((n,s)=>ft.compare(n.wbsCode,s.wbsCode)),r.beginBatch();for(const n of i){const s=n.previousSibling;s.appendChild(n),r.toggleCollapse(s,!1)}r.endBatch(),r.trigger("indent",{records:i}),r.trigger("change",{action:"indent",records:i})}}async outdent(i){const r=this;if(i=Array.isArray(i)?i:[i],i=i.filter(n=>{const{parent:s}=n;let a=s&&!s.isRoot;for(;a&&!n.isRoot;)a=!i.includes(s),n=n.parent;return a}),i.length&&r.trigger("beforeOutdent",{records:i})!==!1){i.sort((n,s)=>ft.compare(n.wbsCode,s.wbsCode)),r.beginBatch();for(const n of i){const{parent:s}=n,a=s.children.slice(s.children.indexOf(n)+1);s.parent.insertChild(n,s.nextSibling),n.appendChild(a),r.toggleCollapse(n,!1)}r.endBatch(),r.trigger("outdent",{records:i}),r.trigger("change",{action:"outdent",records:i})}}},M(e,"$name","StoreTree"),M(e,"configurable",{transformFlatData:null,fireRemoveEventForMoveAction:ae.checkVersion("core","6.0","<")}),e};class va{static preWalk(e,t,i){const r=[e];let n,s;for(;r.length;)n=r.pop(),i(n),s=t(n),s&&r.push.apply(r,s.slice().reverse())}static preWalkWithParent(e,t,i){const r=[{node:e,parent:null}];for(;r.length;){const{parent:n,node:s}=r.pop();i(n,s);const a=t(s);Array.isArray(a)&&r.push(...a.slice().reverse().map(o=>({node:o,parent:s})))}}static preWalkUnordered(e,t,i){const r=[e];let n,s;for(;r.length;)n=r[r.length-1],i(n),s=t(n),s?r.splice(r.length-1,1,...s):r.length=r.length-1}static postWalk(e,t,i){const r=new Map,n=[e];let s,a;for(;n.length;)s=n[n.length-1],r.has(s)?(i(s),n.pop()):(a=t(s),a&&n.push(...a.slice().reverse()),r.set(s,s))}static prePostWalk(e,t,i,r){const n=new Map,s=[e];let a,o;for(;s.length;)a=s[s.length-1],n.has(a)?(r(a),s.pop()):(i(a),o=t(a),o&&s.push(...o.slice().reverse()),n.set(a,a))}}va._$name="WalkHelper";var eC=c=>class extends(c||P){static get $name(){return"StoreSync"}static get configurable(){return{syncDataOnLoad:null}}syncDataset(t){const i=this,{storage:r}=i;i.isSyncingDataOnLoad=!0;const{toAdd:n,toRemove:s,toMove:a,updated:o,ids:l}=i.tree?i.syncTreeDataset(t):i.syncFlatDataset(t);let{threshold:d}=i.syncDataOnLoad,u=!1;if(d&&(typeof d=="string"&&(d=parseInt(d,10)/100*i.count),u=n.length+s.length+a.length+o.length>d),i.tree){if(n.length&&i.add(n,u).forEach(g=>g.clearParentId()),a.length)for(const{parent:f,node:g,index:m}of a)i.getById(f.id).insertChild(g,m);i.remove(s,u)}else u&&i.suspendEvents(),i.remove(s),i.add(n),u&&i.resumeEvents();d&&!u&&o.forEach(({record:f,toSet:g,wasSet:m})=>i.onModelChange(f,g,m)),i.acceptChanges();const h={added:n,removed:s,updated:o,thresholdSurpassed:u};if(i.isFiltered&&!i.remoteFilter&&i.filter({silent:i.isRemoteDataLoading}),i.isGrouped)i.group(null,null,!1,!0,i.isRemoteDataLoading);else if(i.isSorted)i.remoteSort?r.replaceValues({values:r.values.sort(i.createSorterFn(i.sorters)),silent:!0}):i.sort();else if(!i.tree)r.values.some((f,g)=>f.id!==l[g])&&(r.replaceValues({values:r.values.sort((f,g)=>l.indexOf(f.id)-l.indexOf(g.id)),silent:!0}),!u&&i.afterPerformSort());else{let f=!1,g=0;va.preWalk(i.rootNode,m=>Array.isArray(m.children)&&!f?m.children:null,m=>{m.id!==l[g++]&&(f=!0)}),f&&(i.sort((m,p)=>l.indexOf(m.id)-l.indexOf(p.id),void 0,void 0,!0),i.clearSorters(!0),!u&&i.afterPerformSort())}u&&i.trigger("refresh",{action:"batch",data:t,records:r.values,syncInfo:h}),i.isSyncingDataOnLoad=!1,i.trigger("loadSync",h)}syncFlatDataset(t){if(!t)return{toRemove:this.records};const i=this,{idField:r,allFields:n}=i.modelClass,s=[],a=[],o=[],l={},d=[],{threshold:u,keepMissingValues:h}=i.syncDataOnLoad;let f=0;return t.forEach(g=>{g=g.isModel?g.data:g;const m=g[r],p=i.getById(m);if(p){if(h===!1)for(const y of n)!(y.dataSource in g)&&y.dataSource in p.data&&(g[y.dataSource]=y.defaultValue);const v=p.set(g,null,Boolean(u));v&&o.push({record:p,wasSet:v,toSet:g}),f++}else a.push(i.processRecord(i.createRecord(g)));l[m]=1,d.push(m)}),f<i.allCount&&i.forEach(g=>{l[g.id]||s.push(g)}),{toAdd:a,toRemove:s,toMove:[],updated:o,ids:d}}syncTreeDataset(t){if(!t)return{toRemove:this.records};const i=this,{idField:r,parentIdField:n,childrenField:s,allFields:a}=i.modelClass,{keepMissingValues:o}=i.syncDataOnLoad,l=[],d=[],u=[],h=[],f={},g=[];i.transformFlatData&&(t=i.treeifyFlatData(t));const{threshold:m}=i.syncDataOnLoad;return va.preWalkWithParent({isRoot:!0,id:i.rootNode.id,children:t},p=>p.children,(p,v)=>{if(p){const y=v[r],C=i.getById(y);if(C){let D;const w=C.children;if(w!==!0&&v[s]===!0&&(C.clearChildren(),C.data[s]=C.children=!0,delete v[s],i.toggleCollapse(C,!0),D=!0),C.parent.id!==p[r]&&u.push({node:C,parent:p,index:p[s].indexOf(v)}),o===!1)for(const R of a)R.name!=="parentId"&&!(R.dataSource in v)&&R.dataSource in C.data&&(v[R.dataSource]=R.defaultValue);const E=C.set(v,null,Boolean(m));E?h.push({record:C,wasSet:E,toSet:v}):D&&C.signalNodeChanged({[s]:{value:!0,oldValue:w}})}else v[n]=p[r],d.push(F(F({},v),Array.isArray(v[s])?{children:[]}:void 0));f[y]=1,g.push(y)}}),i.traverse(p=>{f[p.id]||l.push(p)}),{toAdd:d,toRemove:l,toMove:u,updated:h,ids:g}}};const pu=Symbol("STM_PROP");var tC=c=>class extends(c||P){static get $name(){return"StoreStm"}static get defaultConfig(){return{stm:null,ignoreRemoteChangesInSTM:!1}}get stm(){return this[pu]}set stm(t){const i=this;if(i.stm!==t){var r;(r=i.stm)!==null&&r!==void 0&&r.hasStore(i)&&i.stm.removeStore(i),i[pu]=t,i.stm&&!i.stm.hasStore(i)&&i.stm.addStore(i)}}add(t,i=!1,r={}){let n;const{stm:s}=this;if(!this.tree&&s!==null&&s!==void 0&&s.enabled){var a;n=super.add(t,i),(a=n)!==null&&a!==void 0&&a.length&&s.onStoreModelAdd(this,n,i)}else n=super.add(t,i,r);return n}insert(t,i,r=!1){let n;const{stm:s}=this;if(!this.tree&&s!==null&&s!==void 0&&s.enabled){var a;const o=(Array.isArray(i)?i:[i]).reduce((l,d)=>{const u=d instanceof de?this.indexOf(d):void 0;return u!==void 0&&u!==-1&&l.set(d,u),l},new Map);n=super.insert(t,i),(a=n)!==null&&a!==void 0&&a.length&&(t=this.indexOf(n[0]),s.onStoreModelInsert(this,t,n,o,r))}else n=super.insert(t,i,r);return n}remove(t,i=!1,r){let n;const{stm:s}=this;if(!this.tree&&s!==null&&s!==void 0&&s.enabled){var a;const l=(Array.isArray(t)?t:[t]).map(d=>this.getById(d)).filter(d=>!!d).reduce((d,u)=>{const h=this.indexOf(u);return h!==void 0&&h!==-1&&d.set(u,h),d},new Map);n=super.remove(t,i,r),(a=n)!==null&&a!==void 0&&a.length&&s.onStoreModelRemove(this,n,l,i)}else n=super.remove(t,i,r);return n}removeAll(t){const{stm:i}=this;let r;if(i!=null&&i.enabled){const{tree:n,rootNode:s,allRecords:a}=this,o=a.length,l=n?s.children.slice():a.slice();r=super.removeAll(t),o&&this.count===0&&i.onStoreRemoveAll(this,l,t)}else r=super.removeAll(t);return r}beforeApplyChangeset(){const{stm:t,crudManager:i}=this;let r=!1;return!(i!=null&&i.applyingChangeset)&&t!==null&&t!==void 0&&t.enabled&&(r=!0,t.isRecording&&t.stash(),this.ignoreRemoteChangesInSTM?t.disable():t.startTransaction()),r}applyChangeset(t,i,r,n,s){const a=this.beforeApplyChangeset(),o=super.applyChangeset(t,i,r,n,s);return this.afterApplyChangeset(a),o}afterApplyChangeset(t){if(t){const{stm:i}=this;this.ignoreRemoteChangesInSTM?i.enable():i.stopTransaction(),i.applyStash()}}};const iC={splice:1,clear:1},rC={includeFilteredOutRecords:!1,includeCollapsedGroupRecords:!1},Zo=(c,e)=>(e=e||!1,typeof e=="boolean"&&(e={includeFilteredOutRecords:e,includeCollapsedGroupRecords:!1}),e||rC);class se extends P.mixin(he,jn,Ie,tg,ka,Bb,Nb,Hb,Wb,Ub,Yb,qb,Vb,Kb,Xb,Qb,tC,eC,jb){static get $name(){return"Store"}static get properties(){return{relationCache:{},dependentStoreConfigs:new Map}}static get configurable(){return{id:!0,modelClass:de,verifyNoGeneratedIds:!0}}static get defaultConfig(){return{fields:null,autoTree:!0,data:null,tree:!1,callOnFunctions:!0,storage:null,useRawData:!1,allowNoId:!0,preventSubClassingModel:null}}static get identifiable(){return{registerGeneratedId:!1}}constructor(...e){if(super(...e),this.objectify)return this.initProxy()}construct(e={}){const t=this;Object.assign(t,{added:new oa,removed:new oa,modified:new oa,idRegister:{},internalIdRegister:{},oldIdMap:{}}),e.storeId&&(e=T.assign({id:e.storeId},e)),super.construct(e),t.initRelations()}static from(e,t={},i=null){return e&&!e.isStore&&(typeof e=="string"?e=se.getStore(e):(Array.isArray(e)&&(i&&(e=e.map(r=>r.isModel?r:i(r))),e=T.assign({},t,{data:e})),e=new se(e))),e}doDestroy(){var e,t,i;const r=this,n=r.registeredRecords;for(let o=n.length-1,l;o>=0;o--){var s;l=n[o],(s=l)!==null&&s!==void 0&&s.isDestroyed||l.unjoinStore(r)}if((e=r._storage)===null||e===void 0||e.destroy(),(t=r.stm)===null||t===void 0||(i=t.removeStore)===null||i===void 0||i.call(t,r),!r.isChained){var a;(a=r.rootNode)===null||a===void 0||a.destroy()}super.doDestroy()}beginBatch(){this.suspendEvents()}endBatch(){this.resumeEvents()&&this.trigger("refresh",{action:"batch",data:this.storage.values,records:this.storage.values})}set storage(e){const t=this;e!=null&&e.isCollection?t._storage=e:t._storage=new rt(e),t._storage.autoFilter=t.reapplyFilterOnAdd,t._storage.autoSort=t.reapplySortersOnAdd;for(const i of t._storage)i.joinStore(t);t._storage.ion({change:"onDataChange",thisObj:t})}get storage(){return this._storage||(this.storage={}),this._storage}get allRecords(){const e=this;if(e.isTree){const t=e.collectDescendants(e.rootNode,void 0,void 0,{unfiltered:!0}).all;return e.rootVisible&&t.unshift(e.rootNode),t}else return e.isGrouped?e.collectGroupRecords():e.storage.allValues}getAllDataRecords(e){return this.isGrouped?this.collectGroupRecords(e,!1):e?this.storage.allValues:this.storage.values}onIsCreatingToggle(e,t){const i=this,r=e.isPersistable&&!t;i.added[r?"add":"remove"](e),r&&(i.trigger("addConfirmed",{record:e}),i.autoCommit&&i.doAutoCommit())}joinRecordsToStore(e){const{allCount:t}=this;for(let i=0;i<e.length;i++){const r=e[i];r.setData("parentIndex",t+i-e.length),r.joinStore(this)}}onDataChange({source:e,action:t,added:i,removed:r,replaced:n,oldCount:s,items:a,from:o,to:l}){const d=this,u=iC[t],h=u&&i?.length,f=u&&r?.length;let g,m;if(d._idMap=null,h&&d.joinRecordsToStore(i),n?.forEach(([p,v])=>{p.unjoinStore(d,!0),v.joinStore(d)}),super.onDataChange(...arguments),!d.isTree){if(h){for(const p of i)d.removed.includes(p)?d.removed.remove(p):p.isLinked||d.added.add(p);g=!d.remoteFilter&&d.filtered&&d.reapplyFilterOnAdd,g&&d.filter({silent:!0}),m=!d.remoteSort&&d.isSorted&&d.reapplySortersOnAdd,m&&d.sort(null,null,!1,!0)}if(f){for(const p of r)p.cancelBatch(),p.unjoinStore(d),d.added.includes(p)?d.added.remove(p):!p._undoingInsertion&&!p.isCreating&&!p.isLinked&&d.removed.add(p);d.modified.remove(r),g=!d.remoteFilter&&d.filtered,g&&d.filter({silent:!0})}}switch(t){case"clear":d.relationCache={},d.updateDependentStores("removeall"),d.trigger("removeAll"),d.trigger("change",{action:"removeall"});break;case"splice":if(h){d.updateDependentStores("add",i);const p=i.reduce((C,D)=>{const{previousIndex:w}=D.meta;return w>-1&&w<C&&(C=w),C},i[0].meta.previousIndex),v=e.indexOf(i[0],!e.autoFilter),y={records:i,index:v};p>-1&&(y.oldIndex=p),d.trigger("add",y),d.trigger("change",Object.assign({action:"add"},y)),g&&d.triggerFilterEvent({action:"filter",filters:d.filters,oldCount:s,records:d.storage.allValues}),m&&d.trigger("sort",{action:"sort",sorters:d.sorters,records:d.storage.allValues})}r.length&&(d.updateDependentStores("remove",r),d.trigger("remove",{records:r}),d.trigger("change",{action:"remove",records:r})),n.length&&(d.trigger("replace",{records:n,all:d.records.length===n.length}),d.trigger("change",{action:"replace",replaced:n,all:d.records.length===n.length}));break;case"filter":(d.isGrouped||d.isSorted)&&d.performSort(!0);break;case"move":{const p=Math.min(o,l),v=Math.min(d.storage.allValues.length-1,Math.max(o,l));for(let y=d.storage.allValues,C=p;C<=v;C++)y[C].setData("parentIndex",C);d.trigger("move",{record:a[0],records:a,from:o,to:l}),d.isFiltered&&d.performFilter(),d.trigger("change",{action:t,record:a[0],records:a,from:o,to:l});break}}}onDataReplaced(e,t){var i;const r=this,{storage:n}=r,s=n.allValues,a=Boolean(r.sorters.length>0);for(let d=0;d<s.length;d++)s[d].joinStore(r);const o=r.prepareGroupRecords();if(!r.remoteFilter&&r.isFiltered&&r.filter({silent:!0}),r.remoteSort?r.isGrouped&&n.replaceValues({values:o,silent:!0}):(r.isGrouped&&r.group(null,null,!1,!a,!0),a&&r.sort(null,null,!1,!0)),!r.useRawData.disableDuplicateIdCheck){const{idMap:d}=r;if(Object.keys(d).length<n.values.length){const u=[];throw n.values.forEach(h=>d[h.id]?delete d[h.id]:u.push(h)),new Error(`Id collision on ${u.map(h=>h.id)}`)}}const l={action:e,data:t,records:n.values};r.updateDependentStores(e,l.records),(i=r.afterLoadData)===null||i===void 0||i.call(r),r.isRemoteDataLoading||r.trigger("refresh",l),r.trigger("change",l)}onModelChange(e,t,i,r,n){const s=this,a={record:e,records:[e],changes:i,batch:e.batching!=null,fromRelationUpdate:n},o=e.ignoreBag||e.isLinked?!1:s.updateModifiedBagForRecord(e);if(s.storage.onItemMutation(e,i),"id"in i){const{oldValue:l,value:d}=t.id;s.updateDependentRecordIds(l,d),s.onRecordIdChange({record:e,oldValue:l,value:d})}if(!r){if("id"in i){const{oldValue:l,value:d}=t.id;s.trigger("idChange",{store:s,record:e,oldValue:l,value:d})}s.onUpdateRecord(e,i),s.trigger("update",a),s.trigger("change",Object.assign({action:"update"},a))}s.autoCommit&&o&&s.doAutoCommit()}updateModifiedBagForRecord(e){const t=this;let i=!1;return e.isModified?!t.modified.includes(e)&&!t.added.includes(e)&&e.isPartOfStore(t)&&!e.isAutoRoot&&(e.isPhantom?t.added.add(e):t.modified.add(e),i=!0):t.modified.remove(e),i}get idMap(){const e=this,t=!e._idMap,i=e._idMap||(e._idMap={});if(t){const r=e.storage.values;for(let n,s=0,a=0;s<r.length;s++)n=r[s],i[n.id]={index:s,visibleIndex:a,record:n},n.isSpecialRow||a++}return i}changeModelClass(e){const{fields:t}=this;this.originalModelClass=e;let i=e;return t!=null&&t.length?i=class extends e{static get fields(){return t}}:this.preventSubClassingModel||(i=class extends e{}),i.initClass(),i}set storeId(e){this.id=e}get storeId(){return this.id}changeId(e,t){return super.changeId(e!==!0&&e,t)}updateId(e,t){const i=se.getById(e);i&&se.unregisterInstance(i),super.updateId(e,t)}generateAutoId(){return se.generateId("store-")}get tree(){return this._tree}set tree(e){this._tree=e,e&&!this.rootNode&&(this.rootNode=this.buildRootNode(),this.rootNode.isAutoRoot=!0)}buildRootNode(){return{}}static getStore(e,t){if(e instanceof se)return e;if(this.getById(e))return this.getById(e);if(Array.isArray(e)){let i;const r=e.map(n=>(n instanceof de?i=n.constructor:typeof n=="string"&&(n={text:n}),n));e={autoCreated:!0,data:r,modelClass:i||class extends de{},allowNoId:!0},t||(t=se)}if(t)return new t(e)}static get stores(){return se.registeredInstances}get rootNode(){return this.masterStore?this.masterStore.rootNode:this._rootNode}set rootNode(e){var t;const i=this,r=i._rootNode;e!==r&&(r&&i.clear(!0),e instanceof de?(e.instanceMeta(i).collapsed=!1,i._rootNode=e):i._rootNode=e=new i.modelClass(Object.assign({expanded:!0,[i.modelClass.idField]:`${i.id}-rootNode`},e),i,null,!0),i._tree=!0,e.isRoot=!0,e.joinStore(i),((t=e.children)!==null&&t!==void 0&&t.length||i.rootVisible)&&(e.isLoading=!0,i.onNodeAddChild(e,e.children||[],0),e.isLoading=!1),i.trigger("rootChange",{oldRoot:r,rootNode:e}))}set data(e){this.setStoreData(e)}setStoreData(e){var t,i;const r=this,{idField:n,childrenField:s}=r.modelClass;if(r.transformFlatData&&((t=e)===null||t===void 0?void 0:t.length)>0&&!Object.isExtensible(e[0])&&(r.useRawData=r.useRawData||{disableDuplicateIdCheck:!1,disableDefaultValue:!1,disableTypeConversion:!1},e=T.clone(e)),r.getConfig("plugins"),r.processConfiguredListeners(),e&&!Array.isArray(e)&&(e=T.transformNamedObjectToArray(e,n)),r.tree=!r.isChained&&(r.tree||Boolean(r.autoTree&&((i=e)===null||i===void 0?void 0:i.some(a=>a[s])))),e&&(r.remoteSort||r.remoteFilter))for(let a=0;a<e.length;a++)e[a]._remoteSortIndex=a;if(!r.syncDataOnLoad||!r._data){if(r._data=e,r.tree){r.transformFlatData&&(e=r.treeifyFlatData(e));const a=r.rootNode;if(a.isLoading=!0,r._data.forEach(o=>delete o.parentId),r.clear(!0),a.appendChild(e),r.updateDependentStores("dataset",[a]),a.isLoading=!1,e.length===0){const o={action:"dataset",data:[],records:[]};r.trigger("refresh",o),r.trigger("change",o)}else r.isFiltered&&r.filter()}else r.loadData(e);r.added.clear(),r.removed.clear(),r.modified.clear()}else r.syncDataset(e)}loadData(e,t="dataset"){const i=this,{storage:r,allowNoId:n}=i,s=i.modelClass.fieldMap.id.dataSource,a=i.find(h=>h.isCreating);a&&r.values.splice(i.records.indexOf(a),1);let o=i.verifyNoGeneratedIds;if(i.removeHeadersAndFooters(i.storage.values),i._idMap=null,i.oldIdMap={},e){if(!(e[0]instanceof de)){i.modelClass.exposeProperties(e[0]);const f=e.length,g=new Array(f);for(let m=0;m<f;m++){var l,d,u;const p=e[m];if(!n&&p[s]==null)throw new Error(`Id required but not found on row ${m}`);o&&(l=p[s])!==null&&l!==void 0&&(d=(u=l).startsWith)!==null&&d!==void 0&&d.call(u,"_generated")&&(console.warn(`Generated id found in data: ${p[s]}. Generated ids are temporary and should be replaced with real ids by the backend`),o=!1),g[m]=i.processRecord(i.createRecord(p,!0),!0),g[m].setData("parentIndex",m)}i.clear(!0),r.replaceValues({values:g,isNewDataset:!0,silent:!0})}else i.clear(!0),r.replaceValues({values:e.slice(),isNewDataset:!0,silent:!0});a&&r.values.push(a),i._data=e,i.onDataReplaced(t,e)}else i.clear(!0),i._data=null;i.isSyncingDataOnLoad=!1}get data(){return this._data}getRange(e,t,i=!0){return(i?this.storage.allValues:this.storage.values).slice(e,t)}createRecord(e,t=!1,i=!1){return new this.modelClass(e,this,null,t,!1,i)}processRecord(e,t=!1){return e}refreshData(){this.filter(),this.sort()}onRecordIdChange({record:e,oldValue:t,value:i}){const r=this,n=r._idMap,{idRegister:s,oldIdMap:a}=r;if(r.storage._indicesInvalid=!0,a[t]=e,n&&!n[i]){const o=n[t];delete n[t],n[i]=o}r.added.changeId(t,i),r.removed.changeId(t,i),r.modified.changeId(t,i),delete s[t],s[i]=e,e.index=r.storage.indexOf(e)}onUpdateRecord(e,t){const i=this,{internalId:r}=t,{internalIdRegister:n}=i;r&&(this.storage._indicesInvalid=!0,delete n[r.oldValue],n[r.value]=e),i.reapplyFilterOnUpdate&&i.isFiltered&&i.filter()}get useRawData(){return this._useRawData}set useRawData(e){e===!0?this._useRawData={enabled:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0,disableDefaultValue:!1}:this._useRawData=e?Object.assign(e,{enabled:!0}):{enabled:!1}}getCount(e=!0){return e?this.count:this.originalCount}get originalCount(){var e;return this.storage.totalCount-(((e=this.groupRecords)===null||e===void 0?void 0:e.length)||0)}get count(){return this.storage.count}get allCount(){return this.isTree?this.rootNode.descendantCount:this.storage.totalCount}get records(){return this.storage.values}get first(){return this.storage.values[0]}get last(){return this.storage.values[this.storage.values.length-1]}getAt(e,t=!1){return this.storage.getAt(e,t)}register(e){const t=this;if(!t.useRawData.disableDuplicateIdCheck){const i=t.isTree&&t.idRegister[e.id];if(i&&i!==e)throw new Error(`Id collision on ${e.id}`)}t.idRegister[e.id]=e,t.internalIdRegister[e.internalId]=e}unregister(e){delete this.idRegister[e.id],delete this.internalIdRegister[e.internalId]}get registeredRecords(){return Object.values(this.idRegister)}getById(e){if(e!=null&&e.isModel){const t=e;return t.hasLinks&&!this.storage.allValues.includes(t)?t.$links.find(i=>this.storage.allValues.includes(i)):t}return this.idRegister[e]}isAvailable(e){const t=this.getById(e);return t&&this.storage.includes(t)||!1}getByInternalId(e){return this.internalIdRegister[e]}includes(e){return this.isTree?this.idRegister[de.asId(e)]!=null:this.indexOf(e)>-1}indexOf(e,t=!1,i=!1){if(e!=null&&e.isModel&&!e.stores.includes(this.$store||this)){const s=e.$links.find(a=>this.storage.allValues.includes(a));return s?this.indexOf(s,t):-1}if(this.isTree)return(i?this.rootNode.allChildren:this.storage.values).indexOf(this.getById(e));const r=de.asId(e);if(r==null)return-1;const n=this.idMap[r];return n?n[t?"visibleIndex":"index"]:-1}allIndexOf(e){if(this.isTree){const t=this.getById(e);let i=-1;return t&&t.bubble(r=>{r.parent?i+=r.parentIndex+1:r===this.rootNode&&this.rootVisible&&(i+=1)}),i}else return this.storage.indexOf(e,!0)}getDistinctValues(e,t=!1){const i=this,r=[],n={};let s;return i.forEach(a=>{if(!a.isSpecialRow&&!a.isRoot){s=a.get(e);const o=s instanceof Date?s.getTime():s;n[o]||(r.push(s),n[o]=1)}},i,t),r}getValueCount(e,t){let i=0;return this.forEach(r=>{T.isEqual(r.get(e),t)&&i++}),i}set json(e){typeof e=="string"&&(e=z.safeJsonParse(e)),this.data=e}get json(){return z.safeJsonStringify(this)}get formattedJSON(){return z.safeJsonStringify(this,null,4)}toJSON(){return(this.isTree?this.rootNode.unfilteredChildren||this.rootNode.children||[]:this.allRecords).map(e=>e.toJSON())}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.project}getInlineData(e){const t=[];if(this.tree){var i;(i=this.rootNode.children)===null||i===void 0||i.forEach(r=>t.push(r.getCurrentConfig(e)))}else this.forEach(r=>t.push(r.getCurrentConfig(e)));return t}getCurrentConfig(e){const t=super.getCurrentConfig(e),{state:i}=this;if(t){var r;t.data&&(t.data=this.getInlineData(e)),delete t.project,delete t.stm,delete t.asyncEvents,((r=t.modelClass)===null||r===void 0?void 0:r.$meta.hierarchy[t.modelClass.$meta.hierarchy.length-2])===this.constructor.defaultConfig.modelClass&&delete t.modelClass,this.tree||delete t.tree,i&&Object.assign(t,i)}return t}forEach(e,t=this,i){const r=this,n=(s,a)=>{if(!s.isRoot&&!s.isSpecialRow)return e.call(t,s,a)};if(i=Zo(r,i),r.isTree)r.isChained&&(i=F(F({},i),{},{sorterFn:r.sorterFn})),r.rootNode.traverseWhile(n,!1,i);else{const s=i.includeFilteredOutRecords?r.storage.allValues:r.storage.values;if(r.isGrouped&&i.includeCollapsedGroupRecords)for(let a=0;a<s.length;a++){const o=s[a];if(o.groupChildren&&o.meta.collapsed===!0)for(let l=0;l<o.groupChildren.length;l++){const d=o.groupChildren[l];if(n(d,l)===!1)return}else if(n(o,a)===!1)return}else for(let a=0;a<s.length;a++)if(n(s[a],a)===!1)return}}map(e,t=this){return this.storage.values.map(e,t)}every(e,t=this,i){return this.storage[i?"allValues":"values"].every(e,t)}reduce(e,t=[],i=this){return i!==this&&(e=e.bind(i)),this.storage.values.reduce(e,t,i)}[Symbol.iterator](){return this.storage.values[Symbol.iterator]()}traverse(e,t=this.rootNode,i=t===this.rootNode,r){const n=this;if(r=Zo(n,r),n.isTree){if(typeof t=="boolean"&&(i=t,t=n.rootNode),n.isChained){const s=e;e=a=>{n.chainedFilterFn(a)&&s(a)}}t.traverse(e,i,r)}else n.forEach(s=>s.traverse(e,!1,r),n,r)}traverseWhile(e,t=this.rootNode,i=t===this.rootNode,r){const n=this;if(r=Zo(n,r),n.isTree){if(typeof t=="boolean"&&(i=t,t=n.rootNode),n.isChained){const s=e;e=a=>{n.chainedFilterFn(a)&&s(a)}}t.traverseWhile(e,i,r)}else for(const s of n.storage)if(s.traverse(e,!1,r)===!1)break}getNext(e,t=!1,i=!1){const r=this,n=r.storage.values;let s=r.indexOf(e);if(s>=n.length-1)if(t)s=-1;else return null;const a=n[s+1];return i&&a&&a.isSpecialRow?r.getNext(n[s+1],t,!0):a}getPrev(e,t=!1,i=!1){const r=this,n=r.storage.values;let s=r.indexOf(e);if(s===0)if(t)s=n.length;else return null;const a=n[s-1];return i&&a&&a.isSpecialRow&&s>0?r.getPrev(n[s-1],t,!0):a}getAdjacent(e,t=!0,i=!1,r=!1){return t?this.getNext(e,i,r):this.getPrev(e,i,r)}getNextLeaf(e,t=!1){const i=this,r=i.leaves,n=i.getById(e);let s=r.indexOf(n);if(s>=r.length-1)if(t)s=-1;else return null;return r[s+1]}getPrevLeaf(e,t=!1){const i=this,r=i.leaves,n=i.getById(e);let s=r.indexOf(n);if(s===0)if(t)s=r.length;else return null;return r[s-1]}getAdjacentLeaf(e,t=!0,i=!1){return t?this.getNextLeaf(e,i):this.getPrevLeaf(e,i)}}se.initClass();se._$name="Store";const nC=(c,e)=>(Array.isArray(e[1])?e[1].forEach(t=>c.push(encodeURIComponent(e[0])+"="+encodeURIComponent(t))):c.push(encodeURIComponent(e[0])+"="+encodeURIComponent(e[1])),c),Bs=Promise.resolve(),hn=c=>String(c).padStart(2,"0"),sC=c=>`${c.getFullYear()}-${hn(c.getMonth()+1)}-${hn(c.getDate())}T${hn(c.getHours())}:${hn(c.getMinutes())}:${hn(c.getSeconds())}.${c.getMilliseconds()}`;class $t extends se{static get defaultConfig(){return{headers:null,fetchOptions:null,sendAsFormData:null,writeAllFields:null,parentIdParamName:"id",responseSuccessProperty:"success",responseDataProperty:"data",responseTotalProperty:"total",filterParamName:null,restfulFilter:!1,sortParamName:null,pageParamName:null,pageStartParamName:null,pageSizeParamName:"pageSize",pageSize:50,useRestfulMethods:null,httpMethods:{create:"POST",read:"GET",update:"PUT",delete:"DELETE"}}}static get configurable(){return{params:null}}afterConstruct(e){super.afterConstruct(e),this.autoLoad&&this.load().catch(()=>{})}get isLoading(){return this._isLoading?2:this.loadTriggerPromise?1:!1}get isCommitting(){return Boolean(this.commitPromise)}set pageParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageStartParamName)throw new Error("Configs pageStartParamName and pageParamName are mutually exclusive");this._pageParamName=e}get pageParamName(){return this._pageParamName}set pageStartParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageParamName)throw new Error("Configs pageParamName and pageStartParamName are mutually exclusive");this._pageStartParamName=e}get pageStartParamName(){return this._pageStartParamName}get isPaged(){return this.pageParamName||this.pageStartParamName}get allCount(){return"remoteTotal"in this?this.remoteTotal:super.allCount}get lastPage(){if(this.isPaged)return Math.floor((this.allCount+this.pageSize-1)/this.pageSize)}buildQueryString(e,...t){const i=e.includes("?"),r=Object.entries(Object.assign({},...t)).reduce(nC,[]).join("&");return r?(i?"&":"?")+r:""}async performSort(e){const t=this;if(t.remoteSort&&!t.isRemoteDataLoading){t.isRemoteDataLoading=!0;const i=await t.internalLoad({},"",r=>{t.data=r.data,t.afterPerformSort(e)});return t.isRemoteDataLoading=!1,i}else super.performSort(e)}async performFilter(e){const t=this;if(t.remoteFilter){var i;(i=t.loadingPromise)===null||i===void 0||i.abort(),t.isRemoteDataLoading=!0;const r=t.count,{filters:n}=t;t.currentPage=1;const s=await t.internalLoad({},"",a=>{t.data=a.data,a=e?null:{action:"filter",filters:n,oldCount:r,records:t.storage.values},t.afterPerformFilter(a),t.trigger("refresh",a)});return t.isRemoteDataLoading=!1,s}else super.performFilter(e)}encodeFilterParams(e){const t=[];for(const{property:i,operator:r,value:n,caseSensitive:s}of e)t.push({field:i,operator:r,value:n,caseSensitive:s});return JSON.stringify(t,function(i,r){return i===""?r:this[i]instanceof Date?sC(this[i]):r})}encodeSorterParams(e){return JSON.stringify(e.filter(t=>!t.sortFn).map(t=>t))}buildReadUrl(){const{readUrl:e}=this;return this.restfulFilter&&this.filters.count?(e.endsWith("/")?e:e+"/")+this.filters.first.value:e}internalLoad(e,t,i,r=0){e=T.assign({},this.params,e);const n=this,s=n.buildReadUrl(),a={action:"read"+t,params:e,url:s};if(!s)throw new Error("No load url specified");if(n.trigger("beforeLoad"+t,a)===!1)throw!1;return n.loadArgs=[s,a,e,t,i],r===!1?new Promise((o,l)=>n.sendLoadRequest(o,l)):n.loadTriggerPromise||(n.loadTriggerPromise=new Promise((o,l)=>{n.setTimeout({delay:r,fn:"sendLoadRequest",args:[o,l],cancelOutstanding:!0})}))}async sendLoadRequest(e,t){const i=this,[r,n,s,a,o]=i.loadArgs;if(i.loadTriggerPromise=null,r){if(i._isLoading=!0,i.trigger(`load${a}Start`,n),i.trigger("beforeRequest",n),i.filterParamName&&i.isFiltered&&(s[i.filterParamName]=i.encodeFilterParams(i.filters.values)),i.remoteSort&&i.isSorted&&(s[i.sortParamName]=i.encodeSorterParams(i.groupers?i.groupers.concat(i.sorters):i.sorters)),i.isPaged){if(!(i.pageParamName in s||i.pageStartParamName in s)){const d=Math.min(i.currentPage||1,i.allCount?i.lastPage:1/0);i.pageParamName?s[i.pageParamName]=d:s[i.pageStartParamName]=(d-1)*i.pageSize}s[i.pageSizeParamName]=i.pageSize}const l={headers:i.headers,parseJson:!0};i.useRestfulMethods&&(l.method=i.httpMethods.read,n.body&&(l.body=JSON.stringify(n.body)));try{const d=i.loadingPromise=et.get(n.url+i.buildQueryString(n.url,s),T.assign(l,i.fetchOptions)),u=await d,h=u.parsedJson,f=Array.isArray(h),g=f||h&&T.getPath(h,i.responseSuccessProperty)!==!1,m=f?null:T.getPath(h,i.responseTotalProperty);if(i.isDestroyed)return;if(i.loadingPromise=null,i._isLoading=!1,n.response=u,n.json=h,g){if(m!=null&&(i.remoteTotal=parseInt(m,10)),i.isPaged)if(i.remoteTotal>=0){const p=i.pageParamName?s[i.pageParamName]:s[i.pageStartParamName]/i.pageSize+1;i.currentPage=Math.min(p,i.lastPage)}else throw new Error("A paged store must receive its responseTotalProperty in each data packet");n.data=f?h:T.getPath(h,i.responseDataProperty),await o(n),!i.isDestroyed&&i.trigger("load"+a,n),e(n)}else Object.assign(n,{exception:!0,exceptionType:"server",error:h?.error}),!i.isDestroyed&&i.trigger("exception",n),t(n);!i.isDestroyed&&i.trigger("afterRequest",n)}catch(d){i._isLoading=!1,n.exception=!0,d instanceof Response?(n.exceptionType=d.ok?"server":"network",n.response=d,n.error=d.error):(n.exceptionType="server",n.error=d),!i.isDestroyed&&i.trigger("exception",n),t(n),!i.isDestroyed&&i.trigger("afterRequest",n)}}}async load(e){const t=this;return t.isPaged?t.loadPage(t.currentPage||1,e):t.internalLoad(e,"",i=>{t.data=i.data})}async loadChildren(e){return this.readUrl?this.internalLoad({[this.parentIdParamName]:e.id},"Children",t=>{t.parentRecord=e,e.children.length&&e.clearChildren(!0),e.data[e.constructor.childrenField]=t.data,e.processChildren(e.stores)},!1):this.immediatePromise}async loadPage(e,t){this.allCount&&(e=Math.min(e,this.lastPage));const i=this,r=i.pageParamName?{[i.pageParamName]:e}:{[i.pageStartParamName]:(e-1)*i.pageSize};return r[i.pageSizeParamName]=i.pageSize,i.internalLoad(T.assign(r,t),"Page",n=>{i.loadData(n.data,"pageLoad")})}async nextPage(e){const t=this;return t.isPaged&&t.currentPage!==t.lastPage?t.loadPage(t.currentPage+1,e):Bs}async previousPage(e){return this.isPaged&&this.currentPage!==1?this.loadPage(this.currentPage-1,e):Bs}async commit(){const e=this,{changes:t}=e,i=[];if(e.commitPromise)return!1;if(!t)return e.modified.count&&(e.modified.forEach(r=>r.clearChanges(!0,!1)),e.modified.clear()),Bs;if(e.trigger("beforeCommit",{changes:t})!==!1){[...t.added,...t.modified,...t.removed].forEach(s=>s.meta.committing=!0),e.trigger("commitStart",{changes:t});const r={action:"commit",exception:!1,changes:t};let n=e.commitRemoved(r);return n&&i.push(n),n=e.commitAdded(r),n&&i.push(n),n=e.commitModified(r),n&&i.push(n),i.length?(n=i.length===1?i[0]:Promise.all(i),e.commitPromise=new Promise((s,a)=>{n.then(()=>{e.commitPromise=null,r.exception?(e.trigger("exception",r),a(r)):(e.trigger("commit",{changes:t}),s(r))}).catch(()=>{e.commitPromise=null,a(r)})})):(e.modified.forEach(s=>s.clearChanges(!0,!1)),e.modified.clear(),e.added.forEach(s=>s.clearChanges(!0,!1)),e.added.clear(),e.removed.clear(),e.trigger("commit",{changes:t}),Bs)}}doAutoCommit(){this.suspendCount<=0&&this.commit().catch(e=>{const{response:t}=e;if(!(t&&(t.ok&&t.parsedJson||[500,404].includes(t.status))))throw e})}commitAdded(e){const t=this,i=t.added,r={action:"create",params:t.params};return i.count&&t.createUrl?new Promise(n=>{const s=i.values.map(d=>d.persistableData);e.create=r,r.body={data:s},t.trigger("beforeRequest",r);let a=r.body;if(t.sendAsFormData){const d=new FormData;d.append("data",JSON.stringify(s)),a=d}const o={headers:t.headers,parseJson:!0},l=t.createUrl+t.buildQueryString(t.createUrl,t.params);t.useRestfulMethods&&(o.method=t.httpMethods.create),et.post(l,a,T.assign(o,t.fetchOptions)).then(d=>{const u=d.parsedJson,h=Array.isArray(u),f=h||u&&u.success!==!1;e.response=d,r.json=u,r.response=d,f?(t.processReturnedData(i.values,h?u:T.getPath(u,t.responseDataProperty)),i.clear(),t.trigger("commitAdded"),t.trigger("refresh",r),n(e)):(i.forEach(g=>g.meta.committing=!1),e.exception=r.exception=!0,e.exceptionType=r.exceptionType="server",t.trigger("exception",r),n(e)),t.trigger("afterRequest",r)}).catch(d=>{i.forEach(u=>u.meta.committing=!1),e.exception=r.exception=!0,d instanceof Response?(e.response=d,r.exceptionType=d.ok?"server":"network",r.response=d,r.error=d.error):(r.exceptionType="server",r.error=d),t.trigger("exception",r),n(e),t.trigger("afterRequest",r)})}):null}commitModified(e){const t=this,{modified:i}=t.changes,r={action:"update",params:t.params},n=i.length&&t.updateUrl?new Promise(s=>{const a=i.map(d=>t.writeAllFields?d.persistableData:d.modificationDataToWrite).filter(d=>!T.isEmpty(d));if(a.length===0){t.modified.clear(),i.forEach(d=>d.meta.committing=!1),s();return}e.update=r,r.body={data:a},t.trigger("beforeRequest",r);let o=r.body;if(t.sendAsFormData){const d=new FormData;d.append("data",JSON.stringify(a)),o=d}const l={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(l.method=t.httpMethods.update),et.post(t.updateUrl+t.buildQueryString(t.updateUrl,t.params),o,T.assign(l,t.fetchOptions)).then(d=>{const u=d.parsedJson,h=Array.isArray(u),f=h||u&&u.success!==!1;e.response=d,r.json=u,r.response=d,f?(t.processReturnedData(i,h?u:T.getPath(u,t.responseDataProperty),!0),t.modified.clear(),t.trigger("commitModified"),t.trigger("refresh",r),s(e)):(i.forEach(g=>g.meta.committing=!1),e.exception=r.exception=!0,r.exceptionType="server",t.trigger("exception",r),s(e)),t.trigger("afterRequest",r)}).catch(d=>{i.forEach(u=>u.meta.committing=!1),e.exception=r.exception=!0,d instanceof Response?(e.response=d,r.exceptionType=d.ok?"server":"network",r.response=d,r.error=d.error):(r.exceptionType="server",r.error=d),t.trigger("exception",r),s(e),t.trigger("afterRequest",r)})}):null;return!i.length&&t.modified.count&&t.modified.clear(),n}processReturnedData(e,t,i=!1){const r=this,n=r.modelClass,s=n.fieldMap.id.dataSource;t.forEach((a,o)=>{const l=e[o];l.clearChanges(!0,!1),l.syncId(a[s]),Object.assign(e[o].data,n.processData(a,i,r,l))})}commitRemoved(e){const t=this,i=t.removed,r={action:"delete",params:t.params};return i.count&&t.deleteUrl?new Promise(n=>{e.delete=r,r.body={ids:i.map(o=>o.id)},t.trigger("beforeRequest",r);let s=r.body;if(t.sendAsFormData){const o=new FormData;o.append("id",JSON.stringify(s.ids)),s=o}const a={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(a.method=t.httpMethods.delete),et.post(t.deleteUrl+t.buildQueryString(t.deleteUrl,t.params),s,T.assign(a,t.fetchOptions)).then(o=>{const l=o.parsedJson,d=Array.isArray(l),u=d||l&&l.success!==!1;e.response=o,r.json=l,r.response=o,u?(i.forEach(h=>h.meta.committing=!1),i.clear(),t.trigger("commitRemoved"),t.trigger("refresh",r),n(e)):(i.forEach(h=>h.meta.committing=!1),e.exception=r.exception=!0,r.exceptionType="server",t.trigger("exception",r),n(e)),t.trigger("afterRequest",r)}).catch(o=>{i.forEach(l=>l.meta.committing=!1),e.exception=r.exception=!0,o instanceof Response?(e.response=o,r.exceptionType=o.ok?"server":"network",r.response=o,r.error=o.error):(r.exceptionType="server",r.error=o),t.trigger("exception",r),n(e),t.trigger("afterRequest",r)})}):null}get remoteFilter(){return Boolean(this.filterParamName||this.restfulFilter)}get remoteSort(){return Boolean(this.sortParamName)}}M($t,"$name","AjaxStore");$t._$name="AjaxStore";class $e{static get(e,t){const i=e._domData||(e._domData={});return t!=null?i[t]:i}static remove(e,t){const{_domData:i}=e,r=i?.[t];return i==null||delete i[t],r}static set(e,t,i){arguments.length===3?(e._domData||(e._domData={}))[t]=i:e._domData=t}static assign(e,t){Object.assign(e._domData||(e._domData={}),t)}}$e._$name="DomDataStore";const vu=()=>{throw new Error("Abstract method call!")};class Ei extends P{get type(){return this.constructor.name}undo(){vu()}redo(){vu()}}Ei._$name="ActionBase";const _e=()=>{throw new Error("Abstract method call!")},Ee=()=>{throw new Error("Method cannot be called at this state!")};class zi extends P{canUndo(e){_e()}canRedo(e){_e()}onUndo(e){_e()}onRedo(e){_e()}onStartTransaction(e){_e()}onStopTransaction(e){_e()}onStopTransactionDelayed(e){_e()}onRejectTransaction(e){_e()}onEnable(e){_e()}onDisable(e){_e()}onAutoRecordOn(e){_e()}onAutoRecordOff(e){_e()}onResetQueue(e){_e()}onModelUpdate(e){_e()}onStoreModelAdd(e){_e()}onStoreModelInsert(e){_e()}onStoreModelRemove(e){_e()}onStoreModelRemoveAll(e){_e()}onModelInsertChild(e){_e()}onModelRemoveChild(e){_e()}}zi._$name="StateBase";const De=Symbol("STATE_PROP"),gi=Symbol("STORES_PROP"),pt=Symbol("QUEUE_PROP"),At=Symbol("POS_PROP"),Me=Symbol("TRANSACTION_PROP"),Dt=Symbol("TRANSACTION_TIMER_PROP"),Lt=Symbol("AUTO_RECORD_PROP");Object.freeze([De,gi,pt,At,Me,Dt,Lt]);const mg=new Map,aC=(c,e)=>{mg.set(c,e)},oC=c=>(typeof c=="string"&&(c=mg.get(c)),c);var jt={registerStmState:aC,resolveStmState:oC};const Fa=(c,e)=>{const{undo:t,redo:i}=e;let r;return t&&!i?r={[pt]:c[pt].slice(c.position),[At]:0}:i&&!t?r={[pt]:c[pt].slice(0,c.position)}:r={[pt]:[],[At]:0},[r,()=>{c.notifyStoresAboutQueueReset(e)}]};class lC extends zi{canUndo(){return!1}canRedo(){return!1}onUndo(){Ee()}onRedo(){Ee()}onEnable(e){return e.autoRecord?"autoreadystate":"readystate"}onDisable(){Ee()}onAutoRecordOn(){return{[Lt]:!0}}onAutoRecordOff(){return{[Lt]:!1}}onStartTransaction(){Ee()}onStopTransaction(){Ee()}onStopTransactionDelayed(){Ee()}onRejectTransaction(){Ee()}onResetQueue(e,t){return Fa(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}}const pg=new lC;jt.registerStmState("disabledstate",pg);const dr=Symbol("ACTION_QUEUE_PROP");class Jl extends P{get defaultConfig(){return{title:null}}construct(...e){this[dr]=[],super.construct(...e)}get queue(){return this[dr].slice(0)}get length(){return this[dr].length}addAction(e){this[dr].push(e)}undo(){const e=this[dr];for(let t=e.length-1;t>=0;--t)e[t].undo()}redo(){const e=this[dr];for(let t=0,i=e.length;t<i;++t)e[t].redo()}}Jl._$name="Transaction";class vg extends zi{canUndo(e){return 0<e.position&&e.position<=e.length}canRedo(e){return 0<=e.position&&e.position<e.length}onUndo(e,t){let i=e.position;const r=e[pt],n=Math.max(0,i-t),s=()=>{e.notifyStoresAboutStateRestoringStart();const a=[];for(;i!==n;){const o=r[--i];o.undo(),a.push(o)}return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop({cause:"undo",transactions:a})}]};return[{[De]:"restoringstate",[At]:n},s]}onRedo(e,t){let i=e.position;const r=e[pt],n=Math.min(r.length,i+t),s=()=>{e.notifyStoresAboutStateRestoringStart();const a=[];do{const o=r[i++];o.redo(),a.push(o)}while(i!==n);return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop({cause:"redo",transactions:a})}]};return[{[De]:"restoringstate",[At]:n},s]}onEnable(){Ee()}onDisable(){return"disabledstate"}onAutoRecordOn(){return{[De]:"autoreadystate",[Lt]:!0}}onAutoRecordOff(){Ee()}onStartTransaction(e,t){const i=new Jl({title:t});return[{[De]:"recordingstate",[Me]:i},()=>{e.notifyStoresAboutStateRecordingStart(i)}]}onStopTransaction(){Ee()}onStopTransactionDelayed(){Ee()}onRejectTransaction(){Ee()}onResetQueue(e,t){return Fa(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}}const An=new vg;jt.registerStmState("readystate",An);class yg extends zi{canUndo(){return!1}canRedo(){return!1}onEnable(){}onDisable(e){const t=e[Me];return e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[De]:"disabledstate",[Me]:null}}onAutoRecordOn(e){return[{[De]:"autorecordingstate",[Lt]:!0},()=>{e.stopTransactionDelayed()}]}onAutoRecordOff(){Ee()}onStartTransaction(){Ee()}onStopTransaction(e,t){const i=e[Me],r=e[pt];let n=e[At];return i.length&&(!i.title&&!t&&e.getTransactionTitle?i.title=e.getTransactionTitle(i):t&&(i.title=t),r[n]=i,r.length=++n),[{[De]:"readystate",[At]:n,[Me]:null},()=>{e.notifyStoresAboutStateRecordingStop(i,{stop:!0})}]}onRejectTransaction(e){const t=e[Me];return[{[De]:"restoringstate",[Me]:null},()=>(t.length&&t.undo(),["readystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onStopTransactionDelayed(){Ee()}onResetQueue(e,t){return Fa(e,t)}onModelUpdate(e,t,i,r,n){e[Me].addAction(e.makeModelUpdateAction(t,i,r,n))}onModelInsertChild(e,t,i,r,n,s){e[Me].addAction(e.makeModelInsertChildAction(t,i,r,n,s))}onModelRemoveChild(e,t,i,r){e[Me].addAction(e.makeModelRemoveChildAction(t,i,r))}onStoreModelAdd(e,t,i,r){e[Me].addAction(e.makeStoreModelAddAction(t,i,r))}onStoreModelInsert(e,t,i,r,n,s){e[Me].addAction(e.makeStoreModelInsertAction(t,i,r,n,s))}onStoreModelRemove(e,t,i,r,n){e[Me].addAction(e.makeStoreModelRemoveAction(t,i,r,n))}onStoreRemoveAll(e,t,i,r){e[Me].addAction(e.makeStoreRemoveAllAction(t,i,r))}}const bg=new yg;jt.registerStmState("recordingstate",bg);class dC extends zi{static get $name(){return"RestoringStateClass"}canUndo(){return!1}canRedo(){return!1}onUndo(){Ee()}onRedo(){Ee()}onEnable(){Ee()}onDisable(){Ee()}onAutoRecordOn(){return{[Lt]:!0}}onAutoRecordOff(){return{[Lt]:!1}}onStartTransaction(){Ee()}onStopTransaction(){Ee()}onStopTransactionDelayed(){Ee()}onRejectTransaction(){Ee()}onQueueReset(){Ee()}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}}const Cg=new dC;jt.registerStmState("restoringstate",Cg);class cC extends vg{onAutoRecordOn(){Ee()}onAutoRecordOff(){return{[De]:"readystate",[Lt]:!1}}onStartTransaction(e,t){const i=new Jl({title:t});return[{[De]:"autorecordingstate",[Me]:i},()=>{e.notifyStoresAboutStateRecordingStart(i),e.stopTransactionDelayed()}]}onModelUpdate(e,t,i,r){e.startTransaction(),e.onModelUpdate(t,i,r)}onModelInsertChild(e,t,i,r,n){e.startTransaction(),e.onModelInsertChild(t,i,r,n)}onModelRemoveChild(e,t,i,r){e.startTransaction(),e.onModelRemoveChild(t,i,r)}onStoreModelAdd(e,t,i,r){e.startTransaction(),e.onStoreModelAdd(t,i,r)}onStoreModelInsert(e,t,i,r,n,s){e.startTransaction(),e.onStoreModelInsert(t,i,r,n,s)}onStoreModelRemove(e,t,i,r,n){e.startTransaction(),e.onStoreModelRemove(t,i,r,n)}onStoreRemoveAll(e,t,i,r){e.startTransaction(),e.onStoreRemoveAll(t,i,r)}}const ya=new cC;jt.registerStmState("autoreadystate",ya);class uC extends yg.mixin(he){onDisable(e){const t=e[Me],i=e[Dt];return i&&this.clearTimeout(i),e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[De]:"disabledstate",[Me]:null,[Dt]:null}}onAutoRecordOn(e){Ee()}onAutoRecordOff(e){const t=e[Dt];return t&&this.clearTimeout(t),{[De]:"recordingstate",[Lt]:!1,[Dt]:null}}onStopTransaction(e,t){const i=e[Me],r=e[Dt],n=e[pt];let s=e[At];return r&&this.clearTimeout(r),i.length&&(!i.title&&!t&&e.getTransactionTitle?i.title=e.getTransactionTitle(i):t&&(i.title=t),n[s]=i,n.length=++s),[{[De]:"autoreadystate",[At]:s,[Me]:null,[Dt]:null},()=>{e.notifyStoresAboutStateRecordingStop(i,{stop:!0})}]}onStopTransactionDelayed(e){let t=e[Dt];return t&&this.clearTimeout(t),t=this.setTimeout(()=>{e.stopTransaction()},e.autoRecordTransactionStopTimeout),{[De]:Ql,[Dt]:t}}onResetQueue(e,t){return Fa(e,t)}onRejectTransaction(e){const t=e[Me],i=e[Dt];return i&&this.clearTimeout(i),[{[De]:"restoringstate",[Me]:null,[Dt]:null},()=>(t.length&&t.undo(),["autoreadystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onModelUpdate(e,...t){super.onModelUpdate(e,...t),e.stopTransactionDelayed()}onModelInsertChild(e,...t){super.onModelInsertChild(e,...t),e.stopTransactionDelayed()}onModelRemoveChild(e,...t){super.onModelRemoveChild(e,...t),e.stopTransactionDelayed()}onStoreModelAdd(e,...t){super.onStoreModelAdd(e,...t),e.stopTransactionDelayed()}onStoreModelInsert(e,...t){super.onStoreModelInsert(e,...t),e.stopTransactionDelayed()}onStoreModelRemove(e,...t){super.onStoreModelRemove(e,...t),e.stopTransactionDelayed()}onStoreRemoveAll(e,...t){super.onStoreRemoveAll(e,...t),e.stopTransactionDelayed()}}const Ql=new uC;jt.registerStmState("autorecordingstate",Ql);const yu=Symbol("MODEL_PROP"),bu=Symbol("NEW_DATA_PROP"),Cu=Symbol("OLD_DATA_PROP");class wg extends Ei{static get defaultConfig(){return{model:void 0,newData:void 0,oldData:void 0,isInitialUserAction:!1}}get type(){return"UpdateAction"}get model(){return this[yu]}set model(e){this[yu]=e}get newData(){return this[bu]}set newData(e){this[bu]=F({},e)}get oldData(){return this[Cu]}set oldData(e){this[Cu]=F({},e)}undo(){const{model:e,oldData:t}=this;e.$&&Object.assign(e,t),e.set(t,null,null,null,!0)}redo(){const{model:e,newData:t}=this;e.$&&Object.assign(e,t),e.set(t,null,null,null,!0)}}wg._$name="UpdateAction";const wu=Symbol("PARENT_MODEL_PROP"),Su=Symbol("CHILD_MODELS_PROP"),Du=Symbol("INSERT_INDEX_PROP"),Eu=Symbol("CONTEXT_PROP");class Sg extends Ei{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,insertIndex:void 0,context:void 0}}get type(){return"InsertChildAction"}get parentModel(){return this[wu]}set parentModel(e){this[wu]=e}get childModels(){return this[Su]}set childModels(e){this[Su]=e.slice(0)}get insertIndex(){return this[Du]}set insertIndex(e){this[Du]=e}get context(){return this[Eu]}set context(e){this[Eu]=e}undo(){const{parentModel:e,context:t,childModels:i}=this;i.sort((r,n)=>{const{lhsParent:s,lhsIndex:a}=t.get(r)||{},{rhsParent:o,rhsIndex:l}=t.get(n)||{};return s&&s===o?a-l:0}),i.forEach(r=>{const{parent:n,index:s}=t.get(r)||{};if(n)if(n===e){let a;a=s>r.parentIndex?s+1:s,a=s===n.children.length-1?null:a;const o=n.children[a];n.insertChild(r,o)}else n.insertChild(r,n.children[s]);else e.removeChild(r)})}redo(){const{parentModel:e,insertIndex:t,childModels:i}=this,r=e.children[t];e.insertChild(i,r)}}Sg._$name="InsertChildAction";const xu=Symbol("PARENT_MODEL_PROP"),Ru=Symbol("CHILD_MODELS_PROP"),Tu=Symbol("CONTEXT_PROP");class Dg extends Ei{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,context:void 0}}get type(){return"RemoveChildAction"}get parentModel(){return this[xu]}set parentModel(e){this[xu]=e}get childModels(){return this[Ru]}set childModels(e){this[Ru]=e.slice(0)}get context(){return this[Tu]}set context(e){this[Tu]=e}undo(){const{parentModel:e,context:t,childModels:i}=this;i.sort((r,n)=>{const s=t.get(r),a=t.get(n);return s-a}),i.forEach(r=>{e.insertChild(r,t.get(r))})}redo(){this.parentModel.removeChild(this.childModels)}}Dg._$name="RemoveChildAction";const Mu=Symbol("STORE_PROP"),ku=Symbol("MODEL_LIST_PROP");class Eg extends Ei{static get defaultConfig(){return{store:void 0,modelList:void 0,silent:!1}}get type(){return"AddAction"}get store(){return this[Mu]}set store(e){this[Mu]=e}get modelList(){return this[ku]}set modelList(e){this[ku]=e.slice(0)}undo(){this.store.remove(this.modelList,this.silent)}redo(){this.store.add(this.modelList,this.silent)}}Eg._$name="AddAction";const Iu=Symbol("STORE_PROP"),Fu=Symbol("MODEL_LIST_PROP"),Au=Symbol("INSERT_INDEX_PROP"),Lu=Symbol("CONTEXT_PROP");class xg extends Ei{static get defaultConfig(){return{store:void 0,modelList:void 0,insertIndex:void 0,context:void 0,silent:!1}}get type(){return"InsertAction"}get store(){return this[Iu]}set store(e){this[Iu]=e}get modelList(){return this[Fu]}set modelList(e){this[Fu]=e.slice(0)}get insertIndex(){return this[Au]}set insertIndex(e){this[Au]=e}get context(){return this[Lu]}set context(e){this[Lu]=e}undo(){const{store:e,modelList:t,context:i,silent:r}=this;t.sort((n,s)=>{const a=i.get(n),o=i.get(s);return a!==void 0&&o!==void 0?a-o:0}),t.forEach(n=>{const s=i.get(n);n._undoingInsertion=!0,s!==void 0?e.insert(s,n,r):e.remove(n,r),n._undoingInsertion=!1})}redo(){const e=this;e.store.insert(e.insertIndex,e.modelList,e.silent)}}xg._$name="InsertAction";const Ou=Symbol("STORE_PROP"),Pu=Symbol("MODEL_LIST_PROP"),$u=Symbol("CONTEXT_PROP");class Rg extends Ei{static get defaultConfig(){return{store:void 0,modelList:void 0,context:void 0,silent:!1}}get type(){return"RemoveAction"}get store(){return this[Ou]}set store(e){this[Ou]=e}get modelList(){return this[Pu]}set modelList(e){this[Pu]=e.slice(0)}get context(){return this[$u]}set context(e){this[$u]=e}undo(){const{store:e,context:t,modelList:i,silent:r}=this;i.sort((n,s)=>{const a=t.get(n),o=t.get(s);return a-o}),i.forEach(n=>{const s=t.get(n);e.insert(s,n,r)})}redo(){this.store.remove(this.modelList,this.silent)}}Rg._$name="RemoveAction";const _u=Symbol("STORE_PROP"),Hu=Symbol("ALL_RECORDS_PROP");class Tg extends Ei{static get defaultConfig(){return{store:void 0,allRecords:void 0,silent:!1}}get type(){return"RemoveAllAction"}get store(){return this[_u]}set store(e){this[_u]=e}get allRecords(){return this[Hu]}set allRecords(e){this[Hu]=e.slice(0)}undo(){const{store:e,allRecords:t,silent:i}=this;e.add(t,i)}redo(){this.store.removeAll(this.silent)}}Tg._$name="RemoveAllAction";const hC=(c,e,t,i)=>new wg({model:c,newData:e,oldData:t,isInitialUserAction:i}),fC=(c,e,t,i)=>new Sg({parentModel:c,childModels:t,insertIndex:e,context:i}),gC=(c,e,t)=>new Dg({parentModel:c,childModels:e,context:t}),mC=(c,e,t)=>new Eg({store:c,modelList:e,silent:t}),pC=(c,e,t,i,r)=>new xg({store:c,insertIndex:e,modelList:t,context:i,silent:r}),vC=(c,e,t,i)=>new Rg({store:c,modelList:e,context:t,silent:i}),yC=(c,e,t)=>new Tg({store:c,allRecords:e,silent:t}),Ve=(c,e,...t)=>{const i=c.state,r=e.call(c[De],c,...t);if(typeof r=="string")c[De]=jt.resolveStmState(r);else if(r instanceof zi)c[De]=r;else if(Array.isArray(r)){const[n,s]=r;typeof n=="string"?c[De]=jt.resolveStmState(n):n instanceof zi?c[De]=n:n&&typeof n=="object"&&(c=Object.assign(c,n),c[De]=jt.resolveStmState(c[De])),typeof s=="function"&&Ve(c,s,...t)}else r&&typeof r=="object"&&(c=Object.assign(c,r),c[De]=jt.resolveStmState(c[De]));i!==An&&i!==ya&&r!==An&&r!==ya&&c.trigger("ready")};class Mg extends Ie(P){static get defaultConfig(){return{disabled:!0,autoRecord:!1,autoRecordTransactionStopTimeout:100,makeModelUpdateAction:hC,makeModelInsertChildAction:fC,makeModelRemoveChildAction:gC,makeStoreModelAddAction:mC,makeStoreModelInsertAction:pC,makeStoreModelRemoveAction:vC,makeStoreRemoveAllAction:yC,getTransactionTitle:null}}construct(...e){Object.assign(this,{[De]:An,[gi]:[],[pt]:[],[At]:0,[Me]:null,[Dt]:null,[Lt]:!1}),super.construct(...e)}get state(){return this[De]}get position(){return this[At]}get length(){return this[pt].length}get stores(){return Array.from(this[gi])}hasStore(e){return this[gi].includes(e)}addStore(e){this.hasStore(e)||(this[gi].push(e),e.stm=this)}removeStore(e){this.hasStore(e)&&(this[gi]=this[gi].filter(t=>t!==e),e.stm=null)}forEachStore(e){this[gi].forEach(t=>e(t,t.id))}get disabled(){return this.state===pg}set disabled(e){const t=this;t.disabled!==e&&(e?Ve(t,t.state.onDisable,t):Ve(t,t.state.onEnable,t),t.trigger("stmDisabled",{disabled:e}),t.trigger("disabled",{disabled:e}))}get enabled(){return!this.disabled}enable(){this.disabled=!1}disable(){this.disabled=!0}get isReady(){return this.state===An||this.state===ya}waitForReadiness(){return this.await("ready",!1)}get isRecording(){return this.state===bg||this.state===Ql}get autoRecord(){return this[Lt]}set autoRecord(e){const t=this;t.autoRecord!=e&&(e?Ve(t,t.state.onAutoRecordOn,t):Ve(t,t.state.onAutoRecordOff,t))}startTransaction(e=null){Ve(this,this.state.onStartTransaction,e)}stopTransaction(e=null){Ve(this,this.state.onStopTransaction,e)}stopTransactionDelayed(){Ve(this,this.state.onStopTransactionDelayed)}rejectTransaction(){Ve(this,this.state.onRejectTransaction)}get transaction(){return this[Me]}get queue(){return this[pt].map(e=>e.title)}get isRestoring(){return this.state===Cg}get canUndo(){return this.state.canUndo(this)}get canRedo(){return this.state.canRedo(this)}async undo(e=1){this.isReady||await this.waitForReadiness(),Ve(this,this.state.onUndo,e)}async undoAll(){this.isReady||await this.waitForReadiness(),this.undo(this.length)}async redo(e=1){this.isReady||await this.waitForReadiness(),Ve(this,this.state.onRedo,e)}async redoAll(){this.isReady||await this.waitForReadiness(),this.redo(this.length)}resetQueue(e={undo:!0,redo:!0}){Ve(this,this.state.onResetQueue,e)}resetUndoQueue(){this.resetQueue({undo:!0})}resetRedoQueue(){this.resetQueue({redo:!0})}notifyStoresAboutStateRecordingStart(e){this.forEachStore(t=>{var i;return(i=t.onStmRecordingStart)===null||i===void 0?void 0:i.call(t,this,e)}),this.trigger("recordingStart",{stm:this,transaction:e})}notifyStoresAboutStateRecordingStop(e,t){this.forEachStore(i=>{var r;return(r=i.onStmRecordingStop)===null||r===void 0?void 0:r.call(i,this,e,t)}),this.trigger("recordingStop",{stm:this,transaction:e,reason:t})}notifyStoresAboutStateRestoringStart(){this.forEachStore(e=>{var t;return(t=e.onStmRestoringStart)===null||t===void 0?void 0:t.call(e,this)}),this.trigger("restoringStart",{stm:this})}notifyStoresAboutStateRestoringStop({cause:e,transactions:t}){this.forEachStore(i=>{var r;return(r=i.onStmRestoringStop)===null||r===void 0?void 0:r.call(i,this)}),this.trigger("restoringStop",{stm:this,cause:e,transactions:t})}notifyStoresAboutQueueReset(e){this.forEachStore(t=>{var i;return(i=t.onStmQueueReset)===null||i===void 0?void 0:i.call(t,this,e)}),this.trigger("queueReset",{stm:this,options:e})}onModelUpdate(e,t,i,r){Ve(this,this.state.onModelUpdate,e,t,i,r)}onModelInsertChild(e,t,i,r){Ve(this,this.state.onModelInsertChild,e,t,i,r)}onModelRemoveChild(e,t,i){Ve(this,this.state.onModelRemoveChild,e,t,i)}onStoreModelAdd(e,t,i){Ve(this,this.state.onStoreModelAdd,e,t,i)}onStoreModelInsert(e,t,i,r,n){Ve(this,this.state.onStoreModelInsert,e,t,i,r,n)}onStoreModelRemove(e,t,i,r){Ve(this,this.state.onStoreModelRemove,e,t,i,r)}onStoreRemoveAll(e,t,i){Ve(this,this.state.onStoreRemoveAll,e,t,i)}onUndoKeyPress(e){const t=this;t.enabled&&(e.shiftKey?t.canRedo&&(e.preventDefault(),t.redo()):t.canUndo&&(e.preventDefault(),t.undo()))}stash(){this.transaction&&(this.stashedTransaction=this.transaction,this.rejectTransaction())}applyStash(){this.stashedTransaction&&(this.startTransaction(this.stashedTransaction.title),this.stashedTransaction.redo(),delete this.stashedTransaction)}}Mg._$name="StateTrackingManager";const Nu=Array.prototype.slice,Bu=Object.freeze([]),bC=Object.freeze({}),zu=/[&<]/,{getPrototypeOf:Vu}=Object,{toString:CC}=Object.prototype,{isEqual:ju,isObject:wC}=T,SC={parent:1,elementData:1,ns:1,syncOptions:1},Wu=()=>({ignore:SC,refsFound:new Set}),Uu={class:1,className:1,classname:1},DC={bigint:1,boolean:1,function:1,number:1,string:1,symbol:1},EC={tag:1,html:1,text:1,children:1,tooltip:1,parent:1,nextSibling:1,ns:1,reference:1,elementData:1,retainElement:1,compareHtml:1,syncOptions:1,listeners:1,isReleased:1,null:1,"":1,keepChildren:1},xC=(c,e)=>{const t="className"in e?"className":"class",i=e[t];if(i)if(typeof i=="string"){const r=i.split(" ");r.includes(c)||(r.push(c),e[t]=r.join(" "))}else Array.isArray(i)?i.includes(c)||i.push(c):i.isDomClassList?i.add(c):T.isObject(i)&&(i[c]=1)},RC=(c,e)=>{const t="className"in e?"className":"class",i=e[t];if(i)if(typeof i=="string"){const r=i.split(" ");r.includes(c)&&(r.splice(r.indexOf(c),1),e[t]=r.join(" "))}else Array.isArray(i)?i.includes(c)&&i.splice(i.indexOf(c),1):i.isDomClassList?i.remove(c):T.isObject(i)&&delete i[c]};class Z{static checkEquality(e,t,i,r){if(e===t)return!0;if(e==null)return t==null;if(!e||!t)return!1;const n=typeof e;if(n!==typeof t||DC[n])return!1;let a=i.equalityCache||(i.equalityCache=new Map),o=Boolean(r),l,d,u,h,f,g,m;if(a=a.get(e)||a.set(e,new Map).get(e),l=a.get(t),l===void 0){if(l=!0,Vu(e)!==Vu(t)||e instanceof Node)l=!1;else if(Array.isArray(e)){if(d=e.length,d!==t.length)l=!1;else for(;d-- >0;)if(!Z.checkEquality(e[d],t[d],i,o)){l=!1;break}}else{var p;g=e.syncOptions,h=(p=g)===null||p===void 0?void 0:p.ignoreRefs,h&&(o=!0,r=h!=="children"),u=i.ignore||bC;for(f in t)if(!u[f]&&!(f in e)&&!(r&&f==="reference")){l=!1;break}if(l){if(CC.call(t)==="[object Date]")l=e.getTime()===t.getTime();else for(f in e)if(!u[f]&&!(r&&f==="reference")){if(!(f in t)){l=!1;break}if(m=e[f],!Z.checkEquality(m,t[f],i,o)){l=!1;break}}}}if(!r&&wC(e)&&e.reference){var v;(v=i.refsFound)===null||v===void 0||v.add(e.reference)}a.set(t,l)}return l}static sync(e){const t=e,{refOwner:i}=e,r=i?.byRef,n=Wu();let s=e.affected,a,o,l,d;if(typeof s=="string"&&(s=[s]),e=F(F({},e),{},{checkEqualityOptions:n}),i){if(i.byRef={},s)for(o in r)s.includes(o)||(i.byRef[o]=r[o]);e.refsWas=r}if(t.changed=Z.performSync(e,e.targetElement),i)for(s||(s=Object.keys(r)),a=0;a<s.length;++a)o=s[a],l=r[o],n.refsFound.has(o)||l.retainElement?i.byRef[o]=l:(d=l.lastDomConfig,l.remove(),i.detachRef(o,l,d));return e.targetElement}static performSync(e,t){const{domConfig:i,callback:r}=e,{lastDomConfig:n}=t;if((e.configEquality||Z.checkEquality)(i,n,e.checkEqualityOptions,e.ignoreRefs))r?.({action:"none",domConfig:i,targetElement:t});else return i?(i.onlyChildren||(Z.syncAttributes(i,t,e),Z.syncContent(i,t)),i.keepChildren||Z.syncChildren(e,t)):(t.innerHTML=null,t.syncIdMap=null),t.lastDomConfig=i!=null&&i.onlyChildren&&n?F(F({},n),{},{children:i.children}):i,!0;return!1}static syncDataset(e,t){const{lastDomConfig:i}=t,r=e===i,n=Object.keys(e.dataset),s=i&&i.dataset&&Object.keys(i.dataset),a=W.delta(n,s);let o,l,d,u;for(l=0;l<a.onlyInA.length;l++)o=a.onlyInA[l],u=e.dataset[o],u!=null&&t.setAttribute(`data-${z.hyphenate(o)}`,u);for(l=0;l<a.inBoth.length;l++)o=a.inBoth[l],u=e.dataset[o],(r||u!=i.dataset[o])&&(d=`data-${z.hyphenate(o)}`,u==null?t.removeAttribute(d):t.setAttribute(d,u));for(l=0;l<a.onlyInB.length;l++)t.removeAttribute(`data-${z.hyphenate(a.onlyInB[l])}`)}static addCls(e,t){const{lastDomConfig:i}=t;e=Q.normalize(e,"array"),e.forEach(r=>{t.classList.add(r),xC(r,i)})}static removeCls(e,t){const{lastDomConfig:i}=t;e=Q.normalize(e,"array"),e.forEach(r=>{t.classList.remove(r),RC(r,i)})}static syncClassList(e,t,i){let r=e.className||e.class,n=!1,s,a,o,l,d,u;if(i){for(a=Q.normalize(t,"array"),r=Q.normalize(r,"object"),u=Q.normalize(i.className||i.class,"object"),d=[],o=0,l=a.length;o<l;++o)s=a[o],r[s]||!(s in u)?(u[s]=1,d.push(s)):n=!0;for(s in r)u[s]||(d.push(s),n=!0);if(!n)return;r=d.join(" ")}else r=Q.normalize(r);t.setAttribute("class",r)}static getSyncAttributes(e){const t={},i=[];return e&&Object.keys(e).forEach(r=>{if(!EC[r]){const n=r.toLowerCase();t[n]=e[r],i.push(n)}}),{attributes:t,names:i}}static syncAttributes(e,t,i){const{lastDomConfig:r}=t,n=e===r,s=Z.getSyncAttributes(e),{attributes:a,names:o}=s,{attributes:l,names:d}=n?s:Z.getSyncAttributes(r),{onlyInA:u,onlyInB:h,inBoth:f}=n?{onlyInA:Bu,onlyInB:Bu,inBoth:o}:W.delta(o,d);let g,m;for(m=0;m<u.length;m++){g=u[m];const p=a[g];g==="style"&&p!=null?S.applyStyle(t,p,!0):g==="dataset"?Z.syncDataset(e,t):Uu[g]?Z.syncClassList(e,t):p!=null&&t.setAttribute(g,p)}for(m=0;m<h.length;m++)t.removeAttribute(h[m]);for(m=0;m<f.length;m++){g=f[m];const p=a[g],v=l[g];p==null?t.removeAttribute(g):g==="style"?i.strict?n?Z.syncStyles(t,p):ju(p,v,!0)||Z.syncStyles(t,p,v):(n||!ju(p,v,!0))&&S.applyStyle(t,p,!0):g==="dataset"?Z.syncDataset(e,t):Uu[g]?Z.syncClassList(e,t,i.strict&&t.lastDomConfig):(n||p!==v)&&t.setAttribute(g,p)}}static syncStyles(e,t,i){let r,n,s;if(!i)r=t;else{if(r={},t=S.parseStyle(t),i=S.parseStyle(i),t)for(n in t)s=t[n],i[n]!==s&&(r[n]=s);for(n in i)n in t||(r[n]="")}S.applyStyle(e,r)}static syncContent(e,t){const{html:i,text:r}=e,n=r??i;if(t.didSetTextContent=!1,e.elementData&&(t.elementData=e.elementData),n instanceof DocumentFragment)t.childNodes.length===1&&S.getChildElementCount(t)===0&&n.childNodes.length===1&&S.getChildElementCount(n)===0?S.setInnerText(t,n.firstChild.data):(t.innerHTML="",t.appendChild(n));else if(i!=null&&zu.test(i))t.innerHTML=String(i);else if(n!=null){var s;const{lastDomConfig:a}=t;a!=null&&(s=a.children)!==null&&s!==void 0&&s.length||a!=null&&a.html&&zu.test(t.lastDomConfig.html)?t.innerHTML=n:(S.setInnerText(t,String(n)),t.didSetTextContent=!0)}}static insertTextNode(e,t,i,r,n=null){const s=document.createTextNode(e);t.insertBefore(s,n),r&&(s.$refOwnerId=r.id),i?.({action:"newNode",domConfig:e,targetElement:s})}static insertElement(e,t,i,r,n,s,a){var o;const l=a.ns?document.createElementNS(a.ns,e.tag||"svg"):document.createElement(e.tag||"div");t.insertBefore(l,i),Z.performSync(a,l),s!=null&&(n[s]=l),!e.role&&!e.tabIndex&&!e["aria-hidden"]&&!S.isFocusable(l,!0)&&!l.htmlFor&&l.setAttribute("role","presentation"),r&&(l.$refOwnerId=r.id,s&&(l.$reference=s,r.attachRef(s,l,e))),(o=a.callback)===null||o===void 0||o.call(a,{action:"newElement",domConfig:e,targetElement:l,syncId:s})}static syncChildren(e,t){var i,r;let{domConfig:n,syncIdField:s,callback:a,releaseThreshold:o,configEquality:l,ns:d,refOwner:u,refsWas:h,strict:f,checkEqualityOptions:g,ignoreRefs:m}=e,p=n.syncOptions||{},v=null,y,C,D;if((i=n.html)!==null&&i!==void 0?i:n.text)return;m=Boolean((r=p.ignoreRefs)!==null&&r!==void 0?r:m),m&&(u=h=null),"strict"in p&&(f=p.strict);const w=u?u.byRef:{},E=Nu.call(n.children||[]),R=Nu.call(t.childNodes),x=h||t.syncIdMap||{},k=t.releasedIdMap||{},I=V=>{for(;R.length&&R[0].parentNode!==t;)R.shift();return(V?R.shift():R[0])||null};s=p.syncIdField||s,f=p.strict||f,a=p.callback||a,l=p.configEquality||l,o="releaseThreshold"in p?p.releaseThreshold:o,s&&(t.syncIdMap=w);const A={checkEqualityOptions:g||Wu(),ignoreRefs:m,refOwner:u,refsWas:h,strict:f,syncIdField:s,releaseThreshold:o,callback:a,configEquality:l};for(;E.length;){const V=E.shift();if(D=null,!V)continue;if(S.isReactElement(V)){a({jsx:V,targetElement:t});continue}if(V instanceof Node){C=I(),V!==C&&t.insertBefore(V,C),y=R.indexOf(V),y>-1&&R.splice(y,1);continue}const Y=typeof V=="string";if(A.domConfig=V,A.ns=V.ns||d,!Y){if(u?D=V.reference:s&&V.dataset&&(D=V.dataset[s]),D!=null&&!V.unmatched){const oe=x[D]||k[D];if(oe){const{lastDomConfig:xe}=oe;if(!oe.retainElement){if(Z.performSync(A,oe)){var L;(L=a)===null||L===void 0||L({action:"reuseOwnElement",domConfig:V,targetElement:oe,lastDomConfig:xe,syncId:D})}}V.retainElement&&(oe.retainElement=!0),w[D]=oe,W.remove(R,oe),delete k[D],oe.isReleased=!1,C=I(),(oe.parentNode!==t||f&&oe.nextSibling!==C)&&t.insertBefore(oe,C)}else f?Z.insertElement(V,t,I(),u,w,D,A):(E.push(V),V.unmatched=!0);continue}V.unmatched&&delete V.unmatched}let J=null,X=null,q;for(;!X&&(q=I(!0));){if(u){if(q.$refOwnerId!==u.id)continue;if(q.$reference){if(!f)continue;J=q;break}X=q}else q.retainElement||(X=q);X||(v||(v=[])).push(q)}if(J||!X)Y?Z.insertTextNode(V,t,a,u,J):Z.insertElement(V,t,J,u,w,D,A);else if(!Y&&X.nodeType===Node.ELEMENT_NODE&&(V.tag||"div").toLowerCase()===X.tagName.toLowerCase()){var O,_;const{lastDomConfig:oe}=X,xe=Z.performSync(A,X);if(s&&(oe==null||(O=oe.dataset)===null||O===void 0?void 0:O[s])!=null){const re=oe.dataset[s];delete k[re],delete x[re]}D!=null&&(w[D]=X),X.isReleased=!1,xe&&((_=a)===null||_===void 0||_({action:"reuseElement",domConfig:V,targetElement:X,lastDomConfig:oe,syncId:D}))}else Y&&X.nodeType===Node.TEXT_NODE?X.data=V:(Y?Z.insertTextNode(V,t,a,u,X):Z.insertElement(V,t,X,u,w,D,A),X.remove())}if(!(t.didSetTextContent&&R.length===1&&R[0].nodeType===Node.TEXT_NODE)){for(;C=I(!0);)(!u||C.$refOwnerId===u.id&&!C.$reference)&&(v||(v=[])).push(C);v&&Z.syncChildrenCleanup(t,v,w,a,u,o,s)}}static syncChildrenCleanup(e,t,i,r,n,s,a){let o=0,l;for(const d of t){const{lastDomConfig:u}=d;if(d.nodeType===Element.TEXT_NODE){d.remove();continue}d.retainElement?a&&u&&(i[d.dataset[a]]=d):!n&&a&&(s==null||o<s)?(d.isReleased||(d.className="b-released",d.isReleased=!0,u!=null&&u.dataset&&(e.releasedIdMap||(e.releasedIdMap={}),e.releasedIdMap[u.dataset[a]]=d),r?.({action:"releaseElement",domConfig:u,lastDomConfig:u,targetElement:d}),u&&(u.isReleased=!0,u.className&&(u.className="b-released"),u.class&&(u.class="b-released"),u.style&&(u.style=null))),o++):(d.remove(),n&&(l=d.$reference,l&&n.detachRef(l,d,u)),e.releasedIdMap&&a&&u!==null&&u!==void 0&&u.dataset&&delete e.releasedIdMap[u.dataset[a]],r?.({action:"removeElement",domConfig:d.lastDomConfig,lastDomConfig:d.lastDomConfig,targetElement:d}))}}static removeChild(e,t){if(e.contains(t)){const i=e.syncIdMap;if(i){const r=Object.values(i).indexOf(t);r>-1&&delete i[Object.keys(i)[r]]}e.removeChild(t)}}static addChild(e,t,i){e.appendChild(t),e.syncIdMap||(e.syncIdMap={}),e.syncIdMap[i]=t}static getChild(e,t){const i=String(t).split(".");for(const s of i){var r,n;if(e=(r=e)===null||r===void 0||(n=r.syncIdMap)===null||n===void 0?void 0:n[s],!e)return null}return e}}Z._$name="DomSync";class mt{static init(){const e=["fullscreenEnabled","requestFullscreen","exitFullscreen","fullscreenElement"],t=s=>e.map(a=>{let o=s+z.capitalize(a);return s==="moz"&&(o=o.replace("screen","Screen"),"mozCancelFullScreen"in document&&a==="exitFullscreen"&&(o="mozCancelFullScreen")),o});this.functions="fullscreenEnabled"in document&&e||"webkitFullscreenEnabled"in document&&t("webkit")||"mozFullScreenEnabled"in document&&t("moz")||"msFullscreenEnabled"in document&&t("ms")||[];const i=["fullscreenchange","fullscreenerror"],r=["MSFullscreenChange","MSFullscreenError"],n=s=>i.map(a=>s+z.capitalize(a));this.events="fullscreenEnabled"in document&&i||"webkitFullscreenEnabled"in document&&n("webkit")||"mozFullscreenEnabled"in document&&n("moz")||"msFullscreenEnabled"in document&&r||[]}static get enabled(){return Boolean(this.functions[0]&&document[this.functions[0]])}static async request(e){return this.functions[1]&&e?.[this.functions[1]]()}static async exit(){return this.functions[2]&&document[this.functions[2]]()}static get isFullscreen(){return!!this.element}static get element(){return this.functions[3]&&document[this.functions[3]]}static onFullscreenChange(e){this.events[0]&&document.addEventListener(this.events[0],e)}static unFullscreenChange(e){this.events[0]&&document.removeEventListener(this.events[0],e)}}mt.init();mt._$name="Fullscreen";let Jo=null;const Qo=[],TC=c=>{var e;return c.nodeType===c.ELEMENT_NODE&&((e=c.ownerDocument.defaultView)===null||e===void 0?void 0:e.getComputedStyle(c).getPropertyValue("position"))==="absolute"};class Ne{static addResizeListener(e,t){const i=this;if((e===document||e===globalThis)&&(e=document.body),e.nodeType===e.DOCUMENT_FRAGMENT_NODE&&(e=e.host),e.classList.contains("b-resize-monitored")||(e.classList.add("b-resize-monitored"),e._bResizemonitor={handlers:[]}),e===document.body)i.hasWindowResizeListener||(globalThis.addEventListener("resize",i.onWindowResize),i.hasWindowResizeListener=!0);else if(globalThis.ResizeObserver)i.resizeObserver||(i.resizeObserver=new ResizeObserver(i.onElementResize)),i.resizeObserver.observe(e);else{e.classList.add("b-no-resizeobserver");const[r,n,s]=S.createElement({parent:e,className:"b-resize-monitors",children:[{className:"b-resize-monitor-expand"},{className:"b-resize-monitor-shrink"}]},{returnAll:!0});n.scrollLeft=n.scrollTop=s.scrollLeft=s.scrollTop=1e6,n.addEventListener("scroll",i.onSizeMonitorScroll,!0),s.addEventListener("scroll",i.onSizeMonitorScroll,!0),(t.targetMutationMonitor=new MutationObserver(a=>{const o=[],l=[];for(const u of a)u.type==="childList"&&(o.push.apply(o,u.addedNodes),l.push.apply(l,u.removedNodes));const d=[...o.filter(u=>!l.includes(u)),...l.filter(u=>!o.includes(u))];d.length!==0&&(d.length>0&&d.every(TC)||n.dispatchEvent(new CustomEvent("scroll",{bubbles:!1})))})).observe(e,{childList:!0,subtree:!0}),t.monitorElement=r}e._bResizemonitor.handlers.push(t)}static removeResizeListener(e,t){if(e){(e===document||e===globalThis)&&(e=document.body);const i=e._bResizemonitor;let r=0;i&&i.handlers&&(W.remove(i.handlers,t),r=i.handlers.length),r||(e.classList.remove("b-resize-monitored"),this.resizeObserver?this.resizeObserver.unobserve(e):(t.monitorElement&&(t.monitorElement.remove(),t.monitorElement=null),t.targetMutationMonitor&&t.targetMutationMonitor.disconnect()))}}static onElementResize(e){for(const t of e){const i=t.target,r=i._bResizemonitor,n=t.contentRect||i.getBoundingClientRect();if(vi(i)&&(!r.rectangle||n.width!==r.rectangle.width||n.height!==r.rectangle.height)){const s=r.rectangle;r.rectangle=n;for(const a of r.handlers)a(i,s,n)}}}static onSizeMonitorScroll(e){var t;if((t=document.body)!==null&&t!==void 0&&t.contains(e.target)){e.stopImmediatePropagation();const i=e.target.parentNode,r=i.parentNode,n=r._bResizemonitor,s=r.getBoundingClientRect();(!n.rectangle||s.width!==n.rectangle.width||s.height!==n.rectangle.height)&&(Qo.push([r,n.rectangle,s]),n.rectangle=s,Jo||(Jo=requestAnimationFrame(Ne.fireResizeEvents))),i.firstChild.scrollLeft=i.firstChild.scrollTop=i.childNodes[1].scrollTop=i.childNodes[1].scrollLeft=1e6}}static onWindowResize(e){const t=document.body,i=t._bResizemonitor,r=i.rectangle;i.rectangle=document.documentElement.getBoundingClientRect();for(const n of i.handlers)n(t,r,i.rectangle)}static fireResizeEvents(){for(const e of Qo)for(const t of e[0]._bResizemonitor.handlers)e[0].offsetParent&&t.apply(this,e);Jo=null,Qo.length=0}static removeGlobalListeners(){globalThis.removeEventListener("resize",this.onWindowResize)}}Ne._$name="ResizeMonitor";const Yu={auto:"auto",true:"auto",false:"hidden","hidden-scroll":"auto",clip:K.supportsOverflowClip?"clip":"hidden"},Gu="b-widget-scroller",el={block:"nearest"},qu=Promise.resolve(),Ku=c=>new Promise(e=>B.on({element:c===document.documentElement?window:c,scroll:e,once:!0})),MC={x:1},zs={auto:1,scroll:1},kC={true:1,auto:1},IC={overflowX:"auto",overflowY:"auto"},FC=c=>{let e,t,i,r;if(!c)e=t=i=r=0;else if(typeof c=="number")e=t=i=r=c;else{var n,s,a,o;e=(n=c.top)!==null&&n!==void 0?n:0,t=(s=c.bottom)!==null&&s!==void 0?s:0,i=(a=c.start)!==null&&a!==void 0?a:0,r=(o=c.end)!==null&&o!==void 0?o:0}return{top:e,bottom:t,start:i,end:r}};class Ke extends he(Ie(P)){static get configurable(){return{widget:null,element:{$config:{nullify:!0},value:null},contentElement:{$config:{nullify:!0},value:null},overflowX:null,overflowY:null,translate:null,x:0,y:0,rtlSource:null}}static get delayable(){return{onScrollEnd:{type:"buffer",delay:100}}}get isRTL(){var e;return Boolean((e=this.rtlSource)===null||e===void 0?void 0:e.rtl)}syncOverflowState(){const e=this,{element:t}=e,i=new Q(t.classList),r=e.hasOverflowX=t.scrollWidth>t.clientWidth,n=e.hasOverflowY=t.scrollHeight>t.clientHeight;i.value=t.classList,(i.toggle("b-horizontal-overflow",r)||i.toggle("b-vertical-overflow",n))&&(S.syncClassList(t,i),e.isConfiguring||e.trigger("overflowChange",{x:r,y:n}))}hasOverflow(e="y"){const t=this[`overflow${e.toUpperCase()}`],i=this[`overflow${e==="y"?"x":"y"}`];if(!S.scrollBarWidth||!kC[t]||i==="hidden-scroll"||K.isFirefox){const r=e==="y"?"Height":"Width";return this[`scroll${r}`]>this[`client${r}`]}else return this[`hasOverflow${e.toUpperCase()}`]}hasScrollbar(e="y"){const{element:t}=this;if(t&&S.scrollBarWidth){const i=e==="y",r=i?"Width":"Height",n=t[`client${r}`],s=parseInt(S.getStyleValue(t,`border${i?"Left":"Top"}Width`))+parseInt(S.getStyleValue(t,`border${i?"Right":"Bottom"}Width`)),a=t[`offset${r}`]-s-n;return Math.abs(a-S.scrollBarWidth)<2}}addPartner(e,t=MC){const i=this;typeof t=="string"&&(t={[t]:1}),i.partners||(i.partners={}),i.partners[e.id]={scroller:e,axes:t},t.x&&(e.x=i.x),t.y&&(e.y=i.y),e.isPartneredWith(i)||e.addPartner(i,t)}eachPartner(e){const{partners:t}=this;t&&Object.values(t).forEach(e)}removePartner(e){this.isPartneredWith(e)&&(delete this.partners[e.id],e.removePartner(this))}isPartneredWith(e){var t;return Boolean((t=this.partners)===null||t===void 0?void 0:t[e.id])}clearPartners(){this.partners&&Object.values(this.partners).forEach(e=>e.scroller.removePartner(this))}async scrollIntoView(e,t=el){const i=this,{isRectangle:r}=e,n=r?e:$.from(e),{xDelta:s,yDelta:a}=i.getDeltaTo(e,t),o=i.scrollBy(s,a,t);return(t.highlight||t.focus)&&o.then(()=>{r&&(e=n.translate(-s,-a)),t.highlight&&(isNaN(t.highlight)?(i.widget||i).callback(t.highlight,null,[e]):S.highlight(e,i)),t.focus&&S.focusWithoutScrolling(e)}),o}static async scrollIntoView(e,t=el,i=!1){const r=$.from(e),n=typeof t=="object"?t.animate:t,s=Ke._globalScroller||(Ke._globalScroller=new Ke),a=[];s.rtlSource={rtl:i};let o=0,l=0,d;for(let u=e.parentNode;u.nodeType===Node.ELEMENT_NODE;u=u.parentNode){if(u===document.body&&u!==document.scrollingElement)continue;const h=u===document.scrollingElement?IC:u.ownerDocument.defaultView.getComputedStyle(u);if(t.y!==!1&&zs[h.overflowY]&&u.scrollHeight>u.clientHeight||t.x!==!1&&zs[h.overflowX]&&u.scrollWidth>u.clientWidth){s.element=u,s.positionDirty=!0;const{xDelta:f,yDelta:g}=s.getDeltaTo(r,t);(f||g)&&(a.push({element:u,x:u.scrollLeft,y:u.scrollTop,xDelta:f,yDelta:g}),r.translate(-f,-g),o+=f,l+=g)}}if(a.length){const u=Math.abs(o),h=Math.abs(l);let f=n&&(typeof n=="number"?n:typeof n.duration=="number"?n.duration:300);if(f&&(u>10||h>10))Math.max(u,h)<50&&(f=Math.min(f,500)),d=s.scrollAnimation=ve.animate(f,g=>{const m=g===1;for(const{element:p,x:v,y,xDelta:C,yDelta:D}of a)s.element=p,C&&(s.x=Math[i?"min":"max"](v+(m?C:Math.round(C*g)),0)),D&&(s.y=Math.max(y+(m?D:Math.round(D*g)),0))},null,n.easing),d.then(()=>{s.scrollAnimation=null});else{for(const{element:g,xDelta:m,yDelta:p}of a)g.scrollTop+=p,g.scrollLeft+=m;d=Ku(a[a.length-1].element)}}else d=qu;return(t.highlight||t.focus)&&d.then(()=>{t.highlight&&(isNaN(t.highlight)?s.callback(t.highlight,null,[e]):S.highlight(e,s)),t.focus&&e.focus()}),d}async scrollBy(e=0,t=0,i=el){const r=this,n=typeof i=="object"?i.animate:i,s=Math.abs(e),a=Math.abs(t);r.scrollAnimation&&(r.scrollAnimation.cancel(),r.scrollAnimation=null),(e||t)&&(r.silent=i.silent);let o=n&&(typeof n=="number"?n:typeof n.duration=="number"?n.duration:300);if(o&&(s>10||a>10)){const{x:l,y:d}=r;let u=l,h=d;return Math.max(s,a)<50&&(o=Math.min(o,500)),r.scrollAnimation=ve.animate(o,f=>{const g=f===1;if(e){if(r.x!==u&&!i.force){var m;return(m=r.scrollAnimation)===null||m===void 0?void 0:m.cancel()}r.x=Math.max(l+(g?e:Math.round(e*f)),0)}if(t){if(r.y!==h&&!i.force){var p;return(p=r.scrollAnimation)===null||p===void 0?void 0:p.cancel()}r.y=Math.max(d+(g?t:Math.round(t*f)),0)}u=r.x,h=r.y},r,n.easing),r.element.classList.add("b-scrolling"),r.scrollAnimation.then(()=>{r.isDestroyed||(r.element.classList.remove("b-scrolling"),r.scrollAnimation=null)}),r.scrollAnimation}else{if(e|t){const l=r.x,d=r.y;if(r.x+=e,r.y+=t,r.x!==l||r.y!==d)return Ku(r.element)}return qu}}async scrollTo(e,t,i){const{x:r,y:n}=this,s=e==null?0:e-r,a=t==null?0:t-n;return this.scrollBy(s,a,i)}doDestroy(){var e;const t=this;if(t._element){var i;t._element.removeEventListener("scroll",t.scrollHandler),(i=t.wheelListenerRemover)===null||i===void 0||i.call(t)}(e=t.scrollAnimation)===null||e===void 0||e.cancel(),Object.values(t.partners||{}).forEach(({scroller:r})=>r.removePartner(t)),super.doDestroy()}onElMutation(e){const t=this,[i,r]=S.getTranslateXY(t.element);if(t._x!==-i||t.y!==-r){const n=new CustomEvent("scroll",{bubbles:!0});Object.defineProperty(n,"target",{get:()=>t.element}),t.onScroll(n)}}onElResize(){const e=this,{widget:t}=e;t!=null&&t.isAnimating?t.findListener("animationend","onElResize",e)===-1&&t.ion({animationEnd:"onElResize",thisObj:e,once:!0}):e.syncOverflowState()}onScroll(e){const t=this,{_x:i,_y:r,element:n}=t;let s=0;t.overflowX==="clip"&&n.scrollLeft!==i&&(n.scrollLeft=i,++s),t.overflowY==="clip"&&n.scrollTop!==r&&(n.scrollTop=r,++s),s!==2&&(!t.widget||!t.widget.isDestroyed)&&(t.positionDirty=!0,n.classList.contains("b-scrolling")||n.classList.add("b-scrolling"),e.widget=t.widget,t.silent||t.trigger("scroll",e),t.syncPartners(),t.controllingPartner=null,t.onScrollEnd(e))}syncPartners(e,t){const i=this;i.partners&&Object.values(i.partners).forEach(({axes:r,scroller:n})=>{(n!==i.controllingPartner||e)&&n.sync(i,r)&&t&&n.syncPartners(e,t)})}onScrollEnd(e){const t=this;t.silent&&(t.silent=!1),t.trigger("scrollEnd",e),t.controllingPartner=null,t.element.classList.remove("b-scrolling")}getDeltaTo(e,t){const i=this;if(!i.viewport)return{xDelta:0,yDelta:0};const{x:r,y:n,scrollWidth:s,scrollHeight:a,isRTL:o}=i,l=e instanceof $?e:$.from(e),d=t.block||"nearest",u=i.viewport,h=FC(t.edgeOffset),f=u.width>=l.width+(h.start+h.end)?h:{start:0,end:0},g=u.height>=l.height+(h.top+h.bottom)?h:{top:0,bottom:0},m=new $(o?u.right- -r-s:u.x-r,u.y-n,s,a),p=l.clone().adjust(-f.start,-g.top,f.end,g.bottom).constrainTo(m),v=p.clone(),y=i.isRTL?-1:1;let C=0,D=0;if(d==="start")v.moveTo(u.x+(i.isRTL?u.width:0),u.y),C=p.x-v.x,D=p.y-v.y;else if(d==="end")i.isRTL?v.moveTo(u.left+(i.isRTL?v.width:0),u.y):v.translate(u.right-v.right,u.bottom-v.bottom),C=p.x-v.x,D=p.y-v.y;else if(d==="center"){const w=u.center;v.moveTo(w.x-v.width/2,w.y-v.height/2),C=C||p.x-v.x,D=D||p.y-v.y}else v.width>u.width?C=v.x-u.x:v.right>u.right?C=v.right-u.right:v.x<u.x&&(C=v.x-u.x),v.height>u.height?D=v.y-u.y:v.bottom>u.bottom?D=v.bottom-u.bottom:v.y<u.y&&(D=v.y-u.y);return C=y*Math.round(C),D=Math.round(D),{xDelta:t.x===!1?0:Math.max(Math.min(C,i.maxX-r),-r),yDelta:t.y===!1?0:Math.max(Math.min(D,i.maxY-n),-n)}}get viewport(){return $.client(this.element)}updateWidget(e){this.rtlSource=this.owner=e}updateElement(e,t){const i=this;if(i===Ke._globalScroller){i._element=e,i.positionDirty=!0;return}const r=i.scrollHandler||(i.scrollHandler=i.onScroll.bind(i)),n=i.resizeHandler||(i.resizeHandler=i.onElResize.bind(i));if(t){if(i.translate){var s;(s=i.mutationObserver)===null||s===void 0||s.disconnect(t)}else t.removeEventListener("scroll",r),t.classList.remove(Gu),t.style.overflowX=t.style.overflowY="";Ne.removeResizeListener(t,n)}if(e){if(i.translate){if(i.mutationObserver||(i.mutationObserver=new MutationObserver(i.mutationHandler||(i.mutationHandler=i.onElMutation.bind(i)))),i._x=i._y=0,document.contains(e)){const[a,o]=S.getTranslateXY(e);i._x=-a,i._y=-o}i.mutationObserver.observe(e,{attributes:!0})}else e.addEventListener("scroll",r),e.classList.add(Gu);Ne.addResizeListener(e,n),i.widget||(i.rtlSource={get rtl(){return S.getStyleValue(e,"direction")==="rtl"}}),i.isRTL&&e.classList.add("b-rtl"),i.positionDirty&&(i.updateOverflowX(i.overflowX),i.updateOverflowY(i.overflowY)),i.syncOverflowState(),i.isConfiguring&&(i._x&&i.updateX(i._x),i._y&&i.updateY(i._y))}i.positionDirty=!0}get x(){const e=this,{element:t}=e;if(t&&e.positionDirty){if(e.translate){const[i,r]=S.getTranslateXY(t);e._x=-i,e._y=-r}else e._x=Math.abs(t.scrollLeft),e._y=t.scrollTop;e.positionDirty=!1}return e._x}get scrollLeft(){return this.element.scrollLeft}changeX(e){if(e=Math.max(e,0),!this.isConfiguring||e)return e;this._x=e}updateContentElement(e){e&&(e=typeof e=="string"?this.element.querySelector(e):e,Ne.addResizeListener(e,this.resizeHandler))}updateX(e){var t;const{element:i}=this;i&&!((t=this.widget)!==null&&t!==void 0&&t.isConfiguring)&&(e=Math.round(e),this.trigger("scrollStart",{x:e}),this.translate?S.setTranslateX(i,-e):i.scrollLeft=this.isRTL?-e:e),this.positionDirty=!0}sync(e,t){const i=this,{x:r,y:n}=t;let s=!1;return r!=null&&i.x!==e.x&&(i.controllingPartner=e,i.x=e.x,s=!0),n!=null&&i.y!==e.y&&(i.controllingPartner=e,i.y=e.y,s=!0),s}get y(){const e=this,{element:t}=e;if(t&&e.positionDirty){if(e.translate){const[i,r]=S.getTranslateXY(t);e._x=-i,e._y=-r}else e._x=t.scrollLeft,e._y=t.scrollTop;e.positionDirty=!1}return e._y}changeY(e){if(!this.isConfiguring||e)return e;this._y=e}updateY(e){const{element:t,widget:i}=this;t&&!(i!=null&&i.isConfiguring)&&(this.trigger("scrollStart",{y:e}),this.translate?S.setTranslateY(t,-e):t.scrollTop=e),this.positionDirty=!0}get maxX(){return this.scrollWidth-this.clientWidth}get maxY(){return this.scrollHeight-this.clientHeight}get lastScrollLeft(){return(this.scrollWidth-this.clientWidth)*(this.isRTL?-1:1)}updateOverflowX(e,t){const i=this,{element:r,translate:n}=i,{style:s,classList:a}=r;t==="hidden-scroll"&&a.remove("b-hide-scroll"),e==="hidden-scroll"&&!n&&(zs[s.overflowY]?(e="hidden",i.enableWheel()):a.add("b-hide-scroll")),n||(s.overflowX=Yu[e]||e),i.isConfiguring||(i.positionDirty=!0,i.syncOverflowState())}updateOverflowY(e,t){const i=this,{element:r,translate:n}=i,{style:s,classList:a}=r;t==="hidden-scroll"&&a.remove("b-hide-scroll"),e==="hidden-scroll"&&!n&&(zs[s.overflowX]?(e="hidden",i.enableWheel()):a.add("b-hide-scroll")),n||(s.overflowY=Yu[e]||e),i.isConfiguring||(i.positionDirty=!0,i.syncOverflowState())}enableWheel(){this.wheelListenerRemover||(this.wheelListenerRemover=B.on({element:this.element,wheel:"onWheel",thisObj:this}))}onWheel(e){Math.abs(e.deltaX)>Math.abs(e.deltaY)&&this.overflowX==="hidden-scroll"?this.x+=e.deltaX:this.overflowY==="hidden-scroll"&&(this.y+=e.deltaY)}get scrollWidth(){var e,t;return(e=(t=this.element)===null||t===void 0?void 0:t.scrollWidth)!==null&&e!==void 0?e:0}set scrollWidth(e){const t=this,{element:i,isRTL:r}=t;let n=t.widthStretcher;n&&e==null?(n.remove(),t.widthStretcher=null):e&&(e=Math.abs(e),n||(n=t.widthStretcher=S.createElement({className:"b-scroller-stretcher b-horizontal-stretcher",retainElement:!0})),n.style.transform=`translateX(${(e-1)*(r?-1:1)}px)`,i&&!i.contains(n)&&i.insertBefore(n,i.firstElementChild)),t.propagate!==!1&&t.eachPartner(({scroller:s})=>{s.propagate=!1,s.scrollWidth=e,delete s.propagate}),t.positionDirty=!0,t.syncOverflowState()}get scrollHeight(){var e,t;return(e=(t=this.element)===null||t===void 0?void 0:t.scrollHeight)!==null&&e!==void 0?e:0}set scrollHeight(e){const t=this,i=t.stretcher||(t.stretcher=S.createElement({className:"b-scroller-stretcher"}));i.style.transform=`translateY(${e-1}px)`,t.element&&t.element.lastChild!==i&&t.element.appendChild(i),t.positionDirty=!0,t.syncOverflowState()}get clientWidth(){var e;return((e=this.element)===null||e===void 0?void 0:e.clientWidth)||0}get clientHeight(){var e;return((e=this.element)===null||e===void 0?void 0:e.clientHeight)||0}get id(){return this._id||(this.widget?this._id=`${this.widget.id}-scroller`:this._id=Or.generateId("scroller-")),this._id}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(),delete e.widget,delete e.element}}Ke._$name="Scroller";class ed{constructor(e){this.promise=new Promise((t,i)=>{this.resolve=t,this.reject=i}),e&&e(this)}}ed._$name="Promissory";const{defineProperty:tl}=Reflect;class Vi extends P.mixin(Kt,Ie,he,jn){static get configurable(){return{element:null}}static get delayable(){return{refreshDom:"raf"}}static get identifiable(){return{}}static get renderConfigs(){const e=this,t=e.$meta;let i=t.renderConfigs,r,n;if(i===void 0){i=null,r=t.configs;for(n in r)r[n].render&&(i||(i=new Set)).add(n);t.renderConfigs=e.prototype.$renderConfigs=i}return i}construct(...e){this.$iid=++Vi.$idSeed,this.byRef={},super.construct(...e),this.onDraw!==Vi.prototype.onDraw&&this.initDrawable()}startConfigure(e){this.element=this.renderContext.renderDom(),super.startConfigure(e)}get element(){return this.refreshDom.flush(),this._element}changeElement(e,t){const i=this;return t&&t.remove(),e&&(e.id=i.id,e=S.createElement(e,{refOwner:i})),e}updateId(e,t){const i=this;if(t){const r=i.element;r.id=e,i.fixRefOwnerId(r,e,t)}}get classes(){return this.element.classList}fixRefOwnerId(e,t,i){if(e.$refOwnerId===i){e.$refOwnerId=t;const r=e.$reference;r&&(e.id=`${t}-${r}`);for(const n of e.childNodes)this.fixRefOwnerId(n,t,i)}}onConfigChange({name:e}){!this.isConfiguring&&this.$renderConfigs.has(e)&&this.refreshDom()}attachRef(e,t,i){const r=this,n="_"+e,{listeners:s}=i;n in r||tl(r,e,{get(){return r.refreshDom.flush(),r[n]},set(a){r[n]=a}}),t.id=`${r.id}-${e}`,r.byRef[e]=t,r[e]=t,s&&(i.listeners={on:s,un:B.on(Object.assign({element:t,thisObj:r},s))})}detachRef(e,t,i){i.listeners&&(i.listeners.un(),i.listeners=null),this[e]=null,delete this.byRef[e]}renderDom(){return{}}get renderContext(){const e=this,t=e.$meta,i=e.constructor;let r=t.renderConfigs||i.renderConfigs,n=e;if(!r){n=Object.create(e),r=new Set;for(const s in t.configs)tl(n,s,{get(){return r.add(s),e[s]}});n.renderDom=()=>e.renderDom.call(n),e.$renderConfigs=r}return tl(e,"renderContext",{value:n}),n}refreshDom(){Z.sync({targetElement:this.element,domConfig:this.renderContext.renderDom(),refOwner:this,strict:!0})}onListen(e){e==="draw"&&this.initDrawable()}initDrawable(){const e=this;if(!e.intersector){let t=Object.values(e.byRef).find(i=>i.classList.contains("b-drawable"));t||(t=e.element,t.classList.add("b-drawable")),e.intersector=new IntersectionObserver(i=>{e.isDestroyed||i.forEach(r=>{r.isIntersecting&&e.onDraw({count:++e.drawCounter})})}),e.intersector.observe(t)}}onDraw(e){this.trigger("draw",e)}}Vi.$idSeed=0;Object.assign(Vi.prototype,{drawCounter:0,hasGeneratedId:!1,intersector:null});Vi._$name="Renderable";class ze extends Vi{construct(e){if(e){let r=e.element,n;r&&(ae.deprecate("Core","4.0.0",'Mask "element" config has been renamed to "target"'),e=n=Object.assign({},e),delete n.element,n.target=r),r=e.target,typeof r=="string"&&(e=n=n||Object.assign({},e),n.target=e.owner[r])}super.construct(e);const t=this,{type:i}=t;t.target||(t.target=document.body),t.maskName=`mask${typeof i=="string"?i.trim():""}-${ze.counter++}`,t.show()}doDestroy(){const e=this,{element:t}=e;if(e.type==="trial")return!1;t&&(e.element=null,e.mode.endsWith("blur")&&S.forEachChild(t,i=>{i.classList.remove(`b-masked-${e.mode}`)}),e.target.classList.remove("b-masked"),e.target[e.maskName]=null,W.remove(ze.masks,e)),super.doDestroy()}get maskElement(){return this.element}set error(e){this.setConfig(this.errorDefaults),this.text=e}renderDom(){const e=this,{maxProgress:t}=e;return{class:{"b-mask":1,"b-delayed-show":e.showDelay,"b-widget":1,[`b-mask-${e.mode}`]:1,"b-progress":t,"b-prevent-transitions":!e.useTransition},children:[{reference:"maskContent",class:"b-mask-content b-drawable",children:[t?{reference:"progressElement",class:"b-mask-progress-bar",style:{width:`${Math.max(0,Math.min(100,Math.round(e.progress/t*100)))}%`}}:null,{reference:"maskText",class:"b-mask-text",html:(e.icon?`<i class="b-mask-icon ${e.icon}"></i>`:"")+e.text}]}]}}static mergeConfigs(...e){const t={};for(const i of e)typeof i=="string"?t.text=i:T.assign(t,i);return t}static mask(e,t=document.body){return ze.new({target:t},typeof e!="string"?F({},e):{text:e})}static unmask(e=document.body){const t=this.getElementMasks(e);return t.length>0?t[t.length-1].close():null}static unmaskAll(e=document.body){return this.getElementMasks(e).forEach(t=>t.close())}static getElementMasks(e){return this.masks.filter(t=>t.target===e)}updateAutoClose(e){this.deferredClose.cancel(),e&&(this.deferredClose.delay=e,this.deferredClose())}updateCover(){this.syncCover()}syncCover(){var e,t;(e=this.owner)===null||e===void 0||(t=e.syncMaskCover)===null||t===void 0||t.call(e,this)}onOwnerResize(){this.syncCover()}updateOwner(e){this.detachListeners("cover"),e?.ion({name:"cover",recompose:"onOwnerResize",resize:"onOwnerResize",thisObj:this})}updateShowDelay(e){const{delayedShow:t}=this;t.delay=e,e||t.flush()}deferredClose(){var e;const{owner:t}=this;this.close().then(()=>{var i;t==null||(i=t.onMaskAutoClose)===null||i===void 0||i.call(t,this)}),t==null||(e=t.onMaskAutoClosing)===null||e===void 0||e.call(t,this)}delayedShow(){this.classes.remove("b-delayed-show")}show(){const e=this,{element:t,target:i,hiding:r,maskName:n}=e;r&&(r.resolve(),e.hiding=null,e.clearTimeout("hide")),e.showDelay&&(t.classList.add("b-delayed-show"),e.delayedShow()),t.classList.add("b-visible"),t.classList.remove("b-hidden"),i.classList.add("b-masked"),i[n]||(i[n]=e,i.appendChild(t)),W.include(ze.masks,e),e.shown=!0,e.trigger("show"),e.mode.endsWith("blur")&&S.forEachChild(i,s=>{s!==t&&s.classList.add(`b-masked-${e.mode}`)})}hide(){const e=this,{target:t,element:i}=e;let{hiding:r}=e;if(!r){if(!e.shown)return Promise.resolve();e.hiding=r=new ed,e.shown=!1,i.classList.remove("b-visible"),i.classList.add("b-hidden"),t.classList.remove("b-masked"),e.mode.endsWith("blur")&&S.forEachChild(t,n=>{n!==i&&n.classList.remove(`b-masked-${e.mode}`)}),r.promise=r.promise.then(()=>{e.hiding===r&&(e.hiding=null)}),e.setTimeout(()=>r.resolve(),500,"hide")}return r.promise}async close(){await this.hide(),this.destroy()}}M(ze,"$name","Mask");M(ze,"type","mask");M(ze,"configurable",{autoClose:null,cover:null,icon:"b-icon b-icon-spinner",errorDefaults:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},maxProgress:null,mode:"dark",progress:null,owner:{$config:"nullify",value:null},target:null,text:null,type:null,showDelay:null,useTransition:!1});M(ze,"delayable",{deferredClose:0,delayedShow:0,syncCover:{type:"throttle",delay:100}});M(ze,"counter",0);M(ze,"masks",[]);ze._$name="Mask";var AC=c=>{var e;return e=class extends(c||P){get widgetClass(){}get keyMapElement(){return this.element}get keyMapSubComponents(){return this.features}performKeyMapAction(i){const{keyMap:r}=this;let n=!1;if(r&&!i.handled&&i.key!==void 0){const a=T.keys(r).find(o=>{const l=o.split("+"),d=l.includes("Alt"),u=l.includes("Shift"),h=l.includes("Ctrl");let f=l[l.length-1].toLowerCase();return f==="space"&&(f=" "),f===i.key.toLowerCase()&&(!i.altKey&&!d||i.altKey&&d)&&(!i.ctrlKey&&!h||i.ctrlKey&&h)&&(!i.shiftKey&&!u||i.shiftKey&&u)});if(r[a]){const o=W.asArray(r[a]);i.fromKeyMap=!0;let l;for(let d of o){if(l=!0,T.isObject(d)){if(!d.handler)continue;d.preventDefault===!1&&(l=!1),d=d.handler}if(typeof d=="string"){var s;const{thisObj:u,handler:h}=this.resolveKeyMapAction(d);if(((s=u.isActionAvailable)===null||s===void 0?void 0:s.call(u,a,d,i))!==!1&&h.call(u,i)!==!1){n=!0;break}}else if(d.call(this)!==!1){n=!0;break}}delete i.fromKeyMap,n&&(l&&i.preventDefault(),i.handled=!0)}}return n}resolveKeyMapAction(i){const{keyMapSubComponents:r}=this;if(r&&i.includes(".")){const[n,s]=i.split(".");if(n&&s)return{thisObj:r[n],handler:r[n][s]}}return{thisObj:this,handler:this[i]}}updateKeyMap(i){var r;(r=this.keyMapDetacher)===null||r===void 0||r.call(this),T.isEmpty(i)||(this.keyMapDetacher=B.on({element:this.keyMapElement,keydown:"keyMapOnKeyDown",thisObj:this}))}keyMapOnKeyDown(i){this.performKeyMapAction(i)}mergeKeyMaps(i,r,n=null){const s={};i&&T.assign(s,i);for(const a in r){if(!r[a])continue;const o=W.asArray(i?.[a]),l=[];o!=null&&o.length&&l.push(...o);for(const d of W.asArray(r[a]))T.isObject(d)&&d.handler?l.push(T.assignIf({handler:(n?n+".":"")+d.handler},d)):l.push((n?n+".":"")+d);l.sort((d,u)=>{const h=(d.weight||0)-(u.weight||0);return h===0&&o!==null&&o!==void 0&&o.length?o.indexOf(d)-o.indexOf(u):h}),s[a]=l}return s}},M(e,"$name","KeyMap"),M(e,"configurable",{keyMap:{value:null,$config:{merge:"objects",nullify:!0}}}),e},LC=c=>{var e;return e=class extends(c||P){get widgetClass(){}updateRtl(i){const{element:r}=this;r&&(r.classList.toggle("b-rtl",i===!0),r.classList.toggle("b-ltr",i===!1))}startConfigure(i){var r;if((r=super.startConfigure)===null||r===void 0||r.call(this,arguments),!i.floating&&i.rtl==null){var n;const s=this,a=i.rootElement||i.forElement||((n=s.parent)===null||n===void 0?void 0:n.contentElement)||(s.floating?s.floatRoot:s.changeElementRef(s.getRenderContext(i)[0]||i.adopt||document.body)),o=i.owner||i.parent||s.constructor.fromElement(a);o?i.rtl=o[o.isConfiguring?"peekConfig":"getConfig"]("rtl"):i.rtl=a?.nodeType===1&&getComputedStyle(a).getPropertyValue("direction")==="rtl",i.rtl&&(s.configDone.rtl=!1)}}render(...i){var r;if(super.render&&super.render(...i),(K.isChrome&&K.chromeVersion<87||K.isFirefox&&K.firefoxVersion<66||K.isSafari&&K.safariVersion<14.1)&&this.element.classList.add("b-legacy-inset"),getComputedStyle(this.element).direction==="rtl"||(r=this.owner)!==null&&r!==void 0&&r.rtl){var n;this.rtl=!0,(n=this.childItems)===null||n===void 0||n.forEach(s=>s.rtl=!0)}}},M(e,"$name","RTL"),M(e,"configurable",{rtl:null}),e};const Xu=Object.freeze({highlight:!1,onlyName:!1}),fn=[],il="highlightExternalChange",rl=/transparent|rgba\(0,\s*0,\s*0,\s*0\)/,OC={INPUT:1,TEXTAREA:1},nl=(c,e,t,i)=>{var r;let n=t?.listeners||t?.internalListeners;if(n=((r=n)===null||r===void 0?void 0:r.ion)||n,n){const s=B.on(T.assign({element:e,thisObj:c},n));i?(c._refListeners||(c._refListeners=Object.create(null)))[i]=s:t.listeners={on:n,un:s}}},Zu=(c,e)=>c&&e&&e[T.keys(c)[0]]?pe.merge(c,e):c,PC=c=>{c.isVisible&&c.triggerPaint()},$C=/^:not\((.+)\)$/,_C=/absolute|fixed/i,HC=c=>c.scale!=null,{hasOwnProperty:cr}=Object.prototype,{defineProperty:Ju}=Reflect,Qu=c=>parseFloat(c)*(c.endsWith("ms")?1:1e3),eh=["b-aligned-above","b-aligned-right","b-aligned-below","b-aligned-left"],NC={configurable:!0,get(){return!1}},Vs=/(?:L\{([^}.]+)\})/,BC=(c,e)=>"L{Tooltip."+e+"}",th=/^([trblc])(\d*)-([trblc])(\d*)$/i,zC=(c,e)=>(th.test(c)&&(c={align:c}),th.test(e)&&(e={align:e}),pe.merge(c,e)),VC=/^[\w.]+$/;class N extends P.mixin(Kt,Ie,he,jn,ai,AC,LC){static mergeCls(e,t){return t&&e?e=new Q(t).assign(typeof e=="string"?new Q(e):e):e&&!e.isDomClassList&&(e=new Q(e)),e}static get $name(){return"Widget"}static get type(){return"widget"}static get configurable(){return{element:!0,callOnFunctions:!0,id:"",html:null,content:null,cls:{$config:{merge:"classList"},value:null},ui:{$config:{merge:"classList"},value:null},collapsify:null,contentElementCls:{$config:{merge:"classList"},value:null},defaultCls:{$config:{merge:"classList"},value:null},dock:null,forwardTwinEvents:{$config:{merge:"classList"},value:null},parent:null,tab:null,elementAttributes:null,htmlCls:{$config:{merge:"classList"},value:{"b-html":1}},style:null,disabled:null,readOnly:{value:null,default:!1,$config:null},ignoreParentReadOnly:null,adopt:null,appendTo:null,insertBefore:null,insertFirst:null,dataset:null,tooltip:{$config:["lazy","nullify"],value:null},showTooltipWhenDisabled:!0,preventTooltipOnTouch:null,monitorResize:{$config:["lazy","nullify"],value:null},masked:{$config:"nullify",value:null},maskDefaults:{target:"element"},cache:{},floating:null,positioned:null,draggable:null,align:{$config:{merge:zC},value:"t-b"},centered:null,constrainTo:void 0,anchor:null,owner:null,scrollAction:null,hideAnimation:{$config:{merge:Zu},value:null},showAnimation:{$config:{merge:Zu},value:null},x:null,y:null,scrollable:{$config:["lazy","nullify"],value:null},scrollerClass:Ke,defaultBindProperty:"html",defaultAction:null,overflowable:{value:null,default:!0,$config:null},width:null,height:null,maxHeight:null,maxWidth:null,minWidth:null,minHeight:null,scaleToFitWidth:null,allowGrowWidth:!0,margin:null,flex:null,weight:null,alignSelf:null,ripple:null,title:null,localizableProperties:["title","ariaLabel","ariaDescription"],requireSize:!1,ref:null,hidden:null,textAlign:null,ignoreScrollDuration:500,tag:"div",recomposeAsync:null,rootElement:null,htmlMutationObserver:{$config:["lazy","nullify"],value:{childList:!0,subtree:!0}},role:{$config:"lazy",value:"presentation"},ariaLabel:{$config:"lazy",value:null},ariaDescription:{$config:"lazy",value:null},ariaElement:"element",ariaHasPopup:null,realignTimeout:300,testConfig:{ignoreScrollDuration:100,realignTimeout:50}}}static get prototypeProperties(){return{hasGeneratedId:!1,innerItem:!0}}static get declarable(){return["renderConfigs"]}static get delayable(){return{recompose:"raf",doHideOrRealign:"raf",onAlignConstraintChange:"raf"}}static get factoryable(){return{defaultType:"widget"}}static get identifiable(){return{}}static get all(){return super.all}static get recomposeAsync(){return N._recomposeAsync}static set recomposeAsync(e){if(N._recomposeAsync=e,e!=null){const{all:t}=N;for(let i=0;i<t.length;++i)t[i].isComposable&&(t[i].recomposeAsync=e)}}isType(e,t){return N.isType(this,e,t)}static setupRenderConfigs(e,t){let{renderConfigs:i}=e,r;if(i){const n=t.getInherited("renderConfigs",!1)||Object.create(null);if(Array.isArray(i)){for(r=0;r<i.length;++r)n[i[r]]=!0;i=n}else i=Object.assign(n,i)}t.renderConfigs=i}construct(e={},...t){const i=this,{domSyncCallback:r}=i;i.configureAriaDescription=e.ariaDescription,i._isAnimatingCounter=0,i.alignConstrained=0,i.byRef=Object.create(null),i.onTargetResize=i.onTargetResize.bind(i),i.onFullscreenChange=i.onFullscreenChange.bind(i),i.domSyncCallback=r.$nullFn?null:r.bind(i),i._isUserAction=!1,super.construct(e,...t);const{recomposeAsync:n}=N;n!=null&&i.recomposeAsync==null&&(i.recomposeAsync=n),i.finalizeInit()}startConfigure(e){super.startConfigure(e);const t=this,{adopt:i,element:r}=t;i&&(t.adoptElement(r,i,e.id),t.updateElement(t._element,r))}finalizeInit(){const e=this;(e.insertBefore||e.appendTo||e.insertFirst||e.adopt)&&e.render()}doDestroy(){const e=this,{preExistingElements:t,element:i,_refListeners:r}=e;if(r&&(Object.values(r,o=>o()),e._refListeners=null),i){var n,s,a;const o=!e._tooltip&&e._rootElement&&((n=N.Tooltip)===null||n===void 0?void 0:n.getSharedTooltip(e._rootElement,!0));if(o?.owner===e&&(o.owner=null,o.hide()),e.onExitFullscreen(),e.clearTimeout(e.scrollListenerTimeout),e.clearTimeout(e.resizeListenerTimeout),e.removeTransientListeners(),e.floating||e.positioned?e.hide(!1):e.revertFocus(),Ne.removeResizeListener(i.parentElement,e.onParentElementResize),Ne.removeResizeListener(i,e.onElementResize),e.adopt){for(let l=Array.from(i.childNodes),d=0,{length:u}=l;d<u;d++){const h=l[d];!t.includes(h)&&h!==e.floatRoot&&h.remove()}i.className=e.adoptedElementClassName,i.style.cssText=e.adoptedElementCssText}else i.remove();(s=e.dragEventDetacher)===null||s===void 0||s.call(e),(a=e.dragOverEventDetacher)===null||a===void 0||a.call(e),e.dragGhost.remove()}super.doDestroy()}get assignValueDefaults(){return Xu}get valueName(){return this.name||this.ref||this.id}getValueName(e){return e=e&&typeof e=="object"?e.onlyName:e,e?this.name:this.valueName}assignFieldValue(e,t,i){const r=this,n=r.defaultBindProperty;n in r&&(r[n]=i)}assignValue(e,t){t=t||Xu;const i=this,r=i[il],n=i.getValueName(t);n&&(!e||n in e)&&(t.highlight===!1&&(i[il]=!1),i.assignFieldValue(e,n,e?e[n]:null),i[il]=r)}gatherValue(e){const t=this,i=t.defaultBindProperty;t.constructor!==N&&i in t&&(e[t.name||t.ref||t.id]=t[i])}gatherValues(e){this.eachWidget(t=>t.gatherValue(e),!1)}get forwardTwinEvents(){const e=this._forwardTwinEvents;return e&&T.getTruthyKeys(e)}configureOverflowTwin(e){var t;const i=this;let r=T.clone(i.initialConfig);return delete r.id,r.hidden=!1,r.type=i.type,r._overflowTwinOrigin=i,r.disabled=i.disabled,"value"in i&&(r.value=i.value),(t=i.forwardTwinEvents)===null||t===void 0||t.forEach(n=>{delete r[`on${z.capitalize(n)}`]}),e&&(r=typeof e=="function"?e(r)||r:T.assign(r,e)),r}createOverflowTwin(e){var t;const i=this,r=i.configureOverflowTwin(e),n=N.create(r);return(t=i.forwardTwinEvents)===null||t===void 0||t.forEach(s=>{n.ion({[s]:a=>{i.overflowTwin===a.source&&(a=T.assign({},a),delete a.source,i.trigger(a.type,a))}})}),n}ensureOverflowTwin(e,t){let{overflowTwin:i}=this;return i||(this.overflowTwin=i=this.createOverflowTwin(e),t?.(i)),i}get isComposable(){return!this.compose.$nullFn}adoptElement(e,t,i){const r=this,n=typeof t=="string"?document.getElementById(t):t,s=N.fromElement(n);s&&s.adopt&&s!==r&&(typeof s.adopt=="string"?document.getElementById(s.adopt):s.adopt)===n&&s.destroy(),r.preExistingElements=Array.from(n.childNodes),r.adoptedElementClassName=n.className,r.adoptedElementCssText=n.style.cssText,n.id&&!i&&(r.id=e.id=n.id),S.syncAttributes(e,n);for(let d=0,{length:u}=e.childNodes;d<u;d++)n.appendChild(e.childNodes[0]);delete r._contentRange,r._element=n;const a=e.lastDomConfig,o=a?.listeners;if(o&&r.isComposable){var l;(l=o.un)===null||l===void 0||l.call(o),nl(r,n,a)}n.lastDomConfig=a||n.lastDomConfig,n.$refOwnerId=r.id,r.scaleToFitWidth||r.getConfig("monitorResize")}addRefAccessor(e,t){const{prototype:i}=this.constructor;Ju(i,t,{writable:!0,value:null}),Ju(i,e,{get(){return this.recompose.flush(),this[t]},set(r){this[t]=r}})}attachRef(e,t,i){const r=this,n="_"+e;t.dataset&&(t.dataset.ownerCmp=r.id),r.isComposable&&(n in r||r.addRefAccessor(e,n),nl(r,t,i,e)),r.byRef[e]=t,r[e]=t}detachRef(e,t,i){const r=this,n=r._refListeners;n!=null&&n[e]&&(n[e](),delete n[e]),r[e]=null,delete r.byRef[e]}afterRecompose(){}compose(){return{class:Q.normalize(this.widgetClassList,"object")}}doCompose(){const e=this,{$meta:t}=e,i=t.hierarchy;let{composers:r}=t,n=null,s,a,o,l,d,u;if(e.recompose.suspend(),!r){for(o=!0,t.composers=r=[],l=i.indexOf(N);l<i.length;++l)d=i[l].prototype,cr.call(d,"compose")&&r.push(d);(u=t.getInherited("renderConfigs",!1))||(u=Object.create(null),e.configObserver={get(h){u[h]=!0}}),t.$renderConfigs=u}for(l=0;l<r.length;++l)s=r[l].compose.call(e,n),n=n?S.merge(n,s):s;return cr.call(e,"compose")&&(s=e.compose)&&(s=s.call(e,n),S.merge(n,s)),o&&delete e.configObserver,S.normalizeChildren(n,(h,f)=>{f&&(a="_"+h,a in e||e.addRefAccessor(h,a))})}get element(){return this.isComposable&&!this.isDestroying&&this.recompose.flush(),this._element}domSyncCallback(e){}changeElement(e){const t=this,i=t.isComposable;return i&&(e=t.doCompose()),typeof e=="string"?e=S.createElementFromTemplate(e):T.isObject(e)?(e=S.createElement(e,{refOwner:t,callback:t.domSyncCallback}),t.recompose.resume(),i&&nl(t,e,e.lastDomConfig)):S.isReactElement(t.peekConfig("html"))?e=document.createElement("div"):e.nodeType!==1&&(e=S.createElementFromTemplate(t.template(t))),e.id=t.id,t.elementAttributes&&S.setAttributes(e,t.elementAttributes),e}updateElement(e){const t=this,{className:i}=e,{contentElement:r,contentElementCls:n,isComposable:s}=t,a=r!==e,o=!s&&e.querySelectorAll("[data-reference]"),l=s?[]:t.widgetClassList;let d=(a||!s)&&t.uiClasses;if(i&&l.unshift(i),t._hidden&&l.push("b-hidden"),t._readOnly&&l.push("b-readonly"),ve.noThrow(e,"remove"),d?(n!=null&&n.value&&(d=d.slice(),d.push(n.value)),d=d.join(" ")):d=n?.value,d&&(a?r.className+=" "+d:l.push(d)),!t.parent){const{defaultCls:u}=t,{outerCls:h}=N;l.push(...u?h.filter(f=>!(f in u)||u[f]):h)}if(e.className=l.join(" "),o)for(let u,h=0;h<o.length;++h)u=o[h],t.attachRef(u.getAttribute("data-reference"),u),u.removeAttribute("data-reference");!t.adopt&&!t.scaleToFitWidth&&t.getConfig("monitorResize"),t.getConfig("role"),t.getConfig("ariaLabel"),t.getConfig("ariaDescription"),t._html&&t.getConfig("htmlMutationObserver"),t.trigger("elementCreated",{element:e})}updateAriaDescription(e){const{ariaElement:t}=this,i=`${this.id}-aria-desc-el`;if(e){const r=this._ariaDescEl||(this._ariaDescEl=S.createElement({className:"b-aria-desc-element",id:i,parent:t}));r.innerText=e.match(Vs)?this.L(e,this):e,t.setAttribute("aria-describedBy",r.id)}else t.getAttribute("aria-describedby")===i&&t.removeAttribute("aria-describedBy")}updateAriaLabel(e){S.setAttributes(this.ariaElement,{"aria-label":e!=null&&e.match(Vs)?this.L(e,this):e})}updateAriaHasPopup(e){S.setAttributes(this.ariaElement,{"aria-haspopup":e})}updateRole(e){if(e){var t;(t=this.ariaElement)===null||t===void 0||t.setAttribute("role",e)}else{var i;(i=this.ariaElement)===null||i===void 0||i.removeAttribute("role")}}get ariaElement(){this.getConfig("element");const{_ariaElement:e}=this;return e.nodeType===Node.ELEMENT_NODE?e:T.getPath(this,e)}isCollapsified(e,t){const{collapsify:i}=this;let r=!t;return i==null?r=t?e:!e:i==="overlay"&&(r=t),Boolean(r)}async recompose(){const e=this,t={targetElement:e.element,domConfig:e.doCompose(),refOwner:e,callback:e.domSyncCallback,strict:!0};if(e.transitionRecompose){if(e.isTransitioningDom=!0,await S.transition(T.assign({element:e.element,action(){Z.sync(t)}},e.transitionRecompose)),e.isDestroyed)return;e.isTransitioningDom=!1,e.trigger("transitionedRecompose")}else Z.sync(t);t.changed&&(e.afterRecompose(),e.trigger("recompose")),e.recompose.resume()}changeElementRef(e){if(typeof e=="string"){const t=e;if(!(e=document.getElementById(t)))throw new Error(`No element found with id '${t}'`)}return e}changeAppendTo(e){return this.changeElementRef(e)}updateAppendTo(e){!this.isConfiguring&&e&&this.render()}changeInsertBefore(e){return this.changeElementRef(e)}updateInsertBefore(e){!this.isConfiguring&&e&&this.render()}changeInsertFirst(e){return this.changeElementRef(e)}updateInsertFirst(e){!this.isConfiguring&&e&&this.render()}getRenderContext(e=this,t){let i=t||e.appendTo,{insertFirst:r,insertBefore:n}=e;return r&&(i=r,n=i.firstChild),n&&(i||(i=n.parentElement)),[i,n||void 0]}render(e,t=!0){const i=this,{element:r}=i,[n,s]=i.getRenderContext(i,e);i.emptyCache(),i.syncElement&&i.currentElement?S.sync(r,i.currentElement):(n?.insertBefore(r,s),i.currentElement=r),N.fromElement(r.parentElement)&&r.classList.remove(...N.outerCls),super.render(n,t),i.rendered=!0,i.getConfig("role"),t&&(i.getConfig("contentRange"),i.triggerPaint()),i.setupFocusListeners()}template({tag:e,html:t,htmlCls:i,name:r}){var n;const s=this;typeof t=="string"&&VC.test(t)&&s.resolveCallback(t,s,!1)&&(t=s.callback(t,s,[s]));const a=(n=t)!==null&&n!==void 0&&n.call?t.call(s,s):t;return`<${e} class="${a?i:""}" ${r?`data-name="${r}"`:""}>${a||""}</${e}>`}updateRecomposeAsync(e){this.recompose.immediate=!e}onConfigChange({name:e}){var t;this._element&&!this.isDestroying&&(t=this.$meta.$renderConfigs)!==null&&t!==void 0&&t[e]&&this.recompose()}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.parent}getConfigValue(e,t){return e==="style"?this._style:super.getConfigValue(e,t)}getCurrentConfig(e){const t=super.getCurrentConfig(e);return e?.depth>0&&(t.type=this.type),t}get dataset(){return this.element.dataset}changeDataset(e){Object.assign(this.dataset,e)}get dragGhost(){return this.constructor._dragGhost||(this.constructor._dragGhost=S.createElement({html:"\xA0",style:"position:absolute;top:-10000em;left:-10000em"}))}updateParent(e){const{_element:t}=this;t&&t.classList[e?"remove":"add"](...N.outerCls)}get constrainTo(){var e;let t=this._constrainTo;if(t=t===void 0?globalThis:((e=t)===null||e===void 0?void 0:e.nodeType)===Node.DOCUMENT_FRAGMENT_NODE?t.host||t.ownerDocument:t,this.positioned){const{offsetParent:i}=this.element;if(i&&S.getStyleValue(i,"overflow")==="hidden")t=$.from(i).moveTo(0,0);else if(t&&!t.isRectangle){const r=t===document||t===globalThis;t=$.from(t,i),r&&t.translate(globalThis.pageXOffset,globalThis.pageYOffset)}}return t}updateCentered(e){const{element:t,_anchorElement:i}=this;if(e&&!this.floating&&!this.positioned)throw new Error("`centered` is only relevant when a Widget is `floating` or `positioned`");e?(t.classList.add("b-centered"),t.style.transform=t.style.left=t.style.top="",i?.classList.add("b-hide-display"),t.classList.remove("b-anchored")):t.classList.remove("b-centered")}get contentElement(){return this.element}get contentRange(){const e=this,{contentElement:t}=e,i=e._contentRange||(e._contentRange=new Range);return i.collapsed&&(i.setStart(t,e.contentRangeStartOffset||0),i.setEnd(t,e.contentRangeEndOffset||t.childNodes.length)),i}fixRefOwnerId(e,t,i){if(e.$refOwnerId===i){e.$refOwnerId=t;for(let{childNodes:r}=e,n=r.length;n-- >0;)this.fixRefOwnerId(r[n],t,i)}}get placement(){const e=this,{element:t}=e;let i,r,n;if(t!=null&&t.offsetParent&&!_C.test(S.getStyleValue(t,"position"))){const a=t.nextElementSibling,o=t.previousElementSibling,l=!a&&o;if(r=S.getStyleValue(t.parentElement,"flex-direction"),r)r=r.startsWith("row")?"h":"v";else{var s;i=(s=a||o)===null||s===void 0?void 0:s.getBoundingClientRect(),n=i&&t.getBoundingClientRect(),r=i&&Math.abs(i.top-n.top)<Math.abs(i.left-n.left)?"h":"v"}r+=r==="h"?l?"r":"l":l?"b":"t"}return r}updateId(e,t){if(super.updateId(e,t),t){const{byRef:i,element:r}=this;for(const n in i)i[n].dataset&&(i[n].dataset.ownerCmp=e);r.id=e,this.fixRefOwnerId(r,e,t)}}get style(){const{element:e}=this;return e?.ownerDocument.defaultView.getComputedStyle(e)||this._style}updateStyle(e){this.element&&S.applyStyle(this.element,e)}updateTitle(e){this.titleElement&&(this.titleElement.innerHTML=e)}beforeAlignTo(e){}alignTo(e){var t;const i=this,{lastAlignSpec:r,element:n}=i,{offsetParent:s,style:a,classList:o}=n;if(r&&(r.monitorIntersection&&i.intersectionObserver.unobserve(r.target),isFinite(r.zone)&&n.classList.remove(eh[r.zone])),!e){i.removeTransientListeners(),i.anchor=i.lastAlignSpec=null;return}i.beforeAlignTo(e),(e.nodeType===Element.ELEMENT_NODE||e.isWidget||e.$$name==="Point")&&(e={target:e}),i.releaseSizeConstraints();const{scrollable:l,constrainTo:d}=i,u=i.positioned&&S.getStyleValue(n,"position")!=="fixed",h=i.scale||1,f=e.target,g=f&&(f.isRectangle?f:f.element||f),m=$.from(n,u?s:null,!0),{width:p,height:v}=m,y=g&&g.nodeType===Element.ELEMENT_NODE;e=e.realignTarget?e:T.assign({aligningToElement:y,constrainTo:d,align:"b-t",axisLock:i.axisLock,anchor:i.anchor},i.align,e);const C=e.minWidth||i.minWidth,D=e.minHeight||i.minHeight;if(m.isAlignRectangle=!0,C&&(m.minWidth=C*h),D&&(m.minHeight=D*h),i.lastAlignSpec=e,y&&(i.lastAlignSpec.target=g),y&&vi(g instanceof SVGElement?g.closest("svg"):g)){if(e=Object.setPrototypeOf({},e),e.target=i.lastAlignSpec.targetRect=e.realignTarget||(e.allowTargetOut?$.from(g,u?s:null,!u):S.isInView(g,!1,i)),!e.target){const _=i.hide();return i.isDestroyed||(i.lastAlignSpec.targetOutOfView=!0),_}e.target.height=Math.max(e.target.height,1),e.target.width=Math.max(e.target.width,1),i.lastAlignSpec.anchoredTo=g}e.anchor&&(e.anchorSize=i.anchorSize,n.contains(i.anchorPathElement)||n.appendChild(i.anchorElement)),i.isAligning=!0,i.trigger("beforeAlign",e),i.isAligning=!1,e.rtl=i.rtl,(e.align.includes("s")||e.align.includes("e"))&&(i.rtl?e.align=e.align.replace(/s/g,"r").replace(/e/g,"l"):e.align=e.align.replace(/s/g,"l").replace(/e/g,"r"));const w=m.alignTo(e);let{align:E,anchor:R,x,y:k,width:I,height:A,overlap:L}=w;if(i.lastAlignSpec.zone=w.zone,A!=v&&("configuredHeight"in i||(i.configuredHeight=a.height),i.height=A/h,i.alignConstrained=i.alignConstrained|1,l&&(l.overflowY=!0)),I!=p&&("configuredWidth"in i||(i.configuredWidth=a.width),i.width=I/h,i.alignConstrained=i.alignConstrained|2,l&&(l.overflowX=l.clientWidth>l.scrollWidth)),E&&i.alignConstrained){e.align=E;const _=$.from(n,u?s:null,!0).alignTo(e);R=_.anchor,x=_.x,k=_.y,I=_.width,A=_.height}if(i.centered||i.setXY(x,k),!w.overlap&&isFinite(w.zone)&&o.add(eh[w.zone]),(t=R)!==null&&t!==void 0&&t.edge){var O;const{edge:_}=R,{anchorElement:V}=i,Y=$.from(n),J=[];_==="top"||_==="bottom"?(J[0]=R.x,J[1]=_==="top"?1:Y.height-1):(J[0]=_==="left"?1:Y.width-1,J[1]=R.y);let X=S.childFromPoint(n,...J);if((O=X)!==null&&O!==void 0&&O.matches(":hover,:focus")&&n.compareDocumentPosition(X)&Node.DOCUMENT_POSITION_CONTAINED_BY&&(X=X.parentNode),X&&X!==document){let q=S.getStyleValue(X,"background-color");for(;q.match(rl)&&S.getStyleValue(X,"position")!=="absolute"&&(X=X.parentNode,X!==document);)q=S.getStyleValue(X,"background-color");q.match(rl)?i.anchorPathElement.setAttribute("fill",i.defaultAnchorBackgroundColor):i.anchorPathElement.setAttribute("fill",q)}V.classList.remove("b-hide-display"),V.style.transform="",V.className=`b-anchor b-anchor-${_}`,R.x&&(R.x/=h),R.y&&(R.y/=h),S.setTranslateXY(V,R.x,R.y),o.add("b-anchored")}else i._anchorElement&&(i.anchorElement.classList.add("b-hide-display"),o.remove("b-anchored"));if(!y){a.pointerEvents="none";const _=S.elementFromPoint(x,k);i.owns(_)||(i.lastAlignSpec.anchoredTo=_),a.pointerEvents=""}if((i.scrollAction==="realign"&&y||i.scrollAction==="hide")&&!i.documentScrollListener&&(i.clearTimeout(i.scrollListenerTimeout),e.monitorTargetMutation&&!i.targetObserver&&(i.targetObserver||(i.targetObserver=new MutationObserver(i.onTargetParentMutation.bind(i)))).observe(S.getRootElement(g),{childList:!0,attributes:!0,subtree:!0}),i.scrollListenerTimeout=i.setTimeout(()=>{var _;const V=(_=g.getRootNode)===null||_===void 0?void 0:_.call(g);i.documentScrollListener=B.addListener(document,"scroll","doHideOrRealign",{capture:!0,thisObj:i}),V!=null&&V.mode&&(i.targetRootScrollListener=B.addListener(V,"scroll","doHideOrRealign",{capture:!0,thisObj:i}))},i.scrollAction==="hide"?i.ignoreScrollDuration:0)),y&&(e.monitorResize&&!i.targetResizeListener&&(Ne.addResizeListener(g,i.onTargetResize),i.targetResizeListener=!0),e.monitorIntersection&&!(L||g.contains(n)||g.ownerSVGElement)&&i.intersectionObserver.observe(g)),!K.isAndroid&&!i.constrainListeners){const _=d!=null&&d.isRectangle?globalThis:d;i.clearTimeout(i.resizeListenerTimeout),i.resizeListenerTimeout=i.setTimeout(()=>{i.constrainListeners=!0,Ne.addResizeListener(_||globalThis,i.onAlignConstraintChange)},i.ignoreScrollDuration)}}onTargetParentMutation(e){const{element:t,lastAlignSpec:i}=this;i!=null&&i.aligningToElement&&(yr(i.target)?e.some(({target:r})=>r.contains(i.target)&&!t.contains(r))&&this.realign():this.hide())}get intersectionObserver(){return this._intersectionObserver||(this._intersectionObserver=new IntersectionObserver(this.onTargetIntersectionchange.bind(this),{root:K.isSafari?this.rootElement:this.rootElement.ownerDocument}))}onTargetIntersectionchange(e){if(!this.isDestroyed){const t=e[e.length-1];t.isIntersecting||this.onAlignTargetOutOfView(t.target)}}onTargetResize(){const{lastAlignSpec:e}=this;if(e){const{width:t,height:i}=e.targetRect,{width:r,height:n}=e.target.getBoundingClientRect();(r!==t||n!==i)&&this.onAlignConstraintChange(...arguments)}}onAlignTargetOutOfView(e){this.hide(),this.lastAlignSpec&&(this.lastAlignSpec.targetOutOfView=!0)}onAlignConstraintChange(e,t,{height:i}){const{style:r}=this.contentElement,{overflowY:n}=r;this.setTimeout(this.realign,50),t&&i>t.height&&(r.overflowY="hidden",this.requestAnimationFrame(()=>r.overflowY=n))}realign(){const e=this,{lastAlignSpec:t}=e;if((e.floating||e.positioned)&&t&&e.isVisible){if(t.aligningToElement){const i=t.target.contains(this.element),r=S.isInView(t.target,!1,e);if(!t.allowTargetOut&&(!vi(t.target)||!r)){e.hide(),e.isDestroyed||(e.lastAlignSpec.targetOutOfView=!0);return}t.realignTarget=i?null:r}S.addTemporaryClass(e.element,"b-realigning",e.realignTimout,e),e.alignTo(t)}}rectangle(e,t,i){return this.rectangleOf("element",e,t,i)}rectangleOf(e,t,i,r){var n;return typeof t!="string"?(r=i,i=t,t=""):t==="border"&&(t=""),typeof i=="boolean"&&(r=i,i=void 0),e!=="element"&&i===void 0&&(i=this.element),i=(n=i)!==null&&n!==void 0&&n.isWidget?i.element:i,$[t||"from"](this[e],i,r)}releaseSizeConstraints(){const e=this,t=e.scrollable;e.alignConstrained&1&&(e.height=e.configuredHeight,t&&(t.overflowY=t.config.overflowY)),e.alignConstrained&2&&(e.width=e.configuredWidth,t&&(t.overflowX=t.config.overflowX)),e.alignConstrained=0}toFront(){const{element:e}=this,t=this.floating?this.floatRoot:this.positioned?e?.parentNode:null;if(e!=null&&e.nextSibling){const i=this._toFrontRange||(this._toFrontRange=document.createRange());i.setStartBefore(e.nextSibling),i.setEndAfter(t.lastElementChild),t.insertBefore(i.extractContents(),e)}}updateRef(e){this.element.dataset.ref=e}get overflowElement(){return this.contentElement}get maxHeightElement(){return this.element}changeAlign(e){return typeof e=="string"?{align:e}:e}changeScrollable(e,t){return typeof e=="boolean"&&(e={overflowX:e,overflowY:e}),e?(e.element=this.overflowElement,e.widget=this,e.isScroller||(e=t?t.setConfig(e):new this.scrollerClass(e)),e.syncOverflowState()):t?.destroy(),e}handleReactElement(e){const t=this.closest(i=>i.reactComponent);t!=null&&t.reactComponent&&t.reactComponent.processWidgetContent({reactElement:e,widget:this,reactComponent:t.reactComponent})}get html(){return this.initializingElement||!this.element?this.content||this._html:this.contentElement.innerHTML}updateHtml(e){const t=this,i=e==null,{element:r,contentElement:n,htmlCls:s}=t;if(!r&&S.isReactElement(e)){t.whenVisible(()=>t.handleReactElement(e));return}if(r){t.updatingHtml=!0;const a=n===r&&t._anchorElement;s&&s.values.forEach(o=>r.classList[i?"remove":"add"](o)),a&&r.removeChild(a),e&&typeof e=="object"?S.isReactElement(e)?t.handleReactElement(e):Z.sync({domConfig:F(F({},e),{},{onlyChildren:!0}),targetElement:t.contentElement}):t.contentElement.innerHTML=i?"":e,t.getConfig("htmlMutationObserver"),a&&r.appendChild(a),t.isComposable?t.recompose():(t.floating||t.positioned)&&(t.isAligning||t.realign())}}changeHtmlMutationObserver(e,t){const i=this,{contentElement:r}=i;if(t?.disconnect(r),e){const n=new MutationObserver(()=>{i.updatingHtml?i.updatingHtml=!1:i._html=r.innerHTML});return n.observe(r,e),n}}updateContent(e){const t=this,i=e==null,{element:r,htmlCls:n}=t;if(r){const{contentRange:s}=t;n&&n.values.forEach(a=>r.classList[i?"remove":"add"](a)),yr(r)?(s.deleteContents(),i||s.insertNode(S.createElementFromTemplate(e,{fragment:!0}))):t.contentElement.innerHTML=e,t.contentRangeStartOffset=s.startOffset,t.contentRangeEndOffset=s.endOffset,(t.floating||t.positioned)&&!t.isAligning&&t.realign()}}onThemeChange(){var e;(e=this.anchorElement)!==null&&e!==void 0&&e.offsetParent&&(this._anchorSize=null,this.realign())}get anchorSize(){const e=this;let t=this._anchorSize;if(!t){const i=parseFloat(S.getStyleValue(e.element,"border-top-width")),r=S.getStyleValue(e.element,"border-top-color"),n=e.anchorElement,{className:s}=n,a=n.firstElementChild,o=e.anchorPathElement=a.lastElementChild,l=e._hidden;n.className="b-anchor b-anchor-top";let d=S.getStyleValue(e.contentElement,"background-color");d.match(rl)&&(d=S.getStyleValue(e.element,"background-color")),e.defaultAnchorBackgroundColor=d,t=n.getBoundingClientRect();const[u,h]=t=e._anchorSize=[t.width,t.height];n.className=s,a.setAttribute("height",h+i),a.setAttribute("width",u),o.setAttribute("d",`M0,${h}L${u/2},0.5L${u},${h}`),i&&(o.setAttribute("stroke-width",i),o.setAttribute("stroke",r)),t[1]-=i,l&&e.element.classList.add("b-hidden"),e.themeChangeListener||(e.themeChangeListener=ue.ion({theme:"onThemeChange",thisObj:e})),e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}return t}get anchorElement(){const e=this;if(!e._anchorElement){const t=e.floating,i=`${e.id}-shadow-filter`;e._anchorElement=S.createElement({parent:e.element,className:"b-anchor b-anchor-top",children:[{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",class:"b-pointer-el",children:[t?{tag:"defs",children:[{tag:"filter",id:i,children:[{tag:"feDropShadow",dx:0,dy:-1,stdDeviation:1,"flood-opacity":.2}]}]}:null,{tag:"path",[t?"filter":""]:`url(#${i})`}]}]})}return e._anchorElement}updateAnchor(e){this._anchorElement&&this._anchorElement.classList[e?"remove":"add"]("b-hide-display")}updateDraggable(e){const t=this,{element:i}=t;if(e)t.dragEventDetacher=B.addListener({element:i,dragstart:"onWidgetDragStart",dragend:"onWidgetDragEnd",thisObj:t}),t.dragDetacher=B.on({element:i,mousedown(a){const{target:o}=a,l=N.fromElement(o);(!a.target.closest(".b-field-inner")&&l===this||this.strips&&Object.values(this.strips).includes(l))&&i.setAttribute("draggable","true")},thisObj:t});else{var r,n,s;(r=t.dragEventDetacher)===null||r===void 0||r.call(t),(n=t.dragOverEventDetacher)===null||n===void 0||n.call(t),(s=t.dragDetacher)===null||s===void 0||s.call(t)}}onWidgetDragStart(e){var t;const i=this;if(!i.validateDragStartEvent(e))return;const{element:r,align:n,constrainTo:s}=i,a=i.positioned&&S.getStyleValue(r,"position")!=="fixed",o=a?r.parentElement:i.rootElement,l=$.from(r,a?o:null),d=e.clientX,u=e.clientY,h=document.scrollingElement||document.body,[f,g]=a?S.getOffsetXY(r,o):i.getXY(),m=(t=a?$.content(o).moveTo(0,0):s&&(s!=null&&s.isRectangle?s:$.from(s)))===null||t===void 0?void 0:t.deflate(n.constrainPadding||0),p={element:o,dragover:v=>{r.classList.remove("b-centered"),l.moveTo(f+v.clientX-d-(a?0:h.scrollLeft),g+v.clientY-u-(a?0:h.scrollTop)),m&&l.constrainTo(m),S.setTranslateXY(r,l.x,l.y)}};K.isTouchDevice&&(p.touchmove=v=>v.preventDefault()),i.floatRoot.appendChild(i.dragGhost),i.setDragImage(e),e.dataTransfer.effectAllowed="none",i.dragOverEventDetacher=B.addListener(p),i.alignTo()}validateDragStartEvent(e){const t=this,{element:i}=t,r=S.elementFromPoint(e.clientX,e.clientY),{handleSelector:n}=t.draggable;if(n){var s;const a=(s=$C.exec(n))===null||s===void 0?void 0:s[1];if(a){if(r.closest(`#${i.id} ${a}`))return e.preventDefault(),!1}else if(!r.closest(`#${i.id} ${n}`))return e.preventDefault(),!1}return!0}setDragImage(e){e.dataTransfer.setDragImage&&(e.dataTransfer.setData("application/node type",""),e.dataTransfer.setDragImage(this.dragGhost,-9999,-9999))}setStyle(e,t){return S.applyStyle(this.element,T.isObject(e)?e:{[e]:t}),this}onWidgetDragEnd(){this.dragGhost.remove(),this.dragOverEventDetacher(),this.element.removeAttribute("draggable")}changeFloating(e){return Boolean(e)}changePositioned(e){return Boolean(e)}updatePositioned(e){this.element.classList[e?"add":"remove"]("b-positioned")}getXY(){return[S.getPageX(this.element),S.getPageY(this.element)]}setXY(e,t){const i=this,{element:r}=i;if(i.floating||i.positioned){if(e!=null&&(i._x=e),t!=null&&(i._y=t),S.getStyleValue(r,"position")==="fixed"){const n=r.getBoundingClientRect(),[s,a]=S.getTranslateXY(r),o=e-n.x,l=t-n.y;S.setTranslateXY(r,s+o,a+l)}else S.setTranslateXY(r,i._x||0,i._y||0);i.isConstructing?i.centered=!1:r.classList.remove("b-centered")}}get x(){return this.getXY()[0]}changeX(e){this.setXY(e)}get y(){return this.getXY()[1]}changeY(e){this.setXY(null,e)}get width(){const e=this,t=e.element;return e.monitorResize?(e._width==null&&(e._width=t.offsetWidth),e._width):t.offsetWidth}changeWidth(e){const t=this;S.setLength(t.element,"width",e),t._lastWidth=e,t._width=null,t._flex=null,t.element.style.flex=""}clearWidthCache(){this._width=null}get maxWidth(){return S.measureSize(this.element.style.maxWidth,this.element)}updateMaxWidth(e){S.setLength(this.element,"maxWidth",e)}get minWidth(){return S.measureSize(this.element.style.minWidth,this.element)}updateMinWidth(e){S.setLength(this.element,"minWidth",e)}updateFlex(e){this.getConfig("width"),(typeof e=="number"||!isNaN(e))&&(e=`${e} ${e}`),this.element.style.flex=e,this.element.style.width=""}updateAlignSelf(e){this.element.style.alignSelf=e}updateMargin(e){this.element.style.margin=this.parseTRBL(e).join(" ")}updateTextAlign(e,t){t&&this.element.classList.remove(`b-text-align-${t}`),this.element.classList.add(`b-text-align-${e}`)}updatePlaceholder(e){this.input&&(e==null?this.input.removeAttribute("placeholder"):this.input.placeholder=e)}get height(){const e=this,t=e.element;return e.monitorResize?(e._height==null&&(e._height=t.offsetHeight),e._height):t.offsetHeight}changeHeight(e){S.setLength(this.element,"height",e),this._lastHeight=e,this._height=null}get maxHeight(){return S.measureSize(this.maxHeightElement.style.maxHeight,this.element)}updateMaxHeight(e){S.setLength(this.maxHeightElement,"maxHeight",e)}get minHeight(){return S.measureSize(this.element.style.minHeight,this.element)}updateMinHeight(e){S.setLength(this.element,"minHeight",e)}updateDisabled(e=!1){const{element:t,focusElement:i,ariaElement:r}=this;this.trigger("beforeUpdateDisabled",{disabled:e}),!(e&&(this.revertFocus(),this._disabled!==e))&&(t&&(t.classList[e?"add":"remove"]("b-disabled"),i&&(i.disabled=e),r&&r.setAttribute("aria-disabled",e)),this.onDisabled(e))}onDisabled(e){}disable(){this.disabled=!0}enable(){this.disabled=!1}requestFullscreen(){const e=this,t=mt.request(e.floating?e.floatRoot:e.element);return mt.onFullscreenChange(e.onFullscreenChange),e.floating||(e.floatRoot._oldParent=e.floatRoot.parentElement,e.element.appendChild(e.floatRoot)),e.element.classList.add("b-fullscreen"),t}exitFullscreen(){return mt.exit()}onFullscreenChange(){mt.isFullscreen||this.onExitFullscreen()}onExitFullscreen(){var e;const t=this,i=(e=t._rootElement)===null||e===void 0?void 0:e.floatRoot;mt.unFullscreenChange(t.onFullscreenChange),t.element.classList.remove("b-fullscreen"),t.element.contains(i)&&i!==null&&i!==void 0&&i._oldParent&&(i._oldParent.appendChild(i),i._oldParent=null)}get tooltip(){if(this._tooltip)return this._tooltip;{var e;const t=(e=N.Tooltip)===null||e===void 0?void 0:e.getSharedTooltip(this.rootElement);if(t&&t.activeTarget===this._element&&t.isVisible)return t}}changeTooltip(e,t){const i=this,{element:r}=i;if(e){if(!(i.preventTooltipOnTouch&&K.isTouchDevice)){if(!e.isTooltip&&e.constructor.name!=="Object"&&(e={html:typeof e=="string"?e:i.placeholder,textContent:!0}),!i.configureAriaDescription){var n;i.ariaDescription=(n=e.html)!==null&&n!==void 0&&n.match(Vs)?e.html.replace(Vs,BC):e.html}if(t!=null&&t.isTooltip||e.newInstance)e.type="tooltip",e.forElement||(e.forElement=r),!("showOnHover"in e)&&!e.forSelector&&(e.showOnHover=!0),"autoClose"in e||(e.autoClose=!0),e=N.reconfigure(t,e,i),i.detachListeners("tooltipValueListener"),i.configureAriaDescription||e.ion({name:"tooltipValueListener",innerHtmlUpdate:"onTooltipValueChange",thisObj:i});else{r.dataset.btip=!0,i.tipConfig=e;return}}}else if(t)if(e==null&&t.isTooltip)t.destroy();else{t.html=null;return}else delete r.dataset.btip;return e}onTooltipValueChange({value:e,source:t}){this.ariaDescription=typeof e=="string"?e:t.contentElement.innerText}get tooltipText(){const e=this._tooltip;if(e)return e.isTooltip?e.contentElement.innerText:typeof e=="string"?e:e.html;if(this.tipConfig)return this.tipConfig.html}get isVisible(){const e=this,{element:t}=e;let i;return Boolean(t&&!e._hidden&&!e.isDestroying&&yr(t)&&(!e.requireSize||vi(t))&&(!(i=e.containingWidget)||i.isVisible))}whenVisible(e,t=this,i,r=e){const n=this;n.isVisible&&n.isPainted?n.callback(e,t,i):(n.toCallWhenVisible||(n.toCallWhenVisible=new Map)).set(r,{callback:e,thisObj:t,args:i})}focus(){this.isFocusable&&S.focusWithoutScrolling(this.focusElement)}get focusElement(){}get isFocusable(){const e=!this.isDestroying&&this.isVisible&&!this.disabled&&this.focusElement;return e&&(e===document.body||e.offsetParent)}async show({align:e,animate:t=!0}={}){const i=this,{element:r,floating:n}=i,{style:s}=r,a=t&&i.showAnimation;let o,l,d=!i.isVisible;return d&&(d=i.trigger("beforeShow"),T.isPromise(d)&&(d=await d)),d!==!1&&(!i.internalBeforeShow||i.internalBeforeShow()!==!1)?new Promise(u=>{if(i.cancelHideShowAnimation(),i.updateCentered(i._centered),n){const h=i.floatRoot;h.contains(r)||(i.rendered?h.appendChild(i.element):i.render(h,!1)),s.transform.includes("scale")&&(i.scale=null,s.transform=s.transformOrigin="");const f=i.closest(HC);if(f){const{scale:g}=f;i.scale=g,s.transform=`scale(${g})`,s.transformOrigin="0 0"}}if(i._hidden=!1,r.classList.remove("b-hidden"),n&&!Pl(r)&&(i.hide(!1),u()),i.onConfigChange({name:"hidden",value:!1,was:!0,config:i.$meta.configs.hidden}),a){o=Object.keys(a)[0],l=a[o];const h=i.currentAnimation={showing:!0,styleProp:o,resolve:u};i.isAnimating=!0,i.currentAnimation.detacher=B.onTransitionEnd({element:r,property:o,duration:Qu(l.duration)+20,handler:()=>i.afterHideShowAnimate(h),thisObj:i}),s[o]=l.from,S.getStyleValue(r,o),s.transition=`${o} ${l.duration} ease ${l.delay}`,s[o]=l.to}i.afterShow(e,a?null:u)}):Promise.resolve()}async showBy(e,t,i){const r=this,n=Array.isArray(e);if(n||typeof e=="number"){const s=n?e:[e,t];e=Object.assign({target:new si(s[0]+1,s[1]+1),matchSize:!1,align:"t0-b0"},n?t:i)}if(r.requireSize=!0,r.isVisible)S.addTemporaryClass(r.element,"b-realigning",300,r),r.alignTo(e);else return r.show({align:e})}async showByPoint(){return ae.deprecate("Core","6.0.0","Widget.showByPoint() replaced by Widget.showBy() with the same signature"),this.showBy(...arguments)}afterShow(e,t){var i,r;const n=this;n.trigger("show"),n._configuredAnchorState=n.anchor,(i=n.owner)===null||i===void 0||(r=i.onChildShow)===null||r===void 0||r.call(i,n),n.triggerPaint(),(n.floating||n.positioned)&&(e?n.alignTo(e):n.centered?n.alignTo({target:n.constrainTo,align:"c-c"}):n.forElement&&n.alignTo(n.forElement)),t?.()}onChildHide(e){e.floating&&this.ariaElement.removeAttribute("aria-owns")}onChildShow(e){e.floating&&(this.ariaHasPopup=e.role,this.ariaElement.setAttribute("aria-owns",e.id))}triggerPaint(){const e=this,{element:t,toCallWhenVisible:i}=e,r=!e.isPainted;if(e.isVisible){if(r&&(e.getConfig("scrollable"),e.scaleToFitWidth&&!e.monitorResize&&(e.onParentElementResize=e.onParentElementResize.bind(e),Ne.addResizeListener(t.parentElement,e.onParentElementResize),e.updateScale()),!e.hideBryntumDomMessage&&(e.isTaskBoardBase||e.isGridBase||e.isCalendar)&&t.insertBefore(new Comment("POWERED BY BRYNTUM (https://bryntum.com)"),t.firstChild)),e.eachWidget(PC,!1),r&&(e.rootElement=S.getRootElement(t),e.getConfig("tooltip"),!N.Ripple&&N.RippleClass&&(N.Ripple=new N.RippleClass({rootElement:e.rootElement}))),e.isPainted=!0,r&&e.triggerConfigs("paint"),e.trigger("paint",{firstPaint:r}),i!=null&&i.size){for(const{callback:n,thisObj:s,args:a}of i.values())e.callback(n,s,a);i.clear()}r&&e.monitorResize&&!e.scaleToFitWidth&&Ne.onElementResize([{target:t}])}}cancelHideShowAnimation(){const e=this,{currentAnimation:t,element:i}=e;t&&(e.isAnimating=!1,i.classList.contains("b-hiding")&&(i.classList.remove("b-hiding"),e._hidden=!1),t.detacher(),t.resolve(),i.style.transition=i.style[t.styleProp]="",e.currentAnimation=null,e.trigger(`${t.showing?"show":"hide"}AnimationEnd`))}afterHideShowAnimate(e){const t=this;e===t.currentAnimation&&(t.element.classList.remove("b-hiding"),t.cancelHideShowAnimation(),t._hidden&&t.afterHideAnimation())}suspendVisibility(){this._visibilitySuspended=(this._visibilitySuspended||0)+1,Object.defineProperty(this,"isVisible",NC)}resumeVisibility(e=!0){--this._visibilitySuspended||(delete this.isVisible,e&&this.triggerPaint())}hide(e=!0){return new Promise(t=>{const i=this,{element:r,lastAlignSpec:n}=i,{style:s}=r,a=e&&i.hideAnimation;if(i.clearTimeout(i.scrollListenerTimeout),i.clearTimeout(i.resizeListenerTimeout),!i._hidden&&i.trigger("beforeHide",{animate:e})!==!1){if(i._hidden=!0,n&&(n.targetOutOfView=null,n.monitorIntersection&&(i.intersectionObserver.takeRecords(),i.intersectionObserver.unobserve(n.target))),i.onConfigChange({name:"hidden",value:!0,was:!1,config:i.$meta.configs.hidden}),!r){t();return}if(r.contains(S.getActiveElement(r))&&i.revertFocus(!0),i.isDestroyed){t();return}if(i.cancelHideShowAnimation(),a){const o=Object.keys(a)[0],l=a[o];if(Number(getComputedStyle(i.element)[o])!==l.to){const d=i.currentAnimation={hiding:!0,styleProp:o,resolve:t};r.classList.add("b-hiding"),i.isAnimating=!0,i.currentAnimation.detacher=B.onTransitionEnd({element:r,property:o,duration:Qu(l.duration)+20,handler:()=>i.afterHideShowAnimate(d),thisObj:i}),s[o]=l.from,S.getStyleValue(r,o),s.transition=`${o} ${l.duration} ease ${l.delay}`,s[o]=l.to}else r.classList.add("b-hidden")}else r.classList.add("b-hidden");i.afterHide(!a&&t,a)}})}doHideOrRealign({target:e,isTrusted:t}){const i=this,{lastAlignSpec:r,element:n}=i,s=r?.anchoredTo,a=r?.target,o=r?.position,l=S.getActiveElement(i);if(!t||!vi(n)||e&&(n.contains(e)||e.nodeType===Element.DOCUMENT_NODE&&n.contains(l)&&OC[l]&&globalThis.innerHeight<document.body.offsetHeight))return;if(r.aligningToElement){const u=S.isInView(a,!1,i);if(u&&u.equals(r.targetRect))return}const d=i.scrollAction==="hide"&&i.getXY();if(i.realign(),!i.isDestroyed&&Pl(n)&&i.scrollAction==="hide"){const[u,h]=i.getXY();(u!==d[0]||h!==d[1]||a?.$$name==="Point"||o)&&(!s||!vi(s)||e&&S.isDescendant(e,s))&&i.hide()}}afterHide(e=null,t=this.hideAnimation){var i,r;const n=this;n._anchor=n._configuredAnchorState,n.removeTransientListeners(),t||n.afterHideAnimation(),n.trigger("hide"),(i=n.owner)===null||i===void 0||(r=i.onChildHide)===null||r===void 0||r.call(i,n),e&&e()}removeTransientListeners(){var e,t;const i=this,{targetObserver:r,lastAlignSpec:n}=i;if(i.clearTimeout(i.resizeListenerTimeout),i.clearTimeout(i.scrollListenerTimeout),r&&(r.disconnect(),delete i.targetObserver),i.documentScrollListener=(e=i.documentScrollListener)===null||e===void 0?void 0:e.call(i),i.targetRootScrollListener=(t=i.targetRootScrollListener)===null||t===void 0?void 0:t.call(i),i.targetResizeListener&&(Ne.removeResizeListener(n.target,i.onTargetResize),i.targetResizeListener=!1),i.constrainListeners){var s;const a=(s=n.constrainTo)!==null&&s!==void 0&&s.isRectangle?globalThis:n.constrainTo;Ne.removeResizeListener(a||globalThis,i.onAlignConstraintChange),i.constrainListeners=!1}}afterHideAnimation(){const e=this,{element:t}=e;e.floating&&e.floatRoot.contains(t)?t.remove():t.classList.add("b-hidden"),e.defaultAnchorBackgroundColor&&e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}changeHidden(e){const t=this;let i;return t.isConfiguring?(i=Boolean(e),t.element.classList[e?"add":"remove"]("b-hidden")):(t.trigger("beforeChangeHidden",{hidden:e}),e?t.hide():t.show()),i}get assignedId(){return this.hasGeneratedId?null:this.id}get owner(){return this.parent||this._owner||this.containingWidget}get containingWidget(){let e=this.parent;if(!e){var t,i;const r=((t=this.forElement)===null||t===void 0?void 0:t.nodeType)===Element.ELEMENT_NODE?this.forElement:(i=this.element)===null||i===void 0?void 0:i.parentNode;e=r?.closest(".b-widget")&&N.fromElement(r)}return e}get previousSibling(){return this.getSibling(-1)}get nextSibling(){return this.getSibling(1)}getSibling(e){const t=this,{parent:i}=t,r=i?i.childItems:Array.from(t.element.parentElement.querySelectorAll(".b-widget"));return i?r[r.indexOf(t)+e]:N.fromElement(r[r.indexOf(t.element)+e])}up(e,t,i){var r;const{owner:n}=this;return e?n==null||(r=n.closest)===null||r===void 0?void 0:r.call(n,e,t,i):n}closest(e,t,i){const r=typeof i,n=r==="number",s=r==="string";for(let a=this,o=1;a;a=a.owner,o++){if(N.widgetMatches(a,e,t))return a;if(n&&o>=i)return;if(s&&N.widgetMatches(a,i,t))return;if(a===i)return}}owns(e){if(e){if("eventPhase"in e&&(e=e.target),e.nodeType===Element.ELEMENT_NODE){if(this.element.contains(e))return!0;e=N.fromElement(e)}for(;e;){if(e===this)return!0;e=e.owner}}return!1}eachAncestor(e){let t=this.owner;for(;t;){if(e(t)===!1)return!1;t=t.owner}return!0}changeMonitorResize(e,t){const i=this.scaleToFitWidth?!1:Boolean(e);if(i!==Boolean(t))return i}updateMonitorResize(e){const t=this;cr.call(t,"onElementResize")||(t.onElementResize=t.onElementResize.bind(t)),Ne[e?"addResizeListener":"removeResizeListener"](t.element,t.onElementResize)}changeReadOnly(e){if(e=Boolean(e),Boolean(this._readOnly)!==e)return e}updateReadOnly(e){var t;(t=this.element)===null||t===void 0||t.classList[e?"add":"remove"]("b-readonly"),this.isConfiguring||(this.eachWidget(i=>{i.ignoreParentReadOnly||("_originalReadOnly"in i||(i._originalReadOnly=i.config.readOnly||!1),i.readOnly=e||i._originalReadOnly)},!1),this.trigger("readOnly",{readOnly:e}))}eachWidget(e,t=!0){const i=this.childItems,r=i?.length||0,n={};for(let s=0;s<r;s++){const a=i[s];if(n.down=t,e(a,n)===!1||n.down&&a.eachWidget&&a.eachWidget(e,t)===!1)return!1}return!0}queryAll(e){const t=[];return this.eachWidget(i=>{e(i)&&t.push(i)}),t}query(e){let t=null;return this.eachWidget(i=>{if(e(i))return t=i,!1}),t}getWidgetByRef(e){var t,i;return e instanceof N?e:(this===null||this===void 0||(t=this.widgetMap)===null||t===void 0?void 0:t[e])||(this===null||this===void 0||(i=this.owner)===null||i===void 0?void 0:i.getWidgetByRef(e))}onFocusIn(e){const t=this,{element:i}=t;t.containsFocus=!0,t.focusInEvent=e,i.classList.add("b-contains-focus"),t.updateAriaLabel(t.localizeProperty("ariaLabel")),t.updateAriaDescription(t.localizeProperty("ariaDescription")),i.contains(e._target)&&t.onInternalKeyDown&&!t.keyDownListenerRemover&&(t.keyDownListenerRemover=B.on({element:i,keydown:"onInternalKeyDown",thisObj:t})),t.trigger("focusin",e)}onFocusOut(e){const t=this;t.keyDownListenerRemover&&(t.keyDownListenerRemover(),t.keyDownListenerRemover=null),t.isDestroyed||(e.relatedTarget||t.revertFocus(!t.isVisible),t.containsFocus=!1,t.element.classList.remove("b-contains-focus"),t.updateAriaLabel(t.localizeProperty("ariaLabel")),t.updateAriaDescription(t.localizeProperty("ariaDescription")),t.trigger("focusout",e))}captureFocus(){const e=this,t=S.getActiveElement(e),i=e.contains(t)&&e.captureFocusItem(t);return(r,n)=>{i&&!e.isDestroying&&(S.getActiveElement(e)!==t||n)&&i(r)}}captureFocusItem(e){return(t=!0)=>{this.contains(e)&&(t?e.focus():S.focusWithoutScrolling(e))}}contains(e,t){const{element:i}=this;if(e&&i)return e.isWidget&&(e=e.element),i.contains(e)&&(!t||i!==e)}revertFocus(e){var t,i;const r=this,n=S.getActiveElement(r);let s=(t=r.focusInEvent)===null||t===void 0?void 0:t.relatedTarget;(e||r.containsFocus&&((i=s)===null||i===void 0?void 0:i.nodeType)===Element.ELEMENT_NODE&&r.element.contains(n))&&((!s||!S.isFocusable(s))&&(s=r.getFocusRevertTarget()),r._isRevertingFocus=!0,s&&S.isFocusable(s)?(s._isRevertingFocus=!0,S.focusWithoutScrolling(s),s._isRevertingFocus=!1):n?.blur(),r._isRevertingFocus=!1)}getFocusRevertTarget(){const e=this,{owner:t,focusInEvent:i}=e,r=i&&i.backwards?1:-1;let n=i&&i.relatedTarget;const s=n&&N.fromElement(n);if(t&&!t.isDestroyed&&(!n||!S.isFocusable(n)||s&&!s.isFocusable)){var a;if(n=null,t.eachWidget){const o=[];if(t.eachWidget(l=>{(l===e||l.isFocusable)&&o.push(l)},!1),o.length>1){const l=o.indexOf(e);n=o[l+r]||o[l-r]}}!n&&t.isFocusable&&(n=t),n=n?n.focusElement:(a=t.getFocusRevertTarget)===null||a===void 0?void 0:a.call(t)}return n}getStaticWidgetClasses(e,t){const i=new Q,r=this.$meta.hierarchy;let n,s,a,o,l;for(s=r.indexOf(e);s<r.length;++s){var d;n=r[s],l=Reflect.getOwnPropertyDescriptor(n.prototype,"widgetClass"),(d=l)!==null&&d!==void 0&&d.get?o=l.get.call(this):(a=cr.call(n,"$$name")||cr.call(n,"$name")||cr.call(n,"_$name")?n.$$name:n.name,(a.length<3||a.includes("$"))&&console.warn(`Class "${a}" extending "${n.$name}" should have "$name" static getter with no less than 3 chars.`),o=`b-${a.toLowerCase()}`),o&&i.add(t?o+t:o)}return i}get rootUiClass(){return N}get staticClassList(){const{$meta:e}=this;let t=e.staticClassList;return t||(e.staticClassList=t=this.getStaticWidgetClasses(N),K.isTouchDevice&&t.add("b-touch")),t}get uiClasses(){return this.getConfig("ui"),this._uiClasses}get uiClassList(){return this.getConfig("ui"),this._uiClassList}get widgetClassList(){const e=this,{cls:t,defaultCls:i,uiClasses:r}=e;let{staticClassList:n}=e;(i||t)&&(n=n.clone(),i&&n.assign(i),t&&n.assign(t));const s=n.values;return r&&s.push(...r),e.floating&&s.push("b-floating"),e.collapsify==="hide"&&s.push("b-collapsify-hide"),s}changeCls(e){return Q.from(e)}changeContentElementCls(e){return Q.from(e)}changeHtmlCls(e){return Q.from(e)}changeDefaultCls(e){return Q.from(e,!0)}changeUi(e){return Q.from(e)}updateUi(e){var t;let i=null,r,n;if(e){const s=this.getStaticWidgetClasses(this.rootUiClass);for(n in e)if(e[n])for(r in s)s[r]&&((i||(i=new Q))[`${r}-ui-${n}`]=1)}this._uiClasses=(t=i)===null||t===void 0?void 0:t.values,this._uiClassList=i}fromCache(e,t=!1,i=this.element){if(!i)return null;const r=this;return r.cache[e]||(r.cache[e]=t?S.children(i,e):S.down(i,e)),r.cache[e]}emptyCache(){this.cache={}}changeMasked(e,t){var i;if(((i=this.masked)===null||i===void 0?void 0:i.type)!=="trial"){if((e===!0||e==="")&&(e="\xA0"),t&&!t.isDestroyed)typeof e=="string"?(t.text=e,e=t):e?(t.setConfig(e),e=t):t.destroy();else if(e){const r=N.resolveType("mask");e=r.mergeConfigs(this.maskDefaults,e),e.owner=this,e=r.mask(e)}return e||null}}onMaskAutoClose(e){e.isDestroyed&&e===this.masked&&(this.masked=null)}mask(e){return this.masked=e,this.masked}unmask(){this.masked=null}onInternalResize(e,t,i,r,n){this._width=e.offsetWidth,this._height=e.offsetHeight}onElementResize(e,t){const i=this,{element:r}=i,n=i._width,s=i._height,a=r.offsetWidth,o=r.offsetHeight;i.floating&&t&&i.onFloatingWidgetResize(...arguments),!i.suspendResizeMonitor&&(n!==a||s!==o)&&(i.onInternalResize(r,a,o,n,s),i.trigger("resize",{width:a,height:o,oldWidth:n,oldHeight:s}))}onFloatingWidgetResize(e,t,i){const r=this,{lastAlignSpec:n,constrainTo:s}=r;if(r.isVisible&&n&&n.target){const a=!t||i.height!==t.height,o=!t||i.width!==t.width,l=s&&!$.from(s).contains($.from(r.element,null,!0));(a&&n.zone!==2||o&&n.zone!==1||l)&&r.requestAnimationFrame(()=>r.realign())}}updateScale(){const e=this,t=e.element,i=t.parentElement;e.configuredWidth||(e.configuredWidth=e.width),t.style.display="none";const r=$.client(i),n=r.width/e.configuredWidth,s=e.scale=e.allowGrowWidth?Math.min(n,1):n;t.style.transform=`scale(${s})`,t.style.transformOrigin="top left",t.style.display="",e.allowGrowWidth&&n>1&&(e.width=e.configuredWidth*n)}onParentElementResize(e){this.updateScale()}parseTRBL(e,t="px"){if(e=e||0,typeof e=="number")return[`${e}${t}`,`${e}${t}`,`${e}${t}`,`${e}${t}`];const i=e.split(" "),r=i.length;return r===1?i[1]=i[2]=i[3]=i[0]:r===2?(i[2]=i[0],i[3]=i[1]):r===3&&(i[3]=i[1]),[isFinite(i[0])?`${i[0]}${t}`:i[0],isFinite(i[1])?`${i[1]}${t}`:i[2],isFinite(i[2])?`${i[2]}${t}`:i[3],isFinite(i[3])?`${i[3]}${t}`:i[4]]}get documentRoot(){var e;return((e=this.owner)===null||e===void 0?void 0:e.documentRoot)||this.element.getRootNode()}get rootElement(){const e=this;if(!e._rootElement){var t;let i=((t=e.owner)===null||t===void 0?void 0:t.rootElement)||S.getRootElement(e.forElement||(yr(e.element)?e.element:e.getRenderContext()[0]||e.element));i||(i=document.body),e._rootElement=i}return e._rootElement}get floatRoot(){var e;const t=this,i=t.rootElement||((e=t.owner)===null||e===void 0?void 0:e.rootElement);let{floatRoot:r}=i;if(r)i.contains(r)||i.appendChild(r);else{var n;const{outerCls:s}=N,a=(n=S.getThemeInfo(null,i))===null||n===void 0?void 0:n.name;if(!S.isValidFloatRootParent(i))throw new Error("Attaching float root to wrong root");a&&s.push(`b-theme-${a.toLowerCase()}`),r=i.floatRoot=S.createElement({className:`b-float-root ${s.join(" ")}`,parent:i}),fn.push(r),K.isAndroid&&(r.style.height=`${screen.height}px`,B.on({element:globalThis,orientationchange:()=>r.style.height=`${screen.height}px`,thisObj:this})),!K.isHoverableDevice&&globalThis.visualViewport&&B.on({element:globalThis.visualViewport,resize:({target:o})=>r.style.height=`${o.height}px`,thisObj:this}),ue.ion({theme:({theme:o,prev:l})=>{r.classList.add(`b-theme-${o.toLowerCase()}`),r.classList.remove(`b-theme-${l.toLowerCase()}`)}})}return r}get floatRootMaxZIndex(){let e=1;return Array.from(this.floatRoot.children).forEach(t=>{const i=parseInt(getComputedStyle(t).zIndex||0,10);i>e&&(e=i)}),e}static resetFloatRootScroll(){fn.forEach(e=>e.scrollTop=e.scrollLeft=0)}static get floatRoots(){return fn}static removeFloatRoot(e){fn.splice(fn.indexOf(e),1)}static get outerCls(){const e=["b-outer"],{platform:t}=K;return t&&e.push(`b-${t}`),K.isTouchDevice&&e.push("b-touch-events"),S.scrollBarWidth?e.push("b-visible-scrollbar"):e.push("b-overlay-scrollbar"),K.isChrome?e.push("b-chrome"):K.isSafari?e.push("b-safari"):K.isFirefox&&e.push("b-firefox"),globalThis.ResizeObserver||e.push("b-no-resizeobserver"),e}get isAnimating(){return this._isAnimatingCounter>0}set isAnimating(e){const t=this,{_isAnimatingCounter:i}=t;t._isAnimatingCounter=Math.max(0,i+(e?1:-1)),i===0&&e?(t.element.classList.add("b-animating"),t.trigger("animationStart")):i===1&&!e&&(t.element.classList.remove("b-animating"),t.trigger("animationEnd"))}async waitForAnimations(){this.isAnimating&&await this.await("animationend",{checkLog:!1})}static query(e,t=!1){const{idMap:i}=N.identifiable;for(const r in i)if(N.widgetMatches(i[r],e,t))return i[r];return null}static queryAll(e,t=!1){const{idMap:i}=N.identifiable,r=[];for(const n in i)N.widgetMatches(i[n],e,t)&&r.push(i[n]);return r}static fromElement(e,t,i){const r=typeof t;e&&!e.nodeType&&(e=e.target),(r==="number"||t&&t.nodeType===Element.ELEMENT_NODE)&&(i=t,t=null);let n=e,s=0,a,o,l;for(typeof i!="number"&&(a=i,i=Number.MAX_VALUE),r==="string"&&(t=t.toLowerCase());n&&n.nodeType===Element.ELEMENT_NODE&&s<i&&n!==a;){if(o=n.dataset&&n.dataset.ownerCmp||n.id,o){if(l=N.getById(o),l)if(t){if(r==="function"){if(t(l))return l}else if(N.widgetMatches(l,t,!0))return l}else return l;s++}n=n.parentNode}return null}triggerFieldChange(e,t=!0){t&&this.trigger("change",e),this.eachAncestor(i=>{var r,n;if((r=i.onFieldChange)===null||r===void 0||r.call(i,e),(n=i.isolateFieldChange)!==null&&n!==void 0&&n.call(i,this))return!1})}isolateFieldChange(e){return this.isolateFields}setupFocusListeners(){ue.setupFocusListenersOnce(this._rootElement,B)}static widgetMatches(e,t,i){return t==="*"?!0:typeof t=="function"?t(e):N.isType(e,t,i)}static attachTooltip(e,t){return typeof t=="string"&&(t={html:t}),N.create(Object.assign({forElement:e},t),"tooltip"),e}changeDock(e){return e==="start"?"left":e==="end"?"right":e}updateRtl(e){super.updateRtl(e),this.eachWidget(t=>{"rtl"in t.initialConfig||(t.rtl=e)})}}const jC=N.prototype;["compose","domSyncCallback"].forEach(c=>jC[c].$nullFn=!0);N.initClass();N.register("mask",ze);S.Widget=N;ue.Widget=N;ze.identifiable.idMap=N.identifiable.idMap;Object.assign(globalThis.bryntum||(globalThis.bryntum={}),{get:N.getById.bind(N),query:N.query,queryAll:N.queryAll,fromElement:N.fromElement});N._$name="Widget";class Xt extends P.mixin(Ie,ai){get contentElement(){var e;return(e=this.owner)===null||e===void 0?void 0:e.contentElement}onChildAdd(e){}onChildRemove(e){}renderChildren(){const e=this,{owner:t,itemCls:i}=e,{contentElement:r,items:n}=t,s=t.itemCls,a=n?.length;if(a){t.textContent=!1;for(let o=0;o<a;o++){const l=n[o],{element:d}=l,{classList:u}=d;d.dataset.itemIndex=o,u.contains("b-outer")&&u.remove(...N.outerCls),i&&u.add(i),s&&u.add(s),l.render(r,Boolean(t.isPainted))}}e.syncPendingConfigs(),e.syncChildCount()}removeChild(e){const t=this,{element:i}=e,{owner:r,itemCls:n}=t,{contentElement:s}=r,a=r.itemCls;s.contains(i)&&i.remove(),delete i.dataset.itemIndex,n&&i.classList.remove(n),a&&i.classList.remove(a),t.fixChildIndices(),t.syncChildCount()}appendChild(e){const{element:t}=e,{owner:i,itemCls:r}=this,{contentElement:n}=i,s=i.itemCls;t.dataset.itemIndex=i.indexOfChild(e),i.textContent=!1,r&&t.classList.add(r),s&&t.classList.add(s),e.render(n,Boolean(i.isPainted)),this.syncChildCount()}insertChild(e,t){const i=this,{element:r}=e,{owner:n,itemCls:s}=i,{contentElement:a}=n,o=S.getChild(a,`[data-item-index="${t}"]`),l=n.itemCls;n.textContent=!1,s&&r.classList.add(s),l&&r.classList.add(l),a.insertBefore(r,o),e.render(null,Boolean(n.isPainted)),i.fixChildIndices(),i.syncChildCount()}fixChildIndices(){this.owner.items.forEach((e,t)=>{e.element.dataset.itemIndex=t})}syncChildCount(){var e;const{owner:t}=this,{length:i}=t.items;(e=t.contentElement)===null||e===void 0||e.classList[i===1?"add":"remove"]("b-single-child")}syncConfigLater(e){const t=this.pendingConfigs||(this.pendingConfigs=[]);t.includes(e)||t.push(e)}syncConfigStyle({name:e,style:t,classes:i,map:r}){const n=this,s=`b-box-${e}-`,{contentElement:a}=n,o=n[e];let l=r?.[o]||o;if(a){if(i){const{classList:d}=a;i.forEach(u=>{u!==l&&d.remove(s+u)}),i.includes(l)&&(d.add(s+l),l="")}a.style[t]=l}else n.syncConfigLater(e)}syncPendingConfigs(){const e=this,{pendingConfigs:t}=e;let i;if(t)for(e.pendingConfigs=null;i=t.pop();)e[e.$meta.configs[i].updater](e[i])}}M(Xt,"type","default");M(Xt,"configurable",{owner:null,containerCls:"b-auto-container",itemCls:null});M(Xt,"factoryable",{defaultType:"default"});Xt.initClass();Xt._$name="Layout";let ih=0;const WC=c=>c.ripple;class kg extends N{static get defaultConfig(){return{old_element:{children:[{className:"b-ripple-inner",reference:"rippleElement"}]},element:{children:[{tag:"svg",class:"b-ripple-inner",reference:"rippleElement",ns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"0 0 100 100",children:[{reference:"circleElement",tag:"circle",cx:"0",cy:"0",r:10}]}]},floating:!0,hideAnimation:!1,showAnimation:!1,scrollAction:"realign",color:"rgba(0,0,0,.3)",startRadius:10,radius:100}}static get $name(){return"Ripple"}afterConstruct(){super.afterConstruct(),B.on({element:this.rootElement,mousedown:"onRippleControllingEvent",thisObj:this,capture:!0,once:!0})}onRippleControllingEvent(e){var t;const i=this;i.show();const r=S.getStyleValue(i.circleElement,"animationName");i.hide(),(t=i.listenerDetacher)===null||t===void 0||t.call(i),r&&r!=="none"&&(i.listenerDetacher=B.on({mousedown:{element:i.rootElement,capture:!0,handler:"onMousedown"},touchstart:{element:i.rootElement,capture:!0,handler:"onTouchStart"},animationend:{element:i.circleElement,handler:"onAnimationEnd"},thisObj:i}),e.type==="mousedown"&&(i.onMousedown(e),ue.ion({theme:"onRippleControllingEvent",thisObj:this})))}onTouchStart(e){ih=performance.now(),this.handleTriggerEvent(e)}onMousedown(e){performance.now()-ih>200&&this.handleTriggerEvent(e)}handleTriggerEvent(e){const t=N.fromElement(e.target,WC);if(t){const i=t.ripple,r=i.delegate?e.target.closest(i.delegate):t.focusElement||t.element;if(r){const n=T.assign({event:e,target:r,radius:this.radius},i);if(typeof n.clip=="string"&&(n.clip=t[n.clip]||e.target.closest(n.clip),!n.clip))return;this.ripple(n)}}}ripple({event:e,point:t=B.getClientPoint(e),target:i=e.target,clip:r=i,radius:n=this.radius,color:s=this.color}){this.clip=r,r=$.from(r,null,!0);const a=this,o=r.getDelta(t),l=a.rippleElement.style,d=a.circleElement,u=S.getStyleValue(i,"border-radius");a.hide(),l.transform=`translateX(${o[0]}px) translateY(${o[1]}px)`,l.height=l.width=`${n}px`,a.element.style.borderRadius=u,d.setAttribute("r",n),d.setAttribute("fill",s),a.showBy({target:r,align:"c-c",matchSize:!0})}onAnimationEnd(e){e.animationName==="b-ripple-expand"&&this.hide()}}N.RippleClass=kg;kg._$name="Ripple";const UC=Object.freeze({}),{isArray:ur}=Array,YC=c=>c.weight,rh=({weight:c},{weight:e})=>typeof c=="string"||typeof e=="string"?String(c).localeCompare(String(e)):(c??Number.MAX_SAFE_INTEGER)-(e??Number.MAX_SAFE_INTEGER),nh=c=>c&&!c.hidden,GC=["display","flex-direction"],qC={default:1,box:1};class wt extends N{static get $name(){return"Container"}static get type(){return"container"}static get configurable(){return{items:null,lazyItems:{$config:["lazy"],value:null},defaults:null,defaultType:"widget",layoutStyle:null,itemCls:null,layout:{type:"default"},namedItems:null,overflowable:{value:null,default:!1,$config:null},textContent:!0,record:null,autoUpdateRecord:null,autoUpdateFields:null,hideWhenEmpty:null,contentElMutationObserver:{$config:["lazy","nullify"],value:!0},isolateFields:!1,focusDescendant:!1,defaultBindProperty:null,defaultFocus:null}}static get prototypeProperties(){return{flexRowCls:"b-flex-row",flexColCls:"b-flex-column",initialItems:!0}}startConfigure(e){const t=e.items||e.lazyItems;(this.hasItems=Boolean(t&&(ur(t)?t:Object.keys(t)).length))||(this.initialItems=!1),super.startConfigure(e)}get firstItem(){return this.getAt(0)}get lastItem(){return this.getAt(-1)}getAt(e){return this.ensureItems().at(e)}remove(...e){let t=!0;e.length===1&&(ur(e[0])?e=e[0]:t=!1);const i=this,{_items:r}=i,n=[];for(let s=0;s<e.length;s++){const a=e[s];r.includes(a)&&(r.remove(a),i.layout.removeChild(a),n.push(a),i.onChildRemove(a))}return t?n:n[0]}removeAll(){return this.remove(this.items)}add(...e){const t=this,i=t.ensureItems(),r=[];let n=!0,s,a,o;for(e.length===1&&(ur(e[0])?e=e[0]:n=!1),a=0;a<e.length;a++){var l;s=e[a],s.isWidget?s.parent=t:s=t.createWidget(s),((l=s)===null||l===void 0?void 0:l.weight)!=null?(o=W.findInsertionIndex(s,i.values,rh),r.push(t.insert(s,o))):s&&(i.includes(s)||(i.add(s),t.onChildAdd(s),t.layout.appendChild(s),r.push(s)))}return n?r:r[0]}ensureItems(){const e=this;return e.getConfig("items"),e.getConfig("lazyItems"),e._items||(e.items=[]),e._items}insert(e,t){const i=this,r=i.ensureItems();e instanceof N?e.parent=i:e=i.createWidget(e),r.includes(t)&&(t=i.indexOfChild(t)),t=Math.min(t,r.count);const n=r.values;return n.splice(t,0,e),r.values=n,i.onChildAdd(e),i.layout.insertChild(e,t),e}indexOfChild(e){return this.items.indexOf(e)}changeLazyItems(e){this.items=e,this.layout.renderChildren()}changeItems(e,t){const i=this,r=[],n=new Fn;return ur(e)?i.processItemsArray(e,r):e&&i.processItemsObject(e,i.namedItems,r),r.some(YC)&&r.sort(rh),n.add(r),t&&t.forEach(s=>{i.remove(s),!n.includes(s)&&s._createdBy===i&&s.destroy()}),n}afterConstruct(){const{rtl:e}=this,{classList:t}=this.contentElement;t.toggle("b-rtl",e===!0),t.toggle("b-ltr",e===!1)}updateRtl(e){super.updateRtl(e);const{contentElement:t}=this;t&&(t.classList.toggle("b-rtl",e===!0),t.classList.toggle("b-ltr",e===!1))}updateItems(e,t){let i=0;e.forEach(r=>{this.onChildAdd(r),t&&!t.temporary&&this.layout.insertChild(r,i),++i}),this.initialItems=!1}updateHideWhenEmpty(){this.syncChildCount(this.rendered)}get items(){const e=this;if(e.getConfig("lazyItems"),!e._items){if(e.initializingItems)return[];e._items=new Fn,e._items.temporary=!0}return e._items.values}processItemsArray(e,t){const i=e.length;let r,n;for(r=0;r<i;r++)n=e[r],n instanceof N?(n.parent=this,n.element.classList.remove(...N.outerCls)):n=this.createWidget(n),n&&((n.ref||n.id)&&this.addDescendant(n),t.push(n))}processItemsObject(e,t,i){let r,n;for(n in e)r=e[n],r&&(t&&n in t&&(r=typeof r=="object"?T.merge(T.clone(t[n]),r):t[n]),r&&(r instanceof N?r.parent=this:(r instanceof Object&&(r.ref=n),r=this.createWidget(r)),r&&(r.ref=n,this.addDescendant(r),i.push(r))))}onChildAdd(e){if(e.innerItem&&this.readOnly&&!e.ignoreParentReadOnly&&(e.readOnly=!0),this.onChildAddLayout(e),e.ref||e.id)for(let t=this;t;t=t.parent)t.addDescendant(e);this.syncChildCount(!0)}onChildAddLayout(e){e.innerItem&&this.layout.onChildAdd(e)}onChildHide(e){var t;super.onChildHide(e),(t=this._items)!==null&&t!==void 0&&t.includes(e)&&this.syncChildCount(!0)}onChildShow(e){var t;super.onChildShow(e),(t=this._items)!==null&&t!==void 0&&t.includes(e)&&this.syncChildCount(!0)}syncChildCount(e){if(!this.isConfiguring){const t=this,{items:i,hasItems:r}=t,n=i.filter(nh),{length:s}=n;if(t.visibleChildCount=s,t.hideWhenEmpty&&e){const a=Boolean(!s);Boolean(t._hidden)!==a&&(t.hidden=a)}i.forEach(a=>a.element.classList.remove("b-last-visible-child","b-first-visible-child")),s&&(n[0].element.classList.add("b-first-visible-child"),n[s-1].element.classList.add("b-last-visible-child")),t.hasItems=Boolean(t.childItems.length),t.contentElement.classList[s?"remove":"add"]("b-no-visible-children"),t.isComposable?r!==t.hasItems&&t.recompose():t.updateTextContent(t._textContent)}}syncFlexDirection(){const e=this,{contentElement:t,flexColCls:i,flexRowCls:r}=e,n=new Q(t.className),s=S.getStyleValue(t,GC);n[r]=n[i]=0,s.display==="flex"&&(n[s["flex-direction"]==="row"?r:i]=1),S.syncClassList(t,n)}addDescendant(e){const t=e.ref||e.id,i=this._widgetMap||(this._widgetMap={});i[t]||(i[t]=e)}onChildRemove(e){const t=this,i=e.ref||e.id;if(i)for(let r=t;r;r=r.parent)r.widgetMap[i]===e&&delete r.widgetMap[i];t.layout.onChildRemove(e),t.syncChildCount(!0)}get widgetMap(){return this._widgetMap||(this._widgetMap={}),this.initializingItems||this.getConfig("items"),this._widgetMap}changeRecord(e){return this._record=e==null?UC:null,e}updateRecord(e){var t;const i=this;(t=i.recordUpdateDetacher)===null||t===void 0||t.call(i),i.trigger("beforeSetRecord",{record:e}),i.setValues(e,{onlyName:!0,highlight:Boolean(i.$highlight)}),i.autoUpdateFields&&e!==null&&e!==void 0&&e.firstStore&&(i.recordUpdateDetacher=e.firstStore.ion({update:i.onRecordUpdated,thisObj:i}))}setRecord(e,t){this.$highlight=t,this.record=e,this.$highlight=!1}onRecordUpdated({record:e}){e===this.record&&this.setValues(this.record,!0,!0)}onFieldChange({source:e,userAction:t}){if(this.autoUpdateRecord&&t){const{record:i}=this,{name:r,isValid:n=!0,value:s}=e;i&&r&&n&&(i[r]=s)}}getValues(e){const t={};return this.eachWidget((i,r)=>{i.isolateFields?r.down=!1:"name"in i&&(!e||e(i))&&(t[i.name]=i.value)},!0),t}get hasNoChildren(){const e=this,{items:t,lazyItems:i}=e.initialConfig,r=t&&(ur(t)?t:T.values(t)),n=i&&(ur(i)?i:T.values(i)),s=e.isConfiguring?n||r:e.items;return!(s!=null&&s.filter(nh).length)}afterRecompose(){super.afterRecompose(),this.realign()}updateTextContent(e){const t=this;if(!t.isComposable){const i=Boolean(e&&t.hasNoChildren),{classList:r}=t.contentElement;i!==r.contains("b-text-content")&&(r[i?"add":"remove"]("b-text-content"),t.rendered&&t.realign())}}updateLayoutStyle(e){S.applyStyle(this.contentElement,e)}updateElement(e){if(super.updateElement(...arguments),e){const{classList:t}=this.contentElement,{containerCls:i}=this.layout;t.add("b-content-element"),i&&t.add(i)}}onPaint(){var e;(e=super.onPaint)===null||e===void 0||e.call(this,...arguments),this.getConfig("contentElMutationObserver")}changeContentElMutationObserver(e,t){if(t&&(t.takeRecords(),t.disconnect()),e){const i=this,{element:r,contentElement:n}=i;e=new MutationObserver(s=>i.onContentElMutation(s)),e.observe(n,{attributes:!0}),n!==r&&e.observe(r,{attributes:!0}),i.syncFlexDirection()}return e}onContentElMutation(){qC[this.layout.type]&&this.isVisible&&this.syncFlexDirection()}changeLayout(e,t){return Xt.reconfigure(t,e,{owner:this,defaults:{owner:this}})}get childItems(){return this.items}getWidgetById(e){return this.widgetMap[e]}processWidgetConfig(e){}setupWidgetConfig(e,t){const i=this;typeof e=="string"?e={html:e}:e.nodeType===Element.ELEMENT_NODE&&(e={element:e,id:e.id}),(typeof t=="string"||!t&&(t=e.type))&&(t=N.resolveType(t,!0)),e=(t||N).mergeConfigs(i.defaults,e,{parent:i});for(let r=e.parent;r;r=r.parent)if(r.processWidgetConfig(e)===!1)return null;return i.trigger("beforeWidgetCreate",{widgetConfig:e})===!1?null:e}createWidget(e){const t=N.create(this.setupWidgetConfig(e),this.defaultType);return t&&(t._createdBy=this),t}updateDefaults(e,t){if(!this.isConfiguring&&e){const i=Object.entries(e);this.eachWidget(r=>{i.forEach(([n,s])=>{(!t||r[n]===t[n])&&(r[n]=s)})},!1)}}render(){this.getConfig("lazyItems"),this.layout.renderChildren(),this.syncChildCount(),super.render(...arguments)}get focusElement(){const e=this.query(this.defaultFocus||(t=>{var i;return t.isFocusable&&t.ref!=="close"&&!((i=t.ref)!==null&&i!==void 0&&i.endsWith("collapse"))}));return e?e.focusElement:super.focusElement}doDestroy(){var e;(e=this._items)===null||e===void 0||e.forEach(t=>{var i;return(i=t.destroy)===null||i===void 0?void 0:i.call(t)}),this.layout.destroy(),super.doDestroy()}get isValid(){let e=!0;return this.eachWidget(t=>{t.isVisible&&"isValid"in t&&!t.isValid&&(e=!1)},!0),e}get values(){const e={};return this.gatherValue(e),e}set values(e){this.assignValue(e)}get isSettingValues(){return Boolean(this.assigningValues)}get assigningValues(){var e;return this._assigningValues||((e=this.parent)===null||e===void 0?void 0:e.assigningValues)}set assigningValues(e){this._assigningValues=e}assignValue(e,t){super.assignValue(e,t),this.isolateFields||this.setValues(e,t)}gatherValue(e){super.gatherValue(e),this.isolateFields||this.gatherValues(e)}setValues(e,t){t=t||this.assignValueDefaults,this.assigningValues=t,this.eachWidget(i=>i.assignValue(e,t),!1),this.assigningValues=!1}}wt.initClass();wt._$name="Container";const{assign:wn}=T,sh=()=>performance.now(),KC={start:!1},XC=/^[.\d]+([^\d].*)?$/,Ig=c=>{const e=c.$bryntum||(c.$bryntum={});return e.transitions||(e.transitions=Object.create(null))},ah=(c,e)=>{if(typeof c=="string"){var t;e=(t=XC.exec(c))===null||t===void 0?void 0:t[1],c=parseFloat(c)}return c&&c*(e==="s"||!e&&c<10?1e3:1)},_l=c=>{const e=T.values(Ig(c)).filter(t=>t.completed==null).map(t=>t.toString());c.style.transition=e.join(", ")},Fg=c=>class extends c{static get prototypeProperties(){return{_delay:null,_duration:null,_retain:null,_timing:null,_unit:null,owner:null,reverting:null}}constructor(...t){super(...t),this.id=++ZC}start(){this.startTime=sh()}get delay(){var t,i,r;return ah((t=(i=this._delay)!==null&&i!==void 0?i:(r=this.owner)===null||r===void 0?void 0:r.delay)!==null&&t!==void 0?t:0,this.unit)}set delay(t){this._delay=t}get duration(){var t;const{owner:i,unit:r}=this;return ah((t=this._duration)!==null&&t!==void 0?t:i?i.duration:Te.defaultDuration,r)}set duration(t){this._duration=t}get elapsed(){return sh()-this.startTime}get remaining(){return this.duration-this.elapsed}get retain(){var t,i;return(t=this._retain)!==null&&t!==void 0?t:(i=this.owner)===null||i===void 0?void 0:i.retain}set retain(t){this._retain=t}get timing(){var t,i;return(t=this._timing)!==null&&t!==void 0?t:(i=this.owner)===null||i===void 0?void 0:i.timing}set timing(t){this._timing=t}get unit(){var t,i;return(t=this._unit)!==null&&t!==void 0?t:(i=this.owner)===null||i===void 0?void 0:i.unit}set unit(t){this._unit=t}};let ZC=0;class Wn extends P.mixin(Fg){static get $name(){return"AnimatorTransition"}static get prototypeProperties(){return{element:null,property:null,from:null,to:null,completed:null,promissory:null,reverting:null}}afterConstruct(){super.afterConstruct();const e=this,{element:t,transitions:i}=e;let{property:r}=e;[r,e.to]=S.unitize(r,e.to),e.from=S.unitize(r,e.from)[1],e.promissory=new ed,e.property=r;const n=i[r];i[r]=e;let{from:s}=e;n&&(e.from=n.to,s=null,n.destroy()),s===null&&(s=e.getCurrentStyleValue(),n||(e.from=s)),t.style[r]=s,e.getCurrentStyleValue()}doDestroy(){const e=this;e.finish(!1),e.completed&&!e.retain&&e.clearStyle(),super.doDestroy()}get promise(){var e;return(e=this.promissory)===null||e===void 0?void 0:e.promise}get transitions(){return Ig(this.element)}clearStyle(){this.setStyle("")}finish(e){const t=this,{transitions:i,promissory:r,property:n}=t;r&&(t.completed=e,t.promissory=null,r.resolve(e),i[n]===t?(delete i[n],e||(_l(t.element),t.clearStyle())):t.completed=!1)}getCurrentStyleValue(){return S.getStyleValue(this.element,this.property)}revert(){const{duration:e,elapsed:t,element:i,from:r,property:n,_retain:s,_timing:a}=this;return new Wn({element:i,property:n,retain:s,timing:a,duration:Math.round(Math.min(e,t)),reverting:this,to:r,unit:"ms"})}setStyle(e){this.element.style[this.property]=e}start(){const e=this,{delay:t,duration:i,element:r,property:n}=e;B.onTransitionEnd({element:r,property:n,duration:t+i+20,thisObj:e.owner,handler:()=>{var s;return(s=e.finish)===null||s===void 0?void 0:s.call(e,!0)}}),super.start(),e.setStyle(e.to)}toString(){const{delay:e,duration:t,property:i,timing:r}=this;return`${i} ${t}ms ${r||"ease-in-out"}${e?` ${e}ms`:""}`}}Wn.initClass();class Te extends P.mixin(Fg){static get $name(){return"Animator"}static get prototypeProperties(){return{element:null,finalize:null,prefinalize:null,completed:null,items:null}}static register(e,t){if(T.isObject(e)){T.entries(e).forEach(i=>Te.register(...i));return}Te.fx[e]=t,Te[e]=i=>(S.isElement(i)?i={element:i,[e]:{}}:(i={element:i.element,[e]:i},delete i[e].element),Te.run(i))}static run(e){return new Te(e).start()}constructor(e){var t;super(null);const i=this,r=[],n={};let s,a,o,l;if(Array.isArray(e))i.items=e;else for(o in e)(Te.specialPropsRe.test(o)?i:n)[o]=e[o];T.keys(n).forEach(d=>{l=n[d],l!=null&&l!==!1&&l===l&&((a=Te.fx[d])?(l=wn(i.defaults,a(l,i,d)),l.owner=i,s=new Te(l)):(l=wn(i.defaults,typeof l=="object"?l:{to:l}),l.owner=i,l.property=d,s=new Wn(l)),r.push(s))}),(t=i.items)===null||t===void 0||t.forEach(d=>{T.isInstantiated(d)?d.owner=i:(d=wn(i.defaults,d),d.owner=i,d=new Te(d)),r.push(d)}),i.items=r,i.promise=(r.length===1?r[0].promise:Promise.all(r.map(d=>d.promise))).then(d=>{var u;return(u=i.finish)===null||u===void 0||u.call(i,d),i.completed||!1})}doDestroy(){this.items.forEach(e=>e.destroy()),super.doDestroy()}get defaults(){return{element:this.element}}get retain(){const{_retain:e,finalize:t,owner:i}=this;return e??(t?!1:i?i.retain:!0)}set retain(e){super.retain=e}done(){return this.promise}finish(e){var t,i;const r=this,{items:n}=r;for(_l(r.element),r.completed=typeof e=="boolean"?e:!e.some(s=>!s),(t=r.prefinalize)===null||t===void 0||t.call(r,r.completed,r);n.length;)n.pop().destroy();(i=r.finalize)===null||i===void 0||i.call(r,r.completed,r)}revert(e){var t;const i=this,{reverting:r}=i,n=!e||((t=e.start)!==null&&t!==void 0?t:!0);let s=i.defaults;return r&&(r.finalize&&(s.finalize=r.finalize),r.prefinalize&&(s.prefinalize=r.prefinalize),s.retain=r._retain),s=wn(s,e,{items:i.items.map(a=>a.revert(KC)),reverting:i}),s=new Te(s),n&&s.start(),s}start(){const{element:e,items:t}=this;return super.start(),t.length&&(_l(e),t.forEach(i=>i.start())),this}}Te.initClass().Transition=Wn;Te.specialPropsRe=new RegExp(`^(?:${Object.keys(Te.prototypeProperties).concat(Object.keys(Te.superclass.prototypeProperties)).map(c=>c[0]==="_"?c.substr(1):c).join("|")})$`);Te.defaultDuration=200;Te.fx={};Te.register({puff(c){return c===!0?c={}:typeof c!="object"?c={transform:`scale(${c})`}:c.scale&&(c=T.clone(c),c.transform=`scale(${c.scale})`,delete c.scale),wn({opacity:0,transform:"scale(8)"},c)}});Te._$name="Animator";class td extends P.mixin(he){static get configurable(){return{element:null,delegate:null,delay:500,startRate:2,endRate:20,accelerateDuration:4e3,pressedCls:"b-pressed"}}doDestroy(){var e;(e=this.mousedownRemover)===null||e===void 0||e.call(this),this.cancel(),super.doDestroy()}cancel(){var e,t,i;const r=this;(e=r.activeElement)===null||e===void 0||e.classList.remove(r.pressedCls),r.activeElement=null,(t=r.acceleration)===null||t===void 0||t.cancel(),r.activeListenerRemover=(i=r.activeListenerRemover)===null||i===void 0?void 0:i.call(r),r.clearTimeout(r.autoRepeatTimer),r.clearTimeout(r.repeatTimer)}updateElement(e){var t;(t=this.mousedownRemover)===null||t===void 0||t.call(this),this.mousedownRemover=B.on({element:e,mousedown:"onMouseDown",thisObj:this})}onMouseDown(e){const t=this,i=t.delegate?e.target.closest(t.delegate):t.element;t.cancel(),i&&(t.activeElement=i,t.triggerEvent=e,i.classList.add(t.pressedCls),t.activeListenerRemover=B.on({mouseup:{element:document,capture:!0,handler:"onMouseUp"},mousemove:{element:i,handler:"onTargetMouseMove"},mouseleave:{element:i,handler:"onTargetMouseLeave"},mouseenter:{element:i,handler:"onTargetMouseEnter"},thisObj:t}),t.autoRepeatTimer=t.setTimeout("startAutoRepeat",t.delay))}onMouseUp(){this.cancel()}onTargetMouseLeave(){this.activeElement.classList.remove(this.pressedCls),this.clearTimeout(this.repeatTimer)}onTargetMouseEnter(e){const t=this;e.buttons?(t.activeElement.classList.add(t.pressedCls),t.triggerEvent=e,t.fireClick()):t.cancel()}onTargetMouseMove(e){this.triggerEvent=e}startAutoRepeat(){const e=this;e.interval=e.startInterval=1e3/e.startRate,e.accelerationDelta=e.startInterval-1e3/e.endRate,e.fireClick(),e.acceleration=ve.animate(e.accelerateDuration,e.nextTick,e,"easeOutQuad")}nextTick(e){this.interval=this.startInterval-this.accelerationDelta*e}fireClick(){const e=this,t=new MouseEvent("click",e.triggerEvent);e.triggerEvent.target.dispatchEvent(t),e.repeatTimer=e.setTimeout(e.fireClick,e.interval)}}td._$name="ClickRepeater";const JC=/^(?:undefined|null|LEFT|RIGHT)$/,QC={TOP:"BOTTOM",RIGHT:"LEFT",BOTTOM:"TOP",LEFT:"RIGHT"},Ag=c=>{const e=c?.toUpperCase();return[e,e==="LEFT"||e==="RIGHT"]};var id=c=>class extends(c||P){static get $name(){return"Rotatable"}static get configurable(){return{rotate:null,invertRotate:null}}compose(){const{rotate:t}=this;return{class:{[`b-rotate-${(t||"").toLowerCase()}`]:t,"b-rotate-vertical":t}}}syncRotationToDock(t){if(JC.test(String(this.rotate))){const[i,r]=Ag(t);this.rotate=r?this.invertRotate?QC[i]:i:null}}get widgetClass(){return null}};class Pr extends N.mixin(id){compose(){const{align:e,href:t}=this;return{tag:t!=null?"a":"button",class:{[`b-align-${e||"end"}`]:1,"b-icon":1},listeners:{click:"onInternalClick"}}}get focusElement(){return this.element}get panel(){var e,t;if((e=this.parent)!==null&&e!==void 0&&e.isPanel&&(t=this.element)!==null&&t!==void 0&&t.parentNode.matches(".b-panel-header"))return this.parent}changeAlign(e){return e}onInternalClick(e){const t=this,{handler:i,panel:r}=t,n={domEvent:e,tool:t};t.disabled||(t.trigger("click",n),t.isDestroyed||(t.trigger("action",n),!t.isDestroyed&&r?.trigger("toolClick",n)!==!1&&i&&t.callback(i,r,[e,r,t])))}onInternalKeyDown(e){(e.key.trim()||e.code)==="Enter"&&(e.cancelBubble=!0,e.stopPropagation())}updateDisabled(e,t){var i;super.updateDisabled(e,t),e&&((i=this.repeat)===null||i===void 0||i.cancel())}changeRepeat(e,t){return t?.destroy(),e&&td.new({element:this.element},e)}}M(Pr,"$name","Tool");M(Pr,"type","tool");M(Pr,"configurable",{align:{value:null,$config:{merge:"replace"}},href:null,repeat:null,defaultBindProperty:null});Pr.initClass();Pr._$name="Tool";const ew=/right/i,tw=c=>(c.collapsed||c.collapsing)&&c.owner.expandedHeaderDock==="top"&&c.owner.collapsible.direction.match(ew)?"start":"end";class Lg extends Pr{static get $name(){return"CollapseTool"}static get type(){return"collapsetool"}static get configurable(){return{autoAlign:!0,collapsed:null,collapsing:null,collapsify:!1,direction:"up",defaultBindProperty:null}}compose(){const{collapsed:e,direction:t}=this;return{class:{[`b-icon-collapse-${t}`]:1,"b-collapsed":e}}}changeAutoAlign(e){return e===!0?tw:e}syncAutoAlign(){const{autoAlign:e}=this;e&&(this.align=e(this))}updateAutoAlign(){this.syncAutoAlign()}updateCollapsed(){this.syncAutoAlign()}updateCollapsing(){this.syncAutoAlign()}updateDirection(){this.syncAutoAlign()}}Lg.initClass();Lg._$name="CollapseTool";const oh=/^(?:UP|DOWN|LEFT|RIGHT)$/,iw=/^(left|top)$/i,lh=[],rw=[lh,lh],dh=/^b-dock-(top|left|right|bottom)$/,sl="b-panel-collapse-revealer",nw=/^(?:left|right)$/i,js="b-collapse-unflex",{round:Ci}=Math,ch=["up","down","left","right"].reduce((c,e)=>(c[e.toUpperCase()]=c[e]=e,c),{}),Hl={top:["top","bottom"],right:["right","left"],bottom:["bottom","top"],left:["left","right"]},sw={hl:"LEFT",hr:"RIGHT",vb:"DOWN",vt:"UP"},aw={h:"w",w:"h"},Og={up:"top",right:"right",down:"bottom",left:"left"},la={top:!1,right:!0,bottom:!1,left:!0},ow={top:"UP",right:"RIGHT",bottom:"DOWN",left:"LEFT"},uh={top:c=>`translate(0, -${Ci(c.height||0)}px)`,bottom:c=>`translate(0, ${Ci(c.height||0)}px)`,right:c=>`translate(${Ci(c.width||0)}px, 0)`,left:c=>`translate(-${Ci(c.width||0)}px, 0)`};let lw=0;class qi extends P.mixin(ai){static get $name(){return"PanelCollapser"}static get type(){return"inline"}static get configurable(){return{animation:{duration:200},collapsed:{value:null,$config:null,default:!1},direction:null,collapseTooltip:"L{Collapse}",expandTooltip:"L{Expand}",panel:{value:null,$config:"nullify"},supportAxis:null,tool:{type:"collapsetool",handler(e){var t;(t=this.collapsible)===null||t===void 0||t.onCollapseClick(e)}}}}static get factoryable(){return{defaultType:"inline"}}get collapsing(){return this.collapsingExpanding==="collapsing"}get collapsingExpanding(){var e;const t=(e=this.currentOperation)===null||e===void 0?void 0:e.collapsing;return t==null?null:t?"collapsing":"expanding"}get currentDock(){var e,t,i,r;return(e=(t=this.panel)===null||t===void 0||(i=t.header)===null||i===void 0||(r=i.dock)===null||r===void 0?void 0:r.toLowerCase())!==null&&e!==void 0?e:"top"}get expanding(){return this.collapsingExpanding==="expanding"}get collapseTool(){var e,t;return(e=this.panel)===null||e===void 0||(t=e.tools)===null||t===void 0?void 0:t.collapse}get collapseDim(){return nw.test(this.collapseDir)?"width":"height"}getCollapseDir(e){let{direction:t,panel:i}=this;if(!t||oh.test(t)){const n=i?.placement;if(n)t=sw[n];else{var r;t=ow[(i==null||(r=i.header)===null||r===void 0?void 0:r.dock)||"top"]}}return e?ch[t]:t}get collapseDir(){return this.getCollapseDir(!0)}get collapseDock(){return this.collapseInfo[0]}get collapseInfo(){const{panel:e}=this,t=e.hasHeader&&e.expandedHeaderDock;let i=Og[this.collapseDir],r=!1;return t&&((r=la[i]!==la[t])||(i=t)),[i,r]}get toolsConfig(){const{direction:e,tool:t}=this;return t&&{collapse:T.assign({direction:e.toLowerCase()},t)}}beforeCollapse(e){const{panel:t}=this,{element:i}=t;i.contains(S.getActiveElement(i))&&t.revertFocus(!0)}changeTool(e){const t=this,{panel:i}=t;if(t.isConfiguring||t.isDestroying||!i||i.isDestroying)return e;i.tools={collapse:e}}collapse(e){var t,i,r,n,s;const a=this,{panel:o}=a,l={id:++lw,completed:!1,panel:o};let{currentOperation:d}=a;return e=(t=e)!==null&&t!==void 0?t:!0,T.isObject(e)&&(l.collapsed=!0,T.assign(l,e),e=l.collapsed,delete l.collapsed),l.collapsing=e,l.previous=(i=d)!==null&&i!==void 0?i:null,e!==a.collapsed?d?d.collapsing!==e&&(l.animation=d.animation.revert({finalize(){var u;(u=a.collapseFinalize)===null||u===void 0||u.call(a,l,!0)}}),l.collapsing=e,d=l):(l.animation=T.clone(("animation"in l?l:a).animation),a.beforeCollapse(l)!==!1&&(l.animation&&(l.animation.finalize=u=>{var h;return(h=a.collapseFinalize)===null||h===void 0?void 0:h.call(a,l,u)}),o.changingCollapse=!0,a[e?"collapseBegin":"expandBegin"](l),l.animation?d=l:(l.completed=!0,a[e?"collapseEnd":"expandEnd"](l)),o.changingCollapse=!1,l.animation||a.onComplete(e?"collapse":"expand"))):d&&d.collapsing!==e&&(a[e?"expandRevert":"collapseRevert"](l),l.animation=d.animation.revert({finalize(){var u;(u=a.collapseFinalize)===null||u===void 0||u.call(a,l,!1)}}),d=l),a.currentOperation=d,(r=(n=d)===null||n===void 0||(s=n.animation)===null||s===void 0?void 0:s.done())!==null&&r!==void 0?r:Promise.resolve(e===a.collapsed)}collapseFinalize(e,t){const i=this,{currentOperation:r,panel:n}=i,s=n.collapsed?"expand":"collapse";r===e&&(i.currentOperation=null,e.completed=t,n.changingCollapse=!0,i[s+"End"](e),n.changingCollapse=!1,t&&i.onComplete(s))}applyHeaderDock(e,t=!0){const i=this,{currentDock:r,panel:n}=i,s=e?i.collapseDock:n.expandedHeaderDock;s!==r&&n.hasHeader&&(n.header={dock:s},t&&n.recompose.flush())}composeHeader(e){const{panel:t}=this,{class:i}=e,r=t.expandedHeaderDock||Object.keys(i).filter(n=>i[n]&&dh.test(n)).map(n=>dh.exec(n)[1][0]);return i[sl]=1,i[`b-collapsible-${r[0]}${this.collapseDir[0]}`]=1,e}composeTitle(e){return e.class[sl]=1,e}collapseBegin(e){var t;const i=this,{animation:r}=e,{collapseDim:n,collapseTool:s,panel:a}=i,{element:o,placement:l}=a,[d,u]=i.collapseInfo,h=s?.element.classList,f=!l||l[0]==="h"&&n==="width"||l[0]==="v"&&n==="height";i.configuredWidth=a._lastWidth,i.configuredHeight=a._lastHeight,i.transverseCollapse=u,i.applyHeaderDock(!0);const g=a.rectangle(),m=i.lockInnerSize().moveTo(0,0),p=m.clone(),v=Hl[d],y=(t=a.headerElement)===null||t===void 0?void 0:t.getBoundingClientRect(),C=Ci(y?.[n]||0);o.classList.toggle(js,f),r?(p[v[0]]=p[v[1]],o.classList.add("b-collapsing"),h?.add("b-collapsed","b-collapsing"),s&&(s.collapsing=!0),h&&(h.remove("b-collapsed"),a.rectangle(),h.remove("b-collapsing"),h.add("b-collapsed")),r.element=o,r.retain=!0,r[n]={from:Ci(g[n]),to:C},r.items=[{element:i.innerElement,retain:!1,clip:{from:`rect(${m})`,to:`rect(${p})`}}],u&&r.items.push({element:a.headerElement,duration:r.duration,retain:!1,transform:{from:uh[d](y),to:"translate(0, 0)"}}),e.animation=Te.run(r)):(o.style[n]=`${C}px`,s&&(h.add("b-collapsing","b-collapsed"),s.rectangle(),h.remove("b-collapsing")))}collapseEnd(e){const t=this,{collapseTool:i}=t;t.panel.element.classList.remove("b-collapsing"),i&&(i.collapsing=!1),e.completed?t.collapsed=!0:(t.applyHeaderDock(!1),t.restoreConfiguredSize(),t.lockInnerSize(!1))}collapseRevert(e){var t;(t=this.collapseTool)===null||t===void 0||t.element.classList.remove("b-collapsed")}expandBegin(e){const t=this,{animation:i}=e,{collapseDim:r,collapseTool:n,panel:s}=t,[a,o]=t.collapseInfo,{element:l}=s,d=l.classList,u=d.contains(js),h=s.rectangle();d.remove("b-collapsed","b-collapsing"),s.element.style[r]="",t.restoreConfiguredSize(),t.lockInnerSize(!1);const f=s.rectangle(),g=t.lockInnerSize().moveTo(0,0),m=g.clone(),p=Hl[t.collapseDock];n?.element.classList.remove("b-collapsed"),i&&(m[p[0]]=m[p[1]],d.add("b-collapsed","b-expanding"),u&&d.add(js),i.element=l,i[r]={from:Ci(h[r]),to:Ci(f[r])},i.items=[{element:t.innerElement,retain:!1,clip:{from:`rect(${m})`,to:`rect(${g})`}}],o&&i.items.push({element:s.headerElement,duration:i.duration,retain:!1,transform:{from:"translate(0, 0)",to:uh[a](h)}}),e.animation=Te.run(i))}expandEnd(e){const t=this;t.panel.element.classList.remove("b-expanding"),e.completed&&(t.collapsed=!1,t.applyHeaderDock(!1),t.restoreConfiguredSize(),t.lockInnerSize(!1))}expandRevert(e){var t;(t=this.collapseTool)===null||t===void 0||t.element.classList.add("b-collapsed")}get innerElement(){return this.panel.collapseWrapElement||this.panel.bodyWrapElement}get innerSizeElement(){return this.transverseCollapse?this.panel.element:this.innerElement}get supportAxis(){let{_supportAxis:e}=this;const t=e===!0;return(t||e==null)&&(e=this.collapseDim[0],(t||S.getStyleValue(this.panel.element,"position")==="absolute")&&(e+=aw[e])),e||""}lockInnerSize(e=!0){const t=this,{innerElement:i,panel:r}=t,n=e?t.supportAxis:"",s=r.element,a=r.headerElement,o=e&&a&&$.from(a,s),l=e&&$.from(t.innerSizeElement,s),d=i.style;return a&&(a.style.minWidth=n.includes("w")?`${o.width}px`:"",a.style.minHeight=n.includes("h")?`${o.height}px`:""),d.width=e?`${l.width}px`:"",d.height=e?`${l.height}px`:"",i.classList[e?"add":"remove"]("b-panel-collapse-size-locker"),l}onCollapseClick(e){let t=this.collapsing?!1:this.expanding?!0:!this.collapsed;e.altKey&&(t={animation:null,collapsed:t}),this.collapse(t)}onComplete(e){var t;(t=this.panel)===null||t===void 0||t.trigger(e)}onHeaderClick({event:e}){e.button===0&&this.panel.collapsed&&e.target.classList.contains(sl)&&this.onRevealerClick()}onPanelConfigChange({name:e,value:t}){const i=this,{panel:r}=i;e==="collapsed"?r.isPainted&&(i.collapsed=t):e==="header"&&!r.changingCollapse&&i.syncDirection()}onPanelPaint(){this.syncDirection(),this.panel.collapsed&&!this.collapsed&&this.collapse({animation:null,collapsed:!0})}onRevealerClick(){this.panel._collapse({collapsed:!1})}restoreConfiguredSize(e){var t;const{configuredHeight:i,configuredWidth:r,panel:n}=this;e=(t=e)!==null&&t!==void 0?t:"wh",n.element.classList.remove(js),r!=null&&e.includes("w")&&(n.width=r),i!=null&&e.includes("h")&&(n.height=i)}splitHeaderItems(){return rw}syncDirection(){const e=this,{direction:t}=e;(!t||oh.test(t))&&(e.direction=e.getCollapseDir())}updateCollapsed(e){const{collapseTool:t,panel:i}=this;i&&(i.collapsed=e,i.element.classList[e?"add":"remove"]("b-collapsed")),t&&(t.collapsed=e)}updateDirection(e){const{collapseTool:t,panel:i}=this;t&&(t.direction=ch[e]),i!=null&&i.rendered&&i.recompose()}updatePanel(e){var t;const i=this;i.syncDirection(),(t=i.panelChangeDetacher)===null||t===void 0||t.call(i),i.panelChangeDetacher=e&&ve.after(e,"onConfigChange","onPanelConfigChange",i,{return:!1})}wrapCollapser(e,t){var i;const r=this,[n,s]=r.collapseInfo;if(!s)return[e,t];const{collapseDir:a,panel:o}=r,{expandedHeaderDock:l,header:d,uiClassList:u}=o,h=(i=o.tools)===null||i===void 0?void 0:i.recollapse,[f,g]=r.splitHeaderItems({dock:n,as:"element"}),m=o.hasHeader?o.title||d?.title||"\xA0":null,p=m&&{tag:"header",class:new Q(F(F({},u),{},{[`b-dock-${l}`]:1,"b-panel-header":1,"b-panel-collapser-header":1}),d?.cls),children:[...f,{reference:"collapserTitleElement",html:m,class:F(F({},u),{},{[`b-align-${d?.titleAlign||"start"}`]:1,"b-header-title":1})},...g]};return h&&(h.direction=a),["collapseWrapElement",{class:F(F({},u),{},{[`b-panel-collapser-header-${l}`]:1,[`b-panel-collapser-${a}`]:1,[`b-${la[l]?"h":"v"}box`]:1,"b-panel-collapser":1,"b-box-center":1}),children:iw.test(l)?{collapserHeaderElement:p,[e]:t}:{[e]:t,collapserHeaderElement:p}}]}}qi.maps={clipByDock:Hl,dockByDirection:Og,dockIsHorz:la};qi.initClass();qi._$name="PanelCollapser";const gn=Symbol("pendingCreate");class Ki extends P{static get prototypeProperties(){return{cleanup:null,configName:null,created:null,factory:null,inferType:"name",owner:null,ownerName:null,proxyable:typeof Proxy<"u",setup:null,transform:null}}static get properties(){return{defaults:{},instances:{},object:Object.create({})}}get proxy(){const e=this;let t=null;return e.proxyable&&(t=new Proxy(e.instances,{get(i,r){return e.get(r)},set(i,r,n){return e.set(r,n),!0},deleteProperty(i,r){return e.set(r,null),!0}})),Reflect.defineProperty(e,"proxy",{configurable:!0,value:t}),t}get target(){return this.proxy||this.object}define(e,t){const i=this,{transform:r}=i,n=r?r(t,e):t,s=T.isInstantiated(n);i.instances[e]=gn,s||i.setDefaults(e,n),i.defineProp(e,!0),s&&i.set(e,n)}defineProp(e,t){const i=this,{object:r}=i;i.proxy||Reflect.defineProperty(t?Object.getPrototypeOf(r):r,e,{configurable:!t,enumerable:!0,get(){return i.get(e)},set(n){return i.set(e,n)}})}flush(){const e=this;try{var t;e.updating=!0;for(const i in e.defaults)e.get(i);e.afterConfigureOwner=(t=e.afterConfigureOwner)===null||t===void 0?void 0:t.call(e)}finally{e.updating=!1}}get(e){const{defaults:t,instances:i}=this;return i[e]===gn&&this.set(e,gn),i[e]||t[e]&&null}set(e,t){const i=this,{cleanup:r,configName:n,defaults:s,factory:a,instances:o,owner:l,setup:d,transform:u,updating:h}=i,f=l&&n&&!h,g=o[e]===gn?null:o[e],m=a.reconfigure(g,t===gn?{}:t||null,{cleanup:r&&(v=>r(v,e)),defaults:s[e]||i.setDefaults(e,{}),owner:i.owner,setup:d&&((v,y,C)=>d(v,e,y,C)),transform:u&&(v=>u(v,e))});if(m!==g){const v=f&&F({},o);if(o[e]=m,m){var p;i.defineProp(e),(p=i.created)===null||p===void 0||p.call(i,m,e)}else delete i.object[e],delete o[e];f&&l.onConfigChange({name:n,config:l.$meta.configs[n],value:i.target,was:v})}}setDefaults(e,t){const{defaults:i,factory:r,inferType:n,instances:s,owner:a,ownerName:o}=this,{typeKey:l}=r.factoryable;return t=t===!0?{}:T.assign({},t),(n==="name"||n===!0&&!t[l])&&(t[l]=e),o&&(t[o]=a),t.beforeConfigure=d=>{s[e]=d},i[e]=t}update(e){const t=this,{owner:i}=t;let r,n;try{if(t.updating=!0,e)for(r in e)n=e[r],t.defaults[r]?t.set(r,n):n&&t.define(r,n);else for(r in t.instances)t.set(r,null)}finally{t.updating=!1}i&&(i.isConfiguring?t.afterConfigureOwner||(t.afterConfigureOwner=ve.before(i,"afterConfigure","flush",t)):t.flush())}}Ki.initClass();Ki._$name="DynamicObject";const dw=[],al={},cw={align:1,weight:1};var Pg=c=>class extends(c||N){static get $name(){return"Toolable"}static get configurable(){return{tools:{value:null,$config:{nullify:!0}},toolDefaults:{"*":{type:"tool",align:"end"}}}}byWeightSortFn(t,i){return(t.weight||0)-(i.weight||0)}byWeightReverseSortFn(t,i){return(i.weight||0)-(t.weight||0)}gatherTools({align:t,overlay:i,refs:r}=al){const{collapsed:n,tools:s}=this;let a=[],o,l,d,u,h;for(l in s){var f,g,m,p,v;h=s[l],o=(f=(g=(m=h)===null||m===void 0||(p=m.align)===null||p===void 0?void 0:p.align)!==null&&g!==void 0?g:(v=h)===null||v===void 0?void 0:v.align)!==null&&f!==void 0?f:"end",o===t&&h.isCollapsified(n,i)&&a.push(h)}if(a.sort(this[t==="end"?"byWeightReverseSortFn":"byWeightSortFn"]),r){const y=r==="widget",C={};for(d=0;d<a.length;++d)u=a[d],C[u.ref]=y?u:u.element;a=C}return a}getEndTools({overlay:t,refs:i}=al){return this.gatherTools({align:"end",overlay:t,refs:i})}getStartTools({overlay:t,refs:i}=al){return this.gatherTools({align:"start",overlay:t,refs:i})}get childItems(){return[...this.getStartTools(),...this._items||dw,...this.getEndTools()]}changeTools(t,i){const r=this,n=r.$tools||(r.$tools=new Ki({configName:"tools",factory:N,inferType:!1,owner:r,created(s){var a,o;s.innerItem=!1,(a=s.syncRotationToDock)===null||a===void 0||a.call(s,(o=r.header)===null||o===void 0?void 0:o.dock),ve.after(s,"onConfigChange",(l,{name:d})=>{cw[d]&&r.onConfigChange({name:"tools",value:n.target})}),r.onChildAdd(s)},setup(s,a){return s=T.merge({},r.toolDefaults["*"],r.toolDefaults[a],s),s.parent=r,s.ref=a,s}}));if(n.update(t),!i)return n.target}get widgetClass(){}};const hh=["b-hbox","b-vbox"],uw={name:"align",style:"alignItems"},hw={name:"contentAlign",style:"alignContent"},fw={name:"direction",style:"flexDirection"},gw={name:"justify",style:"justifyContent",classes:["stretch"]},mw={name:"wrap",style:"flexWrap",map:{false:"nowrap",true:"wrap",reverse:"wrap-reverse"}};class Xi extends Xt{get vertical(){return this.horizontal===!1}set vertical(e){return this.horizontal=!e}updateAlign(){this.syncConfigStyle(uw)}updateContentAlign(){this.syncConfigStyle(hw)}updateDirection(){this.syncConfigStyle(fw)}updateHorizontal(){var e;const t=this,i=(e=t.contentElement)===null||e===void 0?void 0:e.classList,r=Number(t.vertical);i?(i.remove(hh[1-r]),i.add(hh[r])):t.syncConfigLater("horizontal"),t.syncDirection()}updateJustify(){this.syncConfigStyle(gw)}updateReverse(){this.syncDirection()}updateWrap(){this.syncConfigStyle(mw)}syncDirection(){const e=this,{reverse:t}=e;e.direction=t?`${e.vertical?"column":"row"}${t?"-reverse":""}`:null}}M(Xi,"$name","Box");M(Xi,"type","box");M(Xi,"alias","hbox");M(Xi,"configurable",{itemCls:"b-box-item",align:null,contentAlign:null,direction:null,horizontal:!0,justify:null,reverse:null,wrap:null});Xi.initClass();Xi._$name="Box";class Un extends Xi{}M(Un,"$name","VBox");M(Un,"type","vbox");M(Un,"configurable",{horizontal:!1});Un.initClass();Un._$name="VBox";var $g=c=>class extends(c||P){static get $name(){return"Badge"}static get configurable(){return{badge:null}}compose(){const{badge:t}=this;return{dataset:{badge:t},class:{"b-badge":t!=null&&t!==""}}}};const fh=/(?:^|\s)b-icon-/,gh=/(?:^|\s)b-fa-/,mh=Symbol("defaultToggleable"),pw=["items","type","widgets","html","listeners"],ph=Symbol("defaultListener");class Ft extends N.mixin($g,id){static get $name(){return"Button"}static get type(){return"button"}static get configurable(){return{icon:null,menuIcon:"b-icon-picker",pressedIcon:null,iconAlign:"start",text:{value:null,$config:null,default:""},color:null,toggleable:mh,pressed:!1,toggleGroup:null,ripple:{radius:75},forwardTwinEvents:["action","toggle"],localizableProperties:["text"],menu:{$config:["lazy","nullify"],value:null},menuDefaults:{type:"menu",autoShow:!1,autoClose:!0,floating:!0,scrollAction:"realign",align:"t0-b0"},href:null,target:null,defaultBindProperty:null}}updateElement(e,t){var i,r,n;const s=this,{constructor:a}=s,o=super.updateElement(e,t),l=s.peekConfig("menu"),d=l?l.isWidget?l.role:((i=a.resolveType(l.type))===null||i===void 0||(r=i.configurable)===null||r===void 0?void 0:r.role)||((n=a.configurable.menuDefaults)===null||n===void 0?void 0:n.type)||"menu":!1;return s.ariaHasPopup=d,o}compose(){const{color:e,href:t,icon:i,iconAlign:r,pressed:n,pressedIcon:s,target:a,text:o,toggleable:l,toggleGroup:d,menuIcon:u}=this,h=this.hasConfig("menu"),f=n&&s?s:i;return{tag:t?"a":"button",href:t,target:a,class:{[`b-icon-align-${r}`]:i,[e]:Boolean(e),"b-pressed":n&&l,"b-text":Boolean(o),"b-has-menu":h},"aria-pressed":n,dataset:{group:d},listeners:{click:"onInternalClick",mousedown:"onInternalMousedown"},children:{iconElement:(i||s)&&{"aria-hidden":!0,tag:"i",class:F(F({},Q.normalize(f,"object")),{},{"b-icon":fh.test(f),"b-fa":gh.test(f)})},label:o&&{tag:"label",text:o},menuIconElement:h&&u&&{tag:"i",class:{"b-icon":fh.test(u),"b-fa":gh.test(u),"b-button-menu-icon":1,[u]:1}}}}}configureOverflowTwin(e){const t=this,i=super.configureOverflowTwin(e);return i.text||(i.text=t.tooltipText),i}onHide(){var e;(e=this._menu)===null||e===void 0||e.hide()}get childItems(){return this._menu&&[this.menu]}onFocusOut(e){var t;super.onFocusOut(e),(t=this.menu)===null||t===void 0||t.hide()}get focusElement(){return this.element}changeText(e){return e??""}changeToggleable(e){return e===mh?this.toggleGroup||this.config.menu:e}changeMenu(e,t){const i=this,{element:r}=i;return e?(e.isWidget?(e.forElement=r,e.owner=i,e.constrainTo=i.rootElement):(typeof e=="object"&&!pw.some(n=>n in e)&&(e={lazyItems:e}),e=N.reconfigure(t,e?T.merge({owner:i,constrainTo:i.rootElement,forElement:r},i.menuDefaults,e):null,i)),e.align.constrainPadding=10,i.detachListeners(ph),e.ion({name:ph,beforeShow:"onMenuBeforeShow",hide:"onMenuHide",show:"onMenuShow",thisObj:this})):t?.destroy(),e}onMenuBeforeShow({source:e}){return this.trigger("beforeShowMenu",{menu:e})}onMenuShow(){this.ariaElement.setAttribute("aria-expanded",!0)}onMenuHide(){this.ariaElement.setAttribute("aria-expanded",!1),this.toggle(!1)}updateMenu(e){this.toggleable=Boolean(e)}updatePressed(e){const t=this;if(!t.toggleable||t.isConfiguring)return;const{menu:i}=t;if(e&&S.forEachSelector(t.rootElement,`button[data-group=${t.toggleGroup}]`,s=>{s!==t.element&&(N.getById(s.id).pressed=!1)}),i){var r,n;i.initialConfig.minWidth||(i.minWidth=t.width),i.align.minHeight=(r=i._minHeight)!==null&&r!==void 0?r:100,i.align.minWidth=(n=i._minWidth)!==null&&n!==void 0?n:100,i[e?"show":"hide"]()}t.trigger("toggle",{pressed:e})}onInternalMousedown(e){var t;(t=this._menu)!==null&&t!==void 0&&t.containsFocus&&this.pressed&&e.preventDefault()}onInternalClick(e){const t=this,i={event:e};t.disabled||t.toggleable&&(t.toggleGroup&&t.pressed||(t.toggle(!t.pressed),t.isDestroyed))||(t.trigger("click",i),t.isDestroyed||t.trigger("action",i),t.href||(e.preventDefault(),e.stopPropagation()))}toggle(e=!this.pressed){this.trigger("beforeToggle",{pressed:e})!==!1&&(this.pressed=e)}}Ft.initClass();Ft._$name="Button";const vh={refs:"element"},vw=c=>c.element.style.margin="",yw=c=>c.isToolbar,yh=c=>c[0]+(c[1].minifiable?0:9e9),_g={hidden:!1,width:""},bw=F(F({},_g),{},{flex:""}),Cw=[{box:"hbox",clientSizeProp:"clientWidth",edgeProp:"right",flexDir:"row",horizontal:!0,max:"maxX",overflow:"overflowX",pos:"x",scrollSize:"scrollWidth",sizeProp:"width"},{box:"vbox",clientSizeProp:"clientHeight",edgeProp:"bottom",flexDir:"column",horizontal:!1,max:"maxY",overflow:"overflowY",pos:"y",scrollSize:"scrollHeight",sizeProp:"height"}],ww={delay:0,startRate:40,endRate:200,accelerateDuration:500},Sw={menu:1,pressed:1};class $r extends wt.mixin(Pg){static get $name(){return"Toolbar"}static get type(){return"toolbar"}static get delayable(){return{syncOverflowVisibility:{type:"raf",cancelOutstanding:!0}}}static get configurable(){return{defaultType:"button",dock:"top",layout:{type:"box"},overflow:{$config:["lazy","nullify"],value:{type:"menu"}},toolDefaults:{overflowMenuButton:{type:"button",hidden:!0,icon:"b-icon-menu",menuIcon:null,defaultCls:{"b-overflow-button":1}},overflowScrollEnd:{handler:"up.onEndScrollClick",hidden:!0,defaultCls:{"b-icon-angle-right":1,"b-overflow-button":1,"b-icon":1}},overflowScrollStart:{align:"start",handler:"up.onStartScrollClick",hidden:!0,defaultCls:{"b-icon-angle-left":1,"b-overflow-button":1,"b-icon":1}}},widgetCls:null,ignoreParentReadOnly:!0}}static get prototypeProperties(){return{flexRowCls:"b-hbox",flexColCls:"b-vbox"}}static getEvictionList(e){const t=e.filter(i=>i.overflowable!=="none");return t.forEach((i,r)=>t[r]=[r,i]),t.sort((i,r)=>yh(r)-yh(i)),t}compose(){const e=this,{axisProps:t,dock:i}=e,r=e.getEndTools(vh),n=e.getStartTools(vh);return{class:{[`b-dock-${i}`]:1,[`b-${i}-toolbar`]:1,[`b-${t.box}`]:1},children:F(F({},n),{},{toolbarContent:{class:{"b-box-center":1,"b-toolbar-content":1}}},r)}}get axisProps(){return Cw[this.layout.horizontal?0:1]}get contentElement(){return this.toolbarContent}get overflowMenuButton(){var e;return(e=this.tools)===null||e===void 0?void 0:e.overflowMenuButton}get overflowType(){const{overflow:e}=this;return typeof e=="string"?e:e?.type}onChildAdd(e){var t;super.onChildAdd(e),this.processAddedLeafItem(e),(t=e.syncRotationToDock)===null||t===void 0||t.call(e,this.dock)}onChildRemove(e){super.onChildRemove(e),this.syncOverflowVisibility()}processAddedLeafItem(e){ve.after(e,"onConfigChange",this.onLeafItemConfigChange,e),e.isContainer&&e.eachWidget(t=>this.processAddedLeafItem(t))}onPaint({firstPaint:e}){var t;(t=super.onPaint)===null||t===void 0||t.call(this,...arguments),e&&this.getConfig("overflow")}updateDock(e){const t=this,{layout:i}=t,{vertical:r}=i;if(i.vertical=Ag(e)[1],!t.initialItems){r!==i.vertical&&t.updateOverflow(t.overflow);for(const s of t.childItems){var n;(n=s.syncRotationToDock)===null||n===void 0||n.call(s,e)}}}updateOverflow(e,t){var i;const r=this,{axisProps:n,contentElement:s,overflowType:a}=r,{flexDir:o}=n,l=(i=r.overflowMenuButton)===null||i===void 0?void 0:i._menu,d={};if(l&&(e?l?.removeAll():l.eachWidget(h=>{h._overflowTwinOrigin.overflowTwin=null})),t==="menu"?d.overflowMenuButton=null:t==="scroll"&&(d.overflowScrollStart=d.overflowScrollEnd=null),a==="menu"){var u;(u=r.scrollable)===null||u===void 0||u.destroy(),s.style.overflow=s.style.overflowX=s.style.overflowY="",d.overflowMenuButton={cls:{[`b-${o}-menu`]:1}}}else if(a==="scroll"){const h=typeof e=="object"&&e?.repeat||ww;r.scrollable={[n.overflow]:"hidden-scroll",element:s,internalListeners:{scroll:"onContentScroll",thisObj:r}},d.overflowScrollStart={repeat:h,invertRotate:!0,cls:{[`b-${o}-start-scroller`]:1}},d.overflowScrollEnd={repeat:h,invertRotate:!0,cls:{[`b-${o}-end-scroller`]:1}}}r.tools=d,a?(s.classList.add("b-overflow"),r.monitorResize=!0,r.syncOverflowVisibility()):(s.classList.remove("b-overflow"),r.monitorResize=!1)}onContentScroll(){this.syncScrollerState()}onStartScrollClick(){this.scrollable[this.axisProps.pos]-=2}onEndScrollClick(){this.scrollable[this.axisProps.pos]+=2}onInternalResize(){super.onInternalResize(...arguments),this.isPainted&&this.syncOverflowVisibility()}syncOverflowVisibility(){const e=this,{overflowType:t,contentElement:i,isVisible:r}=e,{clientSizeProp:n,edgeProp:s,sizeProp:a}=e.axisProps,{overflowMenuButton:o,overflowScrollStart:l,overflowScrollEnd:d}=e.tools,u=e.rtl&&e.layout.horizontal,h=t==="menu",f=()=>Math.ceil(i[n]+(!l||l.hidden?0:l.rectangle("outer")[a])+(!d||d.hidden?0:d.rectangle("outer")[a])),g=()=>{if(I.length===0)return 0;const O=I[I.length-1].rectangle(i);return Math.floor(u?i[n]-O.left:O[s])};let m,p,v,y,C,D,w,E,R,x,k,I;if(!(!r||!t||e.items.length===0)){if(e.inSyncOverflowVisibility=!0,o?.hide(),e.eachWidget((O,_)=>{w=O.minifiable,x=O.overflowable,x=w?x||w:x,O.floating?_.down=!1:(_.down=!x,O.innerItem&&(O._toolbarOverflow&&(O.hidden=O._toolbarOverflow=!1),O._toolbarMinified&&(O.minified=O._toolbarMinified=!1),O.isVisible&&(w&&(E||(E=[])).push(O),x&&(I||(I=[])).push(O))))}),I&&(m=f(),p=g()),I&&p>m)if(h){for(;p>m&&(C=(A=E)===null||A===void 0?void 0:A.pop());){var A;D=p,C._toolbarMinified=!0,C.minified=!0,p=g(),D-=p,(R||(R=[])).push([C,D])}if(p>m){o.show(),m=f(),y=$r.getEvictionList(I);for(v of y)p>m&&(C=v[1],C._toolbarOverflowWidth=C.width,C._toolbarOverflow=!0,C.hidden=!0,I.splice(I.indexOf(C),1),(k||(k=[])).push(v),p=g());if(k){for(k.sort((O,_)=>O[0]-_[0]).forEach((O,_)=>k[_]=O[1]);(L=R)!==null&&L!==void 0&&L.length;){var L;[C,D]=R.pop(),p+D<=m&&!C._toolbarOverflow&&(p+=D,C.minified=C._toolbarMinified=!1)}e.syncOverflowMenuButton(k)}else o.hide()}}else d.show(),l.show(),e.syncScrollerState();else h||(d?.hide(),l?.hide());e.inSyncOverflowVisibility=!1}}syncOverflowMenuButton(e){var t;const i=this,{axisProps:r,overflowMenuButton:n}=i,s={cls:"b-toolbar-overflow-menu",minWidth:280,items:[],align:{align:r.horizontal?"t100-b100":"r100-l100",axisLock:"flexible"}};if(i.addToMenu(s,e.filter(a=>i.overflowItemFilter(a))),(t=n._menu)!==null&&t!==void 0&&t.isMenu){const a=n.menu,{toAdd:o,toRemove:l}=W.delta(s.items,a.items,1);if(a.remove(l),a.items.length)for(let d=o.length-1;d>=0;d--)a.insert(o[d],0);else a.add(o)}else n.menu=s}syncScrollerState(){const e=this,{axisProps:t,scrollable:i}=e,{overflowScrollStart:r,overflowScrollEnd:n}=e.tools,s=i[t.pos],a=i[t.max];r.disabled=!s,n.disabled=Math.abs(Math.ceil(s))>=Math.abs(a)}overflowItemFilter(e){const{filter:t}=this.overflow;return Boolean(t?t.call(this,e):S.getChildElementCount(e.element))}addToMenu(e,t){const i=this.horizontal?bw:_g;for(const r of t){const n=r.ensureOverflowTwin(i,vw);e.items.push(n)}}onLeafItemConfigChange(e,{name:t,value:i}){const r=this,n=r.up(yw),s=n.hasConfig("overflow"),{overflowTwin:a}=r;!s||n!=null&&n.inSyncOverflowVisibility||t==="hidden"&&i===r._toolbarOverflow||(a&&!Sw[t]&&(a[t]=i),n!=null&&n.isPainted&&r.ref!=="overflowMenuButton"&&(r.isTextField&&t==="value"&&(r.containsFocus||a!=null&&a.containsFocus)||n.syncOverflowVisibility()))}createWidget(e){e==="->"?e={type:"widget",cls:"b-toolbar-fill"}:e==="|"?e={type:"widget",cls:"b-toolbar-separator"}:typeof e=="string"&&(e={type:"widget",cls:"b-toolbar-text",html:e});const t=super.createWidget(e);return this.widgetCls&&t.element.classList.add(this.widgetCls),t}}$r.initClass();$r._$name="Toolbar";const Dw=c=>!c.classList.contains("b-focus-trap")&&S.isFocusable(c)?S.NodeFilter.FILTER_ACCEPT:S.NodeFilter.FILTER_SKIP,Nl=[],Ew={},bh=[Nl,Nl],Ch=(c,e,t)=>{const{vertical:i}=c;return delete c.vertical,F(F({},c),{},{class:F(F({},e),{},{[`b-${i?"v":"h"}box`]:1,"b-box-center":1,"b-panel-bar-wrap":!t})})},ol=(c,e,t=!1)=>{const i={vertical:t,children:c?[c]:[]};return e&&(i.tag=e),i},xw={dock:1,hidden:1,weight:1},Ii={top:[!0,!0],bottom:[!0,!1],left:[!1,!0],right:[!1,!1]},wh={header:1,"pre-header":1};class Ye extends wt.mixin(ka,Pg){static get $name(){return"Panel"}static get type(){return"panel"}static get configurable(){return{localizableProperties:["title"],collapsed:{value:null,$config:null,default:!1},collapsible:{value:null,$config:"nullify"},bodyCls:{$config:{merge:"classList"},value:null},bodyTag:null,bodyWrapTag:null,trapFocus:null,title:null,header:null,stateful:["collapsed"],stripDefaults:{"*":{type:"toolbar",dock:"top"},bbar:{dock:"bottom",weight:-1e3},tbar:{weight:-1e3}},strips:{value:null,$config:"nullify"},toolDefaults:{close:{weight:-1e3},collapse:{weight:-990}},footer:null,revealed:null,tbar:null,bbar:null,role:"region"}}updateElement(e,t){const i=super.updateElement(e,t);return this.titleElement&&S.setAttributes(this.ariaElement,{"aria-describedby":this.titleElement.id}),i}compose(){const e=this,{collapsible:t,focusable:i,hasItems:r,revealed:n,tools:s}=e,a=e.composeHeader(),o=a?.class["b-dock-left"]||a?.class["b-dock-right"];let l=e.composeBody(),d="bodyWrapElement";return t&&([d,l]=t.wrapCollapser(d,l)),{tabIndex:r&&i!==!1||i?0:null,class:{[`b-panel-collapsible-${t?.type}`]:t,[`b-panel-collapse-${t?.collapseDir}`]:t,[`b-${o?"h":"v"}box`]:1,"b-panel-collapsible":t,"b-panel-has-header":a,"b-panel-has-tools":s?1:0,"b-panel-overlay-revealed":n},children:{topFocusTrap:{"aria-hidden":!0,tabIndex:0,class:{"b-focus-trap":1}},headerElement:a,[d]:l,bottomFocusTrap:{"aria-hidden":!0,tabIndex:0,class:{"b-focus-trap":1,"b-end-focus-trap":1}}}}}composeBody(){const e=this,{bodyCls:t,bodyConfig:i,bodyWrapTag:r,footer:n,uiClassList:s}=e,a=T.values(e.strips,(p,v)=>!Ii[v?.dock]).sort(e.byWeightSortFn);let o,l,d,u,h,f,g;for(n&&(d=n.dock||"bottom",a.unshift({dock:d,element:{tag:"footer",reference:"footerElement",html:typeof n=="string"?n:n.html,class:F(F({},s),{},{[`b-dock-${d}`]:1,[`${n.cls||""}`]:1})}})),t&&(i[h="className"]||(h="class"),i[h]=new Q(i[h]).assign(t)),u=a.length;u-- >0;)o=a[u],[f,l]=Ii[o.dock],g?g.vertical!==f&&(g=ol(Ch(g,s),"",f)):g=ol(i,r,f),g.children[l?"unshift":"push"](o.element);const m=Ch(g||ol(i,r),s,!0);return m.class["b-panel-body-wrap"]=1,m.class[`b-${e.$$name.toLowerCase()}-body-wrap`]=1,m}get hasHeader(){if(this.header===!1)return!1;const{header:e,title:t,tools:i,parent:r}=this,n=this.maximizable||Object.values(i||{}).some(s=>!s.hidden);return e||!(r!=null&&r.suppressChildHeaders)&&(t||n)}get rootUiClass(){return Ye}composeHeader(e){var t;const i=this;if(!i.hasHeader&&!e)return;const r=i.header||{},n=r.dock||"top",[s,a]=i.splitHeaderItems({dock:n,as:"element"}),o=i.$meta.hierarchy,l=i.composeTitle(r),d=new Q(F({[`b-dock-${n}`]:1},i.uiClassList),r.cls);let u,h;for(u=o.indexOf(Ye);u<o.length;++u)h=o[u].$$name,h!=="Grid"&&(d[`b-${h.toLowerCase()}-header`]=1);const f={tag:"header",class:d,children:[...s,l,...a]};return((t=i.collapsible)===null||t===void 0?void 0:t.composeHeader(f))||f}composeTitle(e){var t;const i=typeof e=="string"?e:this.title||e.title,r={reference:"titleElement",id:`${this.id}-panel-title`,html:i??"\xA0",class:F({[`b-align-${e.titleAlign||"start"}`]:1,"b-header-title":1},this.uiClassList)};return T.isObject(i)&&(delete r.html,T.merge(r,i)),((t=this.collapsible)===null||t===void 0?void 0:t.composeTitle(r))||r}updateTitle(){}afterRecompose(){var e;super.afterRecompose();const t=this,{headerElement:i}=t;(e=t._headerClickDetacher)===null||e===void 0||e.call(t),t._headerClickDetacher=i&&B.on({element:i,click:r=>{var n;return(n=t.trigger)===null||n===void 0?void 0:n.call(t,"headerClick",{event:r})}})}onHeaderClick(e){var t;(t=this.collapsible)===null||t===void 0||t.onHeaderClick(e)}onPaint(){var e;super.onPaint(...arguments),(e=this.collapsible)===null||e===void 0||e.onPanelPaint(this)}splitHeaderItems({as:e,overlay:t,dock:i}=Ew){const r=this,n=e==="element",{collapsed:s}=r,a=r.getEndTools({overlay:t}),o=r.getStartTools({overlay:t}),l=T.values(r.strips,(y,C)=>!wh[C?.dock]&&C.isCollapsified(s,t));let d=bh,u,h,f;if(l.length+a.length+o.length){for(d=[h=[...o,...l.filter(y=>y.dock==="pre-header").sort(r.byWeightSortFn)],u=[...l.filter(y=>y.dock==="header").sort(r.byWeightReverseSortFn),...a]],f=0;f<h.length;++f){var g,m;i&&((g=(m=h[f]).syncRotationToDock)===null||g===void 0||g.call(m,i)),n&&(h[f]=h[f].element)}for(f=0;f<u.length;++f){var p,v;i&&((p=(v=u[f]).syncRotationToDock)===null||p===void 0||p.call(v,i)),n&&(u[f]=u[f].element)}}return d}set bodyConfig(e){this._bodyConfig=e}get bodyConfig(){const e=this,{bodyTag:t}=e,i=T.merge({reference:"bodyElement",className:F(F({},e.getStaticWidgetClasses(Ye,"-content")),{},{"b-box-center":1,"b-text-content":e.textContent&&e.hasNoChildren})},e._bodyConfig);return t&&(i.tag=t),(e.initializingElement||!e._element)&&(i.html=e.content||e._html),i}changeBodyCls(e){return Q.from(e)}changeTbar(e){return this.getConfig("strips"),this.strips={tbar:e},this.strips.tbar}changeBbar(e){return this.getConfig("strips"),this.strips={bbar:e},this.strips.bbar}get childItems(){var e;const t=this,i=T.values(t.strips,(o,l)=>!Ii[l?.dock]).sort(t.byWeightSortFn),[r,n]=t.splitHeaderItems(),[s,a]=((e=t.collapsible)===null||e===void 0?void 0:e.splitHeaderItems())||bh;return[...r,...s,...n,...a,...i.filter(o=>Ii[o.dock][1]),...t._items||Nl,...i.filter(o=>!Ii[o.dock][1]).reverse()]}changeStrips(e,t){const i=this,r=i.$strips||(i.$strips=new Ki({configName:"strips",factory:N,inferType:!1,owner:i,created(n){var s;const{dock:a}=n;if(!wh[a]&&!Ii[a])throw new Error(`Invalid dock value "${a}"; must be: top, left, right, bottom, header, or pre-header`);ve.after(n,"onConfigChange",(o,{name:l})=>{xw[l]&&i.onConfigChange({name:"strips",value:r.target})}),n.innerItem=!1,i.onChildAdd(n),n.parent=i,(s=n.layout)===null||s===void 0||s.renderChildren(),n.hasItems&&(i.hasItems=!0)},setup(n,s){return n=T.merge(T.clone(i.stripDefaults["*"]),i.stripDefaults[s],n),n.parent=i,n.ref=s,n},transform(n){return Array.isArray(n)&&(n={items:n}),n||null}}));if(r.update(e),!t)return r.target}get collapsing(){var e;return(e=this.collapsible)===null||e===void 0?void 0:e.collapsing}get collapsingExpanding(){var e;return(e=this.collapsible)===null||e===void 0?void 0:e.collapsingExpanding}get expanding(){var e;return(e=this.collapsible)===null||e===void 0?void 0:e.expanding}changeCollapsed(e){const t=this,{collapsible:i}=t;if(t.recompose.flush(),e=Boolean(e),!i||t.changingCollapse||!t.isPainted)return e;i?.collapse({animation:null,collapsed:e})}changeCollapsible(e,t){const i=this;return i.getConfig("tools"),e&&(e===!0?e={}:typeof e=="string"&&(e={[Ii[e]?"direction":"type"]:e})),qi.reconfigure(t,e,{owner:i,defaults:{panel:i},cleanup(){i.collapsed&&(t.collapse({animation:null,collapsed:!1}),i._collapsed=1)}})}updateCollapsible(e){const t=this,i=e?.toolsConfig;t.tools={collapse:i?.collapse||null,recollapse:i?.recollapse||null},e&&t.isPainted&&t.collapsed&&(t._collapsed=1),t.collapsed===1&&(t.collapsed=!0)}_collapse(e,t){var i;return t!==!0&&t!==void 0&&(t===!1?e.collapsed=!e.collapsed:typeof t=="number"?e.animation={duration:t}:t===null?e.animation=t:t===!0||("animation"in t?T.merge(e,t):e.animation=t)),(i=this.collapsible)===null||i===void 0?void 0:i.collapse(e)}collapse(e){return this._collapse({collapsed:!0},e)}expand(e){return this._collapse({collapsed:!1},e)}toggleCollapsed(e){return this.collapsed?this.expand(e):this.collapse(e)}get expandedHeaderDock(){var e,t,i;return(e=(t=this._expandedHeaderDock)!==null&&t!==void 0?t:(i=this.initialConfig.header)===null||i===void 0?void 0:i.dock)!==null&&e!==void 0?e:"top"}set expandedHeaderDock(e){this._expandedHeaderDock=e?.toLowerCase()}updateHeader(e){this.changingCollapse||(this.expandedHeaderDock=e?.dock)}updateTrapFocus(e){var t;const i=this;i.element.classList[e?"add":"remove"]("b-focus-trapped"),i.focusTrapListener=(t=i.focusTrapListener)===null||t===void 0?void 0:t.call(i),e&&(i.focusTrapListener=B.on({element:i.element,focusin:"onFocusTrapped",delegate:".b-focus-trap",thisObj:i}),i.treeWalker||(i.treeWalker=this.setupTreeWalker(i.element,S.NodeFilter.SHOW_ELEMENT,Dw)))}setupTreeWalker(e,t,i){return document.createTreeWalker(e,t,i)}onFocusTrapped(e){const t=this,i=t.treeWalker;if(e.target===t.bottomFocusTrap)i.currentNode=t.topFocusTrap,i.nextNode();else if(e.target===t.topFocusTrap)i.currentNode=t.bottomFocusTrap,i.previousNode();else return;t.requestAnimationFrame(()=>i.currentNode.focus())}get focusElement(){return this.hasItems&&(super.focusElement||this.element)}get contentElement(){return this.element&&this.bodyElement}get widgetClassList(){const e=this,t=super.widgetClassList;if(e.hasHeader){var i;t.push("b-panel-has-header",`b-header-dock-${((i=e.header)===null||i===void 0?void 0:i.dock)||"top"}`)}return e.tbar&&t.push("b-panel-has-top-toolbar"),e.bbar&&t.push("b-panel-has-bottom-toolbar"),t}}Ye.initClass();Ye._$name="Panel";class We extends Ye{static get $name(){return"Popup"}static get type(){return"popup"}static get configurable(){return{autoShow:!0,autoClose:!0,showOnClick:!1,forElement:null,monitorResize:!0,floating:!0,hidden:!0,axisLock:!0,hideAnimation:{opacity:{from:1,to:0,duration:".3s",delay:"0s"}},showAnimation:{opacity:{from:0,to:1,duration:".4s",delay:"0s"}},stripDefaults:{bbar:{layout:{justify:"flex-end"}}},testConfig:{hideAnimation:null,showAnimation:null},closeAction:"hide",trapFocus:!0,focusOnToFront:!0,closable:null,maximizable:null,modal:null,maximized:null,tools:{close:{cls:"b-popup-close",handler:"close",weight:-1e3,ariaLabel:"L{Popup.close}",hidden:!0},maximize:{cls:"b-popup-expand",handler:"toggleMaximized",weight:-999,hidden:!0}},highlightReturnedFocus:!0,role:"dialog"}}finalizeInit(){const e=this,{forElement:t}=e;e.anchoredTo=t,e.initialAnchor=e.anchor,t&&e.showOnClick&&(e.initialConfig.autoShow||(e.autoShow=!1),B.on({element:t,click:"onElementUserAction",thisObj:e})),super.finalizeInit(),e.autoShow&&(!t||S.isVisible(t))&&(e.autoShow===!0?e.show():e.setTimeout(()=>e.show(),e.autoShow))}onPaint({firstPaint:e}){var t;(t=super.onPaint)===null||t===void 0||t.call(this,...arguments);const i=this;e&&i.headerElement&&B.on({element:i.headerElement,dblclick:i.onHeaderDblClick,thisObj:i})}doDestroy(){this.syncModalMask(),super.doDestroy()}compose(){const{hasNoChildren:e,textContent:t}=this;return{class:{"b-text-popup":Boolean(t&&e)}}}close(){const e=this;if(!e._hidden&&e.trigger("beforeClose")!==!1||e._hidden&&e.closeAction==="destroy")return e.modal&&e.closeAction==="destroy"&&e.revertFocus(),e.unmask(),e.containsFocus&&e.highlightReturnedFocus&&e.setTimeout(()=>e.element.classList.add("b-using-keyboard"),0),e[e.closeAction]()}toggleMaximized(){this.maximized=!this.maximized}updateMaximized(e){S.toggleClasses(this.element,["b-maximized"],e)}onInternalKeyDown(e){const t=this;e.key==="Escape"&&(e.stopImmediatePropagation(),t.floating||t.positioned?t.close(!0):t.collapsible&&(t.revealed?t.collapsible.toggleReveal():t.collapse()))}onDocumentMouseDown({event:e}){const t=this,{owner:i}=t,{target:r}=e;if(e.type!=="touchend"&&i!==null&&i!==void 0&&i.isButton&&i._menu===t&&i.element.contains(r))return e.preventDefault(),!1;t.modal&&r===We.modalMask?(e.preventDefault(),t.modal.closeOnMaskTap?t.close():t.containsFocus||t.focus()):!t.owns(r)&&t.autoClose&&!t.containsFocus&&t.close()}get isTopModal(){return S.isVisible(We.modalMask)&&this.element.previousElementSibling===We.modalMask}onFocusIn(e){const t=S.getActiveElement(this);super.onFocusIn(e),S.getActiveElement(this)===t&&e.target===this.element&&this.focus()}onFocusOut(e){!(globalThis.visualViewport&&globalThis.visualViewport.height<document.documentElement.clientHeight-1)&&!this.modal&&this.autoClose&&this.close(),super.onFocusOut(e)}onShow(){var e;const t=this;t.autoClose&&t.addDocumentMouseDownListener(),t.focusOnToFront&&t.focus(),(e=super.onShow)===null||e===void 0||e.call(this),t.syncModalMask()}addDocumentMouseDownListener(){this.mouseDownRemover||(this.mouseDownRemover=ue.ion({globaltap:"onDocumentMouseDown",thisObj:this}))}updateModal(e){e&&(this.floating=!0)}syncModalMask(){const e=this,{modal:t,element:i}=e;if(i.setAttribute("aria-modal",Boolean(t)),t&&e.isVisible)typeof e._x!="number"&&typeof e._y!="number"&&(e.centered=!0,e.anchor=!1),e.modalMask.classList.remove("b-hide-display"),i.classList.add("b-modal");else if(e.isPainted){i.classList.remove("b-modal");const r=e.floatRoot.querySelectorAll(".b-modal"),n=r.length?We.fromElement(r[r.length-1],"popup"):null;n?n.syncModalMask():We.modalMask.classList.add("b-hide-display")}}onHide(){var e,t;const i=this;(e=i.mouseDownRemover)===null||e===void 0||e.call(i),i.mouseDownRemover=null,(t=super.onHide)===null||t===void 0||t.call(this),i.syncModalMask()}onElementUserAction(){this.show()}onHeaderDblClick(){this.maximizable&&this.toggleMaximized()}updateClosable(e){this.tools.close.hidden=!e}updateMaximizable(e){this.tools.maximize.hidden=!e}get modalMask(){const{modalMask:e}=We;return e.nextElementSibling!==this.element&&this.floatRoot.insertBefore(e,this.element),e}static get modalMask(){return this._modalMask||(this._modalMask=S.createElement({className:"b-modal-mask b-hide-display"}),B.on({element:this._modalMask,wheel:e=>e.preventDefault()})),this._modalMask}}We.initClass();We._$name="Popup";const Rw=/^b-icon-/,Tw=/^b-fa-/;class wi extends N{static get $name(){return"MenuItem"}static get type(){return"menuitem"}static get configurable(){return{checked:null,separator:null,toggleGroup:null,menu:{value:null,$config:["lazy","nullify"]},icon:null,closeParent:null,href:null,target:null,localizableProperties:["text"],role:"menuitem",closeMenuDelay:200}}updateElement(e,t){const i=super.updateElement(e,t);return typeof this.checked=="boolean"&&(this.role="menuitemcheckbox"),this.ariaHasPopup=this.hasMenu?"menu":!1,i}compose(){var e;const t=this,{checked:i,href:r,hasMenu:n,separator:s,target:a,text:o,toggleGroup:l}=t,d=typeof i=="boolean",u=t.icon||(d?"b-fw-icon":""),h=`b-icon-${l?"radio-":""}`,f=typeof o=="object";return{tag:r?"a":"div",tabIndex:-1,href:r,target:a,class:{"b-has-submenu":n,"b-checked":i,"b-separator":s||((e=t.cls)===null||e===void 0?void 0:e["b-separator"])},dataset:{group:t.toggleGroup},[d?"aria-checked":""]:i,[n?"aria-expanded":""]:!1,children:{iconElement:u&&{"aria-hidden":!0,tag:"i",class:F({"b-fa":Tw.test(u),"b-icon":Rw.test(u),"b-menuitem-icon":1,[`${h}checked`]:i===!0,[`${h}unchecked`]:i===!1},Q.normalize(u,"object"))},textElement:{tag:"span",html:f?null:o,class:{"b-menu-text":1,"b-menu-custom-content":f},children:f?[o]:null},subMenuIcon:n&&{"aria-hidden":!0,tag:"i",class:{"b-fw-icon":1,"b-icon-sub-menu":1}}}}}doAction(e){const t=this,i=this.parent,r={menu:i,item:t,element:t.element,bubbles:!0};if(typeof t.checked=="boolean"){const n=!t.checked;(!t.toggleGroup||n)&&(t.checked=!t.checked)}t.trigger("beforeItem",r),t.trigger("item",r),t.closeParent&&i&&(i.rootMenu.close(),e&&!t.href&&e.preventDefault())}get focusElement(){return this.element}get contentElement(){return this.textElement}get isFocusable(){const{focusElement:e}=this;return e&&this.isVisible&&(e===document.body||e.offsetParent)}get hasMenu(){return this.hasConfig("menu")}get childItems(){const{_menu:e}=this;return e?[e]:[]}get text(){return this.html}set text(e){this.html=e}onFocusIn(e){super.onFocusIn(e),!this.disabled&&this.menu&&this.delay("openMenu",200)}onFocusOut(e){this.clearTimeout("openMenu"),super.onFocusOut(e),this._menu&&(this.menu.closeTimer=this.menu.setTimeout(()=>this.closeMenu(),this.closeMenuDelay))}openMenu(e){const{menu:t}=this;!this.disabled&&t&&(t.focusOnToFront=e,t.show())}onChildShow(e){super.onChildShow(e),this.ariaElement.setAttribute("aria-expanded",!0)}closeMenu(){this._menu instanceof N&&this.menu.close()}onChildHide(e){super.onChildHide(e),this.ariaElement.setAttribute("aria-expanded",!1)}changeToggleGroup(e){return e&&typeof this.checked!="boolean"&&(this.checked=!1),e}changeChecked(e,t){if(this.isConfiguring||typeof t=="boolean")return Boolean(e)}updateChecked(e){const t=this;t.isConfiguring||(t.toggleGroup&&t.uncheckToggleGroupMembers(),t.element.setAttribute("aria-checked",e),t.trigger("toggle",{menu:t.owner,item:t,element:t.element,bubbles:!0,checked:e}))}getToggleGroupMembers(){const e=this,{checked:t,toggleGroup:i,element:r}=e,n=[];return t&&i&&S.forEachSelector(e.rootElement,`[data-group=${i}]`,s=>{if(s!==r){const a=N.fromElement(s);a&&n.push(a)}}),n}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach(e=>e.checked=!1)}get closeParent(){return(typeof this.checked=="boolean"?this._closeParent:this._closeParent!==!1)&&!this.hasMenu}changeMenu(e,t){const i=this,{constrainTo:r,scrollAction:n}=i.owner;return e&&typeof e=="object"&&!("items"in e)&&!("widgets"in e)&&!("html"in e)&&(e={lazyItems:e}),Ln.reconfigure(t,e,{owner:i,defaults:{type:"menu",align:"s0-e0",anchor:!0,autoClose:!0,autoShow:!1,cls:"b-sub-menu",forElement:i.element,owner:i,ariaLabel:i.text,constrainTo:r,scrollAction:n}})}}wi.initClass();wi._$name="MenuItem";const Mw={ArrowUp:1,ArrowDown:1,ArrowRight:1,ArrowLeft:1,Enter:1,Escape:1};class Ln extends We{static get $name(){return"Menu"}static get type(){return"menu"}static get configurable(){return{focusable:!0,align:"t-b",scrollAction:"hide",focusOnHover:null,scrollable:!1,defaultType:"menuitem",tools:{close:!1},role:"menu",ariaElement:"bodyElement"}}construct(e){Array.isArray(e)&&(e={lazyItems:e}),super.construct(e),B.on({element:this.element,click:"onMouseClick",mouseover:"onMouseOver",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",thisObj:this})}afterShow(e){const{items:t,element:i}=this;t.some(s=>Boolean(s._menu))&&i.classList.add("b-menu-with-submenu"),t.some(s=>s.icon)&&i.classList.add("b-menu-with-icon"),super.afterShow(e)}createWidget(e){return typeof e=="string"&&(e={text:e}),super.createWidget(e)}get focusElement(){var e;const t=this,i=(e=t.parentMenu)===null||e===void 0?void 0:e.element.contains(S.getActiveElement(t.parentMenu)),r=t.items[0];return i||S.usingKeyboard||!(r instanceof wi)?super.focusElement:t.element}onDocumentMouseDown({event:e}){if(!this.parentMenu||!this.parentMenu.owns(e.target))return super.onDocumentMouseDown(...arguments)}hide(e){const t=this;if(super.hide(e),!t.isVisible){var i,r;(i=t.currentSubMenu)===null||i===void 0||(r=i.hide)===null||r===void 0||r.call(i,e),t.parentMenu&&(t.parentMenu.currentSubMenu=null)}}show(){super.show(...arguments);const{parentMenu:e}=this;this.isVisible&&e&&(e.currentSubMenu=this)}onMouseClick(e){const t=e.target.closest(".b-menuitem");t&&this.triggerElement(t,e)}onMouseOver(e){if(this.focusOnHover!==!1){var t;const i=(t=e.relatedTarget)===null||t===void 0?void 0:t.closest(".b-widget"),r=e.target.closest(".b-widget"),n=N.fromElement(r);!S.isTouchEvent&&r&&r!==i&&n.parent===this&&this.setTimeout({fn:"handleMouseOver",delay:30,args:[n],cancelOutstanding:!0})}}handleMouseOver(e){e.focus()}onMouseEnter(){this.clearTimeout(this.closeTimer)}onMouseLeave(e){const t=this,{relatedTarget:i}=e,r=i&&t.owns(i);let n=i instanceof HTMLElement&&N.fromElement(i),s=!r;if(n){for(;n.ownerCmp;)n=n.ownerCmp;s&=!S.getAncestor(n.element,[e.target])}!r&&s&&(t.currentSubMenu&&!t.currentSubMenu.closeTimer&&t.currentSubMenu.hide(),t.element.contains(S.getActiveElement(t))&&S.getActiveElement(t).matches(".b-menuitem")&&t.focusElement.focus())}onInternalKeyDown(e){const t=N.fromElement(e),i=t&&t!==this&&!(t instanceof wi);if(e.key==="Escape"){(i?this:this.rootMenu).close();return}if(super.onInternalKeyDown(e),i)return;Mw[e.key]&&e.preventDefault();const r=this.element,n=S.getActiveElement(r);this.navigateFrom(n!==r&&r.contains(n)?n:null,e.key,e)}navigateFrom(e,t,i){const r=this,{treeWalker:n}=r,s=e&&r.getItem(e),a=r.rtl?"ArrowLeft":"ArrowRight",o=r.rtl?"ArrowRight":"ArrowLeft";let l;switch(t){case"ArrowUp":n.currentNode=e||(e=r.bottomFocusTrap),n.previousNode(),l=n.currentNode;break;case"ArrowDown":n.currentNode=e||(e=r.topFocusTrap),n.nextNode(),l=n.currentNode;break;case" ":e&&!e.classList.contains("b-disabled")&&(s!=null&&s.menu?r.openSubMenu(e,s):r.triggerElement(e,i));break;case a:if(e&&s!==null&&s!==void 0&&s.menu&&!e.classList.contains("b-disabled")){const d=r.openSubMenu(e,s);d?.focus()}else n.currentNode=e||(e=r.topFocusTrap),n.nextNode(),l=n.currentNode;break;case o:r.isSubMenu?r.hide():e||(n.currentNode=e||(e=r.topFocusTrap),n.nextNode(),l=n.currentNode);break;case"Enter":e&&!e.classList.contains("b-disabled")&&r.triggerElement(e,i);break}l&&(l===r.element?r.navigateFrom(r.bottomFocusTrap,"ArrowUp",i):l===e?r.navigateFrom(r.topFocusTrap,"ArrowDown",i):l.focus())}getItem(e){if(e!=null)return typeof e=="number"?this.items[e]:e.nodeType===Element.ELEMENT_NODE?N.fromElement(e,"menuitem",this.contentElement):this.items.find(t=>t.id==e)}triggerElement(e,t){const i=this.getItem(e);i&&!i.disabled&&i.doAction(t)}get isSubMenu(){var e;return this===((e=this.owner)===null||e===void 0?void 0:e.menu)}openSubMenu(e,t){const i=this,r=t.menu;if(r){if(!r.isVisible){var n;const s={item:t,element:e};if(i.trigger("beforeSubMenu",s)===!1||((n=t.onBeforeSubMenu)===null||n===void 0?void 0:n.call(t,s))===!1)return;r.show()}return i.currentSubMenu=r}}set selectedElement(e){const t=this,i=t._selectedElement;if(i){const r=t.getItem(i),n=r?.menu;n?.hide(),i.classList.remove("b-active")}if(t._selectedElement=e,e){const r=S.isFocusable(e);e.classList.add("b-active"),t.scrollable.scrollIntoView(e,{animate:!r,focus:r})}}get selectedElement(){return this._selectedElement}selectFirst(){const e=this.treeWalker;e.currentNode=this.topFocusTrap,e.nextNode(),this.requestAnimationFrame(()=>e.currentNode.focus())}get parentMenu(){var e;const t=this.owner;return t&&(t.isMenu?t:(e=t.up)===null||e===void 0?void 0:e.call(t,"menu"))}get rootMenu(){let e=this;for(;e.parentMenu instanceof this.constructor;)e=e.parentMenu;return e}}Ln.initClass();Ln._$name="Menu";let Ws;class Aa extends te{static get $name(){return"ContextMenuBase"}static get configurable(){return{type:null,menu:{$config:["lazy","nullify"],value:{type:"menu",autoShow:!1,closeAction:"hide",scrollAction:"hide",constrainTo:globalThis}},items:{},triggerEvent:!1,keyMap:{" ":{handler:"showContextMenuByKey",weight:100},"Ctrl+Space":"showContextMenuByKey"}}}static get pluginConfig(){return{assign:["showContextMenu"],chain:["onElementContextMenu","onElementClick","onElementDblClick"]}}construct(...e){var t;if(super.construct(...e),!((t=this.type)!==null&&t!==void 0&&t.length))throw new Error("Config 'type' is required to be specified for context menu")}onElementContextMenu(e){this.onElementEvent(e)}onElementClick(e){this.onElementEvent(e)}onElementDblClick(e){this.onElementEvent(e)}onElementEvent(e){if(e.ctrlKey===!0){e.preventDefault();return}if(!e.handled&&this.triggerEvent===e.type){const t=e;if(Ws){const{target:i}=Ws;e=B.fixEvent(new MouseEvent(e.type,e)),Object.defineProperty(e,"target",{get:()=>i,configurable:!0}),e.preventDefault=function(){t.preventDefault(),t.handled=!0}}this.internalShowContextMenu(e)}}showContextMenuByKey(e){if(!S.isEditable(e.target)){const t=this.getKeyboardContextMenuTarget(e.target);if(t)return Ws=e,S.triggerMouseEvent(t,this.triggerEvent),e.handled=!0,e.preventDefault(),e.stopImmediatePropagation(),Ws=null,!0}return!1}getKeyboardContextMenuTarget(e){const t=S.isInView(e);return e.children.length?S.childFromPoint(e,t.width/2,t.height/2):e}internalShowContextMenu(e){const t=this;if(t.disabled)return;const i=t.getDataFromEvent(e);!e.handled&&i&&t.shouldShowMenu(i)&&(e.type==="contextmenu"&&K.isSafari&&e.ctrlKey&&!e.metaKey&&B.on({element:e.target,capture:!0,once:!0,thisObj:this,click(r){r.preventDefault(),r.stopImmediatePropagation()}}),i.domEvent=e,t.showContextMenu(i))}getDataFromEvent(e){return{event:e,targetElement:this.getTargetElementFromEvent(e)}}getTargetElementFromEvent(e){return e.target}showContextMenu(e,t){var i;const r=this,n=S.isDOMEvent(e),s=n?r.getDataFromEvent(e):e,a=n?e:s.domEvent;if((i=r._menu)===null||i===void 0||i.hide(),r.disabled)return;r.menuContext=s;const{type:o,client:l,processItems:d}=r,u=S.isInView(s.targetElement).center;if(U.assign(s,{feature:r,point:a!=null&&a.clientX?[a.clientX+1,a.clientY+1]:[u.x,u.y],menu:r,items:{},selection:l.selectedRecords}),r.callChainablePopulateMenuMethod(s),U.merge(s.items,r.baseItems),r.preventDefaultEvent(s),(!d||r.callback(d,l,[s])!==!1)&&r.hasActiveMenuItems(s)&&(r.populateItemsWithData(s),r.beforeContextMenuShow(s)!==!1)){const{menu:f}=r;if(l.trigger(`${o}MenuBeforeShow`,s)!==!1){var h;f.items=s.items,f.showBy(t||s.point),(h=r.touchMoveDetacher)===null||h===void 0||h.call(r),r.touchMoveDetacher=B.on({element:l.element,touchmove:()=>f.hide(),thisObj:f,once:!0}),a&&(a.preventDefault(),a.handled=!0)}}}get baseItems(){if(!this._baseItems){const e=this,{namedItems:t}=e,i=e._baseItems=U.assign({},e.items);for(const r in i){const n=i[r];n&&(t&&r in t?i[r]=typeof n=="object"?U.merge(U.clone(t[r]),n):t[r]:n===!0&&delete i[r])}}return this._baseItems}hideContextMenu(e){var t;(t=this.menu)===null||t===void 0||t.hide(e)}callChainablePopulateMenuMethod(e){var t,i;(t=(i=this.client)[`populate${z.capitalize(this.type)}Menu`])===null||t===void 0||t.call(i,e)}hasActiveMenuItems(e){return Object.values(e.items).some(t=>t&&!t.hidden)}shouldShowMenu(){return!0}beforeContextMenuShow(e){}populateItemsWithData(e){}preventDefaultEvent(e){var t;(t=e.event)===null||t===void 0||t.preventDefault()}changeTriggerEvent(e){return e||this.client.contextMenuTriggerEvent}changeMenu(e,t){const i=this,{client:r,type:n}=i;if(e)return Ln.reconfigure(t,e?Ln.mergeConfigs({owner:r,rootElement:r.rootElement,onItem(s){r.trigger(`${n}MenuItem`,s)},onToggle(s){r.trigger(`${n}MenuToggleItem`,s)},onDestroy(){i.menu=null},onBeforeItem(s){Object.assign(s,i.menuContext)},onShow({source:s}){i.menuContext.menu=s,r.trigger(`${n}MenuShow`,i.menuContext)}},e):null,i);t!=null&&t.isWidget&&t.destroy()}}Aa._$name="ContextMenuBase";var kw=c=>class extends(c||P){static get $name(){return"DragHelperContainer"}initContainerDrag(){const t=this;if(t.mode||(t.mode="container"),t.mode==="container"&&!t.containers)throw new Error("Container drag mode must specify containers")}grabContainerDrag(t){const i=this;if(!i.ignoreSelector||!t.target.closest(i.ignoreSelector)){const r=S.getAncestor(t.target,i.containers,i.outerElement);if(r){const n=r.getBoundingClientRect();i.context={element:r,valid:!0,action:"container",offsetX:t.pageX-n.left,offsetY:t.pageY-n.top,originalPosition:{parent:r.parentElement,prev:r.previousElementSibling,next:r.nextElementSibling}}}return!0}return!1}startContainerDrag(t){var i;const r=this,{context:n,floatRootOwner:s}=r,{element:a}=n,o=a.cloneNode(!0),l=a.getBoundingClientRect(),d=s?.element.closest(".b-outer");o.classList.add(r.dragProxyCls),o.classList.add(r.draggingCls),(s?.floatRoot||S.getRootElement(a)).appendChild(o),n.dragProxy=o,o.style.width=l.width+"px",o.style.height=l.height+"px",S.setTranslateXY(n.dragProxy,l.left,l.top),n.dragging=a,a.classList.add(r.dropPlaceholderCls),d!=null&&(i=d.parentElement)!==null&&i!==void 0&&i.matches(".b-float-root")&&(o.style.zIndex=s.floatRootMaxZIndex+1)}updateContainerDrag(t){var i;const r=this,{context:n}=r;if(!n.started||!n.targetElement)return;const s=S.getAncestor(n.targetElement,r.containers,"b-gridbase"),a=(i=n.dragging)===null||i===void 0?void 0:i.contains(S.getActiveElement(n.dragging));s&&S.isDescendant(n.element,s)||(a&&ue.suspendFocusEvents(),s&&n.valid?r.moveNextTo(s,t):r.revertPosition(),a&&ue.resumeFocusEvents(),t.preventDefault())}finishContainerDrag(t){const i=this,{context:r}=i,{dragging:n,dragProxy:s,valid:a,draggedTo:o,insertBefore:l,originalPosition:d}=r;n&&(r.valid=a&&o&&(n!==l||d.parent!==o),r.finalize=(u=r.valid)=>{!u&&i.context&&i.revertPosition(),n.classList.remove(i.dropPlaceholderCls),s.remove(),i.reset()},r.async=!1,i.trigger("drop",{context:r,event:t}),r.async||r.finalize())}abortContainerDrag(t=!1,i=null,r=!1){const n=this,{context:s}=n;s.dragging&&(s.dragging.classList.remove(n.dropPlaceholderCls),s.dragProxy.remove(),n.revertPosition()),r||n.trigger(t?"drop":"abort",{context:s,event:i}),n.reset()}updateContainerProxy(t){const i=this,{context:r}=i,n=r.dragProxy;let s=t.pageX-r.offsetX,a=t.pageY-r.offsetY;typeof i.minX=="number"&&(s=Math.max(i.minX,s)),typeof i.maxX=="number"&&(s=Math.min(i.maxX-n.offsetWidth,s)),typeof i.minY=="number"&&(a=Math.max(i.minY,a)),typeof i.maxY=="number"&&(a=Math.min(i.maxY-n.offsetHeight,a)),i.lockX?S.setTranslateY(n,a):i.lockY?S.setTranslateX(n,s):S.setTranslateXY(n,s,a);let o;if(t.type==="touchmove"){const l=t.changedTouches[0];o=S.elementFromPoint(l.clientX,l.clientY)}else o=t.target;r.targetElement=o}moveNextTo(t,i){const{context:r}=this,n=r.dragging,s=t.parentElement;if(t!==n){const a=$.from(t).center.x;this.isRTL&&i.pageX>a||!this.isRTL&&i.pageX<a?(s.insertBefore(n,t),r.insertBefore=t):t.nextElementSibling?t.nextElementSibling!==n?(r.insertBefore=t.nextElementSibling,s.insertBefore(n,t.nextElementSibling)):!r.insertBefore&&n.parentElement.lastElementChild!==n&&(r.insertBefore=t.nextElementSibling):(s.appendChild(n),r.insertBefore=null),r.draggedTo=s}}revertPosition(){const{context:t}=this,{dragging:i}=t,{parent:r,next:n}=t.originalPosition;n?n.previousSibling===i||!n&&i===r.lastChild||r.insertBefore(i,n):r.appendChild(i),t.draggedTo=null}};const Iw={pageXOffset:0,pageYOffset:0};var Fw=c=>class extends he(c||P){static get $name(){return"DragHelperTranslate"}static get configurable(){return{positioning:null,skipUpdatingElement:null}}initTranslateDrag(){const t=this;!t.isElementDraggable&&t.targetSelector&&(t.isElementDraggable=i=>i.closest(t.targetSelector))}grabTranslateDrag(t){const i=this.getTarget(t);return i?(this.context={valid:!0,element:i,startPageX:t.pageX,startPageY:t.pageY,startClientX:t.clientX,startClientY:t.clientY},!0):!1}getTarget(t){return t.target.closest(this.targetSelector)}getX(t){return this.positioning==="absolute"?parseFloat(t.style.left,10):S.getTranslateX(t)}getY(t){return this.positioning==="absolute"?parseFloat(t.style.top,10):S.getTranslateY(t)}getXY(t){return this.positioning==="absolute"?[t.offsetLeft,t.offsetTop]:S.getTranslateXY(t)}setXY(t,i,r){this.skipUpdatingElement||(this.positioning==="absolute"?(t.style.left=i+"px",t.style.top=r+"px"):S.setTranslateXY(t,i,r))}startTranslateDrag(t){const i=this,{context:r,outerElement:n,proxySelector:s}=i,a=i.dragWithin=i.dragWithin||i.cloneTarget&&document.body;let o=r.dragProxy||r.element;const l=o,d=o.parentElement;if(i.cloneTarget){const u=s?o.querySelector(s):o,{width:h,height:f,x:g,y:m}=$.from(u,a);o=i.createProxy(o);let p=g,v=m;if(i.autoSizeClonedTarget&&(o.style.width=`${h}px`,o.style.height=`${f}px`),o.classList.add(i.dragProxyCls,i.draggingCls),o.classList.remove("b-hover","b-selected","b-focused"),a.appendChild(o),!i.autoSizeClonedTarget||s){const y=o.getBoundingClientRect(),{x:C,y:D}=a.getBoundingClientRect(),w=t.clientX-C,E=t.clientY-D+(a!==document.body?document.body.getBoundingClientRect().y:0);p=w-y.width/2,v=E-y.height/2,r.startPageX=t.pageX,r.startPageY=t.pageY}i.setXY(o,p,v),l.classList.add("b-drag-original"),i.hideOriginalElement&&l.classList.add("b-hidden")}o.classList.add(i.draggingCls),Object.assign(r,{element:o,grabbed:l,grabbedParent:d,grabbedNextSibling:o.nextElementSibling,elementStartX:i.getX(o),elementStartY:i.getY(o),elementX:S.getOffsetX(o,a||n),elementY:S.getOffsetY(o,a||n),scrollX:0,scrollY:0,scrollManagerElementContainsDragProxy:!i.cloneTarget||a===n}),a&&(r.parentElement=o.parentElement,a!==o.parentElement&&a.appendChild(o),i.updateTranslateProxy(t))}onDragStarted(){var t;const i=this,{context:r}=i;let{relatedElements:n}=r;if(i.unifiedProxy&&r.element.classList.add("b-drag-main","b-drag-unified-proxy"),((t=n)===null||t===void 0?void 0:t.length)>0){r.relatedElStartPos=[],r.relatedElDragFromPos=[];const{proxySelector:s}=i;let[a,o]=[r.elementStartX,r.elementStartY];r.originalRelatedElements=n,n=r.relatedElements=n.map((l,d)=>{const u=s?l.querySelector(s):l,{x:h,y:f,width:g,height:m}=$.from(u,i.dragWithin),p=i.cloneTarget?i.createProxy(l):l;return p.classList.add(i.draggingCls),p.classList.remove("b-hover","b-selected","b-focused"),i.cloneTarget&&(i.setXY(p,h,f),i.dragWithin.appendChild(p),p.classList.add(i.dragProxyCls),i.autoSizeClonedTarget&&(p.style.width=`${g}px`,p.style.height=`${m}px`),i.hideOriginalElement&&l.classList.add("b-hidden"),l.classList.add("b-drag-original")),r.relatedElStartPos[d]=r.relatedElDragFromPos[d]=i.getXY(p),i.unifiedProxy&&(p.classList.add("b-drag-unified-animation","b-drag-unified-proxy"),a+=i.unifiedOffset,o+=i.unifiedOffset,i.setXY(p,a,o),r.relatedElDragFromPos[d]=[a,o],p.style.zIndex=100-d),p}),i.unifiedProxy&&n&&n.length>0&&B.onTransitionEnd({element:n[0],property:"transform",handler(){n.forEach(l=>l.classList.remove("b-drag-unified-animation"))},thisObj:i,once:!0})}}applyConstraints(t,i,r){const n=this,{constrain:s,dragWithin:a}=n,{pageXOffset:o,pageYOffset:l}=a===document.body?globalThis:Iw;return a&&s&&(i<0&&(i=0),i+t.offsetWidth>a.scrollWidth&&(i=a.scrollWidth-t.offsetWidth),r<0&&(r=0),r+t.offsetHeight>a.scrollHeight&&(r=a.scrollHeight-t.offsetHeight)),typeof n.minX=="number"&&(i=Math.max(n.minX+o,i)),typeof n.maxX=="number"&&(i=Math.min(n.maxX+o,i)),typeof n.minY=="number"&&(r=Math.max(n.minY+l,r)),typeof n.maxY=="number"&&(r=Math.min(n.maxY+l,r)),{constrainedX:i,constrainedY:r}}updateTranslateProxy(t,i){const r=this,{lockX:n,lockY:s,context:a}=r,o=a.dragProxy||a.element,{relatedElements:l,relatedElDragFromPos:d}=a;a.scrollManagerElementContainsDragProxy&&i&&(a.scrollX=i.getRelativeLeftScroll(o),a.scrollY=i.getRelativeTopScroll(o)),a.pageX=t.pageX,a.pageY=t.pageY,a.clientX=t.clientX,a.clientY=t.clientY;let u=a.elementStartX+t.pageX-a.startPageX+a.scrollX,h=a.elementStartY+t.pageY-a.startPageY+a.scrollY;if(r.snapCoordinates){const m=r.snapCoordinates({element:o,newX:u,newY:h});u=m.x,h=m.y}const{constrainedX:f,constrainedY:g}=r.applyConstraints(o,u,h);if((a.started||f!==u||g!==h)&&r.setXY(o,n?void 0:f,s?void 0:g),l){const m=n?0:f-a.elementStartX,p=s?0:g-a.elementStartY;l.forEach((v,y)=>{const[C,D]=d[y];r.setXY(v,C+m,D+p)})}a.newX=f,a.newY=g}async finishTranslateDrag(t){const i=this,r=i.context,{target:n}=t,s=!i.lockX&&Math.round(r.newX)!==Math.round(r.elementStartX),a=!i.lockY&&Math.round(r.newY)!==Math.round(r.elementStartY),o=r.dragProxy||r.element,{relatedElements:l}=r;if(!i.ignoreSamePositionDrop||s||a)if(r.valid===!1)await i.abortTranslateDrag(!0,t);else{const d=!i.allowDropOutside&&$.from(i.dragWithin||i.outerElement);d&&(typeof i.minX!="number"&&i.minX!==!0&&t.pageX<d.left||typeof i.maxX!="number"&&i.maxX!==!0&&t.pageX>d.right||typeof i.minY!="number"&&i.minY!==!0&&t.pageY<d.top||typeof i.maxY!="number"&&i.maxY!==!0&&t.pageY>d.bottom)?(r.valid=!1,await i.abortTranslateDrag(!0,t)):(r.finalize=async(u=r.valid)=>{if(r.finalized){console.warn("DragHelper: Finalizing already finalized drag");return}r.finalized=!0,!u&&i.context&&await i.abortTranslateDrag(!0,null,!0),i.isDestroyed||(i.trigger("dropFinalized",{context:r,event:t,target:n}),i.reset()),!i.cloneTarget&&o.parentElement!==r.grabbedParent&&[o,...l||[]].forEach(h=>h.style.transform="")},r.async=!1,await i.trigger("drop",{context:r,event:t,target:n}),r.async||await r.finalize())}else i.abortTranslateDrag(!1,t)}async abortTranslateDrag(t=!1,i=null,r=!1){var n,s;const a=this,{cloneTarget:o,context:l,proxySelector:d,dragWithin:u,draggingCls:h}=a,{relatedElements:f,relatedElStartPos:g,grabbed:m}=l,p=l.dragProxy||l.element;if((n=a.scrollManager)===null||n===void 0||n.stopMonitoring(),l.aborted){console.warn("DragHelper: Aborting already aborted drag");return}let{elementStartX:v,elementStartY:y}=l;if(p&&l.started){if(!o&&u&&u!==l.grabbedParent&&l.grabbedParent.insertBefore(p,l.grabbedNextSibling),o&&d){const C=m.querySelector(d)||m,{x:D,y:w}=$.from(C);v=D,y=w}p.classList.add("b-aborting"),a.setXY(p,v,y),f?.forEach((C,D)=>{C.classList.remove(h),C.classList.add("b-aborting"),a.setXY(C,g[D][0],g[D][1])}),r||a.trigger(t?"drop":"abort",{context:l,event:i}),!S.isOrphaned(p)&&!a.isDestroying&&await B.waitForTransitionEnd({element:p,property:S.getPropertyTransitionDuration(p,"transform")?"transform":"all",thisObj:a,once:!0,runOnDestroy:!0}),a.isDestroyed||a.trigger("abortFinalized",{context:l,event:i})}(s=a.context)!==null&&s!==void 0&&s.started&&a.reset()}cleanUp(){const t=this,{context:i,cloneTarget:r,draggingCls:n,dragProxyCls:s}=t,a=i.dragProxy||i.element,{relatedElements:o,originalRelatedElements:l,grabbed:d}=i,u=r&&(t.removeProxyAfterDrop||!i.valid),h=[n,"b-aborting",s,"b-drag-main","b-drag-unified-proxy"];a.classList.remove(...h),u&&a.remove(),o?.forEach(f=>{u?f.remove():f.classList.remove(...h)}),d.classList.remove("b-drag-original","b-hidden"),l?.forEach(f=>f.classList.remove("b-hidden","b-drag-original"))}};const hr={move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"};class Yn extends P.mixin(Ie,kw,Fw){static get defaultConfig(){return{dragProxyCls:"b-drag-proxy",invalidCls:"b-drag-invalid",draggingCls:"b-dragging",dropPlaceholderCls:"b-drop-placeholder",dragThreshold:5,outerElement:document.body,dragWithin:null,unifiedProxy:null,monitoringConfig:null,constrain:!0,minX:null,maxX:null,minY:null,maxY:null,mode:"translateXY",isElementDraggable:null,targetSelector:null,dropTargetSelector:null,dropTargetCls:null,proxySelector:null,cloneTarget:!1,autoSizeClonedTarget:!0,hideOriginalElement:!1,containers:null,ignoreSelector:null,startEvent:null,lockX:!1,lockY:!1,touchStartDelay:300,scrollManager:null,snapCoordinates:null,unifiedOffset:5,removeProxyAfterDrop:!0,clickSwallowDuration:50,ignoreSamePositionDrop:!0,allowDropOutside:null,floatRootOwner:null,mouseMoveListenerElement:document,testConfig:{transitionDuration:10,clickSwallowDuration:50,touchStartDelay:100},rtlSource:null,createProxy:null}}construct(e){const t=this;super.construct(e),t.initListeners(),t.isContainerDrag?t.initContainerDrag():t.initTranslateDrag(),t.onScrollManagerScrollCallback=t.onScrollManagerScrollCallback.bind(t)}doDestroy(){this.reset(!0),super.doDestroy()}initListeners(){const e=this,{outerElement:t}=e,i={element:t,pointerdown:"onPointerDown",thisObj:e};e.mouseMoveListenerElement=e.getMouseMoveListenerTarget(t),B.on(i)}getMouseMoveListenerTarget(e){const t=e.getRootNode();let i=this.mouseMoveListenerElement;return t.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&t.mode==="closed"&&(i=e.closest(".b-outer")||i),i}get isRTL(){var e;return Boolean((e=this.rtlSource)===null||e===void 0?void 0:e.rtl)}onPointerDown(e){const t=this;if(e.button!==0||!S.isVisible(e.target)||t.context||t.isElementDraggable&&!t.isElementDraggable(e.target,e))return;if(t.startEvent=e,t.isContainerDrag?t.grabContainerDrag(e):t.grabTranslateDrag(e)){t.blurDetacher=B.on({element:globalThis,blur:t.onWindowBlur,thisObj:t});const r={element:t.mouseMoveListenerElement,thisObj:t,capture:!0,keydown:hr.keydown};if(e.pointerType==="touch"?(t.touchStartTimer=t.setTimeout(()=>t.touchStartTimer=null,t.touchStartDelay,"touchStartDelay"),r.touchmove={handler:hr.touchmove,passive:!1},r.touchend=r.pointerup=hr.touchend):(r.pointermove=hr.move,r.pointerup=hr.up),t.dragListenersDetacher=B.on(r),t.dragWithin&&t.dragWithin!==t.outerElement&&t.outerElement.contains(t.dragWithin)){const n=$.from(t.dragWithin,t.outerElement);t.minY=n.top,t.maxY=n.bottom,t.minX=n.left,t.maxX=n.right}}}internalMove(e){var t;if(e.scrollInitiated)return;const i=this,{context:r}=i,n=B.getDistanceBetween(i.startEvent,e);if(i.touchStartTimer&&n>i.dragThreshold){i.abort(!0);return}if(!i.touchStartTimer&&r!==null&&r!==void 0&&r.element&&(r.started||n>=i.dragThreshold)&&((t=e.target)===null||t===void 0?void 0:t.nodeType)===Node.ELEMENT_NODE){if(!r.started){var a,o;if(i.trigger("beforeDragStart",{context:r,event:e})===!1)return i.abort();i.isContainerDrag?i.startContainerDrag(e):i.startTranslateDrag(e),r.started=!0,(a=i.scrollManager)===null||a===void 0||a.startMonitoring(T.merge({scrollables:[{element:i.dragWithin||i.outerElement}],callback:i.onScrollManagerScrollCallback},i.monitoringConfig)),r.outermostEl=S.getOutermostElement(e.target),r.outermostEl.classList.add("b-draghelper-active"),i.dropTargetSelector&&i.dropTargetCls&&S.getRootElement(i.outerElement).querySelectorAll(i.dropTargetSelector).forEach(l=>l.classList.add(i.dropTargetCls)),i.trigger("dragStart",{context:r,event:e}),(o=i.onDragStarted)===null||o===void 0||o.call(i),i.trigger("afterDragStart",{context:r,event:e})}i.update(e),e.type==="touchmove"&&(e.preventDefault(),e.stopImmediatePropagation())}}onScrollManagerScrollCallback(e){var t;const{lastMouseMoveEvent:i}=this;(t=this.context)!==null&&t!==void 0&&t.element&&i&&(i.isScroll=!0,this.update(i,e))}onTouchMove(e){this.internalMove(e)}onMouseMove(e){this.internalMove(e)}update(e,t){const i=this,{context:r}=i,n=document.scrollingElement||document.body;let s=i.getMouseMoveEventTarget(e);if(e.type==="touchmove"){const l=e.changedTouches[0];s=S.elementFromPoint(l.clientX+n.scrollLeft,l.clientY+n.scrollTop)}r.target=s;let a=i.allowDropOutside||!i.dragWithin||i.dragWithin.contains(e.target);if(a&&i.dropTargetSelector){var o;a=a&&Boolean((o=s)===null||o===void 0?void 0:o.closest(i.dropTargetSelector))}i.isContainerDrag?i.updateContainerProxy(e,t):i.updateTranslateProxy(e,t),r.valid=a,i.trigger("drag",{context:r,event:e}),i.isContainerDrag&&i.updateContainerDrag(e,t),r.valid=r.valid&&a;for(const l of i.draggedElements)l.classList.toggle(i.invalidCls,!r.valid);e&&(i.lastMouseMoveEvent=e)}get draggedElements(){var e;const{context:t}=this;return[t.dragProxy||t.element,...(e=t.relatedElements)!==null&&e!==void 0?e:[]]}async abort(e=!1){var t,i;const r=this,{context:n}=r;(t=r.scrollManager)===null||t===void 0||(i=t.stopMonitoring)===null||i===void 0||i.call(t),r.removeListeners(),n!=null&&n.started&&!n.aborted?(n.element.getBoundingClientRect(),n.valid=!1,r.isContainerDrag?r.abortContainerDrag(void 0,void 0,e):r.abortTranslateDrag(void 0,void 0,e),n.aborted=!0):r.reset(!0)}removeListeners(){var e,t;(e=this.dragListenersDetacher)===null||e===void 0||e.call(this),(t=this.blurDetacher)===null||t===void 0||t.call(this)}reset(e){const t=this,{context:i}=t;if(i!=null&&i.started){for(const r of t.draggedElements)r.classList.remove(t.invalidCls);i.outermostEl.classList.remove("b-draghelper-active"),t.isContainerDrag?i.dragProxy.remove():t.cleanUp(),t.dropTargetSelector&&t.dropTargetCls&&S.getRootElement(t.outerElement).querySelectorAll(t.dropTargetSelector).forEach(r=>r.classList.remove(t.dropTargetCls))}t.removeListeners(),e||t.trigger("reset"),t.context=t.lastMouseMoveEvent=null}onTouchEnd(e){this.onMouseUp(e)}onDocumentClick(e){e.stopPropagation()}onMouseUp(e){const t=this,{context:i}=t;if(t.removeListeners(),i){var r;(r=t.scrollManager)===null||r===void 0||r.stopMonitoring(),i.started?(e.stopPropagation(),i.finalizing=!0,t.isContainerDrag?t.finishContainerDrag(e):t.finishTranslateDrag(e),B.on({element:document,thisObj:t,click:hr.docclick,capture:!0,expires:t.clickSwallowDuration,once:!0})):t.reset(!0)}}onKeyDown(e){var t;(t=this.context)!==null&&t!==void 0&&t.started&&e.key==="Escape"&&(e.stopImmediatePropagation(),this.abort())}onWindowBlur(){this.context&&!this.context.finalizing&&this.abort()}createProxy(e){this.proxySelector&&(e=e.querySelector(this.proxySelector)||e);const t=e.cloneNode(!0);return t.removeAttribute("id"),t}get isContainerDrag(){return this.mode==="container"}async animateProxyTo(e,t={align:"c-c"}){const{context:i,draggedElements:r}=this,{element:n}=i,s=e.isRectangle?e:$.from(e);r.forEach(a=>{a.classList.add("b-drag-final-transition"),S.alignTo(a,s,t)}),await B.waitForTransitionEnd({element:n,property:"all",thisObj:this,once:!0}),r.forEach(a=>a.classList.remove("b-drag-final-transition"))}get isDragging(){var e;return Boolean((e=this.context)===null||e===void 0?void 0:e.started)}getMouseMoveEventTarget(e){return e.isScroll?S.elementFromPoint(e.clientX,e.clientY):e.target}}Yn._$name="DragHelper";const ei={down:"onMouseDown",move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:{handler:"onTouchStart",passive:!1},touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"};class La extends Ie(P){static get defaultConfig(){return{resizingCls:"b-resizing",dragThreshold:5,handleSize:10,dynamicHandleSize:null,reservedSpace:10,touchHandleSize:30,minWidth:1,maxWidth:0,minHeight:1,maxHeight:0,outerElement:document.body,scroller:null,allowResize:null,dragWithin:null,isElementResizable:null,targetSelector:null,leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSelector:null,handleContainerSelector:null,startEvent:null,grab:null,invalidCls:"b-resize-invalid",handleVisibilityThreshold:null,skipTranslate:!1,direction:"horizontal",clickSwallowDuration:50,rtlSource:null}}construct(e){const t=this;super.construct(e),!t.handleSelector&&!K.isHoverableDevice&&(t.handleSize=t.touchHandleSize),t.handleVisibilityThreshold=t.handleVisibilityThreshold||2*t.handleSize,t.initListeners(),t.initResize()}doDestroy(){this.abort(!0),super.doDestroy()}updateSkipUpdatingElement(e){e&&(this.skipTranslate=!0)}initResize(){const e=this;if(!e.isElementResizable&&e.targetSelector&&(e.isElementResizable=t=>t.closest(e.targetSelector)),e.grab){const{edge:t,element:i,event:r}=e.grab;e.startEvent=r;const n=e.getCursorOffsetToElementEdge(r,i,t);e.context={element:i,edge:t,valid:!0,async:!1,elementStartX:S.getTranslateX(i)||i.offsetLeft,elementStartY:S.getTranslateY(i)||i.offsetTop,newX:S.getTranslateX(i)||i.offsetLeft,newY:S.getTranslateY(i)||i.offsetTop,elementWidth:i.offsetWidth,elementHeight:i.offsetHeight,cursorOffset:n,startX:r.clientX+n.x+e.scrollLeft,startY:r.clientY+n.y+e.scrollTop,finalize:()=>{var s;return(s=e.reset)===null||s===void 0?void 0:s.call(e)}},i.classList.add(e.resizingCls),e.internalStartResize(e.isTouch)}}initListeners(){const e=this,t={element:e.outerElement,mousedown:ei.down,touchstart:ei.touchstart,thisObj:e};!e.handleSelector&&K.isHoverableDevice&&(t.mousemove={handler:ei.move,delegate:e.targetSelector},t.mouseleave={handler:"onMouseLeaveTarget",delegate:e.targetSelector,capture:!0}),B.on(t)}get isRTL(){var e;return Boolean((e=this.rtlSource)===null||e===void 0?void 0:e.rtl)}get scrollLeft(){return this.scroller?this.scroller.x:this.outerElement.scrollLeft}get scrollTop(){return this.scroller?this.scroller.y:this.outerElement.scrollTop}internalStartResize(e){const t={element:document,keydown:ei.keydown,thisObj:this};e?(t.touchmove=ei.touchmove,t.touchend=t.pointerup=ei.touchend):(t.mousemove=ei.move,t.mouseup=ei.up),this.removeDragListeners=B.on(t)}removeDragListeners(){}reset(){var e;(e=this.removeDragListeners)===null||e===void 0||e.call(this),this.context=null,this.trigger("reset")}canResize(e,t){return!this.isElementResizable||this.isElementResizable(e,t)}onPointerDown(e,t){const i=this;i.startEvent=t,i.canResize(t.target,t)&&i.grabResizeHandle(e,t)&&(t.stopImmediatePropagation(),t.type==="touchstart"&&t.preventDefault(),i.internalStartResize(e))}onTouchStart(e){e.touches.length>1||this.onPointerDown(!0,e)}onMouseDown(e){e.button===0&&this.onPointerDown(!1,e)}internalMove(e,t){const i=this,{context:r,direction:n}=i;if(r!=null&&r.element&&(r.started||B.getDistanceBetween(i.startEvent,t)>=i.dragThreshold)){if(!r.started){var s;(s=i.scrollManager)===null||s===void 0||s.startMonitoring(T.merge({scrollables:[{element:i.dragWithin||i.outerElement,direction:n}],callback:a=>{var o;return((o=i.context)===null||o===void 0?void 0:o.element)&&i.lastMouseMoveEvent&&i.update(i.lastMouseMoveEvent,a)}},i.monitoringConfig)),i.trigger("resizeStart",{context:r,event:t}),r.started=!0}i.update(t)}else!e&&!i.handleSelector&&i.checkResizeHandles(t)}onTouchMove(e){this.internalMove(!0,e)}onMouseMove(e){this.internalMove(!1,e)}onPointerUp(e,t){var i;const r=this,n=r.context;if((i=r.removeDragListeners)===null||i===void 0||i.call(r),n){var s;(s=r.scrollManager)===null||s===void 0||s.stopMonitoring(),n.started&&B.on({element:document,thisObj:r,click:ei.docclick,expires:r.clickSwallowDuration,capture:!0,once:!0}),r.finishResize(t)}else{var a;(a=r.reset)===null||a===void 0||a.call(r)}}onTouchEnd(e){this.onPointerUp(!0,e)}onMouseUp(e){this.onPointerUp(!1,e)}onDocumentClick(e){e.stopPropagation()}onKeyDown(e){e.key==="Escape"&&this.abort()}update(e){const t=this,i=t.context,r=$.from(t.outerElement);i.currentX=Math.max(Math.min(e.clientX+i.cursorOffset.x,r.right),r.x)+t.scrollLeft,i.currentY=Math.max(Math.min(e.clientY+i.cursorOffset.y,r.bottom),r.y)+t.scrollTop,e&&(t.updateResize(e)&&(t.trigger("resizing",{context:i,event:e}),i.element.classList.toggle(t.invalidCls,i.valid===!1)),t.lastMouseMoveEvent=e)}abort(e=!1){var t,i;const r=this;(t=r.scrollManager)===null||t===void 0||(i=t.stopMonitoring)===null||i===void 0||i.call(t),r.context?r.abortResize(null,e):r.isDestroyed||r.reset()}grabResizeHandle(e,t){const i=this;if(i.allowResize&&!i.allowResize(t.target,t))return!1;const r=i.handleSelector,n=t.type==="touchstart"?t.changedTouches[0]:t,s=n.clientX,a=n.clientY,o=i.targetSelector?t.target.closest(i.targetSelector):t.target;if(o){let l;if(r)if(t.target.matches(r))i.direction==="horizontal"?t.pageX<S.getPageX(o)+o.offsetWidth/2?l=i.isRTL?"right":"left":l=i.isRTL?"left":"right":t.pageY<S.getPageY(o)+o.offsetHeight/2?l="top":l="bottom";else return!1;else if(i.direction==="horizontal"?i.overLeftHandle(t,o)?l=i.isRTL?"right":"left":i.overRightHandle(t,o)&&(l=i.isRTL?"left":"right"):i.overTopHandle(t,o)?l="top":i.overBottomHandle(t,o)&&(l="bottom"),!l)return i.context=null,!1;t.type==="touchstart"&&t.preventDefault();const d=i.getCursorOffsetToElementEdge(n,o,l);if(i.trigger("beforeResizeStart",{element:o,event:t})!==!1)return i.context={element:o,edge:l,isTouch:e,valid:!0,async:!1,direction:i.direction,elementStartX:S.getTranslateX(o)||o.offsetLeft,elementStartY:S.getTranslateY(o)||o.offsetTop,newX:S.getTranslateX(o)||o.offsetLeft,newY:S.getTranslateY(o)||o.offsetTop,elementWidth:o.offsetWidth,elementHeight:o.offsetHeight,cursorOffset:d,startX:s+d.x+i.scrollLeft,startY:a+d.y+i.scrollTop,finalize:()=>{var u;return(u=i.reset)===null||u===void 0?void 0:u.call(i)}},o.classList.add(i.resizingCls),!0}return!1}getCursorOffsetToElementEdge(e,t,i){const r=$.from(t);let n=0,s=0;switch(i){case"left":n=r.x-(this.isRTL?r.width:0)-e.clientX;break;case"right":n=r.x+(this.isRTL?0:r.width)-e.clientX;break;case"top":s=r.y-e.clientY;break;case"bottom":s=r.y+r.height-e.clientY;break}return{x:n,y:s}}checkResizeHandles(e){const t=this,i=t.targetSelector?e.target.closest(t.targetSelector):e.target;if(i&&(!t.allowResize||t.allowResize(e.target,e))){if(t.currentElement=t.handleContainerSelector?e.target.closest(t.handleContainerSelector):e.target,t.currentElement){let r;t.direction==="horizontal"?r=t.overLeftHandle(e,i)||t.overRightHandle(e,i):r=t.overTopHandle(e,i)||t.overBottomHandle(e,i),r?t.highlightHandle():t.unHighlightHandle()}}else t.currentElement&&t.unHighlightHandle()}onMouseLeaveTarget(e){const t=this;t.currentElement=t.handleContainerSelector?e.target.closest(t.handleContainerSelector):e.target,t.currentElement&&t.unHighlightHandle()}updateResize(e){const t=this,{context:i,allowEdgeSwitch:r,skipTranslate:n,skipUpdatingElement:s}=t;let a;r&&(t.direction==="horizontal"?i.edge=i.currentX>i.startX?"right":"left":i.edge=i.currentY>i.startY?"bottom":"top");const{element:o,elementStartX:l,elementStartY:d,elementWidth:u,elementHeight:h,edge:f}=i,{style:g}=o,m=i.currentX-i.startX,p=i.currentY-i.startY,v=S.getExtremalSizePX(o,"minWidth")||t.minWidth,y=S.getExtremalSizePX(o,"maxWidth")||t.maxWidth,C=S.getExtremalSizePX(o,"minHeight")||t.minHeight,D=S.getExtremalSizePX(o,"maxHeight")||t.maxHeight,w=f==="right"&&!t.isRTL||f==="bottom"?1:-1,E=u+m*w,R=h+p*w;let x=Math.max(v,E),k=Math.max(C,R);if(y>0&&(x=Math.min(x,y)),D>0&&(k=Math.min(k,D)),g.flex&&(g.flex=""),t.direction==="horizontal"&&u!==x){if(s||(g.width=Math.abs(x)+"px"),i.newWidth=x,f==="left"||x<0){const I=Math.max(Math.min(l+u-t.minWidth,l+m),0);n||S.setTranslateX(o,Math.round(I)),i.newX=I}else f==="right"&&r&&!n&&S.setTranslateX(o,l);a=!0}else t.direction==="vertical"&&h!==R&&(s||(g.height=Math.abs(k)+"px"),i.newHeight=k,f==="top"||k<0?(i.newY=Math.max(Math.min(d+h-t.minHeight,d+p),0),n||S.setTranslateY(o,i.newY)):f==="bottom"&&r&&!n&&S.setTranslateY(o,d),a=!0);return a}finishResize(e){const t=this,i=t.context,r={context:i,event:e};if(i.element.classList.remove(t.resizingCls),i.started){let s=!1;t.direction==="horizontal"?s=i.newWidth&&i.newWidth!==i.elementWidth:s=i.newHeight&&i.newHeight!==i.elementHeight,t.trigger(s?"resize":"cancel",r),i.async||i.finalize()}else{var n;(n=t.reset)===null||n===void 0||n.call(t)}}abortResize(e=null,t=!1){const i=this,r=i.context;r.element.classList.remove(i.resizingCls),i.direction==="horizontal"?((r.edge==="left"||r.allowEdgeSwitch&&!r.skipTranslate)&&S.setTranslateX(r.element,r.elementStartX),r.element.style.width=r.elementWidth+"px"):(S.setTranslateY(r.element,r.elementStartY),r.element.style.height=r.elementHeight+"px"),!t&&i.trigger("cancel",{context:r,event:e}),i.isDestroyed||i.reset()}highlightHandle(){const e=this,t=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;e.currentElement.classList.add("b-resize-handle"),t.classList.add("b-over-resize-handle")}unHighlightHandle(){const e=this,t=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;t&&t.classList.remove("b-over-resize-handle"),e.currentElement.classList.remove("b-resize-handle"),e.currentElement=null}overAnyHandle(e,t){return this.overStartHandle(e,t)||this.overEndHandle(e,t)}overStartHandle(e,t){return this.direction==="horizontal"?this.overLeftHandle(e,t):this.overTopHandle(e,t)}overEndHandle(e,t){return this.direction==="horizontal"?this.overRightHandle(e,t):this.overBottomHandle(e,t)}getDynamicHandleSize(e,t){const i=e?2:1,{handleSize:r}=this;return this.dynamicHandleSize&&r*i>t-this.reservedSpace?Math.max(Math.floor((t-this.reservedSpace)/i),0):r}overLeftHandle(e,t){const i=this,{offsetWidth:r}=t;if(i.leftHandle&&i.canResize(t,e)&&(r>=i.handleVisibilityThreshold||i.dynamicHandleSize)){const n=$.from(t);return n.width=i.getDynamicHandleSize(i.rightHandle,r),n.width>0&&n.contains(B.getPagePoint(e))}return!1}overRightHandle(e,t){const i=this,{offsetWidth:r}=t;if(i.rightHandle&&i.canResize(t,e)&&(r>=i.handleVisibilityThreshold||i.dynamicHandleSize)){const n=$.from(t);return n.x=n.right-i.getDynamicHandleSize(i.leftHandle,r),n.width>0&&n.contains(B.getPagePoint(e))}return!1}overTopHandle(e,t){const i=this,{offsetHeight:r}=t;if(i.topHandle&&i.canResize(t,e)&&(r>=i.handleVisibilityThreshold||i.dynamicHandleSize)){const n=$.from(t);return n.height=i.getDynamicHandleSize(i.bottomHandle,r),n.height>0&&n.contains(B.getPagePoint(e))}return!1}overBottomHandle(e,t){const i=this,{offsetHeight:r}=t;if(i.bottomHandle&&i.canResize(t,e)&&(r>=i.handleVisibilityThreshold||i.dynamicHandleSize)){const n=$.from(t);return n.y=n.bottom-i.getDynamicHandleSize(i.bottomHandle,r),n.height>0&&n.contains(B.getPagePoint(e))}return!1}}M(La,"configurable",{skipUpdatingElement:null});La._$name="ResizeHelper";const Sh=/>[ \t\r\n]+</g,Aw=/\s\s+/g;class bt{static tpl(e,...t){let i=0,r=t.map((n,s)=>{let a=e[s];return Array.isArray(n)?a+=n.reduce((o,l)=>o+=(typeof l=="string"?l.trim():l)+`
`,""):(n===void 0&&(n=""),a+=typeof n=="string"?n.trim():n),i++,a}).join("");return i<=e.length&&(r+=e[e.length-1]),r.replace(Sh,"><").replace(Aw," ").trim()}static docsTpl(e,...t){let i=0,r=t.map((n,s)=>{let a=e[s];return Array.isArray(n)?a+=n.reduce((o,l)=>o+=(typeof l=="string"?l.trim():l)+`
`,""):(n===void 0&&(n=""),a+=typeof n=="string"?n.trim():n),i++,a}).join("");return i<=e.length&&(r+=e[e.length-1]),r.replace(Sh,"><").trim()}static repeat(e){return function(...t){return bt.tpl(...t).repeat(e)}}static loop(e){}}bt._$name="TemplateHelper";class Lw extends Array{constructor(e,t){super(),this.timeZone=e,this.year=t}}class Ow{constructor(e,t){this.asString=e,this.timeZone=t,this.asArray=$w(e)}get asLocalDate(){return this._asLocalDate||(this._asLocalDate=new Date(...this.asArray)),this._asLocalDate}get asTicksUtc(){return this._asTicksUtc||(this._asTicksUtc=new Date(Date.UTC(...this.asArray)).getTime()),this._asTicksUtc}}const Hg=(c,e)=>{const t=c.toLocaleString("sv-SE",{timeZone:e});return new Ow(t,e)},Pw=(c,e)=>{const{asTicksUtc:t,asString:i}=Hg(new Date(c),e);return{offset:(c-t)/6e4,tzTicksUtc:t,tzString:i}},$w=c=>{const e=c.split(/[\s-:]/).map(t=>t*1);return e[1]-=1,e},_w=-6e4,Hw=36e5,Dh=-864e5,mn=2592e6,Nw=(c,e)=>{const t=Eh.get(c,e);if(t)return t;const i=new Lw(c,e),r=new Date(Date.UTC(e,0,1)).getTime();let n=r,s=mn,a=0,o=[],l=null,d,u,h,f;for(;!f;)({offset:h,tzTicksUtc:d,tzString:u}=Pw(n,c)),l==null?(l=h,i.push({offset:h})):s>0&&h!==l?s=s===mn?Dh:_w:s<0&&h===l&&(s===Dh?s=Hw:(i.length===1?(i.push(o),l=o.offset):(i[0].startTicks=o.startTicks,i[0].startDateString=o.startDateString,f=!0),s=mn)),o={offset:h,startDateString:u,startTicks:d},s===mn&&(n=r,n+=a*mn,a+=1),n+=s,a>11&&(f=!0);return Eh.set(i),i},Eh={_cache:{},get(c,e){var t;return(t=this._cache[c])===null||t===void 0?void 0:t[e]},set(c){const{timeZone:e}=c,{_cache:t}=this;t[e]||(t[e]={}),t[e][c.year]=c}};class Xe{static get $name(){return"TimeZoneHelper"}static toTimeZone(e,t){if(typeof t=="number")return this.toUtcOffset(e,t);const i=Hg(e,t);return i.asArray[3]!==i.asLocalDate.getHours()&&console.error("Incorrect transformation due to local dst"),i.asLocalDate}static fromTimeZone(e,t){if(typeof t=="number")return this.fromUtcOffset(e,t);const i=this.dateAsArray(e),r=Nw(t,e.getUTCFullYear());let n=r[0].offset;if(r.length===2){const s=Date.UTC(...i);s>=r[1].startTicks&&s<r[0].startTicks&&(n=r[1].offset)}return i[4]+=n,new Date(Date.UTC(...i))}static toUtcOffset(e,t){const i=e.getTimezoneOffset()+t;return new Date(e.getTime()+i*60*1e3)}static fromUtcOffset(e,t){const i=-e.getTimezoneOffset()-t;return new Date(e.getTime()+i*60*1e3)}static dateAsArray(e){return[e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()]}}Xe._$name="TimeZoneHelper";class lt extends N{static get $name(){return"Toast"}static get type(){return"toast"}static get configurable(){return{testConfig:{destroyTimeout:1,timeout:100},floating:!0,timeout:2500,autoDestroy:null,destroyTimeout:200,showProgress:!0,color:null,bottomMargin:20}}compose(){const{appendTo:e,color:t,html:i,showProgress:r,style:n,timeout:s}=this;return{parent:e||this.floatRoot,class:F(F({},Q.normalize(t,"object")),{},{"b-toast-hide":1}),html:i,style:n,children:{progressElement:r&&{style:`animation-duration:${s/1e3}s;`,class:{"b-toast-progress":1}}},listeners:{click:"hide"}}}doDestroy(){this.untoast(),super.doDestroy()}get nextBottom(){const{bottomMargin:e,element:t}=this;return parseInt(t.style.bottom,10)+t.offsetHeight+e}async show(){await super.show(...arguments);const e=this,{element:t}=e,{toasts:i}=lt;if(!i.includes(e)){var r,n;t.style.bottom=((r=(n=i[0])===null||n===void 0?void 0:n.nextBottom)!==null&&r!==void 0?r:e.bottomMargin)+"px",i.unshift(e),t.getBoundingClientRect(),t.classList.remove("b-toast-hide"),e.timeout>0&&(e.hideTimeout=e.setTimeout("hide",e.timeout))}}async hide(){const e=this;e.untoast(),e.element.classList.add("b-toast-hide"),e.autoDestroy&&!e.destroyTimer&&(e.destroyTimer=e.setTimeout("destroy",e.destroyTimeout))}untoast(){const{toasts:e}=lt;e.includes(this)&&e.splice(e.indexOf(this),1)}static hideAll(){lt.toasts.slice().reverse().forEach(e=>e.hide())}static show(e){const t=lt.new({autoDestroy:!0,rootElement:document.body},typeof e=="string"?{html:e}:e);return t.show(),t}}lt.toasts=[];lt.initClass();lt._$name="Toast";class Zi{static getById(e){return N.getById(e)}static fromElement(e,t,i){return N.fromElement(e,t,i)}static createWidget(e={}){return e.isWidget?e:N.create(e)}static append(e,t){if(e=Array.isArray(e)&&e||[e],(t instanceof HTMLElement||typeof t=="string")&&(t={appendTo:t}),t.insertFirst){const i=typeof t.insertFirst=="string"?document.getElementById(t.insertFirst):t.insertFirst;i.firstChild?t.insertBefore=i.firstChild:t.appendTo=i}return e.map(i=>N.create(T.assign({},t||{},i)))}static openPopup(e,t){return N.create(T.assign({forElement:e},typeof t=="string"?{html:t}:t),"popup")}static showContextMenu(e,t){const i=this;return i.currentContextMenu&&i.currentContextMenu.destroy(),e instanceof HTMLElement?t.forElement=e:Array.isArray(e)?t.forElement={target:new si(...e)}:e instanceof si&&(t.forElement={target:e}),i.currentContextMenu=N.create(t,"menu"),i.currentContextMenu.ion({destroy:()=>{i.currentContextMenu=null}}),i.currentContextMenu}static attachTooltip(e,t){return N.attachTooltip(e,t)}static hasTooltipAttached(e){return N.resolveType("tooltip").hasTooltipAttached(e)}static destroyTooltipAttached(e){return N.resolveType("tooltip").destroyTooltipAttached(e)}static mask(e,t="Loading"){if(e)return e instanceof HTMLElement&&(e={target:e,text:t}),ze.mask(e,e.target)}static unmask(e,t=!0){e.mask&&(t?e.mask.close():e.mask.hide())}static toast(e){return lt.show(e)}}Zi._$name="WidgetHelper";class Sn{constructor(){this.random100=[46,2,36,46,54,59,18,20,71,55,88,98,13,61,61,40,2,15,3,32,51,45,64,25,81,85,54,13,57,49,64,22,81,94,0,62,17,7,11,2,33,99,85,26,83,83,96,26,20,89,91,38,26,13,11,79,32,30,5,51,70,7,5,56,58,77,37,89,40,80,78,59,26,36,8,51,60,23,86,5,11,96,64,94,87,64,4,78,17,85,35,0,90,86,23,55,53,9,35,59,29,2,64,42,8,49,43,73,6,53,38,9,39,31,32,40,49,13,78,68,20,99,24,78,35,91,73,46,67,76,89,69,30,69,25,3,4,55,1,65,66,76,83,19,67,1,95,24,54,45,56,40,67,92,72,4,69,8,47,50,27,2,38,9,14,83,12,14,62,95,22,47,35,18,38,14,86,64,68,61,52,69,39,93,20,73,32,52,74,6,56,68,99,29,24,92,40,67,6,72,31,41,91,53,80,55,33,97,97,99,18,20,5,27,82,84,61,78,27,67,7,42,75,95,91,25,63,21,70,36,46,0,1,45,84,6,86,15,10,62,96,94,10,23,93,83,94,47,5,29,29,52,51,37,77,96,43,72,43,14,54,14,72,52,4,39,15,26,68,28,25,76,60,50,22,40,72,74,68,58,8,48,40,62,52,24,9,26,47,44,49,96,7,77,90,45,76,47,5,86,1,36,18,42,19,90,34,23,70,32,69,79,0,99,57,80,72,21,19,72,85,68,4,40,86,62,0,63,4,11,69,31,78,31,21,78,29,84,13,53,57,10,26,50,24,30,90,42,51,96,93,21,99,23,81,0,89,43,86,63,93,19,54,71,92,36,4,95,37,99,60,29,23,50,68,95,57,95,77,53,99,78,75,12,92,47,23,14,0,41,98,11,34,64,26,90,50,23,38,31,74,76,16,76,66,23,22,72,48,50,20,36,37,58,5,43,49,64,81,30,8,21,98,75,60,17,50,42,27,38,90,74,45,68,67,27,31,15,58,76,41,99,23,98,53,98,56,19,79,2,4,38,96,24,65,51,43,42,41,60,46,7,90,65,3,27,63,99,51,44,86,1,54,40,15,74,3,81,51,63,87,79,84,72,22,38,96,95,33,41,21,99,21,69,7,49,40,52,41,6,91,19,76,40,54,17,33,11,11,0,1,32,94,33,13,18,45,7,85,61,42,54,45,72,78,96,17,9,80,87,41,96,66,0,8,59,18,21,2,28,64,75,97,32,80,86,97,97,55,2,73,75,11,89,67,58,70,76,12,46,64,17,22,97,25,35,93,57,82,46,57,61,31,74,27,4,32,85,53,86,53,53,42,5,28,50,65,63,70,61,73,37,13,80,7,34,22,3,26,6,62,78,12,56,87,41,58,64,31,27,45,35,18,66,62,43,89,69,94,93,33,74,2,43,85,37,82,41,74,9,15,44,33,42,65,19,1,49,78,12,29,9,78,7,55,12,45,40,33,16,86,14,52,16,73,76,0,98,75,91,78,46,99,95,90,69,78,45,62,55,37,88,49,77,27,83,38,73,39,1,75,40,65,83,54,95,7,73,4,30,26,36,89,21,5,95,11,14,87,45,36,21,77,55,5,66,51,98,48,62,74,58,23,82,30,28,19,53,89,76,98,8,34,70,28,54,16,52,35,93,54,54,72,49,18,93,72,90,71,73,15,60,38,80,76,53,70,39,69,25,5,31,61,46,6,54,34,31,52,33,36,79,76,44,29,28,38,1,66,2,90,91,1,76,78,31,55,37,71,2,3,38,85,0,95,42,2,39,57,87,61,77,98,2,24,80,48,27,47,71,15,7,49,60,86,3,2,29,38,54,36,59,83,27,47,9,36,42,8,73,85,9,16,73,60,39,12,43,25,23,29,28,47,40,77,20,89,22,30,41,59,96,19,56,20,76,73,39,46,72,40,47,37,52,29,79,37,39,50,41,87,66,17,75,31,45,26,88,70,11,90,40,74,9,32,65,72,61,6,93,54,15,84,22,99,47,10,96,4,84,19,85,73,45,25,16,8,94,99,39,28,26,68,87,48,1,65,86,46,86,7,60,82,45,75,38,56,41,35,30,86,91,97,85,45,5,14,69,85,96,37,18,26,16,38,16,1,44,94,85,58,60,20,5,47,52,41,50,71,43,42,67,64,38,65,83,99,78,96,33,20,98,24,6,2,25,16,16,44,63,24,68,56,49,91,15,59,99,27,43,34,28,36,45,1,10,19,54,26,75,17,88,96,63,24,71,93,72,97,66,87,18,86],this.randomCache={},this.rndIndex=0}nextRandom(e){const{randomCache:t}=this;let i;return t[e]?i=t[e]:(i=this.random100.filter(r=>r<e),t[e]=i),i[this.rndIndex++%i.length]}reset(){this.rndIndex=0}fromArray(e){return e[this.nextRandom(e.length)]}randomArray(e,t){const i=[],r=this.nextRandom(t+1),n={};for(let s=0,a=this.nextRandom(e.length);s<r;s++){for(;n[a];)a=this.nextRandom(e.length);n[a]=!0,i.push(e[a])}return i}}Sn._$name="RandomGenerator";const Bw=["Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.","Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.","Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.","Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.","Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui atione voluptatem sequi nesciunt.","Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem.","Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur?","Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?"];class Sr{static reset(){this.rnd.reset(),this.rndTime.reset(),this.rndRating.reset()}static*generate(e,t=!1,i=1){let r,n;if(typeof e=="object"){var s;t=e.randomHeight,i=(s=e.initialId)!==null&&s!==void 0?s:1,r=e.addSkills,n=e.rowCallback,e=e.count}const a=this,{rnd:o,rndTime:l,rndRating:d,rndText:u,firstNames:h,surNames:f,teams:g,foods:m,colors:p,cities:v,skills:y}=a;for(let D=0;D<e;D++){var C;const w=o.fromArray(h),E=o.fromArray(f),R=`${w} ${String.fromCharCode(65+D%25)} ${E}`,x=o.nextRandom(60)+1,k=new Date(2019,0,x),I=new Date(2019,0,x+o.nextRandom(30)+2),A={id:i>-1?D+i:void 0,title:"Row "+D,name:R,firstName:w,surName:E,city:o.fromArray(v),team:o.fromArray(v)+" "+o.fromArray(g),age:10+o.nextRandom(80),food:o.fromArray(m),color:o.fromArray(p),score:o.nextRandom(100)*10,rank:o.nextRandom(100)+1,start:k,finish:I,time:b.getTime(l.nextRandom(24),l.nextRandom(12)*5),percent:o.nextRandom(100),done:o.nextRandom(100)<50,rating:d.nextRandom(5),relatedTo:Math.min(e-1,D+i+o.nextRandom(10)),notes:Bw[u.nextRandom(7)+1]};r&&(A.skills=o.randomArray(y,7));const L=(C=n)===null||C===void 0?void 0:C(A);L&&Object.assign(A,L),t&&(A.rowHeight=o.nextRandom(t===!0?20:t)*5+20),yield A}}static generateData(e,t=!1,i=1,r=!0){let n=e;typeof e!="object"&&(n={count:e,randomHeight:t,initialId:i,reset:r}),n.reset!==!1&&this.reset(),Sr.overrideRowCount&&(n.count=Sr.overrideRowCount);const s=[],a=this.generate(n);for(let o=0;o<n.count;o++)s.push(a.next().value);return s}static generateEvents({viewStartDate:e,viewEndDate:t,nbrResources:i=50,nbrEvents:r=5,dependencies:n,tickUnit:s="days",minDuration:a=2,maxDuration:o=10}){const l=this.generateData(i),d=[];n=[];for(let u=0;u<i;u++)for(let h=0;h<r;h++){const f=b.getDurationInUnit(e,t,s),g=b.add(e,Math.round(Math.random()*.9*f),s),m=Math.round(Math.random()*(o-a))+a,p=b.add(g,m,"days"),v=d.length+1;d.push({id:v,name:this.tasks[(u+h)%(this.tasks.length-1)],startDate:g,duration:m,endDate:p,resourceId:u}),n&&u>0&&n.push({id:n.length+1,from:v-1,to:v})}return{resources:l,events:d,dependencies:n}}static generateRow(){return Sr.generateData(1,!1,-1,!1)[0]}}Object.assign(Sr,{rnd:new Sn,rndTime:new Sn,rndRating:new Sn,rndText:new Sn,cities:["Stockholm","Barcelona","Paris","Dubai","New York","San Francisco","Washington","Moscow"],firstNames:["Mike","Linda","Don","Karen","Doug","Jenny","Daniel","Melissa","John","Jane","Theo","Lisa","Adam","Mary","Barbara","James","David"],surNames:["McGregor","Ewans","Scott","Smith","Johnson","Adams","Williams","Brown","Jones","Miller","Davis","More","Wilson","Taylor","Anderson","Thomas","Jackson"],teams:["Lions","Eagles","Tigers","Horses","Dogs","Cats","Panthers","Rats","Ducks","Cougars","Hens","Roosters"],foods:["Pancake","Burger","Fish n chips","Carbonara","Taco","Salad","Bolognese","Mac n cheese","Waffles"],colors:["Blue","Green","Red","Yellow","Pink","Purple","Orange","Teal","Black"],skills:["JavaScript","CSS","TypeScript","React","Vue","Angular","Java","PHP","Python","C#","C++","BASIC","COBOL","FORTRAN","PASCAL","SQL"],tasks:["Meetings","Documentation","Email communication","Project management","Budgeting","Marketing and advertising","Customer service","Research and analysis","Data entry","IT support","Employee management","Sales and business development","Event planning","Graphic design","Writing and editing","Presentation","Travel arrangements and expense management","Training and development","Quality assurance","Customer support","Technical writing","Social media management","Translation","Legal research","Data analysis and visualization","Video editing and production","Network admin","Content creation","Market research","Public relations","Teaching and training","Recruiting","Product development"]});Sr._$name="DataGenerator";const zw=["action","target","to","deltaX","deltaY","x","y","text"];class Vw extends Ie(he()){static get defaultConfig(){return{repeat:!0,outerElement:document.body,callOnFunctions:!0}}construct(e){super.construct(e);const t=this;t.widget&&(t.outerElement=t.widget.element,t.widget.playingDemo=!0),B.playingDemo=!0,Object.assign(t,{prevTarget:null,currentStep:0,mouse:S.createElement({parent:t.outerElement,tag:"div",className:"simulated-mouse"}),timeoutId:null,innerIntervalId:null,mouseOutElements:[]}),t.intervalId=t.setInterval(t.nextStep.bind(t),1e3),t.outerElement.classList.add("b-playing-demo"),t.outerElement.addEventListener("click",i=>{i.isTrusted&&t.abort()})}doDestroy(){this.abort()}abort(e=!1){const t=this;t.mouse.style.top="-100px",t.clearInterval(t.intervalId),t.timeoutId&&t.clearTimeout(t.timeoutId),t.innerIntervalId&&t.clearInterval(t.innerIntervalId),t.outerElement.classList.remove("b-playing-demo"),t.widget&&(t.widget.playingDemo=!1),B.playingDemo=!1,t.trigger(e?"done":"abort")}triggerEvent(e,t,i){if(!e)return null;let r;if(t.startsWith("mouse")){const n=this.mouse.getBoundingClientRect();r=new MouseEvent(t,Object.assign({view:globalThis,bubbles:!0,cancelable:!0,clientX:n.left,clientY:n.top},i||{}))}else r=document.createEvent("Event"),r.initEvent(t,!0,!1);return e.dispatchEvent(r),r}handleMouseMove(e,t){const i=this,r=i.mouse;r.classList.add("quick"),i.mouseDown&&r.classList.add("drag");const n=$.from(r,i.outerElement),s=n.x,a=n.y;let o=0,l=0;if(e.to)if(typeof e.to=="string"){const u=i.outerElement.querySelector(e.to);if(u){const h=$.from(u,i.outerElement),f=h.x+h.width/2,g=h.y+h.height/2;o=(f-s)/10,l=(g-a)/10}}else e.to.x?o=(e.to.x-s)/10:(o=e.to[0]/10,l=e.to[1]/10);else e.deltaX?o=e.deltaX/10:e.x&&(o=(e.x-s)/10);e.deltaY&&(l=e.deltaY/10);let d=0;i.innerIntervalId=i.setInterval(()=>{if(i.shouldPause)return;d++===9&&(clearInterval(i.innerIntervalId),e.then&&e.then());const u=s+o*d,h=a+l*d;r.style.left=u+"px",r.style.top=h+"px";const f=r.getBoundingClientRect(),g=f.left,m=f.top,p=S.elementFromPoint(g,m);p!==i.prevTarget&&(i.prevTarget&&(i.mouseOutElements.push(i.prevTarget),S.isDescendant(i.mouseOutElements[0],p)||(i.mouseOutElements.forEach(v=>i.triggerEvent(v,"mouseout")),i.mouseOutElements.length=0)),i.prevTarget=p,i.triggerEvent(p,"mouseover")),i.triggerEvent(p,e.action,{clientX:g,clientY:m})},50)}getTarget(e){const t=this,i=e.target;return i?typeof i=="function"?i(e):document.querySelector(i):t.prevTarget||t.outerElement}normalizeStep(e){if(e.action)return typeof e.action=="function"?e.action(e):e;if(typeof e=="function")return e(),e;for(const t in e)Object.hasOwnProperty.call(e,t)&&!zw.includes(t)&&(e.action=t.toLowerCase(),e.to=e[t]);return!e.target&&(typeof e.to=="string"||typeof e.to=="function")&&(e.target=e.to),e}get isScrolling(){const e=this,t=e.outerElement.getBoundingClientRect(),i=e.lastTop&&t.top!==e.lastTop;return e.lastTop=t.top,i}get isInView(){const e=this.outerElement.getBoundingClientRect();return e.top<globalThis.innerHeight&&e.bottom>0}get shouldPause(){return!this.isInView||this.isScrolling||document.hidden||!document.hasFocus()}nextStep(){const e=this;if(e.shouldPause)return;if(e.currentStep===e.steps.length)if(e.repeat)e.currentStep=0;else return e.abort(!0);e.currentStep===0&&e.trigger("initialize");const t=e.mouse,i=e.normalizeStep(e.steps[e.currentStep++]),r=e.getTarget(i),n=i.action;if(r&&n)if(t.className="simulated-mouse",n==="mousemove")e.handleMouseMove(i,r);else{if(r!==e.prevTarget){const s=$.from(r,e.outerElement);t.style.left=s.x+s.width/2+"px",t.style.top=s.y+s.height/2+"px"}n==="mousedown"&&(e.mouseDown=!0),n==="mouseup"&&(e.mouseDown=!1),e.timeoutId=e.setTimeout(()=>{if(e.prevTarget=r,t.classList.add(n),n==="type"){const s=N.fromElement(r),a=i.text.split("|");s.value=a[a.length===1||s.value!=a[0]?0:1]}else e.triggerEvent(r,n)},n==="type"?100:550)}}}Vw._$name="DemoBot";const xh=Object.prototype.hasOwnProperty;let ll=null;function jw(c,e){return Object.defineProperty(c,"parser",{value:e}),e}class Ww{constructor(e){this.formatter=e}format(e){return this.formatter.defaultFormat(e)}parse(e,t){return this.formatter.defaultParse(e,t)}resolvedOptions(){return null}}class rd{static get(e){if(e==null)return this.NULL;if(e instanceof this)return e;const t=typeof e=="string"?e:JSON.stringify(e),i=this.cache;let r=i.get(t);return r||(ll=t,r=new this(e),i.set(t,r)),r}static get cache(){return xh.call(this,"_cache")&&this._cache||(this._cache=new Map)}static get NULL(){return xh.call(this,"_null")?this._null:this._null=new this(null)}constructor(e){const t=this;if(t.cacheKey=ll,ll=null,t.initialize(),e===null)t.formatter=new Ww(t);else{t.configure(e);for(const[i,r]of Object.entries(t.resolvedOptions()))r!=null&&i in t.defaults&&(t[i]=r)}}get parser(){return jw(this,new this.constructor.Parser(this))}defaultFormat(e){return e==null?e:String(e)}defaultParse(e){return e}format(e){return e==null?e:this.formatter.format(e)}parse(e,t){return e==null?e:this.parser.parse(e,t)}parseStrict(e){return this.parse(e,!0)}resolvedOptions(){return this.formatter.resolvedOptions()}}rd._$name="Formatter";class xr extends P.mixin(Ie,ai){static get $name(){return"Navigator"}static get type(){return"navigator"}static get configurable(){return{ownerCmp:null,itemsTabbable:null,target:null,keyEventTarget:null,processEvent:null,itemSelector:null,activeItem:null,focusCls:"b-active",keys:null,allowCtrlKey:null,allowShiftKey:null,scrollDuration:50,disabled:null,datasetIdProperty:"id",testConfig:{scrollDuration:1}}}static get factoryable(){return{defaultType:"navigator"}}get activeItem(){const{_activeItem:e}=this;if(this.target.contains(e))return e;this._activeItem=null}updateOwnerCmp(e){this.itemSelector||(this.itemSelector=`.${this.ownerCmp.itemCls}`),S.setAttributes(this.keyEventTarget,{"aria-activedescendant":`${this.owner.id}-active-descendant`})}set navigationEvent(e){const{owner:t}=this;this._navigationEvent=t.navigationEvent=e,e&&Promise.resolve(1).then(()=>this.navigationEvent=null)}get navigationEvent(){return this._navigationEvent}static getComposedKeyName(e){const t=(e.key||"").trim()||e.code;return`${e.ctrlKey?"CTRL+":""}${e.shiftKey?"SHIFT+":""}${e.altKey?"ALT+":""}${t}`}onKeyDown(e){const t=this,{ownerCmp:i,itemSelector:r,activeItem:n,itemsTabbable:s}=t,{target:a}=e,o=t.target.querySelector(r),l=(e.key||"").trim()||e.code,d=t.constructor.getComposedKeyName(e),u=a.matches(r)||a===t.keyEventTarget;if(!t.disabled&&t.processEvent&&(e=t.processEvent.call(i,e)),e&&!t.disabled&&o&&t.target.offsetParent&&u){if(!s){if(t.inlineFlow==null){const f=o.parentNode,g=S.getStyleValue(o,"position"),m=S.getStyleValue(o,"display"),p=S.getStyleValue(o,"float");t.inlineFlow=g==="absolute"||m==="inline"||m==="inline-block"||p==="left"||p==="right"||S.getStyleValue(f,"display")==="flex"&&S.getStyleValue(f,"flex-direction")==="row"}t.prevKey||(t.inlineFlow?(t.prevKey="ArrowLeft",t.nextKey="ArrowRight"):(t.prevKey="ArrowUp",t.nextKey="ArrowDown"))}if(t.navigationEvent=e,n)switch(l){case t.prevKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey||e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),e.handled=!0,t.navigatePrevious(e);break;case t.nextKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey||e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),e.handled=!0,t.navigateNext(e);break;default:{var h;const f=(h=t.keys)===null||h===void 0?void 0:h[d];if(f&&!t.disabled){if(t.callback(f,t.thisObj||i,[e])===!1)return}else i.onInternalKeyDown&&i.onInternalKeyDown(e);if(S.getActiveElement(a)!==a&&e.preventDefault(),s)return}}else{if(s)return;(l===t.nextKey||l===t.prevKey)&&(t.activeItem=t.getDefaultNavigationItem(e))}t.activeItem!==n&&t.triggerNavigate(e)}}getDefaultNavigationItem(e){const{target:t,itemSelector:i,prevKey:r,nextKey:n}=this;if(t.compareDocumentPosition(e.target)&4&&e.key===r)return t.querySelector(`${i}:last-of-type`);if(t.compareDocumentPosition(e.target)&2&&e.key===n)return t.querySelector(`${i}`)}navigatePrevious(e){const t=this,i=t.previous;e.preventDefault(),i&&t.ownerCmp.scrollable.scrollIntoView(i,{animate:t.scrollDuration}).then(()=>{t.activeItem=i,t.triggerNavigate(e)})}navigateNext(e){const t=this,i=t.next;e.preventDefault(),i&&t.ownerCmp.scrollable.scrollIntoView(i,{animate:t.scrollDuration}).then(()=>{t.activeItem=i,t.triggerNavigate(e)})}get owner(){return this.ownerCmp}get previous(){return this.getAdjacent(-1)}get next(){return this.getAdjacent(1)}getAdjacent(e=1,t=this.activeItem){const i=this.treeWalker;if(i.currentNode=t,i[e<0?"previousNode":"nextNode"](),i.currentNode!==this.activeItem)return i.currentNode}onTargetFocusIn(e){const t=this,{target:i,relatedTarget:r}=e,{owner:n,itemsTabbable:s,skipScrollIntoView:a,previousActiveItem:o}=t;if(!i.matches(".b-focus-trap")){if(i.matches(t.itemSelector))t.skipScrollIntoView=!0,t.activeItem=i,t.skipScrollIntoView=a,t.activeItem&&s&&t.triggerNavigate(e);else if(i===t.target)if((r?i.compareDocumentPosition(r):0)&Node.DOCUMENT_POSITION_CONTAINED_BY){var l;(l=n.previousSibling)===null||l===void 0||l.focus()}else t.activeItem=o&&t.target.contains(o)?o:0}}onTargetFocusOut(e){const t=this,{relatedTarget:i}=e;i!=null&&i.matches(".b-focus-trap")||(!i||!t.target.contains(i)||!i.matches(t.itemSelector))&&t.activeItem&&(t.activeItem=null,t.itemsTabbable&&t.triggerNavigate(e))}onTargetMouseDown(e){const t=this,i=e.target.closest(t.itemSelector);t.navigationEvent=e,t.itemsTabbable?i===t.activeItem&&t.triggerNavigate(e):t.ownerCmp.itemsFocusable===!1?t.onFocusGesture(e):i&&(e.preventDefault(),S.focusWithoutScrolling(i))}onTargetClick(e){var t;const i=this,{skipScrollIntoView:r}=i;if(i.skipNextClick||(t=i.navigationEvent)!==null&&t!==void 0&&t.ignoreNavigation){i.skipNextClick=!1;return}i.disabled||(i.skipScrollIntoView=!0,i.processEvent&&(e=i.processEvent.call(i.ownerCmp,e)),e&&(i.activeItem=e.target.closest(i.itemSelector),i.triggerNavigate(e)),i.skipScrollIntoView=r)}onFocusGesture(e){(e.target===this.ownerCmp.contentElement||e.target.closest(this.itemSelector)&&this.ownerCmp.itemsFocusable===!1)&&e.preventDefault()}acceptNode(e){return e.offsetParent&&e.matches&&e.matches(this.itemSelector)?S.NodeFilter.FILTER_ACCEPT:S.NodeFilter.FILTER_SKIP}changeActiveItem(e){return e!=null&&this.ownerCmp.getItem&&(e=this.ownerCmp.getItem(e)),e}updateActiveItem(e,t){const i=this,{ownerCmp:r}=i,n=t&&i.target.contains(t),s=e&&S.isFocusable(e)&&e!==S.getActiveElement(e);if(n&&(i.previousActiveItem=t),t&&(t.classList.remove(i.focusCls),t.removeAttribute("id")),e!=null){if(i.skipScrollIntoView)s&&S.focusWithoutScrolling(e);else{var a;(a=r.scrollable)===null||a===void 0||a.scrollIntoView(e,{block:"nearest",focus:s,silent:i.scrollSilently})}if(e===t&&n)return;e.classList.add(i.focusCls),e.id=`${i.owner.id}-active-descendant`,i._activeItem=e}else i._activeItem=null,t===S.getActiveElement(t)&&r.revertFocus()}updateTarget(e,t){const i=this,r={element:e,thisObj:i,focusin:"onTargetFocusIn",focusout:"onTargetFocusOut",mousedown:{handler:"onTargetMouseDown",delegate:i.itemSelector}};!i.itemsTabbable&&!i.itemsFocusable&&(r.click="onTargetClick"),Object.prototype.hasOwnProperty.call(i,"acceptNode")||(i.acceptNode=i.acceptNode.bind(i),i.acceptNode.acceptNode=i.acceptNode),B.on(r),i.treeWalker=i.setupTreeWalker(e,S.NodeFilter.SHOW_ELEMENT,i.acceptNode),i.keyEventTarget||(i.keyEventTarget=e),(i.targetMutationMonitor=new MutationObserver(i.onTargetChildListChange.bind(i))).observe(e,{childList:!0,subtree:!0})}setupTreeWalker(e,t,i){return document.createTreeWalker(e,t,i)}onTargetChildListChange(){const e=this,{activeItem:t,datasetIdProperty:i}=e;if(t)if(e.target.contains(t))t.classList.contains(e.focusCls)||t.classList.add(e.focusCls);else{var r;e.activeItem=e.target.querySelector(`${e.itemSelector}.${e.focusCls}[data-${z.hyphenate(i)}="${t.dataset[i]}"]`)||((r=e.target.querySelector(`${e.itemSelector}.${e.focusCls}`))===null||r===void 0?void 0:r[t.dataset.index])||null}}changeKeyEventTarget(e){this._keyEventTarget=e,B.on({element:e,keydown:"onKeyDown",thisObj:this})}triggerNavigate(e,t=this.activeItem){var i;const r={event:e,item:t,oldItem:this.previousActiveItem};this.trigger("navigate",r),(i=this.ownerCmp)===null||i===void 0||i.trigger("navigate",r)}}xr._$name="Navigator";const Us=z.escapeRegExp,Rh=/[\d+-]/g,da=(c,e)=>new Intl.NumberFormat(c||void 0,e),Uw=/^(?:([$])\s*)?(?:(\d+)>)?\d+(,\d+)?(?:\.((\d*)(?:#*)|[*]))?(?:\s*([%])?)?$/,Yw="\u2212";class Gw{constructor(e){const t=this,i=e.locale,r=da(i,{maximumFractionDigits:3}),n=e.is.currency?t._decodeStyle(i,{style:"currency",currency:e.currency,currencyDisplay:e.currencyDisplay}):null,s=e.is.percent?t._decodeStyle(i,{style:"percent"}):null,a=r.format(1.2).replace(Rh,"")[0],o=r.format(1e9).replace(Rh,"")[0]||"";Object.assign(t,{currency:n,decimal:a,formatter:e,grouper:o,percent:s}),t.decimal=a,t.decimalRe=Us(a,"g"),t.grouper=o,t.stripRe=new RegExp(`(?:\\s+|${Us(o)})`+(n?`|(?:${Us(n.text)})`:"")+(s?`|(?:${Us(s.text)})`:""),"g")}decimalPlaces(e){e=e.replace(this.stripRe,"");const t=e.indexOf(this.decimal)+1;return t&&e.length-t}parse(e,t){return typeof e=="string"&&(e=e.replace(this.stripRe,"").replace(this.decimalRe,".").replace(Yw,"-"),e=t?Number(e):parseFloat(e),this.formatter.is.percent&&(e/=100)),e}_decodeStyle(e,t){const i=da(e,t),r=da(e,Object.assign(i.resolvedOptions(),{style:"decimal"})),n=i.format(0),s=r.format(0);return{suffix:n.startsWith(s),text:n.replace(s,"").trim()}}}class Yt extends rd{static get $name(){return"NumberFormat"}initialize(){this._as={},this.is={decimal:!1,currency:!1,percent:!1,null:!0,from:null}}get truncator(){const e=this.maximumFractionDigits;return e==null?null:this.as({style:"decimal",maximumFractionDigits:Math.min(20,e+1)},"truncator")}configure(e){const t=this;typeof e!="string"?Object.assign(t,e):t.template=e;const i={},r=t.locale?He.locales[t.locale]:He.locale,n=r&&r.NumberFormat,s=t.template;if(n)for(const a in n)t[a]==null&&typeof n[a]!="function"&&(t[a]=n[a]);if(s){const a=Uw.exec(s),o=a[2],l=a[4];t.useGrouping=!!a[3],t.style=a[1]?"currency":a[6]?"percent":"decimal",o&&(t.integer=+o),l==="*"?t.fraction=[0,20]:l!=null&&(t.fraction=[a[5].length,l.length])}t._minMax("fraction",!0,!0),t._minMax("integer",!0,!1),t._minMax("significant",!1,!0);for(const a in t.defaults)t[a]!=null&&(i[a]=t[a]);t.is.from=t.from&&t.from.is,t.is[t.style]=!(t.is.null=!1),t.formatter=da(t.locale,i)}as(e,t=null){const i=this.resolvedOptions()||{template:"9.*"},r=this._as;let n=t&&r[t];return n||(typeof e=="string"?i.style=e:Object.assign(i,e),i.from=this,n=new Yt(i)),t&&(r[t]=n),n}defaultParse(e,t){return e==null?e:t?Number(e):parseFloat(e)}format(e){if(typeof e=="string"){const t=Number(e);e=isNaN(t)?this.parse(e):t}return super.format(e)}round(e){return this.parse(this.format(e))}truncate(e){const t=this,i=t.maximumFractionDigits,{truncator:r}=t;let n=t.parse(e),s;return r&&(n=r.format(n),s=n.indexOf(r.parser.decimal),s>-1&&n.length-s-1>i&&(n=n.substr(0,s+i+1)),n=r.parse(n)),n}resolvedOptions(){const e=super.resolvedOptions();for(const t in e)e[t]===void 0&&(e[t]=this[t]);return e}_minMax(e,t,i){const r=this,n=r[e];if(n!=null){const s=z.capitalize(e),a=`maximum${s}Digits`,o=`minimum${s}Digits`;typeof n=="number"?(t&&(r[o]=n),i&&(r[a]=n)):(r[o]=n[0],r[a]=n[1])}}}Yt.Parser=Gw;Object.assign(Yt.prototype,{defaults:{style:"decimal",currency:null,currencyDisplay:"symbol",locale:null,maximumFractionDigits:null,minimumFractionDigits:null,minimumIntegerDigits:null,maximumSignificantDigits:null,minimumSignificantDigits:null,useGrouping:!0},fraction:null,from:null,integer:null,significant:null,template:null});Object.assign(Yt.prototype,Yt.prototype.defaults);rd.number=(c,e)=>Yt.format(c,e);Yt._$name="NumberFormat";class nd extends Ie(P){construct(e={}){const t=this;super.construct(e),t.onWsOpen=t.onWsOpen.bind(t),t.onWsClose=t.onWsClose.bind(t),t.onWsMessage=t.onWsMessage.bind(t),t.onWsError=t.onWsError.bind(t),t.autoConnect&&t.address&&t.open()}doDestroy(){const e=this;e.connector&&(e.detachSocketListeners(e.connector),e.connector.close(),e.connector=null),super.doDestroy()}get isConnecting(){var e;return((e=this.connector)===null||e===void 0?void 0:e.readyState)===this.constructor.webSocketImplementation.CONNECTING}get isOpened(){var e;return((e=this.connector)===null||e===void 0?void 0:e.readyState)===this.constructor.webSocketImplementation.OPEN}get isClosing(){var e;return((e=this.connector)===null||e===void 0?void 0:e.readyState)===this.constructor.webSocketImplementation.CLOSING}get isClosed(){var e;return((e=this.connector)===null||e===void 0?void 0:e.readyState)===this.constructor.webSocketImplementation.CLOSED}createWebSocketConnector(){const e=this.connector=new this.constructor.webSocketImplementation(this.address);this.attachSocketListeners(e)}destroyWebSocketConnector(){this.detachSocketListeners(this.connector),this.connector.close(),this.connector=null}attachSocketListeners(e){const t=this;e.addEventListener("open",t.onWsOpen),e.addEventListener("close",t.onWsClose),e.addEventListener("message",t.onWsMessage),e.addEventListener("error",t.onWsError)}detachSocketListeners(e){const t=this;e.removeEventListener("open",t.onWsOpen),e.removeEventListener("close",t.onWsClose),e.removeEventListener("message",t.onWsMessage),e.removeEventListener("error",t.onWsError)}async open(){const e=this;if(e._openPromise)return e._openPromise;if(!e.address){console.warn("Server me.address cannot be empty");return}if(e.isOpened)return!0;e.createWebSocketConnector();let t;return e._openPromise=new Promise(i=>{t=e.ion({open(){i(!0)},error(){i(!1)}})}).then(i=>(t(),e._openPromise=null,i||e.destroyWebSocketConnector(),i)).catch(()=>{e._openPromise=null,e.destroyWebSocketConnector()}),e._openPromise}close(){this.connector&&(this.destroyWebSocketConnector(),this.trigger("close"))}send(e,t={}){var i;(i=this.connector)===null||i===void 0||i.send(JSON.stringify(F({command:e},t)))}onWsOpen(e){this.trigger("open",{event:e})}onWsClose(e){this.trigger("close",{event:e})}onWsMessage(e){try{const t=JSON.parse(e.data);this.trigger("message",{data:t})}catch(t){this.trigger("error",{error:t})}}onWsError(e){this.trigger("error",{error:e})}}M(nd,"webSocketImplementation",typeof WebSocket>"u"?null:WebSocket);M(nd,"configurable",{address:"",userName:"User",autoConnect:!0});nd._$name="WebSocketManager";var qw=c=>class extends(c||P){static get $name(){return"Finalizable"}construct(...t){super.construct(...t),this.finalizer=null,this.finalizing=null,this.isFinalized=!1,this.isFinalizing=!1}doFinalize(){this.destroy()}finalize(){const t=this;let i=t.finalizing;return!i&&!t.isFinalized&&(t.isFinalizing=!0,t.finalizing=i=t._awaitFinalizer()),i}async _awaitFinalizer(){const t=this;try{await t.finalizer}finally{t.finalizing=null,t.isFinalized=!0,t.doFinalize()}}};const Bl=Symbol("dragAbort"),ca=Symbol("dragInit"),Ng=Symbol("dragDrag"),zl=Symbol("dragDrop"),Kw={x:"horizontal",y:"vertical"};class On extends P.mixin(qw,he,jn){static get configurable(){return{itemElement:null,scrollManager:null,monitoringConfig:null,source:null,target:null,targetElement:null,threshold:5,touchStartDelay:300}}static get identifiable(){return{}}construct(...e){super.construct(...e);const t=this,{event:i}=t;Object.assign(t,{altKey:null,cleaners:[],ctrlKey:null,data:new Map,element:i.target,endEvent:null,lastMoveEvent:null,metaKey:null,previousTarget:null,scrollerAction:null,shiftKey:null,state:ca,startEvent:i,touchStartTimer:null,_valid:!0}),"touches"in i&&t.touchStartDelay&&(t.touchStartTimer=t.setTimeout(()=>t.touchStartTimer=null,t.touchStartDelay,"touchStartDelay")),B.on({element:globalThis,blur:"onWindowBlur",thisObj:t})}doDestroy(){const e=this,{source:t,target:i}=e;e.cleanup(),i?.dropping===e&&(i.dropping=null),t?.dragging===e&&(t.dragging=null),super.doDestroy()}onWindowBlur(){this.started&&this.abort()}get aborted(){return this.state===Bl}get completed(){return this.isDestroying||this.aborted||this.endEvent!==null}get pending(){return this.state===ca}get started(){return this.state!==ca&&!this.aborted}get valid(){return this.started&&this.targetElement!=null&&this._valid}set valid(e){this._valid=e}async get(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(!this.completed)throw new Error("Data is not available until drag completion");if(Array.isArray(e))return Promise.all(e.map(i=>this.get(i)));let t=this.data.get(e);return typeof t=="function"&&(t=await t(),this.data.set(e,t)),t}has(e){return this.data.has(e)}peek(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(Array.isArray(e))return e.map(i=>this.peek(i));let t=this.data.get(e);return typeof t=="function"&&(t=!0),t}set(e,t){this.data.set(e,t)}changeTarget(e,t){if(e!==t){const i=this;i._target=e,i.previousTarget=t,t&&(t.dropping=null),e&&(e.dropping=i,e.dropping!==i&&(e=null,i.valid=!1)),i._target=t}return e}updateTarget(e,t){const i=this;t&&i.source.dragLeaveTarget(i,t),e&&(i.valid=!0,e.dragMove(i),i.source.dragEnterTarget(i))}updateTargetElement(e){let t,i,r,n,s;for(s=e;s;s=s.parentElement)if(i=$e.get(s,"droppables"),i){for(n=0;n<i.length;++n)if(t=i[n],t.dropRootElement.contains(e)&&(r=t.droppableSelector,(!r||e.closest(`#${S.getId(t.dropRootElement)} ${r}`))&&(this.target=t,this.target===t)))return}}abort(){const e=this,{element:t,source:i}=e;t?.getBoundingClientRect(),e.state!==zl&&(e.state=Bl,e.cleanup()),i?.endDrag(e)}begin(){const e=this,{source:t}=e,i=t.beforeDrag(e);return i!==!1&&(t.dragging=e),i}cleanup(){let e;for(;e=this.cleaners.pop();)e()}end(e){const t=this,{lastMoveEvent:i,target:r}=t,{dragSwallowClickTime:n}=t.source;t.event=t.endEvent=e,t.syncFlags(),t.started&&((i?.clientX!==e.clientX||i?.clientY!==e.clientY||i?.target!==e.target)&&t.track(),n&&B.on({element:document,capture:!0,expires:n,once:!0,click(s){s.stopPropagation()}}),t.state=zl,r!==t.source&&r?.dragDrop(t))}fakeKey(e,t){const i=this,{lastMoveEvent:r}=i;if(r&&i.element){let n;r.isKey=!0,e.key==="Alt"?i.altKey!==t&&(i.altKey=t,n=!0):e.key==="Control"&&i.ctrlKey!==t&&(i.ctrlKey=t,n=!0),n&&(i.event=r,i.track())}}keyDown(e){this.completed||(e.key==="Escape"?this.abort():this.isDragToggleKey(e.key)&&this.fakeKey(e,!0))}keyUp(e){!this.completed&&this.isDragToggleKey(e.key)&&this.fakeKey(e,!1)}getDistance(e){return B.getDistanceBetween(this.startEvent,e)}isDragToggleKey(e){return e==="Control"||e==="Alt"}move(e){const t=this,{target:i}=e,r=t.getDistance(e),n=r>=t.threshold;if(t.syncFlags(),t.touchStartTimer){n&&t.abort();return}if(i&&i.nodeType===Node.ELEMENT_NODE){if(n&&!t.started&&(t.event=e,t.start()===!1)){t.abort();return}t.started&&!t.completed&&(t.lastMoveEvent=t.event=e,e.type==="touchmove"&&(e.preventDefault(),e.stopImmediatePropagation()),t.track())}}start(){const e=this,{scrollManager:t,monitoringConfig:i,source:r}=e,{draggingBodyCls:n,dragLock:s}=r,a=r.dragRootElement;if(e.state=Ng,t){const l=t.startMonitoring(U.merge({scrollables:[{element:a}],direction:Kw[s]||s||"both",callback(d){const{lastMoveEvent:u}=e;u&&e.element&&(u.isScroll=!0,e.event=u,e.scrollerAction=d,e.track(),e.scrollerAction=null)}},i));e.cleaners.push(l)}const o=r.dragRootElement.closest(".b-outer")||document.body;if(o.classList.add(n),e.cleaners.push(()=>o.classList.remove(n)),r.startDrag(e)===!1)return e.cleanup(),!1}syncFlags(){const e=this,{event:t}=e;e.altKey=t.altKey,e.ctrlKey=t.ctrlKey||t.metaKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey}track(){const e=this,{event:t,source:i,target:r}=e;let n=t.target,s;t.type==="touchmove"&&(s=t.changedTouches[0],n=S.elementFromPoint(s.clientX,s.clientY)),e.targetElement=n,r===e.target&&r?.dragMove(e),i.trackDrag(e)}}M(On,"$name","DragContext");On.prototype.STATE=On.STATE=Object.freeze({ABORTED:Bl,INIT:ca,DRAGGING:Ng,DROPPED:zl});On._$name="DragContext";class _r extends P.mixin(ai){static get type(){return"default"}static get configurable(){return{dragging:null}}static get factoryable(){return{defaultType:_r}}updateDragging(e,t){t&&this.close(t),e&&this.open(e)}close(e){}open(e){}dragStart(e){this.dragging=e}dragMove(e){}dragEnd(e){this.dragging=null}}_r.initClass();_r._$name="DragProxy";var Oa=c=>class extends(c||P){static get $name(){return"Draggable"}static get configurable(){return{dragging:{$config:"nullify",value:null},draggingClsSelector:null,dragDocumentListeners:{element:document,keydown:"onDragKeyDown",keyup:"onDragKeyUp",contextmenu:"onDragContextMenu",mousemove:"onDragPointerMove",mouseup:"onDragPointerUp",pointerup:"onDragPointerUp",touchend:"onDragPointerUp",touchmove:{handler:"onDragPointerMove",passive:!1}},dragItemSelector:null,dragItemOverCls:null,dragLock:null,dragMinDistance:1,dragProxy:{$config:["lazy","nullify"],value:null},dragRootElement:{$config:"nullify",value:null},dragSameTargetDrop:!1,dragSelector:null,ignoreSelector:null,dragSwallowClickTime:50,dragThreshold:5,dragTouchStartDelay:300,dropTargetSelector:null,overItem:null,testConfig:{dragSwallowClickTime:50}}}static get properties(){return{draggingCls:"b-draggable-active",draggingBodyCls:"b-draghelper-active",draggingItemCls:"b-dragging-item",draggingStartedCls:"b-draggable-started",draggableCls:"b-draggable"}}beforeDrag(t){const{dragRootElement:i,dragSelector:r,ignoreSelector:n}=this,s=r&&t.element.closest(r);return!r||Boolean(s&&s===i||i.contains(s)&&(!n||!t.element.matches(n)))}dragStart(t){}dragOver(t){}dragEnterTarget(t){}dragLeaveTarget(t,i){}dragDrop(t){}dragEnd(t){}get activeDrag(){const{dragging:t}=this;return t!=null&&t.started&&!t.completed?t:null}get dragEventer(){return this.trigger?this:null}get draggingClassElement(){const{draggingClsSelector:t,dragRootElement:i}=this;return t?i?.closest(t):i}beginDrag(t){const{draggingCls:i,draggingClassElement:r}=this;i&&r&&(r.classList.add(i),t.cleaners.push(()=>r.classList.remove(i)))}async endDrag(t){const i=this,{dragEventer:r,dragProxy:n}=i;t.valid&&await i.dragDrop(t),!i.isDestroyed&&(t.pending?t.destroy():(i.dragEnd(t),n?.dragEnd(t),r?.trigger(t.valid?"drop":"dragCancel",{drag:t,event:t.event}),i.finalizeDrag(t)))}async finalizeDrag(t){var i;await((i=t.finalize)===null||i===void 0?void 0:i.call(t))}moveDrag(t){if(this.dragOver(t)!==!1){const{dragEventer:i,dragProxy:r}=this;r?.dragMove(t),i?.trigger("drag",{drag:t,event:t.event})}}setupDragContext(t){const i=this,{dragItemSelector:r,id:n}=i,{target:s}=t;return{event:t,id:n?`${n}-drag-${i._nextDragId=(i._nextDragId||0)+1}`:null,itemElement:r?s.closest(r):s,touchStartDelay:i.dragTouchStartDelay,source:i,threshold:i.dragThreshold}}startDrag(t){const{draggingStartedCls:i,draggingClassElement:r,draggingItemCls:n,dragEventer:s,dragProxy:a}=this,{itemElement:o}=t;if(s?.trigger("beforeDragStart",{drag:t,event:t.event})===!1)return!1;i&&r&&(r.classList.add(i),t.cleaners.push(()=>r.classList.remove(i))),n&&o&&(o.classList.add(n),t.cleaners.push(()=>o.classList.remove(n))),a?.dragStart(t);const l=this.dragStart(t);return l!==!1&&s?.trigger("dragStart",{drag:t,event:t.event}),l}trackDrag(t){var i;const{dropTargetSelector:r}=this;t.valid=!(r&&!((i=t.targetElement)!==null&&i!==void 0&&i.closest(r))),this.moveDrag(t)}configureListeners(t){const i=this,r=T.assign({thisObj:i},i.dragDocumentListeners);return"touches"in t.startEvent?(delete r.mousemove,delete r.mouseup):(delete r.contextmenu,delete r.touchmove,delete r.touchend,delete r.pointerup),r}updateDragging(t,i){const r=this;if(t){const n=r.configureListeners(t);t.cleaners.push(B.on(n)),r.beginDrag(t)}else i&&i.destroy()}changeDragProxy(t,i){return _r.reconfigure(i,t,{owner:this,defaults:{owner:this}})}updateDragRootElement(t,i){var r;const n=this,{draggableCls:s,dragItemSelector:a,onDragItemMouseMove:o}=n;if(i?.classList.remove(s),(r=n._dragRootDetacher)===null||r===void 0||r.call(n),t){const l={thisObj:n,element:t,mousedown:"onDragMouseDown",touchstart:"onDragTouchStart",pointerdown:d=>{var u,h;return d.pointerId&&((u=(h=d.target).releasePointerCapture)===null||u===void 0?void 0:u.call(h,d.pointerId))}};o&&(l.mousemove={delegate:a,handler:"onDragItemMouseMove"}),(n.dragItemOverCls||o||n.onDragItemMouseEnter||n.onDragItemMouseLeave)&&Object.assign(l,{mouseover:{delegate:a,handler:"onDragItemMouseOver"},mouseout:{delegate:a,handler:"onDragItemMouseOut"}}),t.classList.add(s),n._dragRootDetacher=B.on(l)}}onDragItemMouseOver(t){this.overItem=t}onDragItemMouseOut(t){this.dragging||(this.overItem=t)}changeOverItem(t){if(this.enterLeaveEvent=t,t.type==="mouseout"){var i;return((i=t.relatedTarget)===null||i===void 0?void 0:i.closest(this.dragItemSelector))||null}else return t.target.closest(this.dragItemSelector)}updateOverItem(t,i){const r=this,{dragItemOverCls:n}=r;if(i){var s;n&&i.classList.remove(n),(s=r.onDragItemMouseLeave)===null||s===void 0||s.call(r,r.enterLeaveEvent,i)}if(t){var a;n&&t.classList.add(n),(a=r.onDragItemMouseEnter)===null||a===void 0||a.call(r,r.enterLeaveEvent,t)}}onDragContextMenu(t){t.preventDefault()}onDragKeyDown(t){this.dragging.keyDown(t)}onDragKeyUp(t){this.dragging.keyUp(t)}onDragMouseDown(t){t.button===0&&this.onDragPointerDown(t)}onDragPointerDown(t){let{dragging:i}=this;i?i.isFinalizing||i.abort():(i=this.setupDragContext(t),i&&(i=new On(i),i.begin()===!1&&i.destroy()))}changeDragging(t,i){return i?.destroy(),t}onDragPointerMove(t){const{dragging:i}=this;i&&!i.completed&&i?.move(t)}onDragPointerUp(t){const{dragging:i}=this;i&&!i.completed&&(i.end(t),this.endDrag(i))}onDragTouchStart(t){t.touches.length===1&&this.onDragPointerDown(t)}},Bg=c=>class extends(c||P){static get $name(){return"Droppable"}static get configurable(){return{droppableSelector:null,dropping:null,dropRootElement:{$config:"nullify",value:null}}}get dropEventer(){return this.trigger?this:null}get droppableCls(){return"b-droppable"}dragEnter(t){var i;return(i=this.dropEventer)===null||i===void 0?void 0:i.trigger("dragEnter",{drag:t,event:t.event})}dragMove(t){var i;return(i=this.dropEventer)===null||i===void 0?void 0:i.trigger("dragMove",{drag:t,event:t.event})}dragDrop(t){var i;return(i=this.dropEventer)===null||i===void 0?void 0:i.trigger("drop",{drag:t,event:t.event})}dragLeave(t){var i;return(i=this.dropEventer)===null||i===void 0?void 0:i.trigger("dragLeave",{drag:t,event:t.event})}changeDropping(t,i){if(t!==i){const r=this;i&&(i.aborted||!i.completed)&&r.dragLeave(i),t&&(r._dropping=t,r.dragEnter(t)===!1&&(t=null),r._dropping=i)}return t}updateDropRootElement(t,i){const r=this,{droppableCls:n}=r;let s,a,o;i&&(s=$e.get(i,"droppables"),o=!0,Array.isArray(s)&&(a=s.indexOf(r))>-1&&(s.length<2?$e.remove(i,"droppables"):(s.splice(a,1),s.forEach(l=>{n===l.droppableCls&&(o=!1)}))),o&&i.classList.remove(n)),t&&(s=$e.get(t,"droppables"),s?s.push(r):$e.set(t,"droppables",[r]),t.classList.add(n))}},zg=c=>class extends(c||P){static get $name(){return"Featureable"}static get configurable(){return{features:null}}static get declarable(){return["featureable"]}static setupFeatureable(t){const i=F({ownerName:"client"},t.featureable);i.factory.initClass(),Reflect.defineProperty(t,"featureable",{get(){return i}})}doDestroy(){const t=this.features;super.doDestroy();for(const r in t){var i;const n=t[r];(i=n.destroy)===null||i===void 0||i.call(n)}}hasFeature(t){var i;return Boolean((i=this.features)===null||i===void 0?void 0:i[t])}changeFeatures(t,i){if(this.isDestroying)return;const r=this,{featureable:n}=r.constructor,s=r.$features||(r.$features=new Ki({configName:"features",factory:n.factory,owner:r,ownerName:n.ownerName}));if(s.update(t),!i)return s.target}get widgetClass(){}getCurrentConfig(t){const i=super.getCurrentConfig(t),{features:r}=i;if(r)for(const n in r)Object.keys(r[n]).length===0&&(r[n]=!0);return i}};const Re={e:"b-hover-edge",t:"b-hover-top",r:"b-hover-right",b:"b-hover-bottom",l:"b-hover-left"},Xw={[Re.e]:1,[Re.t]:1,[Re.r]:1,[Re.b]:1,[Re.l]:1},Zw={t:[Re.e,Re.t],r:[Re.e,Re.r],b:[Re.e,Re.b],l:[Re.e,Re.l],tr:[Re.e,Re.t,Re.r],bl:[Re.e,Re.b,Re.l],tl:[Re.e,Re.t,Re.l],br:[Re.e,Re.b,Re.r]};var Jw=c=>class extends c.mixin(he){static get $name(){return"Hoverable"}static get configurable(){return{hoverCls:null,hoverAnimationCls:null,hoverRootCls:null,hoverRootActiveCls:null,hoverDelay:null,hoverElement:null,hoverIgnoreElement:null,hoverEdges:null,hoverEdgeSize:10,hoverRootElement:{$config:"nullify",value:null},hoverSelector:null,hoverTarget:{$config:"nullify",value:null},hoverTrack:null,hoverZone:null}}static get delayable(){return{setHoverTarget:0}}hoverEnter(t){}hoverIgnore(t){var i;return(i=this.hoverIgnoreElement)===null||i===void 0?void 0:i.contains(t)}hoverLeave(t){}hoverMove(t){}onHoverMouseMove(t){const i=this,{hoverEdges:r,hoverEdgeSize:n,hoverTarget:s}=i;if(s){if(r){const{top:a,left:o,width:l,height:d,right:u,bottom:h}=s.getBoundingClientRect(),{clientX:f,clientY:g}=t,m=o+l/2,p=a+d/2,v=g<(n?a+n:p),y=f>=(n?u-n:m),C=g>=(n?h-n:p),D=f<(n?o+n:m),w=v||C?v?"t":"b":"",E=y||D?y?"r":"l":"";i.hoverZone=(r.includes(w)?w:"")+(r.includes(E)?E:"")}i.hoverEvent=t,i.hoverTrack&&i.hoverMove(t)}}onHoverMouseOver(t){this.hoverEvent=t,this.hoverElement=t.target}onHoverMouseOut(t){this.hoverEvent=t,this.hoverElement=t.relatedTarget}updateHoverDelay(t){this.setHoverTarget.delay=t}changeHoverEdges(t){return t===!0?"trbl":(t||"").replace("v","tb").replace("h","lr")}updateHoverEdges(){this.syncHoverListeners()}changeHoverElement(t){if(!this.hoverIgnore(t))return t}updateHoverElement(t){const{hoverSelector:i}=this;if(i){var r;t=(r=t)===null||r===void 0?void 0:r.closest(i)}this.setHoverTarget(t)}updateHoverRootElement(t,i){const{hoverRootCls:r}=this;r&&(i?.classList.remove(r),t?.classList.add(r)),this.syncHoverListeners()}changeHoverTarget(t,i){return i&&(this.hoverZone=null),t}updateHoverTarget(t,i){const r=this,{hoverCls:n,hoverAnimationCls:s,hoverRootActiveCls:a,hoverRootElement:o}=r;a&&o?.classList[t?"add":"remove"](a),i&&(n&&i.classList.remove(n),s&&i.classList.remove(s),r.hoverLeave(i)),t&&(n&&t.classList.add(n),r.hoverEnter(i),r.hoverTrack&&r.hoverMove(r.hoverEvent),s&&(t.getBoundingClientRect(),t.classList.add(s)))}updateHoverTrack(){this.syncHoverListeners()}updateHoverZone(t){const{hoverAnimationCls:i,hoverTarget:r}=this;if(r){const{className:n}=r,s=Q.change(n,t?Zw[t]:null,Xw);n!==s&&(r.className=s,t&&i&&(r.classList.remove(i),r.getBoundingClientRect(),r.classList.add(i)))}}setHoverTarget(t){this.hoverTarget=t}syncHoverListeners(){var t;const i=this,r=i.hoverRootElement,n={element:r,thisObj:i,mouseover:"onHoverMouseOver",mouseout:"onHoverMouseOut"};(i.hoverTrack||i.hoverEdges)&&(n.mousemove="onHoverMouseMove"),(t=i._hoverRootDetacher)===null||t===void 0||t.call(i),i._hoverRootDetacher=r&&B.on(n)}},Vg=c=>class extends c{static get $name(){return"LoadMaskable"}static get configurable(){return{loadMaskDefaults:{useTransition:!0,showDelay:1e3},loadMaskError:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},loadMask:{text:"L{GridBase.loadMask}"},syncMask:{text:"L{GridBase.syncMask}"},localizableProperties:["loadMask.text","syncMask.text"],testConfig:{loadMaskError:{icon:"b-icon b-icon-warning",autoClose:500,showDelay:0}}}}applyLoadMask(){const t=this,{loadMask:i}=t;return i&&(t.masked=ze.mergeConfigs(t.loadMaskDefaults,i)),t.masked}applyMaskError(t){const{loadMaskError:i,masked:r}=this;return i===!1?r.hide():r&&(T.assign(r.errorDefaults,i),r.error=t),r}get widgetClass(){}};const{defineProperty:Th}=Object,{hasOwn:Qw}=T,dl=Symbol("fencible"),e0=[],jg=c=>Array.from(new Set(c)),cl=c=>c?jg(z.split(c)):e0,t0=(c,e,t)=>{t===!0&&(t=e),T.isObject(t)||(t={all:t});let i=cl(t.any);const r=cl(t.all),n=t.lock?cl(t.lock):jg(r.concat(i)),s=e+"Impl",a=function(...o){const l=this,d=Qw(l,dl)?l[dl]:l[dl]={},u=h=>!d[h];if(r.every(u)&&(!i||i.some(u)))try{return n.forEach(h=>d[h]=(d[h]||0)+1),l[s](...o)}finally{n.forEach(h=>--d[h])}};i=i.length?i:null,!c[s]&&Th(c,s,{configurable:!0,value:c[e]}),Th(c,e,{configurable:!0,value:a})};var Wg=c=>{var e;return e=class extends(c||P){static setupFenced(i){let{fenced:r}=i;const n=r.static,s=[];n&&(r=F({},r),delete r.static,s.push([n,i])),s.push([r,i.prototype]);for(const[a,o]of s)for(const l in a)t0(o,l,a[l])}get widgetClass(){}},M(e,"$name","Fencible"),M(e,"declarable",["fenced"]),e};const ba=60*1e3,Ai=60*ba,ti=24*Ai,i0=/(\d+)?:?(\d*)/;class me{static format(e){const t=Math.floor(e/Ai),i=Math.floor(e/ba)%60;return`${t}:${i<10?"0":""}${i}`}static parse(e){const t=typeof e;if(t==="string"){const i=i0.exec(e);e=Number(i[1]||0)*Ai+Number(i[2]||0)*ba}else t!=="number"?e=b.getTimeOfDay(e):e<=24&&(e*=Ai);return Math.min(Math.max(Math.floor(e),0),ti)}constructor(e){let t=0,i,r;e!=null&&e.isDayView?(t=e.dayStartShift,i=e.dayStartTime,r=e.dayEndTime):typeof e=="number"?t=i=r=e:e&&(t=e.startShift,i=e.timeStart,r=e.timeEnd),this.startShift=t=me.parse(t||0),this.timeEnd=(r==null?(t+ti)%ti:me.parse(r))||ti,this.timeStart=i==null?t:me.parse(i)}get startHour(){return Math.floor(this.timeStart/Ai)}get endHour(){return Math.floor(this.timeEnd/Ai)}get startTimeOffsetMs(){const{startShift:e,timeStart:t}=this;return t<e?ti-e+t:t-e}get today(){return this.startOfDay(new Date)}ceil(e){const t=this.startOfDay(e);return t<e&&t.setDate(t.getDate()+1),t}contains(e){return!this.outside(e)}dateKey(e){return e=this.shiftDate(e,-1),b.makeKey(e)}dayOfDate(e){return this.shiftDate(b.clearTime(e))}dayOfWeek(e){return e=this.shiftDate(e,-1),e.getDay()}delta(e,t="ms"){const{timeStart:i}=this,r=me.parse(e),n=(this.startShift&&r<i?r+ti:r)-i;return t==="ms"?n:b.as(t,n,"ms")}duration(e="ms"){const{timeStart:t,timeEnd:i}=this,r=t<i?i-t:ti-t+i;return e==="ms"?r:b.as(e,r,"ms")}equals(e){return this.startShift===e?.startShift&&this.timeStart===e.timeStart&&this.timeEnd===e.timeEnd}intersects(e,t){const i=this,{timeStart:r,timeEnd:n}=i,[s,a]=i._dateRangeArgs(e,t),[o,l]=i.timeRange(s,a);return r<n?o<l?o<n&&r<=l:o<n||r<=l:!(o<l)||o<n||r<=l}isIntraDay(e,t){const i=this,[r,n]=i._dateRangeArgs(e,t),s=i.startOfDay(r),a=ti-b.diff(s,n,"ms");return a<0?!1:a>0||s<r}isInterDay(e){return e.allDay||!this.isIntraDay(...arguments)}outside(e){const{startShift:t,timeStart:i,timeEnd:r}=this,n=me.parse(e);return i<r?n<i?n<t?1:-1:n<r?0:n<t?-1:1:n<r||n>=i?0:n<t?1:-1}parseKey(e){return this.dayOfDate(b.parseKey(e))}shiftDate(e,t=1){const{startShift:i}=this,r=typeof e;return e=r==="number"?new Date(e):r==="string"?b.parse(e):new Date(e.getTime()),t&&i&&e.setMilliseconds(t>0?i:-i),e}sortEvents(e,t){const i=this.startOfDay(e);return t?.sort((r,n)=>{r=r.eventRecord||r,n=n.eventRecord||n;let{startDate:s}=r,{startDate:a}=n;return s?a?(s=s<i?i:s,a=a<i?i:a,s-a||n.endDate-a-(r.endDate-s)):1:-1})}startOfDay(e){return e=this.shiftDate(e,-1),e=b.clearTime(e),e=this.shiftDate(e),e}timeRange(e,t){const[i,r]=this._dateRangeArgs(e,t);return[b.getTimeOfDay(i),b.getTimeOfDay(r)]}toString(){const{startShift:e,timeEnd:t,timeStart:i}=this,r=e?`@${me.format(e)}`:"",n=me.format(i);return i===t?e?r:n:`${n}-${me.format(t)}${r}`}_dateRangeArgs(e,t){return e.isModel?[e.startDate,e.endingDate]:[e,t]}}me.MIDNIGHT=new me({startShift:0,timeStart:0,timeEnd:24});me.MILLIS_PER_MINUTE=ba;me.MILLIS_PER_HOUR=Ai;me.MILLIS_PER_DAY=ti;me._$name="DayTime";class Ot extends Ie(P){static get configurable(){return{date:{$config:{equal:"date"},value:b.clearTime(new Date)},month:null,year:null,weekStartDay:null,hideNonWorkingDays:null,nonWorkingDays:null,sixWeeks:null}}configure(e){super.configure(e),this.updateDayNumbers(),e.date&&(this.date=e.date),this.generation=0}changeDate(e){if(!this.isConfiguring){if(e=typeof e=="string"?b.parse(e,"YYYY-MM-DD"):new Date(e),isNaN(e))throw new Error("Month date ingestion must be passed a Date, or a valid YYYY-MM-DD date string");return e}}updateDate(e,t){const i=this,{dayColumnIndex:r,weekCount:n}=i,s=b.getFirstDateOfMonth(e),a=b.getLastDateOfMonth(s),o=r[s.getDay()],l=r[a.getDay()],d=!t||e.getFullYear()!==t.getFullYear(),u=!t||e.getMonth()!==t.getMonth(),h=i.eventListeners&&(t?e.getDate()!==t.getDate()|(i.getWeekId(e)!==i.getWeekId(t))<<1|u<<2|d<<3:15);if(i._year=e.getFullYear(),i._month=e.getMonth(),i.startDayOfMonth=1-o,i.endDayOfMonth=a.getDate()+(6-l),i.sixWeeks&&(i.endDayOfMonth+=(6-i.weekCount)*7),(!i.weekBase||d)&&i.calculateWeekBase(),(u||d)&&i.generation++,h){const f={newDate:e,oldDate:t,changes:{d:!0,w:Boolean(h&2),m:Boolean(h&12),y:Boolean(h&8),r:i.weekCount!==n}};i.trigger("dateChange",f),h&2&&i.trigger("weekChange",f),h&12&&i.trigger("monthChange",f),h&8&&i.trigger("yearChange",f)}}calculateWeekBase(){const e=this,{dayColumnIndex:t}=e,i=new Date(e.year,0,1),r=new Date(e.year,11,31),n=e.month?e.getOtherMonth(i):e;e.dayColumnIndex[i.getDay()]>3?e.weekBase=n.startDate:e.weekBase=new Date(e.year,0,n.startDayOfMonth-7);const s=Math.floor(b.diff(e.weekBase,r,"day")/7);e.has53weeks=s===53&&t[r.getDay()]>2}getWeekStart(e){if(typeof e=="number")return b.add(this.weekBase,Math.max(e,1)*7,"day");const t=this,[i,r]=e;return i===t.year?t.getWeekStart(r):t.getOtherMonth(new Date(i,0,1)).getWeekStart(r)}getOtherMonth(e){const t=this,i=t===Mh?new Ot(null):Mh;return i.configure({weekBase:null,weekStartDay:t.weekStartDay,nonWorkingDays:t.nonWorkingDays,hideNonWorkingDays:t.hideNonWorkingDays,sixWeeks:t.sixWeeks,date:new Date(e.getFullYear(),0,1)}),i.date=e,i.updateDate(i.date,i.date),i}changeYear(e){const t=new Date(this.date);t.setFullYear(e),this.date=t}changeMonth(e){const t=new Date(this.date);t.setMonth(e),this.date=t}get weekStartDay(){return typeof this._weekStartDay=="number"?this._weekStartDay:b.weekStartDay}updateWeekStartDay(){const e=this;e.updateDayNumbers(),!e.isConfiguring&&e.date&&(e.weekBase=null,e.updateDate(e.date,e.date))}get nonWorkingDays(){return this._nonWorkingDays||b.nonWorkingDays}changeNonWorkingDays(e){return T.assign({},e)}updateNonWorkingDays(){this.updateDayNumbers()}updateHideNonWorkingDays(){this.updateDayNumbers()}updateSixWeeks(){this.isConfiguring||this.updateDate(this.date,this.date)}get dayCount(){return this.endDayOfMonth+1-this.startDayOfMonth}get weekCount(){return this.dayCount/7}get startDate(){const e=this;if(e.year!=null&&e.month!=null&&e.startDayOfMonth!=null)return new Date(e.year,e.month,e.startDayOfMonth)}get endDate(){const e=this;if(e.year!=null&&e.month!=null&&e.startDayOfMonth!=null)return new Date(e.year,e.month,e.endDayOfMonth)}eachDay(e){for(let t=this.startDayOfMonth;t<=this.endDayOfMonth;t++)e(new Date(this.year,this.month,t))}eachWeek(e){const t=this,{weekCount:i}=t;for(let r=t.startDayOfMonth,n=0;n<i;n++){const s=[],a=t.getWeekNumber(new Date(t.year,t.month,r));for(let o=0;o<7;o++,r++)s.push(new Date(t.year,t.month,r));e(a,s)}}getWeekNumber(e){const t=this;if(e=b.clearTime(e),e.getFullYear()!==t.year)return t.getOtherMonth(new Date(e.getFullYear(),0,1)).getWeekNumber(e);let i=Math.floor(b.diff(t.weekBase,e,"day")/7),r=e.getFullYear();if(i)i===53&&!t.has53weeks?(i=1,r++):i>53&&(i=i%52);else return t.getOtherMonth(new Date(t.year-1,0,1)).getWeekNumber(new Date(t.year,0,0));return[r,i]}getWeekId(e){const t=this.getWeekNumber(e);return t[0]*100+t[1]}getCellData(e,t,i=me.MIDNIGHT){const r=this,n=e.getDay(),s=r.visibleDayColumnIndex[n],a=r.nonWorkingDays[n],o=r.hideNonWorkingDays&&a;return(e<r.startDate||e>r.endDate)&&(r.month=e.getMonth()),{day:n,dayTime:i,visibleColumnIndex:s,isNonWorking:a,week:r.getOtherMonth(e).getWeekNumber(e),key:b.format(e,"YYYY-MM-DD"),columnIndex:r.dayColumnIndex[n],date:new Date(e),dayEnd:i.duration("s"),tomorrow:i.dayOfDate(b.add(e,1,"day")),isOtherMonth:Math.sign(e.getMonth()+e.getFullYear()*12-(t.month+t.year*12)),visible:!o&&e>=t.startDate&&e<b.add(t.endDate,1,"day"),isRowStart:s===0,isRowEnd:s===r.visibleColumnCount-1}}updateDayNumbers(){const e=this,{weekStartDay:t,nonWorkingDays:i,hideNonWorkingDays:r}=e,n=e.dayColumnIndex=[],s=e.canonicalDayNumbers=[],a=e.visibleDayColumnIndex=[];let o=0;for(let l=0;l<7;l++){const d=(t+l)%7;s[l]=d,n[d]=l,(!r||!i[d])&&(a[d]=o++)}e.visibleColumnCount=o,e.weekLength=r?7-T.keys(i).length:7}}M(Ot,"$name","Month");const Mh=new Ot(null);Ot._$name="Month";class Pa extends he(P){static get configurable(){return{element:null,zoneWidth:50,scrollSpeed:5,direction:"both",startScrollDelay:500,stopScrollWhenPointerOut:!1,testConfig:{scrollSpeed:2,startScrollDelay:100},activeScroll:{$config:["lazy"],value:{}},monitoring:{$config:["lazy","nullify"],value:!0},owner:null}}changeMonitoring(e,t){return t?.clear(),new Map}doDestroy(){this.stopMonitoring(),super.doDestroy()}get isScrolling(){return Object.keys(this.activeScroll).length!==0}get rtl(){var e;return(e=this.owner)===null||e===void 0?void 0:e.rtl}startMonitoring(e={}){const t=this,{element:i,direction:r}=t,{scrollables:n=[],direction:s=r,callback:a}=e,o=[];return n.length||n.push({element:i}),n.forEach(l=>{const d=l.element;typeof d=="string"?S.forEachSelector(i,d,u=>{t.createMonitor(u,l.direction||s,l.callback||a),o.push(u)}):(t.createMonitor(d,l.direction||s,l.callback||a),o.push(d))}),function(){var d;(d=t.stopMonitoring)===null||d===void 0||d.call(t,o)}}createMonitor(e,t,i){const{monitoring:r}=this;r.has(e)||r.set(e,new r0({scrollManager:this,element:e,direction:t,callback:i}))}stopMonitoring(e){const t=this,{monitoring:i}=t;if(e=W.asArray(e),i){if(!e){i.forEach(r=>t.stopMonitoring(r.element));return}e.forEach(r=>{const n=i.get(r);r.classList.remove("b-scrolling"),n&&(n.destroy(),i.delete(r))})}}requestScroll(e,t){const{activeScroll:i}=this;return e in i&&i[e]!==t?!1:(i[e]=t,!0)}releaseScroll(e){const{activeScroll:t={}}=this;Object.keys(t).forEach(i=>{t[i]===e&&delete t[i]})}getRelativeScroll(e,t="left"){let i=0;return this.monitoring.forEach((r,n)=>{S.isDescendant(n,e)&&(i+=t==="left"?r.scrollRelativeLeft:r.scrollRelativeTop)}),i}}class r0 extends P{construct(e){const t=this,{element:i}=e,r=i.scrollLeft,n=i.scrollTop;Object.assign(e,{startScrollLeft:r,startScrollTop:n}),super.construct(e),B.on({element:i,scroll:"onElementScroll",mousemove:"onMouseMove",touchmove:"onMouseMove",capture:!0,thisObj:t}),B.on({element:i,pointerleave:"onPointerLeave",thisObj:t})}doDestroy(){this.stopScroll(),super.doDestroy()}startScroll(){this.scrolling=!0,this.performScroll()}stopScroll(){const e=this;e.scrolling=!1,e.scrollRequested&&(e.scrollManager.cancelAnimationFrame(e.frameId),e.scrollRequested=!1),e.scrollManager.clearTimeout(e.scrollTimeout),e.scrollManager.releaseScroll(e),e.scrollTimeout=null}onPointerLeave(){this.scrollManager.stopScrollWhenPointerOut&&this.stopScroll()}onMouseMove(e){const t=this,{scrollManager:i}=t,r=t.element.getBoundingClientRect(),n=i.zoneWidth,s=i.scrollSpeed;if(t.scrollDeltaX=t.scrollDeltaY=0,t.direction!=="vertical"){const{scrollLeft:a,scrollWidth:o,clientWidth:l}=t.element;i.rtl?e.clientX<r.left+n&&o+a-l>=1?t.scrollDeltaX=-Math.round((n+(r.left-e.clientX))/s)-1:e.clientX>r.right-n&&a<0&&(t.scrollDeltaX=Math.round((n-(r.right-e.clientX))/s)+1):e.clientX>r.right-n&&o-a-l>=1?t.scrollDeltaX=Math.round((n-(r.right-e.clientX))/s)+1:e.clientX<r.left+n&&a>0&&(t.scrollDeltaX=-Math.round((n+(r.left-e.clientX))/s)-1)}if(t.direction!=="horizontal"){const{scrollTop:a,scrollHeight:o,clientHeight:l}=t.element;e.clientY>r.bottom-n&&o-a-l>=1?t.scrollDeltaY=Math.round((n-(r.bottom-e.clientY))/s)+1:e.clientY<r.top+n&&a>0&&(t.scrollDeltaY=-Math.round((n+(r.top-e.clientY))/s)-1)}t.scrollDeltaX!==0&&!i.requestScroll("horizontal",t)&&(t.scrollDeltaX=0),t.scrollDeltaY!==0&&!i.requestScroll("vertical",t)&&(t.scrollDeltaY=0),t.scrollDeltaX===0&&t.scrollDeltaY===0?t.stopScroll():t.scrollTimeout||(t.scrollTimeout=i.setTimeout(()=>t.startScroll(),i.startScrollDelay))}performScroll(){const e=this,{element:t}=e;if(e.scrolling&&!e.scrollRequested){if(e.scrollDeltaX!==0){const i=t.scrollLeft,r=Math.min(i+e.scrollDeltaX,t.scrollWidth-t.clientWidth);r!==i&&(t.scrollLeft=r)}if(e.scrollDeltaY!==0){const i=t.scrollTop,r=Math.min(i+e.scrollDeltaY,t.scrollHeight-t.clientHeight);r!==i&&(t.scrollTop=r)}e.scrollRequested=!0,e.frameId=e.scrollManager.requestAnimationFrame(()=>{e.scrollRequested=!1,e.performScroll(e)})}}onElementScroll(){var e,t;(e=this.config)===null||e===void 0||(t=e.callback)===null||t===void 0||t.call(this.thisObj||this.scrollManager,this)}get scrollLeft(){return this.element.scrollLeft}get scrollTop(){return this.verticalElement?this.verticalElement.scrollTop:this.element.scrollTop}get scrollRelativeLeft(){return this.scrollLeft-this.startScrollLeft}get scrollRelativeTop(){return this.scrollTop-this.startScrollTop}getRelativeLeftScroll(e){return this.scrollManager.getRelativeScroll(e,"left")}getRelativeTopScroll(e){return this.scrollManager.getRelativeScroll(e,"top")}}Pa._$name="ScrollManager";const n0={left:!0,right:!0,top:!0,bottom:!0,transform:!0},s0={true:1,false:1},a0=Promise.resolve();class ce extends We{static get $name(){return"Tooltip"}static get type(){return"tooltip"}static get configurable(){return{mouseOffsetX:15,mouseOffsetY:15,html:{$config:{equals:()=>!1}},getHtml:null,forElement:null,trackMouse:null,updateContentOnMouseMove:!1,forSelector:null,hideOnDelegateChange:null,anchorToTarget:!0,showOnHover:!1,hoverDelay:500,autoShow:!1,dismissDelay:0,hideDelay:500,loadingMsg:"Loading...",allowOver:null,anchor:!0,align:{align:"b-t",minHeight:300},axisLock:!0,activeTarget:null,testConfig:{hideDelay:100,hoverDelay:100,showAnimation:null,hideAnimation:null}}}afterConfigure(){const e=this,{forSelector:t}=e;t&&(e.showOnHover=!0,e.forElement||(e.anchorToTarget||(e.trackMouse=!0),e.forElement=e.rootElement.host||e.rootElement)),super.afterConfigure(),e.forElement&&e.showOnHover&&(e.pointerOverOutDetacher=B.on({element:e.forElement,pointerover:"internalOnPointerOver",pointerout:"internalOnPointerOut",thisObj:e}))}doDestroy(){var e;(e=this.pointerOverOutDetacher)===null||e===void 0||e.call(this),super.doDestroy()}set focusOnToFront(e){super.focusOnToFront=e}get focusOnToFront(){return super.focusOnToFront&&S.usingKeyboard}get focusElement(){const e=super.focusElement;if(e!==this.element)return e}get anchorToTarget(){return this._anchorToTarget&&!this.trackMouse}get anchor(){return super.anchor&&!this.trackMouse}set anchor(e){super.anchor=e}onDocumentMouseDown({event:e}){const t=this,{triggeredByEvent:i}=t;i&&S.isTouchEvent&&e.pageX===i.pageX&&e.pageY===i.pageY&&t.activeTarget.contains(e.target)&&performance.now()-i.timeStamp<500||(t.abortDelayedShow(),super.onDocumentMouseDown({event:e}))}internalOnPointerOver(e){const t=this,{target:i,relatedTarget:r}=e,{forElement:n,forSelector:s,activeTarget:a}=t;let o;if(!(t.disabled||t.owner&&!t.owner.showTooltipWhenDisabled&&t.owner.disabled)&&!(t.allowOver&&t.element.contains(i))){if(s){if(o=i.closest(s),a!=null&&a.contains(i)&&a.contains(r)&&o===a||o&&r?.closest(s)===o)return}else if(!n.contains(r))o=n;else return;o?t.handleForElementOver(e,o):a&&t.handleForElementOut()}}onTransitionEnd(e){const t=this,{currentOverElement:i}=ce;if(n0[e.propertyName]){var r;if(t.allowOver&&t.element.contains(i))return;(r=t.activeTarget)!==null&&r!==void 0&&r.contains(i)&&!t.trackMouse&&t.realign()}}async handleForElementOver(e,t){const i=this,{activeTarget:r,hideOnDelegateChange:n,anchorToTarget:s}=i,a=t!==r,o=a&&n;if(i.trigger("pointerOver",{event:e,target:t})===!1)i.internalOnPointerOut(e);else{if(i.triggeredByEvent=e,i.hasTimeout("hide")&&(i.abortDelayedHide(),!a))return;if(!n&&i.element.classList.contains("b-hiding")&&i.cancelHideShowAnimation(),!i._hidden&&o&&i.hide(!1),i.activeTarget=t,i.isVisible){const l=i.updateContent();if(U.isPromise(l)&&!i.loadingMsg&&await l,i.trigger("beforeShow")===!1)return i.hide();i.alignTo({[s?"target":"position"]:s?t:"mouse",overlap:!(s&&i.anchor)}),i.trigger("show"),i.afterShowByTarget()}else i.delayShow(t)}}async delayShow(e){var t;const i=this;if((t=i.currentAnimation)!==null&&t!==void 0&&t.showing&&i.cancelHideShowAnimation(),!i.isVisible&&!i.hasTimeout("show"))if(!i.hoverDelay||i.forSelector&&Date.now()-i.lastHidden<i.quickShowInterval){const r=i.updateContent();U.isPromise(r)&&!i.loadingMsg&&await r,i.showByTarget(e)}else i.addDocumentMouseDownListener(),!i.listeningForMouseMove&&!i.anchorToTarget&&(i.mouseMoveRemover=B.on({element:i.rootElement,mousemove:"onMouseMove",thisObj:i})),i.setTimeout(async()=>{if(!S.isOrphaned(e)){const r=i.updateContent();U.isPromise(r)&&!i.loadingMsg&&await r,i.showByTarget(e)}},!i.triggeredByEvent||i.triggeredByEvent.type==="pointerover"?i.hoverDelay:0,"show");else i.isVisible&&i.showByTarget(e)}changeAllowOver(e){return this.inAfterShow||(this.configuredAllowOver=e),e}updateAllowOver(e){const t=this,{element:i}=t;if(i.classList.toggle("b-allow-over",Boolean(e)),e)t.allowOverlisteners=B.on({element:i,mouseenter:"onOwnElementMouseEnter",mouseleave:"internalOnPointerOut",thisObj:t});else{var r;(r=t.allowOverlisteners)===null||r===void 0||r.call(t)}}updateContent(){const e=this;if(e.getHtml){const t=e.callback(e.getHtml,e,[{tip:e,element:e.element,activeTarget:e.activeTarget,event:e.triggeredByEvent}]);return e.html=t,t}}get hasContent(){return Boolean(S.isReactElement(this._html)||this._html!==""&&typeof this.html=="string"&&this.html.length||this.items.length)}internalBeforeShow(){return(this.updateContentOnMouseMove||this.hasContent)&&!this.disabled}showAsyncMessage(e=this.optionalL(this.loadingMsg)){e&&(this.html=`
                <div class="b-tooltip-loading">
                    <i class="b-icon b-icon-spinner"></i>
                    ${e}
                </div>
            `)}beforeAlignTo(e){super.beforeAlignTo(e);const t=this;!t.anchorToTarget&&e.position==="mouse"&&(e.position=new si(t.triggeredByEvent.pageX-globalThis.pageXOffset+t.mouseOffsetX*(t.rtl?-1:1),t.triggeredByEvent.pageY-globalThis.pageYOffset+t.mouseOffsetY))}showByTarget(e){var t;const i=this,{anchorToTarget:r}=i;i.mouseMoveRemover=(t=i.mouseMoveRemover)===null||t===void 0?void 0:t.call(i),i.showBy({[r?"target":"position"]:r?e:"mouse",overlap:!(r&&i.anchor)})}afterShowByTarget(){const e=this,{dismissDelay:t}=e;e.abortDelayedShow(),t&&e.setTimeout("hide",t),e.toFront(),!e.mouseMoveRemover&&(e.trackMouse||e.updateContentOnMouseMove)&&(e.mouseMoveRemover=B.on({element:e.rootElement,pointermove:"onMouseMove",thisObj:e})),e.inAfterShow=!0,e.allowOver=e.allowOver||e.configuredAllowOver!=!1&&e.childItems.some(i=>i.isVisible&&!i.disabled&&i.focusElement),e.inAfterShow=!1}updateActiveTarget(e,t){e&&!this.isConfiguring&&this.trigger("overTarget",{newTarget:e,lastTarget:t})}internalOnPointerOut(e){var t;const i=this,r=e.relatedTarget;i.allowOver&&i.element.contains(r)||i.element.contains(e.target)&&(t=i.activeTarget)!==null&&t!==void 0&&t.contains(r)||i.activeTarget&&!i.activeTarget.contains(r)&&i.handleForElementOut()}handleForElementOut(){const e=this,{hideDelay:t}=e;if(e.trigger("pointerOut")===!1){e.activeTarget=null;return}e.abortDelayedShow(),e.isVisible&&t!==!1&&(e.abortDelayedHide(),t>0?e.setTimeout("hide",t):e.hide())}show(e){const t=this;!e&&t.forElement&&t.anchorToTarget&&!t.forSelector?t.showByTarget(t.forElement):super.show(...arguments),t.afterShowByTarget(),t.forElement&&!t.transitionEndDetacher&&!t._hidden&&(t.transitionEndDetacher=B.on({element:t.forElement,transitionend:"onTransitionEnd",thisObj:t}))}hide(){const e=this;if(e.abortDelayedShow(),e._hidden)return a0;{var t,i;e.abortDelayedHide();const r=super.hide(...arguments);return e.lastHidden=Date.now(),e.activeTarget=null,(t=e.mouseMoveRemover)===null||t===void 0||t.call(e),e.mouseMoveRemover=null,(i=e.transitionEndDetacher)===null||i===void 0||i.call(e),e.transitionEndDetacher=null,r}}abortDelayedShow(){const e=this;if(e.hasTimeout("show")){var t,i,r;(t=e.mouseDownRemover)===null||t===void 0||t.call(e),e.mouseDownRemover=null,e.clearTimeout("show"),(i=e.mouseMoveRemover)===null||i===void 0||i.call(e),e.mouseMoveRemover=null,(r=e.transitionEndDetacher)===null||r===void 0||r.call(e),e.transitionEndDetacher=null}}abortDelayedHide(){this.clearTimeout("hide")}realign(){const e=this,t=e.lastAlignSpec;!e.isConfiguring&&!e.isVisible&&t!==null&&t!==void 0&&t.targetOutOfView&&(t.allowTargetOut||S.isInView(t.target,!1,e))&&(e.show(),t.targetOutOfView=!1),super.realign()}alignTo(e){const t=this;!t.isVisible||(e&&!(t.triggeredByEvent&&t.element.contains(t.triggeredByEvent.target))&&e.nodeType===Node.ELEMENT_NODE&&(e={target:e}),super.alignTo(e))}changeHtml(e){const t=this;if(U.isPromise(e)){t.showAsyncMessage(),e.target=t.activeTarget,e.then(i=>{e.target===t.activeTarget&&(t.html=i)});return}return typeof e!="object"&&(e=e!=null?t.optionalL(String(e)):""),e}updateHtml(e,t){const i=this;let r=e==="";r||(super.updateHtml(e,t),i.hasContent?(i.isVisible&&i.realign(),U.isPromise(e)||i.trigger("innerHtmlUpdate",{value:e})):r=!0),r&&i.hide()}onMouseMove(e){const t=this,{forElement:i,activeTarget:r}=t,n=t.hasTimeout("hide"),s=e.target;if(t.triggeredByEvent=e,!t._hidden){let a;const o=r?.contains(s),l=!o&&t.forSelector&&r&&!n&&s.nodeType===Node.ELEMENT_NODE&&!s.matches(t.forSelector)&&!(t.allowOver&&t.element.contains(s)),d=i!=null&&i.document?i.document.documentElement:i,u=d&&(d.contains?d.contains(s):d.compareDocumentPosition(s)&16);if(l&&(a=t.handleForElementOut()),a||!n||u){if(t.dismissDelay&&!n&&t.setTimeout("hide",t.dismissDelay),t.updateContentOnMouseMove&&t.getHtml&&(t.html=t.callback(t.getHtml,t,[{tip:t,element:t.element,forElement:r,event:e}]),!t.html)){t.hide();return}t.trackMouse&&t.alignTo({position:"mouse",ignorePageScroll:!0})}}}onOwnElementMouseEnter(e){this.abortDelayedHide()}static getSharedTooltip(e,t){var i,r;let n=(i=e.bryntum)===null||i===void 0||(r=i.tooltip)===null||r===void 0?void 0:r.get(ce);if(!n&&!t){var s;(s=e.bryntum)!==null&&s!==void 0&&s.tooltip||T.setPath(e,"bryntum.tooltip",new Map);const a=e.bryntum.tooltip;a.set(ce,!0),n=new ce({forElement:e,rootElement:e,forSelector:"[data-btip]",resetCfg:{},isShared:!0,cls:"b-tooltip-shared",internalListeners:{pointerOver({source:o,target:l}){for(const h in o.resetCfg)h==="listeners"?o.un(o.resetCfg[h].set):h!=="html"&&(o[h]=o.resetCfg[h].was);o.resetCfg={};const d=N.getById(l.id),u=d?.tipConfig||o.gatherDataConfigs(l.dataset);if(d&&d.element!==l||!d&&l.matches(".b-widget")||d!=null&&d.disabled&&!d.showTooltipWhenDisabled)return!1;o.owner=d;for(const h in u)o.resetCfg[h]={set:u[h],was:o[h]},h==="listeners"?o.ion(u[h]):o[h]=u[h]},hide({source:o}){o.owner=null}},gatherDataConfigs(o){const l=this,d={};for(const u in o)if(u.startsWith("btip"))if(u.length>4){const h=z.uncapitalize(u.substr(4));if(h in l.getDefaultConfiguration()){const f=o[u];d[h]=s0[f]?f==="true":isNaN(f)?f:parseInt(f,10)}}else d.html=o[u];return d}}),B.on({element:e,mouseenter:o=>ce.currentOverElement=o.target,keydown:o=>ce.currentOverElement=o.target,capture:!0,thisObj:n}),a.set(ce,n)}return n}static encodeConfig(e){const t={};if(typeof e=="string")t.btip=e;else for(const i in e)t[`btip${i==="html"?"":z.capitalize(i)}`]=e[i];return t}}ce.initClass();Object.defineProperty(N,"tooltip",{get(){return ce.getSharedTooltip(document.body)}});N.Tooltip=ce;ce._$name="Tooltip";class Ug extends _r{static get type(){return"tip"}static get configurable(){return{align:"t10-b50",offset:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip"}}}}open(){this.getConfig("tooltip")}close(){var e;(e=this.tooltip)===null||e===void 0||e.hide()}dragMove(e){const{offset:t,tooltip:i}=this,{event:r}=e;i&&(i.isVisible||i.show(),i.alignTo({align:this.align,target:new $(r.clientX-t,r.clientY-t,t*2,t*2)}))}changeTooltip(e,t){return N.reconfigure(t,e,this)}}Ug.initClass();Ug._$name="DragTipProxy";var Yg=c=>class extends(c||P){static get $name(){return"Labelable"}static get configurable(){return{label:null,labelPosition:"before",labelCls:null,labelWidth:{value:null,$config:{localeKey:"L{labelWidth}"}}}}get hasLabel(){return Boolean(this.label)}compose(){const{hasLabel:t,labelPosition:i}=this;return{class:{[`b-label-${i}`]:t,"b-has-label":t}}}changeLabel(t){return t||""}setupLabel(t){return T.assign({tag:"label",for:`${this.id}-input`,class:`b-label b-align-${t.align||"start"}`},t)}updateLabelWidth(t){this.labelElement&&(this.labelElement.style.flex=`0 0 ${S.setLength(t)}`,this.inputWrap.style.flexBasis=t==null?"":"auto")}get widgetClass(){}};class Gg extends wt{static get $name(){return"FieldContainer"}static get type(){return"fieldcontainer"}static get configurable(){return{animation:{duration:300},collapsed:null,collapser:{value:null,$config:"nullify"},syncableConfigs:null,syncConfigTriggers:{$config:{merge:"classList"},value:null},testConfig:{animation:{duration:10}}}}static get delayable(){return{syncChildConfigs:"raf"}}get inline(){var e;return(e=this.owner.inline)!==null&&e!==void 0?e:this.ensureItems().count===1}changeCollapsed(e){if(this.togglingCollapse)return this.togglingCollapse=!1,e;this.toggleCollapse(Boolean(e))}updateCollapsed(e){var t;this.collapser=(t=this.collapser)===null||t===void 0?void 0:t.destroy(),this.setCollapsedCls(e)}updateCollapser(e,t){t&&t.completed==null&&(!t.reverting||!e)&&t.destroy(),this.setOwnerCls("b-collapsing",e)}get collapsing(){const{collapser:e}=this;return e!=null&&e.collapsed}get collapsingExpanding(){return this.collapser!=null}get expanding(){const{collapser:e}=this;return e!=null&&!e.collapsed}collapse(e){this.toggleCollapse(!0,e)}expand(e){this.toggleCollapse(!1,e)}setCollapsedCls(e){this.setOwnerCls("b-collapsed",e)}setOwnerCls(e,t){var i,r;(i=this.owner)===null||i===void 0||(r=i.element)===null||r===void 0||r.classList[t?"add":"remove"](e)}syncChildConfigs(){const e=this,{owner:t,syncableConfigs:i}=e;if(i){let r,n;for(r in i)n=i[r](t),e.eachWidget(s=>{s[r]=n},!1)}t.afterSyncChildConfigs(e)}syncContainer(){const{inline:e,layout:t}=this;this.autoLayout&&(t.horizontal=e,t.justify=e?"center":"stretch")}toggleCollapse(e,t){const i=this,{animation:r,collapser:n,inline:s}=i,{containerWrapElement:a}=i.owner,o=l=>{l&&(i.element.style.height="",i.togglingCollapse=!0,i.collapsed=e,i.collapser=null)};if(e==null&&(e=!i.collapsed),t!==!1&&t!==null&&(!a||!i.isVisible?t=null:(t===!0?t={}:typeof t=="number"&&(t={duration:t}),t=r||t?T.merge({},r,t):null)),!t)i.togglingCollapse=!0,i.collapsed=e;else if(n&&e!==n.collapsed)i.collapser=n.revert({finalize:o}),i.collapser.collapsed=e;else if(!n&&e!==i.collapsed){!e&&i.setCollapsedCls(!1);const{element:l}=i,{height:d}=l.getBoundingClientRect(),u=s?1:d;!e&&i.setCollapsedCls(!0),l.style.height=`${d}px`,i.collapser=Te.run(T.merge({finalize:o,element:a,[s?"opacity":"height"]:{from:e?u:0,to:e?0:u}},t)),i.collapser.collapsed=e}}}Gg.initClass();Gg._$name="FieldContainer";const o0=(c,e)=>(c.weight||0)-(e.weight||0),l0=(c,e)=>(e.weight||0)-(c.weight||0),ul=[],d0={align:!0,weight:!0};class Oe extends N.mixin($g,Yg){static get $name(){return"Field"}static get type(){return"field"}static get configurable(){return{defaultBindProperty:"value",placeholder:null,value:"",name:null,labels:null,required:null,clearable:null,revertOnEscape:null,hint:null,hintHtml:null,inputWidth:null,keyStrokeChangeDelay:0,readOnly:null,editable:!0,defaultAction:"change",triggers:null,highlightExternalChange:!0,localizableProperties:["label","title","placeholder","labelWidth"],autoSelect:!1,autoComplete:"off",spellCheck:null,validateOnInput:!0,inputAttributes:null,inputType:"text",inputAlign:null,attributes:{value:["placeholder","autoComplete","spellCheck","minLength","maxLength","pattern","tabIndex","min","max"],$config:{merge:"distinct"}},nullValue:{$config:null,value:null,default:null},updatedClsDuration:500,inputReadOnly:!1,ariaElement:"input",container:{$config:"nullify",value:null},containerDefaults:{type:"fieldcontainer",syncableConfigs:{disabled:e=>e.disabled},syncConfigTriggers:{disabled:1}},containValues:null,inline:null,testConfig:{updatedClsDuration:10},keyMap:{}}}static get delayable(){return{highlightChanged:"raf"}}doDestroy(){var e,t,i;const r=this,{triggers:n}=r,s=r.isPainted&&Oe.getSharedErrorTooltip(r.rootElement,!0);if((e=r.inputListenerRemover)===null||e===void 0||e.call(r),(t=r.keyListenerRemover)===null||t===void 0||t.call(r),(i=r.container)===null||i===void 0||i.destroy(),super.doDestroy(),n)for(const a of Object.values(n))a.destroy();s?.field===r&&s.hide()}get childItems(){const{container:e,triggers:t}=this,i=t?Object.values(t):[];return e?[...i,...e.childItems]:i}get invalidValueError(){return"L{invalidValue}"}get errorTip(){return this.constructor.getSharedErrorTooltip(this.rootElement)}static getSharedErrorTooltip(e,t){var i;let r=(i=e.bryntum)===null||i===void 0?void 0:i.errorTooltip;return!r&&!t&&(e.bryntum=e.bryntum||{},r=new ce({cls:"b-field-error-tip",forSelector:".b-field.b-invalid .b-field-inner",align:{align:"l-r",monitorTargetMutation:!0},scrollAction:"realign",trapFocus:!1,rootElement:e,onBeforeShow(){const n=this,s=N.fromElement(n.activeTarget);if(s){const a=s.getErrors();if(a)return n.html=a.join("<br>"),n.field=s,!0}return!1}}),e.bryntum.errorTooltip=r),r}static get errorTip(){return this.getSharedErrorTooltip(document.body)}construct(e){super.construct(e);const t=this;t.keyStrokeChangeDelay&&(t.changeOnKeyStroke=t.buffer(t.internalOnChange,t.keyStrokeChangeDelay))}changeKeyMap(e){const t=this;let i={};e&&(t._fieldKeyMap?T.assign(i,t._fieldKeyMap):(t._fieldKeyMap=e,T.assign(i,e)));for(const n in t.triggers){var r;(r=t.triggers[n])!==null&&r!==void 0&&r.keyMap&&(i=t.mergeKeyMaps(i,t.triggers[n].keyMap,n))}return i}get keyMapSubComponents(){return this.triggers}onFocusIn(e){const t=this;t.valueOnFocus=T.clone(t.value),t.validOnFocus=!(t.errors&&Object.keys(t.errors).length),super.onFocusIn(e),t.focusing=!0,t.syncInvalid(),t.focusing=!1}onFocusOut(e){super.onFocusOut(e),this.syncRequired(),this.onEditComplete()}onEditComplete(){}get rootUiClass(){return Oe}compose(){this.getConfig("clearable");const e=this,{container:t,innerElements:i,label:r,labels:n,labelCls:s,readOnly:a,triggers:o}=e,l=T.values(o,(g,m)=>!m),d=l.filter(g=>g.align==="start").sort(o0),u=l.filter(g=>g.align!=="start").sort(l0),h=e.setupLabel.bind(e),f=[...d.map(g=>g.element),...i,...u.map(g=>g.element)];return{class:{"b-has-start-trigger":d.length,"b-no-input":!i.length,"b-readonly":a,"b-field-container":Boolean(t),"b-field-container-inline":t?.inline},children:[...(n||ul).filter(g=>g&&g.align!=="end").map(h),(r||null)&&h({reference:"labelElement",class:`b-label b-align-start ${s||""}`,html:r}),f.length?{class:"b-field-inner",reference:"inputWrap",children:f}:null,...(n||ul).filter(g=>g?.align==="end").map(h),...t?[{reference:"containerWrapElement",children:[t.element],class:{"b-field-container-wrap":1}}]:ul]}}updateElement(e,t){var i;const r=this,n=r.initialConfig.value,{input:s}=r;super.updateElement(e,t),n!=null&&(r.value=n),r.syncEmpty(),r.updateInputReadOnly(r.inputReadOnly),r.syncInvalid();const a=s||r.focusElement;(i=r.keyListenerRemover)===null||i===void 0||i.call(r),r.keyListenerRemover=a&&B.on({element:a,thisObj:r,keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}get innerElements(){return[this.inputElement]}get inputElement(){const{attributes:e,inputAttributes:t,id:i,inputCls:r,inputType:n,name:s}=this,a=T.assign({reference:"input",tag:"input",type:n,name:s||i,id:`${i}-input`,retainElement:!0},t);r&&(a.class=r);for(let o,l,d=e.length;d-- >0;)o=e[d],l=this[o],l!=null&&(a[o]=l);return a}get caretPos(){return this.textSelection[0]}set caretPos(e){this.textSelection=e}get focusElement(){return this.input}get textSelection(){const e=this.input;let t;try{t=[e.selectionStart,e.selectionEnd,e.selectionDirection]}catch{var i;t=((i=e.value)===null||i===void 0?void 0:i.length)||0,t=[t,t]}return t}set textSelection(e){typeof e=="number"?this.select(e,e):this.select(...e)}get hasTextSelection(){const[e,t]=this.textSelection;return e&&t-e>0}getAfterValue(e){const[t,i]=this.textSelection,r=this.input.value;return`${r.substr(0,t)}${e}${r.substr(i||t)}`}select(e,t){const i=this.focusElement;if(i.value.length){if(arguments.length===0){this.selectAll();return}if(!this.supportsTextSelection)return;i.setSelectionRange(e,t)}}moveCaretToEnd(){const e=this.input;if(e.createTextRange){const t=e.createTextRange();t.collapse(!1),t.select()}else this.supportsTextSelection&&this.select(e.value.length,e.value.length)}selectAll(){this.focusElement.select()}syncEmpty(){var e;const{isEmptyInput:t,isEmpty:i,element:r}=this,n=(e=this.triggers)===null||e===void 0?void 0:e.clear,s=t&&i;r&&(n&&n[s?"hide":"show"](),r.classList.toggle("b-empty",s))}updateHint(){this.syncHint()}updateHintHtml(){this.syncHint()}syncHint(){const e=this,{input:t,hint:i,hintHtml:r}=e,n=t?.parentElement;if(t){let s=r||i;const a=e.hintElement||s&&(e.hintElement=S.createElement({parent:n,className:"b-field-hint",nextSibling:t.nextSibling,children:[{className:"b-field-hint-content"}]}));a&&(typeof s=="function"&&(s=s({source:e,value:e.value})),a.firstChild[r?"innerHTML":"textContent"]=s||""),e.element.classList[s?"remove":"add"]("b-field-no-hint")}}syncInvalid(){const e=this,{isPainted:t}=e;if(e.updatingInvalid=!0,t){const{isValid:i,element:r,inputWrap:n}=e;if(r.classList[i?"remove":"add"]("b-invalid"),i){const s=e.constructor.getSharedErrorTooltip(e.rootElement,!0);s!=null&&s.isVisible&&s.field===e&&s.hide()}else{const s=e.errorTip;s&&(e.containsFocus||e.isVisible&&n.contains(ce.currentOverElement))&&(s.activeTarget===n&&s.isVisible?s.onBeforeShow():(s.activeTarget=n,s.showBy(n)))}}e.updatingInvalid=!1}updateEditable(){this.syncInputReadOnly()}syncInputReadOnly(){this.getConfig("readOnly"),this.inputReadOnly=this._readOnly||this.editable===!1}updateInputReadOnly(e){const t=this,{input:i,inputListenerRemover:r}=t;i&&(i.readOnly=e?"readOnly":null,e?t.inputListenerRemover=r?.():r||(t.inputListenerRemover=B.on({element:i,thisObj:t,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput"})))}changeReadOnly(e){return Boolean(e)}updateReadOnly(e){this.syncInputReadOnly()}updateClearable(e){const t=this;t.getConfig("triggers"),t.triggers={clear:e&&T.assign({cls:"b-icon-remove",weight:1e3,key:"Shift+backspace",handler(){t._isUserAction=!0,t.clear(...arguments),t._isUserAction=!1}},e)||null}}changeTriggers(e,t){const i=this,r=i.$triggers||(i.$triggers=new Ki({configName:"triggers",factory:Oe.Trigger,inferType:!1,owner:i,created(n){ve.after(n,"onConfigChange",(s,{name:a})=>{d0[a]&&i.onConfigChange({name:"triggers",value:r.target})})},setup(n,s){n.reference=n.ref=s,n.parent=i}}));if(i.stepTriggers===!1&&(e.back||e.forward)&&(e=T.assign({},e),delete e.back,delete e.forward),r.update(e),i.element&&(i.keyMap=i.keyMap),!t)return r.target}updateInputWidth(e){this.input.style.width=S.setLength(e),this.element.classList.add("b-has-width")}updateInputAlign(e){this.input.style.textAlign=e}get isValid(){const e=this;if(!e.disabled){if(e.syncRequired(),e.errors&&Object.keys(e.errors).length)return!1;const t=e.validity;if(t)return t.valid}return!0}get isEmpty(){return this.value==null||this.value===""}get isEmptyInput(){return!this.input||this.input.value==null||this.input.value===""}get validity(){const e=this.input;return e?.validity}changeValue(e,t){return e==null&&(e=this.nullValue),this.hasChanged(t,e)?e:(e===""&&this.syncRequired(),t)}updateValue(e,t){const i=this;i.isConfiguring||(i.syncRequired(),i.inputting||i.triggerChange()),i.inputting||(i._lastValue=e),i.syncInputFieldValue(),i.overflowTwin&&!i._overflowTwinSync&&(i._overflowTwinSync=!0,i.overflowTwin.value=e,i._overflowTwinSync=!1)}hasChanged(e,t){return t!==e}syncInputFieldValue(e=!1){const t=this,{input:i,parent:r,inputValueAttr:n,inputValue:s}=t;if(i&&!t.inputting&&i[n]!==s&&(i[n]=s,!t.isConfiguring&&!t.containsFocus&&t.highlightExternalChange)){if(i.classList.remove("b-field-updated"),t.clearTimeout("removeUpdatedCls"),r){const{assigningValues:a}=r;(a===!0||a?.highlight===!1)&&(e=!0)}e||t.highlightChanged()}t.syncEmpty(),t.syncInvalid()}highlightChanged(){this.input.classList.add("b-field-updated"),this.setTimeout("removeUpdatedCls",this.updatedClsDuration)}removeUpdatedCls(){this.input.classList.remove("b-field-updated")}get inputValue(){return this.value==null?"":this.value}get inputValueAttr(){return"value"}get supportsTextSelection(){const e=this.focusElement;return e&&(e.tagName.toLowerCase()==="textarea"||e.type&&/text|search|password|tel|url/.test(e.type))}internalOnInputFocus(){this.autoSelect&&this.selectAll()}internalOnChange(e){const t=this;t.hasChanged(t._lastValue,t.value)&&t.isValid&&(t.triggerChange(e,!0),t._lastValue=t.value)}triggerChange(e,t=Boolean(this._isUserAction)){const i=this,{value:r,_lastValue:n,isValid:s}=i;i.syncHint(),i.triggerFieldChange({value:r,oldValue:n,event:e,userAction:t,valid:s}),i.defaultAction==="change"&&i.trigger("action",{value:r,oldValue:n,event:e,userAction:t,valid:s})}fetchInputValue(){this.value=this.input[this.inputValueAttr]}internalOnInput(e){var t;const i=this;i.validateOnInput||i.errorTip.hide(),i.inputting=!0,i.fetchInputValue(),i.inputting=!1,i.trigger("input",{value:i.value,event:e}),(t=i.changeOnKeyStroke)===null||t===void 0||t.call(i,e)}get needsInputSync(){var e;return this.input[this.inputValueAttr]!==String((e=this.inputValue)!==null&&e!==void 0?e:"")}internalOnKeyEvent(e){const t=this,{value:i}=t;let r=!1;if(e.type==="keydown"&&e.key==="Escape"&&!(t.readOnly||t.disabled)){const n=t.isValid,s="initialValue"in t?t.initialValue:t.valueOnFocus,a=t.hasChanged(s,i),{needsInputSync:o}=t;t.revertOnEscape&&(!n||a||o)&&(a&&(t.value=s),o&&t.syncInputFieldValue(!0),t.clearError(),r=(a||o)&&t.isValid||n!==t.validOnFocus)}t.isDestroyed||(r&&e.stopImmediatePropagation(),t.trigger(e.type,{event:e}))}clear(e){const t=this,{value:i}=t;(i!==t.nullValue||t.input.value.length>0)&&(t.value=t.nullValue,t.clearError(),t.syncInvalid(),t.trigger("clear",{event:e}))}onDisabled(){this.syncInvalid()}syncRequired(){var e;const t=this;!t.isConfiguring&&!t.focusing&&t.required&&t.isEmpty&&!((e=t.parent)!==null&&e!==void 0&&e.isSettingValues)?t.setError("L{fieldRequired}",t.updatingInvalid):t.clearError("L{fieldRequired}",t.updatingInvalid)}setError(e,t,i){const r=this;if((r.errors||(r.errors={}))[r.optionalL(e)]=1,t||r.syncInvalid(),i){const n=()=>{r.clearError(e),s()},s=r.ion({keydown:n,focusOut:n})}}clearError(e,t){const i=this;i.errors&&(e?delete this.errors[this.optionalL(e)]:i.errors={}),t||i.syncInvalid()}getErrors(){const e=this;if(!e.isValid){var t;const i=e.validity,r=T.keys(i).find(a=>a!=="valid"&&a!=="customError"&&i[a]),n=e.errors&&Object.keys(e.errors);let s;if(n!=null&&n.length?s=n:i.customError?s=[e.input.validationMessage]:r?s=[e.L(r,{min:e.min,max:e.max})]:s=[e.L(e.invalidValueError)],((t=s)===null||t===void 0?void 0:t.length)>0)return s}}createOverflowTwin(e){const t=this,i=super.createOverflowTwin(e);return i.ion({change({value:r}){t._overflowTwinSync=!0,t.value=r,t._overflowTwinSync=!1}}),i}get containerCollapsed(){var e;return(e=this.container)===null||e===void 0?void 0:e.collapsed}set containerCollapsed(e){const{container:t}=this;t&&(t.collapsed=e)}afterSyncChildConfigs(e){}changeContainer(e,t){e&&(Array.isArray(e)||!("type"in e||"items"in e))&&(e={items:e});const i=this,r=e&&T.merge({owner:i,layout:"box"},i.containerDefaults),n=N.reconfigure(t,e,{owner:i,defaults:r});if(n&&(n.autoLayout=r?.layout==="box",n===t)){n.syncContainer();return}return n}onConfigChange(e){var t,i;super.onConfigChange(e),(t=this.container)!==null&&t!==void 0&&(i=t.syncConfigTriggers)!==null&&i!==void 0&&i[e.name]&&this.container.syncChildConfigs()}assignValue(e,t){const i=this,{container:r,containValues:n}=i,s=i.getValueName(t),a=e&&s in e;r&&n!==!1?e&&n==="nested"?a&&(e=T.clone(e[s]),super.assignValue({[s]:e&&!("value"in e)||e.value},t),e&&delete e.value,r.assignValue(e,t)):(super.assignValue(e,t),r.assignValue(e,t)):super.assignValue(e,t)}gatherValue(e){super.gatherValue(e),this.gatherValues(e)}gatherValues(e,t){var i;const r=this,{container:n,containValues:s,valueName:a}=r,o=typeof s;t=(i=t)!==null&&i!==void 0?i:a in e,n&&s!==!1&&(s==="nested"?t&&(e[a]=F({value:e[a]},n.values)):(s===!0||s==null&&t||o==="string"&&r[s]||o==="function"&&s(r))&&n.gatherValues(e))}updateContainer(e,t){t&&this.detachListeners(t.id),e&&(e.rendered||e.render(),e.syncContainer(),e.syncChildConfigs())}}Oe.Trigger=class extends N{static get $name(){return"FieldTrigger"}static get factoryable(){return{defaultType:Oe.Trigger,extends:null}}static get type(){return"trigger"}static get configurable(){return{align:null,weight:null,role:void 0}}get field(){return this.parent}construct(){super.construct(...arguments),this.key&&(this.keyMap={[this.key]:"onClick"})}compose(){return{"aria-hidden":!0,class:{[`b-align-${this.align||"end"}`]:1,"b-icon":1},listeners:{click:"onClick",mousedown:"onMousedown"}}}changeAlign(e){return e}onClick(e){const t=this,{field:i}=t;i.disabled||i.readOnly||(e.key&&e.preventDefault(),i.trigger("trigger",{trigger:t})!==!1&&t.handler&&i.callback(t.handler,i,[e,t]))}onMousedown(e){const t=this.field;!("key"in e)&&S.isTouchEvent&&t.editable&&(t.editable=!1,t.setTimeout(()=>t.editable=!0,500)),e.preventDefault(),S.getActiveElement(t.input)!==t.input&&t.focus()}};Oe.SpinTrigger=class extends Oe.Trigger{static get $name(){return"SpinTrigger"}static get type(){return"spintrigger"}static get configurable(){return{repeat:{$config:["nullify"],value:!0}}}compose(){return{children:{upButton:{class:{"b-icon":1,"b-spin-up":1}},downButton:{class:{"b-icon":1,"b-spin-down":1}}}}}updateRepeat(e){var t;(t=this.clickRepeater)===null||t===void 0||t.destroy(),this.clickRepeater=e?td.new({element:this.element},e):null}onClick(e){const t=this,{field:i}=t;i.disabled||i.readOnly||(e.target===t.upButton?i.doSpinUp(e.shiftKey):e.target===t.downButton&&i.doSpinDown(e.shiftKey))}};Oe.Trigger.initClass();Oe.SpinTrigger.initClass();N.register(Oe.Trigger,"trigger");N.register(Oe.SpinTrigger,"spintrigger");Oe._$name="Field";class Hr extends Oe{static get type(){return"textfield"}static get alias(){return"text"}static get configurable(){return{nullValue:""}}static get $name(){return"TextField"}construct(e){e?.inputType==="hidden"&&(e.hidden=!0),super.construct(...arguments)}}Hr.initClass();Hr._$name="TextField";class Gn extends Hr{static get $name(){return"PickerField"}static get type(){return"pickerfield"}static get configurable(){return{editable:!0,pickerAlignElement:"inputWrap",value:null,triggers:{expand:{cls:"bars"}},autoClose:!0,autoExpand:null,picker:{value:{floating:!0},$config:["lazy","nullify"]},inputType:"text",monitorResize:!0,nullValue:null}}doDestroy(){var e;(e=this.globalTapListener)===null||e===void 0||e.call(this),super.doDestroy()}updateEditable(e){const t=this,{element:i,ariaElement:r}=t;if(super.updateEditable(...arguments),e===!1){var n;r.removeAttribute("aria-autocomplete"),(n=t.globalTapListener)===null||n===void 0||n.call(t),i.classList.add("b-not-editable"),B.on({element:t.nonEditableClickTarget,click:s=>{const a=document.elementFromPoint(s.clientX,s.clientY);s.target===t.nonEditableClickTarget&&a===t.nonEditableClickTarget&&t.onTriggerClick(s)},thisObj:t})}else r.setAttribute("aria-autocomplete","list"),t.globalTapListener=ue.ion({globaltap:"showKeyboard",thisObj:t})}get nonEditableClickTarget(){return this.input}updateElement(e,t){var i;const r=super.updateElement(e,t),n=this.peekConfig("picker"),s=n?n.isWidget?n.role:(i=this.constructor.resolveType(n.type))===null||i===void 0?void 0:i.$meta.config.role:!1;return this.ariaHasPopup=s,r}changePicker(e,t){throw new Error("changePicker(oldPicker, newPicker) must be implemented in PickerField subclass implementations")}get childItems(){const e=super.childItems;return this._picker&&e.push(this.picker),e}onEditComplete(){super.onEditComplete(),this.autoClosePicker()}onElementResize(e){const t=this;t.pickerVisible&&t.picker.requestAnimationFrame(t.picker.realign,null,t.picker),super.onElementResize(e)}internalOnKeyEvent(e){const t=this;let i=!0;if(e.type==="keydown"&&!t.disabled&&!e.shiftKey&&!e.ctrlKey)if(t.pickerVisible){const{picker:r}=t;e.key==="Escape"?(e.preventDefault(),e.stopImmediatePropagation(),t.hidePicker(),i=!1):r.onInternalKeyDown?r.onInternalKeyDown(e):e.key==="ArrowDown"&&r.focusable&&r.focus()}else e.key==="ArrowDown"&&(e.stopImmediatePropagation(),e.preventDefault(),t.onTriggerClick(e));i&&super.internalOnKeyEvent(e)}onFocusIn(e){const t=this;super.onFocusIn(e),t.autoExpand&&(t.minChars=0,t.onTriggerClick(e),t.ignoreTriggerClick=!0,t.setTimeout(()=>t.ignoreTriggerClick=!1,100))}onTriggerClick(e){this.disabled||this.togglePicker("key"in e)}showKeyboard({event:e}){const t=this.input;S.isTouchEvent&&S.getActiveElement(t)===t&&e.target===t&&(ue.suspendFocusEvents(),t.blur(),t.focus(),ue.resumeFocusEvents())}togglePicker(e){this.pickerVisible?this.hidePicker():this.showPicker(e)}showPicker(e){const t=this,{picker:i}=t;t.pickerHideShowListenersAdded||(i.ion({show:"onPickerShow",hide:"onPickerHide",thisObj:t}),t.pickerHideShowListenersAdded=!0),S.setAttributes(t.ariaElement,{"aria-controls":i.id,"aria-expanded":!0}),i.autoClose=t.autoClose,i.show(),i.isVisible&&e&&t.focusPicker()}onPickerShow(){const e=this;e.pickerVisible=!0,e.element.classList.add("b-open"),e.trigger("togglePicker",{show:!0}),e.pickerTapOutRemover=ue.ion({globaltap:"onPickerTapOut",thisObj:e}),e.pickerKeyDownRemover=B.on({element:e.picker.element,keydown:"onPickerKeyDown",thisObj:e})}onPickerHide(){var e,t;const i=this;i.ariaElement.setAttribute("aria-expanded",!1),i.pickerVisible=!1,i.element.classList.remove("b-open"),i.trigger("togglePicker",{show:!1}),(e=i.pickerTapOutRemover)===null||e===void 0||e.call(i),(t=i.pickerKeyDownRemover)===null||t===void 0||t.call(i)}onPickerTapOut({event:e}){!this.containsFocus&&!this.owns(e.target)&&this.autoClosePicker()}onPickerKeyDown(e){if(e.key==="Tab"&&!this.picker.trapFocus){const t=S.getActiveElement(this.input),i=new KeyboardEvent("keydown",e);this.input.dispatchEvent(i),i.defaultPrevented&&e.preventDefault(),S.getActiveElement(this.input)===t?this.input.focus():e.preventDefault(),this.isDestroyed||this.hidePicker()}}autoClosePicker(){this.autoClose&&this.hidePicker()}hidePicker(){this.pickerVisible&&this.picker.hide()}focusPicker(){}focus(){const e=this.input;S.isTouchEvent&&this.editable&&(e.readOnly=!0,this.setTimeout(()=>e.readOnly=!1,500)),super.focus()}}Gn._$name="PickerField";const ui=document.createRange();class ji extends N{static get $name(){return"List"}static get type(){return"list"}static get configurable(){return{itemCls:"b-list-item",selectedCls:"b-selected",selectIconCls:"b-icon-check",tag:"ul",items:null,displayField:"text",store:null,navigator:!0,scrollable:{overflowX:!1,overflowY:!0},itemsFocusable:!0,multiSelect:!1,toggleAllIfCtrlPressed:!1,selectAllItem:!1,itemTpl(e){let t=z.encodeHtml(e[this.displayField]);return(t==null||t==="")&&(t="&nbsp;"),t},getItemStyle:null,getItemCls:null,groupHeaderTpl:(e,t)=>{let i=z.encodeHtml(t);return(i==null||i==="")&&(i="&nbsp;"),i},allowGroupSelect:!0,selected:{$config:"nullify",value:{}},activateOnMouseover:null,role:"listbox",keyMap:{"Ctrl+a":"selectAll"}}}construct(e,...t){var i;const r=this;Array.isArray(e)&&(e={items:e}),super.construct(e,...t);const{element:n}=r,{classList:s}=n;r.multiSelect&&s.add("b-multiselect"),(i=r.store)!==null&&i!==void 0&&i.count?r.refresh():s.add("b-empty"),B.on({element:n,delegate:r.itemSelector,mouseover:"onMouseOver",click:"onClick",thisObj:r})}doDestroy(){var e;this.detachListeners("store"),(e=this.navigator)===null||e===void 0||e.destroy(),super.doDestroy()}onFocusIn(e){var t;this.restoreActiveItem((t=e._target)===null||t===void 0?void 0:t.closest(this.itemSelector)),super.onFocusIn(e)}contentTpl(){const e=this,t=e.store.records.map((i,r)=>e.itemWrapperTpl(i,r));return e.multiSelect&&e.selectAllItem!==!1&&t.unshift(e.selectAllItemTpl()),bt.tpl`${t}`}itemWrapperTpl(e,t){const{selected:i,getItemStyle:r}=this,n=r?`style="${this.callback(r,this,[e])}"`:"";return bt.tpl`<li ${n} class="${this.getItemClasses(e,t)}" role="option" aria-selected="${i.includes(e)}" data-index="${t}" data-id="${z.encodeHtml(e.id)}" ${this.itemsFocusable?'tabindex="-1"':""}>${this.itemContentTpl(e,t)}</li>`}itemContentTpl(e,t){return"groupRowFor"in e.meta?this.groupHeaderTpl(e,z.capitalize(e.groupChildren[0][e.meta.groupField])):`${this.itemIconTpl(e,t)}${this.itemTpl(e,t)}`}itemIconTpl(e,t){return this.multiSelect?`<i class="b-selected-icon b-icon ${this.selectIconCls}"></i>`:""}selectAllItemTpl(){const e=this.allSelected?"b-selected":"";return`<li class="${this.itemCls} b-select-all-item ${e}" data-noselect data-select-all data-id="select-all">${this.itemIconTpl({})}<div>${this.optionalL("Select All")}</div></li>`}getItemClasses(e){var t;const i=this,{getItemCls:r}=i,n=(t=i._navigator)===null||t===void 0?void 0:t.activeItem,s=n?.dataset.id==e.id,a="groupRowFor"in e.meta?"b-list-item-group-header":"",o=i.selected.includes(e),l=r?this.callback(r,this,[e]):"";return`${i.itemCls} ${e.cls||""} ${l} ${o?i.selectedCls:""} ${s?i.navigator.focusCls:""} ${a}`}onBeforeStoreLoad(){this.mask(this.L("L{loading}"))}onAfterStoreRequest(){this.unmask()}onStoreChange({source:e,action:t,records:i,record:r,changes:n}){const s=this,{selected:a}=s;switch(t){case"dataset":{a.match(e.storage,!s._externallyOwnedSelection);break}case"remove":a.remove(i);break;case"clear":s.deselectAll();break;case"update":{const{id:o}=n;o&&S.setAttributes(s.contentElement.querySelector(z.encodeAttributeSelector("data-id",o.oldValue)),{"data-id":o.value}),s.refreshItem(r);return}}s.refresh()}onStoreRefresh(){this.refresh()}refresh(){const e=this;if(e.isVisible){var t;const i=(t=e.navigator)===null||t===void 0?void 0:t.activeItem;e.paintListener=null;const r=S.createElementFromTemplate(e.contentTpl(),{fragment:!0});e.clearItems().insertNode(r),i&&e.restoreActiveItem(i),e.refreshCount=(e.refreshCount||0)+1,e.element.classList[e.store.count>0?"remove":"add"]("b-empty"),e.updateSelectAllState()}else e.paintListener||(e.paintListener=e.ion({paint:"refresh",thisObj:e,once:!0}))}clearItems(){const e=this,t=e.contentElement.querySelector(e.itemSelector),i=e.contentElement.lastChild;if(t){const r=e.contentElement.querySelectorAll(`${e.itemSelector}:not(.b-mask)`);ui.setStartBefore(t),ui.setEndAfter(r[r.length-1]),ui.deleteContents()}else i?(ui.setStartAfter(i),ui.setEndAfter(i)):(ui.setStart(e.contentElement,0),ui.setEnd(e.contentElement,0));return ui}refreshItem(...e){for(const t of e){const i=this.getItem(t);if(i){const r=this.store.indexOf(t),n=S.createElementFromTemplate(this.itemWrapperTpl(t,r));S.sync(n,i)}}}getItem(e){if(e!=null){var t;return typeof e=="number"?this.contentElement.querySelector(`[data-index="${e<0?this.store.count+e:e}"]`):(e.nodeType===Element.ELEMENT_NODE&&(e=e.dataset.id),((t=e)===null||t===void 0?void 0:t.id)!=null&&(e=e.id),this.contentElement.querySelector(z.encodeAttributeSelector("data-id",e)))}}getRecordFromElement(e){return e.target&&(e=e.target),e=e.closest(this.itemSelector),this.store.getAt(parseInt(e.dataset.index))}updateItems(e){const t=this;t.store&&t.store.autoCreated&&t.store.destroy(),t.store=se.getStore(e)}updateDisabled(e){super.updateDisabled(...arguments),this.navigator&&(this.navigator.disabled=e)}changeSelected(e,t){if(e){let i;e.isCollection?this._externallyOwnedSelection=!0:(Array.isArray(e)?(i=e,e={}):e.values&&(i=e.values,e=F(F({},e),{},{values:[]})),e=new rt(e)),e.ion({change:"onSelectionChange",thisObj:this}),this.initialSelection=i}else t?.destroy();return e}get itemSelector(){return`.${this.itemCls}`}get selected(){return this._selected}get store(){return this.getConfig("items"),this._store}changeStore(e){const t=this;if(e instanceof se||(Array.isArray(e)&&(e={data:e}),e=new se(e)),t.detachListeners("store"),e){const i={name:"store",change:"onStoreChange",refresh:"onStoreRefresh",thisObj:t};e.readUrl&&(i.beforeLoad="onBeforeStoreLoad",i.afterRequest="onAfterStoreRequest"),e.isGrouped&&(t.element.classList.add("b-grouped"),i.groupchange="onStoreRefresh"),e.ion(i)}return e}updateStore(e){const{initialSelection:t}=this;t!=null&&t.length&&(e.count?this.select(t):e.ion({refresh:()=>this.select(t),once:!0})),this.refresh()}changeNavigator(e,t){const i=this,{element:r}=i;if(r){var n;e=xr.reconfigure(t,e?xr.mergeConfigs({ownerCmp:i,disabled:i.disabled,target:r,keyEventTarget:r},e):null,i),((n=e)===null||n===void 0?void 0:n.keyEventTarget)===r&&!i.itemsTabbable&&(r.tabIndex=0)}return e}get minAlignHeight(){const e=this.element.lastElementChild,t=this.minHeight;if(t!=null)return e?Math.min(e.offsetTop+e.offsetHeight,t):0}alignTo(...e){super.minHeight=this.minAlignHeight,super.alignTo(...e)}hide(...e){return this.navigator&&(this.navigator.activeItem=null),super.hide(...e)}show(){const{refreshCount:e}=this,{previousActiveItem:t}=this.navigator;super.minHeight=this._minHeight;const i=super.show(...arguments);return this.refreshCount===e&&this.restoreActiveItem(t,!0),i}restoreActiveItem(e=this.navigator.previousActiveItem,t="nearest"){const i=this,{navigator:r,lastAlignSpec:n}=i;if(e!=null){if(typeof t!="string"){const s=n?n.zone:1;t=s&1?"nearest":s?"start":"end"}e=i.getItem(e),e&&!i.disabled&&(i.scrollable.scrollIntoView(e,{block:t}),r.activeItem=e)}}onMouseOver(e){const t=this,i=e.currentTarget;!S.isTouchEvent&&i&&t.navigator&&t.activateOnMouseover&&t.setTimeout({fn:"handleMouseOver",delay:30,args:[i],cancelOutstanding:!0})}handleMouseOver(e){this.navigator.activeItem=e}onClick(e){const t=e.target.closest(this.itemSelector);t&&this.onItemClick(t,e)}onInternalKeyDown(e){const t=this,i=t.navigator.activeItem;if(!t.disabled)switch(e.key){case" ":if(e.target.nodeName.toUpperCase()==="INPUT"&&!e.target.readOnly)break;case"Enter":i&&(this.onItemClick(i,e),e.stopImmediatePropagation(),e.preventDefault())}}onItemClick(e,t){const i=this,r=parseInt(e.dataset.index);let n=i.store.getAt(r);if(!(i.disabled||i.trigger("beforeItem",{item:e,record:n,index:r,event:t,userAction:!0})===!1)){if(i._isUserAction=!0,i.allowGroupSelect||n&&!n.isSpecialRow)if(e.contains(t.target.closest("[data-noselect]")))e.contains(t.target.closest("[data-select-all]"))&&i.onSelectAllClick(e,t);else{const s=i.selected;let a=s.includes(n);i.multiSelect?(i.toggleAllIfCtrlPressed&&t.ctrlKey?n=i.store.records:i.allowGroupSelect&&n.isSpecialRow&&(a=!n.groupChildren.some(o=>!s.includes(o)),n=n.groupChildren),s[a?"remove":"add"](n)):s.splice(0,s.count,n)}i.lastClicked=n,i.trigger("item",{item:e,record:n,index:r,event:t,userAction:!0}),i._isUserAction=!1}}onSelectionChange({action:e,removed:t,added:i,replaced:r}){const n=this,{selectedCls:s,unselectedCls:a}=n;let o,l;if(e==="clear")for(l of n.element.querySelectorAll(`.${s}`))l.classList.remove(s),l.setAttribute("aria-selected",!1),a&&l.classList.remove(a);else if(e!=="replaceValues"){for(o of t)l=n.getItem(o),l&&(l.classList.remove(s),l.setAttribute("aria-selected",!1));for(o of i)l=n.getItem(o),l&&(l.classList.add(s),l.setAttribute("aria-selected",!0))}n.selectAllItem&&n.updateSelectAllState()}onSelectAllClick(e){e.classList.contains(this.selectedCls)?this.deselectAll():this.selectAll()}updateSelectAllState(){var e;(e=this.element.querySelector(".b-select-all-item"))===null||e===void 0||e.classList.toggle(this.selectedCls,this.allSelected)}get allSelected(){const{selected:e,store:t}=this;return e.count&&(t.isFiltered?t.records.every(i=>e.includes(i)):t.count===e.count)}selectAll(e){const t=this;(t.multiSelect||!e)&&(t.selected.add(t.store.records),e&&!t.navigator.activeItem&&(t.navigator.activeItem=t.getItem(-1)))}deselectAll(){this.selected.clear()}select(e){const{store:t}=this,{modelClass:i}=t;e=W.asArray(e).reduce((r,n)=>(n=t.getById(i.asId(n)),n&&r.push(n),r),[]),this.selected.add(e)}deselect(e){const{modelClass:t}=this.store;e=W.asArray(e).reduce((i,r)=>(r=this.selected.get(t.asId(r)),r&&i.push(r),i),[]),this.selected.remove(e)}}ji.initClass();ji.prototype.navigatorClass=xr;ji._$name="List";class sd extends ji{static get $name(){return"ChipView"}static get type(){return"chipview"}static get configurable(){return{itemCls:"b-chip",multiSelect:!1,closable:!0,iconTpl:null,closeHandler:null}}itemContentTpl(e,t){const i=this;return bt.tpl`${i.iconTpl?this.iconTpl(e):""}
            ${i.itemTpl(e,t)}
            ${i.closable?'<div class="b-icon b-close-icon b-icon-clear" data-noselect></div>':""}`}onInternalKeyDown(e){const t=this;t.closable&&t.selected.count&&(e.key==="Delete"||e.key==="Backspace")?t.callback(t.closeHandler,t.owner,[t.selected.values,{isKeyEvent:!0}]):super.onInternalKeyDown(e)}updateClosable(e){this.element.classList[e?"add":"remove"]("b-chips-closable"),this.navigator&&(this.navigator.disabled=!e),this.isConfiguring||this.refresh()}onClick(e){const t=this,i=e.target.closest(`.${t.itemCls}`);if(t.closable&&e.target.classList.contains("b-close-icon")){const r=t.store.getAt(parseInt(i.dataset.index));t.callback(t.closeHandler,t.owner,[[r]])}else super.onClick(e)}}sd.initClass();sd._$name="ChipView";const hl="L{Field.fieldRequired}",fr="L{Field.validateFilter}",c0="L{Combo.recordNotCommitted}";class Ze extends Gn{static get $name(){return"Combo"}static get type(){return"combo"}static get alias(){return"combobox,dropdown"}static get configurable(){return{primaryFilter:{},picker:{type:"list",floating:!0,scrollAction:"realign",itemsFocusable:!1,activateOnMouseover:!0,align:{align:"t0-b0",axisLock:!0},maxHeight:324,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1},multiSelect:null,items:null,store:null,valueField:void 0,displayField:"text",pickerWidth:null,minChars:null,selected:null,listItemTpl:null,displayValueRenderer:null,listCls:null,triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},filterParamName:null,encodeFilterParams:e=>e.map(t=>t.value),filterOnEnter:!1,hideTrigger:null,overlayAnchor:null,keyStrokeFilterDelay:null,defaultAction:"select",triggerAction:"all",filterOperator:"startsWith",caseSensitive:!1,hidePickerOnSelect:null,chipView:{$config:["lazy","nullify"],value:{type:"combochipview"}},chipStore:{$config:["lazy","nullify"],value:{}},filterSelected:null,emptyText:null,value:null,valueCollection:{$config:["nullify","lazy"],value:{}},validateFilter:!0,clearTextOnPickerHide:!0,destroyStore:!1,multiValueSeparator:",",createOnUnmatched:null,role:"combobox",inlinePicker:null,testConfig:{keyStrokeFilterDelay:0},localizeDisplayFields:!1,buildItems:null}}static get queryLast(){return"last"}construct(e){super.construct(...arguments),this.store||(this.items=[]),this.filterOnEnter&&(this.hideTrigger=!0)}startConfigure(e){this.usingRecordAsValue=e.valueField===null,super.startConfigure(...arguments)}afterConfigure(){super.afterConfigure();const e=this;T.hasOwn(e,"_value")||(e._value=e.valueField===e.displayField?"":null,e._lastValue=e._lastValue||e._value)}get childItems(){const{_chipView:e,_picker:t}=this,i=super.childItems;return e&&i.push(e),t&&i.push(t),i}get innerElements(){var e;const t=(e=this._chipView)===null||e===void 0?void 0:e.element,{input:i,inputElement:r}=this;return t&&Z.sync({targetElement:i,domConfig:r}),[t||r]}updateInlinePicker(e){e&&(this.element.classList.add("b-inline-picker"),this.getConfig("picker"),this.triggers.expand=null,this.pickerVisible=!0)}hidePicker(){if(!this.inlinePicker)return super.hidePicker(...arguments)}changeChipStore(e){return e&&!(e instanceof se)&&(e=new se(se.mergeConfigs({storage:this.valueCollection},e))),e}updateChipStore(e,t){t?.destroy()}changeChipView(e,t){const i=this;if(i.element.classList[e?"add":"remove"]("b-uses-chipview"),e){const{input:r}=i;return i.chipStore||(i.chipStore={}),qg.reconfigure(t,e,{defaults:{parent:i,insertBefore:r,store:i.chipStore,closable:!i.readOnly,navigator:{type:"combochipnavigator",keyEventTarget:r}}})}t?.destroy()}updateChipView(e){var t;const i=this;i._chipViewEventDetacher=(t=i._chipViewEventDetacher)===null||t===void 0?void 0:t.call(i),i.chipStore=e?.store,e&&(e.element.appendChild(i.input),i._chipViewEventDetacher=B.on({element:e.element,mousedown:"onChipViewMousedown",thisObj:i}))}updateMultiSelect(e,t){const i=this,{input:r,element:n}=i,s=!i.isConfiguring;let{value:a}=i;if(n.classList[e?"add":"remove"]("b-multiselect"),e){const{chipView:l}=i,{parentNode:d}=r,u=l?.element;u&&u!==d&&(d.insertBefore(u,r),u.appendChild(r),i.chipView.refresh()),r.value="",s&&(a=W.asArray(a))}else{const l=i._chipView,{parentNode:d}=r,u=l?.element;if(u===d&&(u.parentNode.insertBefore(r,u),u.remove(),n.classList.remove("b-uses-chipview")),s&&typeof a!="string"){var o;a=(o=a)!==null&&o!==void 0&&o.length?a[0]:null}}s&&(i.value=a)}onChipViewMousedown(e){e.preventDefault(),this.containsFocus||this.focus()}onChipClose(e,t={}){(t.isKeyEvent&&this.input.value===""||!t.isKeyEvent)&&(this._isUserAction=!0,this.valueCollection.remove(e),this._isUserAction=!1)}updateFilterParamName(e){this.hideTrigger!==!1&&(this.hideTrigger=Boolean(e))}updateHideTrigger(e){this.element.classList[e?"add":"remove"]("b-hide-trigger")}updateKeyStrokeFilterDelay(e){this.filterOnInput.delay=e}updateReadOnly(e){super.updateReadOnly(...arguments),this._chipView&&(this._chipView.closable=!e)}updateDisabled(e){super.updateDisabled(...arguments),this._chipView&&(this._chipView.closable=!e)}updateFilterOperator(e){this.primaryFilter&&(this.primaryFilter.operator=e)}get minChars(){const e=this._minChars;return e??(this.remoteFilter?4:1)}get validateFilter(){return this._validateFilter&&!this.createOnUnmatched}get items(){return this.store.allRecords}updateBuildItems(e){e&&(this.items=e.call(this))}changeItems(e){var t;const i=this;if(e==null){if(i.store&&!i.store.isItemStore)return;e=[]}if(i.buildItems&&!((t=e)!==null&&t!==void 0&&t.length)&&(e=i.buildItems()),e instanceof se){i.store=e;return}const r=i.displayField;let n,s=i.valueField,a;if(Array.isArray(e)?a=e.map(o=>{let l=o;return o instanceof de?(n=o.constructor,s||(i.valueField=s=n.idField)):typeof o=="string"||typeof o=="number"?(s||(i.valueField=s=i.displayField),l={[s]:o,[r]:o}):(s||(i.valueField=s="value"),Array.isArray(o)&&(l={[s]:o[0],[r]:o[1]})),o.selected&&(i.value=l),l}):(s||(i.valueField=s="value"),a=[],Object.entries(e).forEach(([o,l])=>{a.push({[s]:o,[r]:l})})),i.store)i.store.data=a;else{const o=s===r?{name:"value",dataSource:r}:s;i.store=new se({isItemStore:!0,data:a,idField:s,verifyNoGeneratedIds:!1,modelClass:n||class extends de{static get idField(){return i.valueField}static set idField(l){super.idField=l}static get fields(){return[o,r]}}})}}get value(){const e=this,{valueCollection:t,valueField:i}=e;if(i==null)return e.multiSelect?t.values.slice():t.first;let r;return e.multiSelect?r=t.count?t.map(n=>n[i]):e._lastValue||[]:r=t.count?t.first[i]:e._lastValue,r}set value(e){super.value=e}get needsInputSync(){return this.usesChipView?!1:!this.editable}changeValue(e,t){var i;const r=this;if(e===t){r.syncInputFieldValue(!0);return}if(!r.multiSelect&&Array.isArray(e)&&e.length>1)throw new Error("Multiple values cannot be set to a non-multiSelect Combo");if(r.triggerConfig("items"),!r.inputting){var n;(n=r._chipView)===null||n===void 0||n.selected.clear()}r.store||(r.items=[]);const{valueField:s,displayField:a,store:o,valueCollection:l,_picker:d}=r,{storage:u}=o,h=(i=r.hidePickerOnSelect)!==null&&i!==void 0?i:!r.multiSelect,f=r._isUserAction||d?._isUserAction||h&&r.pickerVisible||!1;if(!r.remoteFilter&&o.isAjaxStore&&!o.count){o.ion({load:()=>r.value=e,once:!0,thisObj:r}),r._lastValue=e;return}if(r.remoteFilter){if(e!=null){if(T.isObject(e)||e.isModel)r.store.data=[e],r.valueCollection.splice(0,r.valueCollection.count,r.store.first);else{const m=r.isConfiguring;r.primaryFilter.setConfig({value:e,disabled:!1}),o.performFilter(!0).then(()=>{if(r.isDestroyed)return;const{isConfiguring:p}=r;r.isConfiguring=m,l.splice(0,l.count,o.allRecords),r.isConfiguring=p})}return}}else o.filtered&&(r.primaryFilter.disabled=!0,o.filter());let g;if(e!=null){const m=Array.isArray(e),p=m?e.slice():[e];for(let C=0,D=p.length;C<D;C++){let w=p[C];if(w instanceof de)u.includes(w,!0)||o.add(w);else{const E=T.isObject(w);E&&(w=w[o.modelClass.fieldMap[s].dataSource]),g=u.getBy(a,w)||u.getBy(s,w)||l.getBy(a,w)||l.getBy(s,w),g instanceof Set&&(g=[...g][0]),g?(E&&g.set(p[C]),p[C]=g):(p.splice(C,1),D--,C--)}}const v=!p.length,y=l.generation;l.splice(0,l.count,p),v&&(r._value=m&&e.length===0?null:e,r._lastValue=r._value),(v||l.generation===y)&&r.syncInputFieldValue(),r.syncEmpty(),v&&!r.isConfiguring&&r.triggerFieldChange({value:e,oldValue:t,userAction:f,valid:r.isValid})}else if(l.count)l.clear();else{const m=r._value;r._value=null,r.syncInputFieldValue(),r.syncEmpty(),r.isConfiguring||r.triggerFieldChange({value:e,oldValue:m,userAction:f,valid:r.isValid})}r._lastValue=r._value}hasChanged(e,t){return this.multiSelect?!T.isEqual(e,t):super.hasChanged(...arguments)}onComboStoreChange({action:e}){e!=="filter"&&this.syncInputFieldValue(!0)}syncInputFieldValue(e){if(this.usesChipView){var t;(t=this.chipView)===null||t===void 0||t.refresh()}else super.syncInputFieldValue(e)}get usesChipView(){return Boolean(this.multiSelect&&this._chipView)}get isEmpty(){return this.valueCollection.count===0}get inputValue(){const e=this;let t=e.selected?e.selected[e.displayField]:e.value;return e.displayValueRenderer&&(t=e.callback(e.displayValueRenderer,e,[e.selected,e])),t??""}get nonEditableClickTarget(){var e;return this.multiSelect&&((e=this.chipView)===null||e===void 0?void 0:e.element)||super.nonEditableClickTarget}changeValueCollection(e,t){if(t?.destroy(),e)return e.isCollection||(e=new rt({internalListeners:{noChange:"onValueCollectionNoChange",change:"onValueCollectionChange",prio:-1e3,thisObj:this}})),e}changePrimaryFilter(e){return e.isCollectionFilter?e.setConfig({disabled:!0,property:this.displayField,operator:this.filterOperator,caseSensitive:this.caseSensitive}):(typeof e=="function"&&(e={filterBy:e}),e=new Le(F({id:"primary",disabled:!0,property:this.displayField,operator:this.filterOperator,caseSensitive:this.caseSensitive},e))),e}changeStore(e){const t=this,i=[],{valueCollection:r,keyStrokeFilterDelay:n,filterParamName:s}=t;if(Array.isArray(e)){t.items=e;return}let a;if(e){if(e.isStore){const o=e.filters.get("primary");t.remoteFilter&&(e.filterParamName=s),a=e.remoteFilter||e.restfulFilter,o?t.primaryFilter=o:i.push(t.primaryFilter)}else typeof e=="string"?e=se.getStore(e):(e=new(e.readUrl?$t:se)(e),t.destroyStore=!0),a=t.remoteFilter||e.restfulFilter,a&&s&&(e.filterParamName=s,t.encodeFilterParams&&(e.encodeFilterParams=t.encodeFilterParams)),i.push(t.primaryFilter);if(!t.valueField&&!t.usingRecordAsValue&&(t.valueField=e.modelClass.idField),t.filterSelected){const o=l=>!t.containsFocus||!r.includes(l);a?(e.storage.autoFilter=!0,e.storage.addFilter({id:`${t.id}-selected-filter`,filterBy:o})):(i.push(o),e.reapplyFilterOnAdd=!0)}r.addIndex({property:t.displayField,unique:!1}),r.addIndex({property:t.valueField,unique:!0}),i.forEach(o=>e.addFilter(o,!0)),a?t.keyStrokeFilterDelay=Math.max(300,n||0):t.keyStrokeFilterDelay=n??10}return e}updateStore(e,t){const i=this,{_picker:r}=i;let n;i.destroyStore&&t&&t.destroy(),r&&(r.store=e),e.storage.addIndex({property:i.displayField,unique:!1}),e.storage.addIndex({property:i.valueField,unique:!0}),n={filter:"onStoreFilter"},i.displayValueRenderer&&((n||(n={})).change="onComboStoreChange"),i.detachListeners("store"),e?.storage&&i.valueCollection.match(e.storage),i.syncInputFieldValue(),n&&(n.name="store",n.thisObj=i,e.ion(n))}get remoteFilter(){var e;return Boolean(this.filterParamName||((e=this._store)===null||e===void 0?void 0:e.restfulFilter))}get record(){return this.selected}get records(){return this.valueCollection.values.slice()}get selected(){const{store:e}=this;return this.multiSelect?this.valueCollection.values.slice().sort((t,i)=>e.indexOf(t)-e.indexOf(i))[0]:this.valueCollection.first}onEditComplete(){const e=this,t=e.valueCollection.count;super.onEditComplete(),t&&(e.clearError(fr),e.syncInputFieldValue()),e.required&&!t&&e.setError(hl)}onTriggerClick(e){const t=this,i="key"in e;if(!(t.ignoreTriggerClick||t.remoteFilter&&t.filterOnEnter)){if(t.pickerVisible)t.hidePicker();else if(!t.readOnly&&!t.disabled){var r;switch((r=t.triggerAction)===null||r===void 0?void 0:r.toLowerCase()){case"all":t.doFilter(null,i);break;case"last":t.doFilter(t.lastQuery,i);break;default:t.doFilter(t.input.value,i)}}}}internalOnInput(e){const t=this;t.syncEmpty(),t.syncInputWidth(),t.filterOnInput(e),t.trigger("input",{value:t.input.value,event:e})}filterOnInput(e){const t=this,i=e.target.value,r=i.length;t.inputting=!0,t.inlinePicker||r>=t.minChars&&(!t.filterOnEnter||e.key==="Enter")?t.doFilter(i):(t.validateFilter&&!t.remoteFilter&&t[r?"setError":"clearError"](fr),t.hidePicker()),t.inputting=!1}syncInputWidth(){const e=this;if(e.usesChipView){const t=e.input,i=e._inputPadding||(e._inputPadding=S.getEdgeSize(t,"padding","lr")),r=t.value||"",n=S.measureText(r+"W",t,!1,e.element)+i.width;t.style.flex=`1 1 ${Math.ceil(n)}px`}}doFilter(e,t){var i;const r=this,{store:n,picker:s}=r,a=e==null||e==="";r.lastQuery=e,r.primaryFilter.setConfig({value:e,disabled:a}),r.remoteFilter&&n.clear(!0);const o=()=>{const{navigator:l,isVisible:d}=s;n.count?!a&&l&&(l.activeItem=0):!r.remoteFilter&&!a&&(l&&(l.activeItem=null),r.validateFilter&&r.setError(fr)),d&&s.realign()};(i=r.filterPromise=n.filter())===null||i===void 0||i.then(()=>{r.filterPromise=null,o()}),r.inlinePicker||(s!=null&&s.isVisible?s.lastAlignSpec.zone===0&&s.realign():r.showPicker(t)),r.filterPromise||o()}onStoreFilter({source:e}){const t=this,i=t._picker,r=i?.element.dataset,{count:n}=e;t.remoteFilter&&(n?i&&(i.navigator.activeItem=0):t.validateFilter&&t.setError(fr),t.filterSelected&&t.valueCollection.count&&(e.storage.onFiltersChanged({action:"splice",oldCount:1}),i&&i.refresh())),r&&(t.createOnUnmatched&&!n?r.addNewValue=t.L("L{addNewValue}")(t.primaryFilter.value):r==null||delete r.addNewValue)}onValueCollectionChange({source:e}){var t;const i=this,{multiSelect:r,_picker:n}=i,s=(t=i.hidePickerOnSelect)!==null&&t!==void 0?t:!r,a=r?e.values.slice():e.first,o=e.values.slice(),l=i._isUserAction||n?._isUserAction||s&&i.pickerVisible||!1,d=i._value;s&&i.hidePicker(),!e.count&&i.required?i.setError(hl):(i.clearError(hl),i.clearError(fr)),i.validateFilter&&a&&i.clearError(fr),i.filterSelected&&(i.remoteFilter?(i.store.storage.onFiltersChanged({action:"splice",oldCount:1}),i._picker&&i._picker.refresh()):i.store.filter()),i._value=null,i._lastValue=null;const u=i.cacheCurrentValue(i.value);i.syncInputFieldValue(),i.syncEmpty(),i.isConfiguring||(i.triggerFieldChange({value:u,oldValue:d,userAction:l,valid:i.isValid}),i.trigger("select",{record:a,records:o,userAction:l}),i.defaultAction==="select"&&i.trigger("action",{value:u,record:a,records:o,userAction:l}))}cacheCurrentValue(e){return this._value=e}onValueCollectionNoChange({toAdd:e}){!this.inlinePicker&&!this.multiSelect&&e.length&&this.pickerVisible&&this.picker.hide()}showPicker(){const e=this,{picker:t}=e;if(!(e.readOnly||e.inlinePicker)){if(t.multiSelect=e.multiSelect,super.showPicker(...arguments),e.overlayAnchor&&!t.align.offset&&(t.align.offset=-t.anchorSize[1],t.realign()),t.restoreActiveItem)if(e.multiSelect){var i;t.restoreActiveItem(((i=t.navigator)===null||i===void 0?void 0:i.previousActiveItem)||e.selected||0,!0)}else t.restoreActiveItem(e.selected||0,!0);e.input.focus()}}changePicker(e,t){var i;const r=this,n=r.pickerWidth||((i=e)===null||i===void 0?void 0:i.width),s=ji.mergeConfigs({owner:r,store:r.store,selected:r.valueCollection,multiSelect:r.multiSelect,cls:r.listCls,displayField:r.displayField,forElement:r[r.pickerAlignElement],align:{matchSize:n==null,anchor:r.overlayAnchor,target:r[r.pickerAlignElement],minHeight:r.inlinePicker?null:Math.min(3,r.store.count)*40},[r.listItemTpl?"itemTpl":void 0]:r.listItemTpl,width:n,navigator:{keyEventTarget:r.input}},e);return r.inlinePicker&&Object.assign(s,{floating:!1,align:null,activateOnMouseover:!1,maxHeight:null,appendTo:r.element}),e=ji.reconfigure(t,e?s:null,r),e&&(e.element.classList.add("b-combo-picker"),e.element.dataset.emptyText=r.emptyText?r.L(r.emptyText):r.L("L{noResults}"),e.ion({navigate:"onPickerNavigate",thisObj:r})),e}onPickerNavigate({event:e}){e.target.matches("[data-add-new-value]")&&this.addNewRecord(this.primaryFilter.value)}onPickerHide(){const e=this;super.onPickerHide(),e.multiSelect&&e.clearTextOnPickerHide&&(e.input.value="")}async internalOnKeyEvent(e){const t=this,i=t.input[t.inputValueAttr],r=i.length,{key:n}=e,{store:s,_picker:a,multiSelect:o}=t;if(e.type==="keydown"&&a!==null&&a!==void 0&&a.isVisible&&a.navigator){const{activeItem:l}=a.navigator;if(l&&o&&n===t.multiValueSeparator){t.input.value="",t.primaryFilter.setConfig({value:"",disabled:!0}),s.filter(),a.onItemClick(l,e),a.hide(),e.preventDefault();return}if(!l&&t.createOnUnmatched&&(o&&n===t.multiValueSeparator||n==="Enter")){e.preventDefault(),await t.addNewRecord(i);return}}super.internalOnKeyEvent(...arguments),e.type==="keydown"&&n==="Enter"&&t.filterOnEnter&&r>=t.minChars&&(e.stopPropagation(),t.filterOnInput.now(e))}async addNewRecord(e){const t=this,{store:i,_picker:r,valueCollection:n,multiSelect:s,primaryFilter:a}=t,o=i.remoteFilter&&i.autoCommit;t.filterPromise&&await t.filterPromise,o||(a.setConfig({value:"",disabled:!0}),i.filter());const[l]=i.add(t.callback(t.createOnUnmatched,t,[e,t]));if(i.isCommitting){let h;try{await i.commitPromise}catch(f){var d,u;h=(d=f.response)===null||d===void 0||(u=d.parsedJson)===null||u===void 0?void 0:u.error}l.isPhantom&&(t.clearError(),t.setError(h||c0,!1,!0),i.remove(l),i.removed.remove(l))}o&&(a.setConfig({value:"",disabled:!0}),i.filter()),t.input.value="",i.includes(l)&&n.splice(s?n.count:0,s?0:n.count,l),r?.hide()}changeCreateOnUnmatched(e){return e===!0&&(e=this.defaultRecordCreater),e}defaultRecordCreater(e){return this.store.createRecord({[this.displayField]:e})}updateLocalization(){super.updateLocalization();const e=this,{displayField:t}=e;let{localizedDisplayFieldsMap:i}=e;if(e.localizeDisplayFields===!0){i||(e.localizedDisplayFieldsMap=i=new Map),!e.store&&e.buildItems&&(e.items=e.buildItems());for(const n of e.items)if(n.id){var r;let s=i.get(n.id);!s&&(r=n[t])!==null&&r!==void 0&&r.startsWith("L{")&&(s=n[t],i.set(n.id,s)),s&&(n[t]=e.L(s))}e.syncInputFieldValue()}}}M(Ze,"delayable",{filterOnInput:0});class qg extends sd{static get $name(){return"ComboChipView"}static get type(){return"combochipview"}static get defaultConfig(){return{closeHandler:"up.onChipClose",itemsFocusable:!1,multiSelect:!0,itemTpl(e){return z.encodeHtml(e[this.owner.displayField])},scrollable:{overflowY:"auto"}}}}class u0 extends xr{static get $name(){return"ComboChipNavigator"}static get type(){return"combochipnavigator"}static get configurable(){return{allowShiftKey:!0}}onTargetClick(e){const t=this,i=e.target.closest(t.itemSelector);i&&!e.target.classList.contains("b-close-icon")&&(!e.shiftKey&&!i.contains(e.target.closest("[data-noselect]"))&&t.ownerCmp.selected.clear(),t.inClickHandler=!0,t.activeItem=i,t.inClickHandler=!1)}onKeyDown(e){e.key!=="Enter"&&super.onKeyDown(e)}updateActiveItem(e,t){const i=this.ownerCmp;super.updateActiveItem(e,t),e&&!this.inClickHandler&&i.selected.add(i.getRecordFromElement(e))}navigatePrevious(e){const t=this.ownerCmp;t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),this.previous?super.navigatePrevious(e):this.activeItem=null}navigateNext(e){const t=this.ownerCmp;t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),this.next?super.navigateNext(e):this.activeItem=null}}Ze.initClass();qg.initClass();u0.initClass();Ze._$name="Combo";class Kg extends wt{static get $name(){return"UndoRedoBase"}static get type(){return"undoredobase"}static get configurable(){return{project:null,stm:null,text:null,color:null,showZeroActionBadge:null,cls:"b-undo-controls b-toolbar",layoutStyle:{alignItems:"stretch",flexFlow:"row nowrap",overflow:"visible"},items:{undoBtn:{type:"button",icon:"b-icon-undo",tooltip:"L{UndoRedo.UndoLastAction}",onAction:"up.onUndo"},transactionsCombo:{type:"combo",valueField:"idx",editable:!1,store:{},emptyText:"L{UndoRedo.NoActions}",onAction:"up.onTransactionSelected",displayValueRenderer:"up.transactionsDisplayValueRenderer"},redoBtn:{type:"button",icon:"b-icon-redo",tooltip:"L{UndoRedo.RedoLastAction}",onAction:"up.onRedo"}}}}afterConstruct(){this.updateUndoRedoControls()}updateStm(e){this.detachListeners("undoredo"),e?.ion({name:"undoredo",recordingstop:"updateUndoRedoControls",restoringstop:"updateUndoRedoControls",queueReset:"updateUndoRedoControls",disabled:"updateUndoRedoControls",thisObj:this})}changeItems(e){const{undoBtn:t,redoBtn:i}=e;return this.color&&(t&&(t.color=this.color),i&&(i.color=this.color)),this.text&&(t&&(t.text="L{UndoRedo.Undo}"),i&&(i.text="L{UndoRedo.Redo}")),super.changeItems(e)}updateProject(e){this.stm=e.stm}fillUndoRedoCombo(){const{transactionsCombo:e}=this.widgetMap;e&&(e.items=this.stm.queue.map((t,i)=>[i,t||`Transaction ${i}`]))}updateUndoRedoControls(){const{stm:e,showZeroActionBadge:t}=this,{undoBtn:i,redoBtn:r}=this.widgetMap;i.badge=e.position||(t?"0":""),r.badge=e.length-e.position||(t?"0":""),i.disabled=!e.canUndo,r.disabled=!e.canRedo,this.fillUndoRedoCombo()}transactionsDisplayValueRenderer(e,t){var i;const r=((i=this.stm)===null||i===void 0?void 0:i.position)||0;return`${r} undo actions / ${t.store.count-r} redo actions`}onUndo(){this.stm.canUndo&&this.stm.undo()}onRedo(){this.stm.canRedo&&this.stm.redo()}onTransactionSelected(e){const t=this.stm,i=e.value;i>=0&&(t.canUndo&&i<t.position?t.undo(t.position-i):t.canRedo&&i>=t.position&&t.redo(i-t.position+1))}}Kg._$name="UndoRedoBase";class Xg extends Ze{static get $name(){return"BooleanCombo"}static get type(){return"booleancombo"}static get configurable(){return{positiveValue:!0,positiveText:null,negativeValue:!1,negativeText:null,store:{value:[],$config:"lazy"},value:!1}}changeStore(e,t){const i=this;return super.changeStore(new se({data:[{id:i.positiveValue,text:i.positiveText||i.L("L{Object.Yes}")},{id:i.negativeValue,text:i.negativeText||i.L("L{Object.No}")}]}),t)}}Xg.initClass();Xg._$name="BooleanCombo";class _t extends wt.mixin(id){onChildAdd(e){super.onChildAdd(e),e.ion({click:"resetValueCache",toggle:"onItemToggle",thisObj:this,prio:1e4})}onChildRemove(e){e.un({toggle:"resetValueCache",click:"resetValueCache",thisObj:this}),super.onChildRemove(e)}onItemToggle(e){const t=this;t.resetValueCache(),!t.isSettingValue&&(!t.toggleGroup||e.pressed)&&t.triggerFieldChange({value:t.value,userAction:!0,event:e})}resetValueCache(){this._value=null}createWidget(e){const t=this;return t.constructor.resolveType(e.type||"button").isButton&&(t.color&&!e.color&&(e.color=t.color),t.toggleGroup&&!e.toggleGroup&&(typeof t.toggleGroup=="boolean"&&(t.toggleGroup=_t.generateId("toggleGroup")),e.toggleGroup=t.toggleGroup)),t.columns&&(e.width=`${100/t.columns}%`),e=super.createWidget(e),t.relayEvents(e,["click","action","toggle"]),e}updateRotate(e){this.eachWidget(t=>{t.rotate!==!1&&(t.rotate=e)})}get value(){if(!this._value){const e=[];this.items.forEach(t=>{t.pressed&&t.value!==void 0&&e.push(t.value)}),this._value=e.join(this.valueSeparator)}return this._value}set value(e){const t=this,i=t.value;Array.isArray(e)||(e==null?e=[]:typeof e=="string"?e=e.split(t.valueSeparator):e=[e]),t._value=e.join(t.valueSeparator),t.isSettingValue=!0,t.items.forEach(r=>{r.value!==void 0&&(r.pressed=e.includes(r.value))}),t.isSettingValue=!1,!t.isConfiguring&&i!==t.value&&t.triggerFieldChange({value:t.value,userAction:!1})}updateDisabled(e){this.items.forEach(t=>t.disabled=e||!t.ignoreParentReadOnly&&this.readOnly)}updateReadOnly(e){super.updateReadOnly(e),this.updateDisabled(this.disabled)}get widgetClassList(){const e=super.widgetClassList;return this.columns&&e.push("b-columned"),e}}M(_t,"$name","ButtonGroup");M(_t,"type","buttongroup");M(_t,"configurable",{defaultType:"button",cls:null,items:null,color:null,toggleGroup:null,valueSeparator:",",columns:null,hideWhenEmpty:!0,defaultBindProperty:"value"});_t.initClass();_t._$name="ButtonGroup";class _i extends Ye{static get $name(){return"CalendarPanel"}static get type(){return"calendarpanel"}static get configurable(){return{textContent:!1,date:{$config:{equal:"date"},value:null},month:{},year:null,weekStartDay:null,sixWeeks:!0,showWeekNumber:null,showWeekColumn:null,disabledDates:null,headerRenderer:null,weekRenderer:null,cellRenderer:null,disableWeekends:null,hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",nonWorkingDays:null,tip:null,dayCellCls:"b-calendar-cell",dayHeaderCls:"b-calendar-day-header",disabledCls:"b-disabled-date",otherMonthCls:"b-other-month",weekendCls:"b-weekend",todayCls:"b-today",nonWorkingDayCls:"b-nonworking-day",dayNameFormat:"ddd",minRowHeight:{$config:["lazy"],value:null},minColumnWidth:{$config:["lazy"],value:null},disableOtherMonthCells:null,disableOtherMonthCellsCls:"b-disable-othermonth-cells",hideOtherMonthCells:null,hideOtherMonthCellsCls:"b-hide-othermonth-cells",animateTimeShift:!0}}construct(e){super.construct(e),this.refreshCount||this.refresh()}onPaint({firstPaint:e}){var t;(t=super.onPaint)===null||t===void 0||t.call(this,...arguments),e&&(this.refreshCount||this.refresh(),this.getConfig("minColumnWidth"),this.getConfig("minRowHeight"))}get overflowElement(){return this.weeksElement}doDestroy(){var e;(e=this.tip)===null||e===void 0||e.destroy(),super.doDestroy()}changeMinRowHeight(e){const t=parseInt(S.getStyleValue(this.element,"--min-row-height"),10)||75;return isNaN(e)?e:Math.max(parseInt(e)||0,t)}updateMinRowHeight(e){this.weekElements.forEach(t=>S.setLength(t,"minHeight",e)),this.scrollable={overflowY:e?"auto":!1}}changeMinColumnWidth(e){const t=parseInt(S.getStyleValue(this.element,"--min-column-width"),10)||75;return e==null?e:Math.max(parseInt(e)||0,t)}updateMinColumnWidth(e){const t=this;t.weekdayCells.forEach(i=>S.setLength(i,"minWidth",e)),t.cellElements.forEach(i=>i.matches(`.${t.dayCellCls}`)&&S.setLength(i,"minWidth",e)),t.scrollable={overflowX:e?"auto":!1},t.overflowElement.classList[e?"add":"remove"]("b-min-columnwidth")}getDateFromDomEvent(e){const t=(e.nodeType===Element.ELEMENT_NODE?e:e.target).closest(`#${this.id} [data-date]`);if(t)return b.parseKey(t.dataset.date)}changeTip(e,t){const i=this;return ce.reconfigure(t,e,{owner:i,defaults:{type:"tooltip",owner:i,id:`${i.id}-cell-tip`,forElement:i.bodyElement,forSelector:`.${i.dayCellCls}`}})}updateTip(e){this.detachListeners("tip"),e?.ion({pointerOver:"onTipOverCell",name:"tip",thisObj:this})}updateElement(e,t){const i=this;super.updateElement(e,t),i.updateHideNonWorkingDays(i.hideNonWorkingDays),i.weekdayCells=Array.from(e.querySelectorAll(".b-calendar-day-header")),i.weekElements=Array.from(e.querySelectorAll(".b-calendar-week")),i.weekDayElements=Array.from(e.querySelectorAll(".b-calendar-days")),i.cellElements=[];for(let r=0,{length:n}=i.weekDayElements;r<n;r++)i.cellElements.push(i.weekDayElements[r].previousSibling,...i.weekDayElements[r].children)}changeDate(e){if(e=typeof e=="string"?b.parse(e):new Date(e),isNaN(e))throw new Error("CalendarPanel date ingestion must be passed a Date, or a YYYY-MM-DD date string");return b.clearTime(e)}updateDate(e){this.month.date=e}updateDayNameFormat(){const e=new Date("2000-06-04T12:00:00");this.shortDayNames=[];for(let t=4;t<11;t++)e.setDate(t),this.shortDayNames.push(b.format(e,this.dayNameFormat))}get weekStartDay(){return typeof this._weekStartDay=="number"?this._weekStartDay:b.weekStartDay}updateWeekStartDay(e){const t=this;if(t._month){t.month.weekStartDay=e,t.dayNames=[];for(let i=0;i<7;i++)t.dayNames[i]=t.shortDayNames[t.canonicalDayNumbers[i]];t.refreshCount&&t.refresh()}}updateHideNonWorkingDays(e){var t;this.contentElement.classList.toggle(this.hideNonWorkingDaysCls,Boolean(e)),(t=this.scrollable)===null||t===void 0||t.syncOverflowState(),this._month&&(this.month.hideNonWorkingDays=e),this.isConfiguring||this.refresh()}updateHideOtherMonthCells(e){var t;this.element.classList.toggle(this.hideOtherMonthCellsCls,Boolean(e)),(t=this.scrollable)===null||t===void 0||t.syncOverflowState()}updateDisableOtherMonthCells(e){var t;this.element.classList.toggle(this.disableOtherMonthCellsCls,Boolean(e)),(t=this.scrollable)===null||t===void 0||t.syncOverflowState()}get nonWorkingDays(){return this._nonWorkingDays||this._localeNonWorkingDays||(this._localeNonWorkingDays=b.nonWorkingDays)}get weekends(){return this._localeWeekends||(this._localeWeekends=b.weekends)}changeNonWorkingDays(e){return T.assign({},e)}updateNonWorkingDays(e){if(this._month){var t;this.month.nonWorkingDays=e,this.refresh(),(t=this.scrollable)===null||t===void 0||t.syncOverflowState()}}get visibleDayColumnIndex(){return this.month.visibleDayColumnIndex}get dayColumnIndex(){return this.month.dayColumnIndex}get canonicalDayNumbers(){return this.month.canonicalDayNumbers}get visibleColumnCount(){return this.month.visibleColumnCount}get weekLength(){return this.month.weekLength}get startDate(){return this.month.startDate}get duration(){return b.diff(this.month.startDate,this.month.endDate,"day")+1}get endDate(){const{endDate:e}=this.month;if(e)return b.add(e,1,"day")}changeMonth(e,t){const i=this;if(!(e instanceof Ot)){if(typeof e=="number"){if(t){t.month=e;return}const r=i.date||b.clearTime(new Date);r.setMonth(e),e={date:r}}e=Ot.new({weekStartDay:i.weekStartDay,nonWorkingDays:i.nonWorkingDays,hideNonWorkingDays:i.hideNonWorkingDays,sixWeeks:i.sixWeeks},e)}return e.ion({dateChange:"onMonthDateChange",thisObj:i}),e}onMonthDateChange({source:e,newDate:t,oldDate:i,changes:r}){const n=this;n.year=e.year,n.isConfiguring||((!n.getCell(t)||r.m||r.y)&&(n.refresh(),n.animateTimeShift&&n.isVisible&&S.slideIn(n.contentElement,t>i?1:-1)),n.trigger("dateChange",{changes:r,value:t,oldValue:i}))}updateYear(e){this.month.year=e}updateShowWeekNumber(e){this.updateShowWeekColumn(e)}updateShowWeekColumn(e){const t=this;t.element.classList[e?"add":"remove"]("b-show-week-column"),t.floating&&(t.isAligning||t.realign())}updateSixWeeks(e){this.month&&(this.month.sixWeeks=e,this.refresh())}refresh(){this.doRefresh()}doRefresh(){var e;this.getConfig("element");const t=this,i=t.timeZone!=null?t.timeZone:(e=t.project)===null||e===void 0?void 0:e.timeZone,r=i!=null?Xe.toTimeZone(new Date,i):new Date,{weekElements:n,weekDayElements:s,date:a,month:o,dayCellCls:l,dayHeaderCls:d,disabledCls:u,otherMonthCls:h,weekendCls:f,todayCls:g,nonWorkingDayCls:m,nonWorkingDays:p,canonicalDayNumbers:v,sixWeeks:y}=t;if(r.setHours(0,0,0,0),!a){t.date=r;return}t.trigger("beforeRefresh"),t.getConfig("dayNameFormat");for(let E=0;E<7;E++){const R=t.weekdayCells[E],x=t.canonicalDayNumbers[E],k={[d]:1,[f]:b.weekends[x],[m]:p[x]};t.headerRenderer?(R.innerHTML="",t.callback(t.headerRenderer,t,[R,E,x])):S.setInnerText(R,t.shortDayNames[x]),S.syncClassList(R,k),R.dataset.columnIndex=E,R.dataset.cellDay=x}let C=0,D=0,w=6;for(let E=6;E>=0;E--)if(!p[v[E]]){w=E;break}n[4].classList.toggle("b-hide-display",o.weekCount<5&&!y),n[5].classList.toggle("b-hide-display",o.weekCount<6&&!y),o.eachWeek((E,R)=>{const x=s[C],k=[x.previousSibling,...x.children];n[C].dataset.week=`${E[0]},${E[1]}`,t.weekRenderer?t.callback(t.weekRenderer,t,[k[0],E]):k[0].innerText=E[1];for(let I=0;I<7;I++){const A=R[I],L=A.getDay(),O=p[L],_=k[I+1],V={[l]:1,[u]:t.isDisabledDate(A),[h]:A.getMonth()!==o.month,[f]:b.weekends[L],[g]:A.getTime()===r.getTime(),[m]:O,"b-last-working-day":I===w,"b-first-visible-cell":!(A-(t.firstVisibleDate||-1)),"b-last-visible-cell":!(A-(t.lastVisibleDate||-1)),[`b-day-of-week-${L}`]:1};S.syncClassList(_,V),_.dataset.date=b.makeKey(A),_.dataset.cellIndex=D,_.dataset.columnIndex=I,_.lastDomConfig&&(delete _.lastDomConfig.class,delete _.lastDomConfig.className),t.cellRenderer?t.callback(t.cellRenderer,t,[{cell:_,date:A,day:L,row:n[C],rowIndex:C,cellIndex:D,columnIndex:I,visibleColumnIndex:t.visibleDayColumnIndex[L],week:E}]):_.innerHTML=A.getDate(),D++}C++}),t.visibleWeekCount=C,t.floating&&(t.isAligning||t.realign()),t.refreshCount=(t.refreshCount||0)+1,t.trigger("refresh")}isDisabledDate(e){const t=e.getDay(),{disabledDates:i,nonWorkingDays:r}=this;if(this.disableWeekends&&r[t])return!0;if(i)return Array.isArray(i)?(e=b.clearTime(e,!0),i.some(n=>!(b.clearTime(n,!0)-e))):this.callback(this.disabledDates,this,[e])}get bodyConfig(){const e=super.bodyConfig,t=[];e.children=[{tag:"div",className:"b-calendar-row b-calendar-weekdays",reference:"weekdaysHeader",children:[{class:"b-week-number-cell"},...W.fill(7,{class:this.dayHeaderCls}),S.scrollBarPadElement]},{className:"b-weeks-container notranslate",reference:"weeksElement",children:t}];for(let i=0;i<6;i++){const r={className:"b-calendar-row b-calendar-week",dataset:{rowIndex:i},children:[{className:"b-week-number-cell"},{className:"b-calendar-days",children:[{},{},{},{},{},{},{}],syncOptions:{ignoreRefs:!0,strict:!1}}]};t.push(r)}return e}get firstVisibleDate(){if(this.hideOtherMonthCells){const{year:e,month:t}=this.month;return new Date(e,t,1)}for(const e=this,t=e.month.startDate;;t.setDate(t.getDate()+1))if(!e.hideNonWorkingDays||!e.nonWorkingDays[t.getDay()])return t}get lastVisibleDate(){const e=b.add(this.endDate,-1,"d");if(this.hideOtherMonthCells)return e;for(const t=this,i=e;;i.setDate(i.getDate()-1))if(!t.hideNonWorkingDays||!t.nonWorkingDays[i.getDay()])return i}getCell(e,t){typeof e!="string"&&(e=b.makeKey(e));const i=this.weeksElement.querySelector(`[data-date="${e}"]`);if(i&&(!t||!i.classList.contains(this.otherMonthCls)))return i}onTipOverCell({source:e,target:t}){e.date=b.parseKey(t.dataset.date)}updateLocalization(){this._localeNonWorkingDays=this._localeWeekends=null,this.updateDayNameFormat(),this.updateWeekStartDay(this.weekStartDay),super.updateLocalization()}}_i.initClass();_i._$name="CalendarPanel";const h0=c=>!c.value;class Nr extends Oe{static get $name(){return"Checkbox"}static get type(){return"checkbox"}static get alias(){return"check"}static get configurable(){return{inputType:"checkbox",autoCollapse:null,containerDefaults:{syncableConfigs:{disabled:e=>e.disabled||!e.value},syncConfigTriggers:{autoCollapse:1,value:1}},text:"",checkedValue:!0,uncheckedValue:!1,color:null,value:"",toggleGroup:null,localizableProperties:["label","text"]}}construct(e){"checked"in e&&(e=T.assign({},e),e.value=e.checked,delete e.checked),super.construct(e),this.syncHasText()}get textLabelCls(){return"b-checkbox-label"}get innerElements(){return[this.inputElement,{tag:"label",class:this.textLabelCls,for:`${this.id}-input`,reference:"textLabel",html:this.text||""}]}get inputElement(){const e=super.inputElement;return this.toggleGroup&&(e.dataset={group:this.toggleGroup}),e.listeners={click:"internalOnClick",change:"internalOnChange",input:"internalOnInput"},e}get checked(){return this.value}set checked(e){this.value=e}syncHasText(){this.element.classList[this.text?"add":"remove"]("b-text")}updateText(e){this.textLabel&&(this.syncHasText(),this.textLabel.innerHTML=e)}afterSyncChildConfigs(e){super.afterSyncChildConfigs(e);let{autoCollapse:t}=this;t&&(t=t===!0?h0:t,e.collapsed=t(this))}assignFieldValue(e,t,i){this.value=i===this.checkedValue||(i===this.uncheckedValue?!1:null)}fetchInputValue(){this.readOnly||(this.value=this.input.checked)}gatherValue(e){var t;const i=this,r=i.value?i.checkedValue:i.uncheckedValue,n=r!==void 0,{valueName:s}=i;n&&(e[s]=r),i.gatherValues(e,n),r===!0&&((t=e[s])===null||t===void 0?void 0:t.value)===r&&delete e[s].value}changeValue(e){return e==="false"?!1:Boolean(e)}updateValue(e){var t;const i=this,r=i.input.checked!==e;i.input.checked=e,(t=i.container)===null||t===void 0||t.syncChildConfigs(),r&&!i.inputting&&!i.isConfiguring&&(i.uncheckToggleGroupMembers(),i.triggerChange(!1))}get inputValueAttr(){return"checked"}updateColor(e,t){const i=this.element.classList;t&&i.remove(t),e&&i.add(e)}getToggleGroupMembers(){const e=this,{checked:t,toggleGroup:i,input:r,type:n}=e,s=[];return t&&i&&S.forEachSelector(e.rootElement,`input[type=${n}][data-group=${i}]`,a=>{if(a!==r){const o=N.fromElement(a);o&&s.push(o)}}),s}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach(e=>e.checked=!1)}check(){this.checked=!0}uncheck(){this.checked=!1}toggle(){this.checked=!this.checked}internalOnClick(e){return this.readOnly?(e.preventDefault(),!1):this.trigger("click",{event:e})}internalOnChange(e){const t=this;if(t.readOnly&&t.value!==t.input.checked){t.input.checked=t.value;return}t.value=t.input.checked,t.inputting||(t.inputting=!0,t.triggerChange(!0),t.inputting=!1)}updateInputReadOnly(e){}triggerChange(e){const t=this,{checked:i}=t.input,r={checked:i,value:i,userAction:e,valid:!0};if(!i&&e&&t.toggleGroup&&t.getToggleGroupMembers().filter(s=>s.isVisible&&!s.disabled).length||t.trigger("beforeChange",r)===!1)t.input.checked=t._value=!i;else return t.triggerFieldChange(r,!1),e&&t.uncheckToggleGroupMembers(),t.trigger("action",r),t.trigger("change",r),!0}}Nr.initClass();Nr._$name="Checkbox";class Wi extends Ye{construct(e){super.construct(F({year:new Date().getFullYear()},e)),B.on({element:this.contentElement,click:"onYearClick",delegate:".b-yearpicker-year",thisObj:this})}get focusElement(){return this.getYearButton(this.year)||this.getYearButton(this.startYear)}getYearButton(e){return this.contentElement.querySelector(`.b-yearpicker-year[data-year="${e}"]`)}get value(){return this.year}set value(e){this.year=e}onYearClick({target:e}){const t=Math.min(Math.max(parseInt(e.innerText),this.minYear||1),this.maxYear||9999);this.year===t?this.trigger("select",{oldValue:t,value:t}):this.year=t}handleTitleClick(e){this.trigger("titleClick",e)}previous(){this.startYear=this.startYear-this.yearButtonCount}next(){this.startYear=this.endYear+1}ingestYear(e){if(!isNaN(e))return T.isDate(e)?e.getFullYear():e}changeYear(e){if(e=this.ingestYear(e))return Math.min(Math.max(e,this.minYear||1),this.maxYear||9999)}updateYear(e,t){const i=this;!i.startYear||e>i.endYear?i.startYear=e:e<i.startYear&&(i.startYear=e-(i.yearButtonCount-1)),i.isConfiguring||i.trigger("select",{oldValue:t,value:e})}get endYear(){return this.startYear+this.yearButtonCount-1}changeStartYear(e){if(e=this.ingestYear(e))return e=this.minYear?Math.max(e,this.minYear):e,this.maxYear?Math.min(e,this.maxYear-(this.yearButtonCount-1)):e}async updateStartYear(e,t){this.isVisible&&S.slideIn(this.contentElement,Math.sign(e-t))}composeBody(){this.getConfig("year");const{startYear:e}=this,t=super.composeBody(),i=t.children[this.tbar?1:0].children=[];this.widgetMap.title.text=`${`000${e}`.slice(-4)} - ${`000${this.endYear}`.slice(-4)}`;for(let r=0,n=e;r<this.yearButtonCount;r++,n++)i.push({tag:"button",dataset:{year:n},class:{"b-yearpicker-year":1,"b-selected":n===this.year},text:`000${n}`.slice(-4)});return t}}M(Wi,"$name","YearPicker");M(Wi,"type","yearpicker");M(Wi,"configurable",{textContent:!1,tbar:{overflow:null,items:{previous:{type:"tool",cls:"b-icon b-icon-previous",onAction:"up.previous",weight:100},title:{type:"button",cls:"b-yearpicker-title",weight:200,onAction:"up.handleTitleClick"},next:{type:"tool",cls:"b-icon b-icon-next",onAction:"up.next",weight:300}}},itemCls:"b-year-container",yearButtonCount:12,year:null,minYear:null,maxYear:null,startYear:null});Wi.initClass();Wi._$name="YearPicker";class Zg extends Hr{static get $name(){return"DisplayField"}static get type(){return"displayfield"}static get alias(){return"display"}static get configurable(){return{readOnly:!0,editable:!1,cls:"b-display-field",template:null,ariaElement:"displayElement"}}get focusElement(){}changeReadOnly(){return!0}changeEditable(){return!1}get inputElement(){return{tag:"span",id:`${this.id}-input`,reference:"displayElement",html:this.template?this.template(this.value):z.encodeHtml(this.value)}}}Zg.initClass();Zg._$name="DisplayField";const kh=()=>b.getMonthNames().map((c,e)=>[e,c]),Ih=(c,e)=>c.valueOf()-e.valueOf(),f0=Object.freeze([]);class g0 extends Ze{static get $name(){return"ReadOnlyCombo"}static get type(){return"readonlycombo"}static get configurable(){return{editable:!1,inputAttributes:{tag:"div",tabIndex:-1},inputValueAttr:"innerHTML",highlightExternalChange:!1,monitorResize:!1,triggers:{expand:!1},picker:{align:{align:"t-b",axisLock:!0,matchSize:!1},cls:"b-readonly-combo-list",scrollable:{overflowX:!1}}}}}g0.initClass();class $a extends _i{static get $name(){return"DatePicker"}static get type(){return"datepicker"}static get delayable(){return{refresh:"raf"}}static get configurable(){return{activeDate:{value:new Date,$config:{equal:"date"}},focusable:!0,textContent:!1,tbar:{overflow:null,items:{prevYear:{cls:"b-icon b-icon-first",onAction:"up.gotoPrevYear",tooltip:"L{DatePicker.gotoPrevYear}"},prevMonth:{cls:"b-icon b-icon-previous",onAction:"up.gotoPrevMonth",tooltip:"L{DatePicker.gotoPrevMonth}"},fields:{type:"container",cls:"b-datepicker-title",items:{monthField:{type:"readonlycombo",cls:"b-datepicker-monthfield",items:kh(),internalListeners:{select:"up.onMonthPicked"}},yearButton:{type:"button",cls:"b-datepicker-yearbutton",internalListeners:{click:"up.onYearPickerRequested"}}}},nextMonth:{cls:"b-icon b-icon-next",onAction:"up.gotoNextMonth",tooltip:"L{DatePicker.gotoNextMonth}"},nextYear:{cls:"b-icon b-icon-last",onAction:"up.gotoNextYear",tooltip:"L{DatePicker.gotoNextYear}"}}},yearPicker:{value:{type:"YearPicker",yearButtonCount:16,trapFocus:!0,positioned:!0,hidden:!0,internalListeners:{titleClick:"up.onYearPickerTitleClick",select:"up.onYearPicked"}},$config:"lazy"},date:null,minDate:{value:null,$config:{equal:"date"}},maxDate:{value:null,$config:{equal:"date"}},focusDisabledDates:null,multiSelect:!1,selection:{$config:{equal:(e,t)=>e&&e.equals(t)},value:null},editMonth:!0,dayNameFormat:"dd",trapFocus:!0,role:"grid",focusDescendant:!0,alwaysRefreshOnMonthChange:null}}static get prototypeProperties(){return{outOfRangeCls:"b-out-of-range",activeCls:"b-active-date",selectedCls:"b-selected-date"}}construct(e){const t=this;super.construct(e),t.externalCellRenderer=t.cellRenderer,t.cellRenderer=t.internalCellRenderer,t.element.setAttribute("aria-activedescendant",`${t.id}-active-day`),t.weeksElement.setAttribute("role","grid"),t.weekElements.forEach(i=>i.setAttribute("role","row")),t.element.setAttribute("ariaLabelledBy",t.widgetMap.fields.id),B.on({element:t.weeksElement,click:{handler:"onCellClick",delegate:`.${t.dayCellCls}:not(.${t.disabledCls}):not(.${t.outOfRangeCls})`},mousedown:{handler:"onCellMousedown",delegate:`.${t.dayCellCls}`},thisObj:t}),t.widgetMap.monthField.readOnly=t.widgetMap.yearButton.disabled=!t.editMonth,t.refresh.flush()}afterHide(){var e;(e=this._yearPicker)===null||e===void 0||e.hide(),super.afterHide(...arguments)}doDestroy(){var e,t;(e=this.yearButton)===null||e===void 0||e.destroy(),(t=this.monthField)===null||t===void 0||t.destroy(),super.doDestroy()}get focusElement(){return this.weeksElement.querySelector(`.${this.dayCellCls}[tabIndex="0"]`)}doRefresh(){const e=this,t=e.focusElement,i=b.betweenLesser(e.activeDate,e.month.startDate,e.month.endDate)?e.activeDate:e._activeDate=e.date;super.doRefresh(...arguments);const r=b.parseKey(t?.dataset.date);i-r&&e.syncActiveDate(i,r)}internalCellRenderer({cell:e,date:t}){const i=this,{activeCls:r,selectedCls:n,externalCellRenderer:s}=i,a=i.isSelectedDate(t),o={[r]:r&&i.isActiveDate(t),[n]:a,[i.outOfRangeCls]:i.minDate&&t<i.minDate||i.maxDate&&t>i.maxDate};if(a&&i.multiSelect){const l=!i.isSelectedDate(b.add(t,-1,"d")),d=!i.isSelectedDate(b.add(t,1,"d"));o["b-range-start"]=l,o["b-range-end"]=d,o["b-in-range"]=!l&&!d}S.updateClassList(e,o),e.innerHTML=`<div class="b-datepicker-cell-inner">${t.getDate()}</div>`,e.setAttribute("role","gridcell"),e.setAttribute("aria-label",b.format(t,"MMMM D, YYYY")),i.isActiveDate(t)?e.id=`${i.id}-active-day`:e.removeAttribute("id"),s&&(arguments[0].cell=e.firstChild,i.callback(s,this,arguments))}onCellMousedown(e){const t=e.target.closest("[data-date]");e.preventDefault(),t.focus(),this.activeDate=b.parseKey(t.dataset.date)}onCellClick(e){const t=e.target.closest("[data-date]");this.onUIDateSelect(b.parseKey(t.dataset.date),e)}onMonthDateChange({newDate:e,changes:t}){this.getConfig("tbar"),super.onMonthDateChange(...arguments),(t.m||t.y)&&(this.widgetMap.monthField.value=e.getMonth(),this.widgetMap.yearButton.text=e.getFullYear())}onUIDateSelect(e,t){const i=this,{lastClickedDate:r,multiSelect:n}=i;i.lastClickedDate=e,i.isDisabledDate(e)||(i.activatingEvent=t,n?i.handleMultiSelect(r,e,t):(i.selection=e,i.floating&&i.hide()),i.activatingEvent=null)}handleMultiSelect(e,t,i){const r=this,{multiSelect:n,_selection:s}=r,a=s.dates,o=n==="range",{size:l,generation:d}=s,u=l&&{[b.makeKey(b.add(a[0],-1,"d"))]:1,[b.makeKey(a[0])]:1,[b.makeKey(a[a.length-1])]:1,[b.makeKey(b.add(a[a.length-1],1,"d"))]:1},h=s.has(t),f=h?"delete":"add",g=o&&u?.[b.makeKey(t)];if(i.ctrlKey)(n===!0||!l||g)&&(s[f](t),o&&!s.has(r.rangeStartDate)&&r.rangeStartDate.setDate(r.rangeStartDate.getDate()+(t<a[1]?1:-1)));else if(i.shiftKey&&l){const[p,v]=[new Date(o?r.rangeStartDate||(r.rangeStartDate=a[0]):e),t].sort(Ih);o&&s.clear();for(const y=p;y<=v;y.setDate(y.getDate()+1))s.add(y)}else s.has(t)&&s.size===1||(s.clear(),s.add(t));const m=s.size;m===1?r.rangeStartDate=t:m||(r.rangeStartDate=null),s.generation!==d&&r.updateSelection(s)}changeSelection(e){const t=this;let i,r;if(e)if(e.forEach||(e=[e]),e.forEach((n,s)=>e[s]=t.changeDate(n)),r=e[0],e.sort(Ih),t.multiSelect==="range"&&e.length===2){i=new In;for(const n=new Date(e[0]);n<=e[1];n.setDate(n.getDate()+1))i.add(n)}else r=e[0],i=new In(e);else i=new In;return r&&(t.activeDate=t.rangeStartDate=b.clearTime(r)),i}updateSelection(e){const t=this,{dates:i}=e,r=t.multiSelect==="range"?[i[0],i[i.length-1]]:i;i.length&&(t.date=i[0]),t.isConfiguring||(t.refresh.now(),t.trigger("selectionChange",{selection:r,userAction:Boolean(t.activatingEvent)}))}get selection(){const{_selection:e}=this,t=e?e.dates:f0;return this.multiSelect==="range"&&t.length?[t[0],t[t.length-1]]:t}onInternalKeyDown(e){const t=this,i=e.key.trim()||e.code,r=t.activeDate;let n=new Date(r);if(i==="Escape"&&t.floating)return t.hide();if(r&&t.weeksElement.contains(e.target)){do switch(i){case"ArrowLeft":e.preventDefault(),e.ctrlKey?n=t.gotoPrevMonth():n.setDate(n.getDate()-1);break;case"ArrowUp":e.preventDefault(),n.setDate(n.getDate()-7);break;case"ArrowRight":e.preventDefault(),e.ctrlKey?n=t.gotoNextMonth():n.setDate(n.getDate()+1);break;case"ArrowDown":e.preventDefault(),n.setDate(n.getDate()+7);break;case"Enter":return t.onUIDateSelect(r,e)}while(t.isDisabledDate(n)&&!t.focusDisabledDates);if(t.minDate&&n<t.minDate||t.maxDate&&n>t.maxDate)return;t.activeDate=n}}changeMinDate(e){return e&&_i.prototype.changeDate.apply(this,arguments)}updateMinDate(e){this._yearpicker&&(this._yearpicker.minYear=e?.getFullYear()),this.refresh()}changeMaxDate(e){return e&&_i.prototype.changeDate.apply(this,arguments)}updateMaxDate(e){this._yearpicker&&(this._yearpicker.maxYear=e?.getFullYear()),this.refresh()}changeDate(e){return b.clamp(super.changeDate(e),this.minDate,this.maxDate)}updateDate(e){const t=this;t.isConfiguring&&!t.initializingActiveDate&&(t.selection=e),(!t.month.date||e.getMonth()===t.month.month||!t.getCell(e)||t.alwaysRefreshOnMonthChange||t.isNavigating)&&super.updateDate(e)}changeActiveDate(e,t){if(this.trigger("beforeActiveDateChange",{activeDate:e,oldActiveDate:t})!==!1){if(e=e?this.changeDate(e):this.date||(this.date=b.clearTime(new Date)),isNaN(e))throw new Error("DatePicker date ingestion must be passed a Date, or a YYYY-MM-DD date string");return b.clamp(e,this.minDate,this.maxDate)}}updateActiveDate(e,t){const i=this,{isConfiguring:r}=i;(r||!i.getCell(e))&&(i.initializingActiveDate=r,i.date=e,i.initializingActiveDate=!1),!r&&!i.refresh.isPending&&i.syncActiveDate(e,t)}syncActiveDate(e,t){const i=this,{activeCls:r}=i,n=i.getCell(e),s=t&&i.getCell(t),a=S.getActiveElement(i.element);n.setAttribute("tabIndex",0),r&&n.classList.add(r),n.id=`${i.id}-active-day`,i.weeksElement.contains(a)&&n.focus(),s&&s!==n&&(s.removeAttribute("tabIndex"),r&&s.classList.remove(r),s.removeAttribute("id"))}set value(e){const t=this;e?(e=t.changeDate(e,t.value),e!==void 0&&(t.selection=e)):(t.date=new Date,t.selection=null)}get value(){return this.selection[this.selection.length-1]}gotoPrevYear(){return this.goto(-1,"year")}gotoPrevMonth(){return this.goto(-1,"month")}gotoNextMonth(){return this.goto(1,"month")}gotoNextYear(){return this.goto(1,"year")}goto(e,t){const i=this,{activeDate:r}=i,n=r&&i.getCell(r);let s;t==="month"&&n&&r?.getMonth()===i.month.month+e?s=r:s=b.add(n?r:i.date,e,t);const a=new Date(s);a.setDate(1);const o=b.add(b.add(a,1,"month"),-1,"day");if(i.minDate&&e<0&&o<i.minDate||i.maxDate&&e>0&&a>i.maxDate)return;i.isNavigating=!0;const l=i.date=s;return n&&(i.activeDate=s),i.isNavigating=!1,l}isActiveDate(e){return!(e-this.activeDate)}isSelectedDate(e){var t;return(t=this._selection)===null||t===void 0?void 0:t.has(e)}onMonthPicked({record:e,userAction:t}){if(t){var i;this.activeDate=b.add(this.activeDate,e.value-this.activeDate.getMonth(),"month"),(i=this.focusElement)===null||i===void 0||i.focus()}}onYearPickerRequested(){const{yearPicker:e}=this;e.isVisible?e.hide():(e.year=e.startYear=this.activeDate.getFullYear(),e.show(),e.focus())}onYearPickerTitleClick(){this.yearPicker.hide()}onYearPicked({value:e,source:t}){const i=new Date(this.activeDate);i.setFullYear(e),this.activeDate=i,this.focusElement&&S.focusWithoutScrolling(this.focusElement),t.hide()}changeYearPicker(e,t){var i,r;return Wi.reconfigure(t,e?Wi.mergeConfigs({owner:this,appendTo:this.element,minYear:(i=this.minDate)===null||i===void 0?void 0:i.getFullYear(),maxYear:(r=this.maxDate)===null||r===void 0?void 0:r.getFullYear()},e):null,this)}get childItems(){const{_yearPicker:e}=this,t=super.childItems;return e&&t.push(e),t}updateLocalization(){const{monthField:e}=this.widgetMap,t=kh();!this.isConfiguring&&!t.every((i,r)=>i[1]===e.store.getAt(r).text)&&(t[e.value].selected=!0,e.items=t),super.updateLocalization()}}class In extends Set{add(e){return e=b.makeKey(e),this.has(e)||(this.generation=(this.generation||0)+1),super.add(e)}delete(e){return e=b.makeKey(e),this.has(e)&&this.generation++,super.delete(e)}has(e){return super.has(b.makeKey(e))}clear(){return this.size&&this.generation++,super.clear()}equals(e){return Array.isArray(e)&&(e=new In(e)),e.size===this.size&&[...this].every(t=>e.has(t))}get dates(){return[...this].sort().map(e=>b.parseKey(e))}}$a.initClass();$a._$name="DatePicker";class ad extends Gn{static get $name(){return"DateField"}static get type(){return"datefield"}static get alias(){return"date"}static get configurable(){return{format:"L",strictParsing:!1,fallbackFormat:"YYYY-MM-DD",timeFormat:"HH:mm:ss:SSS",keepTime:!1,pickerFormat:null,validateDateOnly:null,triggers:{expand:{cls:"b-icon-calendar",handler:"onTriggerClick",weight:200},back:{cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick",align:"start",weight:100},forward:{cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick",align:"end",weight:100}},calendarContainerCls:"",min:null,max:null,step:!1,stepTriggers:null,weekStartDay:null,picker:{type:"datepicker",role:"dialog",floating:!0,scrollAction:"realign",align:{align:"t0-b0",axisLock:!0}},value:null}}changePicker(e,t){const i=this,r={owner:i,forElement:i[i.pickerAlignElement],minDate:i.min,maxDate:i.max,weekStartDay:i._weekStartDay,align:{anchor:i.overlayAnchor,target:i[i.pickerAlignElement]},onSelectionChange:({selection:s,source:a})=>{a.isVisible&&(i._isUserAction=i._isPickerInput=!0,i.value=s[0],i._isPickerInput=i._isUserAction=!1,a.hide())}};i.calendarContainerCls&&(r.cls=i.calendarContainerCls),i.value?r.value=i.value:r.activeDate=new Date;const n=$a.reconfigure(t,e,{owner:i,defaults:r});return n?.refresh.flush(),n}get backShiftDate(){return b.add(this.value,-1*this._step.magnitude,this._step.unit)}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const i=e.backShiftDate;(!t||t.getTime()<=i)&&(e._isUserAction=!0,e.value=i,e._isUserAction=!1)}}get forwardShiftDate(){return b.add(this.value,this._step.magnitude,this._step.unit)}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const i=e.forwardShiftDate;(!t||t.getTime()>=i)&&(e._isUserAction=!0,e.value=i,e._isUserAction=!1)}}showPicker(e){if(this.readOnly)return;const t=this,{_picker:i}=t;if(i){const r={minDate:t.min,maxDate:t.max};t.value?r.value=t.value:r.activeDate=new Date,i.setConfig(r)}super.showPicker(e)}focusPicker(){this.picker.focus()}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let t=e.value;if(t){const{min:i,max:r,validateDateOnly:n}=e;if(n&&(t=b.clearTime(t,!1)),i&&t<i)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(r&&t>r)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}transformDateValue(e){const t=this;return e!=null&&(b.isDate(e)||(typeof e=="string"?e=b.parse(e,t.format,t.strictParsing)||b.parse(e,t.fallbackFormat,t.strictParsing):e=new Date(e)),b.isValidDate(e))?(!t.min||e-t.min>-b.MS_PER_DAY)&&(!t.max||e<=t.max)?t.transformTimeValue(e):e:null}transformTimeValue(e){const t=this,{keepTime:i}=t;if(e=b.clone(e),!i)b.clearTime(e,!1);else if(i!=="entered"){const r=b.parse(i,t.timeFormat);b.isValidDate(r)?b.copyTimeValues(e,r):b.isValidDate(t.value)&&b.copyTimeValues(e,t.value)}else t._isPickerInput&&b.isValidDate(t.value)&&b.copyTimeValues(e,t.value);return e}changeMin(e){return this.transformDateValue(e)}updateMin(e){const{input:t,_picker:i}=this;t&&(e==null?t.removeAttribute("min"):t.min=e),i&&(i.minDate=e),this.syncInvalid()}changeMax(e){return this.transformDateValue(e)}updateMax(e){const{input:t,_picker:i}=this;t&&(e==null?t.removeAttribute("max"):t.max=e),i&&(i.maxDate=e),this.syncInvalid()}get weekStartDay(){return typeof this._weekStartDay=="number"?this._weekStartDay:b.weekStartDay}updateWeekStartDay(e){this._picker&&(this._picker.weekStartDay=e)}changeValue(e,t){const i=this,r=i.transformDateValue(e);if(e&&!r){i.setError("L{invalidDate}");return}if(i.clearError("L{invalidDate}"),i.hasChanged(t,r))return super.changeValue(r,t);i.inputting||i.syncInputFieldValue()}updateValue(e,t){const i=this._picker;i&&!this.inputting&&(i.value=e),super.updateValue(e,t)}changeStep(e,t){const i=typeof e;if(!e)return null;if(i==="number"?e={magnitude:Math.abs(e),unit:t?t.unit:"day"}:i==="string"&&(e=b.parseDuration(e)),e&&e.unit&&e.magnitude)return e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}hasChanged(e,t){return e!=null&&e.getTime&&t!==null&&t!==void 0&&t.getTime&&this.keepTime!=="entered"?!b.isEqual(b.clearTime(e),b.clearTime(t)):super.hasChanged(e&&e.getTime(),t&&t.getTime())}get inputValue(){const e=this.value;return e?b.format(e,this.format):""}updateFormat(){this.isConfiguring||this.syncInputFieldValue(!0)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}internalOnKeyEvent(e){super.internalOnKeyEvent(e),e.key==="Enter"&&this.isValid&&this.picker.hide()}}ad.initClass();ad._$name="DateField";class Jg extends Oe{static get $name(){return"NumberField"}static get type(){return"numberfield"}static get alias(){return"number"}static get configurable(){return{min:null,max:null,step:1,largeStep:0,value:null,format:"",decimalPrecision:null,leadingZeroes:null,triggers:{spin:{type:"spintrigger"}},changeOnSpin:!0,inputType:null}}construct(e){super.construct(e);const t=this;t.input.addEventListener("dblclick",()=>{t.select()}),typeof t.changeOnSpin=="number"&&(t.bufferedSpinChange=t.buffer(t.triggerChange,t.changeOnSpin))}acceptValue(e,t){let i=!isNaN(e);if(i&&!this.hasTextSelection){i=!1;const r=this.input.value,n=parseFloat(r);r!==t&&(i=!this.acceptValue(n,r))}return i}okMax(e){return isNaN(this.max)||e<=this.max}okMin(e){return isNaN(this.min)||e>=this.min}internalOnKeyEvent(e){if(e.type==="keydown"){const t=this,i=e.key;let r;if(i==="ArrowUp")t.doSpinUp(e.shiftKey),r=!0;else if(i==="ArrowDown")t.doSpinDown(e.shiftKey),r=!0;else if(!e.altKey&&!e.ctrlKey&&i&&i.length===1){const n=t.getAfterValue(i),s=t.formatter.parseStrict(n);r=!(s===t.value||n==="-"&&(isNaN(t.min)||t.min<0))&&!t.acceptValue(s,n)}i==="Enter"&&t._changedBySilentSpin&&(t.triggerChange(e,!0),t._changedBySilentSpin=!1),r&&e.preventDefault()}super.internalOnKeyEvent(e)}doSpinUp(e=!1){const t=this;if(t.readOnly)return;let i=(t.value||0)+(e?t.largeStep:t.step);t.okMin(i)||(i=t.min),t.okMax(i)&&t.applySpinChange(i)}doSpinDown(e=!1){const t=this;if(t.readOnly)return;let i=(t.value||0)-(e?t.largeStep:t.step);t.okMax(i)||(i=t.max),t.okMin(i)&&t.applySpinChange(i)}applySpinChange(e){const t=this;t._isUserAction=!0,t.changeOnSpin!==!0&&(t._changedBySilentSpin=!0,t.silenceChange=!0,t.bufferedSpinChange&&t.bufferedSpinChange(null,!0)),t.value=e,t._isUserAction=!1,t.silenceChange=!1}triggerChange(){this.silenceChange||super.triggerChange(...arguments)}onFocusOut(e){var t,i,r;super.onFocusOut(...arguments);const n=this,{input:s}=n,a=s.value,o=n.formatter.truncate(a),l=isNaN(o)?a:n.formatValue(o);(t=n.triggers)===null||t===void 0||(i=t.spin)===null||i===void 0||(r=i.clickRepeater)===null||r===void 0||r.cancel(),a!==l&&(s.value=l),n._changedBySilentSpin&&(n.triggerChange(e,!0),n._changedBySilentSpin=!1)}internalOnInput(e){const t=this,{formatter:i,input:r}=t,{parser:n}=i,s=r.value,a=n.decimalPlaces(s);if(i.truncator&&a){let o=s;const l=i.truncate(s);if(!isNaN(l)&&(o=t.formatValue(l),n.decimalPlaces(o)<a)){const d=s.length-t.caretPos;r.value=o,t.caretPos=o.length-d}}super.internalOnInput(e)}formatValue(e){return this.formatter.format(e)}changeFormat(e){const t=this;if(e===""){const{leadingZeroes:i,decimalPrecision:r}=t;e=i?`${i}>9`:null,r!=null?e=`${e||""}9.${"#".repeat(r)}`:e&&(e+=".*")}return e}get formatter(){const e=this,t=e.format;let i=e._formatter;return(!i||e._lastFormat!==t)&&(i=Yt.get(e._lastFormat=t),e._formatter=i),i}updateStep(e){this.element.classList[e?"remove":"add"]("b-hide-spinner"),this._step=e}changeLargeStep(e){return e||this.step*10}get validity(){const e=this.value,t={};return e!=null&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}changeValue(e,t){const i=this;if(e||e===0){let r;typeof e!="number"&&(e=typeof e=="string"?i.formatter.parse(e):Number(e),r=isNaN(e),r&&(e="")),!r&&i.format&&(e=i.formatter.round(e))}else e=void 0;return super.changeValue(e,t)}get inputValue(){let e=this.value;return e!=null&&this.format&&(e=this.formatValue(e)),e}}Jg.initClass();Jg._$name="NumberField";class _a extends wt{static get $name(){return"TimePicker"}static get type(){return"timepicker"}construct(e){super.construct(e),this.refresh()}updateSeconds(e){this.widgetMap.second[e?"show":"hide"]()}onFieldChange(){!this.isConfiguring&&!this.isRefreshing&&(this.value=this.pickerToTime())}onAmPmButtonClick({source:e}){this._pm=e.ref==="pmButton",this._value&&(this.value=this.pickerToTime())}onInternalKeyDown(e){var t;const i=this;switch(e.key){case"Escape":i.triggerTimeChange(i._initialValue),i.hide(),e.preventDefault();return;case"Enter":i.value=i.pickerToTime(),i.hide(),e.preventDefault();return}(t=super.onInternalKeyDown)===null||t===void 0||t.call(this,e)}pickerToTime(){const e=this,t=e._pm,{hour:i,minute:r,second:n}=e.widgetMap;i.format=e._is24Hour?"2>9":null;let s=i.value,a=new Date(e.value);return e._is24Hour||(t&&s<12&&(s=s+12),!t&&s===12&&(s=0)),a.setHours(s),a.setMinutes(r.value),e.seconds&&a.setSeconds(n.value),e._min&&(a=b.max(e._min,a)),e._max&&(a=b.min(e._max,a)),a}triggerTimeChange(e){this.trigger("timeChange",{time:e})}updateInitialValue(e){this.value=e}changeValue(e){var t;return e&&(e=typeof e=="string"?b.parse(e,this.format):e),this.isVisible||(this._initialValue=e),(t=e)!==null&&t!==void 0?t:b.getTime(0)}updateValue(e){this.isVisible&&this.triggerTimeChange(e),this.refresh()}updateFormat(e){this._is24Hour=b.is24HourFormat(e),this.refresh()}changeMin(e){return typeof e=="string"?b.parse(e,this.format):e}changeMax(e){return typeof e=="string"?b.parse(e,this.format):e}refresh(){const e=this;if(!e.isConfiguring&&e.value){e.isRefreshing=!0;const{hour:t,minute:i,second:r,amButton:n,pmButton:s}=e.widgetMap,a=e.value,o=e._is24Hour,l=a.getHours(),d=e._pm=l>=12;e.element.classList[o?"add":"remove"]("b-24h"),t.min=o?0:1,t.max=o?23:12,t.value=o?l:l%12||12,i.value=a.getMinutes(),r.value=a.getSeconds(),n.pressed=!d,s.pressed=d,n.hidden=s.hidden=o,e.isRefreshing=!1}}}M(_a,"configurable",{floating:!0,items:{hour:{label:"L{TimePicker.hour}",type:"number",min:0,max:23,highlightExternalChange:!1,format:"2>9"},minute:{label:"L{TimePicker.minute}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9"},second:{hidden:!0,label:"L{TimePicker.second}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9"},amButton:{type:"button",text:"AM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"},pmButton:{type:"button",text:"PM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"}},autoShow:!1,trapFocus:!0,seconds:null,value:{$config:{equal:"date"},value:null},format:null,max:null,min:null,initialValue:null});_a.initClass();_a._$name="TimePicker";class Ca extends Gn{static get $name(){return"TimeField"}static get type(){return"timefield"}static get alias(){return"time"}static get configurable(){return{picker:{type:"timepicker",align:{align:"t0-b0",axisLock:!0}},format:"LT",triggers:{expand:{align:"end",handler:"onTriggerClick",compose:()=>({children:[{class:{"b-icon-clock-live":1}}]})},back:{align:"start",cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick"},forward:{align:"end",cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick"}},min:null,max:null,step:"5m",stepTriggers:null,value:null,keepDate:!1}}changePicker(e,t){const i=this;return _a.reconfigure(t,e,{owner:i,defaults:{value:i.value,forElement:i[i.pickerAlignElement],owner:i,align:{anchor:i.overlayAnchor,target:i[i.pickerAlignElement]},onTimeChange({time:r}){i._isUserAction=!0,i.value=r,i._isUserAction=!1}}})}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const i=b.add(e.value,-1*e.step.magnitude,e.step.unit);(!t||t.getTime()<=i)&&(e._isUserAction=!0,e.value=i,e._isUserAction=!1)}}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const i=b.add(e.value,e.step.magnitude,e.step.unit);(!t||t.getTime()>=i)&&(e._isUserAction=!0,e.value=i,e._isUserAction=!1)}}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let t=e.value;if(t){if(t=t.getTime(),e._min&&e._min.getTime()>t)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(e._max&&e._max.getTime()<t)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}hasChanged(e,t){return e!=null&&e.getTime&&t!==null&&t!==void 0&&t.getTime?e.getHours()!==t.getHours()||e.getMinutes()!==t.getMinutes()||e.getSeconds()!==t.getSeconds()||e.getMilliseconds()!==t.getMilliseconds():super.hasChanged(e,t)}showPicker(){const e=this,{picker:t,value:i}=e;e.readOnly||(t.value=i,t.format=e.format,t.maxTime=e.max,t.minTime=e.min,i||(e.value=t.value),super.showPicker(!0))}onPickerShow(){var e;super.onPickerShow(),this.pickerKeyDownRemover=(e=this.pickerKeyDownRemover)===null||e===void 0?void 0:e.call(this)}focusPicker(){this.picker.focus()}transformTimeValue(e){return e!=null&&(typeof e=="string"?(e=b.parse(e,this.format),this.keepDate&&(e=b.copyTimeValues(new Date(this.value),e))):e=new Date(e),b.isValidDate(e))?this.keepDate?e:b.getTime(e):null}changeMin(e){return this.transformTimeValue(e)}updateMin(e){const{input:t}=this;t&&(e==null?t.removeAttribute("min"):t.min=e),this.syncInvalid()}changeMax(e){return this.transformTimeValue(e)}updateMax(e){const{input:t}=this;t&&(e==null?t.removeAttribute("max"):t.max=e),this.syncInvalid()}changeValue(e,t){const i=this,r=i.transformTimeValue(e);if(e&&!r||i.isRequired&&e===""){i.setError("L{invalidTime}");return}if(i.clearError("L{invalidTime}"),i.hasChanged(t,r))return super.changeValue(r,t);i.inputting||i.syncInputFieldValue(!0)}updateValue(e,t){const{expand:i}=this.triggers;i&&e&&(i.element.firstElementChild.style.animationDelay=-((e.getHours()*60+e.getMinutes())/10)+"s"),super.updateValue(e,t)}changeStep(e,t){var i,r;const n=typeof e;if(!e)return null;if(n==="number"?e={magnitude:Math.abs(e),unit:t?t.unit:"hour"}:n==="string"&&(e=b.parseDuration(e)),(i=e)!==null&&i!==void 0&&i.unit&&(r=e)!==null&&r!==void 0&&r.magnitude)return e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}updateFormat(){this.syncInputFieldValue(!0)}get inputValue(){return b.format(this.value,this.format)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}}Ca.initClass();Ca._$name="TimeField";class Br extends Oe{doDestroy(){this.dateField.destroy(),this.timeField.destroy(),super.doDestroy()}get focusElement(){return this.dateField.input}get innerElements(){return[this.dateField.element,this.timeField.element]}internalOnKeyEvent(){}updateRevertOnEscape(e){this.timeField.revertOnEscape=e,this.dateField.revertOnEscape=e}changeTimeField(e){const t=this,i=Ca.new({revertOnEscape:t.revertOnEscape,syncInvalid(...r){const n=t.updatingInvalid;Ca.prototype.syncInvalid.apply(this,r),t.timeField&&!n&&t.syncInvalid()}},e);return B.on({element:i.element,keydown:"onTimeFieldKeyDown",thisObj:t}),t.readOnly&&(i.readOnly=!0),i}updateTimeField(e){const t=this;e.ion({change({userAction:i,value:r}){if(i&&!t.$settingValue){const n=t.dateField.value;t._isUserAction=!0,t.value=n?b.copyTimeValues(n,r):null,t._isUserAction=!1}},thisObj:t})}changeDateField(e){const t=this,i=e?.type||"datefield",r=N.resolveType(e.type||"datefield"),n=N.create(T.assign({type:i,revertOnEscape:t.revertOnEscape,syncInvalid(...s){const a=t.updatingInvalid;r.prototype.syncInvalid.apply(this,s),t.dateField&&!a&&t.syncInvalid()}},e));return B.on({element:n.element,keydown:"onDateFieldKeyDown",thisObj:t}),t.readOnly&&(n.readOnly=!0),n.ion({keydown:({event:s})=>{var a;s.key==="Tab"&&!s.shiftKey&&(a=this.timeField)!==null&&a!==void 0&&a.isVisible&&(s.stopPropagation(),s.cancelBubble=!0)}}),n}get childItems(){return[this.dateField,this.timeField]}updateDateField(e){const t=this;e.ion({change({userAction:i,value:r}){i&&!t.$isInternalChange&&(t._isUserAction=!0,t.timeField.value?r&&b.copyTimeValues(r,t.timeField.value):t.timeField.value=r,t.value=r,t._isUserAction=!1)},thisObj:t})}updateWeekStartDay(e){this.dateField&&(this.dateField.weekStartDay=e)}changeWeekStartDay(e){var t,i;return typeof e=="number"?e:(t=(i=this.dateField)===null||i===void 0?void 0:i.weekStartDay)!==null&&t!==void 0?t:b.weekStartDay}syncInputFieldValue(e=this.isConfiguring){super.syncInputFieldValue(!0);const t=this,{dateField:i,timeField:r}=t,n=i.highlightExternalChange,s=r.highlightExternalChange;!e&&!t.highlightExternalChange&&(e=!0),t.$isInternalChange=!0,i.highlightExternalChange=!1,i.value=null,i.highlightExternalChange=n,e&&(r.highlightExternalChange=i.highlightExternalChange=!1),r.value=i.value=t.inputValue,i.highlightExternalChange=n,r.highlightExternalChange=s,t.$isInternalChange=!1,t.syncInvalid()}onTimeFieldKeyDown(e){const t=this;if(e.key==="Enter"||e.key==="Tab"){const i=t.dateField.value;t._isUserAction=!0,t.value=i?b.copyTimeValues(i,t.timeField.value):null,t._isUserAction=!1}}onDateFieldKeyDown(e){const t=this;e.key==="Tab"&&!e.shiftKey?(e.stopPropagation(),e.preventDefault(),t.timeField.focus()):e.key==="Enter"&&(t.value=t.dateField.value)}updateRequired(e,t){this.timeField.required=this.dateField.required=e}updateReadOnly(e,t){super.updateReadOnly(e,t),this.isConfiguring||(this.timeField.readOnly=this.dateField.readOnly=e)}onDisabled(e){this.timeField.disabled=this.dateField.disabled=e}focus(){this.dateField.focus()}hasChanged(e,t){return!b.isEqual(e,t)}get isValid(){return this.timeField.isValid&&this.dateField.isValid}setError(e,t){[this.dateField,this.timeField].forEach(i=>i.setError(e,t))}getErrors(){const e=[...this.dateField.getErrors()||[],...this.timeField.getErrors()||[]];return e.length?e:null}clearError(e,t){[this.dateField,this.timeField].forEach(i=>i.clearError(e,t))}updateInvalid(){this.updatingInvalid=!0,[this.dateField,this.timeField].forEach(e=>e.updateInvalid()),this.updatingInvalid=!1}}M(Br,"configurable",{timeField:{},dateField:{keepTime:!0,step:"1 d"},weekStartDay:null,inputTemplate:()=>"",ariaElement:"element"});M(Br,"$name","DateTimeField");M(Br,"type","datetimefield");M(Br,"alias","datetime");Br.initClass();Br._$name="DateTimeField";class Ha extends Hr{static get $name(){return"DurationField"}static get type(){return"durationfield"}static get alias(){return"duration"}static get defaultConfig(){return{value:null,step:1,unit:null,defaultUnit:"day",magnitude:null,useAbbreviation:!1,allowNegative:!1,decimalPrecision:null,triggers:{spin:{type:"spintrigger"}},nullValue:null}}static get configurable(){return{min:null,max:null,allowedUnits:null}}changeMin(e){return typeof e=="string"?new Ue(e):e}changeMax(e){return typeof e=="string"?new Ue(e):e}changeAllowedUnits(e){return typeof e=="string"&&(e=e.split(",")),e}updateAllowedUnits(e){this.allowedUnitsRe=new RegExp(`(${e.join("|")})`,"i")}get inputValue(){return this.value==null?"":this.calcValue(!0).toString(this.useAbbreviation)}set unit(e){this._unit=e,this.value=this.calcValue()}get unit(){return this._unit}get unitWithDefault(){return this._unit||Ha.defaultConfig.defaultUnit}set magnitude(e){this.clearError("L{invalidUnit}"),this._magnitude=e,super.value=this.calcValue()}get magnitude(){return this._magnitude}roundMagnitude(e){return e&&this.decimalPrecision!=null?T.round(e,this.decimalPrecision):e}get allowDecimals(){return this.decimalPrecision!==0}get isValid(){const e=this,t=e.value==null||e.value&&e.value.magnitude==null;return super.isValid&&(t&&!e.required||!t&&(e.allowNegative||e.value.magnitude>=0))}internalOnChange(e){const t=this,i=t.value,r=t._lastValue;t.hasChanged(r,i)&&(t._lastValue=i,t.triggerFieldChange({value:i,event:e,userAction:!0,valid:t.isValid}))}onFocusOut(e){var t,i,r;return this.syncInputFieldValue(!0),(t=this.triggers)===null||t===void 0||(i=t.spin)===null||i===void 0||(r=i.clickRepeater)===null||r===void 0||r.cancel(),super.onFocusOut(e)}set value(e){const t=this;let i,r;if(this.clearError("L{invalidUnit}"),typeof e=="number")i=e,r=t._unit;else if(typeof e=="string")if(/^\s*$/.test(e))i=null;else{const n=b.parseDuration(e,t.allowDecimals,t.unitWithDefault);n&&(!t.allowedUnitsRe||t.allowedUnitsRe.test(n.unit)?(r=n.unit,i=n.magnitude):t.setError("L{invalidUnit}"))}else e&&"unit"in e&&"magnitude"in e?(r=e.unit,i=e.magnitude):(r=null,i=null);(t._magnitude!==i||t._unit!=r)&&(t._magnitude=i,r&&(t._unit=r),super.value=t.calcValue())}okMax(e){return typeof e=="number"&&(e=new Ue({unit:this.unitWithDefault,magnitude:e})),this.max==null||e<=this.max}okMin(e){return typeof e=="number"&&(e=new Ue({unit:this.unitWithDefault,magnitude:e})),this.min==null||e>=this.min}get validity(){const e=this.value,t={};return e!=null&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}get value(){return super.value}calcValue(e=!1){const t=this;return(!t._unit||t._magnitude==null)&&t.clearable?null:new Ue(e?this.roundMagnitude(t._magnitude):this._magnitude,t.unitWithDefault)}hasChanged(e,t){return t&&!e||!t&&e||t&&e&&!e.isEqual(t)}get milliseconds(){return this.value?this.value.milliseconds:0}onInternalKeyDown(e){e.key==="ArrowUp"?this.doSpinUp():e.key==="ArrowDown"&&this.doSpinDown()}doSpinUp(){const e=this;if(e.readOnly)return;let t=(e.magnitude||0)+e.step;e._isUserAction=!0,e.okMin(t)||(t=e.min),e.okMax(t)&&(e.value=t),e._isUserAction=!1}doSpinDown(){const e=this;if(e.readOnly)return;let t=(e.magnitude||0)-e.step;e.okMax(t)||(t=e.max),e.okMin(t)&&(e.allowNegative||(e.magnitude||0)>0)&&(e._isUserAction=!0,e.value=t,e._isUserAction=!1)}}Ha.initClass();Ha._$name="DurationField";class qn extends Xt{}M(qn,"$name","Fit");M(qn,"type","fit");M(qn,"configurable",{containerCls:"b-fit-container",itemCls:"b-fit-item"});qn.initClass();qn._$name="Fit";class Gt extends wt{afterConfigure(){const e=this;super.afterConfigure(),e.onTargetSizeChange=e.onTargetSizeChange.bind(e),B.on({element:e.element,keydown:"onKeyDown",contextmenu:"stopMouseEvents",mousedown:"stopMouseEvents",mouseover:"stopMouseEvents",mouseout:"stopMouseEvents",mouseup:"stopMouseEvents",click:"stopMouseEvents",dblclick:"stopMouseEvents",thisObj:e}),e.ion({beforeHide:"beforeEditorHide",hide:"afterEditorHide",thisObj:e}),He.ion({locale:"onLocaleChange",thisObj:e})}onLocaleChange(){const{inputField:e}=this;e&&!e.isDestroyed&&e.syncInputFieldValue&&e.syncInputFieldValue(!0)}render(e){const t=this.element.parentNode,[i]=this.getRenderContext(this,e);i.classList.add("b-editing"),super.render(...arguments),t!=null&&t.classList&&i!==t&&t.classList.remove("b-editing")}async startEdit(e){const t=this;if(e=T.assignIf(e,{align:t.align,hideTarget:t.hideTarget,matchSize:t.matchSize,matchFont:t.matchFont,fitTargetContent:t.fitTargetContent,focus:!0}),t.trigger("beforeStart",e)!==!1){var i,r,n;const{target:s,hideTarget:a,matchSize:o,matchFont:l,fitTargetContent:d,record:u,field:h=t.inputField.name,focus:f}=e,{inputField:g}=t,{input:m}=g,p=S.getStyleValue(s,"font-size"),v=S.getStyleValue(s,"font-family");let{value:y,align:C}=e;if(u&&h&&(t.record=u,t.dataField=h,y===void 0&&(y=u[h])),o&&(s instanceof HTMLElement&&t.updateSize(s,o),s instanceof HTMLElement&&Ne.addResizeListener(s,t.onTargetSizeChange)),m&&(l?(m.style.fontSize=p,m.style.fontFamily=v):m.style.fontSize=m.style.fontFamily=""),t.assigningValues=!0,(i=g.clearError)===null||i===void 0||i.call(g),g.value=y,t.assigningValues=!1,typeof C=="string"&&(C={align:C}),await t.showBy(F({target:s,allowTargetOut:!0},C)),d){const D=m.scrollWidth-m.clientWidth;D>0&&(t.width+=D+S.scrollBarWidth)}return f&&((r=g.focus)===null||r===void 0||r.call(g)),s.nodeType===Element.ELEMENT_NODE&&a&&s.classList.add("b-hide-visibility"),t.editing=!0,t.trigger("start",{value:g.value}),Array.isArray(g.value)&&g.editingRecords&&(n=g.value[0])!==null&&n!==void 0&&n.isModel?t.oldValue=g.value.map(D=>D.copy(D.id)):(t.oldValue=g.value,Array.isArray(t.oldValue)&&(t.oldValue=t.oldValue.slice())),g.initialValue=t.oldValue,!0}return!1}refreshEdit(){if(this.isVisible){const{record:e,dataField:t,inputField:i}=this;if(e&&t){const r=e[t];T.isEqual(i.value,r)||(i.value=r)}}}finishEdit(){const{target:e,aligningToElement:t}=this.lastAlignSpec;t&&(e.classList.remove("b-editing"),e.classList.remove("b-hide-visibility")),this.editing=!1,this.trigger("finishEdit")}onKeyDown(e){var t;const i=this;switch(e.key){case i.completeKey:i.completeEdit(null,e),e.stopImmediatePropagation();break;case i.cancelKey:i.cancelEdit(e),e.stopImmediatePropagation();break}(t=i.trigger)===null||t===void 0||t.call(i,"keydown",{event:e})}stopMouseEvents(e){this.allowMouseEvents||e.stopPropagation()}onFocusOut(e){super.onFocusOut(e);const t=this;if(!t.isFinishing&&t.editing)switch(t.blurAction){case"cancel":t.cancelEdit(e);break;case"complete":t.completeEdit(null,e)}}async completeEdit(e,t){const i=this,{inputField:r,oldValue:n,record:s}=i,a=r.invalidAction||(r.allowInvalid===!1?"block":i.invalidAction),{value:o}=r;if(!!i.isVisible){if(!r.isValid&&a!=="allow"){if(a==="block"){var l;return(l=r.focus)===null||l===void 0||l.call(r),!1}else if(a==="revert")return i.cancelEdit(t),!0}else{if(T.isEqual(o,n))return i.cancelEdit(t),!0;{const f={inputField:r,record:s,value:o,oldValue:n};if(i.trigger("beforeComplete",f)===!1){var d;(d=r.focus)===null||d===void 0||d.call(r)}else{if(!e){var u;e=f.finalize||((u=f.editorContext)===null||u===void 0?void 0:u.finalize)}if(e){let g=await e(f);if(g===!0)i.onEditComplete();else{if(r.setError){const m=g||r.invalidValueError,p=()=>{v(),r.clearError(m)},v=r.ion({change:p,input:p});r.setError(m)}if(a==="block"){var h;(h=r.focus)===null||h===void 0||h.call(r)}else a==="revert"&&(r.value=n,g=!0);g=!1}return g}else return i.onEditComplete(),!0}}}return!1}}cancelEdit(e){const t=this,{inputField:i,oldValue:r}=t,{value:n}=i;t.editing&&!t.isFinishing&&t.trigger("beforeCancel",{value:n,oldValue:r,event:e})!==!1&&(t.isFinishing=!0,t.hide(),t.trigger("cancel",{value:n,oldValue:r,event:e}),t.finishEdit(),t.isFinishing=!1)}onEditComplete(){const e=this,{record:t,dataField:i,inputField:r,oldValue:n}=e,{value:s}=r;if(!e.isFinishing){if(e.isFinishing=!0,e.hide(),t){const a=`set${z.capitalize(i)}`;t[a]?t[a](s):i.includes(".")?t.set(i,s):t[i]=s}e.trigger("complete",{value:s,oldValue:n}),e.finishEdit(),e.isFinishing=!1}}doDestroy(){this.createdInputField&&this.inputField.destroy(),super.doDestroy()}set owner(e){this._owner=e}get owner(){return this._owner||N.fromElement(this.element.parentNode)}changeInputField(e,t){const i=this;return t&&t.destroy(),typeof e=="string"&&(e={type:e}),e instanceof N||(e=N.create(e),i.createdInputField=!0),i.completeOnChange&&e.ion({change:"onInputFieldChange",thisObj:i}),e.parent=i,e}updateInputField(e){this.removeAll(),this.add(e)}get inputField(){return this.items[0]}onInputFieldChange(){this.containsFocus&&this.completeEdit()}onTargetSizeChange(e,t,i){t&&i&&this.updateSize(e)}updateSize(e,t=this.lastMatchSize){const i=this,r=$.inner(e);i.width=t.width===!1?"auto":r.width-i.align.offset[0],i.height=t.height===!1?"auto":r.height,i.lastMatchSize=t}beforeEditorHide(){if(this.editing&&!this.isFinishing)return this.cancelEdit(),!1}afterEditorHide(){this.positioned&&this.element.remove(),Ne.removeResizeListener(this.lastAlignSpec.target,this.onTargetSizeChange)}}M(Gt,"$name","Editor");M(Gt,"type","editor");M(Gt,"configurable",{positioned:!0,hidden:!0,layout:"fit",align:{align:"t0-t0",offset:[0,0]},hideTarget:!1,matchSize:!0,matchFont:!0,fitTargetContent:!1,inputField:"textfield",blurAction:"complete",completeKey:"Enter",cancelKey:"Escape",invalidAction:"block",completeOnChange:null,isolateFields:!0});Gt.initClass();Gt._$name="Editor";const Qg=["number","boolean","string","date","duration"],Vl=c=>{var e;return((e=c.column)===null||e===void 0?void 0:e.type)==="duration"},Fh="";class ee extends wt{static get $name(){return"FieldFilterPicker"}static get type(){return"fieldfilterpicker"}static get defaultValueFieldPlaceholders(){return{string:"L{enterAValue}",number:"L{enterANumber}",date:"L{selectADate}",list:"L{selectOneOrMoreValues}",duration:"L{enterAValue}"}}afterConstruct(){const e=this;if(!e._fields)throw new Error(`${ee.name} requires 'fields' to be configured.`);if(!e._filter)throw new Error(`${ee.name} requires 'filter' to be configured.`);super.afterConstruct();const{widgetMap:{propertyPicker:t,operatorPicker:i,caseSensitive:r}}=e;t.ion({select:"onPropertySelect",thisObj:e}),i.ion({select:"onOperatorSelect",thisObj:e}),r.ion({change:"onCaseSensitiveChange",thisObj:e}),e.propertyFieldConfig&&t.setConfig(e.propertyFieldConfig),e.operatorFieldConfig&&i.setConfig(e.operatorFieldConfig),t.cls=e.allPropertyPickerClasses,i.cls=e.allOperatorPickerClasses,e.populateUIFromFilter()}changeDateFormat(e){return this.L(e)}get allChildInputs(){const{propertyPicker:e,operatorPicker:t,caseSensitive:i}=this.widgetMap;return[e,t,...this.valueFields,i]}updateDisabled(e){this.allChildInputs.forEach(t=>t.disabled=e)}updateReadOnly(e){const{propertyPicker:t,operatorPicker:i}=this.widgetMap;this.allChildInputs.forEach(r=>r.readOnly=e),t.readOnly=t.readOnly||e,i.readOnly=i.readOnly||e}updatePropertyLocked(e){this.widgetMap.propertyPicker.readOnly=e||this.readOnly,this.widgetMap.propertyPicker.cls=this.allPropertyPickerClasses}updateOperatorLocked(e){this.widgetMap.operatorPicker.readOnly=e||this.readOnly,this.widgetMap.operatorPicker.cls=this.allOperatorPickerClasses}changeOperators(e){const t=e??ee.defaultOperators;return Object.keys(t).reduce((i,r)=>F(F({},i),{},{[r]:t[r].map(n=>F(F({},n),{},{text:this.L(n.text)}))}),{})}changeFields(e){let t=e;return Array.isArray(e)&&(ae.deprecate("Core","6.0.0","FieldOption[] deprecated, use Object<String, FieldOption> keyed by field name instead"),t=W.keyBy(t,"name")),t}get isMultiSelectValueField(){var e;return["isIncludedIn","isNotIncludedIn"].includes((e=this._filter)===null||e===void 0?void 0:e.operator)}get allPropertyPickerClasses(){var e;return new Q(`b-${ee.type}-property`,(e=this.propertyFieldConfig)===null||e===void 0?void 0:e.cls,{[`b-${ee.type}-combo-locked`]:this.propertyLocked})}get allOperatorPickerClasses(){var e;return new Q(`b-${ee.type}-operator`,(e=this.operatorFieldConfig)===null||e===void 0?void 0:e.cls,{[`b-${ee.type}-combo-locked`]:this.operatorLocked})}getValueFieldConfigs(){const e=this,{valueFieldCls:t,fieldType:i,_filter:{operator:r},onValueChange:n,filterValues:s,isMultiSelectValueField:a,operatorArgCount:o,getValueFieldConfig:l}=e,d=T.merge({},ee.defaultValueFieldPlaceholders,e.valueFieldPlaceholders);if(!i||!r||o===0)return[];let u={type:"textfield",listeners:{change:n,input:n,thisObj:e},cls:t,dataset:{type:i},placeholder:e.L(d[a?"list":i])};return a?u=F(F({},u),{},{type:"combo",multiSelect:!0,createOnUnmatched:!0,items:this.getUniqueDataValues(s),value:s??[]}):["number","date","boolean"].includes(i)?u.type=`${i}field`:i==="duration"&&(u.type="durationfield"),l&&(u=e.callback(l,e,[e.filter,u])),a?[u]:W.populate(o,h=>[{type:"widget",tag:"div",cls:`b-${ee.type}-value-separator`,content:e.L("L{FieldFilterPicker.and}")},F(F({},u),{},{value:s[h]})]).flat().slice(1)}getUniqueDataValues(e=[]){var t;const i=this,{fieldType:r}=i;if(!i.store||!((t=i._filter)!==null&&t!==void 0&&t.property))return[];const{relatedDisplayField:n}=i.selectedField;let s,a;if(i.fieldIsRelation){const{foreignStore:o}=i.currentPropertyRelationConfig;n?(s=o.allRecords.reduce((l,d)=>(d.id!=null&&l.push({text:d[n],value:d.id}),l),[]),a=s.sort((l,d)=>i.sortStrings(l.text,d.text))):s=o.allRecords.map(l=>l.id)}else s=i.store.allRecords.map(o=>o[i._filter.property]);if(!a){s.push(...e);const o=W.unique(s.reduce((l,d)=>(d!=null&&String(d).trim()!==""&&(r==="date"?l.push(d.valueOf()):r==="duration"?l.push(d.toString()):l.push(d)),l),[]));r==="string"?a=o.sort(i.sortStrings):r==="duration"?a=o.map(l=>new Ue(l)).filter(l=>l.isValid).sort(i.sortDurations):a=o.sort(i.sortNumerics),r==="date"?a=a.map(l=>{const d=new Date(l);return{text:b.format(d,i.dateFormat),value:l}}):r==="duration"&&(a=a.map(l=>l.toString()))}return a}sortStrings(e,t){return(e??Fh).localeCompare(t??Fh)}sortNumerics(e,t){return e-t}sortDurations(e,t){return e.valueOf()-t.valueOf()}get fieldType(){var e;return(e=this.selectedField)===null||e===void 0?void 0:e.type}get selectedField(){var e,t;return(e=this.fields)===null||e===void 0?void 0:e[(t=this._filter)===null||t===void 0?void 0:t.property]}get propertyOptions(){var e;return Object.entries((e=this.fields)!==null&&e!==void 0?e:{}).filter(([,t])=>Qg.includes(t.type)||Vl(t)).map(([t,{title:i}])=>({value:t,text:i??t})).sort((t,i)=>t.text.localeCompare(i.text))}get operatorOptions(){return this.operators[this.fieldIsRelation?"relation":this.fieldType]}get fieldIsRelation(){return Boolean(this.currentPropertyRelationConfig)}get currentPropertyRelationConfig(){var e,t;return(e=this.store)===null||e===void 0||(t=e.modelRelations)===null||t===void 0?void 0:t.find(({foreignKey:i})=>{var r;return i===((r=this._filter)===null||r===void 0?void 0:r.property)})}updateOperators(){delete this._operatorArgCountLookup}get operatorArgCountLookup(){return this._operatorArgCountLookup||(this._operatorArgCountLookup=ee.buildOperatorArgCountLookup(this.operators))}updateFilter(){this._filter&&this.onFilterChange()}updateStore(e){var t;(t=this._store)===null||t===void 0||t.un(this),e?.ion({refresh:"onStoreRefresh",thisObj:this})}onStoreRefresh({action:e}){this.isMultiSelectValueField&&["dataset","create","update","delete"].includes(e)&&(this.valueFields[0].items=this.getUniqueDataValues(this.filterValues))}refreshValueFields(){const e=this,{valueFieldRow:t}=e.widgetMap;t.removeAll(),t.add(e.getValueFieldConfigs()),delete e._valueFields,e.refreshCaseSensitive()}refreshCaseSensitive(){var e,t;const i=this,{fieldType:r,operatorArgCount:n,isMultiSelectValueField:s}=i,a=(e=i._filter)===null||e===void 0?void 0:e.operator,{caseSensitive:o}=i.widgetMap;o.hidden=r!=="string"||!a||s||n===0,o.checked=((t=i._filter)===null||t===void 0?void 0:t.caseSensitive)!==!1}onPropertySelect(e){var t;const i=this,{_filter:r}=i;r.property=((t=e.record)===null||t===void 0?void 0:t.data.value)||null,i.fieldType!==i._fieldType&&(r.operator=null,r.value=null),i._fieldType=r.type=i.fieldType,i.refreshOperatorPicker(),i.refreshValueFields(),i.triggerChange()}onCaseSensitiveChange({checked:e}){this._filter.caseSensitive=e,this.triggerChange()}onOperatorSelect(e){var t;const i=this,r=i.isMultiSelectValueField,n=this.operatorArgCount;i._filter.operator=((t=e.record)===null||t===void 0?void 0:t.data.value)||null,i.operatorArgCount!==n&&(i._filter.value=null),i.isMultiSelectValueField&&!r&&(i._filter.value=[]),i.refreshValueFields(),i.triggerChange()}triggerChange(){const{filter:e,isValid:t}=this;this.trigger("change",{filter:e,isValid:t})}onValueChange(){const e=this,{isMultiSelectValueField:t,fieldType:i,_filter:r}=e,n=this.valueFields.map(s=>s.value);t&&i==="date"?r.value=n[0].map(s=>new Date(s)):t&&i==="duration"?r.value=n[0].map(s=>new Ue(s)):(i==="date"&&r.operator==="between"&&b.isValidDate(n[1])&&n[1].setHours(23,59,59,999),r.value=n.length===1?n[0]:n),e.triggerChange()}refreshOperatorPicker(){const{operatorPicker:e}=this.widgetMap,{_filter:{operator:t,property:i},operatorOptions:r}=this;e.items=r,e.value=t,e.hidden=i===null}populateUIFromFilter(e=!1){const t=this,{filterValues:i,widgetMap:{propertyPicker:r,operatorPicker:n},_filter:{property:s,operator:a,disabled:o},propertyOptions:l,operatorOptions:d,isMultiSelectValueField:u}=t;r.items=l,n.items=d,n.hidden=s===null;let h=e;r.value!==s&&(r.value=s,t.refreshOperatorPicker(),h=!0),n.value!==a&&(a===null?n.clear():n.value=a,h=!0),h&&t.refreshValueFields(),t.refreshCaseSensitive(),t.valueFields.forEach((f,g)=>{u&&(f.value.length>0||i.length>0)?t.fieldType==="date"?f.value=i.map(m=>m?.valueOf()):t.fieldType==="duration"?f.value=i.map(m=>m?.toString()):f.value=i:g>=i.length?f.clear():f.value=i[g]}),t.allChildInputs.forEach(f=>f.disabled=t.disabled||o)}get valueFields(){return this._valueFields||(this._valueFields=this.widgetMap.valueFieldRow.queryAll(e=>["textfield","datefield","numberfield","durationfield","combo"].includes(e.type)))}get filterValues(){var e;return((e=this._filter)===null||e===void 0?void 0:e.value)==null?[]:W.asArray(this._filter.value)}onFilterChange(){const e=this,t=e.fieldType,i=t!==e._fieldType;e._fieldType=e._filter.type=t,e.populateUIFromFilter(i)}get operatorArgCount(){const{fieldType:e,filter:{operator:t},operatorArgCountLookup:i}=this;return e&&t?i[e][t]:1}get isValid(){const e=this,{filter:t,fieldType:i,filterValues:r,isMultiSelectValueField:n,operatorArgCount:s}=e,{operator:a}=t,o=s>0&&t?.value==null;return i&&a&&!o&&(n&&r.length>0||r.length===s)&&r.every(l=>l!=null&&(i!=="duration"||l.isValid))}}M(ee,"operators",{empty:{value:"empty",text:"L{isEmpty}",argCount:0},notEmpty:{value:"notEmpty",text:"L{isNotEmpty}",argCount:0},"=":{value:"=",text:"L{equals}"},"!=":{value:"!=",text:"L{doesNotEqual}"},">":{value:">",text:"L{isGreaterThan}"},"<":{value:"<",text:"L{isLessThan}"},">=":{value:">=",text:"L{isGreaterThanOrEqualTo}"},"<=":{value:"<=",text:"L{isLessThanOrEqualTo}"},between:{value:"between",text:"L{isBetween}",argCount:2},notBetween:{value:"notBetween",text:"L{isNotBetween}",argCount:2},isIncludedIn:{value:"isIncludedIn",text:"L{isOneOf}"},isNotIncludedIn:{value:"isNotIncludedIn",text:"L{isNotOneOf}"}});M(ee,"defaultOperators",{string:[ee.operators.empty,ee.operators.notEmpty,ee.operators["="],ee.operators["!="],{value:"includes",text:"L{contains}"},{value:"doesNotInclude",text:"L{doesNotContain}"},{value:"startsWith",text:"L{startsWith}"},{value:"endsWith",text:"L{endsWith}"},ee.operators.isIncludedIn,ee.operators.isNotIncludedIn],number:[ee.operators.empty,ee.operators.notEmpty,ee.operators["="],ee.operators["!="],ee.operators[">"],ee.operators["<"],ee.operators[">="],ee.operators["<="],ee.operators.between,ee.operators.notBetween,ee.operators.isIncludedIn,ee.operators.isNotIncludedIn],date:[ee.operators.empty,ee.operators.notEmpty,ee.operators["="],ee.operators["!="],{value:"<",text:"L{isBefore}"},{value:">",text:"L{isAfter}"},ee.operators.between,{value:"isToday",text:"L{isToday}",argCount:0},{value:"isTomorrow",text:"L{isTomorrow}",argCount:0},{value:"isYesterday",text:"L{isYesterday}",argCount:0},{value:"isThisWeek",text:"L{isThisWeek}",argCount:0},{value:"isNextWeek",text:"L{isNextWeek}",argCount:0},{value:"isLastWeek",text:"L{isLastWeek}",argCount:0},{value:"isThisMonth",text:"L{isThisMonth}",argCount:0},{value:"isNextMonth",text:"L{isNextMonth}",argCount:0},{value:"isLastMonth",text:"L{isLastMonth}",argCount:0},{value:"isThisYear",text:"L{isThisYear}",argCount:0},{value:"isNextYear",text:"L{isNextYear}",argCount:0},{value:"isLastYear",text:"L{isLastYear}",argCount:0},{value:"isYearToDate",text:"L{isYearToDate}",argCount:0},ee.operators.isIncludedIn,ee.operators.isNotIncludedIn],boolean:[{value:"isTrue",text:"L{isTrue}",argCount:0},{value:"isFalse",text:"L{isFalse}",argCount:0}],duration:[ee.operators.empty,ee.operators.notEmpty,ee.operators["="],ee.operators["!="],ee.operators[">"],ee.operators["<"],ee.operators[">="],ee.operators["<="],ee.operators.between,ee.operators.notBetween,ee.operators.isIncludedIn,ee.operators.isNotIncludedIn],relation:[ee.operators.isIncludedIn,ee.operators.isNotIncludedIn]});M(ee,"configurable",{fields:null,disabled:!1,readOnly:!1,layout:"vbox",propertyLocked:!1,operatorLocked:!1,filter:null,propertyFieldConfig:null,operatorFieldConfig:null,valueFieldCls:null,items:{propertyAndOperator:{type:"container",layout:"box",items:{propertyPicker:{type:"combo",items:{},cls:`b-${ee.type}-property`,placeholder:"L{FieldFilterPicker.selectAProperty}"},operatorPicker:{type:"combo",items:{},cls:`b-${ee.type}-operator`,placeholder:"L{FieldFilterPicker.selectAnOperator}"}}},valueFieldRow:{type:"container",cls:`b-${ee.type}-values`,items:{}},caseSensitive:{type:"checkbox",text:"L{FieldFilterPicker.caseSensitive}",cls:`b-${ee.type}-case-sensitive`}},operators:ee.defaultOperators,dateFormat:"L{FieldFilterPicker.dateFormat}",store:null,valueFieldPlaceholders:null,getValueFieldConfig:null});M(ee,"buildOperatorArgCountLookup",c=>W.keyBy(Object.entries(c),([e])=>e,([,e])=>W.keyBy(e,({value:t})=>t,({argCount:t})=>t===void 0?1:t)));ee.initClass();ee._$name="FieldFilterPicker";class Kn extends N{compose(){const{text:e,html:t}=this;return{tag:"label",text:e,html:t}}}M(Kn,"$name","Label");M(Kn,"type","label");M(Kn,"configurable",{text:null,localizableProperties:["text"]});Kn.initClass();Kn._$name="Label";class vt extends wt{static get $name(){return"FieldFilterPickerGroup"}static get type(){return"fieldfilterpickergroup"}afterConstruct(){const e=this;e.validateConfig();const{addFilterButton:t}=e.widgetMap;t.ion({click:"addFilter",thisObj:e}),t.text=e.L(t.text),e.store&&e.updateStore(e.store),super.afterConstruct()}changeDateFormat(e){return this.L(e)}validateConfig(){if(!this.fields&&!this.store)throw new Error("FieldFilterPickerGroup requires either a 'fields' or 'store' config property.")}get someFiltersNotShown(){return this.store&&this.store.filters.count>this.filters.length}updateFields(e){this.widgetMap.pickers.childItems.forEach(t=>t.fields=e)}updateFilters(e,t){const i=this;t&&t.filter(r=>!e.find(n=>n.id===r.id)).forEach(r=>{var n;return(n=i.store)===null||n===void 0?void 0:n.removeFilter(r.id)}),e.forEach(r=>r.id=r.id||i.nextFilterId),i.widgetMap.pickers.items=e?.map(r=>i.getPickerRowConfig(r))||[]}changeFilters(e){const{canManageFilter:t}=this;return e&&t?e.filter(i=>this.callback(t,this,[i])):e}updateStore(e){const t=this;t.detachListeners("store"),e&&(t.widgetMap.pickers.childItems.forEach(({widgetMap:{filterPicker:{filter:i,isValid:r}}})=>{e.removeFilter(i.id,!0),r&&e.addFilter(i,!0)}),e.filter(),t.appendFiltersFromStore(),e.ion({name:"store",filter:"onStoreFilter",thisObj:t})),t.widgetMap.pickers.childItems.forEach(i=>i.store=e)}updateShowAddFilterButton(e){this.widgetMap.addFilterButton.hidden=!e}updateAddFilterButtonText(e){this.widgetMap.addFilterButton.text=e??vt.addFilterButtonDefaultText}appendFiltersFromStore(){const e=this;e.store.filters.forEach(t=>{var i;const r=e.canManage(t),{property:n,operator:s,value:a,id:o,disabled:l=!1,caseSensitive:d}=t;r&&n&&s&&!((i=e.filters)!==null&&i!==void 0&&i.find(u=>u.id===o))&&e.appendFilter({id:o,property:n,operator:s,value:a,disabled:l,caseSensitive:d})})}canManage(e){const t=this;return!t.canManageFilter||t.callback(t.canManageFilter,t,[e])===!0}getFilterPickerConfig(e){const t=this,{fields:i,store:r,disabled:n,readOnly:s,valueFieldCls:a,operators:o,limitToProperty:l,dateFormat:d,getFieldFilterPickerConfig:u}=t;return F({type:t.constructor.childPickerType,fields:i??t.getFieldsFromStore(r),filter:e,store:r,disabled:n,readOnly:s,propertyLocked:Boolean(l),valueFieldCls:a,operators:o,dateFormat:d,internalListeners:{change:"onFilterPickerChange",thisObj:t},flex:1},u?t.callback(u,t,[e]):void 0)}getFieldsFromStore(e){var t,i;return Object.fromEntries((t=(i=e.fields)===null||i===void 0?void 0:i.map(({name:r,type:n})=>[r,{type:n}]))!==null&&t!==void 0?t:[])}getPickerRowConfig(e){const t=this,{disabled:i,readOnly:r,canDeleteFilter:n}=t;return{type:"container",layout:"box",layoutStyle:{alignItems:"start"},cls:`b-${vt.type}-row`,dataset:{separatorText:t.L("L{FieldFilterPicker.and}")},items:{activeCheckbox:{type:"checkbox",disabled:i,readOnly:r,checked:!Boolean(e.disabled),listeners:{change:"onFilterActiveChange",thisObj:t},cls:`b-${vt.type}-filter-active`},filterPicker:t.getFilterPickerConfig(e),removeButton:{type:"button",ref:"removeButton",disabled:i,readOnly:r,hidden:n&&t.callback(n,t,[e])===!1,cls:`b-transparent b-${vt.type}-remove`,icon:"b-fa-trash",internalListeners:{click:"removeFilter",thisObj:t}}}}}get allInputs(){const e=[this.constructor.childPickerType,"button","checkbox"];return this.queryAll(t=>e.includes(t.type))}updateDisabled(e){this.allInputs.forEach(t=>t.disabled=e)}updateReadOnly(e){this.allInputs.forEach(t=>t.readOnly=e)}onFilterActiveChange({source:e,checked:t}){const i=this,r=i.getFilterIndex(e),n=i.filters[r],s=i.getFilterPicker(r);n.disabled=!t,s.onFilterChange(),i.store&&s.isValid&&i.store.addFilter(n,!0),i.updateStoreFilter(),i.triggerChange()}onFilterPickerChange({source:e,filter:t,isValid:i}){const r=this,{store:n}=r,s=r.getFilterIndex(e);n&&(n.removeFilter(t.id,!0),i&&n.addFilter(t,!0),r.updateStoreFilter()),Object.assign(r.filters[s],t),r.triggerChange()}getFilterIndex(e){return this.widgetMap.pickers.childItems.indexOf(e.containingWidget)}getPickerRow(e){return this.widgetMap.pickers.childItems[e]}getFilterPicker(e){return this.getPickerRow(e).widgetMap.filterPicker}get nextFilterId(){return this._nextId=(this._nextId||0)+1,`${this.id}-filter-${this._nextId}`}removeFilter({source:e}){const t=this,i=t.getFilterIndex(e),r=t.filters[i],n=t.getPickerRow(i),s=t.query(a=>a.isFocusable&&a.type!=="container"&&!n.contains(a));s&&s.focus(),t.removeFilterAt(i),t.store&&(t.store.removeFilter(r.id,!0),t.updateStoreFilter()),t.trigger("remove",{filter:r}),t.triggerChange()}addFilter({property:e=null,operator:t=null,value:i=null}={}){const r=this,{filters:n}=r,s={property:r.limitToProperty||e,operator:t,value:i,disabled:!1,id:r.nextFilterId,caseSensitive:!1};if(r.appendFilter(s),r.getFilterPicker(n.length-1).isValid){var a;(a=r.store)===null||a===void 0||a.addFilter(s,!0),r.store&&r.updateStoreFilter()}r.trigger("add",{filter:s}),r.triggerChange()}appendFilter(e){const t=this;(!t.limitToProperty||e.property===t.limitToProperty)&&(t.filters.push(e),t.widgetMap.pickers.add(t.getPickerRowConfig(e,t.filters.length-1)))}onStoreFilter(e){const t=this;if(t._isUpdatingStore)return;const{filters:i}=e,r=i.values.reduce((n,s)=>F(F({},n),{},{[s.id]:s}),{});for(let n=t.filters.length-1;n>=0;n--){const s=t.filters[n],a=r[s.id],o=t.getPickerRow(n);if(o){const{filterPicker:l,activeCheckbox:d}=o.widgetMap;if(!a&&l.isValid)t.removeFilterAt(n);else if(a!==void 0){const{operator:u,value:h,property:f,disabled:g,caseSensitive:m}=a;s!==a&&Object.assign(s,{operator:u,value:h,property:f,disabled:g,caseSensitive:m}),l.filter=s,l.onFilterChange(),d.checked=!g}}}t.appendFiltersFromStore(),t.triggerChange()}removeFilterAt(e){const{widgetMap:{pickers:t},filters:i}=this;t.remove(t.childItems[e]),i.splice(e,1),this.triggerChange()}updateStoreFilter(){this._isUpdatingStore=!0,this.store.filter(),this._isUpdatingStore=!1}get value(){return this.filters}triggerChange(){this.trigger("change",{filters:this.value})}activateAll(){this.setAllActiveStatus(!0)}deactivateAll(){this.setAllActiveStatus(!1)}setAllActiveStatus(e){const t=this,{_filters:i,store:r}=t;i.forEach((n,s)=>{if(e===n.disabled){const{filterPicker:a,activeCheckbox:o}=t.getPickerRow(s).widgetMap;n.disabled=!e,a.onFilterChange(),o.checked=e,e&&r&&a.isValid&&r.addFilter(n,!0)}}),t.updateStoreFilter()}}M(vt,"addFilterButtonDefaultText","L{FieldFilterPickerGroup.addFilter}");M(vt,"configurable",{filters:[],fields:null,disabled:!1,readOnly:!1,layout:"vbox",store:null,limitToProperty:null,valueFieldCls:null,showAddFilterButton:!0,canDeleteFilter:null,getFieldFilterPickerConfig:null,canManageFilter:null,addFilterButtonText:null,items:{pickers:{type:"container",layout:"vbox",scrollable:!0,items:{}},addFilterButton:{type:"button",text:vt.addFilterButtonDefaultText,cls:`b-${vt.type}-add-button`,hidden:!0}},operators:null,dateFormat:"L{FieldFilterPicker.dateFormat}"});M(vt,"childPickerType","fieldfilterpicker");vt.initClass();vt._$name="FieldFilterPickerGroup";class od extends Ye.mixin(Yg){static get $name(){return"FieldSet"}static get type(){return"fieldset"}static get configurable(){return{bodyTag:"fieldset",focusable:!1,inline:null,inlineInternal:null,layout:{type:"box",horizontal:!1}}}static get prototypeProperties(){return{flexRowCls:"b-hbox",flexColCls:"b-vbox"}}get bodyConfig(){const e=super.bodyConfig,{className:t}=e,{inlineInternal:i,hasLabel:r,title:n}=this;return delete e.html,t["b-inline"]=i,t["b-fieldset-has-label"]=r,n&&(e.children={legendElement:{tag:"legend",text:n,class:{"b-fieldset-legend":1}}}),e}compose(){const{inlineInternal:e,label:t,labelCls:i,labelWidth:r}=this;return{class:{"b-field":t,"b-vbox":!e},children:{"labelElement > headerElement":(t||null)&&{tag:"label",html:t,class:{"b-label":1,"b-align-start":1,[i]:i},style:{width:S.unitize("width",r)[1]}}}}}syncInlineInternal(){var e;this.inlineInternal=(e=this.inline)!==null&&e!==void 0?e:this.label!=null&&this.labelPosition==="before"}updateDisabled(e,t){super.updateDisabled(e,t),this.eachWidget(i=>{i.disabled=e},!1)}updateInline(){this.syncInlineInternal()}updateInlineInternal(e){this.layout.horizontal=e}updateLabel(){this.syncInlineInternal()}updateLabelPosition(){this.syncInlineInternal()}}od.initClass();od._$name="FieldSet";class em extends Oe{static get $name(){return"FileField"}static get type(){return"filefield"}static get configurable(){return{multiple:null,accept:null,inputType:"file",attributes:["multiple","accept"]}}get files(){return this.input.files}pickFile(){this.input.click()}get multiple(){return this._multiple?"":null}clear(){this.input.value=null}triggerChange(e){this.triggerFieldChange({event:e,value:this.input.value,oldValue:this._lastValue,userAction:!0,valid:!0})}}em.initClass();em._$name="FileField";class tm extends wt{static get $name(){return"FilePicker"}static get type(){return"filepicker"}static get defaultConfig(){return{defaultBindProperty:"value",buttonConfig:null,fileFieldConfig:null}}construct(e={}){const t=this;e.items=[Object.assign({type:"button",ref:"fileButton",text:"L{FilePicker.file}",localeClass:this},e.buttonConfig),Object.assign({type:"filefield",ref:"fileField",style:"display: none"},e.fileFieldConfig)].concat(e.items||[]),super.construct(e),t.button.ion({click:t.onButtonClick,thisObj:t}),t.fileField.ion({change:t.onFileFieldChange,thisObj:t}),t._thisIsAUsedExpression(t.fileTip)}get button(){return this.widgetMap.fileButton}get fileField(){return this.widgetMap.fileField}get files(){return this.fileField.files}get fileTip(){const e=this;return e._fileTip||(e._fileTip=new ce({cls:"b-file-tip",forElement:e.button.element,showOnHover:!0,align:"b-t",scrollAction:"realign",internalListeners:{beforeshow(){const t=this,i=e.files;return i&&i.length?(t.html=`${Array.from(i).map(r=>r.name).join("<br>")}`,!0):!1}}}))}clear(){const e=this;e.fileField.clear(),e.button.badge="",e.trigger("clear")}onButtonClick({event:e}){this.fileField.pickFile(),e.preventDefault()}onFileFieldChange({valid:e}){const t=this;t.button.badge=t.files.length||"",t.triggerFieldChange({files:t.files,valid:e})}}tm.initClass();tm._$name="FilePicker";class im extends Hr{static get $name(){return"FilterField"}static get type(){return"filterfield"}static get configurable(){return{field:null,store:null,filterFunction:null,clearable:!0,keyStrokeChangeDelay:100,onChange({value:e}){const{store:t,field:i,filterFunction:r}=this;if(t){const n=`${i||this.id}-Filter`;if(e.length===0)t.removeFilter(n);else{let s;r?s=a=>r(a,e):(e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=a=>a.get(i).match(new RegExp(e,"i"))),t.filter({id:n,filterBy:s})}}}}}updateValue(e,t){super.updateValue(e,t),e&&this.isConfiguring&&this.onChange({value:e})}}im.initClass();im._$name="FilterField";const rm=[{ref:"cancelButton",cls:"b-messagedialog-cancelbutton b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick"},{ref:"okButton",cls:"b-messagedialog-okbutton b-raised b-blue",text:"L{Object.Ok}",onClick:"up.onOkClick"}];K.isWindows&&rm.reverse();class Na extends We{static get $name(){return"MessageDialog"}static get type(){return"messagedialog"}static get configurable(){return{centered:!0,modal:!0,hidden:!0,autoShow:!1,closeAction:"hide",title:"\xA0",lazyItems:{$config:["lazy"],value:[{cls:"b-messagedialog-message",ref:"message"},{type:"textfield",cls:"b-messagedialog-input",ref:"input"}]},showClass:null,bbar:{overflow:null,items:rm}}}construct(){this.okButton=this.yesButton=1,this.cancelButton=3,super.construct(...arguments)}destroy(){}async confirm(){return this.showDialog("confirm",...arguments)}async alert(){return this.showDialog("alert",...arguments)}async prompt({textField:e}){const t=this.widgetMap.input;return N.reconfigure(t,e),t.value="",this.showDialog("prompt",...arguments)}showDialog(e,{message:t="",title:i="\xA0",cancelButton:r,okButton:n,rootElement:s=document.body}){const a=this;return a.rootElement=s,a.getConfig("lazyItems"),a.title=a.optionalL(i),a.widgetMap.message.html=a.optionalL(t),a.showClass=`b-messagedialog-${e}`,n&&(n=typeof n=="string"?{text:n}:n),r&&(r=typeof r=="string"?{text:r}:r),n=Object.assign({},a.widgetMap.okButton.initialConfig,n),r=Object.assign({},a.widgetMap.cancelButton.initialConfig,r),n.text=a.optionalL(n.text),r.text=a.optionalL(r.text),N.reconfigure(a.widgetMap.okButton,n),N.reconfigure(a.widgetMap.cancelButton,r),a.show(),a.promise=new Promise(o=>{a.resolve=o})}show(){const e=S.getActiveElement(this.element);return this.owner=this.element.contains(e)?null:Na.fromElement(document.activeElement),super.show(...arguments)}updateShowClass(e,t){const{classList:i}=this.element;t&&i.remove(t),e&&i.add(e)}doResolve(e){const t=this,{resolve:i}=t;if(i){const r=t.showClass==="b-messagedialog-prompt";if(r&&e===t.okButton&&!t.widgetMap.input.isValid)return;t.resolve=t.reject=t.promise=null,i(r?{button:e,text:t.widgetMap.input.value}:e),t.hide()}}onInternalKeyDown(e){e.key==="Escape"&&(e.stopImmediatePropagation(),this.onCancelClick()),e.key==="Enter"&&(e.stopImmediatePropagation(),e.preventDefault(),this.onOkClick()),super.onInternalKeyDown(e)}onOkClick(){this.doResolve(Pi.okButton)}onCancelClick(){this.doResolve(Pi.cancelButton)}}Na.initClass();const Pi=new Proxy({},{get(c,e){const t=c.instance||(c.instance=new Na({rootElement:document.body})),i=t[e];return typeof i=="function"?i.bind(t):i}});class nm extends $r{static get $name(){return"PagingToolbar"}static get type(){return"pagingtoolbar"}static get defaultConfig(){return{store:null,defaults:{localeClass:this},items:{firstPageButton:{onClick:"up.onFirstPageClick",icon:"b-icon-first",weight:100,tooltip:"L{PagingToolbar.firstPage}"},previousPageButton:{onClick:"up.onPreviousPageClick",icon:"b-icon-previous",weight:110,tooltip:"L{PagingToolbar.prevPage}"},pageNumber:{type:"numberfield",label:"L{page}",min:1,max:1,triggers:null,onChange:"up.onPageNumberChange",highlightExternalChange:!1,weight:120},pageCount:{type:"widget",cls:"b-pagecount b-toolbar-text",weight:130},nextPageButton:{onClick:"up.onNextPageClick",icon:"b-icon-next",weight:140,tooltip:"L{PagingToolbar.nextPage}"},lastPageButton:{onClick:"up.onLastPageClick",icon:"b-icon-last",weight:150,tooltip:"L{PagingToolbar.lastPage}"},separator:{type:"widget",cls:"b-toolbar-separator",weight:151},reloadButton:{onClick:"up.onReloadClick",icon:"b-icon-reload",weight:160,tooltip:"L{PagingToolbar.reload}"},spacer:{type:"widget",cls:"b-toolbar-fill",weight:161},dataSummary:{type:"widget",cls:"b-toolbar-text",weight:170}}}}set parent(e){super.parent=e,this.store||(this.store=e.store)}get parent(){return super.parent}set store(e){const t=this;t.detachListeners("store"),t._store=e,e&&(e.ion({name:"store",beforerequest:"onStoreBeforeRequest",afterrequest:"onStoreChange",change:"onStoreChange",thisObj:t}),e.isLoading&&t.onStoreBeforeRequest())}get store(){return this._store}onStoreBeforeRequest(){this.eachWidget(e=>e.disable())}updateLocalization(){this.updateSummary(),super.updateLocalization()}updateSummary(){const e=this,{pageCount:t,dataSummary:i}=e.widgetMap;let r=0,n=0,s=0,a=0,o=0;if(e.store){const{store:l}=e,{pageSize:d,currentPage:u}=l;r=l.count,n=l.lastPage,o=l.allCount,s=Math.max(0,(u-1)*d+1),a=Math.min(o,s+d-1)}t.html=e.L("L{pageCountTemplate}")({lastPage:n}),i.html=r?e.L("L{summaryTemplate}")({start:s,end:a,allCount:o}):e.L("L{noRecords}")}onStoreChange(){const e=this,{widgetMap:t,store:i}=e,{count:r,lastPage:n,currentPage:s}=i,{pageNumber:a,pageCount:o,firstPageButton:l,previousPageButton:d,nextPageButton:u,lastPageButton:h,dataSummary:f}=t;e.eachWidget(g=>g.enable()),a.value=s,a.max=n,f.disabled=a.disabled=o.disabled=!r,l.disabled=d.disabled=s<=1||!r,u.disabled=h.disabled=s>=n||!r,e.updateSummary()}onPageNumberChange({value:e}){this.store.currentPage!==e&&this.store.loadPage(e)}onFirstPageClick(){this.store.loadPage(1)}onPreviousPageClick(){this.store.previousPage()}onNextPageClick(){this.store.nextPage()}onLastPageClick(){this.store.loadPage(this.store.lastPage)}onReloadClick(){this.store.loadPage(this.store.currentPage)}}nm.initClass();nm._$name="PagingToolbar";const{dockIsHorz:m0}=qi.maps,p0={top:0,down:0,left:1,bottom:2,up:2,right:3},v0={},fl={up:{from:"translate(0,0)",to:"translate(0,-100%)"},down:{from:"translate(0,0)",to:"translate(0,100%)"},left:{from:"translate(0,0)",to:"translate(-100%,0)"},right:{from:"translate(0,0)",to:"translate(100%,0)"}};class sm extends qi.mixin(he){static get $name(){return"PanelCollapserOverlay"}static get type(){return"overlay"}static get configurable(){return{autoCloseDelay:1e3,autoClose:!0,revealing:{value:null,$config:null,default:!1},recollapseTool:{type:"collapsetool",cls:"b-recollapse",collapsify:"overlay",handler(){var e;(e=this.collapsible)===null||e===void 0||e.toggleReveal()}}}}static get delayable(){return{doAutoClose:0}}doAutoClose(){this.toggleReveal(!1)}updateAutoCloseDelay(e){const{doAutoClose:t}=this;(t.suspended=e==null||e<0)||(t.delay=e,t.immediate=!e)}changeRecollapseTool(e){const t=this,{panel:i}=t;if(t.isConfiguring||t.isDestroying||!i||i.isDestroying)return e;i.tools={recollapse:e}}beforeCollapse(e){if(super.beforeCollapse(e)===!1)return!1;this.panel.revealed&&(e.animation=null)}applyHeaderDock(e,t=!0){var i;(i=this.panel)===null||i===void 0||i.recompose(),super.applyHeaderDock(e,t)}collapseBegin(e){const t=this,{collapseDir:i,innerElement:r}=t,{animation:n}=e,{collapseTool:s,panel:a}=t;t.configuredWidth=a._lastWidth,t.configuredHeight=a._lastHeight,t.applyHeaderDock(!0),t.lockInnerSize(),s?.element.classList.add("b-collapsed"),n&&(a.element.classList.add("b-collapsing"),n.element=r,n.transform=fl[i],e.animation=Te.run(n))}onComplete(e){var t,i;super.onComplete(e);const r=this,{panel:n}=r,{element:s}=n;r.autoCloseLeaveDetacher=(t=r.autoCloseLeaveDetacher)===null||t===void 0?void 0:t.call(r),r.autoCloseClickDetacher=(i=r.autoCloseClickDetacher)===null||i===void 0?void 0:i.call(r),r.doAutoClose.cancel(),e==="reveal"&&r.autoClose&&(n.containsFocus&&(r.autoCloseLeaveDetacher=B.on({element:s,mouseenter:a=>{r.doAutoClose.cancel()},mouseleave:a=>{r.doAutoClose()}})),r.autoCloseClickDetacher=B.on({element:document.body,thisObj:n,mousedown:a=>{if(a.target!==s&&!s.contains(a.target)&&r.autoCloseDelay!=null){var o;const l=n.containsFocus&&((o=n.focusInEvent)===null||o===void 0?void 0:o.relatedTarget)||S.getActiveElement(s);l!=null&&l.contains(a.target)||r.doAutoClose.now()}}}))}expandBegin(e){const t=this,{animation:i}=e,{collapseDir:r,collapseTool:n,innerElement:s,panel:a}=t,{element:o}=a;o.classList.remove("b-collapsed","b-collapsing"),t.restoreConfiguredSize(),t.lockInnerSize(!1),t.lockInnerSize(),n?.element.classList.remove("b-collapsed"),i&&(o.classList.add("b-collapsed","b-expanding"),i.element=s,i.transform={from:fl[r].to,to:fl[r].from},e.animation=Te.run(i))}expandEnd(e){super.expandEnd(e);const{panel:t}=this;e.completed&&(t.revealed=!1),t.element.classList.remove("b-expanding")}expandRevert(e){super.expandRevert(e),this.panel.element.classList.add("b-expanding")}get innerElement(){return this.panel.overlayElement}get innerSizeElement(){return this.panel.element}get toolsConfig(){const e=this,{direction:t}=e,i=super.toolsConfig,r=e.recollapseTool;return r?F(F({},i),{},{recollapse:r&&T.assign({direction:t.toLowerCase()},r)}):i}lockInnerSize(e=!0){const t=this,{panel:i}=t,r=e&&i.rectangle(),n=e?[0,0,0,0]:"",s=super.lockInnerSize(e);return e&&(n[p0[t.collapseDir]]=`-${r[t.collapseDim]+10}px`),i.element.style.clipPath=e?`inset(${n.join(" ")})`:"",s}onOverlayTransitionDone(e){const t=this,{panel:i}=t;e.srcElement===i.overlayElement&&t.revealing&&(t.revealing=!1,t.onComplete(i.revealed?"reveal":"unreveal"))}onRevealerClick(){this.toggleReveal()}splitHeaderItems({as:e,dock:t}=v0){var i;return(i=this.panel)===null||i===void 0?void 0:i.splitHeaderItems({as:e,dock:t,overlay:!0})}toggleReveal(e){const{panel:t}=this,{element:i}=t;t.collapsed&&(e==null&&(e=!t.revealed),t.revealed!==e&&t.trigger("beforeToggleReveal",{reveal:e})!==!1&&(!e&&i.contains(S.getActiveElement(i))&&t.revertFocus(!0),this.revealing=!0,t.revealed=e))}updateRevealing(e){const t=this,i=/left|right/i,{panel:r}=t,n=i.test(t.collapseDir)?"height":"width";r&&(t.innerElement.style[n]="0px",t.innerElement.style[`min-${n}`]="100%",r.element.classList[e?"add":"remove"]("b-panel-overlay-revealing"))}wrapCollapser(e,t){var i;const r=this,{collapseDir:n,panel:s}=r,{expandedHeaderDock:a,header:o,uiClassList:l}=s,d=(i=s.tools)===null||i===void 0?void 0:i.recollapse,[u,h]=r.splitHeaderItems({dock:r.collapseDock,as:"element"}),f=m0[a],g=s.hasHeader?s.title||o?.title||"\xA0":null;return d&&(d.direction=n),["overlayElement",{class:F(F({},l),{},{[`b-panel-overlay-header-${a}`]:1,[`b-panel-overlay-${n}`]:1,[`b-${f?"h":"v"}box`]:1,"b-panel-overlay":1,"b-box-center":1}),listeners:{transitionend:m=>r.onOverlayTransitionDone(m)},children:{overlayHeaderElement:g&&{tag:"header",class:new Q(F(F({},l),{},{[`b-dock-${a}`]:1,"b-panel-header":1,"b-panel-overlay-header":1}),o?.cls),children:[...u,{reference:"overlayTitleElement",html:g,class:F(F({},l),{},{[`b-align-${o?.titleAlign||"start"}`]:1,"b-header-title":1})},...h]},[e]:t}}]}}sm.initClass();sm._$name="PanelCollapserOverlay";class am extends Oe{static get type(){return"passwordfield"}static get alias(){return"password"}static get $name(){return"PasswordField"}construct(e={}){e.inputType="password",super.construct(...arguments),this.element.classList.add("b-textfield")}}am.initClass();am._$name="PasswordField";class om extends Nr{static get $name(){return"Radio"}static get type(){return"radio"}static get alias(){return"radiobutton"}static get configurable(){return{inputType:"radio",clearable:null,uncheckedValue:void 0}}get textLabelCls(){return super.textLabelCls+" b-radio-label"}internalOnClick(e){super.internalOnClick(e)!==!1&&this.checked&&this.clearable&&(this.checked=!1)}updateName(e){this.toggleGroup=e}updateClearable(){}}om.initClass();om._$name="Radio";class lm extends od{static get $name(){return"RadioGroup"}static get type(){return"radiogroup"}static get configurable(){return{defaultType:"radio",clearable:null,name:null,options:{value:null,$config:{merge:"items"}},defaultBindProperty:"value"}}get existingOptions(){const{name:e}=this;return this.ensureItems().filter(t=>t.name===e)}get refPrefix(){return`${this.name||this.ref||this.id}_`}get selected(){return this.existingOptions.filter(e=>e.input.checked)[0]||null}get value(){const{selected:e}=this;return e?e.checkedValue:null}set value(e){this.existingOptions.forEach(t=>{t.isConfiguring=this.isConfiguring,t.checked=t.checkedValue===e,t.isConfiguring=!1})}ensureItems(){return this.getConfig("options"),super.ensureItems()}changeOptions(e,t){if(!(e&&t&&T.isDeeplyEqual(t,e)))return e}convertOption(e,t,i){const r=this,{name:n}=r,s={name:n,type:"radio",value:e===r.value,ref:`${r.refPrefix}${e}`,checkedValue:e};return typeof t=="string"?s.text=t:T.assign(s,t),i?N.reconfigure(i,s):s}isOurRadio(e){return e.isRadio&&e.name===this.name}isolateFieldChange(e){return this.isOurRadio(e)}onChildAdd(e){super.onChildAdd(e),this.isOurRadio(e)&&e.ion({name:e.id,beforeChange:"onRadioItemBeforeChange",change:"onRadioItemChange",click:"onRadioClick",thisObj:this})}onChildRemove(e){this.isOurRadio(e)&&this.detachListeners(e.id),super.onChildRemove(e)}onRadioClick(e){const{source:t}=e;t.checked&&this.clearable&&t.clearable==null&&(t.checked=!1)}onRadioItemBeforeChange(e){if(e.checked){const t=this,{lastValue:i}=t;if(!t.reverting&&t.trigger("beforeChange",t.wrapRadioEvent(e))===!1&&i!=null&&i!==t.value)return t.reverting=!0,e.source.uncheckToggleGroupMembers(),t.value=i,t.lastValue=i,t.reverting=!1,!1}}onRadioItemChange(e){const t=this;e.checked&&!t.reverting&&(t.triggerFieldChange(t.wrapRadioEvent(e)),t.lastValue=t.value)}wrapRadioEvent(e){return{from:e,item:e.source,userAction:e.userAction,lastValue:this.lastValue,value:this.value}}updateOptions(){const e=this,{options:t,refPrefix:i}=e,r=e.existingOptions.reduce((l,d)=>(l[d.ref.substring(i.length)]=d,l),{});let n=0,s,a;if(t)for(s in t)a=e.convertOption(s,t[s],r[s]),delete r[s],e.insert(a,n++);const o=Object.values(r);o!=null&&o.length&&(e.remove(o),o.forEach(l=>l.destroy()))}}lm.initClass();lm._$name="RadioGroup";const y0={ArrowUp:1,ArrowDown:1,ArrowLeft:1,ArrowRight:1};class dm extends N{static get $name(){return"Slider"}static get type(){return"slider"}static get configurable(){return{text:null,showValue:!0,showTooltip:!1,min:0,max:100,step:1,value:50,unit:null,thumbSize:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip",align:"b-t",anchor:!1,axisLock:!0}},localizableProperties:["text"],triggerChangeOnInput:null,defaultBindProperty:"value"}}compose(){const{id:e,min:t,max:i,showValue:r,step:n,text:s,value:a,unit:o="",disabled:l}=this,d=`${e}-input`,u=Boolean(s||r);return{class:{"b-has-label":u,"b-text":u,"b-disabled":l},children:{input:{tag:"input",type:"range",id:d,reference:"input",disabled:l,min:t,max:i,step:n,value:a,listeners:{input:"onInternalInput",change:"onInternalChange",mouseover:"onInternalMouseOver",mouseout:"onInternalMouseOut"}},label:{tag:"label",for:d,html:r?s?`${s} (${a}${o})`:a+o:s}}}}get focusElement(){return this.input}get percentProgress(){return(this.value-this.min)/(this.max-this.min)*100}onInternalKeyDown(e){!this.readOnly&&y0[e.key]&&e.stopImmediatePropagation()}onInternalChange(){this.updateUI(),this.triggerChange(!0),this.trigger("action",{value:this.value})}onInternalInput(){const e=this;if(e.readOnly){e.input.value=e.value;return}e.value=parseInt(e.input.value,10),e.trigger("input",{value:e.value}),e.triggerChangeOnInput&&e.triggerChange(e)}onInternalMouseOver(){var e;const t=this,i=t.rtl?100-t.percentProgress:t.percentProgress;(e=t.tooltip)===null||e===void 0||e.showBy({target:$.from(t.input).inflate(t.thumbSize/2,-t.thumbSize/2),align:`b-t${Math.round(i)}`})}onInternalMouseOut(){var e;(e=this.tooltip)===null||e===void 0||e.hide()}triggerChange(e){this.triggerFieldChange({value:this.value,valid:!0,userAction:e})}updateMax(e){const t=this;t.input&&t._value>e&&(t.value=e,t.trigger("input",{value:t.value}))}updateMin(e){const t=this;t.input&&t._value<e&&(t.value=e,t.trigger("input",{value:t.value}))}changeTooltip(e,t){var i;return e&&(e.owner=this),this.showTooltip?ce.reconfigure(t,e,{owner:this,defaults:{forElement:this.input,html:String(this.value)+((i=this.unit)!==null&&i!==void 0?i:"")}}):null}changeValue(e){const t=this,{min:i,step:r}=t;return e=Math.min(Math.max(e,i),t.max),e>i?i+T.roundTo(e-i,r):T.roundTo(e,r)}updateValue(e){const t=this,{input:i,_tooltip:r}=t;if(r){var n;r.html=t.value+((n=t.unit)!==null&&n!==void 0?n:"")}i&&i.value!==String(e)&&(i.value=e,t.triggerChange(!1)),t.updateUI()}updateUI(){var e,t;const i=this;!((e=i._tooltip)===null||e===void 0)&&e.isVisible&&((t=i._tooltip)===null||t===void 0||t.alignTo({target:$.from(i.input).inflate(i.thumbSize/2,-i.thumbSize/2),align:`b-t${Math.round(i.percentProgress)}`}))}}dm.initClass();dm._$name="Slider";class cm extends Nr{static get $name(){return"SlideToggle"}static get type(){return"slidetoggle"}static get properties(){return{toggledCls:"b-slidetoggle-checked"}}construct(e){e!=null&&e.checked&&(e.cls=(e.cls||"")+" "+this.constructor.properties.toggledCls),super.construct(e)}get innerElements(){const e=super.innerElements;return e.splice(1,0,this.toggleElement),this.text?e[e.length-1].class="b-slidetoggle-label":e.pop(),e}get toggleElement(){return{class:"b-slidetoggle-toggle",reference:"slideToggle",children:[{class:"b-slidetoggle-thumb",reference:"slideThumb"}]}}internalOnChange(){super.internalOnChange(),this.element.classList[this.value?"add":"remove"](this.toggledCls)}}cm.initClass();cm._$name="SlideToggle";const Ah=["b-horizontal","b-vertical"],gl=c=>S.getStyleValue(c.parentElement,"display")==="flex"&&(parseInt(S.getStyleValue(c,"flex-basis"),10)||parseInt(S.getStyleValue(c,"flex-grow"),10)),b0={horizontal:!1,vertical:!0};class um extends N{static get $name(){return"Splitter"}static get type(){return"splitter"}static get configurable(){return{orientation:"auto",vertical:null,containerElement:{$config:"nullify",value:null},nextNeighbor:{$config:"nullify",value:null},previousNeighbor:{$config:"nullify",value:null}}}static get delayable(){return{syncState:"raf"}}doDestroy(){var e;(e=this.mouseDetacher)===null||e===void 0||e.call(this),super.doDestroy()}compose(){return{class:{"b-splitter":1},listeners:F({pointerdown:"onMouseDown",mouseenter:"syncState"},!K.supportsPointerEvents&&{mousedown:"onMouseDown",touchstart:"onMouseDown"})}}get currentOrientation(){return this.vertical?"vertical":"horizontal"}get nextWidget(){return N.fromElement(this.element.nextElementSibling,1)}get previousWidget(){return N.fromElement(this.element.previousElementSibling,1)}updateContainerElement(e){var t;const i=this;i.stateDetector=(t=i.stateDetector)===null||t===void 0?void 0:t.disconnect(),e&&(i.stateDetector=new MutationObserver(()=>i.syncState()),i.stateDetector.observe(e,{attributes:!0,childList:!0}))}updateNextNeighbor(e){this.watchNeighbor(e,"next")}updatePreviousNeighbor(e){this.watchNeighbor(e,"previous")}watchNeighbor(e,t){this.detachListeners(t),e?.ion({name:t,thisObj:this,collapse:"syncState",expand:"syncState",hide:"syncState",show:"syncState"})}updateOrientation(){this.syncState.now()}updateVertical(e){var t;const i=(t=this.element)===null||t===void 0?void 0:t.classList;i?.add(Ah[e?1:0]),i?.remove(Ah[e?0:1])}syncState(){var e;const t=this,{element:i,nextWidget:r,previousWidget:n}=t;let s=(e=b0[t.orientation])!==null&&e!==void 0?e:null;if(t.nextNeighbor=r,t.previousNeighbor=n,t.disabled=r&&(r.collapsible&&r.collapsed||r.hidden)||n&&(n.collapsible&&n.collapsed||n.hidden),s!==null&&r&&n)t.containerElement=null;else if(t.containerElement=i.parentElement,t.rendered&&i.offsetParent){const a=S.getStyleValue(i.parentElement,"flex-direction");if(a)s=!a.startsWith("column");else{const o=i.previousElementSibling,l=i.nextElementSibling;if(!o||!l)return;const d=o.getBoundingClientRect(),u=l.getBoundingClientRect(),h=d.top<u.top?d:u,f=h===u?d:u;s=h.top===f.top}}t.vertical=s}onMouseDown(e){var t;e.preventDefault(),e.touches&&(e=e.touches[0]);const i=this,{element:r}=i,n=r.previousElementSibling,s=r.nextElementSibling,a=gl(n),o=gl(s),l=[];(t=i.mouseDetacher)===null||t===void 0||t.call(i);for(const u of r.parentElement.children)gl(u)&&u!==r&&l.push({element:u,width:u.offsetWidth,height:u.offsetHeight});i.context={startX:e.pageX,startY:e.pageY,prevWidth:n.offsetWidth,prevHeight:n.offsetHeight,nextWidth:s.offsetWidth,nextHeight:s.offsetHeight,prevHasFlex:a,nextHasFlex:o,flexed:l,prev:n,next:s};const d={element:document,pointermove:"onMouseMove",pointerup:"onMouseUp",thisObj:i};K.supportsPointerEvents||(d.mousemove=d.touchmove="onMouseMove",d.mouseup=d.touchend="onMouseUp"),r.classList.add("b-moving"),i.mouseDetacher=B.on(d)}onMouseMove(e){const t=this,{context:i,nextWidget:r,previousWidget:n}=t,s=i.prev.style,a=i.next.style,o=(e.pageX-i.startX)*(t.rtl?-1:1),l=e.pageY-i.startY;if(e.preventDefault(),Object.assign(i,{deltaX:o,deltaY:l}),i.started||(i.started=!0,t.trigger("dragStart",{context:i,event:e}),i.flexed.forEach(d=>{d.element.style.flexGrow=t.vertical?d.width:d.height,d.element.style.flexBasis="0"})),t.vertical){const d=i.prevWidth+o,u=i.nextWidth-o;i.prevHasFlex?s.flexGrow=d:n?n.width=d:s.width=`${d}px`,i.nextHasFlex?a.flexGrow=u:r?r.width=u:a.width=`${u}px`}else{const d=i.prevHeight+l,u=i.nextHeight-l;i.prevHasFlex?s.flexGrow=d:n?n.height=d:s.height=`${d}px`,i.nextHasFlex?a.flexGrow=u:r?r.height=u:a.height=`${u}px`}t.trigger("drag",{context:i,event:e})}onMouseUp(e){var t;const i=this;(t=i.mouseDetacher)===null||t===void 0||t.call(i),i.mouseDetacher=null,i.element.classList.remove("b-moving"),i.context.started&&i.trigger("drop",{context:i.context,event:e}),i.context=null}render(){super.render(...arguments),this.syncState.now(),this.vertical===null&&this.syncState()}}um.initClass();um._$name="Splitter";class ld extends Ft{static get $name(){return"Tab"}static get type(){return"tab"}static get configurable(){return{active:null,index:null,isFirst:null,isLast:null,item:{value:null,$config:"nullify"},itemCls:null,tabPanel:null,titleProperty:"text",titleSource:"title",role:"tab"}}compose(){const{active:e,cls:t,index:i,isFirst:r,isLast:n}=this,s=this.owner.visibleChildCount;return{tabindex:0,"aria-selected":e,"aria-setsize":s,"aria-posinset":i+1,class:F({"b-tabpanel-tab":1,"b-active":e,"b-tab-first":r,"b-tab-last":n},t),dataset:{index:i}}}updateIndex(e){this.isFirst=!e}updateItem(e,t){var i,r;const n=this;t?.tab===n&&(t.tab=null),e&&(e.tab=n,n[n.titleProperty]=e[n.titleSource],n.itemCls=e.cls,n.ariaElement.setAttribute("aria-controls",e.id),e.role="tabpanel"),(i=n.itemChangeDetacher)===null||i===void 0||i.call(n),n.itemChangeDetacher=e&&ve.after(e,"onConfigChange","onItemConfigChange",n,{return:!1}),(r=n.itemHideDetacher)===null||r===void 0||r.call(n),n.itemHideDetacher=e?.ion({beforeChangeHidden:"onItemBeforeChangeHidden",beforeHide:"onItemBeforeHide",beforeUpdateDisabled:"onItemBeforeUpdateDisabled",thisObj:n,prio:1e3}),n.syncMinMax()}updateItemCls(e,t){const{element:i}=this,r=i&&Q.from(i?.classList,!0);i&&(r.remove(t).add(e),i.className=r.value)}updateRotate(e,t){!e!=!t&&this.syncMinMax()}syncMinMax(){const e=this,{rotate:t,tabPanel:i}=e;let{_minWidth:r,_minHeight:n,_maxWidth:s,_maxHeight:a}=e;if(i){const{tabMinWidth:o,tabMaxWidth:l}=i;o!=null&&(t?(r===o&&(r=null),n=o):(n===o&&(n=null),r=o)),l!=null&&(t?(s===l&&(s=null),a=l):(a===l&&(a=null),s=l)),e.minWidth=r,e.minHeight=n,e.maxWidth=s,e.maxHeight=a}}onItemBeforeChangeHidden({source:e,hidden:t}){if(!e.$isDeactivating&&!e.$isActivating){const{tabPanel:i}=this;this.hidden=t,t&&e===i.activeItem&&i.activateAvailableTab(e)}}onItemBeforeHide(){this.item.$isDeactivating||this.hide()}onItemBeforeUpdateDisabled({source:e,disabled:t}){const{tabPanel:i}=this;this.disabled=t,e===i.activeItem&&i.activateAvailableTab(e)}onItemConfigChange({name:e,value:t}){e===this.titleSource&&(this[this.titleProperty]=t)}}ld.initClass();ld._$name="Tab";const Ys=c=>c.isTab;class hm extends $r{static get $name(){return"TabBar"}static get type(){return"tabbar"}static get configurable(){return{defaultType:"tab",overflow:"scroll",role:"tablist",ignoreParentReadOnly:!0}}get firstTab(){return this.tabAt(0)}get lastTab(){return this.tabAt(-1)}get tabCount(){return this._items.countOf(Ys)}get tabs(){return W.from(this._items,Ys)}compose(){return{children:{toolbarContent:{class:{"b-tabpanel-tabs":1}}}}}indexOfTab(e){return this._items.indexOf(e,Ys)}onChildAdd(e){super.onChildAdd(e),e.index==null&&this.syncTabs()}onChildRemove(e){super.onChildRemove(e),this.syncTabs()}onFocusIn(){const{activeIndex:e}=this.owner;isNaN(e)||this.tabs[e].focus()}syncTabs(){const{tabs:e}=this;for(let t=0,i=e.length;t<i;++t)e[t].index=t,e[t].isFirst=!t,e[t].isLast=t===i-1}tabAt(e){return this._items.find(Ys,e)||null}}hm.initClass();hm._$name="TabBar";const Gs=["b-slide-out-left","b-slide-out-right","b-slide-in-left","b-slide-in-right"];class Xn extends Xt{onChildAdd(e){super.onChildAdd(e);const t=this,{activeItem:i,owner:r}=t,n=r.activeIndex!=null?r.activeIndex:t.activeIndex||0,s=r.items.indexOf(e),a=i!=null?e===i:s===n;e.ion({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:t}),a?(t._activeIndex=s,t._activeItem=e,e.show()):(e.$isDeactivating=!0,e.hide(),e.$isDeactivating=!1)}onChildRemove(e){super.onChildRemove(e);const t=this;t._activeItem===e&&t.activateSiblingOf(e),t._activeIndex=t.owner.items.indexOf(t._activeItem),e.un({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:t})}onBeforeChildShow({source:e}){if(!this.owner.isConfiguring&&!e.$isActivating)return this.activeItem=e,!1}onBeforeChildHide({source:e}){if(!this.owner.isConfiguring&&!e.$isDeactivating)return this.activateSiblingOf(e),!1}activateSiblingOf(e){const{owner:t}=this,i=t.items.slice(),r=i.indexOf(e);i.splice(r,1),this.activeIndex=Math.min(r,i.length-1)}setActiveItem(e,t=this.activeIndex,i){const r=this,{owner:n}=r,{items:s}=n,a=e instanceof N,o=s[t],l=n.items[e=a?s.indexOf(e):parseInt(e,10)],d=i?.animation!==!1,u=!(i!=null&&i.silent),h={prevActiveIndex:t,prevActiveItem:o};if(l&&!l.$isActivating&&l!==o){var f;const g=o&&o.element,m=l&&l.element;if(r.animateDetacher){const v=r.animateDetacher.event;if(v.activeItem===l)return v.promise;r.animateDetacher(),v.prevActiveItem.element.classList.remove(...Gs),v.activeItem.element.classList.remove(...Gs),r.animateDetacher=null}if(h.activeIndex=e,h.activeItem=l,u&&n.trigger("beforeActiveItemChange",h)===!1)return null;const p=r._activeIndex!==h.activeIndex;p&&(r._activeIndex=h.activeIndex),u&&((f=n.onBeginActiveItemChange)===null||f===void 0||f.call(n,h)),p&&(r._activeIndex=h.prevActiveIndex),d&&g&&n.isVisible&&r.animateCardChange?h.promise=r.cardChangeAnimation=new Promise((v,y)=>{const C=o.monitorResize;o.monitorResize=!1,r.contentElement.style.overflowX="hidden",o._hidden=!0,l.$isActivating=!0,l.show(),l.$isActivating=!1,g.classList.add(e>t?"b-slide-out-left":"b-slide-out-right"),m.classList.add(e<t?"b-slide-in-left":"b-slide-in-right"),n.isAnimating=!0,r.animateDetacher=B.onTransitionEnd({mode:"animation",element:m,thisObj:o,handler(){if(n.isAnimating=r.cardChangeAnimation=!1,!r.animateDetacher){r.setActiveItem(e,t,i);return}r.animateDetacher=null,m.classList.remove(...Gs),g&&(g.classList.remove(...Gs),o.$isDeactivating=!0,o._hidden=!1,o.hide(),o.monitorResize=C,o.$isDeactivating=!1),r.contentElement.style.overflowX="",r.onActiveItemChange(h,v,!u)}}),r.animateDetacher.reject=y,r.animateDetacher.event=h}):(l.$isActivating=!0,l.show(),l.focus(),l.$isActivating=!1,o&&(o.$isDeactivating=!0,o.hide(),o.$isDeactivating=!1),r.onActiveItemChange(h,null,!u))}return h}onActiveItemChange(e,t,i){const r=this;r._activeItem=e.activeItem,r._activeIndex=e.activeIndex,!i&&r.owner.trigger("activeItemChange",e),e.activeItem.focus(),t?.(e)}renderChildren(){const{owner:e}=this;e.contentElement.classList.toggle(this.hideChildHeaderCls,e.suppressChildHeaders),super.renderChildren()}changeActiveIndex(e){const{owner:t}=this;return t.isConfiguring&&!t._items?e:Math.min(e,t.items.length-1)}updateActiveIndex(e,t){this.owner.isConfiguring||this.setActiveItem(e,t)}updateActiveItem(e){this.owner.isConfiguring||this.setActiveItem(e,this.activeIndex)}get isChangingCard(){return Boolean(this.animateDetacher)}}M(Xn,"$name","Card");M(Xn,"type","card");M(Xn,"configurable",{containerCls:"b-card-container",itemCls:"b-card-item",hideChildHeaderCls:"b-hide-child-headers",animateCardChange:!0,activeItem:null,activeIndex:null});Xn.initClass();Xn._$name="Card";class fm extends Ye{static get $name(){return"TabPanel"}static get type(){return"tabpanel"}static get alias(){return"tabs"}static get configurable(){return{activeTab:0,animateTabChange:!0,autoHeight:!1,defaultType:"container",focusable:!1,itemCls:"b-tabpanel-item",layout:{type:"card"},suppressChildHeaders:!0,tabBar:{type:"tabbar",weight:-2e3},tabMinWidth:null,tabMaxWidth:null}}get activeIndex(){return this.layout.activeIndex}get activeItem(){return this.layout.activeItem}get activeTabItemIndex(){var e;const{activeTab:t,items:i,tabBar:r}=this;return i.indexOf((e=r.tabs[t])===null||e===void 0?void 0:e.item)}get bodyConfig(){return T.merge({className:{"b-tabpanel-body":1}},super.bodyConfig)}get focusElement(){var e;const t=this.items[this.activeTab||0];return t?.focusElement||(t==null||(e=t.tab)===null||e===void 0?void 0:e.focusElement)}get tabPanelBody(){return this.bodyElement}finalizeInit(){super.finalizeInit();const e=this,{activeTab:t,layout:i}=e,{activeIndex:r}=i,{tabs:n}=e.tabBar,s=t>=0&&t<n.length&&e.items.indexOf(n[t].item);if(n.length>0&&(s===!1||s<0))throw new Error(`Invalid activeTab ${t} (${n.length} tabs)`);s!==r&&i.setActiveItem(s,r,{animation:!1,silent:!0}),i.animateCardChange=e.animateTabChange}onChildAdd(e){if(super.onChildAdd(e),!this.initialItems){const t=this,{tabBar:i}=t,r=t.makeTabConfig(e),n=r&&i?.firstTab,s=n&&i._items,a=n&&W.from(t._items,l=>l.tab||l===e),o=n?a.indexOf(e)+s.indexOf(n):0;r&&i&&(n&&e.weight==null&&o<s.count-1?i.insert(r,o):i.add(r))}}onChildRemove(e){const{tab:t}=e,{items:i}=this;t&&(this.tabBar.remove(t),t.destroy()),e===this.activeItem&&(this._activeTab=null,i.length&&(this.activeTab=i[Math.min(this.activeIndex,i.length-1)])),super.onChildRemove(e)}isDisabledOrHiddenTab(e){const{tabs:t}=this.tabBar,i=t?.[e];return i&&(i.disabled||i.hidden)}findAvailableTab(e,t=1){const{tabs:i}=this.tabBar,r=i.length,n=Math.max(0,i.indexOf(e.tab));n&&(t=-t);let s;for(let a=1;a<=r&&(s=(n+(t<0?r:0)+a*t)%r,!!this.isDisabledOrHiddenTab(s));++a);return s}activateAvailableTab(e,t=1){this.activeTab=this.findAvailableTab(e,t)}changeActiveTab(e,t){const i=this,{tabBar:r,layout:n}=i,{tabCount:s}=r;if(e.isWidget||T.isObject(e)?(i.items.indexOf(e)===-1&&(e=i.add(e)),e=r.indexOfTab(e.tab)):e=parseInt(e,10),!i.initialItems&&s>0&&(e<-1||e>=s))throw new Error(`Invalid activeTab ${e} (${s} tabs)`);if(i.isDisabledOrHiddenTab(e)&&(e=i.findAvailableTab(e)),n.animateCardChange&&n.cardChangeAnimation)n.cardChangeAnimation.then(a=>{a?.activeIndex!==e&&(i._activeTab=e,i.updateActiveTab(e,t))});else return e}async updateActiveTab(){if(!this.initialItems){const{activeTabItemIndex:t,layout:i}=this;if(t>-1){var e;i.animateCardChange&&await this.tabSelectionPromise,this.tabSelectionPromise=(e=i.setActiveItem(this.items[t]))===null||e===void 0?void 0:e.promise}}}changeTabBar(e){return this.getConfig("strips"),this.strips={tabBar:e},this.strips.tabBar}makeTabConfig(e){const{tab:t}=e,i={item:e,type:"tab",tabPanel:this,disabled:Boolean(e.disabled),hidden:e.initialConfig.hidden,weight:e.weight||0,internalListeners:{click:"onTabClick",thisObj:this},localizableProperties:{text:!1}};return t===!1?null:T.isObject(t)?ld.mergeConfigs(i,t):i}updateItems(e,t){const i=this,{activeTab:r,initialItems:n}=i;let s=0,a;super.updateItems(e,t),n&&(a=Array.from(e,o=>i.makeTabConfig(o)).filter(o=>{if(o)return o.index=s++,!0}),s&&(a[0].isFirst=!0,a[s-1].isLast=!0,a[r].active=!0,i.tabBar.add(a),i.activeTab=r))}updateTabMinWidth(e){var t;(t=this.tabBar)===null||t===void 0||t.items.forEach(i=>{i.isTab&&(i.minWidth=e)})}updateTabMaxWidth(e){var t;(t=this.tabBar)===null||t===void 0||t.items.forEach(i=>{i.isTab&&(i.maxWidth=e)})}updateAutoHeight(e){this.detachListeners("themeAutoHeight"),e&&ue.ion({name:"themeAutoHeight",theme:"internalOnThemeChange",thisObj:this}),this.$measureHeight=e}applyAutoHeight(){const e=this,{layout:t,activeTab:i,element:r}=e,{animateCardChange:n}=t;t.animateCardChange=!1,e.height=null,e.height=Math.max(...e.items.map(s=>(e.activeTab=s,r.clientHeight)))+1,e.activeTab=i,t.animateCardChange=n,e.$measureHeight=!1}internalOnThemeChange(){this.isVisible?this.applyAutoHeight():this.$measureHeight=!0}onBeginActiveItemChange(e){const t=this.tabBar.tabs,{activeItem:i,prevActiveItem:r}=e;this.activeTab=t.indexOf(i?.tab),r!=null&&r.tab&&(r.tab.active=!1),i!=null&&i.tab&&(i.tab.active=!0,i.tab.show())}onBeforeActiveItemChange(e){return this.trigger("beforeTabChange",e)}onActiveItemChange(e){this.trigger("tabChange",e)}onTabClick(e){this.activeTab=e.source.item}onPaint(){super.onPaint(...arguments),this.$measureHeight&&this.applyAutoHeight()}}fm.initClass();fm._$name="TabPanel";class gm extends Oe{static get $name(){return"TextAreaField"}static get type(){return"textareafield"}static get alias(){return"textarea"}static get configurable(){return{resize:"none",inputAttributes:{tag:"textarea"}}}updateResize(e){this.input.style.resize=e}}gm.initClass();gm._$name="TextAreaField";class Ba extends Gn{static get $name(){return"TextAreaPickerField"}static get type(){return"textareapickerfield"}static get configurable(){return{picker:{type:"widget",tag:"textarea",cls:"b-textareapickerfield-picker",scrollAction:"realign",align:{align:"t-b",axisLock:!0},autoShow:!1},triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},resize:"none",inputType:null}}startConfigure(e){typeof e.inline=="boolean"&&ae.deprecate("Core","6.0.0","TextAreaPickerField.inline config is no longer supported"),super.startConfigure(e)}get inputElement(){const e=super.inputElement;return e.readOnly="readonly",e.reference="displayElement",this.ariaElement="displayElement",e}get focusElement(){var e;return(e=this._picker)!==null&&e!==void 0&&e.isVisible?this.input:this.displayElement}get needsInputSync(){var e;return this.displayElement[this.inputValueAttr]!==String((e=this.inputValue)!==null&&e!==void 0?e:"")}showPicker(){const e=this,{picker:t}=e;e.inline||(t.width=e.pickerWidth||e[e.pickerAlignElement].offsetWidth,super.showPicker(!0))}focusPicker(){this.input.focus()}onPickerKeyDown(e){const t=this,i=t.input;switch(e.key.trim()||e.code){case"Escape":t.picker.hide();return;case"Enter":e.ctrlKey&&(t.syncInputFieldValue(),t.picker.hide());break}t.input=t.displayElement;const r=super.onPickerKeyDown(e);return t.input=i,r}syncInputFieldValue(e){this.displayElement&&(this.displayElement.value=this.inputValue),super.syncInputFieldValue(e)}changeValue(e){return e??""}changePicker(e,t){var i,r;const n=this,s=n.pickerWidth||((i=e)===null||i===void 0?void 0:i.width);if(e=Ba.reconfigure(t,e?U.merge({owner:n,forElement:n[n.pickerAlignElement],align:{matchSize:s==null,anchor:n.overlayAnchor,target:n[n.pickerAlignElement]},id:n.id+"-input",style:{resize:n.resize},html:(r=n.value)!==null&&r!==void 0?r:""},e):null,n),e){const a=n.input=e.element;n.inputListenerRemover=B.on({element:a,thisObj:n,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput",keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}return e}}Ba.initClass();Ba._$name="TextAreaPickerField";var C0=c=>{var e;return e=class extends(c||P){compose(){const{minified:i}=this;return{class:{"b-minified":i}}}get widgetClass(){}},M(e,"$name","Minifiable"),M(e,"configurable",{minifiable:!0,minified:null}),e};const w0=[],S0=c=>c[0]!=="*",Lh=(c,e)=>{const t=c[e]||null;return delete c[e],t},D0=c=>c.responsiveRoot,Oh={number:c=>({width:e})=>e<=c&&c},Ph=c=>(delete c.once,{callback:Lh(c,"callback"),configs:c,when:Lh(c,"when")}),$h=(c,...e)=>{const t=e.flatMap(n=>n?.once||w0),i=c.mergeConfigs(...e),r=Ph(i);return r.once=t.length?Ph(c.mergeConfigs(...t)):null,r},E0=(c,e)=>{let t,i=Proxy.revocable(c,{get(s,a){return t&&(t[a]=!0),c[a]}}),r=ve.after(c,"onConfigChange",(s,{name:a})=>{var o;(o=t)!==null&&o!==void 0&&o[a]&&e()}),n=c.ion({resize:()=>{e()}});return c.monitorResize=!0,{widget:c,get object(){var s;return(s=i)===null||s===void 0?void 0:s.proxy},destroy(){i&&(i.revoke(),r(),n(),i=r=n=null)},reset(){t=Object.create(null)}}};var Zn=c=>{var e;return e=class extends(c||P).mixin(he,Wg){get isResponsivePending(){return this.responsiveUpdateCount===0&&this.hasConfig("responsive")}get isResponsiveUpdating(){var i;return this._responsiveUpdating||((i=this.responsiveWidget)===null||i===void 0?void 0:i._responsiveUpdating)}updateResponsive(i){const r=this,n=r.constructor,{responsiveDefaults:s}=r,a=Array.from(new Set(T.keys(i).concat(T.keys(s)))).filter(S0);let o=null,l,d,u,h;if(i){o={"*":$h(n,s["*"],i["*"])};for(d of a)if(u=i[d],u!==null&&u!==!1){var f;l=l||u&&"when"in u,o[d]=$h(n,s["*"],s[d],i["*"],u),h=o[d].when,o[d].when=((f=Oh[typeof h])===null||f===void 0?void 0:f.call(Oh,h))||h}}r.$responsiveStates=o,r.$responsiveWhen=l,r.syncResponsiveWidget()}updateResponsiveState(i,r){var n;const s=this,{$responsiveStates:a}=s,o=++s.responsiveStateChanges===1,l=(n=s.element)===null||n===void 0?void 0:n.classList,d=a["*"],u=a[i]||d,h=o&&(u.once||d.once),f=o&&s.isStateful,g=s.responsiveWidget;let m=u.configs,p=h?.configs;p&&(m=m?s.constructor.mergeConfigs(m,p):p),r&&l?.remove(`b-responsive-${r.toLowerCase()}`),i&&l?.add(`b-responsive-${i.toLowerCase()}`),f&&(p=s.loadStatefulData(),p&&(m=m?s.constructor.mergeConfigs(m,p):p),s.suspendStateful()),s._responsiveUpdating=!0;try{var v,y,C,D;(v=s.trigger)===null||v===void 0||v.call(s,"beforeResponsiveStateChange",{state:i,oldState:r,target:g}),m&&s.setConfig(m),(y=u.callback)===null||y===void 0||y.call(u,{source:s,state:i,oldState:r,target:g,initial:o}),h==null||(C=h.callback)===null||C===void 0||C.call(h,{source:s,state:i,oldState:r,target:g,initial:o}),(D=s.trigger)===null||D===void 0||D.call(s,"responsiveStateChange",{state:i,oldState:r,target:g})}finally{s._responsiveUpdating=!1,f&&s.resumeStateful()}}get responsiveTarget(){return this.responsiveWidget||this._responsiveTarget}updateResponsiveTarget(){this.syncResponsiveWidget()}updateResponsiveWidget(i){var r;const n=this,s=i&&n.responsiveUpdate;(r=n.$responsiveWrapper)===null||r===void 0||r.destroy(),n.$responsiveWrapper=i&&E0(i,s),s?.now()}responsiveUpdate(){const i=this,{$responsiveStates:r,$responsiveWrapper:n}=i,s=n?.widget;if(r&&n){let a=null,o=0,l=r,d,u;s&&s!==i&&!i.$responsiveWhen&&(s.getConfig("responsive"),l=s.$responsiveStates||l),n.reset();for(u in r)u!=="*"&&(d=l[u].when(n.object,K),d!=null&&d!==!1&&(!a||d<o)&&(a=u,o=d));++i.responsiveUpdateCount,i.responsiveState=a}}syncResponsiveWidget(){const i=this;let r=null,n;if(!i.isDestroying&&i.responsive){if(n=i.responsiveTarget,r=n){if(typeof n=="string"&&(r=n==="@"?i:n[0]==="@"?i[n.substring(1)]:i.up(n),!r))throw new Error(`No match for responsiveTarget="${n}"`)}else{var s;r=!i.responsiveRoot&&((s=i.up)===null||s===void 0?void 0:s.call(i,D0))||i}if(!r.isWidget)throw new Error(`${r.constructor.$$name} is not a widget and cannot be a responsiveTarget`)}return i.responsiveWidget=r,r}changeBreakpoints(i){return T.assertObject(i,"breakpoints"),i!=null&&i.width&&Object.keys(i.width).forEach(r=>{i.width[r].maxWidth=r}),i!=null&&i.height&&Object.keys(i.height).forEach(r=>{i.height[r].maxHeight=r}),i}updateBreakpoints(i){i&&(this.monitorResize=!0)}getBreakpoint(i,r){const n=Object.keys(i).map(a=>parseInt(a)).sort(),s=n.find(a=>r<=a);return i[s??(i["*"]&&"*")]}activateBreakpoint(i,r){const n=this,s=n[`current${i}Breakpoint`];if(r!==s){var a,o;n[`current${i}Breakpoint`]=r,n.setConfig(r.configs),s&&n.element.classList.remove(`b-breakpoint-${s.name.toLowerCase()}`),n.element.classList.add(`b-breakpoint-${r.name.toLowerCase()}`),n.trigger(`responsive${i}Change`,{breakpoint:r,prevBreakpoint:s}),(a=r.callback)===null||a===void 0||a.call(r,{source:n,breakpoint:r,prevBreakpoint:s}),(o=n.recompose)===null||o===void 0||o.call(n)}}applyResponsiveBreakpoints(i,r){var n;const s=this,{width:a,height:o}=(n=s.breakpoints)!==null&&n!==void 0?n:{};if(a){const l=s.getBreakpoint(a,i);s.activateBreakpoint("Width",l)}if(o){const l=s.getBreakpoint(o,r);s.activateBreakpoint("Height",l)}}onInternalResize(i,r,n,s,a){super.onInternalResize(i,r,n,s,a),this.applyResponsiveBreakpoints(r,n)}},M(e,"$name","Responsive"),M(e,"configurable",{responsive:{$config:{lazy:"paint"},value:null},responsiveDefaults:{small:{when:400},medium:{when:800},large:{when:()=>1/0},"*":{}},responsiveRoot:null,responsiveState:null,responsiveTarget:{value:null,$config:{lazy:"paint"}},responsiveWidget:{value:null,$config:{nullify:!0}},breakpoints:null}),M(e,"delayable",{responsiveUpdate:"raf"}),M(e,"fenced",{syncResponsiveWidget:!0}),M(e,"prototypeProperties",{responsiveStateChanges:0,responsiveUpdateCount:0}),e};const gr="http://www.w3.org/2000/svg",x0={bar:1,outline:2,text:3},R0=(c,e)=>parseInt(c.dataset.order,10)-parseInt(e.dataset.order,10),T0=c=>c.field,M0=()=>!1;class mm extends N{static get type(){return"histogram"}static get $name(){return"Histogram"}static get defaultConfig(){return{data:null,values:null,series:null,topValue:null,element:{children:[{ns:gr,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:gr,tag:"g",reference:"scaledSvgGroup"},{ns:gr,tag:"g",reference:"unscaledSvgGroup"}]}]},omitZeroHeightBars:null,monitorResize:!0,getRectClass:null,getBarTip:null,getBarText:null,getBarTextRenderData:null,getBarTextTip:null}}construct(e){super.construct(e),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}set tip(e){var t;const i=this;(t=i.tip)===null||t===void 0||t.destroy(),e?i._tip=ce.new({owner:i,forElement:i.svgElement,forSelector:"rect",internalListeners:{beforeShow:"up.onBeforeTipShow"}},e):i._tip=null}onElementResize(){super.onElementResize(...arguments);const e=this.svgElement.getBoundingClientRect();this.scaledSvgGroup.setAttribute("transform",`scale(${e.width} ${e.height})`)}onBeforeTipShow({source:e}){const t=parseInt(e.activeTarget.dataset.index);e.html=e.contentTemplate({histogram:this,index:t})}set series(e){const t=this,i=t._series={};for(const r in e)if(e[r]!==!1){const n=i[r]=Object.assign({},e[r]);!n.type&&e[r].type&&(n.type=e[r].type),!n.field&&e[r].field&&(n.field=e[r].field),"order"in i||(n.order=x0[n.type]),n.id=r}t.scheduleRefresh()}get series(){return this._series}set data(e){const t=this;if(t._data=e,!t.topValue){const i=Object.values(t.series).map(T0);for(let r=0,{length:n}=e;r<n;r++)for(let s=0,{length:a}=i;s<a;s++)t.topValue=Math.max(t.topValue||0,e[r][i[s]])}t.scheduleRefresh()}get data(){return this._data}set topValue(e){this._topValue=e,this.scheduleRefresh()}get topValue(){return this._topValue}scheduleRefresh(){}refresh(){const e=this,{series:t,_tip:i}=e,r=[];for(const n in t){const s=t[n],a=e[`draw${z.capitalize(s.type)}`](s);Array.isArray(a)?r.push.apply(r,a):r.push(a)}r.sort(R0),Z.syncChildren({domConfig:{children:r},configEquality:M0},e.scaledSvgGroup),Z.syncChildren({domConfig:{children:e.drawText()}},e.unscaledSvgGroup),i&&i.isVisible&&e.onBeforeTipShow({source:i})}drawBar(e){const t=this,{topValue:i,data:r,omitZeroHeightBars:n,barStyle:s}=t,{field:a,order:o}=e,l=1/r.length,d=[];let u;for(let h=0,f=0,{length:g}=r;h<g;h++,f+=u){const m=r[h],p=m[a],v=m.height||(p>i?i:p)/i,y=1-v,C=m.rectConfig={ns:gr,tag:"rect",dataset:{}},D=t.callback("getBarTip",t,[e,C,m,h]);u=m.width||l,s?C.style=s:delete C.style,Object.assign(C.dataset,{index:h,order:o}),Object.assign(C,{x:f,y,width:u,height:v,class:t.callback("getRectClass",t,[e,C,m,h])}),D?C.dataset.btip=D:delete C.dataset.btip,(v||!n)&&d.push(C)}return d}drawOutline(e){const t=this,{topValue:i,data:r}=t,{field:n,order:s}=e,a=1/r.length,o=["M 0,1"],l=e.outlineElement||(e.outlineElement={ns:gr,tag:"path",dataset:{order:s}});let d,u="M",h="L";for(let f=0,g=0,{length:m}=r;f<m;f++){const p=1-r[f][n]/i;d=r[f].width||a,o.push(`${u} ${g},${p} ${h} ${g+=d},${p}`),u=h=""}return l.d=o.join(" "),l}drawText(){const e=this,{data:t}=e,i=1/t.length,r="100%",n=[];for(let s=0,a,o=0,{length:l}=t;s<l;s++,o+=a){a=t[s].width||i;const d=e.callback("getBarText",e,[t[s],s]);if(d){const u=e.callback("getBarTextRenderData",e,[{ns:gr,tag:"text",className:"b-bar-legend",html:d,x:`${(o+a/2)*100}%`,y:t[s].y!==void 0?t[s].y:r,dataset:{index:s}},t[s],s]),h=e.callback("getBarTextTip",e,[u,t[s],s]);h?u.dataset.btip=h:delete u.dataset.btip,n.push(u)}}return n}getBarText(e,t){return""}getBarTextRenderData(e,t,i){return e}getBarTip(e,t,i,r){}getBarTextTip(e,t,i){}getRectClass(e,t,i,r){return""}}mm.initClass();mm._$name="Histogram";const pn="http://www.w3.org/2000/svg";class pm extends N{static get type(){return"scale"}static get $name(){return"Scale"}static get configurable(){return{scalePoints:null,scaleMaxPadding:.1,horizontal:!1,align:{value:!1,$config:{merge:"replace"}},element:{children:[{ns:pn,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:pn,tag:"g",reference:"scaledSvgGroup",children:[{ns:pn,tag:"path",reference:"pathElement"}]},{ns:pn,tag:"g",reference:"unscaledSvgGroup"}]}]},monitorResize:!0}}construct(e){super.construct(e),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}changeAlign(e){return e||(e=this.horizontal?"bottom":"right"),e}updateAlign(e,t){this.element.classList.remove(`b-align-${t}`),this.element.classList.add(`b-align-${e}`)}updateHorizontal(e,t){this.element.classList.remove(`b-scale-${t?"horizontal":"vertical"}`),this.element.classList.add(`b-scale-${e?"horizontal":"vertical"}`)}onElementResize(){super.onElementResize(...arguments),this.scheduleRefresh()}scheduleRefresh(){}refresh(){const e=this,{horizontal:t,width:i,height:r,align:n,scalePoints:s,scaleMaxPadding:a}=e,o=s[s.length-1].value,l=[],d=[],u=1/(o+a*o);e.scaledSvgGroup.setAttribute("transform",`scale(${t?i:1} ${t?1:r})`);for(const h of s){const f=Boolean(h.text),g=u*h.value;if(f){const m={ns:pn,tag:"text",className:"b-scale-tick-label",html:h.text,dataset:{tick:h.value}};t?(m.x=`${g*100}%`,m.y=n==="top"?"1.6em":r-12):(m.x=n==="left"?"12":`${i-12}`,m.y=`${(1-g)*100}%`),d.push(m)}t?n==="top"?l.push(`M${g},0 L${g},${f?10:5}`):l.push(`M${g},${r} L${g},${r-(f?10:5)}`):n==="left"?l.push(`M0,${1-g} L${f?10:5},${1-g}`):l.push(`M${i},${1-g} L${i-(f?10:5)},${1-g}`)}e.pathElement.setAttribute("d",l.join("")),Z.syncChildren({domConfig:{children:d}},e.unscaledSvgGroup)}}pm.initClass();pm._$name="Scale";class Di extends P{static get $name(){return"AvatarRendering"}static get configurable(){return{element:null,colorPrefix:"b-sch-",tooltip:null,size:null}}doDestroy(){var e;(e=this.tooltip)===null||e===void 0||e.destroy(),super.doDestroy()}updateElement(e){B.on({element:e,delegate:".b-resource-image",error:"onImageErrorEvent",thisObj:this,capture:!0})}changeTooltip(e){return ce.new({forElement:this.element,forSelector:".b-resource-avatar",cls:"b-resource-avatar-tooltip"},e)}static get failedUrls(){return this._failedUrls||(this._failedUrls=new Set),this._failedUrls}getResourceAvatar({initials:e,color:t,iconCls:i,imageUrl:r,defaultImageUrl:n,dataset:s={},resourceRecord:a,alt:o=z.encodeHtml(a?.name)}){return this.getImageConfig(e,t,r,n,s,o)||this.getIconConfig(i,s)||this.getResourceInitialsConfig(e,t,s)}getImageConfig(e,t,i,r,n,s){const{size:a}=this;if(i=Di.failedUrls.has(i)?r:i||r,i)return F(F({tag:"img",draggable:"false",loading:"lazy",class:{"b-resource-avatar":1,"b-resource-image":1}},a?{style:{height:a+"px",width:a+"px"}}:void 0),{},{alt:s,elementData:{defaultImageUrl:r,imageUrl:i,initials:e,color:t,dataset:n},src:i,dataset:n})}getIconConfig(e,t){if(e)return e&&{tag:"i",class:{"b-resource-avatar":1,"b-resource-icon":1,[e]:1},dataset:t}}getResourceInitialsConfig(e,t,i){const{size:r}=this,n=S.isNamedColor(t)&&t,s=!n&&t;return{tag:"div",class:{"b-resource-avatar":1,"b-resource-initials":1,[`${this.colorPrefix}${n}`]:n},style:F({backgroundColor:s||null},r?{height:r+"px",width:r+"px"}:void 0),children:[e],dataset:i}}onImageErrorEvent({target:e}){if(!e.matches(".b-resource-avatar"))return;const{defaultImageUrl:t,initials:i,color:r,imageUrl:n,dataset:s}=e.elementData;if(t&&!e.src.endsWith(t.replace(/^[./]*/gm,"")))e.src=t;else{const a=S.createElement(this.getResourceInitialsConfig(i,r,s));a.elementData=e.elementData,e.parentElement.replaceChild(a,e)}Di.failedUrls.add(n)}}Di._$name="AvatarRendering";window&&!window.bryntum&&(window.bryntum={});class ne{constructor(e){if(e){if(e.isLocation)return e;if(e.nodeType===Node.ELEMENT_NODE){const t=N.fromElement(e,"gridbase"),i=t&&e.closest(t.focusableSelector);if(i){const{dataset:r}=i.parentNode;this.init({grid:t,rowIndex:t.store.includes(r.id)?t.store.indexOf(r.id):r.index||-1,columnId:i.dataset.columnId}),this.initialTarget=e}}else this.init(e)}}init(e){var t;const i=this,r=i.grid=e.grid,{store:n,columns:s}=r,{visibleColumns:a}=s;if(e.target&&(i.actionTargets=[i._target=e.target]),e.record)i._id=e.record.id;else if("id"in e)i._id=e.id,e.id==null&&(i._rowIndex=-1);else{var o;const l=isNaN(e.row)?isNaN(e.rowIndex)?NaN:e.rowIndex:e.row;i._rowIndex=Math.max(Math.min(Number(l),n.count-1),r.hideHeaders?0:-1),i._id=(o=n.getAt(i._rowIndex))===null||o===void 0?void 0:o.id}if("_rowIndex"in i||(i._rowIndex=n.indexOf(i.id)),i.isSpecialRow=(t=i.record)===null||t===void 0?void 0:t.isSpecialRow,"columnId"in e)i._column=s.getById(e.columnId);else if("field"in e)i._column=s.get(e.field);else{const l=isNaN(e.column)?isNaN(e.columnIndex)?NaN:e.columnIndex:e.column;isNaN(l)?i._column="column"in e?isNaN(e.column)?e.column:a[e.column]:a[0]:(i._columnIndex=Math.min(Number(l),a.length-1),i._column=a[i._columnIndex])}"_columnIndex"in i||(i._columnIndex=a.indexOf(i._column))}get isLocation(){return!0}equals(e,t=!1){const i=this;return e?.isLocation&&e.grid===i.grid&&(t?i.id===e.id&&i._column===e._column:e.record===i.record&&e.column===i.column&&e.target===i.target)}get rowIndex(){const{_id:e}=this,{store:t}=this.grid;return t.includes(e)?t.indexOf(e):Math.min(this._rowIndex,t.count-1)}get visibleRowIndex(){const{rowManager:e}=this.grid,{rowIndex:t}=this;return t===-1?t:Math.max(Math.min(t,e.lastFullyVisibleTow.dataIndex),e.firstFullyVisibleTow.dataIndex)}get isSelectable(){return this.grid.store.includes(this._id)&&!this.isSpecialRow}get record(){if(this._rowIndex>-1){const{store:e}=this.grid;return e.includes(this._id)?e.getById(this._id):e.getAt(this._rowIndex)}}get id(){return this._id}get column(){const{visibleColumns:e}=this.grid.columns;return e!=null&&e.includes(this._column)?this._column:e?.[this.columnIndex]}get columnId(){var e;return(e=this.column)===null||e===void 0?void 0:e.id}get columnIndex(){var e;return Math.min(this._columnIndex,((e=this.grid.columns.visibleColumns)===null||e===void 0?void 0:e.length)-1)}move(e){const t=this,{record:i,column:r,grid:n}=t,{store:s}=n,a=n.columns.visibleColumns,o=new ne;let l=s.includes(i)?s.indexOf(i):t.rowIndex,d=a.includes(r)?a.indexOf(r):t.columnIndex;const u=n.hideHeaders?0:-1,h=s.count-1,f=a.length-1,g=l===u,m=l===h,p=d===0,v=d===f;switch(e){case ne.PREV_CELL:p?g||(d=f,l--):d--;break;case ne.NEXT_CELL:v?m||(d=0,l++):d++;break;case ne.UP:g||l--;break;case ne.DOWN:m||(l===-1?l=n.rowManager.firstFullyVisibleRow.dataIndex:l++);break;case ne.FIRST_COLUMN:d=0;break;case ne.LAST_COLUMN:d=f;break;case ne.FIRST_CELL:l=u,d=0;break;case ne.LAST_CELL:l=h,d=f;break;case ne.PREV_PAGE:l=Math.max(u,l-Math.floor(n.scrollable.clientHeight/n.rowHeight));break;case ne.NEXT_PAGE:l=Math.min(h,l+Math.floor(n.scrollable.clientHeight/n.rowHeight));break}return o.init({grid:n,rowIndex:l,columnIndex:d}),o}get cell(){const e=this,{grid:t,id:i,_cell:r}=e;if(r)return r;if(i==null){var n;return(n=t.columns.getById(e.columnId))===null||n===void 0?void 0:n.element}else{const{row:a}=e;if(a){var s;return a.getCell(e.columnId)||a.getCell((s=t.columns.getAt(e.columnIndex))===null||s===void 0?void 0:s.id)}}}get row(){return this.grid.getRowById(this.id)||this.grid.getRow(this.rowIndex)}get target(){const{cell:e,_target:t}=this,{focusableFinder:i}=this.grid;if(e)return t||(i.currentNode=this.grid.focusableFinderCell=e,i.nextNode()||e)}get isActionable(){const{cell:e,_target:t}=this,i=e?.compareDocumentPosition(S.getActiveElement(e))&Node.DOCUMENT_POSITION_CONTAINED_BY;return Boolean(i||t&&t!==this.cell)}get isColumnHeader(){return this.cell&&this.rowIndex===-1}get isCell(){return this.cell&&this.record}}ne.UP=1;ne.NEXT_CELL=2;ne.DOWN=3;ne.PREV_CELL=4;ne.FIRST_COLUMN=5;ne.LAST_COLUMN=6;ne.FIRST_CELL=7;ne.LAST_CELL=8;ne.PREV_PAGE=9;ne.NEXT_PAGE=10;ne._$name="Location";const _h=c=>typeof c=="number"||c?.endsWith("px");class ge extends de.mixin(Ie,Kt){static get $name(){return"Column"}static get type(){return"column"}static get fields(){return["type","text","field","renderer","width","flex","autoWidth","autoHeight",{name:"fitMode",defaultValue:"exact"},{name:"editor",defaultValue:{}},"cellEditor","finalizeCellEdit",{name:"revertOnEscape",defaultValue:!0},{name:"invalidAction",defaultValue:"block"},{name:"sortable",defaultValue:!0,convert(e,t){if(!e)return!1;if(e===!0)return!0;const i={};return typeof e=="function"?(i.originalSortFn=e,i.sortFn=e.bind(t)):typeof e=="object"&&(Object.assign(i,e),i.fn&&(i.sortFn=i.fn,delete i.fn)),i}},{name:"searchable",defaultValue:!0},{name:"collapsible",defaultValue:!1},{name:"collapsed",defaultValue:!1},{name:"collapseMode"},{name:"filterable",defaultValue:!0,convert(e){if(!e)return!1;if(e===!0)return!0;const t={columnOwned:!0};return typeof e=="function"?t.filterFn=e:typeof e=="object"&&Object.assign(t,e),t}},{name:"sealed"},{name:"hideable",defaultValue:!0},{name:"draggable",defaultValue:!0},{name:"groupable",defaultValue:!0},{name:"resizable",defaultValue:!0},"groupRenderer","headerRenderer","tooltip","tooltipRenderer","cellCls","cls","icon","align",{name:"minWidth",defaultValue:60},"maxWidth",{name:"hidden",defaultValue:!1},{name:"locked"},{name:"region"},{name:"mergeCells",type:"boolean"},{name:"mergeable",type:"boolean",defaultValue:!0},"mergedRenderer",{name:"showColumnPicker",defaultValue:!0},{name:"enableHeaderContextMenu",defaultValue:!0},{name:"enableCellContextMenu",defaultValue:!0},"headerMenuItems","cellMenuItems","sum","summaries","summaryRenderer","responsiveLevels","tags","touchConfig","tree","filterType",{name:"htmlEncode",defaultValue:!0},{name:"htmlEncodeHeaderText",defaultValue:!0},{name:"autoSyncHtml",defaultValue:!1},{name:"alwaysClearCell",defaultValue:!1},{name:"headerWidgets"},{name:"instantUpdate",defaultValue:!1},{name:"repaintOnResize",defaultValue:!1},"editTargetSelector",{name:"exportable",defaultValue:!0},{name:"exportedType"},{name:"ariaLabel",defaultValue:"L{Column.columnLabel}"},{name:"cellAriaLabel",defaultValue:"L{cellLabel}"}]}static get autoExposeFields(){return!1}construct(e,t){var i;const r=this;r.masterStore=t,t&&(r._grid=Array.isArray(t)?t[0].grid:t.grid),r.localizableProperties=pe.mergeMethods.distinct(e.localizableProperties,["text","ariaLabel","cellAriaLabel"]),e.localeClass&&(r.localeClass=e.localeClass),super.construct(...arguments),r.isLeaf&&!("field"in r.data)&&(r.field="_"+(r.type||"")+ ++ge.emptyCount,r.noFieldSpecified=!0),r.hasComplexMapping=(i=r.field)===null||i===void 0?void 0:i.includes("."),!r.width&&!r.flex&&!r.children&&r.set({width:ge.defaultWidth,flex:null},null,!0),r.headerWidgets&&r.initHeaderWidgets(r.headerWidgets),r.isParent&&(r.meta.visibleChildren=new Set,r.collapsible&&(r.collapsible=!0))}get isCollapsible(){var e;return((e=this.children)===null||e===void 0?void 0:e.length)>1&&this.collapsible}get collapsed(){return this.get("collapsed")}set collapsed(e){this.set("collapsed",e,!0),this.onCollapseChange(!e),this.trigger("toggleCollapse",{collapsed:e})}onCellFocus(e){this.location=e,this.updateHeaderAriaLabel(this.localizeProperty("ariaLabel")),e.rowIndex!==-1&&this.updateCellAriaLabel(this.localizeProperty("cellAriaLabel"))}updateHeaderAriaLabel(e){S.setAttributes(this.element,{"aria-label":e})}updateCellAriaLabel(e){var t,i;if(!((t=this.location)!==null&&t!==void 0&&t.isSpecialRow)&&(i=this.location)!==null&&i!==void 0&&i.cell){var r;(r=e)!==null&&r!==void 0&&r.length||(e=this.location.column.text),S.setAttributes(this.location.cell,{"aria-label":e})}}doDestroy(){var e,t,i;(e=this.data)===null||e===void 0||(t=e.editor)===null||t===void 0||(i=t.destroy)===null||i===void 0||i.call(t),this.destroyHeaderWidgets(),super.doDestroy()}set headerWidgets(e){this.initHeaderWidgets(e),this.set("headerWidgets",e)}get headerWidgets(){return this.get("headerWidgets")}initHeaderWidgets(e){this.destroyHeaderWidgets();const t=this.headerWidgetMap={};for(const i of e){const r=N.create(F({owner:this},i));t[r.ref||r.id]=r}}destroyHeaderWidgets(){for(const t of Object.values(this.headerWidgetMap||{})){var e;(e=t.destroy)===null||e===void 0||e.call(t)}}static generateAutoCls(){let e="";for(let t=this;t!==ge;t=t.superclass)t.type&&(e+=`b-${t.type.toLowerCase()}-cell `);return(ge.autoClsMap||(ge.autoClsMap=new Map)).set(this,e),e}getCellClass(e){var t,i;const{record:r,column:n}=e,{cellCls:s,internalCellCls:a,grid:o,constructor:l,align:d}=n,u=((t=ge.autoClsMap)===null||t===void 0?void 0:t.get(l))||l.generateAutoCls(),h=e.cell.classList.contains("b-editing"),f={[o.cellCls]:o.cellCls,[u]:u,[s]:s,[a]:a,"b-cell-dirty":r.isFieldModified(n.field)&&(n.compositeField||((i=r.fieldMap[n.field])===null||i===void 0?void 0:i.persist)!==!1),[`b-grid-cell-align-${d}`]:d,"b-selected":o.selectionMode.cell&&o.isCellSelected(e),"b-focused":o.isFocused(e),"b-auto-height":n.autoHeight,"b-editing":h};return r.isSpecialRow&&f["b-checkbox-selection"]&&(f["b-checkbox-selection"]=!1),f}get locked(){return this.data.region==="locked"}set locked(e){this.region=e?"locked":"normal"}get region(){return this.parent.isRoot?this.get("region"):this.parent.region}set region(e){this.set("region",e)}get sortable(){return this.isLeaf&&this.data.sortable}set sortable(e){this.set("sortable",e)}get groupable(){return this.isLeaf&&this.data.groupable}set groupable(e){this.set("groupable",e)}get editor(){const e=this;let{editor:t}=e.data;if(t&&!t.isWidget){const i=e.grid.processCellEditor({editor:t,field:e.field});i?t=e.data.editor=i.editor:(typeof t=="string"&&(t={type:t}),t=e.data.editor=N.create(T.merge(e.defaultEditor,{owner:e.grid,label:z.encodeHtml(e.text)},t)))}return t}set editor(e){this.data.editor=e}get defaultEditor(){return{type:"textfield",name:this.field}}getFilterableValue(e){return this.getRawValue(e)}get owner(){return this._owner||this.subGrid}set owner(e){this._owner=e}get grid(){var e;return this._grid||((e=this.parent)===null||e===void 0?void 0:e.grid)}set subGrid(e){this._subGrid=e}get subGrid(){var e;return this._subGrid||((e=this.grid)===null||e===void 0?void 0:e.getSubGridFromColumn(this))}get subGridElement(){return this.subGrid.element}get element(){return this.grid.getHeaderElement(this)}get nextVisibleSibling(){const e=this.region;let t=this.nextSibling;for(;t&&(t.hidden||t.region!==e);)t=t.nextSibling;return t}get isLastInSubGrid(){return!this.nextVisibleSibling&&(this.parent.isRoot||this.parent.isLastInSubGrid)}get textWrapper(){return S.getChild(this.element,".b-grid-header-text")}get textElement(){return S.down(this.element,".b-grid-header-text-content")}get contentElement(){return S.down(this.element,".b-grid-header-children")}get isSorted(){return this.grid.store.sorters.some(e=>e.field===this.field)}get isFocusable(){return this.isLeaf}static get text(){return this.$meta.fields.defaults.text}get headerText(){return this.htmlEncodeHeaderText?z.encodeHtml(this.text):this.text}get isVisible(){return!this.hidden&&(!this.parent||this.parent.isVisible)}hide(e=!1,t=!1){const i=this,{parent:r}=i;i.hidden||(i.hidden=!0,r&&!r.isRoot&&!r.isTogglingAll&&!r.children.some(s=>s.hidden!==!0)&&!r.hidden&&(e=!0,r.hide()),i.isParent?i.children.forEach(n=>n.hide(!0,!0)):r.isRoot||r.meta.visibleChildren[t?"add":"delete"](i),e||i.stores.forEach(n=>n.trigger("columnHide",{column:i})))}show(e=!1){const t=this,{parent:i}=t;if(t.hidden){if(t.hidden=!1,i!=null&&i.hidden&&i.show(),t.isParent){var r;(r=t.meta.visibleChildren)===null||r===void 0||r.forEach(n=>n.show(!0))}e||t.stores.forEach(n=>n.trigger("columnShow",{column:t}))}}toggle(e){if(this.hidden&&e===void 0||e===!0)return this.show();if(!this.hidden&&e===void 0||e===!1)return this.hide()}toggleChildren(e=this.children,t=void 0){var i,r;const n=this;(i=n.grid.columns)===null||i===void 0||i.beginBatch(),n.isTogglingAll=!0,e.forEach(s=>s.toggle(t)),n.isTogglingAll=!1,(r=n.grid.columns)===null||r===void 0||r.endBatch()}onCollapseChange(e=void 0){const t=this;if(t.collapseMode==="toggleAll")t.toggleChildren();else{var i,r;const{firstChild:n}=t;n.flex!=null&&t.collapsed?(n.oldFlex=n.flex,n.width=n.element.offsetWidth):!t.collapsed&&n.oldFlex&&(n.flex=n.oldFlex,n.oldFlex=null),(i=t.grid.columns)===null||i===void 0||i.beginBatch(),t.isTogglingAll=!0,t.children.slice(1).forEach(s=>s.toggle(e)),t.isTogglingAll=!1,(r=t.grid.columns)===null||r===void 0||r.endBatch()}}set collapsible(e){const t=this;if(t.set("collapsible",e),t.isParent){const{headerWidgets:i=[]}=t;if(e)i.push({type:"button",ref:"collapseExpand",toggleable:!0,pressed:t.collapsed,icon:`b-icon-collapse-${t.grid.rtl?"right":"left"}`,pressedIcon:`b-icon-collapse-${t.grid.rtl?"left":"right"}`,cls:"b-grid-header-collapse-button b-transparent",onToggle:({pressed:r})=>t.collapsed=r});else{const r=i.findIndex(n=>n.ref==="collapseExpand");r>-1&&i.splice(r,1)}t.headerWidgets=i,t.collapsed&&t.onCollapseChange(!1)}}get collapsible(){return this.get("collapsible")}generateId(){return ge.generatedIdIndex||(ge.generatedIdIndex=0),(this.field?this.field.replace(/\./g,"-"):"col")+ ++ge.generatedIdIndex}get allIndex(){return this.masterStore.indexOf(this)}measureSize(e){var t;return S.measureSize(e,(t=this.subGrid)===null||t===void 0?void 0:t.element)}get calcMinWidth(){const{width:e,minWidth:t}=this.data;return _h(e)&&_h(t)?Math.max(parseInt(e)||0,parseInt(t)||0):e}get width(){return this.data.width}set width(e){const t={width:e};e&&"flex"in this.data&&(t.flex=null),this.set(t)}set flex(e){const t={flex:e};e&&"width"in this.data&&(t.width=null),this.set(t)}get flex(){return this.data.flex}calculateMinWidth(){const e=this,t=e.measureSize(e.width),i=e.measureSize(e.minWidth);let r=0;return e.children&&(r=e.children.reduce((n,s)=>n+s.calculateMinWidth(),0)),Math.max(t,i,r)}resizeToFitContent(e,t,i=!1){const r=this,{grid:n,element:s,fitMode:a}=r,{rowManager:o,store:l}=n,{count:d}=l;if(d<=0||r.fitMode==="none"||!r.fitMode)return;const[u]=o.rows,{rowElement:h,cellElement:f}=n.beginGridMeasuring(),g=new ne({grid:n,column:r,id:null});let m=0,p,v,y,C,D,w,E={length:0,record:null};if(f._domData={columnId:r.id,row:u,rowElement:h},g._cell=f,g.updatingSingleRow=!0,g.isMeasuring=!0,f.innerHTML="",n.resizeToFitIncludesHeader){if(!n.$headerPadding){const x=globalThis.getComputedStyle(s);n.$headerPadding=parseInt(x.paddingLeft)}const R=s.querySelector(".b-grid-header-text-content");R.style.cssText="flex: none; width: auto",m=R.offsetWidth+n.$headerPadding*2+2,R.style.cssText=""}for(d>1e3?(p=Math.max(Math.min(o.topIndex+Math.round(o.rowCount/2)-500,d-1e3),0),v=p+1e3):(p=0,v=d),y=p;y<v;y++){if(C=l.getAt(y),D=r.getRawValue(C),a==="value")w=String(D).length;else if(g._record=E.record,g._id=C.id,g._rowIndex=y,u.renderCell(g),a==="textContent")w=f.textContent.length;else{const R=f.offsetWidth;R>m&&(m=R)}w>E.length&&(E={record:C,length:w,rowIndex:y})}return E.length>0&&(a==="value"||a==="textContent")&&(g._record=E.record,g._id=E.record.id,g._rowIndex=E.rowIndex,u.renderCell(g),m=Math.max(m,f.offsetWidth)),Array.isArray(e)&&([e,t]=e),m=Math.max(m,e||0),m=Math.min(m,t||1e6),i||n.endGridMeasuring(),r.width=r.maxWidth?m=Math.min(m,r.maxWidth):m,m}getState(){const e=this,t={id:e.id,hidden:e.hidden,region:e.region,locked:e.locked};return e.children||(t[e.flex?"flex":"width"]=e.flex||e.width),e.isCollapsible&&(t.collapsed=e.collapsed),t}applyState(e){const t=this;t.beginBatch(),"locked"in e&&(t.locked=e.locked),"width"in e&&(t.width=e.width),"flex"in e&&(t.flex=e.flex),"width"in e&&t.flex?t.flex=void 0:"flex"in e&&t.width&&(t.width=void 0),"region"in e&&(t.region=e.region),t.endBatch(),"hidden"in e&&t.toggle(e.hidden!==!0),"collapsed"in e&&(t.collapsed=e.collapsed)}remove(){const{subGrid:e,grid:t}=this,i=e&&t?.focusedCell;i?.columnId===this.id&&(t.owns(S.getActiveElement(t))?t.navigateRight():t._focusedCell=new ne({grid:t,rowIndex:i.rowIndex,column:e.columns.getAdjacentVisibleLeafColumn(this.id,!0,!0)})),super.remove()}getRawValue(e){return this.hasComplexMapping?T.getPath(e,this.field):e[this.field]}refreshCell(e){this.grid.rowManager.refreshCell(e,this.id)}clearCell(e){e.innerHTML="",delete e._content}canEdit(e){if(e.isEditable){const t=e.isEditable(this.field);if(t!==void 0)return t}return!0}insertChild(e,t=null,i=!1){return e=Array.isArray(e)?e:[e],e.forEach(r=>{const{parent:n}=r;n!=null&&n.collapsed&&r===n.firstChild&&n.children.length>1&&n.children.filter(s=>!s.hidden).length===1&&(r.nextSibling.hidden=!1)}),this.sealed&&!this.inProcessChildren?null:super.insertChild(...arguments)}canFillValue(){return!0}getCurrentConfig(e){var t;const i=super.getCurrentConfig(e);return(t=this.sortable)!==null&&t!==void 0&&t.originalSortFn&&(i.sortable=this.sortable.originalSortFn),i.renderer===this.internalRenderer&&delete i.renderer,i.headerRenderer===this.internalHeaderRenderer&&delete i.headerRenderer,delete i.ariaLabel,delete i.cellAriaLabel,i}}ge.emptyCount=0;ge.defaultWidth=100;ge.exposeProperties();ge._$name="Column";const k0={boolean:{type:"check"},date:{type:"date"},integer:{type:"number",format:{maximumFractionDigits:0}},number:{type:"number"}},I0=[{field:"region"}];class be extends Kt(se){static get defaultConfig(){return{modelClass:ge,tree:!0,autoAddField:!1,sorters:I0}}construct(e){const t=this;e.grid&&(e.grid._columnStore=t,t.id=`${e.grid.id}-columns`,e.grid.ion({subGridCollapse:"clearSubGridCaches",subGridExpand:"clearSubGridCaches",thisObj:t})),super.construct(e),t.ion({change:t.onStoreChange,sort:()=>t.updateChainedStores(),thisObj:t,prio:1})}get modelClass(){return this._modelClass}set modelClass(e){this._modelClass=e}doDestroy(){const e=[];this.isChained||this.traverse(t=>e.push(t)),super.doDestroy(),this.isChained||e.forEach(t=>t.destroy())}getById(e){return super.getById(e)||this.idRegister[e]}forEach(e,t=this){this.traverseWhile((i,r)=>e.call(t,i,r),!0)}get totalFixedWidth(){let e=0;for(const t of this)t.hidden||(t.children?t.children.forEach(i=>e+=this.calculateFixedWidth(i)):e+=this.calculateFixedWidth(t));return e}get hasFlex(){return this.visibleColumns.some(e=>e.flex)}calculateFixedWidth(e){return e.flex?e.measureSize(ge.defaultWidth):Math.max(e.measureSize(e.width),e.measureSize(e.minWidth))}get topColumns(){return this.isChained?this.masterStore.rootNode.children.filter(this.chainedFilterFn):this.rootNode.children}get visibleColumns(){const e=this;return e._visibleColumns||(e._visibleColumns=e.leaves.filter(t=>t.isVisible&&(!t.subGrid||!t.subGrid.collapsed))),e._visibleColumns}onStoreChange({action:e,changes:t}){e==="update"&&!("hidden"in t)||this.clearCaches()}clearSubGridCaches({subGrid:e}){e.columns.clearCaches(),this.clearCaches()}clearCaches(){var e;this._visibleColumns=null,(e=this.masterStore)===null||e===void 0||e.clearCaches()}onMasterDataChanged(e){super.onMasterDataChanged(e),(e.action!=="update"||"hidden"in e.changes)&&this.clearCaches()}getAdjacentVisibleLeafColumn(e,t=!0,i=!1){const r=this.visibleColumns,n=e instanceof ge?e:this.getById(e);let s=r.indexOf(n)+(t?1:-1);if(!r[s])if(i)s=t?0:r.length-1;else return null;return r[s]}get bottomColumns(){return this.leaves}get(e){return this.findRecord("field",e,!0)}createRecord(e){var t,i;const{grid:r={}}=this,{store:n}=r,s=n==null||(t=n.modelClass)===null||t===void 0||(i=t.fieldMap)===null||i===void 0?void 0:i[e.field];let a=this.modelClass;if(s!=null&&s.column&&(e=U.merge({},s.column,e)),e.type&&(a=be.getColumnClass(e.type),!a))throw new Error(`Column type '${e.type}' not registered`);e.locked&&(e.region="locked",delete e.locked);const o=new a(e,this);if(o.data.region||(o.data.region=r.defaultRegion||"normal"),this.autoAddField&&!o.noFieldSpecified&&n&&!s){let l=o.field;o.constructor.fieldType&&(l={name:o.field,type:o.constructor.fieldType}),n.modelClass.addField(l)}return o}indexOf(e){if(e==null)return-1;const t=super.indexOf(e);return t>-1?t:this.records.findIndex(i=>i.field===e)}get usesAutoHeight(){return this.find(e=>e.autoHeight)}get usesFlexAutoHeight(){return this.find(e=>e.autoHeight&&e.flex!=null)}static registerColumnType(e,t=!1){e.simpleRenderer=t,(be.columnTypes||(be.columnTypes={}))[e.type]=e}static getColumnClass(e){return be.columnTypes&&be.columnTypes[e]}generateColumnForField(e,t){if(typeof e=="string"&&this.grid){var i;e=(i=this.grid.store)===null||i===void 0?void 0:i.modelClass.fieldMap[e]}let r=e.column||k0[e.type]||{};return typeof r=="string"&&(r={type:r}),r=Object.assign({text:e.text||z.separate(e.name),field:e.name},t,r),e.precision!=null&&(r.format.maximumFractionDigits=e.precision),e.columnType&&(r.type=e.columnType),this.createRecord(r)}}const F0=(c,e)=>({update:({store:t,record:i,changes:r})=>{let n=!0;return("width"in r||"minWidth"in r||"maxWidth"in r||"flex"in r)&&(n=c.call(e,{store:t,record:i,changes:r})),n}});be.registerColumnType(ge,!0);be._$name="ColumnStore";class zr extends ge{get groupHeaderReserved(){return!0}construct(e,t){const i=this;super.construct(...arguments),!e.width&&!e.flex&&i.grid.ion({paint:"updateAutoWidth",thisObj:i}),i.disableIfGridReadOnly&&i.grid.element.classList.add("b-actioncolumn-readonly"),i.externalRenderer=i.renderer,i.renderer=i.internalRenderer}internalRenderer({grid:e,column:t,record:i,callExternalRenderer:r=!0}){var n;const s=i&&"groupRowFor"in i.meta,{subGrid:a}=t;if(r){var o;(o=this.externalRenderer)===null||o===void 0||o.call(this,...arguments)}return{className:{"b-action-ct":1},children:(n=t.actions)===null||n===void 0?void 0:n.map((l,d)=>{var u;if("visible"in l&&(typeof l.visible=="function"&&l.visible({record:i})===!1||l.visible===!1)||s&&!l.showForGroup||!s&&l.showForGroup)return"";const{tooltip:h,renderer:f}=l,g=typeof h=="function"||h!=null&&(u=h.startsWith)!==null&&u!==void 0&&u.call(h,"up.")?a.callback(h,a,[{record:i}]):h||"";if(f){const m=a.callback(f,a,[{index:d,record:i,column:t,tooltip:g,action:l}]);return typeof m=="string"?{tag:"span",dataset:F(F({},ce.encodeConfig(g)),{},{index:d}),html:m}:(m.dataset=m.dataset||{},m.dataset.index=d,m)}else return{tag:"button",dataset:F(F({},ce.encodeConfig(g)),{},{index:d}),"aria-label":g,className:{"b-tool":1,"b-action-item":1,[l.cls]:l.cls}}})}}onCellClick({grid:e,column:t,record:i,target:r}){var n;if(t!==this||!r.classList.contains("b-action-item"))return;let s=r.dataset.index;s||(s=r.parentElement.dataset&&r.parentElement.dataset.index);const a=(n=t.actions)===null||n===void 0?void 0:n[s],o=a&&a.onClick;o&&this.callback(o,t,[{record:i,action:a,target:r}])}updateAutoWidth(){const e=this,t=[],{actions:i}=e;if(!e.element)return;const r=e.actions=[];i?.forEach(s=>{const a=F({},s);delete a.visible,a.showForGroup?(delete a.showForGroup,t.push(a)):r.push(a)}),t.length>r.length&&(e._actions=t);const n=S.createElement(e.internalRenderer({column:e,callExternalRenderer:!1})).outerHTML;e.width=S.measureText(n,e.element,!0,e.element.parentElement),e.actions=i}}M(zr,"type","action");M(zr,"fields",[{name:"actions",type:"array"},{name:"disableIfGridReadOnly",defaultValue:!1}]);M(zr,"defaults",{filterable:!1,groupable:!1,sortable:!1,editor:!1,searchable:!1,htmlEncode:!1,resizable:!1,minWidth:30});be.registerColumnType(zr);zr.exposeProperties();zr._$name="ActionColumn";class Zt extends ge{static get defaults(){return{filterType:"number",format:""}}get defaultEditor(){const{format:e,name:t,max:i,min:r,step:n,largeStep:s,align:a}=this;return T.cleanupProperties({type:"numberfield",format:e,name:t,max:i,min:r,step:n,largeStep:s,textAlign:a})}get formatter(){const e=this,{format:t}=e;let i=e._formatter;return(!i||e._lastFormat!==t)&&(e._formatter=i=Yt.get(e._lastFormat=t)),i}formatValue(e){var t;return e!=null&&(e=this.formatter.format(e),this.unit&&(e=`${e}${this.unit}`)),(t=e)!==null&&t!==void 0?t:""}defaultRenderer({value:e}){return this.formatValue(e)}}M(Zt,"type","number");M(Zt,"fieldType","number");M(Zt,"fields",["format","min","max","step","largeStep","unit"]);be.registerColumnType(Zt,!0);Zt.exposeProperties();Zt._$name="NumberColumn";class Jn extends Zt{static get defaults(){return{function:"sum",includeParentInChangeSet:!1}}construct(e,t){this.configuredAlign="align"in e,this.configuredEditor="editor"in e,super.construct(...arguments);const{grid:i}=t;this.function==="sum"&&(this.function="sumChildren"),i&&(this.store=i.store)}set store(e){const t=this,i={update:"onRecordUpdate",thisObj:t,prio:1e3},r=t._store;if(e!==r){r&&r.un(i),t._store=e;const{modelClass:n}=e,s=n.fieldMap[t.field];s&&s.type==="number"&&(t.configuredAlign||(t.align="end"),t.configuredEditor||(t.editor="number")),e.ion(i)}}canEdit(e){return e.isLeaf}get store(){return this._store}sumChildren(...e){let t=0;for(let i=0,{length:r}=e;i<r;i++)t+=parseFloat(e[i]||0,10);return t}avg(...e){let t=0;const{length:i}=e;for(let r=0;r<i;r++)t+=parseFloat(e[r]||0,10);return t/i}onRecordUpdate({record:e,changes:t}){const i=this,{rowManager:r}=i.grid;i.field in t&&e.isLeaf&&e.bubble(n=>{const s=r.getRowFor(n);if(s){const a=s.getCell(i.field);a&&s.renderCell(a)}},!0)}getRawValue(e){var t;let i=0;if((t=e.children)!==null&&t!==void 0&&t.length){const r=this,n=r.function,s=typeof n=="string"&&typeof Math[n]=="function",{handler:a,thisObj:o}=s?{handler:Math[n],thisObj:Math}:r.resolveCallback(n);i=a.apply(o,e.children.map(l=>r.getRawValue(l))),r.includeParentInChangeSet?e.set(r.field,i,!0):e.setData(r.field,i)}else i=e[this.field];return i}canFillValue(){return!1}}M(Jn,"type","aggregate");M(Jn,"fields",["function","includeParentInChangeSet"]);be.registerColumnType(Jn,!0);Jn.exposeProperties();Jn._$name="AggregateColumn";class Ji extends ge{static get defaults(){return{filterable:!1,sortable:!1,editor:!1,searchable:!1,fitMode:!1,alwaysClearCell:!1}}construct(e,t){const i=this;i.widgetMap={},super.construct(...arguments),i.externalRenderer=i.renderer,i.renderer=i.internalRenderer}doDestroy(){for(const e of Object.values(this.widgetMap))e.destroy&&e.destroy();super.doDestroy()}updateReadOnly(e){for(const t of Object.values(this.widgetMap))t.cellInfo.record.readOnly||(t.readOnly=e)}internalRenderer(e){var t;const i=this,{cellElement:r,column:n,record:s,isExport:a}=e,{widgets:o}=n;return!a&&o&&(r.widgets||i.clearCell(r),r.widgets=e.widgets=o.map((l,d)=>{var u,h;let f,g;if(r.widgets&&(f=r.widgets[d],g=f.element.nextElementSibling,l.recreate&&f&&(delete i.widgetMap[f.id],f.destroy(),r.widgets[d]=null)),f||(i.onBeforeWidgetCreate(l,e),l.recomposeAsync=!1,f=Zi.append(l,g?{insertBefore:g}:r)[0],i.widgetMap[f.id]=f,i.onAfterWidgetCreate(f,e),f.name&&f.ion({change:({value:m})=>{f.cellInfo.record[f.name]=m}})),f.cellInfo={record:s,column:n},i.grid&&!i.meta.isSelectionColumn&&(f.readOnly=i.grid.readOnly||s.readOnly),((u=i.onBeforeWidgetSetValue)===null||u===void 0?void 0:u.call(i,f,e))!==!1){const m=l.valueProperty||"value"in f&&"value"||f.defaultBindProperty;if(m){const p=f.name?s[f.name]:e.value;f[m]=p}}return(h=i.onAfterWidgetSetValue)===null||h===void 0||h.call(i,f,e),f})),a?null:(t=this.externalRenderer)===null||t===void 0?void 0:t.call(this,e)}onBeforeWidgetCreate(e,t){}onAfterWidgetCreate(e,t){}clearCell(e){e.widgets&&(e.widgets.forEach(t=>{delete this.widgetMap[t.id],t.destroy()}),e.widgets=null),super.clearCell(e)}resizeToFitContent(){}}M(Ji,"type","widget");M(Ji,"fields",["widgets"]);be.registerColumnType(Ji);Ji.exposeProperties();Ji._$name="WidgetColumn";class Vr extends Ji{construct(e,t){super.construct(...arguments);const i=this;if(Object.assign(i,{externalHeaderRenderer:i.headerRenderer,externalOnBeforeWidgetSetValue:i.onBeforeWidgetSetValue,externalOnAfterWidgetSetValue:i.onAfterWidgetSetValue,onBeforeWidgetSetValue:i.internalOnBeforeWidgetSetValue,onAfterWidgetSetValue:i.internalOnAfterWidgetSetValue,headerRenderer:i.internalHeaderRenderer}),!i.meta.isSelectionColumn){var r;const n=(r=i.grid)===null||r===void 0?void 0:r.store.modelClass;i.field?n&&!n.fieldMap[i.field]&&!i.constructor.suppressNoModelFieldWarning&&(console.warn(i.$$name+" is configured with a field, but this is not part of your Model `fields` collection."),n.addField({name:i.field,type:"boolean"})):console.warn("CheckColumn MUST be configured with a field, otherwise the checked state will not be persistent. Widgets are recycled and reused")}}doDestroy(){var e;(e=this.headerCheckbox)===null||e===void 0||e.destroy(),super.doDestroy()}internalHeaderRenderer({headerElement:e,column:t}){let i;return e.classList.add("b-check-header"),t.showCheckAll?(e.classList.add("b-check-header-with-checkbox"),t.headerCheckbox?e.appendChild(t.headerCheckbox.element):t.headerCheckbox=new Nr({appendTo:e,owner:this.grid,ariaLabel:"L{Checkbox.toggleSelection}",internalListeners:{change:"onCheckAllChange",thisObj:t}})):i=t.headerText,i=t.externalHeaderRenderer?t.externalHeaderRenderer.call(this,...arguments):i,t.showCheckAll?void 0:i}updateCheckAllState(e){this.headerCheckbox&&(this.suspendEvents(),this.headerCheckbox.checked=e,this.resumeEvents())}onCheckAllChange({checked:e}){const t=this;if(t.field){const{store:i}=t.grid;i.beginBatch(),i.forEach(r=>t.updateRecord(r,t.field,e)),i.endBatch()}t.trigger("toggleAll",{checked:e})}internalRenderer({value:e,isExport:t,record:i,cellElement:r}){if(t)return e??"";const n=super.internalRenderer(...arguments);return i.readOnly&&!this.meta.isSelectionColumn&&(r.widgets[0].readOnly=!0),n}onBeforeWidgetCreate(e,t){e.cls=this.checkCls}onAfterWidgetCreate(e,t){t.cellElement.widget=e,e.ion({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}internalOnBeforeWidgetSetValue(e){var t;e.record=e.cellInfo.record,this.isInitialSet=!0,(t=this.externalOnBeforeWidgetSetValue)===null||t===void 0||t.call(this,...arguments)}internalOnAfterWidgetSetValue(e){var t;this.isInitialSet=!1,(t=this.externalOnAfterWidgetSetValue)===null||t===void 0||t.call(this,...arguments)}onBeforeCheckboxChange({source:e,checked:t,userAction:i}){const r=this,{grid:n}=r,{record:s}=e.cellInfo;if(i&&r.field&&(!n.features.cellEdit||n.features.cellEdit.disabled)||r.meta.isSelectionColumn&&!n.isSelectable(s)&&t)return!1;if(!r.isInitialSet)return r.trigger("beforeToggle",{record:s,checked:t})}onCheckboxChange({source:e,checked:t}){if(!this.isInitialSet){const i=this,{record:r}=e.cellInfo,{field:n}=i;n&&(i.updateRecord(r,n,t),t?i.updateCheckAllState(i.grid.store.every(s=>s[n],null,!0)):i.updateCheckAllState(!1)),i.trigger("toggle",{record:r,checked:t})}}updateRecord(e,t,i){const r=`set${z.capitalize(t)}`;e[r]?e[r](i):e.set(t,i)}onCellKeyDown({event:e,cellElement:t}){if(e.key===" "){const i=t.widget;i?.toggle(),e.preventDefault(),e.handled=!0}}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.onBeforeWidgetSetValue,delete t.onAfterWidgetSetValue,this.externalOnBeforeWidgetSetValue&&(t.onBeforeWidgetSetValue=this.externalOnBeforeWidgetSetValue),this.externalOnAfterWidgetSetValue&&(t.onAfterWidgetSetValue=this.externalOnAfterWidgetSetValue),t}}M(Vr,"$name","CheckColumn");M(Vr,"type","check");M(Vr,"fields",["checkCls","showCheckAll","onAfterWidgetSetValue","onBeforeWidgetSetValue","callOnFunctions","onBeforeToggle","onToggle","onToggleAll"]);M(Vr,"defaults",{align:"center",checkCls:null,showCheckAll:!1,sortable:!0,filterable:!0,widgets:[{type:"checkbox",valueProperty:"checked"}]});be.registerColumnType(Vr,!0);Vr._$name="CheckColumn";class Qi extends ge{static get defaults(){return{format:"L",step:1,minWidth:85,filterType:"date"}}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){return typeof e=="string"&&(e=b.parse(e,this.format||void 0)),b.format(e,this.format||void 0)}set format(e){const{editor:t}=this.data;this.set("format",e),t&&(t.format=e)}get format(){return this.get("format")}get defaultEditor(){const e=this,{min:t,max:i,step:r,format:n}=e;return{name:e.field,type:"date",calendarContainerCls:"b-grid-cell-editor-related",weekStartDay:e.grid.weekStartDay,format:n,max:i,min:t,step:r}}}M(Qi,"$name","DateColumn");M(Qi,"type","date");M(Qi,"fieldType","date");M(Qi,"fields",["format","pickerFormat","step","min","max"]);be.registerColumnType(Qi,!0);Qi.exposeProperties();Qi._$name="DateColumn";class jr extends Zt{static get defaults(){return{min:0,max:100,showValue:!1,lowThreshold:20,htmlEncode:!1,searchable:!1,summaryRenderer:e=>`${e}%`,fitMode:!1}}constructor(e,t){super(...arguments),this.internalCellCls="b-percent-bar-cell"}defaultRenderer({value:e}){return e=e||0,{className:"b-percent-bar-outer",role:"progressbar","aria-Valuemin":0,"aria-Valuemax":100,"aria-Valuenow":e,tabIndex:0,children:[{tag:"div",className:{"b-percent-bar":1,"b-zero":e===0,"b-low":e<this.lowThreshold},style:{width:e+"%"},children:[this.showValue?{tag:"span",text:e+"%"}:void 0]}]}}resizeToFitContent(){}}M(jr,"type","percent");M(jr,"fieldType","number");M(jr,"fields",["showValue","lowThreshold"]);jr.sum="average";be.registerColumnType(jr,!0);jr._$name="PercentColumn";class er extends Zt{static get defaults(){return{min:0,max:5,emptyIcon:"b-icon b-icon-star",filledIcon:"b-icon b-icon-star",editable:!0,filterType:"number",searchable:!1,width:"11.2em",htmlEncode:!1,minWidth:"11.2em",editor:!1,fitMode:"value"}}renderer({value:e}){return{className:{"b-rating-cell-inner":1,"b-not-editable":!this.editable},children:W.populate(this.max,t=>{const i=t<e;return{tag:"i",className:{"b-rating-icon":!0,"b-filled":i,"b-empty":!i,[i?this.filledIcon:this.emptyIcon]:!0}}})}}onCellClick({grid:e,column:t,record:i,target:r,event:n}){if(r.classList.contains("b-rating-icon")&&!e.readOnly&&t.editable){let s=[].indexOf.call(r.parentNode.childNodes,r);r.classList.contains("b-filled")&&(n.metaKey||n.shiftKey)&&(s=s-1),i.get(t.field)===1&&s===0&&(s=-1),i.set(t.field,s+1)}}}M(er,"$name","RatingColumn");M(er,"type","rating");M(er,"fieldType","number");M(er,"fields",["emptyIcon","filledIcon","editable"]);be.registerColumnType(er,!0);er.exposeProperties();er._$name="RatingColumn";class za extends ge{static get defaults(){return{groupable:!1,sortable:!1,filterable:!1,searchable:!1,resizable:!1,draggable:!1,minWidth:50,width:50,align:"center",text:"#",editor:!1}}construct(e){super.construct(...arguments);const t=this,{grid:i}=t;t.internalCellCls="b-row-number-cell",t.externalHeaderRenderer=t.headerRenderer,t.headerRenderer=t.internalHeaderRenderer,i&&(i.ion({bindStore:"bindStore",thisObj:t}),t.bindStore({store:i.store,initial:!0}),i.store.count&&!i.rendered&&i.ion({paint:"resizeToFitContent",thisObj:t,once:!0}))}get groupHeaderReserved(){return!0}bindStore({store:e,initial:t}){const i=this;i.detachListeners("grid"),e.ion({name:"grid",[`change${i.grid.asyncEventSuffix}`]:"onStoreChange",thisObj:i}),t||i.resizeToFitContent()}onStoreChange({action:e}){(e==="dataset"||e==="add"||e==="remove"||e==="removeall")&&this.resizeToFitContent()}renderer({record:e,grid:t}){return e.isSpecialRow?"":t.store.indexOf(e,!0)+1}resizeToFitContent(){const{grid:e}=this,{store:t}=e,{count:i}=t;if(i&&!this.hidden){const r=e.element.querySelector(`.b-grid-cell[data-column-id="${this.id}"]`);if(r){const n=parseInt(S.getStyleValue(r,"padding-left")),s=S.measureText(i,r);this.width=Math.max(this.minWidth,s+2*n)}}}set flex(e){}internalHeaderRenderer({headerElement:e,column:t}){var i;return e.classList.add("b-rownumber-header"),((i=t.externalHeaderRenderer)===null||i===void 0?void 0:i.call(this,...arguments))||t.headerText}}M(za,"$name","RowNumberColumn");M(za,"type","rownumber");be.registerColumnType(za,!0);za._$name="RowNumberColumn";class Qn extends ge{static get defaults(){return{htmlEncode:!1}}constructor(e,t){super(...arguments);const i=this;if(!i.template)throw new Error("TemplateColumn needs a template");if(typeof i.template!="function")throw new Error("TemplateColumn.template must be a function")}renderer(e){if(!e.record.isSpecialRow)return this.template({value:e.value,record:e.record,field:e.column.field})}}M(Qn,"type","template");M(Qn,"fields",["template"]);be.registerColumnType(Qn,!0);Qn.exposeProperties();Qn._$name="TemplateColumn";class Wr extends ge{static get defaults(){return{format:"LT",minWidth:140,filterType:"time"}}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){return typeof e=="string"&&(e=b.parse(e,this.format)),b.format(e,this.format)}set format(e){const{editor:t}=this;this.set("format",e),t&&(t.format=e)}get format(){return this.get("format")}get defaultEditor(){return{name:this.field,type:"time",format:this.format}}}M(Wr,"type","time");M(Wr,"fieldType","date");M(Wr,"fields",["format"]);be.registerColumnType(Wr,!0);Wr.exposeProperties();Wr._$name="TimeColumn";let Hh=!1;class Ur extends ge{static get defaults(){return{tree:!0,hideable:!1,minWidth:150}}static get fields(){return[{name:"expandIconCls",defaultValue:"b-icon b-icon-tree-expand"},{name:"collapseIconCls",defaultValue:"b-icon b-icon-tree-collapse"},{name:"collapsedFolderIconCls"},{name:"expandedFolderIconCls"},{name:"indentSize",defaultValue:1.7},{name:"leafIconCls",defaultValue:"b-icon b-icon-tree-leaf"},{name:"editTargetSelector",defaultValue:".b-tree-cell-value"},"renderer"]}constructor(e,t){super(...arguments);const i=this;i.shouldHtmlEncode=i.htmlEncode,i.setData("htmlEncode",!1),i.renderer&&(i.originalRenderer=i.renderer),i.renderer=i.treeRenderer.bind(i)}treeRenderer(e){const t=this,{grid:i,column:r,cellElement:n,row:s,record:a,isExport:o}=e,l=a.instanceMeta(i.store),d=!a.isLeaf&&l.collapsed,u={className:"b-tree-cell-value"},h=[u],f={className:"b-tree-cell-inner",tag:a.href?"a":"div",href:a.href,target:a.target,children:h},g={"b-tree-parent-row":0,"b-tree-collapsed":0,"b-tree-expanded":0,"b-loading-children":0};let m,p,{value:v}=e;if(t.originalRenderer){var y;const x=t.originalRenderer(e),k=(y=i.hasFrameworkRenderer)===null||y===void 0?void 0:y.call(i,{cellContent:x,column:r});m=typeof x=="object"&&!k,v=k?"":x===!1?n.innerHTML:x,e.rendererHtml=x}if(!m){var C;v=String((C=v)!==null&&C!==void 0?C:"")}if(o)return v;if(a.isLeaf)n.classList.add("b-tree-leaf-cell"),p=e.iconCls||a.iconCls||t.leafIconCls;else{var D;const x=!a.isExpanded(i.store),k=x?t.expandIconCls:t.collapseIconCls,I=x?t.collapsedFolderIconCls:t.expandedFolderIconCls;g["b-tree-parent-row"]=1,g["b-tree-collapsed"]=x,g["b-tree-expanded"]=!x,g["b-loading-children"]=l.isLoadingChildren,n.classList.add("b-tree-parent-cell"),h.unshift({tag:"i",className:{"b-tree-expander":1,[k]:1,"b-empty-parent":!l.isLoadingChildren&&a.children!==!0&&!((D=a.children)!==null&&D!==void 0&&D.length)}}),Hh=p=e.iconCls||a.iconCls||I}if(p&&h.splice(h.length-1,0,{tag:"i",className:{"b-tree-icon":1,[p]:1}}),s.isRow&&(s.assignCls(g),!a.isLeaf))if(s.setAttribute("aria-expanded",!d),d)s.removeAttribute("aria-owns");else for(const x in i.subGrids){var w,E;const k=s.elements[x];S.setAttributes(k,{"aria-owns":(w=a.children)!==null&&w!==void 0&&w.length?(E=a.children)===null||E===void 0?void 0:E.map(I=>`${i.id}-${x}-${I.id}`).join(" "):null})}m||t.shouldHtmlEncode||!v.includes("<")?(m&&Object.assign(u,v),u.children=u.children||[],u.children.unshift(m?null:v)):u.html=v;const R=a.childLevel*t.indentSize+(a.isLeaf?Hh?2:p?.5:.4:0);return f.style=`padding-inline-start:${R}em`,f}getCurrentConfig(e){const t=super.getCurrentConfig(e);return t.renderer=this.originalRenderer,t}}M(Ur,"$name","TreeColumn");M(Ur,"type","tree");be.registerColumnType(Ur,!0);Ur.exposeProperties();Ur._$name="TreeColumn";class Rr extends de{static get fields(){return[{name:"iconCls",internal:!0},{name:"expanded",internal:!0},{name:"cls",internal:!0},{name:"rowHeight",internal:!0},{name:"href",internal:!0},{name:"target",internal:!0}]}}Rr.exposeProperties();Rr._$name="GridRowModel";const vn=new Map,mr=new Map,qs="Grid",Ks={Grid:"GridBase",Scheduler:"SchedulerBase",SchedulerPro:"SchedulerProBase",Gantt:"GanttBase"},A0=/\$\d+$/;class G{static registerFeature(e,t=!1,i=null,r=null){r=z.uncapitalize(r||Object.prototype.hasOwnProperty.call(e,"$name")&&e.$$name||e.name),r=r.replace(A0,""),Array.isArray(i)||(i=[i||qs]),i.forEach(n=>{const s=Ks[n]||n,a=vn.get(s)||new Map,o=mr.get(s)||new Map;a.set(r,e),o.set(e,t),vn.set(s,a),mr.set(s,o)})}static getTypeNameFeatures(e=qs){const t=Ks[e]||e,i=vn.get(t),r={};return i&&i.forEach((n,s)=>r[s]=n),r}static getTypeNameDefaultFeatures(e=qs){const t=Ks[e]||e,i=vn.get(t),r=mr.get(t),n={};return i&&r&&i.forEach((s,a)=>{r.get(s)&&(n[a]=s)}),n}static getInstanceFeatures(e){return e.$meta.names.reduce((t,i)=>Object.assign(t,this.getTypeNameFeatures(i)),{})}static getInstanceDefaultFeatures(e){return e.$meta.names.reduce((t,i)=>Object.entries(this.getTypeNameFeatures(i)).reduce((r,[n,s])=>(this.isDefaultFeatureForTypeName(s,i)?r[n]=s:delete r[n],r),t),{})}static isDefaultFeatureForTypeName(e,t=qs){const i=Ks[t]||t,r=mr.get(i);return r&&r.get(e)||!1}static isDefaultFeatureForInstance(e,t){const i=t.$meta.names.slice().reverse();let r=null;for(let n=0,s=i.length;n<s&&r===null;++n){const a=mr.get(i[n]);a&&a.has(e)&&(r=a.get(e))}return r||!1}static reset(){vn.clear(),mr.clear()}}class es extends te{constructor(...e){super(...e),M(this,"entityName","cell")}afterConstruct(){super.afterConstruct(),this.afterSelectionModeChange()}afterSelectionModeChange(){const e=this;e.client.selectionMode.cell?e._disabledBySelectionMode&&(e.disabled=!1,delete e._disabledBySelectionMode):e.disabled=!0}get copyOnly(){var e;return this._copyOnly||!((e=this.client.features.cellEdit)!==null&&e!==void 0&&e.enabled)}get canCopy(){return!this.disabled&&!this.client.selectedRecords.length&&this.client.selectedCells.length}get canCutPaste(){var e;return this.canCopy&&!this.copyOnly&&!((e=this.client.features.cellEdit)!==null&&e!==void 0&&e.isEditing)&&!this.client.readOnly}isActionAvailable(e,t){return this.canCopy&&(t==="copy"||this.canCutPaste)}async sendToClipboard(e){const t=this;let i=0,r=0,n="";e.sort((l,d)=>l.rowIndex===d.rowIndex?l.columnIndex-d.columnIndex:l.rowIndex-d.rowIndex);for(const l of e){var s,a;const{record:d,column:u,rowIndex:h,columnIndex:f}=l;h>i?(n.length>0&&(n+=`
`.repeat(h-i)),i=h,r=f):f>r&&(n.length>0&&(n+="	".repeat(f-r)),r=f);let g=(s=u.toClipboardString)===null||s===void 0?void 0:s.call(u,l);if(g===void 0){var o;g=(o=d.get(u.field))===null||o===void 0?void 0:o.toString()}t.toCopyString&&(g=t.toCopyString({currentValue:g,column:u,record:d})),g=(a=g)===null||a===void 0?void 0:a.replace(/[\n\t]/," "),n+=g||t.emptyValueChar}return await K.writeToClipboard(n,this.useNativeClipboard),n}async cut(){await this.copy(!0)}async copy(e){const t=this,{client:i,entityName:r}=t,n=typeof e=="boolean"?e:!1,s=n?i.selectedCells.filter(a=>{var o;return!((o=a.record)!==null&&o!==void 0&&o.readOnly)}):i.selectedCells;if(s){if((n?!t.canCutPaste:!t.canCopy)||i.trigger("beforeCopy",{cells:s,isCut:n,entityName:r})===!1)return;const a=await t.sendToClipboard(s);if(n===!0)for(const o of s)o.column.readOnly||o.record.set(o.column.field,null);i.trigger("copy",{cells:s,copiedDataString:a,isCut:n,entityName:r})}}async paste(){const e=this,{client:t,entityName:i}=e,r=await K.readFromClipboard(e.useNativeClipboard),n=t.selectedCells[0];if(!e.canCutPaste||!(r!=null&&r.length)||!n||t.trigger("beforePaste",{clipboardData:r,targetCell:n,entityName:i})===!1)return;const s=new Set,a=e.stringAs2dArray(r),o=[],{_shiftSelectRange:l}=t;if(!!(a!=null&&a.length)){if(l!=null&&l.some(d=>d.equals(n))){const d=e.cellSelectorsAs2dArray(l);if(d?.length%a.length===0&&d.columnCount%a.columnCount===0)for(let u=0;u<d.length;u+=a.length)for(let h=0;h<d.columnCount;h+=a.columnCount)o.push(d[u][h])}o.length||o.push(n);for(const d of o)for(let u=0;u<a.length;u++){const h=a[u],f=t.store.getAt(d.rowIndex+u);if(f&&!f.readOnly)for(let g=0;g<h.length;g++){const m=t.columns.getAt(d.columnIndex+g),p=m?.field;let v=h[g];p&&v&&!m.readOnly&&(v===e.emptyValueChar&&(v=null),m.fromClipboardString&&(v=m.fromClipboardString({string:v,record:f})),e.toPasteValue&&(v=e.toPasteValue({currentValue:v,record:f,column:m,field:p})),f.set(p,v,!1,!1,!1,!0),s.add(f))}}t.trigger("paste",{clipboardData:r,targetCell:n,modifiedRecords:[...s],entityName:i})}}cellSelectorsAs2dArray(e){const t=[];let i=null,r;for(const n of e)n.id!==i&&(i=n.id,r=[],t.push(r)),r.push(n);return t.columnCount=t[0].length,t.some(n=>n.length!==t.columnCount)?!1:t}stringAs2dArray(e){const t=[],i=e.split(/\r\n|(?!\r\n)[\n-\r\x85\u2028\u2029]/);for(const r of i){const n=r.split("	");if(t.columnCount&&n.length!==t.columnCount)return!1;t.columnCount=n.length,t.push(n)}return t}populateCellMenu({record:e,items:t}){const i=this;i.canCopy&&(t.cutCell={text:i.cutText,localeClass:i,icon:"b-icon b-icon-cut",weight:115,disabled:e.readOnly||!i.canCutPaste,onItem:()=>i.cut()},t.pasteCell={text:i.pasteText,localeClass:i,icon:"b-icon b-icon-paste",weight:120,disabled:e.readOnly||!i.canCutPaste,onItem:()=>i.paste()},t.copyCell={text:i.copyText,localeClass:i,cls:"b-separator",icon:"b-icon b-icon-copy",weight:110,onItem:()=>i.copy()})}}M(es,"$name","CellCopyPaste");M(es,"pluginConfig",{chain:["populateCellMenu","afterSelectionModeChange"]});M(es,"configurable",{copyOnly:null,emptyValueChar:" ",keyMap:{"Ctrl+C":"copy","Ctrl+X":"cut","Ctrl+V":"paste"},useNativeClipboard:!ae.isTestEnv,toCopyString:null,toPasteValue:null,copyText:"L{copy}",cutText:"L{cut}",pasteText:"L{paste}"});es._$name="CellCopyPaste";G.registerFeature(es);const L0={finishAndEditNextRow:1,finishAndEditPrevRow:1,finishEditing:1,cancelEditing:1,finishAndEditNextCell:1,finishAndEditPrevCell:1};class dd extends he(te){static get defaultConfig(){return{autoSelect:!0,blurAction:"complete",continueEditingOnCellClick:!0,addNewAtEnd:null,autoEdit:null,editNextOnEnterPress:!0,editorClass:Gt,triggerEvent:"celldblclick",touchEditDelay:300,focusCellAnimationDuration:!1,multiEdit:!0,keyMap:{Enter:["startEditing","finishAndEditNextRow"],"Ctrl+Enter":["finishAllSelected","finishEditing"],"Shift+Enter":"finishAndEditPrevRow","Alt+Enter":"finishEditing",F2:["startEditing","finishEditing"],Escape:"cancelEditing",Tab:"finishAndEditNextCell","Shift+Tab":"finishAndEditPrevCell"}}}static get pluginConfig(){return{assign:["startEditing","finishEditing","cancelEditing"],before:["onElementKeyDown","onElementPointerUp"],chain:["onElementClick","bindStore"]}}construct(e,t){super.construct(e,t);const i=this,r={renderRows:"onGridRefreshed",cellClick:"onCellClick",thisObj:i};i.grid=e,i.triggerEvent!=="cellclick"&&(r[i.triggerEvent]="onTriggerEditEvent"),i.autoEdit&&!("editNextOnEnterPress"in t)&&(i.editNextOnEnterPress=!1),e.ion(r),e.rowManager.ion({changeTotalHeight:"onGridRefreshed",thisObj:i}),i.bindStore(e.store)}bindStore(e){this.detachListeners("store"),e.ion({name:"store",update:"onStoreUpdate",beforeSort:"onStoreBeforeSort",thisObj:this})}async confirm(e){let t=!0;return this.editorContext&&(Pi.owner=this.editorContext.editor.inputField,e.rootElement=this.grid.rootElement,t=await Pi.confirm(e),Pi.owner=null),t===Pi.yesButton}doDestroy(){this.grid.columns.allRecords.forEach(e=>{var t;(t=e._cellEditor)===null||t===void 0||t.destroy()}),super.doDestroy()}doDisable(e){e&&!this.isConfiguring&&this.cancelEditing(!0),super.doDisable(e)}set disabled(e){super.disabled=e}get disabled(){const{grid:e}=this;return Boolean(super.disabled||e.disabled||e.readOnly)}get isEditing(){return Boolean(this.editorContext)}get activeRecord(){var e;return((e=this.editorContext)===null||e===void 0?void 0:e.record)||null}getEditorForCell({id:e,cell:t,column:i,columnId:r,editor:n}){var s;const a=this,{grid:o,editorClass:l}=a;let d=i.cellEditor,u=0;return i.editTargetSelector&&(u=t.querySelector(i.editTargetSelector).offsetLeft),n.autoSelect=a.autoSelect,(s=d)!==null&&s!==void 0&&s.isEditor||(d=i.data.cellEditor=l.create(l.mergeConfigs({type:l.type,constrainTo:null,cls:"b-cell-editor",inputField:n,blurAction:"none",invalidAction:i.invalidAction,completeKey:!1,cancelKey:!1,owner:o,align:{align:"t0-t0",offset:[u,0]},internalListeners:a.getEditorListeners(),onInternalKeyDown:a.onEditorKeydown.bind(a),allowMouseEvents:n.allowMouseEvents},d))),d.minHeight=o.rowHeight,d.inputField!==n&&(d.remove(d.items[0]),d.add(n)),d.align.offset[0]=u,i.instantUpdate&&!n.cellEditValueSetter&&(T.wrapProperty(n,"value",null,h=>{const{editorContext:f}=a,g=f?.editor.inputField;f!=null&&f.editor.isValid&&!T.isEqual(f.record[f.column.field],h)&&(!(g!=null&&g.isDateField)||g._isPickerInput)&&(f.record[f.column.field]=h)}),n.cellEditValueSetter=!0),Object.assign(d.element.dataset,{rowId:e,columnId:r,field:i.field}),d.inputField.revertOnEscape=i.revertOnEscape,a.editor=d}getEditorListeners(){return{focusOut:"onEditorFocusOut",focusIn:"onEditorFocusIn",start:"onEditorStart",beforeComplete:"onEditorBeforeComplete",complete:"onEditorComplete",beforeCancel:"onEditorBeforeCancel",cancel:"onEditorCancel",beforeHide:"onBeforeEditorHide",finishEdit:"onEditorFinishEdit",thisObj:this}}onEditorStart({source:e}){const t=this,i=t.editorContext=e.cellEditorContext;if(i){var r;const{grid:n}=t;t.triggerEvent!=="cellclick"&&(t.detachListeners("cellClickWhileEditing"),n.ion({name:"cellClickWhileEditing",cellclick:"onCellClickWhileEditing",thisObj:t})),(r=t.removeEditingListeners)===null||r===void 0||r.call(t),t.removeEditingListeners=ue.addListener({globaltap:"onTapOut",thisObj:t}),n.trigger("startCellEdit",{grid:n,editorContext:i})}}onEditorBeforeComplete(e){const{grid:t}=this,i=e.source,r=i.cellEditorContext;return e.grid=t,e.editorContext=r,t.trigger("beforeFinishCellEdit",e)}onEditorComplete({source:e}){const{grid:t}=this,i=e.cellEditorContext;i.value=e.inputField.value,t.trigger("finishCellEdit",{grid:t,editorContext:i})}onEditorBeforeCancel(){const{editorContext:e}=this;return this.grid.trigger("beforeCancelCellEdit",{editorContext:e})}onEditorCancel({event:e}){const{editorContext:t,muteEvents:i,grid:r}=this;i||r.trigger("cancelCellEdit",{grid:r,editorContext:t,event:e})}onBeforeEditorHide({source:e}){const t=this,{row:i,cell:r}=e.cellEditorContext;r?.classList.remove("b-editing"),i?.removeCls("b-editing"),t.detachListeners("cellClickWhileEditing"),t.removeEditingListeners()}onEditorFinishEdit({source:e}){e.cellEditorContext=this.editorContext=null}getAdjacentEditableCell(e,t){const{grid:i}=this,{store:r,columns:n}=i,{visibleColumns:s}=n;let a=e.id,o=n.getAdjacentVisibleLeafColumn(e.columnId,t);for(;a;)if(o){if(o.editor&&o.canEdit(r.getById(a)))return{id:a,columnId:o.id};o=n.getAdjacentVisibleLeafColumn(o,t)}else{const l=r.getAdjacent(e.id,t,!1,!0);a=l?.id,l&&(o=t?s[0]:s[s.length-1])}return null}doAddNewAtEnd(){const e=typeof this.addNewAtEnd=="object"?T.clone(this.addNewAtEnd):{},{grid:t}=this,i=t.store.add(e)[0];return t.rowManager.getRowFor(i)||t.rowManager.displayRecordAtBottom(),i}getEditingContext(e){e=this.grid.normalizeCellContext(e);const{column:t,record:i}=e;if(t!=null&&t.isVisible&&t.editor&&i&&!i.isSpecialRow&&!i.readOnly&&t.canEdit(i)){const r=i&&t.getRawValue(i);return Object.assign(e,{value:r===void 0?null:r,editor:t.editor}),e}else return!1}async startEditing(e={}){const t=this;if(!t.disabled){var i,r,n;const{grid:a}=t;if((i=e)!==null&&i!==void 0&&i.fromKeyMap&&(e=t.grid.focusedCell),T.isEmpty(e)&&(e.id=a.firstVisibleRow.id),a.store.isTree&&a.features.tree){var s;const f=e.id?a.store.getById(e.id):(s=e.record)!==null&&s!==void 0?s:a.store.getAt(e.row);if(f)await a.expandTo(f);else return!1}const o=t.getEditingContext(e);if(!o||(t.editorContext&&t.cancelEditing(),(r=a.focusedCell)!==null&&r!==void 0&&r.equals(o)||a.focusCell(o),a.trigger("beforeCellEditStart",{grid:a,editorContext:o})===!1))return!1;const l=o.editor=t.getEditorForCell(o),{row:d,cell:u,record:h}=o;return l.inputField.highlightExternalChange=!1,l.cellEditorContext=o,l.render(u),u.classList.add("b-editing"),d.addCls("b-editing"),await l.startEdit({target:u,field:l.inputField.name||o.column.field,value:o.value,record:h})||(u.classList.remove("b-editing"),d.removeCls("b-editing")),(n=t.onCellEditStart)===null||n===void 0||n.call(t),!0}return!1}cancelEditing(e=!1,t){var i;const r=this,{editorContext:n,editor:s}=r;e.fromKeyMap&&(t=e,e=!1),n&&(r.muteEvents=e,s.cancelEdit(t),r.muteEvents=!1),r.finishEditingPromise=!1,(i=r.afterCellEdit)===null||i===void 0||i.call(r)}async finishEditing(){const e=this,{editorContext:t,grid:i}=e;let r=!1;if(e.finishEditingPromise)return e.finishEditingPromise;if(t){var n;const{column:s}=t;e.finishEditingPromise=t.editor.completeEdit(s.bindCallback(s.finalizeCellEdit)),r=await e.finishEditingPromise,await i.waitForAnimations(),e.finishEditingPromise=null,(n=e.afterCellEdit)===null||n===void 0||n.call(e)}return r}async onCellClickWhileEditing({event:e,cellSelector:t}){const i=this;if(S.isTouchEvent){await i.finishEditing();return}i.finishEditingPromise||i.editorContext&&!i.editorContext.editor.owns(e.target)&&(i.getEditingContext(t)?await i.finishEditing()?i.continueEditingOnCellClick&&await i.startEditing(t):(i.grid.focusCell(i.editorContext),i.editor.inputField.focus()):await i.finishEditing())}async onCellClick({source:e,cellSelector:t,target:i,event:r,column:n}){if(n.onCellClick)return;const s=this,{focusedCell:a}=s.client;if(i.closest(".b-tree-expander"))return!1;S.isTouchEvent&&s._lastCellClicked===a?.cell&&r.timeStamp-s.touchEditDelay>s._lastCellClickedTime?await s.startEditing(t):this.triggerEvent==="cellclick"&&await s.onTriggerEditEvent({cellSelector:t,target:i}),s._lastCellClicked=a?.cell,s._lastCellClickedTime=r.timeStamp}onElementPointerUp(e){e.target.closest(".b-tree-expander")&&this.cancelEditing(void 0,e)}async onTriggerEditEvent({cellSelector:e,target:t,event:i}){var r;const{editorContext:n,client:s}=this;t.closest(".b-tree-expander")||S.isTouchEvent&&i.type==="dblclick"||i&&((r=s.features.cellMenu)===null||r===void 0?void 0:r.triggerEvent)===i.type||n&&(n.equals(this.grid.normalizeCellContext(e))||!await this.finishEditing())||await this.startEditing(e)}onStoreUpdate({changes:e,record:t}){const{editorContext:i}=this;i!=null&&i.editor.isVisible&&t===i.record&&i.editor.dataField in e&&i.editor.refreshEdit()}onStoreBeforeSort(){var e;const t=(e=this.editorContext)===null||e===void 0?void 0:e.editor;this.isEditing&&!(t!=null&&t.isFinishing)&&!t.isValid&&this.cancelEditing()}onGridRefreshed(){const e=this,{grid:t,editorContext:i}=e;if(i&&t.isVisible&&t.focusedCell){const r=t.getCell(t.focusedCell),{editor:n}=i;r&&S.isInView(r)&&!n.isFinishing?(i._cell=r,ue.suspendFocusEvents(),n.render(r),n.showBy(r),n.focus(),ue.resumeFocusEvents()):e.cancelEditing()}}get gridSelection(){return[...this.grid.selectedRecords,...this.grid.selectedCells]}isActionAvailable(e,t,i){const r=this;if(t=t.replace("cellEdit.",""),!r.disabled&&!i.target.closest(".b-grid-header")){if(r.isEditing){if(t==="finishAllSelected")return r.multiEdit&&r.gridSelection.length>1;if(L0[t])return!0}else if(t==="startEditing")return r.grid.focusedCell.cell===i.target}return!1}async finishAllSelected(){const e=this,{dataField:t,record:i}=e.editor;if(await e.finishEditing()&&!e.isDestroyed)for(const r of e.gridSelection)r.isModel?r!==i&&(r[t]=i[t]):r.record.set(r.column.field,i[t])}async finishAndEditNextRow(e,t=!1){const i=this,{grid:r}=i,{record:n}=i.editorContext;let s;if(await i.finishEditing()){if(i.isDestroyed)return;i.isEditing||(t?s=r.internalNextPrevRow(!1,!0,e,!1):(i.addNewAtEnd&&n===r.store.last&&await i.doAddNewAtEnd(),i.isDestroyed||(s=r.internalNextPrevRow(!0,!0,e))),s&&i.editNextOnEnterPress&&!r.touch&&i.startEditing(s))}}finishAndEditPrevRow(e){this.finishAndEditNextRow(e,!0)}async finishAndEditNextCell(e,t=!1){const i=this,{focusedCell:r}=i.grid;if(r){let n=i.getAdjacentEditableCell(r,!t);if(!n&&!t&&i.addNewAtEnd&&await i.finishEditing()===!0&&(await this.doAddNewAtEnd(),n=!i.isDestroyed&&i.getAdjacentEditableCell(r,!t)),n){let s=!0;i.isEditing&&(s=await i.finishEditing()),!i.isDestroyed&&s&&(i.grid.focusCell(n,{animate:i.focusCellAnimationDuration}),await i.startEditing(n)||await i.finishAndEditNextCell(e,t))}}}finishAndEditPrevCell(e){this.finishAndEditNextCell(e,!0)}async onElementKeyDown(e){const t=this,{grid:i}=t,{focusedCell:r}=i,{key:n}=e;if(!(e.handled||!t.autoEdit||t.isEditing||!r||r.isActionable||e.ctrlKey)){if(n.length<=1&&await t.startEditing(r)){const{inputField:s}=t.editor,{input:a}=s;a&&(s.internalOnKeyEvent(e),e.defaultPrevented||(a.value=n,s.internalOnInput(e))),e.preventDefault()}else if(e.key==="Delete"||e.key==="Backspace"){const{gridSelection:s}=t;if(t.multiEdit&&s.length>1)for(const a of s)a.isModel?i.visibleColumns.forEach(o=>{a.set(o.field,null)}):a.record.set(a.column.field,null);else r.record.set(r.column.field,null)}}}onEditorKeydown(e){if(e.key.startsWith("Arrow"))return e.handled=!0,e.stopPropagation(),!1}async onEditorFocusOut(e){const t=this,{grid:i,editor:r,editorContext:n}=t,s=new ne(e.relatedTarget),a=s.grid===i&&t.getEditingContext(s);n&&!r.isFinishing&&r.owns(e._target)&&(t.blurAction==="cancel"?t.cancelEditing(void 0,e):!t.finishEditingPromise&&(t.triggerEvent==="cellclick"||t.triggerEvent!=="cellclick"&&!a)&&await t.finishEditing())}onEditorFocusIn(e){const t=e.toWidget;t===this.editor.inputField&&this.autoSelect&&t.selectAll&&!t.readOnly&&!t.disabled&&t.selectAll()}async onTapOut({event:e}){const t=this;(!t.grid.bodyContainer.contains(e.target)||e.button)&&(t.editor.owns(e.target)||(t.editingStoppedByTapOutside=!0,t.blurAction==="cancel"?t.cancelEditing(void 0,e):await t.finishEditing(),delete t.editingStoppedByTapOutside))}async onElementClick(e){e.target.classList.contains("b-grid-body-container")&&this.editorContext&&await this.finishEditing()}}M(dd,"$name","CellEdit");dd._$name="CellEdit";G.registerFeature(dd,!0);class Va extends Aa{static get $name(){return"CellMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"cell"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateCellMenu"),e}showContextMenu(e){const t=this,{cellSelector:i,event:r}=e;t.client.focusCell(i,{doSelect:!t.client.isSelected(i),event:r}),super.showContextMenu(e)}shouldShowMenu({column:e}){return e&&e.enableCellContextMenu!==!1}getDataFromEvent(e){const t=this.client.getCellDataFromEvent(e);if(t)return T.assign(super.getDataFromEvent(e),t)}beforeContextMenuShow({record:e,items:t,column:i}){if(i.cellMenuItems===!1)return!1;(!e||e.isSpecialRow)&&(t.removeRow=!1)}populateCellMenu({items:e,column:t,record:i}){const{client:r}=this;t!=null&&t.cellMenuItems&&T.merge(e,t.cellMenuItems),r.readOnly||(e.removeRow={text:"L{removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",cls:"b-separator",weight:100,disabled:i.readOnly,onItem:()=>r.store.remove(r.selectedRecords.filter(n=>!n.readOnly))})}get showMenu(){return!0}}Va.featureClass="";Va._$name="CellMenu";G.registerFeature(Va,!0,["Grid","Scheduler"]);G.registerFeature(Va,!1,["Gantt"]);class ja extends te{construct(e,t){super.construct(e,this.processConfig(t))}initTip(){const e=this;e.tip=ce.new({forElement:e.client.element,forSelector:".b-grid-row:not(.b-group-row) .b-grid-cell, .b-grid-merged-cells",hoverDelay:1e3,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:e.getTooltipContent.bind(e),internalListeners:{pointerOver:"onPointerOver",thisObj:e},listeners:e.configuredListeners},e.initialConfig),e.relayEvents(e.tip,["beforeShow","show"])}onPointerOver({target:e}){const t=this.client.getColumnFromElement(e);return t.tooltipRenderer!==!1&&Boolean(t.tooltipRenderer||this.tooltipRenderer)}processConfig(e){return typeof e=="function"?{tooltipRenderer:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.tip&&this.tip.destroy(),super.doDestroy()}doDisable(e){e?this.tip&&(this.tip.destroy(),this.tip=null):this.initTip(),super.doDisable(e)}getTooltipContent({tip:e,activeTarget:t,event:i}){const r=this,n=r.client.getRecordFromElement(t),s=r.client.getColumnFromElement(t),a={cellElement:t,record:n,column:s,event:i,tip:e,cellTooltip:r};let o;return!r.forSelector&&n===r.lastRecord&&n.generation===r.lastRecordGeneration&&s===r.lastColumn?r.tip._html:(r.lastRecord=n,r.lastRecordGeneration=n.generation,r.lastColumn=s,s.tooltipRenderer?o=s.tooltipRenderer(a):r.tooltipRenderer&&s.tooltipRenderer!==!1&&(o=r.tooltipRenderer(a)),U.isPromise(o)&&(r.lastRecord=r.lastRecordGeneration=r.lastColumn=null),o)}}M(ja,"$name","CellTooltip");M(ja,"configurable",{tooltipRenderer:null});ja._$name="CellTooltip";G.registerFeature(ja);const Nh="store";class cd extends he(te){static get $name(){return"ColumnAutoWidth"}static get configurable(){return{default:null,delay:0}}static get pluginConfig(){return{after:{bindStore:"bindStore",unbindStore:"unbindStore",renderRows:"syncAutoWidthColumns",onInternalResize:"onInternalResize"},assign:["columnAutoWidthPending","syncAutoWidthColumns"]}}construct(e){super.construct(e);const{store:t}=this.client;t&&this.bindStore(t)}doDestroy(){this.unbindStore(),super.doDestroy()}bindStore(e){this.lastSync=null,e.ion({name:Nh,[`change${this.client.asyncEventSuffix}`]:"onStoreChange",thisObj:this})}unbindStore(){this.detachListeners(Nh)}get columnAutoWidthPending(){return this.lastSync===null||this.hasTimeout("syncAutoWidthColumns")}onStoreChange({action:e}){if(e!=="move"){const t=this,{cellEdit:i}=t.client.features;++t.storeGeneration,i!=null&&i.isEditing&&!i.editingStoppedByTapOutside?t.syncAutoWidthColumns():t.hasTimeout("syncAutoWidthColumns")||t.setTimeout("syncAutoWidthColumns",t.delay)}}onInternalResize(e,t,i,r){r===0&&(this.lastSync=null,this.syncAutoWidthColumns())}syncAutoWidthColumns(){const e=this,t=e.client,i=e.storeGeneration;if(e.lastSync!==i){e.lastSync=i;let r,n;for(const s of t.columns.visibleColumns)r=s.autoWidth,r&&(r===!0&&(r=e.default),t.resizingColumns=n=!0,s.resizeToFitContent(r));n&&(t.resizingColumns=!1,t.afterColumnsResized())}e.hasTimeout("syncAutoWidthColumns")&&e.clearTimeout("syncAutoWidthColumns")}}cd.prototype.storeGeneration=0;cd._$name="ColumnAutoWidth";G.registerFeature(cd,!0);class ud extends he(te){static get $name(){return"ColumnDragToolbar"}static get pluginConfig(){return{after:["render"]}}construct(e,t){var i;(i=e.features.columnReorder)===null||i===void 0||i.ion({beforeDestroy:"onColumnReorderBeforeDestroy",thisObj:this}),this.grid=e,super.construct(e,t)}doDestroy(){const e=this;e.grid.features.columnReorder&&!e.grid.features.columnReorder.isDestroyed&&e.detachFromColumnReorder(),e.element&&e.element.remove(),e.element=null,super.doDestroy()}doDisable(e){this.initialized&&(e?this.detachFromColumnReorder():this.init()),super.doDisable(e)}init(){const e=this,t=e.grid;!t.features.columnReorder||(e.reorderDetacher=t.features.columnReorder.ion({gridheaderdragstart({context:i}){const r=t.columns.getById(i.element.dataset.columnId);e.showToolbar(r)},gridheaderdrag:({context:i})=>e.onDrag(i),gridheaderabort:()=>{e.hideToolbar()},gridheaderdrop:({context:i})=>{i.valid?e.hideToolbar():e.onDrop(i)},thisObj:e}),e.initialized=!0)}onColumnReorderBeforeDestroy(){this.detachFromColumnReorder()}detachFromColumnReorder(){const e=this;e.grid.features.columnReorder.un("beforedestroy",e.onColumnReorderBeforeDestroy,e),e.reorderDetacher&&e.reorderDetacher(),e.reorderDetacher=null}render(){this.initialized||this.init()}showToolbar(e){const t=this,i=t.grid.getColumnDragToolbarItems(e,[]),r=[];t.clearTimeout(t.buttonHideTimer),i.forEach(n=>{n.text=n.localeClass.L(n.text);let s=r.find(a=>a.text===n.group);s||(s={text:n.localeClass.L(n.group),buttons:[]},r.push(s)),s.buttons.push(n)}),t.element=S.append(t.grid.element,t.template(r)),t.groups=r,t.buttons=i,t.column=e}async hideToolbar(){const e=this,t=e.element;t&&(t.classList.add("b-remove"),await B.waitForTransitionEnd({element:t,mode:"animation",thisObj:e.client}),t.remove(),e.element=null)}onDrag(e){var t;const i=this;if(e.dragProxy.getBoundingClientRect().top-i.grid.element.getBoundingClientRect().top>100?i.element.classList.add("b-closer"):i.element.classList.remove("b-closer"),i.hoveringButton&&(i.hoveringButton.classList.remove("b-hover"),i.hoveringButton=null),(t=e.targetElement)!==null&&t!==void 0&&t.closest(".b-columndragtoolbar")){i.element.classList.add("b-hover");const r=e.targetElement.closest(".b-columndragtoolbar  .b-target-button:not([data-disabled=true])");r&&(r.classList.add("b-hover"),i.hoveringButton=r)}else i.element.classList.remove("b-hover")}onDrop(e){const t=this;if(e.targetElement&&e.targetElement.matches(".b-columndragtoolbar .b-target-button:not([data-disabled=true])")){const i=e.targetElement,r=t.buttons.find(n=>n.ref===i.dataset.ref);r&&(i.classList.add("b-activate"),t.buttonHideTimer=t.setTimeout(()=>{t.hideToolbar(),r.onDrop({column:t.column})},100))}else t.hideToolbar()}template(e){return bt.tpl`
            <div class="b-columndragtoolbar">     
            <div class="b-title"></div>          
            ${e.map(t=>bt.tpl`
                <div class="b-group">
                    <div class="b-buttons">
                    ${t.buttons.map(i=>bt.tpl`
                        <div class="b-target-button" data-ref="${i.ref}" data-disabled="${i.disabled}">
                            <i class="${i.icon}"></i>
                            ${i.text}
                        </div>
                    `)}
                    </div>
                    <div class="b-title">${t.text}</div>
                </div>
            `)}
            </div>`}}ud.featureClass="b-hascolumndragtoolbar";ud._$name="ColumnDragToolbar";G.registerFeature(ud,K.isTouchDevice);class Wa extends te{static get pluginConfig(){return{chain:["populateHeaderMenu","getColumnDragToolbarItems"]}}get grid(){return this.client}getColumnPickerItems(e){const t=this,{createColumnsFromModel:i}=t;let r;if(t.groupByRegion)r=t.grid.regions.map(n=>{const s=t.grid.getSubGrid(n).columns.topColumns;return{text:z.capitalize(n),menu:t.buildColumnMenu(s),disabled:s.length===0,region:n}}),i&&r.push({text:t.L("L{newColumns}"),menu:t.createAutoColumnItems()});else if(t.groupByTag){const n={};e.topColumns.forEach(s=>{s.tags&&Array.isArray(s.tags)&&s.hideable!==!1&&s.tags.forEach(a=>{n[a]||(n[a]=1)})}),r=Object.keys(n).sort().map(s=>({text:z.capitalize(s),menu:t.buildColumnMenu(t.getColumnsForTag(s)),tag:s,onBeforeSubMenu:({item:a,itemEl:o})=>{t.refreshTagMenu(a,o)}})),i&&r.push({text:t.L("L{newColumns}"),menu:t.createAutoColumnItems()})}else r=t.buildColumnMenu(e.topColumns),i&&r.items.push(...T.transformNamedObjectToArray(t.createAutoColumnItems()));return r}createAutoColumnItems(){const e=this,{grid:t}=e,{columns:i,store:r}=t,{modelClass:n}=r,{allFields:s}=n,a={};for(let o=0,{length:l}=s;o<l;o++){const d=s[o],u=d.name;i.get(u)||d.internal||(a[u]={text:d.text||z.separate(d.name),checked:!1,onToggle:h=>{const f=i.get(u);f?f[h.checked?"show":"hide"]():i.add(i.generateColumnForField(d,{region:e.forColumn.region})),h.bubbles=!1}})}return a}getColumnsForTag(e){return this.grid.columns.records.filter(t=>t.tags&&Array.isArray(t.tags)&&t.tags.includes(e)&&t.hideable!==!1)}refreshTagMenu(e,t){this.getColumnsForTag(e.tag).forEach(r=>{const n=e.items.find(s=>s.column===r);n&&(n.checked=r.hidden!==!0)})}buildColumnMenu(e){let t=e.length>0&&e[0].region;const{grid:i}=this,r=e.reduce((n,s)=>{const a=i.columns.visibleColumns.filter(o=>o.region===s.region);if(s.hideable!==!1){const o={grid:i,column:s,text:s.headerText,checked:s.hidden!==!0,disabled:s.hidden!==!0&&a.length===1,cls:s.region!==t?"b-separator":""};t=s.region,s.children&&!s.isCollapsible&&(o.menu=this.buildColumnMenu(s.children)),n.push(o)}return n},[]);return{cls:this.menuCls,items:r}}populateHeaderMenu({column:e,items:t}){const i=this,{columns:r}=i.grid;if(i.forColumn=e,e.showColumnPicker!==!1&&r.some(n=>n.hideable)&&(t.columnPicker={text:"L{columnsMenu}",localeClass:i,icon:"b-fw-icon b-icon-columns",cls:"b-separator",weight:200,menu:i.getColumnPickerItems(r),onToggle:i.onColumnToggle,disabled:i.disabled}),e.hideable!==!1&&!e.parent.isCollapsible){const n=r.visibleColumns.filter(s=>s.region===e.region);t.hideColumn={text:"L{hideColumn}",localeClass:i,icon:"b-fw-icon b-icon-hide-column",weight:210,disabled:n.length===1||i.disabled,onItem:()=>e.hide()}}}onColumnToggle({menu:e,item:t,checked:i}){if(Boolean(t.column.hidden)!==!i){var r,n;t.column[i?"show":"hide"]();const{grid:s,column:a}=t,{columns:o,features:l}=s,d=e.items,u=o.visibleColumns.filter(g=>g.region===t.column.region),h=((r=l.headerMenu)===null||r===void 0?void 0:r.enabled)&&l.headerMenu.menu.widgetMap.hideColumn;if(u.length===1){const g=d.find(m=>m.column===u[0]);g&&(g.disabled=!0),h&&a.region===t.column.region&&(h.disabled=!0)}else u.forEach(g=>{const m=d.find(p=>p.column===g);m&&(m.disabled=!1)}),h&&a.region===t.column.region&&(h.disabled=!1);(n=t.menu)===null||n===void 0||n.eachWidget(g=>{g.checked=i});const f=e.owner;f&&f.column===a.parent&&(f.checked=d.some(g=>g.checked===!0))}}getColumnDragToolbarItems(e,t){const i=this.grid.columns.visibleColumns.filter(r=>r.region===e.region);return e.hideable!==!1&&i.length>1&&t.push({text:"L{hideColumnShort}",ref:"hideColumn",group:"L{column}",localeClass:this,icon:"b-fw-icon b-icon-hide-column",weight:101,onDrop:({column:r})=>r.hide()}),t}}M(Wa,"$name","ColumnPicker");M(Wa,"configurable",{groupByRegion:!1,groupByTag:!1,createColumnsFromModel:!1,menuCls:"b-column-picker-menu b-sub-menu"});Wa._$name="ColumnPicker";G.registerFeature(Wa,!0);class Ua extends te{doDestroy(){var e;(e=this.editor)===null||e===void 0||e.destroy(),super.doDestroy()}static get pluginConfig(){return{after:["populateHeaderMenu"]}}populateHeaderMenu({items:e,column:t}){e.rename={weight:215,icon:"b-fw-icon b-icon-edit",text:this.L("L{rename}"),disabled:t.readOnly,onItem:()=>this.startEdit(t)}}startEdit(e){if(e instanceof Event){var t;e=(t=this.client.getHeaderDataFromEvent(e))===null||t===void 0?void 0:t.column}if(e){if(e.readOnly)return!1;const{textWrapper:i}=e;let{editor:r}=this;r||(this.editor=r=new Gt({owner:this.client,align:{align:"t0-t0"}})),r.render(i),r.startEdit({target:i,record:e,field:"text"})}}}M(Ua,"$name","ColumnRename");M(Ua,"configurable",{keyMap:{F2:"startEdit"}});Ua._$name="ColumnRename";G.registerFeature(Ua,!1);class Ya extends he(te){constructor(...e){super(...e),M(this,"ignoreSelectors",[".b-grid-header-resize-handle",".b-field"])}doDestroy(){var e,t;(e=this.dragHelper)===null||e===void 0||e.scrollManager.destroy(),(t=this.dragHelper)===null||t===void 0||t.destroy(),super.doDestroy()}get grid(){return this.client}init(){const e=this,{grid:t}=e,i=t.element,r=S.children(i,".b-grid-headers");r.push(...S.children(i,".b-grid-header-children")),e.dragHelper?e.dragHelper.containers=r:(e.dragHelper=new Yn({name:"columnReorder",mode:"container",dragThreshold:10,targetSelector:".b-grid-header",floatRootOwner:t,rtlSource:t,outerElement:t.headerContainer,monitoringConfig:{scrollables:[{element:".b-grid-headers"}]},scrollManager:Pa.new({direction:"horizontal",element:t.headerContainer}),containers:r,isElementDraggable(n){if(Boolean(n.closest(e.ignoreSelectors.join(",")))||e.disabled)return!1;const a=n.closest(this.targetSelector),o=a&&t.columns.getById(a.dataset.columnId),l=o?.childLevel===0&&t.subGrids[o.region].columns.count===1;return Boolean(o)&&o.draggable!==!1&&!l},ignoreSelector:".b-filter-icon,.b-grid-header-resize-handle",internalListeners:{beforeDragStart:e.onBeforeDragStart,dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,thisObj:e}}),e.relayEvents(e.dragHelper,["dragStart","drag","drop","abort"],"gridHeader"))}static get pluginConfig(){return{after:["onPaint","renderContents"]}}onDrag({context:e,event:t}){const i=this,r=N.fromElement(t.target,"gridheader");if(r!=null&&r.subGrid.sealedColumns){e.valid=!1;return}i.grid.features.columnDragToolbar||(e.valid=Boolean(t.target.closest(".b-grid-headers")))}onBeforeDragStart({context:e,event:t}){const{element:i}=e,r=e.column=this.client.columns.getById(i.dataset.columnId);return this.client.trigger("beforeColumnDragStart",{column:r,event:t})}onDragStart({context:e,event:t}){const i=this,{grid:r}=i,{column:n}=e;if(!r.features.columnDragToolbar){const s=r.element.querySelector(".b-grid-header-container").getBoundingClientRect();i.dragHelper.minY=s.top,i.dragHelper.maxY=s.bottom}r.headerContainer.classList.add("b-dragging-header"),e.dragProxy.style.fontSize=S.getStyleValue(e.element,"fontSize"),r.trigger("columnDragStart",{column:n,event:t})}onDrop({context:e,event:t}){if(!e.valid)return this.onInvalidDrop({context:e});const i=this,{grid:r}=i,n=e.dragging,s=e.target.closest(".b-grid-header"),a=e.draggedTo.dataset.region,o=s?r.columns.get(s.dataset.column):r.subGrids[a].columns.last,l=a||o.region,d=e.insertBefore,u=r.columns.getById(n.dataset.columnId),h=u.parent,f=d?r.columns.getById(d.dataset.columnId):r.subGrids[l].columns.last.nextSibling;let g;if(f)g=f.parent;else{const p=s?.parentElement.closest(".b-grid-header");p?g=r.columns.getById(p.dataset.columnId):g=r.columns.rootNode}r.headerContainer.classList.remove("b-dragging-header"),n.remove();let m=l===u.region&&h===g&&(o===u.previousSibling||f===u.nextSibling);m=m||r.trigger("beforeColumnDropFinalize",{column:u,newParent:g,insertBefore:f,event:t})===!1,m||(m=!g.insertChild(u,f)),e.valid=!m,m||(u.region=l,h.children.length===0&&h.parent.removeChild(h)),r.trigger("columnDrop",{column:u,newParent:g,insertBefore:f,valid:e.valid,event:t})}onInvalidDrop(){this.grid.headerContainer.classList.remove("b-dragging-header")}renderContents(){this.init()}onPaint(){this.init()}}M(Ya,"$name","ColumnReorder");Ya.featureClass="b-column-reorder";Ya._$name="ColumnReorder";G.registerFeature(Ya,!0);class vm extends te{static get $name(){return"ColumnResize"}static get configurable(){return{liveResize:"auto"}}construct(e,t){const i=this;i.grid=e,super.construct(e,t),i.resizer=new La({name:"columnResize",targetSelector:".b-grid-header",handleSelector:".b-grid-header-resize-handle",outerElement:e.element,rtlSource:e,internalListeners:{beforeresizestart:i.onBeforeResizeStart,resizestart:i.onResizeStart,resizing:i.onResizing,resize:i.onResize,cancel:i.onCancel,thisObj:i}})}doDestroy(){var e;(e=this.resizer)===null||e===void 0||e.destroy(),super.doDestroy()}changeLiveResize(e){return e==="auto"?!K.isMobileSafari:e}onBeforeResizeStart(){return!this.disabled}onResizeStart({context:e}){const{grid:t,resizer:i}=this,r=e.column=t.columns.getById(e.element.dataset.columnId);i.minWidth=r.minWidth,t.element.classList.add("b-column-resizing")}onResizing({context:e}){e.valid&&this.liveResize&&(this.grid.resizingColumns=!0,e.column.width=e.newWidth)}onResize({context:e}){const{grid:t}=this,{column:i}=e;t.element.classList.remove("b-column-resizing"),e.valid&&(this.liveResize?(t.resizingColumns=!1,t.afterColumnsResized(i)):i.width=e.newWidth)}onCancel({context:e}){const{grid:t}=this;t.element.classList.remove("b-column-resizing"),e.column.width=e.elementWidth,t.resizingColumns=!1}}vm._$name="ColumnResize";G.registerFeature(vm,!0);class ts extends te.mixin(he){constructor(...e){super(...e),M(this,"delayable",{handleSelection:"raf"})}afterConstruct(){super.afterConstruct(),this.client.selectionMode.cell||(this.disabled=!0),this._fillListeners={}}onContentChange(){this.handleSelection()}afterColumnsChange(){this.handleSelection()}fixElementHeights(){this.handleSelection()}getCellDataFromEvent(e,t){return t&&(t=!e.target.classList.contains("b-fill-handle")),this.overridden.getCellDataFromEvent(e,t)}findPatternsIn2dRange(e,t,i){const r={};for(const n of e){const s=t?n.id:n.columnId;let a=n.record[n.column.field];a&&typeof a=="string"&&!isNaN(a)&&(a=parseFloat(a)),r[s]||(r[s]=[]),r[s].push(a)}for(const n in r)r[n].pattern=this.findPatternsIn1dRange(r[n],i);return r}findPatternsIn1dRange(e,t){const i=e[t?0:e.length-1],r={next:()=>i,lastValue:i};if(e.every(n=>typeof n=="number")||e.every(n=>n instanceof Date)){const n=e.map((s,a)=>s-e[a-1]);n.shift(),new Set(n).size===1&&(r.increaseBy=n[0]*(t?-1:1),r.next=()=>(r.lastValue instanceof Date?r.lastValue=new Date(r.lastValue.getTime()+r.increaseBy):r.lastValue+=r.increaseBy,r.lastValue))}else e.length>1&&(r.stringPattern=[...e],r.next=()=>(r.currentIndex===void 0?r.currentIndex=0:(r.currentIndex+=1,r.currentIndex>=r.stringPattern.length&&(r.currentIndex=0)),r.stringPattern[r.currentIndex]));return r}afterSelectionChange(){const e=this;ue.isMouseDown()?(e.client.delayUntilMouseUp(()=>e.handleSelection(!0)),e.removeElements()):e.handleSelection(!0)}handleSelection(){if(!this._isExtending){const e=this.rangeSelection;e?this.drawFillHandleAndBorder(e[0],e[e.length-1]):this.removeElements()}}onMouseDown(e){this._fillListeners.mouseMoveOrUp=B.on({element:globalThis,mouseover:"onMouseOver",mouseup:"onMouseUp",thisObj:this}),e.stopImmediatePropagation(),e.handled=!0}onMouseUp(){const e=this,{client:t,currentRange:i,_isCropping:r}=e,n=e.rangeSelection,s=n&&i&&t.internalSelectRange(i.from,i.to),a=s?.selectedCells||[],o=r?e.croppingCells:a.filter(u=>!n.some(h=>h.equals(u,!0)));if(delete e._isCropping,e._isExtending&&(t.disableScrollingCloseToEdges(t.items),delete e._isExtending),!(o!=null&&o.length)){e.handleSelection();return}if(t.suspendRefresh(),r)o.forEach(u=>u.record.set(u.column.field,null,!1,!1,!1,!0));else{const[u]=o,h=n.some(p=>p.record===u.record),f=h?u.columnIndex<n[0].columnIndex:u.rowIndex<n[0].rowIndex,g=e.findPatternsIn2dRange(n,h,f),m=new Map;f&&o.reverse();for(const p of o){const{column:v,record:y}=p;if(v.canFillValue({range:n,record:y,cell:p})){var l,d;let C=(l=e.calculateFillValue)===null||l===void 0?void 0:l.call(e,{range:n,column:v,record:y,cell:p}),D=m.get(y);D||(D={},m.set(y,D)),C===void 0&&(C=g[h?p.id:p.columnId].pattern.next()),D[v.field]=((d=v.calculateFillValue)===null||d===void 0?void 0:d.call(v,{value:C,record:y,range:n}))||C}}for(const[p,v]of m)p.set(v,null,null,null,null,!0)}t.resumeRefresh(!0),t.performSelection(s),delete e.currentRange,e.handleSelection()}onMouseOver(e){var t,i;const r=this,{client:n,rangeSelection:s}=r,a=s[0],o=s[s.length-1],l=n.getCellDataFromEvent(e,!0);let d=l&&n.normalizeCellContext(l.cellSelector);if(((t=d)===null||t===void 0||(i=t._column)===null||i===void 0?void 0:i.region)===a._column.region){const u=s.some(m=>m.equals(d,!0));let h;r._isExtending||n.enableScrollingCloseToEdges(n.items),u?r._isCropping=r.allowCropping&&(d.rowIndex<o.rowIndex||d.columnIndex<o.columnIndex):d.rowIndex>=a.rowIndex&&d.rowIndex<=o.rowIndex?(h=a.columnIndex>d.columnIndex,d=new ne({grid:n,record:h?a.record:o.record,column:d.column})):(h=a.rowIndex>d.rowIndex,d=new ne({grid:n,record:d.record,column:h?a.column:o.column}));const f=h?d:a,g=h||u&&!r._isCropping?o:d;r.currentRange={from:f,to:g},r._isExtending=!0,r.drawFillHandleAndBorder(f,g,!0)}}drawFillHandleAndBorder(e,t,i=!1){var r;const n=this,{client:s,currentRange:a,_fillListeners:o}=n,l=s.subGrids[e.column.region].element,{x:d}=$.from(e.cell||e.column.element,l),{right:u}=$.from(t.cell||t.column.element,l),{y:h}=s.getRecordCoords(e.record,!0),f=s.getRecordCoords(t.record,!0).bottom-1;let{borderElement:g,handleElement:m}=n;if(n.removeElements(i),g||(n.borderElement=g=S.createElement({className:"b-fill-selection-border"}),n.handleElement=m=S.createElement({className:"b-fill-handle"})),S.setRect(g,{y:h,x:d,width:u-d,height:f-h}),l.appendChild(g),S.setTopLeft(m,f,u>=l.scrollWidth?d:u),l.appendChild(m),n.toggleCroppingCls(!1),delete n.croppingCells,n._isCropping&&(r=n.rangeSelection)!==null&&r!==void 0&&r.length){const p=s.getRange(a.from,a.to);n.croppingCells=n.rangeSelection.filter(v=>!p.some(y=>y.equals(v,!0))),n.toggleCroppingCls()}o.handleClick||(o.handleClick=B.on({element:globalThis,delegate:".b-fill-handle",mousedown:"onMouseDown",thisObj:n})),n.hasFillElements=!0}toggleCroppingCls(e=!0){var t;(t=this.croppingCells)===null||t===void 0||t.forEach(i=>{var r;return(r=this.client.getCell(i))===null||r===void 0?void 0:r.classList.toggle("b-indicate-crop",e)})}removeElements(e=!1){var t,i;const r=this;(t=r.handleElement)===null||t===void 0||t.remove(),(i=r.borderElement)===null||i===void 0||i.remove(),e||r.removeListeners(),r.hasFillElements=!1}removeListeners(){const e=this;for(const t in e._fillListeners)e._fillListeners[t]();e._fillListeners={}}get rangeSelection(){var e;const{client:t}=this,{selectedCells:i}=t,r=(e=t._shiftSelectRange)!==null&&e!==void 0?e:i.length===1&&i;return!t.selectedRecords.length&&r!==null&&r!==void 0&&r.length&&r.length===i.length&&r.every(n=>i.some(s=>n.equals(s,!0))&&n._column.parent&&n._column.region===r[0]._column.region&&t.store.isAvailable(n.id))?r:null}}M(ts,"$name","FillHandle");M(ts,"configurable",{calculateFillValue:null,allowCropping:!1});M(ts,"pluginConfig",{chain:["afterSelectionChange","onContentChange","afterColumnsChange","fixElementHeights"],override:["getCellDataFromEvent"]});ts._$name="FillHandle";G.registerFeature(ts);class Tr extends ee{static get $name(){return"GridFieldFilterPicker"}static get type(){return"gridfieldfilterpicker"}afterConstruct(){var e;const t=this;if(!t.grid)throw new Error(`${t.constructor.$name} requires 'grid' to be configured.`);t.fields=(e=t.fields)!==null&&e!==void 0?e:{},super.afterConstruct()}updateGrid(e){var t;if(!((t=e.store)!==null&&t!==void 0&&t.modelClass))throw new Error("Grid does not have a store with a modelClass defined.");if(!e.columns)throw new Error("Grid does not have a column store.")}static getModelClassFields(e){const t=new Set(e.fields.map(({name:i})=>i));return e?.allFields.filter(i=>!i.internal&&(Qg.includes(i.type)||Vl(i))&&(i.definedBy!==de||t.has(i.name)))||[]}static getColumnFields(e,t,i){var r;const n=W.keyBy(Tr.getModelClassFields(t),"name"),s=i&&new Set(i);return Object.fromEntries((r=e?.records.filter(({field:a})=>a&&n[a]&&(!s||s.has(a))).map(({field:a,text:o})=>[a,{title:o||a,type:Vl(n[a])?"duration":n[a].type}]))!==null&&r!==void 0?r:[])}changeFields(e){var t;let i=e;return Array.isArray(e)&&(ae.deprecate("Core","6.0.0","FieldOption[] deprecated, use Object<String, FieldOption[]> keyed by field name instead"),i=W.keyBy(i,"name")),T.merge({},Tr.getColumnFields(this.grid.columns,(t=this.grid.store)===null||t===void 0?void 0:t.modelClass,this.allowedFieldNames),i)}}M(Tr,"configurable",{grid:null,allowedFieldNames:null});Tr.initClass();Tr._$name="GridFieldFilterPicker";class Ga extends vt{static get $name(){return"GridFieldFilterPickerGroup"}static get type(){return"gridfieldfilterpickergroup"}validateConfig(){if(!this.grid)throw new Error(`${this.constructor.$name} requires the 'grid' config property.`)}getFilterPickerConfig(e){const{grid:t,allowedFieldNames:i}=this;return F(F({},super.getFilterPickerConfig(e)),{},{grid:t,allowedFieldNames:i})}updateGrid(e){this.store=this.grid.store}canManage(e){const t=this;return super.canManage(e)&&(!t.allowedFieldNames||t.allowedFieldNames.includes(e.property))}}M(Ga,"configurable",{grid:null,allowedFieldNames:null});M(Ga,"childPickerType","gridfieldfilterpicker");Ga.initClass();Ga._$name="GridFieldFilterPickerGroup";const ml={date:"date",int:"number",integer:"number",number:"number",string:"text",duration:"duration"};class ym extends te{static get $name(){return"Filter"}static get configurable(){return{prioritizeColumns:!1,keyMap:{f:"showFilterEditorByKey"},isMulti:!1}}construct(e,t){if(e.features.filterBar)throw new Error("Grid.feature.Filter feature may not be used together with Grid.feature.FilterBar. These features are mutually exclusive.");const i=this;if(i.grid=e,i.closeFilterEditor=i.closeFilterEditor.bind(i),super.construct(e,t),i.bindStore(e.store),t&&typeof t=="object"){const r=T.clone(t);delete r.prioritizeColumns,delete r.isMulti,delete r.dateFormat,T.isEmpty(r)||e.store.filter(r,null,e.isConfiguring)}}doDestroy(){var e,t;(e=this.filterTip)===null||e===void 0||e.destroy(),(t=this.filterEditorPopup)===null||t===void 0||t.destroy(),super.doDestroy()}get store(){return this.grid.store}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}static get pluginConfig(){return{chain:["renderHeader","populateCellMenu","populateHeaderMenu","onElementClick","bindStore"]}}refreshHeaders(e){const t=this,i=t.grid,r=i.headerContainer;r&&(S.children(r,".b-filter-icon.b-latest").forEach(n=>n.classList.remove("b-latest")),t.filterTip||(t.filterTip=new ce({forElement:r,forSelector:".b-filter-icon",getHtml({activeTarget:n}){return n.dataset.filterText}})),i.store.isFiltered||t.filterTip.hide(),i.columns.visibleColumns.forEach(n=>{if(n.filterable!==!1){const s=t.store.filters.allValues.filter(({property:l,disabled:d,internal:u})=>l===n.field&&!d&&!u),a=s.length>0,o=n.element;if(o){const l=n.textWrapper;let d=l?.querySelector(".b-filter-icon"),u;if(a){const h="&#x2022 ";u=`${t.L("L{filter}")}: `+(s.length>1?"<br/><br/>":"")+s.map(f=>{var g,m,p;let v=(g=f.value)!==null&&g!==void 0?g:"";const y=Array.isArray(v),C=(m=t.store)===null||m===void 0||(p=m.modelRelations)===null||p===void 0?void 0:p.find(({foreignKey:w})=>w===f.property);if(f.displayValue)v=f.displayValue;else{if(t.isMulti&&C){var D;const{relatedDisplayField:w}=(D=t.isMulti.fields)===null||D===void 0?void 0:D[f.property];w&&(y?v=v[w].sort((R,x)=>(R??"").localeCompare(x??"")):v=(R=>{var x;return(x=C.foreignStore.getById(R))===null||x===void 0?void 0:x[w]})(v))}else n.formatValue&&v&&(v=y?v.map(w=>n.formatValue(w)):n.formatValue(v));y&&(v=`[ ${v.join(", ")} ]`)}return(s.length>1?h:"")+(typeof f=="string"?f:`${f.operator} ${v}`)}).join("<br/><br/>")}else u=t.L("L{applyFilter}");d?d.dataset.filterText=u:d=S.createElement({parent:l,tag:"div",className:"b-filter-icon",dataset:{filterText:u}}),n.field===t.store.latestFilterField&&d.classList.add("b-latest"),o.classList.add("b-filterable"),o.classList.toggle("b-filter",a)}n.meta.isFiltered=a}}),e&&i.refreshRows())}applyFilter(e,t){const{store:i}=this,{filterFn:r}=e.filterable;e.$filter=i.addFilter(F(F(F({},e.filterable),t),{},{property:e.field,[r?"filterBy":"_"]:function(n){return r({value:this.value,record:n,operator:this.operator,property:this.property,column:e})}}),!0),i.filter()}removeFilter(e){if(this.isMulti)for(const t of this.getCurrentMultiFilters(e))this.store.removeFilter(t);else this.store.removeFilter(e.field)}disableFilter(e){for(const t of this.getCurrentMultiFilters(e))t.disabled=!0,this.store.filter(t);this.store.filter()}getCurrentMultiFilters(e){return this.store.filters.values.filter(t=>t.property===e.field)}getPopupDateItems(e,t,i,r,n,s,a,o){const l=this,d=s;function u(){l.removeFilter(e)}function h({event:g}){g.key==="Enter"&&s()}function f({source:g,value:m}){m==null?u():(l.clearSiblingsFields(g),l.applyFilter(e,{operator:g.operator,value:m,displayValue:g._value,type:"date"}))}return[T.assign({type:"date",ref:"on",placeholder:"L{on}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:i?.operator==="sameDay"?i.value:r,operator:"sameDay",onKeydown:h,onChange:f,onClose:d,onClear:u},o),T.assign({type:"date",ref:"before",placeholder:"L{before}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-before"></i>',value:i?.operator==="<"?i.value:null,operator:"<",onKeydown:h,onChange:f,onClose:d,onClear:u},o),T.assign({type:"date",ref:"after",cls:"b-last-row",placeholder:"L{after}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-after"></i>',value:i?.operator===">"?i.value:null,operator:">",onKeydown:h,onChange:f,onClose:d,onClear:u},o)]}getPopupNumberItems(e,t,i,r,n,s,a,o){const l=this,d=s;function u(){l.removeFilter(e)}function h({event:g}){g.key==="Enter"&&s()}function f({source:g,value:m}){m==null?u():(l.clearSiblingsFields(g),l.applyFilter(e,{operator:g.operator,value:m}))}return[T.assign({type:"number",placeholder:"L{Filter.equals}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:i?.operator==="="?i.value:r,operator:"=",onKeydown:h,onChange:f,onEsc:d,onClear:u},o),T.assign({type:"number",placeholder:"L{lessThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:i?.operator==="<"?i.value:null,operator:"<",onKeydown:h,onChange:f,onEsc:d,onClear:u},o),T.assign({type:"number",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:i?.operator===">"?i.value:null,operator:">",onKeydown:h,onChange:f,onEsc:d,onClear:u},o)]}clearSiblingsFields(e){var t;(t=this.filterEditorPopup)===null||t===void 0||t.items.forEach(i=>{i!==e&&i?.clear()})}getPopupDurationItems(e,t,i,r,n,s,a,o){const l=this,d=s,u=()=>l.removeFilter(e);l.removeFilter(e);function h({source:f,value:g}){l.clearSiblingsFields(f),l.applyFilter(e,{operator:f.operator,value:g})}return[T.assign({type:"duration",placeholder:"L{Filter.equals}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:i?.operator==="="?i.value:r,operator:"=",onChange:h,onEsc:d,onClear:u},o),T.assign({type:"duration",placeholder:"L{lessThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:i?.operator==="<"?i.value:null,operator:"<",onChange:h,onEsc:d,onClear:u},o),T.assign({type:"duration",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:i?.operator===">"?i.value:null,operator:">",onChange:h,onEsc:d,onClear:u},o)]}getPopupStringItems(e,t,i,r,n,s,a,o){const l=this;return[T.assign({type:t,cls:"b-last-row",placeholder:"L{filter}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:i?i.value||i:r,operator:"*",onChange({source:d,value:u}){u===""?a():(l.applyFilter(e,{operator:d.operator,value:u,displayValue:d.displayField&&d.records?d.records.map(h=>h[d.displayField]).join(", "):void 0}),d.multiSelect||s())},onClose:s,onClear:a},o)]}getPopupItems(e,t,i,r,n,s,a,o){const l=this;if(l.isMulti)return l.getMultiFilterPopupItems(...arguments);switch(t){case"date":return l.getPopupDateItems(...arguments);case"number":return l.getPopupNumberItems(...arguments);case"duration":return l.getPopupDurationItems(...arguments);default:return l.getPopupStringItems(...arguments)}}getMultiFilterPopupItems(e){var t;const{grid:i,isMulti:r}=this,n=(t=i.store)===null||t===void 0?void 0:t.filters.find(s=>s.property===e.field);return[F(F({},typeof r=="object"?r:void 0),{},{type:"gridfieldfilterpickergroup",ref:"pickerGroup",limitToProperty:e.field,grid:i,filters:n?[]:[{property:e.field}],propertyFieldCls:"b-transparent property-field",operatorFieldCls:"b-transparent operator-field",valueFieldCls:"b-transparent value-field",width:"400px"})]}showFilterEditor(e,t){e=this.grid.columns.getById(e);const i=this,{store:r,isMulti:n}=i,s=e.element,a=r.filters.getBy("property",e.field),o=i.getFilterType(e);if(e.filterable===!1)return;i.closeFilterEditor();const l=i.getPopupItems(e,o,a!=null&&a.internal?null:a,t,r,i.closeFilterEditor,()=>{i.removeFilter(e),i.closeFilterEditor()},e.filterable.filterField,n);l.forEach(d=>d.placeholder=d.placeholder?this.L(d.placeholder):d.placeholder),i.filterEditorPopup=Zi.openPopup(s,{owner:i.grid,cls:"b-filter-popup",scrollAction:"realign",layout:{type:"vbox",align:"stretch"},items:l})}closeFilterEditor(){var e;(e=this.filterEditorPopup)===null||e===void 0||e.setTimeout(this.filterEditorPopup.destroy),this.filterEditorPopup=null}getFilterType(e){const t=e.field,i=this.client.store.modelClass.getFieldDefinition(t),r=e.filterType;return r?ml[r]:ml[e.type]||i&&ml[i.type]||"text"}populateCellMenuWithDateItems({column:e,record:t,items:i}){const r=e.field;if(this.getFilterType(e)==="date"){const s=this,a=t[r],o=l=>{s.applyFilter(e,{operator:l,value:a,displayValue:e.formatValue?e.formatValue(a):a,type:"date"})};i.filterDateEquals={text:"L{on}",localeClass:s,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:s.disabled,onItem:()=>o("=")},i.filterDateBefore={text:"L{before}",localeClass:s,icon:"b-fw-icon b-icon-filter-before",weight:310,disabled:s.disabled,onItem:()=>o("<")},i.filterDateAfter={text:"L{after}",localeClass:s,icon:"b-fw-icon b-icon-filter-after",weight:320,disabled:s.disabled,onItem:()=>o(">")}}}populateCellMenuWithNumberItems({column:e,record:t,items:i}){const r=e.field;if(this.getFilterType(e)==="number"){const s=this,a=t[r],o=l=>{s.applyFilter(e,{operator:l,value:a})};i.filterNumberEquals={text:"L{equals}",localeClass:s,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:s.disabled,onItem:()=>o("=")},i.filterNumberLess={text:"L{lessThan}",localeClass:s,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:s.disabled,onItem:()=>o("<")},i.filterNumberMore={text:"L{moreThan}",localeClass:s,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:s.disabled,onItem:()=>o(">")}}}populateCellMenuWithDurationItems({column:e,record:t,items:i}){const r=e.field;if(this.getFilterType(e)==="duration"){const s=this,a=t[r],o=l=>{s.applyFilter(e,{operator:l,value:a})};i.filterDurationEquals={text:"L{equals}",localeClass:s,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:s.disabled,onItem:()=>o("=")},i.filterDurationLess={text:"L{lessThan}",localeClass:s,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:s.disabled,onItem:()=>o("<")},i.filterDurationMore={text:"L{moreThan}",localeClass:s,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:s.disabled,onItem:()=>o(">")}}}populateCellMenuWithStringItems({column:e,record:t,items:i}){const r=this.getFilterType(e);if(!/(date|number|duration)/.test(r)){var n,s;const a=this,o=e.getFilterableValue(t),l=(n=(s=e.filterable.filterField)===null||s===void 0?void 0:s.operator)!==null&&n!==void 0?n:"*";i.filterStringEquals={text:"L{equals}",localeClass:a,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:a.disabled,onItem:()=>a.applyFilter(e,{value:o,operator:l})}}}populateCellMenu({column:e,record:t,items:i}){const r=this;e.filterable!==!1&&!t.isSpecialRow&&(r.populateCellMenuWithDateItems(...arguments),r.populateCellMenuWithNumberItems(...arguments),r.populateCellMenuWithDurationItems(...arguments),r.populateCellMenuWithStringItems(...arguments),e.meta.isFiltered&&(i.filterRemove={text:"L{removeFilter}",localeClass:r,icon:"b-fw-icon b-icon-remove",cls:"b-separator",weight:400,disabled:r.disabled||r.isMulti&&!r.columnHasRemovableFilters(e),onItem:()=>r.removeFilter(e)}),r.isMulti&&(i.filterDisable={text:"L{disableFilter}",localeClass:r,icon:"b-fw-icon b-icon-filter-disable",cls:"b-separator",weight:400,disabled:r.disabled||!r.columnHasEnabledFilters(e),onItem:()=>r.disableFilter(e)}))}columnHasRemovableFilters(e){const t=this;return Boolean(t.getCurrentMultiFilters(e).find(i=>!t.canDeleteFilter||t.callback(t.canDeleteFilter,t,[i])!==!1))}columnHasEnabledFilters(e){return Boolean(this.getCurrentMultiFilters(e).find(t=>!t.disabled))}populateHeaderMenu({column:e,items:t}){const i=this;e.meta.isFiltered?(t.editFilter={text:"L{editFilter}",localeClass:i,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:i.disabled,onItem:()=>i.showFilterEditor(e)},t.removeFilter={text:"L{removeFilter}",localeClass:i,weight:110,icon:"b-fw-icon b-icon-remove",disabled:i.disabled||i.isMulti&&!i.columnHasRemovableFilters(e),onItem:()=>i.removeFilter(e)},i.isMulti&&(t.disableFilter={text:"L{disableFilter}",localeClass:i,icon:"b-fw-icon b-icon-filter-disable",weight:115,disabled:i.disabled||!i.columnHasEnabledFilters(e),onItem:()=>i.disableFilter(e)})):e.filterable!==!1&&(t.filter={text:"L{filter}",localeClass:i,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:i.disabled,onItem:()=>i.showFilterEditor(e)})}onStoreBeforeFilter({filters:e}){const{columns:t}=this.client;for(let r=0;r<e.count;r++){const n=e.getAt(r);if(!n.internal){var i;const s=(n.columnOwned||this.prioritizeColumns)&&t.find(a=>a.filterable!==!1&&a.field===n.property);s!=null&&(i=s.filterable)!==null&&i!==void 0&&i.filterFn&&(s.$filter||(s.$filter=new Le({columnOwned:!0,property:n.property,operator:n.operator,value:n.value,filterBy(a){return s.filterable.filterFn({value:this.value,record:a,operator:this.operator,property:this.property,column:s})}})),s.$filter.value=n.value,s.$filter.displayValue=n.displayValue,s.$filter.operator=n.operator,e.splice(r,1,s.$filter))}}}onStoreFilter(){this.refreshHeaders(!1)}renderHeader(){this.refreshHeaders(!1)}onElementClick({target:e}){if(this.filterEditorPopup&&this.closeFilterEditor(),e.classList.contains("b-filter-icon")){const t=e.closest(".b-grid-header");return this.showFilterEditor(t.dataset.columnId),!1}}showFilterEditorByKey({target:e}){const t=e.matches(".b-grid-header")&&e;return t&&this.showFilterEditor(t.dataset.columnId),Boolean(t)}isActionAvailable(e,t,i){const r=i.target.closest(".b-grid-header"),n=r&&this.client.columns.find(s=>s.id===r.dataset.columnId);return Boolean(n?.filterable)}}ym._$name="Filter";G.registerFeature(ym);const O0={"*":null,isIncludedIn:null,startsWith:null,endsWidth:null};class hd extends te{static get $name(){return"FilterBar"}static get configurable(){return{prioritizeColumns:!1,keyStrokeFilterDelay:300,compactMode:!1,clearStoreFiltersOnHide:!0,keyMap:{ArrowUp:{handler:"disableGridNavigation",preventDefault:!1},ArrowRight:{handler:"disableGridNavigation",preventDefault:!1},ArrowDown:{handler:"disableGridNavigation",preventDefault:!1},ArrowLeft:{handler:"disableGridNavigation",preventDefault:!1},Enter:{handler:"disableGridNavigation",preventDefault:!1}}}}static get pluginConfig(){return{before:["renderContents"],chain:["afterColumnsChange","renderHeader","populateHeaderMenu","bindStore"]}}static get properties(){return{filterFieldCls:"b-filter-bar-field",filterFieldInputCls:"b-filter-bar-field-input",filterableColumnCls:"b-filter-bar-enabled",filterFieldInputSelector:".b-filter-bar-field-input",filterableColumnSelector:".b-filter-bar-enabled",filterParseRegExp:/^\s*([<>=*])?(.*)$/,storeTrackingSuspended:0}}construct(e,t){if(e.features.filter)throw new Error("Grid.feature.FilterBar feature may not be used together with Grid.feature.Filter, These features are mutually exclusive.");const i=this;i.grid=e,i.onColumnFilterFieldChange=i.onColumnFilterFieldChange.bind(i),super.construct(e,Array.isArray(t)?{filter:t}:t),i.bindStore(e.store),i.filter&&e.store.filter(i.filter),i.gridDetacher=e.ion({beforeElementClick:"onBeforeElementClick",thisObj:i})}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}doDestroy(){var e;this.destroyFilterBar(),(e=this.gridDetacher)===null||e===void 0||e.call(this),super.doDestroy()}doDisable(e){const{columns:t}=this.grid;t?.forEach(i=>{const r=this.getColumnFilterField(i);r&&(r.disabled=e)}),super.doDisable(e)}updateCompactMode(e){this.client.headerContainer.classList[e?"add":"remove"]("b-filter-bar-compact");for(const t in this._columnFilters){const i=this._columnFilters[t];i.placeholder=e?i.column.headerText:null}}destroyFilterBar(){var e;(e=this.grid.columns)===null||e===void 0||e.forEach(this.destroyColumnFilterField,this)}hideFilterBar(){var e;const t=this;t.clearStoreFiltersOnHide&&t.suspendStoreTracking(),(e=t.grid.columns)===null||e===void 0||e.forEach(i=>t.hideColumnFilterField(i,!0)),t.grid.store.filter(),t.clearStoreFiltersOnHide&&t.resumeStoreTracking(),t.hidden=!0}showFilterBar(){this.suspendStoreTracking(),this.renderFilterBar(),this.resumeStoreTracking(),this.hidden=!1}toggleFilterBar(){this.hidden?this.showFilterBar():this.hideFilterBar()}renderFilterBar(){this.grid.hideHeaders||(this.grid.columns.visibleColumns.forEach(e=>this.renderColumnFilterField(e)),this.rendered=!0)}renderColumnFilterField(e){const t=this,{grid:i}=t,r=t.getColumnFilterable(e);if(r&&e.isVisible){const n=e.element,s=i.store.filters.get(e.id)||i.store.filters.getBy("property",e.field);let a=t.getColumnFilterField(e);if(a)t.onColumnFilterFieldChange({source:a,value:a.value}),a.render(n),a.show();else{const o=`${e.filterType||"text"}field`,{filterField:l}=r,d=l?.cls;d&&delete r.filterField.cls,a=Zi.append(T.assign({type:o,cls:{[t.filterFieldCls]:1,[d]:d},dataset:{column:e.field},column:e,owner:i,clearable:!0,name:e.field,value:s&&!s._filterBy&&!s.internal?t.buildFilterValue(s):"",inputCls:t.filterFieldInputCls,keyStrokeChangeDelay:t.keyStrokeFilterDelay,onChange:t.onColumnFilterFieldChange,onClear:t.onColumnFilterFieldChange,disabled:t.disabled,placeholder:t.compactMode?e.headerText:null,format:e.format},l),n)[0],l!=null&&l.hasOwnProperty("min")||Object.defineProperty(a,"min",{get:()=>{var h;return(h=e.editor)===null||h===void 0?void 0:h.min},set:()=>null}),l!=null&&l.hasOwnProperty("max")||Object.defineProperty(a,"max",{get:()=>{var h;return(h=e.editor)===null||h===void 0?void 0:h.max},set:()=>null}),l!=null&&l.hasOwnProperty("strictParsing")||Object.defineProperty(a,"strictParsing",{get:()=>{var h;return(h=e.editor)===null||h===void 0?void 0:h.strictParsing},set:()=>null}),a.element.retainElement=!0,t.setColumnFilterField(e,a);const u=l?.store&&(l.store.readUrl||l.store.data||l.store.isChained);if(a.isCombo&&!u&&a.store.count===0){const h=a.value,f=()=>{a.store.readUrl||a.store.isChained||(a.store.data=i.store.getDistinctValues(e.field,!0).map(g=>i.store.modelClass.new({id:g,[e.field]:g})))};a.value=null,a.store.isSorted||a.store.sort({field:e.field,ascending:!0}),a.picker.ion({beforeShow:f}),f(),a.value=h}!t.filter&&a.value&&i.store.autoLoad!==!1&&t.onColumnFilterFieldChange({source:a,value:a.value})}n.classList.add(t.filterableColumnCls)}}updateColumnFilterFields(){const e=this,{columns:t,store:i}=e.grid;let r,n;e._updatingFields=!0;for(const s of t.visibleColumns)r=e.getColumnFilterField(s),r&&(n=i.filters.get(s.id)||i.filters.getBy("property",s.field),n&&!n.internal?n._filterBy?r.value=n.value:r.value=e.buildFilterValue(n):r.value="");e._updatingFields=!1}getColumnFilterable(e){if(!e.isRoot&&e.filterable!==!1&&e.field&&e.isLeaf)return typeof e.filterable=="function"&&(e.filterable={filterFn:e.filterable}),e.filterable}destroyColumnFilterField(e){const t=this.getColumnFilterField(e);t&&(this.hideColumnFilterField(e,!0),t.destroy(),this.setColumnFilterField(e,void 0))}hideColumnFilterField(e,t){const i=this,{store:r}=i.grid,n=e.element,s=i.getColumnFilterField(e);if(s){i.isDestroying||s.hide();const{$filter:a}=e;!r.isDestroyed&&i.clearStoreFiltersOnHide&&a&&r.removeFilter(a,t),n?.classList.remove(i.filterableColumnCls)}}getColumnFilterField(e){var t;return(t=this._columnFilters)===null||t===void 0?void 0:t[e.id]}setColumnFilterField(e,t){this._columnFilters=this._columnFilters||{},this._columnFilters[e.data.id]=t}parseFilterValue(e,t,i){var r;if(Array.isArray(t))return{value:t};if(T.isDate(t))return{operator:i.isDateField?"sameDay":i.isTimeField?"sameTime":"=",value:t};const n=String(t).match(this.filterParseRegExp);return{operator:n[1]||((r=e.filterable)===null||r===void 0?void 0:r.operator)||"*",value:n[2]}}buildFilterValue({operator:e,value:t}){return t instanceof Date||Array.isArray(t)?t:(e in O0?"":e)+t}onStoreBeforeFilter({filters:e}){const{columns:t}=this.client;for(let r=0;r<e.count;r++){var i;const n=e.getAt(r),s=(n.columnOwned||this.prioritizeColumns)&&t.find(a=>a.filterable!==!1&&a.field===n.property);s!=null&&(i=s.filterable)!==null&&i!==void 0&&i.filterFn&&(s.$filter||(s.$filter=new Le({columnOwned:!0,property:n.property,id:s.id,filterBy(a){return s.filterable.filterFn({value:this.value,record:a,property:this.property,column:s})}})),s.$filter.value=n.value,e.splice(r,1,s.$filter))}}onStoreFilter(){!this.storeTrackingSuspended&&this.rendered&&this.updateColumnFilterFields()}afterColumnsChange({changes:e,column:t}){!this.hidden&&e!==null&&e!==void 0&&e.hidden&&(e.hidden.value?this.destroyColumnFilterField(t):this.renderColumnFilterField(t))}suspendStoreTracking(){this.storeTrackingSuspended++}resumeStoreTracking(){this.storeTrackingSuspended--}renderHeader(){this.hidden||this.renderFilterBar()}renderContents(){if(this._columnFilters)for(const e of Object.values(this._columnFilters))e?.element.remove()}disableGridNavigation(e){return!!e.target.matches(this.filterFieldInputSelector)}onBeforeElementClick({event:e}){if(e.target.closest(`.${this.filterFieldCls}`))return!1}onColumnFilterFieldChange({source:e,value:t}){const i=this,{column:r}=e,{filterFn:n}=r.filterable,{store:s}=i.grid,a=r.$filter||s.filters.find(u=>(u.id===r.id||u.property===r.field)&&!u.internal);if(i._updatingFields)return;const o=t==null||t===""||Array.isArray(t)&&t.length===0;if(s.removeFilter(a,!0),r.$filter=null,o){if(!a)return}else{var l,d;r.$filter=s.addFilter(F(F({property:e.name},i.parseFilterValue(r,t,e)),{},{[typeof((l=r.filterable)===null||l===void 0?void 0:l.caseSensitive)=="boolean"?"caseSensitive":void 0]:(d=r.filterable)===null||d===void 0?void 0:d.caseSensitive,[n?"filterBy":"_"]:function(u){return n({value:this.value,record:u,operator:this.operator,property:this.property,column:r})}}),!0)}s.filter()}populateHeaderMenu({items:e}){e.toggleFilterBar={text:this.hidden?"L{enableFilterBar}":"L{disableFilterBar}",localeClass:this,weight:120,icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem:()=>this.toggleFilterBar()}}}hd.featureClass="b-filter-bar";hd._$name="FilterBar";G.registerFeature(hd);class fd extends te{static get $name(){return"Group"}static get configurable(){return{field:null,groupSortFn:null,renderer:null,keyMap:{" ":"toggleGroup"}}}construct(e,t){const i=this;e.features.tree||(i._thisIsAUsedExpression(e.features.groupSummary),t=i.processConfig(t),i.grid=e,super.construct(e,t),i.bindStore(e.store),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1100,thisObj:i}))}processConfig(e){return typeof e=="string"?{field:e,ascending:null}:e}setConfig(e){e===null?this.store.clearGroupers():super.setConfig(this.processConfig(e))}bindStore(e){this.detachListeners("store"),e.ion({name:"store",group:"onStoreGroup",change:"onStoreChange",thisObj:this})}updateRenderer(e){this.groupRenderer=e}updateField(e){this.store.group({field:e,ascending:this.ascending,fn:this.groupSortFn})}updateGroupSortFn(e){this.isConfiguring||this.store.group({field:this.field,ascending:this.ascending,fn:e})}doDestroy(){super.doDestroy()}doDisable(e){const{store:t}=this;if(e&&t.isGrouped){const{sorters:i}=t;i.unshift(...t.groupers),t.clearGroupers(),t.sort(i)}super.doDisable(e)}get store(){return this.grid.store}static get pluginConfig(){return{assign:["collapseAll","expandAll"],chain:["renderHeader","populateHeaderMenu","getColumnDragToolbarItems","onElementTouchStart","onElementClick","bindStore"]}}toggleCollapse(e,t){this.internalToggleCollapse(e,t)}internalToggleCollapse(e,t,i=!1){const r=this,{store:n,grid:s}=r,a=n.getById(e);!a.isGroupHeader||(t=t===void 0?!a.meta.collapsed:t,s.trigger("beforeToggleGroup",{groupRecord:a,collapse:t})!==!1&&(t?n.collapse(a):n.expand(a),i||(s.rowManager.rowCount>s.store.count?s.rowManager.renderFromRow():s.rowManager.renderFromRecord(a)),s.trigger("toggleGroup",{groupRecord:a,collapse:t}),s.afterToggleGroup()))}collapseAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach(t=>e.internalToggleCollapse(t,!0,!0)),e.grid.refreshRows(!0))}expandAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach(t=>e.internalToggleCollapse(t,!1,!0)),e.grid.refreshRows())}onBeforeRenderRow({row:e}){const t=e.grid.store.getById(e.id);e.forceInnerHTML=e.forceInnerHTML||t?.isGroupHeader}renderCell(e){const t=this,{cellElement:i,row:r,column:n}=e,{meta:s}=e.record,a={"b-group-row":0,"b-grid-group-collapsed":0};if(!t.disabled&&t.store.isGrouped&&"groupRowFor"in s){if(n.type==="action")return;n.clearCell(i),a["b-grid-group-collapsed"]=s.collapsed,a["b-group-row"]=1,n===t.groupHeaderColumn&&(i.classList.add("b-group-title"),i.$groupHeader=!0),t.buildGroupHeader(e)}else i.$groupHeader&&(i.classList.remove("b-group-title"),i.$groupHeader=!1);r.assignCls(a)}buildGroupHeader(e){const t=this,{record:i,cellElement:r,column:n,persist:s}=e,{grid:a}=t,o=i.meta,{groupRowFor:l}=o,{groupSummary:d}=a.features,u=o.childCount-(d&&d.target!=="header"?1:0);let h=null,f=!0;if(s||n){const g=a.columns.get(o.groupField),m=e.isFirstColumn=n===t.groupHeaderColumn;g!=null&&g.groupRenderer?m&&(h=g.groupRenderer(F(F({},e),{},{groupRowFor:l,groupRecords:i.groupChildren,groupColumn:g,count:u})),f=!1):t.groupRenderer&&(h=t.groupRenderer(F(F({},e),{},{groupRowFor:l,groupRecords:i.groupChildren,groupColumn:g,count:u,isFirstColumn:m}))),m&&h==null&&f&&S.getChildElementCount(r)===0&&(h=z.encodeHtml(`${l==="__novalue__"?"":l} (${u})`))}else t.groupRenderer&&(h=t.groupRenderer(e));return typeof h=="string"?r.innerHTML=h:typeof h=="object"&&Z.sync({targetElement:r,domConfig:{onlyChildren:!0,children:W.asArray(h)}}),S.getChildElementCount(r)>0&&(r._hasHtml=!0),r.innerHTML}get groupHeaderColumn(){return this.grid.columns.visibleColumns.find(e=>!e.groupHeaderReserved)}renderHeader(e){const{store:t,grid:i}=this;if(t.isGrouped)for(const r of t.groupers){const n=i.columns.get(r.field),s=n&&i.getHeaderElement(n.id);s?.classList.add("b-group",r.ascending?"b-asc":"b-desc")}}populateHeaderMenu({column:e,items:t}){const i=this;e.groupable!==!1&&(t.groupAsc={text:"L{groupAscending}",localeClass:i,icon:"b-fw-icon b-icon-group-asc",cls:"b-separator",weight:400,disabled:i.disabled,onItem:()=>i.store.group(e.field,!0)},t.groupDesc={text:"L{groupDescending}",localeClass:i,icon:"b-fw-icon b-icon-group-desc",weight:410,disabled:i.disabled,onItem:()=>i.store.group(e.field,!1)}),i.store.isGrouped&&(t.groupRemove={text:"L{stopGrouping}",localeClass:i,icon:"b-fw-icon b-icon-clear",cls:e.groupable?"":"b-separator",weight:420,disabled:i.disabled,onItem:()=>i.store.clearGroupers()})}getColumnDragToolbarItems(e,t){var i;const r=this,{store:n,disabled:s}=r;t.push({text:"L{groupAscendingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-group-asc",ref:"groupAsc",cls:"b-separator",weight:110,disabled:s,onDrop:({column:o})=>n.group(o.field,!0)}),t.push({text:"L{groupDescendingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-group-desc",ref:"groupDesc",weight:110,disabled:s,onDrop:({column:o})=>n.group(o.field,!1)});const a=((i=n.groupers)===null||i===void 0?void 0:i.some(o=>o.field===e.field))&&!s;return t.push({text:"L{stopGroupingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-clear",ref:"groupRemove",disabled:!a,weight:110,onDrop:({column:o})=>n.removeGrouper(o.field)}),t}onStoreGroup({groupers:e}){const{grid:t}=this,{element:i}=t,r=i&&S.children(i,".b-grid-header.b-group");if(i){for(const n of r)n.classList.remove("b-group","b-asc","b-desc");if(e)for(const n of e){const s=t.getHeaderElementByField(n.field);s&&s.classList.add("b-group",n.ascending?"b-asc":"b-desc")}}}onStoreChange({action:e,records:t}){const{client:i}=this,{rowManager:r,store:n}=i;if(n.isGrouped&&e==="move"){const{field:s}=n.groupers[0],a=Math.min(...t.reduce((o,l)=>{if(o.push(n.indexOf(l.instanceMeta(n).groupParent)),s in l.meta.modified){const d=n.groupRecords.find(u=>u.meta.groupRowFor===l.meta.modified[s]);d&&o.push(n.indexOf(d))}return o},[]));r.renderFromRow(r.getRow(a))}}onElementTouchStart(e){const t=this,{target:i}=e,r=i.closest(".b-grid-header"),n=r&&t.grid.getColumnFromElement(r);e.touches.length>1&&n&&n.groupable!==!1&&!t.disabled&&t.store.group(n.field)}onElementClick(e){const t=this,{store:i}=t,{target:r}=e,n=r.closest(".b-group-row"),s=r.closest(".b-grid-header"),a=s?.dataset.column;if(!(r.classList.contains("b-resizer")||t.disabled||r.classList.contains("b-action-item")||e.handled)){if(s&&a){var o;const l=(o=i.groupers)===null||o===void 0?void 0:o.find(d=>d.field===a);if(l&&!e.shiftKey)return i.group(a,!l.ascending),!1;e.shiftKey&&t.grid.columns.get(a).groupable!==!1&&(e.altKey?i.removeGrouper(a):i.group(a))}if(n)return t.internalToggleCollapse($e.get(n).id),!1}}toggleGroup(e){var t;const{grid:i}=this,{focusedCell:r}=i;return!this.disabled&&!r.isActionable&&(t=r.record)!==null&&t!==void 0&&t.isGroupHeader?(this.internalToggleCollapse(r.id),!0):!1}}fd._$name="Group";G.registerFeature(fd,!0,["Grid","Scheduler"]);G.registerFeature(fd,!1,["TreeGrid"]);var bm=c=>class extends(c||P){static get $name(){return"SummaryFormatter"}generateHtml(t,i,r,n,s,a){const o=this.store,l=t.summaries||(t.sum?[{sum:t.sum,renderer:t.summaryRenderer}]:[]);let d=`<table class="${r}">`;return l.forEach(u=>{let h=u.sum,f=null;switch(h===!0&&(h="sum"),h){case"sum":case"add":f=o.sum(t.field,i);break;case"max":f=o.max(t.field,i);break;case"min":f=o.min(t.field,i);break;case"average":case"avg":f=o.average(t.field,i);break;case"count":f=i.length;break;case"countNotEmpty":f=i.reduce((g,m)=>{const p=m[t.field];return g+(p!=null?1:0)},0);break}if(typeof h=="function"&&(f=i.reduce(h,"seed"in u?u.seed:0)),f!==null){const g="b-grid-summary-value",m=u.label?`<td class="b-grid-summary-label">${u.label}</td>`:"";let p=u.renderer?u.renderer({config:u,sum:f}):f,v;p==null&&(p=""),String(p).includes("<td>")?v=p:v=m?`${m}<td class="${g}">${p}</td>`:`<td colspan="2" class="${g}">${p}</td>`,d+=`<tr>${v}</tr>`}}),d+"</table>"}};class qa extends bm(te){static get $name(){return"GroupSummary"}static get configurable(){return{collapseToHeader:null,target:"footer"}}construct(e,t){if(this.grid=e,super.construct(e,t),!e.features.group)throw new Error("Requires Group feature to work, please enable");this.bindStore(e.store),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1e3,thisObj:this})}bindStore(e){this.detachListeners("store"),e.ion({name:"store",update:"onStoreUpdate",prio:1,thisObj:this})}get store(){return this.grid.store}doDisable(e){this.updateTarget(this.target),super.doDisable(e)}changeTarget(e){return T.assertString(e,"target"),e}updateTarget(e){this.store.useGroupFooters=!this.disabled&&e==="footer",this.isConfiguring||this.store.group()}changeCollapseToHeader(e){return T.assertBoolean(e,"collapseToHeader"),e}updateCollapseToHeader(){this.isConfiguring||this.store.group()}static get pluginConfig(){return{chain:["bindStore"]}}onBeforeRenderRow({row:e,record:t}){e.isGroupFooter&&!("groupFooterFor"in t.meta)?(e.isGroupFooter=!1,e.forceInnerHTML=!0):e.isGroupHeader&&!t.meta.collapsed&&e.eachElement(this.removeSummaryElements)}removeSummaryElements(e){}renderCell({column:e,cellElement:t,row:i,record:r,size:n,isFirstColumn:s}){const a=this,{meta:o}=r,{rowHeight:l}=a.grid,d="groupRowFor"in o,u="groupFooterFor"in o,h=a.target==="header",f={"b-group-footer":0,"b-header-summary":0},g=d&&(h||a.collapseToHeader&&o.collapsed)&&!s||u&&!h;if((d||u)&&(n.height=l),a.store.isGrouped&&g&&!a.disabled){e.clearCell(t);const m=d?r:o.groupRecord;i.isGroupFooter=u,i.isGroupHeader=d,u?f["b-group-footer"]=1:f["b-header-summary"]=1;const p=a.updateSummaryHtml(t,e,m),v=typeof p=="number"?p:p.count;v>1&&(n.height+=o.collapsed&&!h?0:v*l*.1),p.height&&(n.height+=p.height)}i.assignCls(f)}updateSummaryHtml(e,t,i){const r=i.groupChildren.slice();r[r.length-1].isGroupFooter&&r.pop();const n=this.generateHtml(t,r,"b-grid-group-summary",i,i.meta.groupField,i.meta.groupRowFor);return e.children.length?S.sync(n,e.firstElementChild):e.innerHTML=n,t.summaries?t.summaries.length:t.sum?1:0}onStoreUpdate({source:e,changes:t}){if(!this.disabled&&e.isGrouped){if(t&&e.groupers.find(r=>r.field in t))return;Object.keys(t).some(r=>{const n=this.grid.columns.get(r);return Boolean(n)&&(Boolean(n.sum)||Boolean(n.summaries))})&&(this.grid.forceFullRefresh=!0)}}refresh(){this.grid.columns.visibleColumns.forEach(e=>{this.hasSummary(e)&&this.grid.refreshColumn(e)})}hasSummary(e){return e.sum||e.summaries}}qa.featureClass="b-group-summary";qa._$name="GroupSummary";G.registerFeature(qa);class Ka extends Aa{static get $name(){return"HeaderMenu"}static get configurable(){return{type:"header",items:null,moveColumns:null}}static get defaultConfig(){return{processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateHeaderMenu"),e}shouldShowMenu(e){const{column:t}=e;return t&&t.enableHeaderContextMenu!==!1&&t!==this.client.timeAxisColumn}getDataFromEvent(e){return T.assign(super.getDataFromEvent(e),this.client.getHeaderDataFromEvent(e))}populateHeaderMenu({items:e,column:t}){const i=this;if(t){if(t.headerMenuItems&&T.merge(e,t.headerMenuItems),t.isCollapsible){const{collapsed:r}=t,n=r?i.client.rtl?"left":"right":i.client.rtl?"right":"left";e.toggleCollapse={weight:215,icon:`b-fw-icon b-icon-collapse-${n}`,text:i.L(r?"L{expandColumn}":"L{collapseColumn}"),onItem:()=>t.collapsed=!r}}if(i.moveColumns){const r=i.getColumnToMoveBefore(t),n=i.getColumnToMoveAfter(t);r&&(e.movePrev={weight:220,icon:"b-fw-icon b-icon-column-move-left",text:i.L("L{moveBefore}",z.encodeHtml(r.text)),onItem:()=>{const{parent:s}=t;if(r.parent.insertChild(t,r)){var a;t.region=r.region,(a=s.children)!==null&&a!==void 0&&a.length||s.remove()}}}),n&&(e.moveNext={weight:230,icon:"b-fw-icon b-icon-column-move-right",text:i.L("L{moveAfter}",z.encodeHtml(n.text)),onItem:()=>{const{parent:s}=t;if(n.parent.insertChild(t,n.nextSibling)){var a;t.region=n.region,(a=s.children)!==null&&a!==void 0&&a.length||s.remove()}}})}}return e}getColumnToMoveBefore(e){const{previousSibling:t,parent:i}=e;if(t)return t.children&&!e.children?t.children[t.children.length-1]:t;if(!i.isRoot)return i}getColumnToMoveAfter(e){const{nextSibling:t,parent:i}=e;if(t)return t;if(!i.isRoot)return i}}Ka.featureClass="";Ka._$name="HeaderMenu";G.registerFeature(Ka,!0);const P0={mousedown:"mouseDown",mousemove:"mouseMove",mouseup:"mouseUp",touchdown:"touchDown",touchmove:"touchMove",touchup:"touchUp",mouseover:"mouseOver",mouseout:"mouseOut",dblclick:"dblClick",keydown:"keyDown",keypress:"keyPress",keyup:"keyUp",contextmenu:"contextMenu"};class Xa extends te{constructor(...e){super(...e),M(this,"mergedRanges",[]),M(this,"mergedMap",{})}static get pluginConfig(){return{chain:["beforeRenderCell","afterRenderRow","bindStore","afterColumnsChange","afterRemove","afterToggleGroup","afterToggleSubGrid","handleEvent","populateHeaderMenu","afterSelectionChange"],before:["onInternalResize"],override:["getColumnFromElement","getRecordFromElement"]}}afterConstruct(){const e=this,{client:t}=e;t.eachSubGrid(i=>e.setupSubGrid(i)),t.rowManager.ion({renderDone:"onRenderDone",thisObj:e}),e.bindStore(t.store)}setupSubGrid(e){e.$mergedCellsElement=S.createElement({parent:e.element,className:{"b-grid-merged-cells-container":1}})}doDisable(e){this.isConfiguring||(this.isDisabling=!0,this.reset(),this.isDisabling=!1),super.doDisable(e)}updatePassthrough(e){this.client.element.classList.toggle("b-mergecells-passthrough",e)}bindStore(e){this.detachListeners("store"),e.ion({name:"store",change:"onStoreChange",refresh:{prio:1,fn:"onStoreRefresh"},thisObj:this})}onInternalResize(){this.refreshBounds()}beforeRenderCell(e){const{column:t,record:i,cellElement:r}=e,n=this.client.subGrids[t.region];if(!this.disabled&&t.mergeCells&&t.isSorted&&!i.isSpecialRow&&!n.collapsed){const s=this.getMergeRange(i,t);s!=null&&s.use&&(r.classList.add("b-merged-cell"),r.innerHTML="",e.cellElement=s.cellElement)}}afterRenderRow({row:e,oldId:t,oldHeight:i}){t===e.id&&i!==e.height&&(this.heightChanged=!0)}afterColumnsChange({action:e,changes:t,column:i}){if(!this.disabled){if(e==="update"&&t.mergeCells&&!i.mergeCells){for(const r of this.mergedRanges.slice())r.column===i&&this.removeRange(r);this.syncDom();return}this.refreshBounds()}}afterRemove(){!this.disabled&&this.reset()}afterToggleGroup(){!this.disabled&&this.reset()}afterToggleSubGrid(){!this.disabled&&this.reset()}afterSelectionChange(){if(!this.passthrough){const{client:e}=this,t=e.selectedRecords.map(r=>e.store.indexOf(r));let i=!1;for(const r of this.mergedRanges){let n=!0;for(let s=r.fromIndex;s<=r.toIndex&&n;s++)n=t.includes(s);r.isSelected!==n&&(r.isSelected=n,i=!0)}i&&this.syncDom()}}getRecordFromElement(e){var t;return(t=e.elementData)!==null&&t!==void 0&&t.range?this.client.store.getAt(e.elementData.range.fromIndex):this.overridden.getRecordFromElement(e)}getColumnFromElement(e){var t;return(t=e.elementData)!==null&&t!==void 0&&t.range?e.elementData.range.column:this.overridden.getColumnFromElement(e)}populateHeaderMenu({column:e,items:t}){e.mergeable!==!1&&(t.mergeCells={text:"L{MergeCells.mergeCells}",icon:`b-fw-icon ${e.mergeCells?"b-icon-checked":"b-icon-unchecked"}`,tooltip:"L{MergeCells.menuTooltip}",cls:"b-separator",weight:500,disabled:this.disabled,onItem:()=>e.mergeCells=!e.mergeCells})}async handleEvent(e){if(!this.passthrough){const i=e.target.closest(".b-grid-merged-cells");if(i){var t;const{client:r}=this,{range:n}=i.elementData,{cellEdit:s}=r.features,{column:a}=n,o=z.capitalize((t=P0[e.type])!==null&&t!==void 0?t:e.type),l={grid:r,records:[],column:a,cellElement:i.firstElementChild,target:e.target,event:e};for(let d=n.fromIndex;d<=n.toIndex;d++)l.records.push(r.store.getAt(d));if(r.trigger(`mergedCell${o}`,l),s?.triggerEvent.toLowerCase()===`cell${o}`.toLowerCase()){const d=r.rowManager.getRowAt(e.clientY);await s.startEditing({id:d.id,columnId:a.id})}else e.type==="click"&&this.onRangeClick({range:n})}}}onRangeClick({range:e}){const t=[];for(let i=e.fromIndex;i<=e.toIndex;i++)t.push(this.client.store.getAt(i));this.client.selectedRecords=t}onStoreChange(){!this.disabled&&this.reset()}onStoreRefresh({action:e}){e!=="filter"&&e!=="dataset"&&!this.disabled&&this.reset(!1)}createRangeElement(e){var t,i,r;const n=this.client.getSubGridFromColumn(e.column).$mergedCellsElement,s=`${e.fromIndex}-@-${e.column.id}`;let a=(t=(i=n.syncIdMap)===null||i===void 0?void 0:i[s])!==null&&t!==void 0?t:(r=n.releasedIdMap)===null||r===void 0?void 0:r[s];return n.releasedIdMap&&delete n.releasedIdMap[s],a||(a=S.createElement(this.createRangeDomConfig(e))),Z.addChild(n,a,s),e.element=a,e.cellElement=a.firstElementChild,a}createRangeDomConfig(e){var t;const{column:i,fromIndex:r,toIndex:n,top:s,left:a,width:o,height:l}=e,{type:d}=i,u=this.client.store.getAt(r),h={className:{"b-grid-merged-cells":1,"b-selected":e.isSelected},elementData:{range:e},style:{top:s,left:a,height:l,width:o},dataset:{syncId:`${r}-@-${i.id}`,fromIndex:r,toIndex:n,column:i.field,columnId:i.id},children:[{className:new Q(this.client.cellCls).assign({[`b-${d?.toLowerCase()}-cell`]:d,[i.cellCls]:i.cellCls,[i.internalCellCls]:i.internalCellCls}).assign(i.autoCls),keepChildren:!0,elementData:{range:e},dataset:{column:i.field,columnId:i.id},style:{height:this.client.rowManager.rowHeight}}]};return(t=i.mergedRenderer)===null||t===void 0||t.call(i,{domConfig:h,value:i.getRawValue(u),record:u,column:i,fromIndex:r,toIndex:n}),h}buildMergedCellsConfig(e,t,i){var r,n,s,a;const o=this,{client:l}=o,{rowManager:d}=l;e=(r=e)!==null&&r!==void 0?r:(n=d.topRow)===null||n===void 0?void 0:n.dataIndex,t=(s=t)!==null&&s!==void 0?s:(a=d.bottomRow)===null||a===void 0?void 0:a.dataIndex;const u=l.regions.reduce((h,f)=>(h[f]={className:{"b-grid-merged-cells-container":1},children:[]},h),{});for(const h of o.mergedRanges)h.use&&h.fromIndex<=t&&h.toIndex>=e&&(o.updateRange(h,o.heightChanged,i),u[h.column.region].children.push(o.createRangeDomConfig(h)));return u}syncDom(e=!1){const t=this,{client:i}=t,{rowManager:r}=i;if(!e&&!r.topRow||t.disabled&&!t.isDisabling)return;const n=this.buildMergedCellsConfig();i.eachSubGrid(s=>{Z.sync({targetElement:s.$mergedCellsElement,syncIdField:"syncId",domConfig:n[s.region]})}),t.heightChanged=!1}onRenderDone(){this.syncDom()}removeRange(e){W.remove(this.mergedRanges,e);for(let t=e.fromIndex;t<=e.toIndex;t++)delete this.mergedMap[`${t}-@-${e.column.id}`]}reset(e=!0){const t=this,i=t.client.columns.visibleColumns.filter(n=>n.mergeCells&&n.isSorted,!0),r=t.mergedRanges.length;if(t.mergedRanges=[],t.mergedMap={},e&&!t.client.refreshSuspended){for(const n of t.client.rowManager.rows)for(const s of i)n.renderCell(n.getCell(s.id));t.syncDom(r&&!t.client.rowManager.rowCount)}}refreshBounds(){const{mergedRanges:e}=this,t=new Map;for(const i of e.slice()){const{column:r}=i,{element:n}=r;if(n){let s=t.get(r);s||t.set(r,s=$.from(n,n.parentElement)),i.left=s.left,i.width=s.width}else this.removeRange(i)}this.syncDom()}updateRange(e,t,i=null){const{store:r,rowManager:n}=this.client,{topRendered:s,bottomRendered:a}=e,{rowOffsetHeight:o}=n;let{fromIndex:l,toIndex:d}=e,u,h;if(t=i?i.length>0:t,!(!t&&s&&a)){if(!s||t){if(i){const g=i.findIndex(m=>m.dataIndex>=l);u=i[g],l=u.dataIndex}else do u=n.getRowById(r.getAt(l));while(!u&&l++<d);e.topRendered=l===e.fromIndex;const f=l-e.fromIndex;e.top=u.top-f*(i?u.offsetHeight:o)}if(!a||t){if(i){const g=i.findIndex(m=>m.dataIndex===d);h=i[g===-1?i.length-1:g],l=h.dataIndex}else do h=n.getRowById(r.getAt(d));while(!h&&d-- >l);e.bottomRendered=d===e.toIndex;const f=e.toIndex-d;e.bottom=h.bottom+f*(i?h.offsetHeight:o)}e.height=e.bottom-e.top}}getMergeRange(e,t){if(e.isSpecialRow)return;const i=this,{mergedMap:r}=i,{store:n}=i.client,s=t.id,a=n.indexOf(e),o=`${a}-@-${s}`;let l=r[o];if(!l){const d=t.getRawValue(e);l=r[o]={column:t},i.mergedRanges.push(l);let u,h,f=a;do u=n.getAt(--f),h=u&&t.getRawValue(u),h===d&&(r[`${f}-@-${s}`]=l);while(u&&h===d);let g,m,p=a;do g=n.getAt(++p),m=g&&t.getRawValue(g),m===d&&(r[`${p}-@-${s}`]=l);while(g&&m===d);if(l.fromIndex=f+1,l.toIndex=p-1,l.toIndex-l.fromIndex>0){const v=$.from(t.element,t.element.parentElement);l.left=v.left,l.width=v.width,l.use=!0}}return!l.element&&l.use&&i.createRangeElement(l),l}}M(Xa,"$name","MergeCells");M(Xa,"configurable",{passthrough:!0});Xa._$name="MergeCells";G.registerFeature(Xa);class gd extends te{static get $name(){return"QuickFind"}static get pluginConfig(){return{chain:["onElementKeyPress","onCellNavigate"]}}static get properties(){return{hitCls:"b-quick-hit",hitCellCls:"b-quick-hit-cell",hitCellBadgeCls:"b-quick-hit-cell-badge",hitTextCls:"b-quick-hit-text"}}construct(e,t){super.construct(e,t),Object.assign(this,{grid:e,treeWalker:e.setupTreeWalker(e.element,S.NodeFilter.SHOW_TEXT,()=>S.NodeFilter.FILTER_ACCEPT)})}isActionAvailable(){const{focusedCell:e}=this.grid;return!this.disabled&&e?.record&&!e.isActionable&&this.find.length>0}doDisable(e){e&&this.clear(),super.doDisable(e)}get store(){return this.grid.store}showQuickFind(){const e=this,t=e.grid.getHeaderElement(e.columnId);if(t){if(!e.headerField){const[i,r,n]=S.createElement({tag:"div",className:"b-quick-hit-header",children:[{tag:"div",className:"b-quick-hit-field"},{tag:"div",className:"b-quick-hit-badge"}]},{returnAll:!0});e.mode==="header"?t.appendChild(i):(i.className+=" b-quick-hit-mode-grid",e.grid.element.appendChild(i)),e.headerField={header:i,field:r,badge:n,colHeader:t}}e.headerField.field.innerHTML=e.find,e.headerField.badge.innerHTML=e.found.length,t.classList.add("b-quick-find-header"),e.renderListenerInitialized||(e.grid.rowManager.ion({rendercell:e.renderCell,thisObj:e}),e.renderListenerInitialized=!0)}}hideQuickFind(){const e=this,{grid:t,headerField:i}=e;for(const r of e.prevFound||e.found){const n=t.getRowById(r.id);if(n){n.forceInnerHTML=!0;const s=n.getCell(e.columnId);s._content=null,n.renderCell(s),n.forceInnerHTML=!1}}i&&(i.header.parentNode.removeChild(i.header),i.colHeader.classList.remove("b-quick-find-header"),e.headerField=null),e.renderListenerInitialized&&(t.rowManager.un({rendercell:e.renderCell},e),e.renderListenerInitialized=!1),t.trigger("hideQuickFind")}search(e,t=this.columnId){const i=this,{grid:r}=i,n=r.columns.getById(t)||r.columns.get(t),s=i.store.findByField(n.field,e,n.mergeCells&&n.isSorted);let a=1;Object.assign(i,{foundMap:{},prevFound:i.found,found:s,find:e,columnId:n.id,findRe:new RegExp(`(\\s+)?(${z.escapeRegExp(String(e))})(\\s+)?`,"ig")}),e?i.showQuickFind():i.hideQuickFind();for(const o of S.children(r.element,`.${i.hitCls}`))o.classList.remove(i.hitCls,i.hitCellCls),o._originalContent&&(o.innerHTML=o._originalContent,o._originalContent=null);if(!!s){s.length>0&&i.gotoClosestHit(r.focusedCell,s);for(const o of s){i.foundMap[o.id]=a++;const l=r.getRowById(o.data.id);if(l?.renderCell(l.getCell(n.id)),a>1e3)break}r.trigger("quickFind",{find:e,found:s})}}clear(){var e;(this.find||(e=this.found)!==null&&e!==void 0&&e.length)&&this.search("")}get foundCount(){var e,t;return(e=(t=this.found)===null||t===void 0?void 0:t.length)!==null&&e!==void 0?e:0}gotoHit(e){const t=this.found[e];return t&&this.grid.focusCell({columnId:this.columnId,id:t.id},{doSelect:!0}),!!t}gotoClosestHit(e,t){const i=e?this.grid.store.indexOf(e.id):0,r=t.slice().sort((n,s)=>Math.abs(n.index-i)-Math.abs(s.index-i));this.gotoHit(t.indexOf(r[0]))}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}gotoNextHit(){var e,t,i;const r=this,{grid:n}=r,s=(e=(t=n._focusedCell)===null||t===void 0?void 0:t.id)!==null&&e!==void 0?e:(i=n.lastFocusedCell)===null||i===void 0?void 0:i.id,a=n.store.indexOf(s)||0,o=r.found.find(l=>l.index>a);o?n.focusCell({columnId:r.columnId,id:o.id},{doSelect:!0}):r.gotoFirstHit()}gotoPrevHit(){var e,t,i;const r=this,{grid:n,found:s}=r,a=(e=(t=n._focusedCell)===null||t===void 0?void 0:t.id)!==null&&e!==void 0?e:(i=n.lastFocusedCell)===null||i===void 0?void 0:i.id,o=n.store.indexOf(a)||0;let l;if(!!s.length){for(let d=s.length-1;d--;d>=0)if(s[d].index<o){l=s[d];break}l?n.focusCell({columnId:r.columnId,id:l.id},{doSelect:!0}):r.gotoLastHit()}}renderCell({cellElement:e,column:t,record:i}){var r;const n=this,{classList:s}=e,{treeWalker:a,findRe:o,hitTextCls:l}=n,d=n.columnId===t.id&&((r=n.foundMap)===null||r===void 0?void 0:r[i.id]);if(d){s.add(n.hitCls),e.isQuickHit=!0,e._originalContent=e.innerHTML;const u=a.currentNode=S.down(e,".b-grid-cell-value,.b-tree-cell-value")||e;for(let h=a.nextNode();h&&u.contains(h);){const f=h,g=h.nodeValue,m=["<span>"];h=a.nextNode();let p=o.lastIndex;for(let v=o.exec(g);v;v=o.exec(g)){const y=g.substring(p,v.index),C=v[1]?"\xA0":"",D=v[2],w=v[3]?"\xA0":"";m.push(`${z.encodeHtml(y)}${C}<span class="${l}">${D}</span>${w}`),p=o.lastIndex}m.push(z.encodeHtml(g.substring(p)),"</span>"),f.parentNode.insertBefore(S.createElementFromTemplate(m.join(""),{fragment:!0}),f),f.remove()}S.createElement({parent:e,className:n.hitCellBadgeCls,text:d})}}onBackspace(e){const t=this;return t.find?(t.find=t.find.substr(0,t.find.length-1),t.search(t.find),!0):!1}clearSearch(){return this.find?(this.find="",this.search(this.find),!0):!1}showFilterEditor(){const e=this,{filter:t}=e.client.features;t&&e.columnId&&e.foundCount&&(e.clear(),t.showFilterEditor(e.client.columns.getById(e.columnId),e.find))}onElementKeyPress(e){var t;const i=this,{grid:r}=i,{focusedCell:n}=r;if(!e.handled&&!i.disabled&&n!==null&&n!==void 0&&n.record&&!n.isActionable&&((t=e.key)===null||t===void 0?void 0:t.length)===1){const s=r.columns.getById(r._focusedCell.columnId);s&&s.searchable!==!1&&(i.columnId=r._focusedCell.columnId,i.find+=e.key,i.search(i.find))}}onCellNavigate(e,t,i){const r=this;r.find&&(!i||i.columnId!==r.columnId)&&r.clear()}}M(gd,"configurable",{mode:"header",find:"",keyMap:{F3:"gotoNextHit","Shift+F3":"gotoPrevHit","Ctrl+g":"gotoNextHit","Ctrl+Shift+g":"gotoPrevHit","Ctrl+Shift+f":"showFilterEditor",Escape:"clearSearch",Backspace:"onBackspace"}});gd._$name="QuickFind";G.registerFeature(gd);class Za extends te{static get pluginConfig(){return{chain:["onElementPointerDown","onElementDblClick","onElementTouchMove","onSubGridCollapse","onSubGridExpand","render"]}}onElementDblClick(e){const t=this,{client:i}=t,r=e.target.closest(".b-grid-splitter-collapsed");if(r&&!t.expanding){t.expanding=!0;let n=r.dataset.region,s=i.getSubGrid(n);s.collapsed||(n=i.getLastRegions()[1],s=i.getSubGrid(n)),s.expand().then(()=>t.expanding=!1)}}startMove(e,t){const i=this,{client:r}=i,n=e.dataset.region,s=r.element,a=r.regions[r.regions.indexOf(n)+1],o=r.getSubGrid(a),l=r.getSubGrid(n);let d=l,u=1;if(d.flex!=null&&o.flex==null&&(d=o,u=-1),r.rtl&&(u*=-1),e.classList.contains("b-grid-splitter-collapsed"))return;const h=d.element.offsetWidth+o.element.offsetWidth;i.dragContext={element:e,headerEl:d.header.element,subGridEl:d.element,subGrid:d,splitterSubGrid:l,originalWidth:d.element.offsetWidth,originalX:t,minWidth:d.minWidth||0,maxWidth:Math.min(h,d.maxWidth||h),flip:u},s.classList.add("b-moving-splitter"),l.toggleSplitterCls("b-moving"),i.pointerDetacher=B.on({element:document,pointermove:"onPointerMove",pointerup:"onPointerUp",thisObj:i})}endMove(){const e=this,{dragContext:t}=e;t&&(e.pointerDetacher(),e.client.element.classList.remove("b-moving-splitter"),t.splitterSubGrid.toggleSplitterCls("b-moving",!1),e.dragContext=null)}onCollapseClick(e,t){const i=this,{client:r}=i,n=t.dataset.region,s=r.getLastRegions();if(s[0]===n){const a=r.getSubGrid(s[1]);if(a.collapsed){a.expand();return}}e.collapse()}onExpandClick(e,t){const i=this,{client:r}=i,n=t.dataset.region,s=r.getLastRegions();if(s[0]===n&&!e.collapsed){r.getSubGrid(s[1]).collapse();return}e.expand()}updateMove(e){const{dragContext:t}=this;if(t){const i=e-t.originalX,r=Math.max(Math.min(t.maxWidth,t.originalWidth+i*t.flip),0);t.subGrid.width=Math.max(r,t.minWidth)}}onElementPointerDown(e){const t=this,{target:i}=e,r=e.button===0&&i.closest(":not(.b-row-reordering):not(.b-dragging-event):not(.b-dragging-task):not(.b-dragging-header):not(.b-dragselecting) .b-grid-splitter"),n=r&&t.client.getSubGrid(r.dataset.region);let s;r&&(i.closest(".b-grid-splitter-button-collapse")?t.onCollapseClick(n,r):i.closest(".b-grid-splitter-button-expand")?t.onExpandClick(n,r):(t.startMove(r,e.clientX),s=r)),e.pointerType==="touch"&&t.toggleTouchSplitter(s)}onPointerMove(e){this.dragContext&&(this.updateMove(e.clientX),e.preventDefault())}onElementTouchMove(e){this.dragContext&&e.preventDefault()}onPointerUp(e){this.dragContext&&(this.endMove(),e.preventDefault())}onSubGridCollapse({subGrid:e}){const t=this.client.resolveSplitter(e);this.client.getLastRegions()[1]===e.region&&t.classList.add("b-grid-splitter-allow-collapse")}onSubGridExpand({subGrid:e}){this.client.resolveSplitter(e).classList.remove("b-grid-splitter-allow-collapse")}toggleTouchSplitter(e){const t=this,{touchedSplitter:i}=t;e&&i&&e.dataset.region!==i.dataset.region&&t.toggleTouchSplitter();const r=t.client.getSubGrid(e?e.dataset.region:i?.dataset.region);r&&(r.toggleSplitterCls("b-touching",Boolean(e)),e?r.startSplitterButtonSyncing():r.stopSplitterButtonSyncing()),t.touchedSplitter=e}render(){const{regions:e,subGrids:t}=this.client;e.length>2&&(t[e[0]].splitterElement.classList.add("b-left-only"),t[e[1]].splitterElement.classList.add("b-right-only"))}}M(Za,"$name","RegionResize");Za.featureClass="b-split";Za._$name="RegionResize";G.registerFeature(Za);class Ht extends te{constructor(...e){super(...e),M(this,"entityName","row")}construct(e,t){super.construct(e,t),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",thisObj:this}),this.grid=e}onBeforeRenderRow({row:e,record:t}){e.cls["b-cut-row"]=this._isCut&&this.clipboardRecords.includes(t)}isActionAvailable(e,t,i){var r;const{grid:n}=this,{cellEdit:s}=n.features,{target:a}=i;return!this.disabled&&globalThis.getSelection().toString().length===0&&(!s||!s.isEditing)&&((r=n.selectedRecords)===null||r===void 0?void 0:r.length)>0&&(!a||Boolean(a.closest(".b-gridbase:not(.b-schedulerbase) .b-grid-subgrid,.b-grid-subgrid:not(.b-timeaxissubgrid)")))}copy(){this.copyRows()}cut(){this.copyRows(!0)}paste(e){this.pasteRows(e!=null&&e.isModel?e:null)}copyRows(e=!1){const t=this,{client:i,entityName:r}=t,n=t.selectedRecords.filter(s=>!s.readOnly||!e);!n.length||i.readOnly||i.trigger("beforeCopy",{records:n,isCut:e,entityName:r})===!1||(t._isCut=e,t.clipboardRecords.forEach(s=>{var a;return(a=i.rowManager.getRowById(s))===null||a===void 0?void 0:a.removeCls("b-cut-row")}),t.clipboardRecords=n.slice(),i.store.forEach(s=>{s.meta.isCut=t._isCut&&t.clipboardRecords.includes(s)}),n.forEach(s=>this.onRowCutOrCopy(s,e)),i.trigger("copy",{records:n,isCut:e,entityName:r}))}onRowCutOrCopy(e,t){var i;(i=this.client.rowManager.getRowById(e))===null||i===void 0||i.toggleCls("b-cut-row",t)}pasteRows(e){var t,i;const r=this,n=r.clipboardRecords,{client:s,entityName:a}=r,{store:o}=s,l=e||s.selectedRecord;if(s.readOnly||s.isTreeGrouped||!n.length||o.tree&&r._isCut&&n.some(h=>h.contains(l,!0))||s.trigger("beforePaste",{records:n,referenceRecord:l,isCut:r._isCut,entityName:a})===!1)return[];r.sortByIndex(n);const d={},u=r.extractParents(n,d);return r.insertCopiedRecords(u,l),r._isCut?r.clearClipboard():s.selectedRecords=u,s.trigger("paste",{records:u,originalRecords:n,isCut:r._isCut,referenceRecord:l,entityName:a}),(t=s.getRowFor(u[u.length-1]))===null||t===void 0||(i=t.cells)===null||i===void 0||i[0].focus(),u}clearClipboard(){this._isCut&&this.clipboardRecords.forEach(e=>{var t;return(t=this.client.rowManager.getRowById(e))===null||t===void 0?void 0:t.removeCls("b-cut-row")}),this._isCut=!1,this.clipboardRecords=[]}generateNewName(e){const t=e[this.nameField];let i=2;for(;this.client.store.findRecord(this.nameField,`${t} - ${i}`);)i++;return`${t} - ${i}`}insertCopiedRecords(e,t){const{store:i}=this.client,r=i.indexOf(t)+1;if(i.tree)return t.parent.insertChild(e,t.nextSibling,!1,{orderedBeforeNode:t.nextOrderedSibling});if(this._isCut)i.move(e,i.getAt(r));else return i.insert(r,e)}get selectedRecords(){const e=[...this.client.selectedRecords];return this.client.selectedCells.forEach(t=>{e.includes(t.record)||e.push(t.record)}),e}getMenuItemText(e){var t;const i=this;let r=i[e+"RecordText"];return((t=i.client.features.cellCopyPaste)===null||t===void 0?void 0:t.enabled)===!0&&i.client.selectedCells.length&&(r+=` (${i.selectedRecords.length>1?i.rowSpecifierTextPlural:i.rowSpecifierText})`),r}populateCellMenu({record:e,items:t}){const i=this,{client:r}=i;!r.readOnly&&!r.isTreeGrouped&&e?.isSpecialRow===!1&&i.selectedRecords.length&&(t.cut={text:i.getMenuItemText("cut"),localeClass:i,icon:"b-icon b-icon-cut",weight:135,disabled:e.readOnly,onItem:()=>i.cut()},t.copy={text:i.getMenuItemText("copy"),localeClass:i,cls:"b-separator",icon:"b-icon b-icon-copy",weight:120,onItem:()=>i.copy()},t.paste={text:i.getMenuItemText("paste"),localeClass:i,icon:"b-icon b-icon-paste",weight:140,disabled:!i.clipboardRecords.length,onItem:()=>i.paste(e)})}sortByIndex(e){const{store:t}=this.client;return e.sort((i,r)=>{const n=i.indexPath,s=r.indexPath;if(!e.includes(i.parent)&&!e.includes(r.parent))return t.indexOf(i)-t.indexOf(r);if(n.length===s.length){for(let a=0;a<n.length;a++){if(n[a]<s[a])return-1;if(n[a]>s[a])return 1}return 0}else return n.length-s.length})}extractParents(e,t){const i=this,{client:r,_isCut:n}=i;r.store.tree&&e.forEach(a=>{a.traverse(o=>{const l=o.getTopParent(!0);!e.includes(o)&&(!n||!e.some(d=>l.includes(d)))&&e.push(o)})});const s=e.reduce((a,o)=>{let l;const d=o.parentId||o.meta.modified;return n?(l=o,l.meta.isCut=!1):(l=o.copy(),l[i.nameField]=i.generateNewName(l),o.expanded&&(l.data.expanded=o.expanded)),t[o.id]=l,o.parent===r.store.rootNode?a.push(l):d in t?t[d].appendChild(l):a.push(l),a},[]);return s.forEach(a=>{a.sortOrderedChildren(!0,!0)}),s}}M(Ht,"$name","RowCopyPaste");M(Ht,"type","rowCopyPaste");M(Ht,"pluginConfig",{assign:["copyRows","pasteRows"],chain:["populateCellMenu"]});M(Ht,"properties",{clipboardRecords:[]});M(Ht,"configurable",{nameField:"name",keyMap:{"Ctrl+C":"copy","Ctrl+X":"cut","Ctrl+V":"paste"},copyRecordText:"L{copyRecord}",cutRecordText:"L{cutRecord}",pasteRecordText:"L{pasteRecord}",rowSpecifierText:"L{row}",rowSpecifierTextPlural:"L{rows}",localizableProperties:["copyRecordText","cutRecordText","pasteRecordText","rowSpecifierText","rowSpecifierTextPlural"]});Ht.featureClass="b-row-copypaste";Ht._$name="RowCopyPaste";G.registerFeature(Ht,!0,"Grid");G.registerFeature(Ht,!1,"Gantt");G.registerFeature(Ht,!1,"SchedulerPro");G.registerFeature(Ht,!1,"ResourceHistogram");const $0={remove:1,filter:1,dataset:1,replace:1};class Ja extends te{static get properties(){return{expanderBodyClass:"b-rowexpander-body",expandedRowClass:"b-rowexpander-row-expanded",recordStateMap:new Map,collapsingRecords:new Set}}static get pluginConfig(){return{chain:["afterColumnsChange","beforeRenderRow","processRowHeight","bindStore"],override:["onGridBodyFocusIn"]}}afterConstruct(){const e=this,{client:t}=e;if(!e.renderer){console.warn("RowExpander requires implementing the renderer function.");return}t.isGanttBase&&t.fixedRowHeight!==!1&&console.warn("When using RowExpander on a Gantt, the Gantt`s fixedRowHeight config must be set to false."),e.bindStore(t.store),e.triggerEvent&&t.ion({[e.triggerEvent]:"onTriggerEvent",thisObj:e}),e.addColumn()}bindStore(e){const t=this;t.recordStateMap.clear(),t.collapsingRecords.clear(),t.detachListeners("clientStoreChange"),e.ion({name:"clientStoreChange",change:t.onStoreChange,thisObj:t})}doDisable(e){const{client:t}=this;e&&(this.recordStateMap.clear(),this.collapsingRecords.clear()),t.isConfiguring||t.rowManager.renderFromRow(),super.doDisable(e)}changeLoadingIndicatorText(e){return e&&this.L(e)}onGridBodyFocusIn(e){var t,i;(t=this.client.lastMousedownEvent)!==null&&t!==void 0&&(i=t.target)!==null&&i!==void 0&&i.closest(".b-rowexpander-body")||this.overridden.onGridBodyFocusIn(e)}get isAnimating(){return this.client.isAnimating}set isAnimating(e){const{client:t}=this,i=t.isAnimating;t.isAnimating=e,t.isAnimating!==i&&t.element.classList.toggle("b-rowexpander-animating")}afterColumnsChange(){this.addColumn()}changeColumn(e){return e==null?e:F(F({type:"action",actions:[{cls:"b-icon b-icon-collapse-down",tooltip:({record:t})=>this.L(this.recordStateMap.has(t)?"L{RowExpander.collapse}":"L{RowExpander.expand}"),onClick:({record:t})=>this.toggleExpand(t)}],width:40,hideable:!1,align:"center",region:this.client.regions[0]},e),{},{field:"expanderActionColumn"})}addColumn(){const e=this,{column:t}=e,{columns:i}=e.client;!e._isAddingExpanderColumn&&t&&(!e._expander||!i.includes(e._expander))&&(e._isAddingExpanderColumn=!0,e.columnPosition==="last"?[e._expander]=i.add(t):[e._expander]=i.insert(0,t),e._isAddingExpanderColumn=!1)}onTriggerEvent({target:e}){this.disabled||e!=null&&e.closest(".b-action-cell")||!e.closest(".b-grid-cell")||this.toggleExpand(this.client.getRecordFromElement(e))}toggleExpand(e){e&&(this.recordStateMap.has(e)?this.collapse(e):this.expand(e))}onStoreChange({action:e,source:t,records:i}){const r=this,{recordStateMap:n,collapsingRecords:s}=r;if(!r.disabled){if(e==="removeAll")n.clear(),s.clear();else if($0[e])for(const[a]of n)t.includes(a)||(n.delete(a),s.delete(a));else if(r.refreshOnRecordChange&&i!==null&&i!==void 0&&i.length){if(e==="update"){const a=n.get(i[0]);a!=null&&a.isCreated&&(a.isCreated=!1,r.client.rowManager.renderFromRecord(i[0]))}else if(e==="updatemultiple"){let a,o;for(const l of i){const d=n.get(l);if(d!=null&&d.isCreated){d.isCreated=!1;const u=t.records.indexOf(l);(!o||a>u)&&(a=u,o=l)}}o&&r.client.rowManager.renderFromRecord(o)}}}}processRowHeight(e,t){var i;const r=this.recordStateMap.get(e);if(r){if(!r.isCreated&&r.isRenderingAsync)return this.loadingIndicatorHeight+t;if(!r.expanderBodyHeight)for(const n of this.client.regions){const s=r.expandElements[n].offsetHeight;s>r.expanderBodyHeight&&(r.expanderBodyHeight=s)}}return((i=r?.expanderBodyHeight)!==null&&i!==void 0?i:0)+t}beforeRenderRow({row:e,record:t}){const i=this,{regions:r}=i.client,{expandedRowClass:n}=i;e.cls.toggle("b-rowexpander-disabled",i.disabled),e.cls[n]?i.enableAnimations&&i.isAnimating&&i.collapsingRecords.has(t)?i.waitForTransition(e,()=>{i.collapsingRecords.has(t)&&i.removeExpander(e)}):i.removeExpander(e):i.collapsingRecords.delete(t);const s=i.recordStateMap.get(t);if(!i.disabled&&s){s.isCreated||i.renderExpander(t,e,s),e.cls.add(n);for(const a of r){const o=e.getElement(a);s.isCreated?o.appendChild(s.expandElements[a]):i.renderLoadingIndicator(o,s),i.lockCellHeight(o,s.cellHeight,!1)}i._shouldScrollIntoView&&(i._shouldScrollIntoView=!1,S.isInView(s.expandElements[r[0]],!0)||i.client.rowManager.ion({once:!0,thisObj:i,renderDone:()=>i.scrollRowIntoView(e,t)}))}}scrollRowIntoView(e,t){this.isAnimating?this.waitForTransition(e,()=>this.client.scrollRowIntoView(t)):this.client.scrollRowIntoView(t)}waitForTransition(e,t){B.onTransitionEnd({element:e.element,property:"height",handler:t,thisObj:this})}removeExpander(e){e.cls.remove(this.expandedRowClass);for(const t of this.client.regions){const i=e.getElement(t);i.classList.remove(this.expandedRowClass),S.removeEachSelector(i,"."+this.expanderBodyClass),this.lockCellHeight(i,null,!1)}}renderLoadingIndicator(e,t){S.createElement({parent:e,className:this.expanderBodyClass+" b-rowexpander-loading",style:{top:t.cellHeight,height:this.loadingIndicatorHeight},children:[{tag:"i",className:"b-icon b-icon-spinner"},this.loadingIndicatorText]})}renderExpander(e,t,i){var r;const n=this,s=(r=t.cells[0])===null||r===void 0?void 0:r.offsetHeight,a={},o=[],l=(d,u,h)=>{d!=null&&(typeof d=="string"?u.innerHTML=d:(d=S.createElement(d),u.appendChild(d))),a[h]=u};if(!i.isRenderingAsync){Object.assign(i,{cellHeight:s,expandElements:a,expanderBodyHeight:0});for(const d of n.client.regions){const u=t.getElement(d);t.addCls(n.expandedRowClass);const h=S.createElement({parent:u,className:n.expanderBodyClass,style:{top:s+"px"}}),f=n.renderer({record:e,expanderElement:h,rowElement:u,region:d});U.isPromise(f)?o.push(f.then(g=>l(g,h,d))):l(f,h,d)}o.length?(i.isRenderingAsync=!0,Promise.all(o).then(()=>{var d;i.isCreated=!0,(d=n.renderRowsWithAnimation)===null||d===void 0||d.call(n,e),i.isRenderingAsync=!1})):i.isCreated=!0}}renderRowsWithAnimation(e){const t=this;if(t.enableAnimations){const i=t.client.rowManager.getRowById(e);i&&(t.isAnimating=!0,t.collapsingRecords.has(e)&&i.addCls("b-row-is-collapsing"),t.waitForTransition(i,()=>{if(t.isAnimating=!1,!i.isDestroyed){var r;(r=i.removeCls)===null||r===void 0||r.call(i,"b-row-is-collapsing")}}))}t.client.rowManager.renderFromRecord(e)}lockCellHeight(e,t,i){for(let r=0;r<e.children.length;r++){const n=e.children[r];n.classList.contains(this.expanderBodyClass)||(n.style.height=i?"":t+"px")}}async expand(e){const t=this;t.disabled||await t.trigger("beforeExpand",{record:e})!==!1&&(t.recordStateMap.set(e,{isCreated:!1}),t.collapsingRecords.delete(e),t._shouldScrollIntoView=!0,t.renderRowsWithAnimation(e))}async collapse(e){const t=this;t.disabled||await t.trigger("beforeCollapse",{record:e})!==!1&&(t.recordStateMap.delete(e),t.collapsingRecords.add(e),t.renderRowsWithAnimation(e))}}M(Ja,"$name","RowExpander");M(Ja,"configurable",{renderer:null,triggerEvent:null,column:{},columnPosition:"first",refreshOnRecordChange:!1,loadingIndicatorHeight:100,loadingIndicatorText:"L{loading}",enableAnimations:!0});Ja._$name="RowExpander";G.registerFeature(Ja);class tr extends he(te){construct(e,t){this.grid=e,super.construct(...arguments)}doDestroy(){var e;(e=this.dragHelper)===null||e===void 0||e.destroy(),super.doDestroy()}init(){const e=this,{grid:t}=e;e.dragHelper=Yn.new({name:"rowReorder",cloneTarget:!0,dragThreshold:10,proxyTopOffset:10,targetSelector:".b-grid-row",lockX:!0,dragWithin:t.bodyContainer,allowDropOutside:!0,scrollManager:t.scrollManager,outerElement:e.targetSubGridElement,touchStartDelay:e.touchStartDelay,isElementDraggable:e.isElementDraggable.bind(e),monitoringConfig:{scrollables:[{element:t.scrollable.element,direction:"vertical"}]},setXY(i,r,n){const{context:s}=this;if(!s.started){const a=$.from(s.element,this.dragWithin),o=s.startPageY-window.pageYOffset-s.element.getBoundingClientRect().top;n=a.top+o+this.proxyTopOffset}S.setTranslateXY(i,r,n)},ignoreSamePositionDrop:!1,createProxy(i){const r=i.cloneNode(!0),n=document.createElement("div");if(n.classList.add("b-row-reorder-proxy"),r.removeAttribute("id"),r.style.transform="",n.appendChild(r),t.selectedRecords.length>1){const s=r.cloneNode(!0);s.classList.add("b-row-dragging-multiple"),n.appendChild(s)}return S.removeClsGlobally(n,"b-selected","b-hover","b-focused"),n},internalListeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",reset:"onReset",prio:1e4,thisObj:e}},e.dragHelperConfig),e.relayEvents(e.dragHelper,["beforeDragStart","dragStart","drag","abort"],"gridRow"),e.dropIndicator=S.createElement({className:"b-row-drop-indicator"}),e.dropOverTargetCls=["b-row-reordering-target","b-hover"]}get targetSubGridElement(){const e=this.grid.regions[0];return this.grid.subGrids[e].element}isElementDraggable(e,t){if(!e.closest(".b-grid-cell .b-widget"))if(this.gripOnly){const i=e.closest(".b-grid-cell:first-child");if(i){const r=getComputedStyle(i,":before"),n=this.grid.rtl?i.getBoundingClientRect().width-t.borderOffsetX:t.borderOffsetX;return S.roundPx(n)<=S.roundPx(parseFloat(r.width))}}else return!0}onBeforeDragStart({event:e,source:t,context:i}){const r=this,{grid:n}=r,s=r.targetSubGridElement;if(r.disabled||n.readOnly||n.isTreeGrouped||!s.contains(i.element))return!1;const a=i.startRecord=n.getRecordFromElement(i.element);if(a.readOnly||a.isSpecialRow)return!1;i.originalRowTop=n.rowManager.getRowFor(a).top,n.selectionMode.checkboxOnly||(t.startEvent.pointerType==="touch"?n.isSelected(a)||n.selectRow({record:a,addToSelection:!1}):!n.isSelected(a)&&!e.shiftKey&&!e.ctrlKey&&n.selectRow({record:a}));const o=n.selectedRecords.filter(l=>!l.readOnly);return i.records=[a],o.includes(a)&&(i.records.push(...o.filter(l=>l!==a)),i.records.sort((l,d)=>n.store.indexOf(l)-n.store.indexOf(d))),!0}onDragStart({context:e}){var t,i;const r=this,{grid:n}=r,{cellEdit:s,cellMenu:a,headerMenu:o}=n.features;s&&(r.cellEditDisabledState=s.disabled,s.disabled=!0),a==null||(t=a.hideContextMenu)===null||t===void 0||t.call(a,!1),o==null||(i=o.hideContextMenu)===null||i===void 0||i.call(o,!1),n.element.classList.add("b-row-reordering");const l=e.element.querySelector(".b-focused");l?.classList.remove("b-focused"),e.element.firstElementChild.classList.remove("b-selected","b-hover"),n.bodyContainer.appendChild(r.dropIndicator)}onDrag({context:e,event:t}){const i=this,{grid:r}=i,{store:n,rowManager:s}=r,{clientY:a}=t;let o=!0,l=s.getRowAt(a),d,u,h,f,g;if(l){const p=l.top+r._bodyRectangle.y-r.scrollable.y,v=l.height/4,y=p+v,C=p+l.height/2,D=p+v*3;u=l.dataIndex,d=n.getAt(u),n.tree?f=(d.isParent||i.dropOnLeaf)&&a>y&&a<D:n.isGrouped&&(f=d.isGroupHeader&&d.meta.collapsed),h=!f&&t.clientY>=C}else t.pageY<r._bodyRectangle.y?(u=0,d=n.first,h=!1):(u=n.count-1,d=n.last,h=!0),l=r.rowManager.getRow(u);if(d===i.overRecord&&i.after===h&&i.over===f){e.valid=i.reorderValid;return}if(i.overRecord!==d){var m;(m=s.getRowById(i.overRecord))===null||m===void 0||m.removeCls(i.dropOverTargetCls)}i.overRecord=d,i.after=h,i.over=f,(d===e.startRecord||!h&&!f&&u===0&&n.isGrouped||h&&d.isGroupHeader&&d.meta.collapsed&&n.indexOf(d)===n.count-1)&&(o=!1),n.tree?(g=h?d.nextSibling:d,e.records.some(p=>p.contains(d))&&(o=!1),e.parent=o&&f?d:d.parent,i.clearTimeout(i.hoverTimer),d&&d.isParent&&!d.isExpanded(n)&&(i.hoverTimer=i.setTimeout(()=>r.expand(d),i.hoverExpandTimeout))):g=h?n.getAt(u+1):d,l.toggleCls(i.dropOverTargetCls,o&&f),!f&&u===n.indexOf(e.startRecord)+(h?-1:1)&&e.parent&&e.startRecord.parent===e.parent&&(o=!1),l&&S.setTranslateY(i.dropIndicator,Math.max(l.top+(h?l.element.getBoundingClientRect().height:0),1)),i.dropIndicator.style.visibility=f?"hidden":"visible",i.dropIndicator.classList.toggle("b-drag-invalid",!o),e.insertBefore=g,e.valid=i.reorderValid=o}async onDrop(e){const t=this,{context:i}=e;i.valid=i.valid&&t.reorderValid,i.valid&&(i.async=!0,t.client.store.tree&&(i.oldPositionContext=i.records.map(n=>{var s;return{record:n,parentId:(s=n.parent)===null||s===void 0?void 0:s.id,parentIndex:n.parentIndex}})),await t.trigger("gridRowBeforeDropFinalize",e)===!1&&(i.valid=!1),await t.dragHelper.animateProxyTo(t.dropIndicator,{align:"l0-l0"}),await t.finalizeReorder(i)),t.clearTimeout(t.hoverTimer),t.overRecord=t.after=t.over=null,t.trigger("gridRowDrop",e)}async finalizeReorder(e){const t=this,{grid:i}=t,{store:r,focusedCell:n}=i;let{records:s}=e;if(e.valid=e.valid&&!s.some(l=>!r.includes(l)),e.valid){let l;if(r.tree){var a,o;s=s.filter(d=>!d.parent||d.bubbleWhile(u=>!s.includes(u),!0)),l=await e.parent.tryInsertChild(s,t.over?(a=e.parent.children)===null||a===void 0?void 0:a[0]:e.insertBefore),i.rowManager.forEach(d=>d.removeCls(t.dropOverTargetCls)),!e.parent.isExpanded()&&(o=e.parent.children)!==null&&o!==void 0&&o.length&&i.expand(e.parent),e.valid=l!==!1}else r.isGrouped&&t.over?r.move(s,r.getAt(r.indexOf(e.insertBefore)+1)):r.move(s,e.insertBefore);n?._rowIndex>=0&&(i._focusedCell=null,i.focusCell({grid:i,record:n.record,columnId:n.columnId})),r.clearSorters()}e.finalize(e.valid),i.element.classList.remove("b-row-reordering")}onReset(){const e=this,{grid:t}=e,i=t.features.cellEdit;t.element.classList.remove("b-row-reordering"),i&&(i.disabled=e.cellEditDisabledState),e.dropIndicator.remove(),S.removeClsGlobally(t.element,...e.dropOverTargetCls)}onPaint({firstPaint:e}){e&&this.init()}updateShowGrip(e){this.grid.element.classList.toggle("b-row-reorder-with-grip",e)}}M(tr,"$name","RowReorder");M(tr,"configurable",{showGrip:null,gripOnly:null,hoverExpandTimeout:1e3,touchStartDelay:300,dropOnLeaf:!1,dragHelperConfig:null});M(tr,"pluginConfig",{after:["onPaint"]});tr.featureClass="";tr._$name="RowReorder";G.registerFeature(tr,!1);G.registerFeature(tr,!0,"Gantt");class md extends he(te){static get $name(){return"Search"}static get configurable(){return{limit:1e3,showHitIndex:!0,keyMap:{F3:"gotoNextHit","Ctrl+g":"gotoNextHit","Shift+F3":"gotoPrevHit","Ctrl+Shift+g":"gotoPrevHit"}}}static get properties(){return{hitCls:"b-search-hit",hitCellCls:"b-search-hit-cell",hitCellBadgeCls:"b-search-hit-cell-badge",hitTextCls:"b-search-hit-text"}}construct(e,t){const i=this;super.construct(e,t),Object.assign(i,{grid:e,text:"",hitEls:[],treeWalker:e.setupTreeWalker(e.element,S.NodeFilter.SHOW_TEXT,()=>S.NodeFilter.FILTER_ACCEPT)}),e.ion({expandNode:"onTreeNodeExpand",thisObj:i})}isActionAvailable(){return Boolean(this.text)}onTreeNodeExpand(){this.text&&this.requestAnimationFrame(this.search,[this.text,!1,!0])}doDestroy(){this.clear(!0),super.doDestroy()}doDisable(e){e&&this.clear(),super.doDisable(e)}get store(){return this.grid.store}static get pluginConfig(){return{chain:["populateCellMenu"]}}async search(e,t=!0,i=!1,r){const n=this;if(!e)return n.clear();if(!i&&e===n.text||n.disabled)return;const{grid:s,store:a}=n,o=s.columns.visibleColumns.filter(h=>h.searchable!==!1),l=[];r=r||o.map(h=>{var f;return l.push((f=h.formatValue)===null||f===void 0?void 0:f.bind(h)),h.field});const d=a.search(e,r,l);a.isTree&&d.length&&await s.expandTo(d.map(h=>h.id));for(const h of o)if(h.mergeCells&&h.isSorted){let f=null,g=null;for(const m of d)if(m.field===h.field){const p=m.data[m.field];p===f&&(m.belongsTo=g),f=p,g=`${m.field}-${m.id}`}}let u=1;if(Object.assign(n,{foundMap:{},prevFound:n.found,found:d,text:e,findRe:new RegExp(`(\\s+)?(${z.escapeRegExp(String(e))})(\\s+)?`,"ig")}),n.clearHits(),!!d){for(const h of d)if(n.foundMap[`${h.field}-${h.id}`]=h.belongsTo?n.foundMap[h.belongsTo]:u++,u>n.limit)break;return n.listenersInitialized||(s.rowManager.ion({name:"renderCell",renderCell:"renderCell",thisObj:n}),a.ion({name:"storeRefresh",[`refresh${s.asyncEventSuffix}`]:"onStoreRefresh",thisObj:n}),n.listenersInitialized=!0),s.refreshRows(),s.trigger("search",{grid:s,find:e,found:d}),t&&!n.isHitFocused&&n.gotoNextHit(!0),d}}clearHits(){for(const e of S.children(this.grid.element,"."+this.hitCls)){e.classList.remove(this.hitCls,this.hitCellCls);const t=$e.get(e).row;t&&(t.forceInnerHTML=!0,t.renderCell(e),t.forceInnerHTML=!1)}}clear(e=!1){const t=this,{grid:i}=t;t.foundMap&&delete t.foundMap,t.text=null,t.clearHits(),t.listenersInitialized&&(this.detachListeners("renderCell"),this.detachListeners("storeRefresh"),t.listenersInitialized=!1),e||i.trigger("clearSearch",{grid:i})}get foundCount(){var e,t;return(e=(t=this.found)===null||t===void 0?void 0:t.length)!==null&&e!==void 0?e:0}get isHitFocused(){var e;const t=this,{grid:i}=t,{focusedCell:r}=i;if(r!=null&&(e=r.cell)!==null&&e!==void 0&&e.contains(S.getActiveElement(i.element))){const{rowIndex:n,column:s}=r;return n!==-1&&t.found.some(a=>a.index===n&&s&&a.field===s.field)}}gotoNextHit(e=!1){var t;const i=this;if(!((t=i.found)!==null&&t!==void 0&&t.length))return;const{grid:r,store:n}=i,s=r.focusedCell||r.lastFocusedCell,a=s&&e!==!0?n.indexOf(s.record,void 0,!0):-1,o=i.found.findIndex(l=>l.index>a);o!==-1&&i.gotoHit(o)}gotoPrevHit(){var e;const t=this,{store:i}=t;if(!((e=t.found)!==null&&e!==void 0&&e.length))return;const{grid:r,found:n}=t,s=r.focusedCell||r.lastFocusedCell,a=s?i.indexOf(s.record,void 0,!0):0;for(let o=n.length-1;o--;o>=0)if(n[o].index<a){t.gotoHit(o);break}}gotoHit(e){const{grid:t}=this,i=this.found[e];return i&&t.focusCell({field:i.field,id:i.id}),Boolean(i)}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}renderCell({cellElement:e,column:t,record:i,value:r}){var n;const s=this,{treeWalker:a,findRe:o,hitTextCls:l,showHitIndex:d}=s,u=(n=s.foundMap)===null||n===void 0?void 0:n[t.field+"-"+i.id];if(u){var h;e.classList.add(s.hitCls),d&&((h=e.querySelector(`.${s.hitCellBadgeCls}`))===null||h===void 0||h.remove());const f=S.down(e,".b-grid-cell-value,.b-tree-cell-value")||e;if(String(r).toLowerCase()===String(s.text).toLowerCase())f.innerHTML=`<span class="${s.hitTextCls}">${f.innerHTML}</span>${d?`<div class="${s.hitCellBadgeCls}">${u}</div>`:""}`;else{a.currentNode=f;for(let g=a.nextNode();g&&f.contains(g);){const m=g,p=g.nodeValue,v=["<span>"];g=a.nextNode();let y=o.lastIndex;for(let C=o.exec(p);C;C=o.exec(p)){const D=p.substring(y,C.index),w=C[1]?"\xA0":"",E=C[2],R=C[3]?"\xA0":"";v.push(`${z.encodeHtml(D)}${w}<span class="${l}">${E}</span>${R}`),y=o.lastIndex}v.push(z.encodeHtml(p.substring(y)),"<span>"),m.parentNode.insertBefore(S.createElementFromTemplate(v.join(""),{fragment:!0}),m),m.remove()}d&&S.createElement({parent:e,className:s.hitCellBadgeCls,text:u})}s.hitEls.push(e)}}populateCellMenu({column:e,record:t,items:i,cellElement:r}){const n=this;e.searchable&&(i.search={text:"L{searchForValue}",localeClass:n,icon:"b-fw-icon b-icon-search",cls:"b-separator",weight:200,disabled:n.disabled,onItem:()=>{let s=globalThis.getSelection().toString();s||(s=r.innerText),n.search(s)}})}onStoreRefresh(){this.search(this.text,!1,!0)}}md.featureClass="b-search";md._$name="Search";G.registerFeature(md);class pd extends te{static get $name(){return"Sort"}static get configurable(){return{multiSort:!0,prioritizeColumns:!1}}static get properties(){return{ignoreRe:new RegExp(["b-grid-header-resize-handle","b-filter-icon"].join("|")),sortableCls:"b-sortable",sortedCls:"b-sort",sortedAscCls:"b-asc",sortedDescCls:"b-desc"}}construct(e,t){t=this.processConfig(t),this.grid=e,this.bindStore(this.store),super.construct(e,t)}processConfig(e){return typeof e=="string"||Array.isArray(e)?{field:e,ascending:null}:e}setConfig(e){super.setConfig(this.processConfig(e))}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeSort:"onStoreBeforeSort",sort:"syncHeaderSortState",thisObj:this})}set field(e){const t=this.grid.columns.get(e);t&&typeof t.sortable=="object"&&(t.sortable.field=t.sortable.property||e,e=t.sortable),this.store.sort(e,this.ascending)}get store(){return this.grid[this.grid.sortFeatureStore]}static get pluginConfig(){return{chain:["onElementClick","populateHeaderMenu","getColumnDragToolbarItems","renderHeader","onPaint","bindStore"]}}syncHeaderSortState(){const e=this,{grid:t}=e;if(!t.hideHeaders&&t.isPainted){const r=e.store.sorters,n=r.length,s=new Q;let a;for(const o of t.columns.visibleColumns){var i;const l=o.element,d=(i=o.textWrapper)===null||i===void 0?void 0:i.dataset;let u="none";d?.sortIndex&&delete d.sortIndex,s.value=l.classList,o.sortable!==!1?(s.add(e.sortableCls),a=r.find(h=>h.field===o.field||h.sortFn&&h.sortFn===o.sortable.sortFn),a?(n>1&&d&&(d.sortIndex=r.indexOf(a)+1),s.add(e.sortedCls),a.ascending?(s.add(e.sortedAscCls),s.remove(e.sortedDescCls),u="ascending"):(s.add(e.sortedDescCls),s.remove(e.sortedAscCls),u="descending")):(s.remove(e.sortedCls),s["b-group"]||(s.remove(e.sortedAscCls),s.remove(e.sortedDescCls)))):s.remove(e.sortableCls),S.syncClassList(l,s),S.setAttributes(l,{"aria-sort":u})}}}populateHeaderMenu({column:e,items:t}){const i=this,{store:r}=i,n=F(F({},e.sortable),{},{field:e.field,columnOwned:!0});if(e.sortable!==!1&&(t.sortAsc={text:"L{sortAscending}",localeClass:i,icon:"b-fw-icon b-icon-sort-asc",cls:"b-separator",weight:300,disabled:i.disabled,onItem:()=>r.sort(n,!0)},t.sortDesc={text:"L{sortDescending}",localeClass:i,icon:"b-fw-icon b-icon-sort-desc",weight:310,disabled:i.disabled,onItem:()=>r.sort(n,!1)},i.multiSort&&i.grid.columns.records.some(s=>s.sortable))){const s=r.sorters.find(a=>a.field===e.field||e.sortable.sortFn&&e.sortable.sortFn===a.sortFn);t.multiSort={text:"L{multiSort}",localeClass:i,icon:"b-fw-icon b-icon-sort",weight:320,disabled:i.disabled,menu:{addSortAsc:{text:s?"L{toggleSortAscending}":"L{addSortAscending}",localeClass:i,icon:"b-fw-icon b-icon-sort-asc",disabled:s&&s?.ascending,weight:330,onItem:()=>r.addSorter(n,!0)},addSortDesc:{text:s?"L{toggleSortDescending}":"L{addSortDescending}",localeClass:i,icon:"b-fw-icon b-icon-sort-desc",disabled:s&&!s.ascending,weight:340,onItem:()=>r.addSorter(n,!1)},removeSorter:{text:"L{removeSorter}",localeClass:i,icon:"b-fw-icon b-icon-remove",weight:350,disabled:!s,onItem:()=>{r.removeSorter(n.field)}}}}}}getColumnDragToolbarItems(e,t){const i=this,{store:r,disabled:n}=i;if(e.sortable!==!1){const s=r.sorters.find(a=>a.field===e.field);t.push({text:"L{sortAscendingShort}",group:"L{sort}",localeClass:i,icon:"b-icon b-icon-sort-asc",ref:"sortAsc",cls:"b-separator",weight:105,disabled:n,onDrop:({column:a})=>r.sort(a.field,!0)},{text:"L{sortDescendingShort}",group:"L{sort}",localeClass:i,icon:"b-icon b-icon-sort-desc",ref:"sortDesc",weight:105,disabled:n,onDrop:({column:a})=>r.sort(a.field,!1)},{text:"L{addSortAscendingShort}",group:"L{multiSort}",localeClass:i,icon:"b-icon b-icon-sort-asc",ref:"multisortAddAsc",disabled:n||s&&s.ascending,weight:105,onDrop:({column:a})=>r.addSorter(a.field,!0)},{text:"L{addSortDescendingShort}",group:"L{multiSort}",localeClass:i,icon:"b-icon b-icon-sort-desc",ref:"multisortAddDesc",disabled:n||s&&!s.ascending,weight:105,onDrop:({column:a})=>r.addSorter(a.field,!1)},{text:"L{removeSorterShort}",group:"L{multiSort}",localeClass:i,icon:"b-icon b-icon-remove",ref:"multisortRemove",weight:105,disabled:n||!s,onDrop:({column:a})=>r.removeSorter(a.field)})}return t}onStoreBeforeSort({sorters:e}){const{columns:t}=this.client;for(let r=0;r<e.length;r++){var i;const n=e[r],s=(n.columnOwned||this.prioritizeColumns)&&t.get(n.field);s!=null&&(i=s.sortable)!==null&&i!==void 0&&i.sortFn&&(e[r]=F(F(F({},n),s.sortable),{},{columnOwned:!0}))}}onElementClick(e){const t=this,{store:i}=t,{target:r}=e,n=r.closest(".b-grid-header.b-sortable"),s=n?.dataset.column;if(!(t.ignoreRe.test(r.className)||t.disabled||e.handled)&&n&&s){const a=t.grid.columns.getById(n.dataset.columnId);if(i.isGrouped&&i.groupers.find(l=>l.field===s)&&!e.shiftKey)return;if(a.sortable&&!e.shiftKey)if(e.ctrlKey&&e.altKey)i.removeSorter(a.field);else{const l={columnOwned:!0,field:a.field};typeof a.sortable=="object"&&T.assign(l,a.sortable),i.sort(l,null,e.ctrlKey)}}}renderHeader(){this.syncHeaderSortState()}onPaint(){this.syncHeaderSortState()}}pd.featureClass="b-sort";pd._$name="Sort";G.registerFeature(pd,!0);class Cm extends te{static get $name(){return"StickyCells"}static get defaultConfig(){return{contentSelector:null,currentTopRowCls:"b-sticky-cells-current-top-row"}}static get pluginConfig(){return{before:["renderRows"]}}construct(e,t){super.construct(e,t),e.ion({scroll:"onGridScroll",thisObj:this}),Object.assign(this,S.createElement({reference:"element",parent:e.element,className:"b-grid-sticky-row",children:[{reference:"contentElement",className:"b-grid-cell"}]})),this.removeClasses={"b-focused":!1,"b-hover":!1,"b-selected":!1,[this.currentTopRowCls]:!1}}renderRows(){this.element.classList.add("b-hide-visibility")}onGridScroll(){const e=this,{client:t,element:i,contentElement:r}=e,n=$.client(t.bodyContainer).roundPx(),s=t.rowManager.getRowAt(n.y),a=s!==e.currentTopRow;if(s){a&&(e.currentTopRow&&(e.currentTopRow.removeCls(e.currentTopRowCls),e.currentTopRow.removeCls("b-not-enough-height")),e.currentTopRow=s,s.addCls(e.currentTopRowCls),r.innerHTML="",r.appendChild(e.updateStickyContent()));const o=e.currentTopRow.bottom-e.client.scrollable.y<=e.stickyContentHeight;e.element.classList[o?"add":"remove"]("b-hide-visibility"),e.currentTopRow[o?"addCls":"removeCls"]("b-not-enough-height"),n.y+=e.stickyContentTop,S.alignTo(i,e.stickyEls[0],{align:"t0-t0",constrainTo:n},!0)}e.lastProcessedTopRow=s}updateStickyContent(){const e=this,{currentTopRow:t,removeClasses:i}=e,r={"b-grid-sticky-row":1},n={},s=e.stickyContent||(e.stickyContent=document.createDocumentFragment()),a=e.stickyEls||(e.stickyEls=[]);for(a.forEach(o=>{o.classList.remove("b-sticky-content-el")}),a.length=0,t.eachElement(o=>{a.push(...o.querySelectorAll(e.contentSelector))});s.firstChild;)s.remove(s.firstChild);return e.stickyContentHeight=0,e.stickyContentTop=0,a.map(o=>{o.closest(".b-grid-cell").classList.forEach(u=>n[u]=1),o.closest(".b-grid-row").classList.forEach(u=>r[u]=1),Object.assign(n,i),Object.assign(r,i);const l=o.offsetTop;e.stickyContentTop=Math.max(e.stickyContentTop,l),o.style.alignSelf="flex-end",e.stickyContentHeight=Math.max(e.stickyContentHeight,e.currentTopRow.height-o.offsetTop+l),o.style.alignSelf="";const d=o.cloneNode(!0);return o.classList.add("b-sticky-content-el"),s.appendChild(d),d}),n["b-focused"]=!1,S.syncClassList(e.contentElement,n),S.syncClassList(e.element,r),s}}Cm._$name="StickyCells";G.registerFeature(Cm,!1);class wm extends te{static get $name(){return"Stripe"}construct(e,t){super.construct(e,t),e.ion({renderrow:"onRenderRow",thisObj:this})}doDisable(e){this.isConfiguring||this.client.refreshRows(),super.doDisable(e)}onRenderRow({row:e}){const{disabled:t}=this,i=e.dataIndex%2===0;e.assignCls({"b-even":!t&&i,"b-odd":!t&&!i})}}wm._$name="Stripe";G.registerFeature(wm);class Qa extends bm(te){static get configurable(){return{selectedOnly:null,hideFooters:!1}}static get pluginConfig(){return{chain:["renderRows","bindStore"]}}static get $name(){return"Summary"}construct(e,t){this.grid=e,super.construct(e,t),this.bindStore(e.store),e.hideFooters=this.hideFooters}bindStore(e){this.detachListeners("store"),e.ion({name:"store",change:"onStoreChange",thisObj:this})}get store(){return this.grid.store}doDestroy(){super.doDestroy()}doDisable(e){super.doDisable(e);const{client:t}=this;e?t.element.classList.add("b-summary-disabled"):(this.updateSummaries(),t.element.classList.remove("b-summary-disabled"),t.eachSubGrid(i=>i.scrollable.syncPartners()))}renderRows(){this.updateSummaries()}updateSummaries(){const e=this,{grid:t,store:i}=e,r=S.children(t.element,".b-grid-footer"),n=e.selectedOnly&&t.selectedRecords.length>0,s=(i.isFiltered?i.storage.values:i.allRecords).filter(a=>!a.isSpecialRow&&(!n||t.isSelected(a)));t.columns.forEach(a=>{var o;(o=a.summaries)===null||o===void 0||o.forEach(l=>{"seed"in l&&("initialSeed"in l||(l.initialSeed=l.seed),["number","string","date"].includes(typeof l.initialSeed)?l.seed=l.initialSeed:l.seed=Object.assign({},l.initialSeed))})}),r.forEach(a=>{if(!a.dataset.column)return;const o=t.columns.get(a.dataset.column),l=e.generateHtml(o,s,"b-grid-footer-summary");(o.summaries?o.summaries.length:o.sum?1:0)&&(a.children.length?S.sync(l,a.firstElementChild):a.innerHTML=l)})}onStoreChange({action:e,changes:t}){let i=!0;this.disabled||(e==="update"&&(i=Object.keys(t).some(r=>{const n=this.grid.columns.get(r);return Boolean(n)&&(Boolean(n.sum)||Boolean(n.summaries))})),i&&this.updateSummaries())}updateSelectedOnly(e){const t=this;t.detachListeners("selectionChange"),e&&t.grid.ion({name:"selectionChange",selectionChange:t.refresh,thisObj:t}),t.refresh()}refresh(){this.updateSummaries()}}Qa.featureClass="b-summary";Qa._$name="Summary";G.registerFeature(Qa);const _0=Promise.resolve();class Yr extends te.mixin(he){static get pluginConfig(){return{assign:["collapseAll","expandAll","collapse","expand","expandTo","toggleCollapse"],chain:["onElementPointerUp","onElementClick","bindStore"]}}construct(e,t){super.construct(e,t),this.treeColumn||console.info("To use the tree feature, one column should be configured with `type: 'tree'`"),e.store&&this.bindStore(e.store)}doDisable(e){if(e)throw new Error("Tree feature cannot be disabled")}get store(){return this.client.store}get treeColumn(){const e=this,{columns:t}=e.client;return(!e._treeColumn||!t.includes(e._treeColumn))&&(e._treeColumn=t.find(i=>i.isTreeColumn)),e._treeColumn}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeLoadChildren:"onBeforeLoadChildren",loadChildren:"onLoadChildren",loadChildrenException:"onLoadChildrenException",beforeToggleNode:"onBeforeToggleNode",thisObj:this})}async toggleCollapse(e,t,i=!1){if(e==null)throw new Error("Tree#toggleCollapse must be passed a record");const r=this,{store:n,client:s}=r,{rowManager:a}=s,o=n.getById(e),l=o.instanceMeta(n);if(await n.toggleCollapse(o,t)){const d=a.getRowFor(o);if(d&&o.ancestorsExpanded()){const u=r.treeColumn&&!r.treeColumn.subGrid.collapsed&&d.getCell(r.treeColumn.id);u&&d.renderCell(u)}r.isTogglingNode||(s.element.classList.add("b-toggling-node"),r.isTogglingNode=!0,r.requestAnimationFrame(()=>{s.element.classList.remove("b-toggling-node"),r.isTogglingNode=!1})),s.trigger(l.collapsed?"collapseNode":"expandNode",{record:o}),s.trigger("toggleNode",{record:o,collapse:l.collapsed})}}async collapse(e){return this.toggleCollapse(e,!0)}async expand(e){return this.toggleCollapse(e,!1)}onBeforeToggleNode({record:e,collapse:t}){this.client.trigger("beforeToggleNode",{record:e,collapse:t})}onBeforeLoadChildren({source:e,params:t}){const i=e.getById(t[e.modelClass.idField]),r=this.client.rowManager.getRowFor(i);r?.addCls("b-loading-children")}onLoadChildren({source:e,params:t}){const i=e.getById(t[e.modelClass.idField]),r=this.client.rowManager.getRowFor(i);r?.removeCls("b-loading-children")}onLoadChildrenException({record:e}){const t=this.client.rowManager.getRowFor(e);t?.removeCls("b-loading-children")}async expandOrCollapseAll(e=!0,t=this.store.rootNode){const{client:i,store:r}=this,n=[],s=[];return i.trigger("beforeToggleAllNodes",{collapse:e}),r.suspendEvents(),r.traverse(a=>{const o=a.instanceMeta(r);a.isLeaf||(e&&!o.collapsed?(this.toggleCollapse(a,!0,!0),s.push(...a.children)):!e&&o.collapsed&&(Array.isArray(a.children)&&s.push(...a.children),n.push(this.toggleCollapse(a,!1,!0))))},t,t===r.rootNode),r.resumeEvents(),(e?_0:Promise.all(n)).then(()=>{i.refreshRows(e),s.length&&(e?r.trigger("remove",{records:s,isCollapse:!0,isCollapseAll:!0}):r.trigger("add",{records:s,isExpand:!0,isExpandAll:!0})),i.trigger("toggleAllNodes",{collapse:e})})}async collapseAll(){return this.expandOrCollapseAll(!0)}async expandAll(){return this.expandOrCollapseAll(!1)}async expandTo(e,t=!0){const i=this,{store:r,client:n}=i;if(Array.isArray(e)){if(e.length>0){n.suspendRefresh();for(let d=e.length-1;d>=0;d--){var s;const u=r.getById(e[d]);if(d===0){var a;(a=n.resumeRefresh)===null||a===void 0||a.call(n),n.rowManager.refresh()}await((s=i.expandTo)===null||s===void 0?void 0:s.call(i,u,d===0))}}return}const o=r.getById(e);if(o.instanceMeta(i.store).hiddenByCollapse!==!1){if(!o.ancestorsExpanded()){var l;const d=[];for(let u=o.parent;u&&!u.isRoot;u=u.parent)u.isExpanded(r)||d.unshift(u);for(const u of d)i.isDestroyed||await i.toggleCollapse(u,!1,!0);(l=n.refreshRows)===null||l===void 0||l.call(n)}!i.isDestroyed&&t&&await n.scrollRowIntoView(o)}}onElementPointerUp(e){const t=this,i=e.target,r=t.client.getCellDataFromEvent(e);(i.closest(".b-tree-expander")||t.expandOnCellClick&&r!==null&&r!==void 0&&r.record.isParent)&&t.toggleCollapse(r.record)}onElementClick(e){e.target.closest(".b-tree-expander")&&e.preventDefault()}toggleCollapseByKey(){const{focusedCell:e}=this.client;return e?.rowIndex>-1&&!e.isActionable?(this.toggleCollapse(e.id),!0):!1}expandIfSingleColumn(){return this.client.columns.count===1?this.expandByKey():!1}expandByKey(){const e=this,{client:t}=e,{focusedCell:i}=t,r=i?.record;return i!=null&&i.column.tree&&r.isParent&&r.instanceMeta(t.store).collapsed?(e.expand(r),!0):!1}collapseIfSingleColumn(){return this.client.columns.count===1?this.collapseByKey():!1}collapseByKey(){const e=this,{client:t}=e,{focusedCell:i}=t,r=i?.record;if(i!=null&&i.column.tree){if(r.isParent&&!r.instanceMeta(t.store).collapsed)return e.collapse(r),!0;if(r.parent&&!r.parent.isRoot)return t.deselectAll(),t.focusCell({record:r.parent,column:i.column}),!0}return!1}}M(Yr,"$name","Tree");M(Yr,"configurable",{expandOnCellClick:!1,keyMap:{" ":"toggleCollapseByKey",ArrowRight:"expandIfSingleColumn","Shift+ArrowRight":"expandByKey",ArrowLeft:"collapseIfSingleColumn","Shift+ArrowLeft":"collapseByKey"}});Yr.featureClass="b-tree";Yr._$name="Tree";G.registerFeature(Yr,!1,"Grid");G.registerFeature(Yr,!0,"TreeGrid");class Gr extends te{construct(e,t){if(super.construct(e,t),!e.hasFeature("tree"))throw new Error("The TreeGroup feature requires the Tree feature to be enabled")}processParentData(e){this.parentCls&&(e.cls=this.parentCls)}processTransformedData(e){}async waitForReadiness(){if(this.originalStore.isLoading&&(await this.originalStore.await("load",!1),this.isDestroyed))return;const{crudManager:e}=this.client;if(e){if(e.isLoadingOrSyncing&&(await e.await("requestDone"),this.isDestroyed))return;await this.client.project.commitAsync()}}async applyLevels(e){const t=this,{client:i}=t,r=i.columns.find(a=>a instanceof Ur);let{store:n}=i,s=null;if(t._levels=e,t.isApplying++,i.suspendRefresh(),e&&!t.originalStore&&(t.originalStore=n,n=new n.constructor({tree:!0,modelClass:n.modelClass}),i.store=n),await t.waitForReadiness(),!t.isDestroyed)return e?(n.data=t.originalStore.allRecords.flatMap(a=>a.isLeaf?[a.link()]:[]),s=n.treeify(e,a=>{T.setPath(a,n.modelClass.getFieldDataSource(r.field),a.key),t.processParentData(a)}),t.processTransformedData(s),n.data=s.children):(i.store=t.originalStore,t.originalStore=null),t.isApplying--,i.resumeRefresh(),i.rowManager.reinitialize(),s}updateLevels(e){(e||!this.isConfiguring)&&this.applyLevels(e)}async group(e){T.assertArray(e,"group()"),await this.applyLevels(e)}async clearGroups(){this.isGrouped&&await this.applyLevels(null)}get isGrouped(){return Boolean(this._levels)}}M(Gr,"$name","TreeGroup");M(Gr,"configurable",{levels:null,parentCls:"b-generated-parent"});M(Gr,"pluginConfig",{assign:["group","clearGroups"]});M(Gr,"properties",{isApplying:0,originalStore:null});Gr._$name="TreeGroup";G.registerFeature(Gr);const tt={all:"all",visible:"visible"},Hi={A6:{width:4.11,height:5.81},A5:{width:5.81,height:8.25},A4:{width:8.25,height:11.69},A3:{width:11.69,height:16.49},Legal:{width:8.5,height:14},Letter:{width:8.5,height:11}},Pn={portrait:"portrait",landscape:"landscape"},pl={pdf:"pdf",png:"png"},H0={pdf:"application/pdf",png:"image/png"};class Sm extends Ze{static get $name(){return"ExportRowsCombo"}static get type(){return"exportrowscombo"}static get defaultConfig(){return{editable:!1}}buildItems(){const e=this;return[{id:tt.all,text:e.L("L{all}")},{id:tt.visible,text:e.L("L{visible}")}]}}Sm.initClass();Sm._$name="ExportRowsCombo";class Dm extends Ze{static get $name(){return"ExportOrientationCombo"}static get type(){return"exportorientationcombo"}static get defaultConfig(){return{editable:!1}}buildItems(){const e=this;return[{id:Pn.portrait,text:e.L("L{portrait}")},{id:Pn.landscape,text:e.L("L{landscape}")}]}}Dm.initClass();Dm._$name="ExportOrientationCombo";function Bh(c,e=t=>t){return Object.keys(c).map(t=>({id:t,text:e(t)}))}class eo extends We{static get $name(){return"ExportDialog"}static get type(){return"exportdialog"}static get configurable(){return{autoShow:!1,autoClose:!1,closable:!0,centered:!0,client:null,autoSelectVisibleColumns:!0,hidePNGMultipageOption:!0,title:"L{exportSettings}",maxHeight:"80%",scrollable:{overflowY:!0},defaults:{localeClass:this},items:{columnsField:{type:"combo",label:"L{ExportDialog.columns}",store:{},valueField:"id",displayField:"text",multiSelect:!0,weight:100,maxHeight:100},rowsRangeField:{type:"exportrowscombo",label:"L{ExportDialog.rows}",value:"all",weight:200},exporterTypeField:{type:"combo",label:"L{ExportDialog.exporterType}",editable:!1,value:"singlepage",displayField:"text",buildItems(){const e=this.parent;return e.exporters.map(t=>({id:t.type,text:e.optionalL(t.title,this)}))},onChange({value:e}){this.owner.widgetMap.alignRowsField.hidden=e==="singlepage",this.owner.widgetMap.repeatHeaderField.hidden=e!=="multipagevertical"},weight:300},alignRowsField:{type:"checkbox",label:"L{ExportDialog.alignRows}",checked:!1,hidden:!0,weight:400},repeatHeaderField:{type:"checkbox",label:"L{ExportDialog.repeatHeader}",localeClass:this,hidden:!0,weight:500},fileFormatField:{type:"combo",label:"L{ExportDialog.fileFormat}",localeClass:this,editable:!1,value:"pdf",items:[],onChange({value:e,oldValue:t}){const i=this.parent;if(i.hidePNGMultipageOption){const r=i.widgetMap.exporterTypeField,n=r.store.find(s=>s.id==="singlepage");e===pl.png&&n?(this._previousDisabled=r.disabled,r.disabled=!0,this._previousValue=r.value,r.value="singlepage"):t===pl.png&&this._previousValue&&(r.disabled=this._previousDisabled,r.value=this._previousValue)}},weight:600},paperFormatField:{type:"combo",label:"L{ExportDialog.paperFormat}",editable:!1,value:"A4",items:[],weight:700},orientationField:{type:"exportorientationcombo",label:"L{ExportDialog.orientation}",value:"portrait",weight:800}},bbar:{defaults:{localeClass:this},items:{exportButton:{color:"b-green",text:"L{ExportDialog.export}",weight:100,onClick:"up.onExportClick"},cancelButton:{color:"b-gray",text:"L{ExportDialog.cancel}",weight:200,onClick:"up.onCancelClick"}}}}}construct(e={}){const t=this,{client:i}=e;if(!i)throw new Error("`client` config is required");t.columnsStore=i.columns.chain(r=>r.isLeaf&&r.exportable,null,{excludeCollapsedRecords:!1}),t.applyInitialValues(e),super.construct(e),He.ion({locale:"onLocaleChange",prio:-1,thisObj:t})}applyInitialValues(e){const t=this,i=e.items=e.items||{};e.width=e.width||t.L("L{width}"),e.defaults=e.defaults||{},e.defaults.labelWidth=e.defaults.labelWidth||t.L("L{ExportDialog.labelWidth}"),i.columnsField=i.columnsField||{},i.fileFormatField=i.fileFormatField||{},i.paperFormatField=i.paperFormatField||{},i.fileFormatField.items=Bh(pl,r=>r.toUpperCase()),i.paperFormatField.items=Bh(Hi),i.columnsField.store=t.columnsStore}onBeforeShow(){var e;const{columnsField:t,alignRowsField:i,exporterTypeField:r,repeatHeaderField:n}=this.widgetMap;this.autoSelectVisibleColumns&&(t.value=this.columnsStore.query(s=>!s.hidden)),i.hidden=r.value==="singlepage",n.hidden=r.value!=="multipagevertical",(e=super.onBeforeShow)===null||e===void 0||e.call(this,...arguments)}onLocaleChange(){const e=this.L("L{labelWidth}");this.width=this.L("L{width}"),this.eachWidget(t=>{t instanceof Oe&&(t.labelWidth=e)})}onExportClick(){const e=this.values;this.trigger("export",{values:e})}onCancelClick(){this.trigger("cancel"),this.hide()}get values(){const e=/field/i,t={};return this.eachWidget(i=>{e.test(i.ref)&&(t[i.ref.replace(e,"")]=i instanceof Nr?i.checked:i.value)}),t}}eo.initClass();eo._$name="ExportDialog";const vl=document.createRange();class is extends P{static get configurable(){return{cls:{$config:{equal:(e,t)=>e?.isDomClassList&&t?.isDomClassList&&e.isEqual(t)}}}}construct(e){Object.assign(this,{_elements:{},_elementsArray:[],_cells:{},_allCells:[],_regions:[],lastHeight:0,lastTop:-1,_dataIndex:0,_top:0,_height:0,_id:null,forceInnerHTML:!1,isGroupFooter:!1,cellContext:new ne({grid:e.grid,id:null,columnIndex:0})}),super.construct(e),this.grid.positionMode==="position"&&(this.translateElements=this.positionElements)}doDestroy(){const e=this;e.rowManager.isDestroying||(e.removeElements(),e.rowManager.idMap[e.id]===e&&delete e.rowManager.idMap[e.id]),super.doDestroy()}get index(){return this._index}set index(e){this._index=e}get dataIndex(){return this._dataIndex}set dataIndex(e){this._dataIndex!==e&&(this._dataIndex=e,this.eachElement(t=>{t.dataset.index=e,t.ariaRowIndex=this.grid.hideHeaders?e+1:e+2}))}get id(){return this._id}set id(e){const t=this,i={id:e},r=t.rowManager.idMap;(t._id!==e||r[e]!==t)&&(r[t._id]===t&&delete r[t._id],r[e]=t,t._id=e,t.eachElement(n=>{$e.assign(n,i),n.dataset.id=e}),t.eachCell(n=>$e.assign(n,i)))}addElement(e,t){const i=this;let r=t.firstElementChild;for(i._elements[e]=t,i._elementsArray.push(t),i._regions.push(e),$e.assign(t,{index:i.index}),i._cells[e]=[];r;)i._cells[e].push(r),i._allCells.push(r),$e.set(r,{column:r.dataset.column,columnId:r.dataset.columnId,rowElement:r.parentNode,row:i}),r=r.nextElementSibling;t.dataset.index=i.index,t.ariaRowIndex=i.grid.hideHeaders?i.index+1:i.index+2}getElement(e){return this._elements[e]}getRectangle(e){return $.from(this.getElement(e))}eachElement(e){this._elementsArray.forEach(e)}eachCell(e){this._allCells.forEach(e)}get elements(){return this._elements}get element(){const e=Object.keys(this._elements)[0];return this._elements[e]}get cells(){return this._allCells}getCells(e){return this._cells[e]}getCell(e){return this._allCells.find(t=>{const i=$e.get(t);return i.columnId==e||i.column==e})}removeElements(e=!1){const t=this;t.rowManager.trigger("removeRow",{row:t}),e||t.eachElement(i=>i.remove()),t._elements={},t._cells={},t._elementsArray.length=t._regions.length=t._allCells.length=t.lastHeight=t.height=0,t.lastTop=-1}get height(){return this._height}set height(e){this._height=e}get offsetHeight(){return this.height+this.grid._rowBorderHeight}updateElementsHeight(e){const t=this;e||t.rowManager.storeKnownHeight(t.id,t.height),t.lastHeight!==t.height&&(this.eachElement(i=>i.style.height=`${t.offsetHeight}px`),t.lastHeight=t.height)}addCls(e){this.updateCls(this.cls.add(e))}removeCls(e){this.updateCls(this.cls.remove(e))}toggleCls(e,t){this.updateCls(this.cls[t?"add":"remove"](e))}assignCls(e){this.updateCls(this.cls.assign(e))}changeCls(e){return e!=null&&e.isDomClassList?e:new Q(e)}updateCls(e){this.eachElement(t=>S.syncClassList(t,e))}setAttribute(e,t){this.eachElement(i=>i.setAttribute(e,t))}removeAttribute(e){this.eachElement(t=>t.removeAttribute(e))}get isFirst(){return this.dataIndex===0}get top(){return this._top}get bottom(){return this._top+this._height+this.grid._rowBorderHeight}setTop(e,t){this._top!==e&&(this._top=e,this.translateElements(t))}setBottom(e,t){this.setTop(e-this.offsetHeight,t)}translate(e,t=!1){return this.setTop(e,t),e+this.offsetHeight}translateElements(e){const t=this,{top:i,_elementsArray:r}=t;if(t.lastTop!==i){for(let n=0,{length:s}=r;n<s;n++)r[n].style.transform=`translate(0,${i}px)`;!e&&t.rowManager.trigger("translateRow",{row:t}),t.lastTop=i}}positionElements(e){const t=this,{top:i,_elementsArray:r}=t;if(t.lastTop!==i){for(let n=0,{length:s}=r;n<s;n++)r[n].style.top=`${i}px`;!e&&t.rowManager.trigger("translateRow",{row:t}),t.lastTop=i}}offset(e){let t=this._top+e;return t<0&&(e-=t,t=0),this.setTop(t),e}render(e,t,i=!0,r=!1,n=!1){var s,a,o,l;const d=this,{cellContext:u,cls:h,elements:f,cells:g,grid:m,rowManager:p,height:v,_id:y}=d,C=$e.get(d._elementsArray[0]),D=p._rowHeight,{store:w}=m,{isTree:E}=w;let R=0,x;if(!t&&t!==!1&&(t=m.store.getById(C.id),e=m.store.indexOf(t)),!t)return;const k=(s=t)===null||s===void 0?void 0:s.cls,I=k?k.isDomClassList?k:new Q(k):null;h.assign({"b-grid-row-updating":i&&m.transitionDuration&&!n,"b-selected":m.isSelected((a=t)===null||a===void 0?void 0:a.id),"b-readonly":t.readOnly,"b-linked":t.isLinked,"b-original":t.hasLinks}),d.lastRecordCls&&h.remove(d.lastRecordCls),I?(h.add(I),d.lastRecordCls=Object.assign({},I)):d.lastRecordCls=null,p.trigger("beforeRenderRow",{row:d,record:t,recordIndex:e,oldId:y}),m.beforeRenderRow({row:d,record:t,recordIndex:e,oldId:y}),d.updateCls(h),i&&m.transitionDuration&&!n&&m.setTimeout(()=>{d.isDestroyed||(h.remove("b-grid-row-updating"),d.updateCls(h))},m.transitionDuration),d.id=t.id,d.dataIndex=e;const A=!m.fixedRowHeight&&m.getRowHeight(t)||D;let L=d.maxRequestedHeight=null;if(E)for(const Y in f){const J=f[Y];if(J.id=`${m.id}-${Y}-${d.id}`,S.setAttributes(J,{"aria-level":t.childLevel+1,"aria-setsize":t.parent.children.length,"aria-posinset":t.parentIndex+1}),t.isExpanded(w)){var O,_;S.setAttributes(J,{"aria-expanded":!0,"aria-owns":(O=t.children)!==null&&O!==void 0&&O.length?(_=t.children)===null||_===void 0?void 0:_.map(X=>`${m.id}-${Y}-${X.id}`).join(" "):null})}else t.isLeaf?J.removeAttribute("aria-expanded"):J.setAttribute("aria-expanded",!1),J.removeAttribute("aria-owns")}for(u._record=t,u._id=t.id,u._rowIndex=e,R=0;R<g.length;R++)u._columnId=g[R].dataset.columnId,u._column=m.columns.getById(u._columnId),u._columnIndex=R,u._cell=g[R],u.height=A,u.maxRequestedHeight=L,u.updatingSingleRow=i,x=d.renderCell(u),p.fixedRowHeight||x.height!=null&&(L=Math.max(L,x.height),x.transient||(d.maxRequestedHeight=L));const V=(o=L)!==null&&o!==void 0?o:A;d.height=(l=m.processRowHeight(t,V))!==null&&l!==void 0?l:V,d.updateElementsHeight(n),i&&!n&&(v!==d.height&&p.translateFromRow(d,r),p.trigger("updateRow",{row:d,record:t,recordIndex:e,oldId:y}),p.trigger("renderDone")),m.afterRenderRow({row:d,record:t,recordIndex:e,oldId:y,oldHeight:v,isExport:n}),p.trigger("renderRow",{row:d,record:t,recordIndex:e,oldId:y,isExport:n}),v&&d.height!==v&&p.trigger("rowRowHeight",{row:d,record:t,height:d.height,oldHeight:v}),d.forceInnerHTML=!1}renderCell(e){var t,i;e.isLocation||(e=new ne(e));let{cell:r,record:n}=e;const s=this,{grid:a,column:o,height:l,maxRequestedHeight:d,updatingSingleRow:u=!0,isMeasuring:h=!1}=e,f=(t=a.features)===null||t===void 0?void 0:t.cellEdit,g=$e.get(r),m=g.rowElement,p=$e.get(m);if(!n&&(n=e.record=a.store.getById(p.id),!n))return;let v=o.getRawValue(n);const y=n.fieldMap[o.field],C={configuredHeight:l,height:null,maxRequestedHeight:d},D=o.getCellClass(e),w={cellElement:r,dataField:y,rowElement:m,value:v,record:n,column:o,size:C,grid:a,row:g.row,updatingSingleRow:u,isMeasuring:h},E=o.renderer||o.defaultRenderer;a.beforeRenderCell(w),w.cellElement!==r&&(r=w.cellElement),S.syncClassList(r,D);let R=!0;E?(v=E.call(o,w),v===void 0&&o.alwaysClearCell===!1&&(R=!1)):y&&(v=y.print(v));const x=(i=a.hasFrameworkRenderer)===null||i===void 0?void 0:i.call(a,{cellContent:v,column:o});x&&n.isSpecialRow&&(v="");const k=x&&!o.data.tree&&!n.isSpecialRow;if(R&&!k){var I;let L=r;f!=null&&(I=f.editorContext)!==null&&I!==void 0&&I.equals(e)&&!f.editor.isFinishing&&(L=s.moveContentFromCell(r,f.editor.element));const O=v!=null&&typeof v=="object",_=typeof v=="string",V=O||v==null?"":String(v);if(s.forceInnerHTML&&(L.innerHTML="",delete L._content,r.lastDomConfig=null),!O&&o.htmlEncode&&!o.disableHtmlEncode?r._hasHtml?(L.innerText=V,r._hasHtml=!1):S.setInnerText(L,V):o.autoSyncHtml&&(!_||S.getChildElementCount(L))?_?S.sync(V,L.firstElementChild):O&&Z.sync({domConfig:v,targetElement:L}):O?Z.sync({targetElement:L,domConfig:{onlyChildren:!0,children:W.asArray(v)}}):L._content!==V&&(L.innerHTML=L._content=V),L!==r){const{firstChild:Y}=r;for(const J of L.childNodes)r.insertBefore(J,Y)}}if(!n.isSpecialRow){var A;(A=a.processCellContent)===null||A===void 0||A.call(a,{cellElementData:g,rendererData:w,rendererHtml:w.rendererHtml||v})}return o.autoHeight&&C.height==null&&(r.classList.add("b-measuring-auto-height"),C.height=Math.max(r.offsetHeight,a.rowHeight),r.classList.remove("b-measuring-auto-height")),h||s.rowManager.trigger("renderCell",w),C}moveContentFromCell(e,t){vl.setStart(e,0),vl.setEndBefore(t);const i=document.createElement("div");return i.appendChild(vl.extractContents()),i}}M(is,"$name","Row");is.initClass();is._$name="Row";class qr extends he(Ie(Kt(P))){static get defaultConfig(){return{translateURLsToAbsolute:!0,keepPathName:!0,filterStyles:e=>e}}pageTpl(e){const{title:t,header:i,footer:r,styles:n,htmlClasses:s,bodyStyle:a,bodyClasses:o=[],paperHeight:l,paperWidth:d,html:u}=e;return o.push(`b-${this.constructor.type}`),S.scrollBarWidth?o.push("b-visible-scrollbar"):o.push("b-overlay-scrollbar"),K.isChrome?o.push("b-chrome"):K.isSafari?o.push("b-safari"):K.isFirefox&&o.push("b-firefox"),bt.tpl`
            <!DOCTYPE html>
            <html class="${s}" style="width: ${d}in; height: ${l}in;">
                <head>
                    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
                    <title>${t}</title>
                    ${n.join("")}
                </head>
                <body class="b-export ${o.join(" ")}" style="width: ${d}in; height: ${l}in; ${a}">
                    <div class="b-export-content">
                        ${i&&`<div class="b-export-header" style="width: 100%">${i}</div>`}
                        <div class="b-export-body"><div class="b-export-viewport">${u}</div></div>
                        ${r&&`<div class="b-export-footer" style="width: 100%">${r}</div>`}
                    </div>
                </body>
            </html>`}get stylesheets(){const e=this;if(e._stylesheets)return e._stylesheets;const t=e.translateURLsToAbsolute,i=globalThis.origin,r=Array.from(document.querySelectorAll('link[rel="stylesheet"], style')),n=[];return r.forEach(s=>{if(s=s.cloneNode(!0),t&&s.href){let o;t===!0?o=s.href:this.keepPathName?o=s.href.replace(i,t):o=new URL(s.getAttribute("href"),t),s.setAttribute("href",o)}let a=s.outerHTML;if(t&&/style/i.test(s.tagName)){const o=e.getStyleTagURLConverter(t);a=a.replace(/url\(['"]?(.+?)['"]?\)/g,o)}n.push(a)}),n.push(`<style>
                body, html {
                    overflow: auto;
                }
                body {
                    position: relative;
                    margin: 0;
                }
            </style>`),e._stylesheets=e.filterStyles(n)}set stylesheets(e){this._stylesheets=e&&this.filterStyles(e)}getStyleTagURLConverter(e){return function(t,i){let r;try{let n;/^#/.test(i)?r=t:(e===!0?n=globalThis.location.href:this.keepPathName?n=globalThis.location.href.replace(globalThis.location.origin,e):n=e,r=`url('${new URL(i,n).href}')`)}catch{r=t}return r}.bind(this)}saveState({client:e}){this.state=e.state}async restoreState({client:e}){const t=[],i=new Set;i.add(e.scrollable.ion({scroll(){t.push(e.scrollable.await("scrollEnd"))}})),e.eachSubGrid(({header:r,scrollable:n})=>{i.add(n.ion({scroll(){t.push(n.await("scrollEnd"))}})),i.add(r.scrollable.ion({scroll(){t.push(r.scrollable.await("scrollEnd"))}}))}),e.state=this.state,await Promise.all(t),i.forEach(r=>r())}beforeExport(){this.element=document.createElement("div")}cloneElement(e,t=this.element,i=!0){i&&(t.innerHTML=""),t.appendChild(e.cloneNode(!0)),S.removeEachSelector(t,".b-grid-row,.b-grid-merged-cells-container");const r=t.querySelector(".b-gridbase > .b-mask");r&&r.remove()}createPlaceholder(e,t=!0,i={}){return t&&(e.innerHTML=""),S.createElement(Object.assign({parent:e,id:Or.generateId("export")},i))}prepareElement({client:e}){const{tbar:t,bbar:i}=e;t&&this.element.querySelector(`#${t.id}`).remove(),i&&this.element.querySelector(`#${i.id}`).remove()}measureElement(e=""){e instanceof HTMLElement&&(e=e.outerHTML);const t=S.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:`<div style="height: 1px"></div>${e}<div style="height: 1px"></div>`}),i=t.offsetHeight-2;return t.remove(),i}prepareHTML(e){e instanceof HTMLElement&&(e=e.outerHTML);const t=S.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:e}),i=t.querySelectorAll("img");for(let n=0,s=i.length;n<s;n++)i[n].setAttribute("src",i[n].src);const r=t.innerHTML;return t.remove(),r}getVirtualScrollerHeight(e){let t=0;return e.eachSubGrid(i=>{i.overflowingHorizontally&&(t=S.scrollBarWidth)}),t===0?t:t+1}inchToPx(e){return e*96}getScaleValue(e,t){return Math.floor(e*1e4/t)/1e4}getVisibleRowsCount(e){const t=e.rowManager,i=t.rows.indexOf(t.firstVisibleRow),r=t.rows.indexOf(t.lastVisibleRow);let n;return i!==-1?r===-1?n=e.store.count-i:n=r-i+1:n=e.store.count,n}async export(e){const t=this;let i;t.beforeExport(),t.saveState(e),await t.prepareComponent(e);try{i=await t.getPages(e)}finally{await t.restoreComponent(e),t.stylesheets=null,await new Promise(r=>t.requestAnimationFrame(r)),await t.restoreState(e)}return i}async getPages(e){const t=this.pagesExtractor(e),i=[];let r;for(;(r=await t.next())&&!r.done;)i.push(r.value);return i}adjustRowBuffer(e){const{contentHeight:t}=this.exportMeta,{rowManager:i}=e;this.oldRowManagerConfig={prependRowBuffer:i.prependRowBuffer,appendRowBuffer:i.appendRowBuffer};const r=Math.ceil(t/i.rowOffsetHeight);i.prependRowBuffer=r,i.appendRowBuffer=r,e.renderRows(),e.rowManager.jumpToPosition(e.scrollable.y)}restoreRowBuffer(e){e.rowManager.prependRowBuffer=this.oldRowManagerConfig.prependRowBuffer,e.rowManager.appendRowBuffer=this.oldRowManagerConfig.appendRowBuffer}async prepareComponent(e){const t=this,{client:i,columns:r,rowsRange:n,keepRegionSizes:s,enableDirectRendering:a}=e,{rowManager:o}=i,l=t.exportMeta={enableDirectRendering:a,totalWidth:0,totalHeight:0-(a?0:t.getVirtualScrollerHeight(i)),subGrids:{}};i.columns.forEach(h=>{r.includes(h.id)?h.show():h.hide()}),await new Promise(h=>i.requestAnimationFrame(h)),i.rowManager.rowCount>0&&(n===tt.all?l.firstVisibleDataIndex=o.rows[0].dataIndex:(l.firstVisibleDataIndex=o.firstVisibleRow.dataIndex,e.alignRows=!0),a||await i.scrollRowIntoView(i.store.getAt(l.firstVisibleDataIndex),{block:"start"}));const{element:d}=t;t.cloneElement(i.element),t.prepareElement(e);let u;a&&(l.fakeRow=u=new is({cls:i.rowCls,rowManager:i.rowManager,grid:i,index:-10,dataIndex:-10})),i.eachSubGrid(h=>{var f,g,m;u&&(h.onAddRow({rows:[u],isExport:!0}),u.element.dataset.ownerCmp=i.id);const p=t.createPlaceholder(d.querySelector(`[id="${h.id}"]`),!1);let v;s!=null&&s[h.region]?v=h.element.offsetWidth:v=h.columns.visibleColumns.reduce((C,D)=>(typeof D.width=="number"?C+=D.width:C+=(i.hideHeaders?i.rowManager.rows[0].getCell(D.id):D.element).offsetWidth,C),0),l.totalWidth+=v;const y=((f=h.splitterElement)===null||f===void 0?void 0:f.offsetWidth)||0;l.totalWidth+=y,l.subGrids[h.region]={id:h.id,headerId:((g=h.header)===null||g===void 0?void 0:g.id)||null,footerId:((m=h.footer)===null||m===void 0?void 0:m.id)||null,rows:[],splitterWidth:y,placeHolder:p,width:v}})}prepareExportElement(){const e=this,{element:t,exportMeta:i}=e;return Object.values(i.subGrids).forEach(({width:r,id:n,headerId:s,footerId:a})=>{[n,s,a].forEach(o=>{if(o){const l=t.querySelector(`[id="${o}"]`);l&&(l.style.width=`${r}px`,l.style.flex="")}})}),t.innerHTML}async restoreComponent(e){this.exportMeta.fakeRow&&(this.exportMeta.fakeRow.destroy(),delete this.exportMeta.fakeRow)}async scrollRowIntoView(e,t){await e.scrollRowIntoView(e.store.getAt(t),{block:"start"}),await new Promise(i=>this.requestAnimationFrame(i))}collectRow(e){const t=this.exportMeta.subGrids,i=/data-owner-cmp=".+?"/;Object.entries(e.elements).forEach(([r,n])=>{t[r].rows.push([n.outerHTML.replace(i,""),e.top,e.offsetHeight,new Map])})}renderMergedCells(e,t,i,r){const n=this,{client:s}=e,{subGrids:a}=n.exportMeta,o=s.features.mergeCells.buildMergedCellsConfig(t,i,r);for(const l in a){const d=a[l],u=document.createElement("div");Z.sync({targetElement:u,domConfig:{children:o[l].children}}),u.childNodes.length&&(u.childNodes.forEach(h=>{const{syncId:f}=h.dataset,g=s.features.mergeCells.mergedRanges.find(m=>{var p;return((p=m.cellElement)===null||p===void 0?void 0:p.parentNode.dataset.syncId)===f});g&&(h.innerHTML=g.cellElement.outerHTML)}),d.mergedCellsHtml=[u.innerHTML])}}}qr.prototype.pagesExtractor=async function*(){throw new Error("Implement this method in a subclass")};qr._$name="Exporter";class $n extends qr{static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}static get title(){return this.L("L{multipage}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:e,rowsRange:t,enableDirectRendering:i}){const{exportMeta:r}=this;++r.currentPage,++r.verticalPosition,delete r.lastExportedRowBottom,r.verticalPosition>=r.verticalPages&&(Object.assign(r,{verticalPosition:0,horizontalPosition:r.horizontalPosition+1,currentPageTopMargin:0,lastTop:0,lastRowIndex:t===tt.visible?e.rowManager.firstVisibleRow.dataIndex:0}),delete r.lastRowDataIndex,i||await this.scrollRowIntoView(e,r.firstVisibleDataIndex,{block:"start"}))}async prepareComponent(e){await super.prepareComponent(e);const t=this,{exportMeta:i}=t,{client:r,headerTpl:n,footerTpl:s,alignRows:a,rowsRange:o,enableDirectRendering:l}=e,d=Hi[e.paperFormat],u=e.orientation===Pn.portrait,h=u?d.width:d.height,f=u?d.height:d.width,g=t.inchToPx(h),m=t.inchToPx(f),p=o===tt.visible,v=Math.ceil(i.totalWidth/g);let y=m;n&&(y-=t.measureElement(n({totalWidth:i.totalWidth,totalPages:-1,currentPage:-1}))),s&&(y-=t.measureElement(s({totalWidth:i.totalWidth,totalPages:-1,currentPage:-1})));let C,D,w=r.store.count;if(p?(w=t.getVisibleRowsCount(r),C=i.totalHeight+r.headerHeight+r.footerHeight+r.bodyHeight):C=i.totalHeight+r.headerHeight+r.footerHeight+r.scrollable.scrollHeight,a&&!p){const E=r.rowManager.rowOffsetHeight,R=Math.floor((y-r.headerHeight)/E),x=Math.floor(y/E),k=w-R;D=1+Math.ceil(k/x)}else D=Math.ceil(C/y);Object.assign(i,{paperWidth:h,paperHeight:f,pageWidth:g,pageHeight:m,horizontalPages:v,verticalPages:D,totalHeight:C,contentHeight:y,totalRows:w,totalPages:v*D,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0,lastTop:0,lastRowIndex:p?r.rowManager.firstVisibleRow.dataIndex:0}),l||this.adjustRowBuffer(r)}async restoreComponent(e){await super.restoreComponent(e),e.enableDirectRendering||this.restoreRowBuffer(e.client)}async collectRows(e){const t=this,{exportMeta:i}=t,{client:r,alignRows:n,rowsRange:s}=e,{subGrids:a,currentPageTopMargin:o,verticalPosition:l,contentHeight:d,totalRows:u,lastRowDataIndex:h}=i,{rowManager:f}=r,{rows:g}=f,m=s===tt.visible,p=r.hasActiveFeature("mergeCells");let v,y;m&&h!=null?h===g[g.length-1].dataIndex?y=g.length-1:y=g.findIndex(x=>x.dataIndex===h):y=m?g.findIndex(x=>x.bottom>Math.ceil(r.scrollable.y)):g.findIndex(x=>x.bottom+o+r.headerHeight>0);const C=y,D=m||l===0?0:g[y].top+o+r.headerHeight;v=d-D,l===0&&(v-=r.headerHeight);let w,E=0;for(;v>0;){const x=g[y];n&&v<x.offsetHeight?(E=-v,v=0,t.exportMeta.lastExportedRowBottom=g[y-1].bottom):(t.collectRow(x),v-=x.offsetHeight,w=x.dataIndex,(++y===g.length&&v>0||m&&y-C===u)&&(v=0))}if(p)for(const x in a){const k=a[x],I=r.subGrids[x].element.querySelectorAll(".b-grid-merged-cells");k.mergedCellsHtml=[];for(const A of I)k.mergedCellsHtml.push(A.outerHTML)}const R=g[y-1];if(R&&(i.exactGridHeight=R.bottom+r.footerContainer.offsetHeight+r.headerContainer.offsetHeight,i.lastRowDataIndex=R.dataIndex+1),await t.onRowsCollected(g.slice(C,y),e),m)i.exactGridHeight-=i.scrollableTopMargin=r.scrollable.y;else{const x=f.ion({offsetRows:({offset:k})=>E+=k});await t.scrollRowIntoView(r,w+1),x()}return E}async renderRows(e){const t=this,{exportMeta:i}=t,{client:r,alignRows:n,rowsRange:s}=e,{currentPageTopMargin:a,verticalPosition:o,contentHeight:l,totalRows:d,lastRowIndex:u,fakeRow:h}=i,{store:f}=r,g=r.hasActiveFeature("mergeCells"),m=s===tt.visible;let p=u,{lastTop:v}=i,y;const C=p,D=m||o===0?0:v+a+r.headerHeight,w=[];y=l-D,o===0&&(y-=r.headerHeight);let E,R,x=0;for(;y>0;)h.render(p,f.getAt(p),!0,!1,!0),n&&y<h.offsetHeight?(x=-y,y=0,t.exportMeta.lastExportedRowBottom=v):(R=v,E=p,v=h.translate(v),y-=h.offsetHeight,t.collectRow(h),w.push({top:h.top,bottom:h.bottom,offsetHeight:h.offsetHeight,dataIndex:h.dataIndex}),(++p===f.count&&y>0||m&&p-C===d)&&(y=0));return g&&t.renderMergedCells(e,C,p,w),i.lastRowIndex=n?p:E,i.lastTop=n?v:R,h&&(i.exactGridHeight=h.bottom+r.footerContainer.offsetHeight+r.headerContainer.offsetHeight),await t.onRowsCollected(w,e),x}async buildPage(e){const t=this,{exportMeta:i}=t,{client:r,headerTpl:n,footerTpl:s,enableDirectRendering:a}=e,{totalWidth:o,totalPages:l,currentPage:d,subGrids:u}=i;Object.values(u).forEach(p=>p.rows=[]),e.rowsRange===tt.all&&(i.totalHeight=r.height-r.bodyHeight+r.scrollable.scrollHeight-t.getVirtualScrollerHeight(r));let h,f;n&&(h=t.prepareHTML(n({totalWidth:o,totalPages:l,currentPage:d}))),s&&(f=t.prepareHTML(s({totalWidth:o,totalPages:l,currentPage:d})));let g;return a?g=await t.renderRows(e):g=await t.collectRows(e),{html:t.buildPageHtml(e),header:h,footer:f,offset:g}}async onRowsCollected(){}buildPageHtml(){const e=this,{subGrids:t}=e.exportMeta;let i=e.prepareExportElement();return Object.values(t).forEach(({placeHolder:r,rows:n,mergedCellsHtml:s})=>{const a=r.outerHTML;let o=n.reduce((l,d)=>(l+=d[0],l),"");s!=null&&s.length&&(o+=`<div class="b-grid-merged-cells-container">${s.join("")}</div>`),i=i.replace(a,o)}),i}prepareExportElement(){const e=this,{element:t,exportMeta:i}=e;return i.scrollableTopMargin&&(t.querySelector(".b-grid-vertical-scroller").style.marginTop=`-${i.scrollableTopMargin}px`),super.prepareExportElement()}}$n.prototype.pagesExtractor=async function*(e){const t=this,{exportMeta:i,stylesheets:r}=t,{totalWidth:n,totalPages:s,paperWidth:a,paperHeight:o,contentHeight:l}=i;let d;for(;(d=i.currentPage)<s;){t.trigger("exportStep",{text:t.L($n.exportingPageText,{currentPage:d,totalPages:s}),progress:Math.round((d+1)/s*90)});const{html:u,header:h,footer:f,offset:g}=await t.buildPage(e),m=[...r,`
                <style>
                    #${e.client.id} {
                        height: ${i.exactGridHeight}px !important;
                        width: ${n}px !important;
                    }
                    .b-export-body .b-export-viewport {
                        margin-inline-start : ${-a*i.horizontalPosition}in;
                        margin-top  : ${i.currentPageTopMargin}px;
                    }
                </style>
            `];i.currentPageTopMargin-=l+g,await t.stateNextPage(e),yield{html:t.pageTpl({html:u,header:h,footer:f,styles:m,paperWidth:a,paperHeight:o})}}};$n._$name="MultiPageExporter";class _n extends qr{static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}static get title(){return this.L("L{multipagevertical}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:e}){const{exportMeta:t}=this,{totalRows:i,processedRows:r,totalPages:n}=t;++t.currentPage,++t.verticalPosition,t.currentPage===n&&r.size!==i&&(++t.totalPages,++t.verticalPages)}estimateTotalPages(e){const t=this,{exportMeta:i}=t,{client:r,headerTpl:n,footerTpl:s,alignRows:a,rowsRange:o,repeatHeader:l,enableDirectRendering:d}=e,{pageWidth:u,pageHeight:h,totalWidth:f}=i,g=t.getScaleValue(u,f);let m=0-t.getVirtualScrollerHeight(r)+r.height-r.bodyElement.offsetHeight+r.scrollable.scrollHeight,p=h/g,v=r.store.count,y=0,C=m,D;if(n&&(p-=t.measureElement(n({totalWidth:f,totalPages:-1,currentPage:-1}))),s&&(p-=t.measureElement(s({totalWidth:f,totalPages:-1,currentPage:-1}))),l&&(p-=r.headerHeight+r.footerHeight,m-=r.headerHeight+r.footerHeight),o===tt.visible){const w=r.rowManager,E=w.firstVisibleRow,R=w.lastVisibleRow;d||(y=E.top),v=t.getVisibleRowsCount(r),d?(m=r.headerHeight+r.footerHeight+R.bottom-E.top,C=R.bottom-E.top):C=m=m-r.scrollable.scrollHeight+R.bottom-E.top,i.lastRowIndex=E.dataIndex,i.finishRowIndex=R.dataIndex}else i.finishRowIndex=r.store.count-1;if(a&&!l&&o!==tt.visible){const w=r.rowManager.rowOffsetHeight,E=Math.floor((p-r.headerHeight)/w),R=Math.floor(p/w),x=v-E;D=1+Math.ceil(x/R)}else D=Math.ceil(C/p);Object.assign(i,{scale:g,contentHeight:p,totalRows:v,totalHeight:m,verticalPages:D,initialScroll:y,horizontalPages:1,totalPages:D})}async prepareComponent(e){await super.prepareComponent(e);const t=this,{exportMeta:i}=t,{client:r}=e,n=Hi[e.paperFormat],s=e.orientation===Pn.portrait,a=s?n.width:n.height,o=s?n.height:n.width,l=t.inchToPx(a),d=t.inchToPx(o);Object.assign(i,{paperWidth:a,paperHeight:o,pageWidth:l,pageHeight:d,horizontalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0,lastTop:0,lastRowIndex:0,processedRows:new Set}),t.estimateTotalPages(e),e.enableDirectRendering||t.adjustRowBuffer(r)}async restoreComponent(e){await super.restoreComponent(e),e.enableDirectRendering||this.restoreRowBuffer(e.client)}async collectRows(e){const t=this,{exportMeta:i}=t,{client:r,alignRows:n,repeatHeader:s}=e,{subGrids:a,currentPageTopMargin:o,verticalPosition:l,totalRows:d,contentHeight:u}=i,h=s?0:r.headerHeight,{rowManager:f}=r,{rows:g}=f,m=e.rowsRange===tt.visible,p=r.hasActiveFeature("mergeCells");let v=m?g.findIndex(x=>x.bottom>r.scrollable.y):g.findIndex(x=>x.bottom+o+h>0),y;const C=v,D=l===0?0:g[v].top+o+h;y=u-D,l===0&&(y-=h);let w,E=0;for(;y>0;){const x=g[v];n&&y<x.offsetHeight?(E=-y,y=0):(t.collectRow(x),y-=x.offsetHeight,y>0&&i.processedRows.add(x.dataIndex),w=x.dataIndex,(++v===g.length&&y>0||m&&v-C===d)&&(y=0))}if(p)for(const x in a){const k=a[x],I=r.subGrids[x].element.querySelectorAll(".b-grid-merged-cells");k.mergedCellsHtml=[];for(const A of I)k.mergedCellsHtml.push(A.outerHTML)}const R=g[v-1];if(R&&(i.exactGridHeight=R.bottom+r.footerContainer.offsetHeight+r.headerContainer.offsetHeight),await t.onRowsCollected(g.slice(C,v),e),m)i.scrollableTopMargin=r.scrollable.y;else{const x=f.ion({offsetRows:({offset:k})=>E+=k});await t.scrollRowIntoView(r,w+1),x()}return E}async renderRows(e){const t=this,{exportMeta:i}=t,{client:r,alignRows:n,repeatHeader:s}=e,{currentPageTopMargin:a,verticalPosition:o,totalRows:l,contentHeight:d,lastRowIndex:u,finishRowIndex:h,fakeRow:f}=i,g=s?0:r.headerHeight,{store:m}=r,p=r.hasActiveFeature("mergeCells"),v=e.rowsRange===tt.visible;let y=u,{lastTop:C}=i,D;const w=y,E=o===0?0:C+a+g,R=[];D=d-E,o===0&&(D-=g);let x,k,I=0;for(;D>0;)f.render(y,m.getAt(y),!0,!1,!0),n&&D<f.offsetHeight?(I=-D,D=0):(k=C,x=y,C=f.translate(C),D-=f.offsetHeight,t.collectRow(f),R.push({top:f.top,bottom:f.bottom,offsetHeight:f.offsetHeight,dataIndex:f.dataIndex}),D>0&&i.processedRows.add(y),(y===h||++y-w===l&&v)&&(D=0));return p&&t.renderMergedCells(e,w,y,R),i.lastRowIndex=x,i.lastTop=k,f&&(i.exactGridHeight=f.bottom+r.footerContainer.offsetHeight+r.headerContainer.offsetHeight),await t.onRowsCollected(R,e),I}async buildPage(e){const t=this,{exportMeta:i}=t,{client:r,headerTpl:n,footerTpl:s,enableDirectRendering:a}=e,{totalWidth:o,totalPages:l,currentPage:d,subGrids:u}=i;Object.values(u).forEach(p=>p.rows=[]),e.rowsRange===tt.all&&(i.totalHeight=r.headerHeight+r.footerHeight+r.scrollable.scrollHeight,a||(i.totalHeight-=t.getVirtualScrollerHeight(r)));let h,f,g;return n&&(h=t.prepareHTML(n({totalWidth:o,totalPages:l,currentPage:d}))),s&&(f=t.prepareHTML(s({totalWidth:o,totalPages:l,currentPage:d}))),a?g=await t.renderRows(e):g=await t.collectRows(e),{html:t.buildPageHtml(e),header:h,footer:f,offset:g}}async onRowsCollected(){}buildPageHtml(){const e=this,{subGrids:t}=e.exportMeta;let i=e.prepareExportElement();return Object.values(t).forEach(({placeHolder:r,rows:n,mergedCellsHtml:s})=>{const a=r.outerHTML;let o=n.reduce((l,d)=>(l+=d[0],l),"");s!=null&&s.length&&(o+=`<div class="b-grid-merged-cells-container">${s.join("")}</div>`),i=i.replace(a,o)}),i}}_n.prototype.pagesExtractor=async function*(e){const t=this,{exportMeta:i,stylesheets:r}=t,{totalWidth:n,paperWidth:s,paperHeight:a,contentHeight:o,scale:l,initialScroll:d}=i;let{totalPages:u}=i,h;for(;(h=i.currentPage)<u;){t.trigger("exportStep",{text:t.L(_n.exportingPageText,{currentPage:h,totalPages:u}),progress:Math.round((h+1)/u*90)});const{html:f,header:g,footer:m,offset:p}=await t.buildPage(e),v=[...r,`
                <style>
                    #${e.client.id} {
                        width: ${n}px !important;
                    }
                    .b-export .b-export-content {
                        transform: scale(${l});
                        transform-origin: top left;
                        height: auto;
                    }
                </style>
            `];if(e.repeatHeader){const y=i.exactGridHeight?`${i.exactGridHeight+i.currentPageTopMargin}px`:"100%";v.push(`
                <style>
                    #${e.client.id} {
                        height: ${y} !important;
                    }
                    .b-export .b-export-content {
                        height: ${100/l}%;
                    }
                    .b-export-body {
                        height: 100%;
                        display: flex;
                    }
                    .b-export-viewport {
                        height: 100%;
                    }
                    .b-grid-vertical-scroller {
                        margin-top: ${i.currentPageTopMargin-d}px;
                    }
                </style>
                `)}else{const y=i.exactGridHeight||o-i.currentPageTopMargin;v.push(`
                <style>
                    #${e.client.id} {
                        height: ${y}px !important;
                    }
                    .b-export-body {
                        overflow: hidden;
                    }
                    .b-export .b-export-content {
                        height: ${100/l}%;
                    }
                    .b-export-body .b-export-viewport {
                        margin-top: ${i.currentPageTopMargin}px;
                    }
                    .b-grid-vertical-scroller {
                        margin-top: -${d}px;
                    }
                </style>
                `)}i.currentPageTopMargin-=o+p,await t.stateNextPage(e),{totalPages:u}=i,yield{html:t.pageTpl({html:f,header:g,footer:m,styles:v,paperWidth:s,paperHeight:a})}}};_n._$name="MultiPageVerticalExporter";class to extends qr{static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}static get title(){return this.localize("L{singlepage}")}static get defaultConfig(){return{centerContentHorizontally:!1}}async prepareComponent(e){await super.prepareComponent(e),Object.assign(this.exportMeta,{verticalPages:1,horizontalPages:1,totalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0})}async onRowsCollected(){}positionRows(e,t){if(t.enableDirectRendering)return e.map(i=>i[0]);{let i=0;return e.map(([r,,n])=>{const s=r.replace(/translate\(\d+px, \d+px\)/,`translate(0px, ${i}px)`);return i+=n,s})}}async collectRows(e){const t=this,{client:i}=e,{rowManager:r,store:n}=i,s=i.hasActiveFeature("mergeCells"),{subGrids:a}=t.exportMeta,o=e.rowsRange===tt.visible&&n.count?t.getVisibleRowsCount(i):n.count;let{totalHeight:l}=t.exportMeta,d=0,u=-1;if(r.rows.length>0){if(e.rowsRange===tt.visible&&(u=r.firstVisibleRow.dataIndex-1),s)for(const h of Object.values(a))h.mergedCellsHtml=[];for(;d<o;){const h=r.rows,f=h[h.length-1],g=d;if(h.forEach(v=>{v.dataIndex>u&&d<o&&(++d,l+=v.offsetHeight,t.collectRow(v))}),s)for(const v in a){const y=a[v],C=i.subGrids[v].element.querySelectorAll(".b-grid-merged-cells");for(const D of C)y.mergedCellsHtml.push(D.outerHTML)}const m=h.findIndex(v=>v.dataIndex===u+1),p=m+(d-g);await t.onRowsCollected(h.slice(m,p),e),d<o&&(u=f.dataIndex,await t.scrollRowIntoView(i,u+1))}}return l}async renderRows(e){const t=this,{client:i,rowsRange:r}=e,{rowManager:n,store:s}=i,a=i.hasActiveFeature("mergeCells"),o=r===tt.visible;let{totalHeight:l}=t.exportMeta;if(s.count){const{fakeRow:d}=t.exportMeta,{firstVisibleRow:u}=n,h=o?u.dataIndex:0,f=o?n.lastVisibleRow.dataIndex:s.count-1,g=[];let m=0;if(d.cells.length){for(let p=h;p<=f;p++)d.render(p,s.getAt(p),!0,!1,!0),m=d.translate(m),t.collectRow(d),g.push({top:d.top,bottom:d.bottom,offsetHeight:d.offsetHeight,dataIndex:d.dataIndex});await t.onRowsCollected(g,e)}l+=m,a&&t.renderMergedCells(e,h,f,g)}return l}buildPageHtml(e){const t=this,{subGrids:i}=t.exportMeta;let r=t.prepareExportElement();return Object.values(i).forEach(({placeHolder:n,rows:s,mergedCellsHtml:a})=>{const o=n.outerHTML;let l=t.positionRows(s,e).join("");a!=null&&a.length&&(l+=`<div class="b-grid-merged-cells-container">${a.join("")}</div>`),r=r.replace(o,l)}),r}}to.prototype.pagesExtractor=async function*(e){const t=this,{client:i}=e,{totalWidth:r}=t.exportMeta,n=t.stylesheets,s=e.orientation===Pn.portrait,a=Hi[e.paperFormat],o=s?a.width:a.height,l=s?a.height:a.width;let d,u,h;e.enableDirectRendering?(d=await t.renderRows(e),d+=i.headerHeight+i.footerHeight):(d=await t.collectRows(e),d+=i.height-i.bodyHeight);const f=t.buildPageHtml(e),g=d;e.headerTpl&&(u=t.prepareHTML(e.headerTpl({totalWidth:r})),d+=t.measureElement(u)),e.footerTpl&&(h=t.prepareHTML(e.footerTpl({totalWidth:r})),d+=t.measureElement(h));const m=Math.min(1,t.getScaleValue(t.inchToPx(o),r)),p=Math.min(1,t.getScaleValue(t.inchToPx(l),d)),v=Math.min(m,p);n.push(`<style>
                #${i.id} {
                    height: ${g}px !important;
                    width: ${r}px !important;
                }
                .b-export-content {
                    ${t.centerContentHorizontally?"left: 50%;":""}
                    transform: scale(${v}) ${t.centerContentHorizontally?"translateX(-50%)":""};
                    transform-origin: top left;
                    height: ${v===1?"inherit":"auto !important"};
                }
            </style>`),K.isIE11&&n.push(`<style>
                .b-export-body {
                   min-height: ${g}px !important;
                }
         </style>`),yield{html:t.pageTpl({html:f,header:u,footer:h,styles:n,paperWidth:o,paperHeight:l})}};to._$name="SinglePageExporter";class vd extends te{static get $name(){return"PdfExport"}static get configurable(){return{dialogClass:eo,exportServer:void 0,exportDialog:{value:!0,$config:["lazy"]},fileName:null,fileFormat:"pdf",clientURL:null,paperFormat:"A4",orientation:"portrait",rowsRange:"all",alignRows:!1,repeatHeader:!1,keepRegionSizes:null,pagesPerRequest:0,exporterConfig:null,exporterType:"singlepage",exporters:[to,$n,_n],translateURLsToAbsolute:!0,keepPathName:!0,openAfterExport:!0,sendAsBinary:!1,openInNewTab:!1,headerTpl:null,footerTpl:null,fetchOptions:null,exportMask:"L{Generating pages}",exportProgressMask:"L{Waiting for response from server}",showErrorToast:!0,localizableProperties:["exportMask","exportProgressMask"],filterStyles:e=>e,enableDirectRendering:!0}}updateEnableDirectRendering(e){e||ae.deprecate("Grid","6.0.0","Indirect rendering is deprecated")}doDestroy(){var e;(e=this.exportDialog)===null||e===void 0||e.destroy(),this.exportersMap.forEach(t=>t.destroy()),super.doDestroy()}get currentExportPromise(){return this._currentExportPromise}set currentExportPromise(e){this._currentExportPromise=e}get exportersMap(){return this._exportersMap||(this._exportersMap=new Map)}getExporter(e={}){const t=this,{exportersMap:i}=t,{type:r}=e;let n;if(i.has(r))n=i.get(r),Object.assign(n,e);else{const s=this.exporters.find(a=>a.type===r);if(!s)throw new Error(`Exporter type ${r} is not found. Make sure you've configured it`);e=T.clone(e),delete e.type,n=new s(e),n.relayAll(t),i.set(r,n)}return n}buildRequest(e,t){return{html:JSON.stringify(e),fileFormat:t.fileFormat,format:t.paperFormat,orientation:t.orientation}}buildExportConfig(e={}){const t=this,{client:i,exportServer:r,clientURL:n,fileFormat:s,fileName:a,paperFormat:o,rowsRange:l,alignRows:d,repeatHeader:u,keepRegionSizes:h,orientation:f,translateURLsToAbsolute:g,keepPathName:m,sendAsBinary:p,headerTpl:v,footerTpl:y,filterStyles:C,enableDirectRendering:D}=t;e.columns||(e.columns=i.columns.visibleColumns.filter(E=>E.exportable).map(E=>E.id));const w=T.assign({client:i,exportServer:r,clientURL:n,fileFormat:s,paperFormat:o,rowsRange:l,alignRows:d,repeatHeader:u,keepRegionSizes:h,orientation:f,translateURLsToAbsolute:g,keepPathName:m,sendAsBinary:p,headerTpl:v,footerTpl:y,enableDirectRendering:D,exporterType:t.exporterType,fileName:a||i.$$name},e);if(w.columns=e.columns.slice(),w.exporterType!=="multipagevertical"&&(w.repeatHeader=!1),!("alignRows"in e)&&e.repeatHeader&&(w.alignRows=!0),!("keepRegionSizes"in e)&&!w.keepRegionSizes){const E=[],R={};i.eachSubGrid(x=>x.collapsed&&E.push(x.region)),E.length&&(i.eachSubGrid(x=>{E.includes(x.region)||(R[x.region]=!0)}),w.keepRegionSizes=R)}return w.exporterConfig=T.assign({type:w.exporterType,translateURLsToAbsolute:w.translateURLsToAbsolute,keepPathName:w.keepPathName,filterStyles:C},w.exporterConfig||{}),delete w.exporterType,delete w.translateURLsToAbsolute,delete w.keepPathName,w}async export(e={}){const t=this,{client:i,pagesPerRequest:r}=t;e=t.buildExportConfig(e);let n;if(i.trigger("beforePdfExport",{config:e})!==!1){i.isExporting=!0,i.mask(t.exportMask);try{const o=t.getExporter(e.exporterConfig);if(r===0){var s;const l=await o.export(e);if(t.isDestroying)return;(s=t.exportDialog)===null||s===void 0||s.close(),i.unmask(),t.trigger("exportStep",{progress:90,text:t.exportProgressMask,contentGenerated:!0});const d=t.receiveExportContent(l,e);t.toast=t.showLoadingToast(d);const u=await d;n={response:u},await t.processExportContent(u,e)}}catch(o){throw o instanceof Response?n={response:o}:n={error:o},o}finally{if(t.toast&&!t.toast.isDestroying&&t.toast.hide(),!t.isDestroying){var a;(a=t.exportDialog)===null||a===void 0||a.close(),i.unmask(),t.showErrorToast&&(n.error?n.error.name!=="AbortError"&&lt.show({html:t.L("L{Export failed}"),rootElement:t.rootElement}):n.response.ok||lt.show({html:t.L("L{Server error}"),rootElement:t.rootElement})),i.trigger("pdfExport",n),i.isExporting=!1}}}return n}receiveExportContent(e,t){return et.fetch(t.exportServer,Object.assign({method:"POST",credentials:"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify({html:e,orientation:t.orientation,format:t.paperFormat,fileFormat:t.fileFormat,fileName:t.fileName,clientURL:t.clientURL,sendAsBinary:t.sendAsBinary})},this.fetchOptions))}async processExportContent(e,t){const i=this;if(e.ok&&i.openAfterExport){e=e.clone();const r=e.headers.get("content-type");if(r.match(/application\/octet-stream/)){const n=H0[t.fileFormat],s=await i.responseBlobToObjectURL(e,n);i.getDownloadLink(t.fileName,s).click()}else if(r.match(/application\/json/)){const n=await e.json();n.success?i.getDownloadLink(t.fileName,n.url).click():lt.show({html:n.msg,rootElement:this.rootElement})}}}async responseBlobToObjectURL(e,t){const i=await e.blob();return URL.createObjectURL(i.slice(0,i.size,t))}getDownloadLink(e,t){const i=document.createElement("a");return i.download=e,i.href=t,this.openInNewTab&&(i.target="_blank"),i}get defaultExportDialogConfig(){return T.copyProperties({},this,["client","exporters","exporterType","orientation","fileFormat","paperFormat","alignRows","rowsRange","repeatHeader"])}changeExportDialog(e,t){const i=this;if(t?.destroy(),e){const r=i.dialogClass.mergeConfigs({rootElement:i.rootElement,client:i.client,items:{rowsRangeField:{value:i.rowsRange},exporterTypeField:{value:i.exporterType},orientationField:{value:i.orientation},paperFormatField:{value:i.paperFormat},repeatHeaderField:{value:i.repeatHeader},fileFormatField:{value:i.fileFormat},alignRowsField:{checked:i.alignRows}}},i.defaultExportDialogConfig,e);e=i.dialogClass.new(r),e.ion({export:i.onExportButtonClick,thisObj:i})}return e}async showExportDialog(){return this.exportDialog.show()}onExportButtonClick({values:e}){const t=this,i=t.exportDialog.mask({progress:0,maxProgress:100,text:t.exportMask}),r=t.ion({exportstep({progress:n,text:s,contentGenerated:a}){a?(t.exportDialog.unmask(),r()):(i.progress=n,s!=null&&(i.text=s))}});t.currentExportPromise=t.export(e),t.currentExportPromise.catch(()=>{}).finally(()=>{var n;r(),(n=t.exportDialog)===null||n===void 0||n.unmask(),t.currentExportPromise=null})}showLoadingToast(e){const t=lt.show({timeout:0,showProgress:!1,rootElement:this.rootElement,html:`
    <span class="b-mask-icon b-icon b-icon-spinner"></span>
    <span>${this.L("L{Waiting for response from server}")}</span>
    <button class="b-button">${this.L("L{Click to abort}")}</button>`});return B.on({element:t.element,click(){var i;(i=e.abort)===null||i===void 0||i.call(e)}}),t}}vd._$name="PdfExport";G.registerFeature(vd,!1,"Grid");class yd extends P{static get defaultConfig(){return{target:null,defaultColumnWidth:100,exportDateAsInstance:!0,showGroupHeader:!0,columns:null,indent:!0,indentationSymbol:"\xA0\xA0\xA0\xA0"}}export(e={}){const t=this;return e=T.assign({},t.config,e),t.normalizeColumns(e),t.generateExportData(e)}generateExportData(e){const t=this,i=t.generateColumns(e);return{rows:t.generateRows(e),columns:i}}normalizeColumns(e){const t=e.columns||this.target.columns.visibleColumns.filter(i=>i.exportable!==!1);e.columns=t.map(i=>typeof i=="string"?this.target.columns.find(r=>r.field===i)||{field:i}:i)}generateColumns(e){return e.columns.map(t=>this.processColumn(t,e))}generateRows(e){const{columns:t,rows:i}=e;if(t.length===0||i?.length===0)return[];const r=this,{target:n}=r;return(i||n.store).map(s=>r.processRecord(s,t,e)).filter(s=>s?.length)}getColumnType(e,t=this.target.store){let i=e.exportedType||"object";if(e.exportedType===void 0&&e.field){const r=t.modelClass.getFieldDefinition(e.field);r&&r.type!=="auto"&&(i=r.type)}return i}processColumn(e,t){const i=this,{target:r}=i,{defaultColumnWidth:n}=t;let{field:s,text:a,width:o,minWidth:l}=e;if(s in r.store.modelClass.fieldMap||(s=""),!a||!o){const d=r.columns.find(u=>u.field===s);a||(a=d&&d.text||s),o==null&&(o=d&&d.width||n)}return o=Math.max(o||n,l||n),{field:s,value:a,width:o,type:i.getColumnType(e)}}processRecord(e,t,i){const{target:r}=this,{showGroupHeader:n,indent:s,indentationSymbol:a}=i;let o;return e?e.isSpecialRow?n&&e.meta.groupRowFor&&(o=t.map(l=>r.features.group.buildGroupHeader({cellElement:S.createElement(),grid:r,record:e,column:l}))):o=t.map(l=>{var d;let u=(d=l.field)!==null&&d!==void 0&&d.includes(".")?e.get(l.field):e[l.field];const h=l.renderer||l.defaultRenderer;return h&&!(u&&l.isDateColumn&&i.exportDateAsInstance)&&(u=h.call(l,{value:u,record:e,column:l,grid:r,isExport:!0})),s&&l.tree&&(u=`${a.repeat(e.childLevel)}${u}`),u}):o=t.map(()=>""),o}}yd._$name="TableExporter";class Em{constructor(e){this._value=e}get value(){return this._value}toString(){return Boolean(this.value)?"\u2713":""}}Em._$name="BooleanUnicodeSymbol";class bd extends te{static get $name(){return"ExcelExporter"}static get defaultConfig(){return{filename:null,dateFormat:"YYYY-MM-DD",exporterClass:yd,exporterConfig:null,zipcelx:null,convertEmptyValueToEmptyString:!0}}processValue(e){return e==null||Number.isNaN(e)||typeof e=="function"||typeof e=="object"&&String(e)==="[object Object]"?"":e}generateExportData(e){const t=this,{rows:i,columns:r}=t.exporter.export(e.exporterConfig);return{rows:i.map(n=>n.map((s,a)=>{var o;s instanceof Date?s=b.format(s,e.dateFormat):typeof s=="boolean"&&(s=new Em(s)),t.convertEmptyValueToEmptyString&&(s=t.processValue(s));const l=((o=r[a])===null||o===void 0?void 0:o.type)==="number"?"number":"string";return{value:s,type:l}})),columns:r.map(n=>{let{field:s,value:a,width:o,type:l}=n;return l="string",{field:s,value:a,width:o,type:l}})}}export(e={}){const t=this,i=t.zipcelx||globalThis.zipcelx;if(!i)throw new Error('ExcelExporter: "zipcelx" library is required');if(t.disabled)return;e=T.assign({},t.config,e),e.filename||(e.filename=t.client.$$name);const{filename:r}=e,{rows:n,columns:s}=t.generateExportData(e);return i({filename:r,sheet:{data:[s].concat(n),cols:s}})}construct(e,t){super.construct(e,t),this.zipcelx||typeof zipcelx<"u"&&(this.zipcelx=globalThis.zipcelx)}get exporter(){const e=this;return e._exporter||(e._exporter=e.exporterClass.new({target:e.client},e.exporterConfig))}}bd._$name="ExcelExporter";G.registerFeature(bd,!1,"Grid");class io extends N{static get $name(){return"Bar"}static get type(){return"gridbar"}static get defaultConfig(){return{htmlCls:"",scrollable:{overflowX:"hidden-scroll"}}}get columns(){return this._columns||this.subGrid.columns}set columns(e){this._columns=e}fixCellWidths(){const e=this,{hasFlex:t}=e.columns;let i;e.columns.traverse(r=>{const n=e.getBarCellElement(r.id),s=S.setLength(r.width),a=S.setLength(r.minWidth),o=S.setLength(r.maxWidth);if(n){if(i=s,n.style.maxWidth=o,r.isParent&&r.width==null&&r.flex==null){const l=r.children.reduce((d,u)=>d+=!u.hidden&&u.flex||0,0);n.style.flex=l>0?`${l} 0 auto`:"",n.style.minWidth=null,l>0&&r.traverse(d=>d.data.minWidth=null)}else if(parseInt(r.minWidth)>=0&&(n.style.minWidth=a),n.style.flex=n.style.flexBasis=n.style.width="",r.flex)!isNaN(parseInt(r.flex))&&r.children?n.style.flex=`${r.flex} 0 auto`:n.style.flex=r.flex;else if(parseInt(r.width)>=0){const l=r.parent;e.isHeader&&!l.isRoot&&!l.width?n.style.width=s:n.style.flexBasis=i}r.height>=0&&(n.style.height=S.setLength(r.height))}}),e.scrollable.element.classList.toggle("b-has-flex",t)}getLrPadding(e){if(!this.cellLrPadding){const t=e.ownerDocument.defaultView.getComputedStyle(e);this.cellLrPadding=parseInt(t.getPropertyValue("padding-left"))+parseInt(t.getPropertyValue("padding-right"))+parseInt(t.getPropertyValue("border-left-width"))+parseInt(t.getPropertyValue("border-right-width"))}return this.cellLrPadding}getBarCellElement(e){return this.element.querySelector(`[data-column-id="${e}"]`)}}io.initClass();io._$name="Bar";class Cd extends io{static get $name(){return"Footer"}static get type(){return"gridfooter"}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}refreshContent(){this.element.firstElementChild.innerHTML=this.contentTemplate(),this.fixFooterWidths()}onPaint({firstPaint:e}){e&&this.refreshContent()}template(){const e=this.subGrid.region;return bt.tpl`
            <div class="b-grid-footer-scroller b-grid-footer-scroller-${e}" role="presentation">
                <div data-reference="footersElement" class="b-grid-footers b-grid-footers-${e}" data-region="${e}" role="presentation"></div>
            </div>
        `}get overflowElement(){return this.footersElement}getFooter(e){return this.getBarCellElement(e)}contentTemplate(){return this.columns.visibleColumns.map(t=>bt.tpl`
                <div
                    class="b-grid-footer ${t.align?`b-grid-footer-align-${t.align}`:""} ${t.cls||""}"
                    data-column="${t.field||""}" data-column-id="${t.id}" data-all-index="${t.allIndex}"
                    role="presentation">
                    ${t.footerText||""}
                </div>`).join("")}fixFooterWidths(){this.fixCellWidths()}}Cd.initClass();Cd._$name="Footer";class wd extends te{static get pluginConfig(){return{chain:["destroy"],assign:["rowHeight","topRow","bottomRow","firstVisibleRow","lastVisibleRow","firstFullyVisibleRow","lastFullyVisibleRow","getRowById","getRecordCoords","getRow","getRowFor","getRowFromElement"]}}static get defaultConfig(){return{prependRowBuffer:5,appendRowBuffer:5,rowHeight:null,fixedRowHeight:null,autoHeight:!1}}static get properties(){return{idMap:{},topIndex:0,lastScrollTop:0,_rows:[],heightMap:new Map,totalKnownHeight:0,_totalHeight:0,averageRowHeight:0,scrollTargetRecordId:null,refreshDetails:{topRowIndex:0,topRowTop:0}}}construct(e){e.grid._rowManager=this,super.construct(e.grid,e)}doDestroy(){this._rows.forEach(e=>e.destroy()),super.doDestroy()}initWithHeight(e,t=!1){const i=this;return i.autoHeight&&(e=i.store.allCount*i.preciseRowOffsetHeight),i.viewHeight=e,i.calculateRowCount(t),e}reinitialize(e=!1){const t=this;t.calculateRowCount(!1,!0,!0),t.topIndex+t.rowCount-1>t.store.count&&(e=!0);const i=t.topRow&&!e?t.topRow.top:0;t.scrollTargetRecordId=null,e&&(t.topIndex=t.lastScrollTop=0);const{topRow:r}=t;r&&(r.dataIndex=t.topIndex,r.setTop(i,!0)),t.estimateTotalHeight(),t.renderFromRow(r)}matchRowCount(e=!1){const t=this,{rows:i,grid:r}=t,n=i.length,s=n-t.rowCount;if(s)if(s<0){const l=[];for(let d=n,u=n?i[n-1].dataIndex+1:0;d<t.rowCount;d++,u++)l.push(new is({cls:r.rowCls,rowManager:t,grid:r,index:d,dataIndex:u}));i.push.apply(i,l),t.trigger("addRows",{rows:l}),e||t.renderFromRow(i[Math.max(0,n-1)])}else{var a;const{focusedCell:l}=r,d=l?.id!=null&&(l==null||(a=l.cell)===null||a===void 0?void 0:a.contains(S.getActiveElement(r))),u=i.splice(n-s,s);if(d){var o;s===n?r.onFocusedRowDerender():((o=t.getRowFor(l._record))===null||o===void 0?void 0:o.index)>=i.length&&i[i.length-1].cells[l.columnIndex].focus()}t.trigger("removeRows",{rows:u}),u.forEach(h=>h.destroy())}}calculateRowCount(e=!1,t=!0,i=!1){var r;const n=this,{store:s}=n,a=Math.ceil(n.viewHeight/n.minRowOffsetHeight),o=a+n.prependRowBuffer+n.appendRowBuffer;if(!((r=n.grid.columns)!==null&&r!==void 0&&r.count)||isNaN(a))return n.rowCount=0,0;if(o<n.rowCount&&!t)return n.rowCount;if(n.visibleRowCount=a,n.rowCount=Math.min(s.count,o),!e){if(n.rows&&n.rowCount!==n.rows.length){var l;if(n.matchRowCount(i),((l=n.bottomRow)===null||l===void 0?void 0:l.dataIndex)>=s.count&&n.topRow.dataIndex!==0){const d=n.bottomRow.dataIndex-s.count+1;for(const u of n.rows)u.dataIndex-=d;n.topIndex-=d}}else n.rowCount||n.trigger("changeTotalHeight",{totalHeight:n.totalHeight});n.grid.toggleEmptyText()}return n.rowCount}removeAllRows(){const e=this,{topRow:t}=e,i=t?e.refreshDetails={topRowIndex:t.dataIndex,topRowTop:t.top}:e.refreshDetails,r=e.rows.slice();return e.trigger("removeRows",{rows:r}),e.rows.forEach(n=>n.destroy()),e.rows.length=0,e.idMap={},i}setPosition(e){const{topRow:t}=this,{topRowIndex:i,topRowTop:r}=e;t.setTop(r),t.dataIndex=i}get store(){return this.client.store}get rows(){return this._rows}getRow(e){if(this.rowCount)return this.rows[e-this.topIndex]}getRowById(e){return e&&e.isModel&&(e=e.id),this.idMap[e]}getRowFromElement(e){return e=e.closest(".b-grid-row"),e&&this.getRow(e.dataset.index)}getRowAt(e,t=!1){return t||(e-=$.from(this.grid.bodyContainer,null,!0).roundPx(1).top,e+=this.grid.scrollable.y),e=S.roundPx(e),this.rows.find(i=>e>=i.top&&e<i.bottom)}getRowFor(e){return e instanceof HTMLElement?this.getRowFromElement(e):this.getRowById(e)}getNextRow(e){const t=typeof e=="number"?e:e.index;return this.getRow((t+1)%this.rowCount)}get topRow(){return this.rows[0]}get bottomRow(){const e=Math.min(this.rowCount,this.store.count);return this.rows[e-1]}get firstVisibleRow(){return this.rows.find(e=>e.bottom>Math.ceil(this.grid.scrollable.y))}get firstFullyVisibleRow(){return this.rows.find(e=>e.top>=Math.ceil(this.grid.scrollable.y))}get lastVisibleRow(){const{grid:e}=this;return W.findLast(this.rows,t=>t.top<e.scrollable.y+e.bodyHeight)}get lastFullyVisibleRow(){const{grid:e}=this;return W.findLast(this.rows,t=>t.bottom<e.scrollable.y+e.bodyHeight)}offsetRows(e){if(e!==0){const{rows:t}=this,{length:i}=t;for(let r=0;r<i;r++)t[r].offset(e)}this.trigger("offsetRows",{offset:e})}get prependBufferHeight(){return this.prependRowBuffer*this.rowOffsetHeight}get appendBufferHeight(){return this.appendRowBuffer*this.rowOffsetHeight}get rowHeight(){return this._rowHeight}set rowHeight(e){const t=this,{grid:i,fixedRowHeight:r}=t,n=t.rowHeight;if(n!==e){if(T.assertNumber(e,"rowHeight"),e<10&&(e=10),t.trigger("beforeRowHeight",{height:e}),t.minRowHeight=t._rowHeight=e,r&&(t.averageRowHeight=e),t.rows.length){const s=i.scrollable.y,a=t.getRowAt(s,!0),o=a?a.top-s:0;let l,d;r?(l=e,d=n):(d=l=t.averageRowHeight,t.clearKnownHeights(),l*=e/n),t.calculateRowCount(!1,!0,!0),t.topRow.setTop(t.topRow.dataIndex*(l+i._rowBorderHeight),!0),t.refresh(),s*(l/d)!==s&&i.scrollRowIntoView(a.id,{block:"start",edgeOffset:o})}t.trigger("rowHeight",{height:e,oldHeight:n})}}get rowOffsetHeight(){return Math.floor(this.preciseRowOffsetHeight)}get preciseRowOffsetHeight(){return(this.averageRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get minRowOffsetHeight(){return(this.minRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get allHeightsKnown(){return this.fixedRowHeight||this.heightMap.size>=this.store.count}storeKnownHeight(e,t){const i=this,{heightMap:r}=i;i.fixedRowHeight||(r.has(e)&&(i.totalKnownHeight-=r.get(e)),r.set(e,t),i.totalKnownHeight+=t,t<i.minRowHeight&&(i.minRowHeight=t),i.averageRowHeight=i.totalKnownHeight/r.size)}getOffsetHeight(e){const t=this;return(e&&t.heightMap.get(e.id)||e&&t.grid.getRowHeight(e)||t.averageRowHeight||t.rowHeight)+t.grid._rowBorderHeight}invalidateKnownHeight(e){const t=this;if(!t.fixedRowHeight){const{heightMap:i}=t;e=W.asArray(e),e.forEach(r=>{r&&i.has(r.id)&&(t.totalKnownHeight-=i.get(r.id),i.delete(r.id))}),t.averageRowHeight=t.totalKnownHeight/i.size}}clearKnownHeights(){this.heightMap.clear(),this.averageRowHeight=this.totalKnownHeight=0}calculateTop(e){if(this.fixedRowHeight)return e*this.rowOffsetHeight;const{store:t}=this;let i=0;for(let r=0;r<e;r++){const n=t.getAt(r);i+=this.getOffsetHeight(n)}return Math.floor(i)}getRecordCoords(e,t=!1,i=!1){const r=this,n=r.getRowById(e);let s=r.client._bodyRectangle;return t||(s=r.client.refreshBodyRectangle()),n?new $(s.x,Math.round(t?n.top:n.top+s.y-r.client.scrollable.y),s.width,n.offsetHeight):r.getRecordCoordsByIndex(r.store.indexOf(e),t,i)}getRecordCoordsByIndex(e,t=!1,i=!1){const r=this,{topRow:n,bottomRow:s}=r,a=r.client._bodyRectangle,{id:o}=r.store.getAt(e),l=r.preciseRowOffsetHeight,d=n.dataIndex,u=s.dataIndex,h=e>u?{index:e-u-1,y:s.bottom,from:"bottomRow"}:e>d/2?{index:e-d,y:n.top,from:"topRow"}:{index:e,y:0,from:"top"},f=r.allHeightsKnown&&!i?r.calculateTop(e):Math.floor(h.y+h.index*l),g=new $(a.x,t?f:f+a.y-r.client.scrollable.y,a.width,Math.floor(r.heightMap.get(o)||l));return g.virtual=!0,g.block=g.bottom<a.y?"start":g.y>a.bottom?"end":"nearest",g}get totalHeight(){return this._totalHeight}forEach(e){this.rows.forEach(e)}[Symbol.iterator](){return this.rows[Symbol.iterator]()}refreshCell(e,t){const i=new ne({grid:this.grid,record:e,columnId:t});return Boolean(i.cell&&i.row.renderCell(i))}returnToTop(){const e=this;e.topIndex=0,e.lastScrollTop=0,e.topRow&&(e.topRow.dataIndex=0,e.topRow.setTop(0,!0)),e.refresh(),e.grid.scrollable.y=0}renderFromRecord(e){const t=this.getRowById(e.id);t&&this.renderFromRow(t)}renderFromRow(e=null){const t=this,{rows:i,store:r}=t,n=r.count;if(t.calculateRowCount(!1,n<i.length,!0)===0){t.estimateTotalHeight(!0);return}const s=e?i.indexOf(e):0;let a=e?e.dataIndex:i[0].dataIndex;const o=n-a-1,l=Math.min(i.length-1,s+o);let d=i.length-l-1,u=s>0?i[s-1].bottom:i[s].top,h;for(let f=s;f<=l;f++)h=i[f],h.dataIndex=a,h.setTop(u,!0),h.render(a,r.getAt(a++),!1),u+=h.offsetHeight;for(;d-- >0;)t.displayRecordAtTop();t.bottomRow.bottom<t.viewHeight&&t.calculateRowCount(),t.estimateTotalHeight(!0),t.trigger("renderDone")}renderRows(e){let t,i=!1;e=Array.from(e),e.sort((r,n)=>r.dataIndex-n.dataIndex);for(const r of e)t=r.height,r.render(null,null,!1),i|=r.height!==t;i&&this.translateFromRow(e[0]),this.trigger("renderDone")}translateFromRow(e,t=!1){const i=this;let r=e.bottom,n,s;for(s=e.dataIndex+1,n=i.getRow(s);n;n=i.getRow(++s))r=n.translate(r);t||i.estimateTotalHeight(!0)}refresh(){const e=this,{topRow:t}=e;!t||e.grid.refreshSuspended||(e.idMap={},e.renderFromRow(t),e.trigger("refresh"))}jumpToPosition(e,t){const i=this,{store:r,heightMap:n}=i,s=r.count;if(i.allHeightsKnown&&!i.fixedRowHeight){const a=e-i.prependBufferHeight,o=i.grid._rowBorderHeight;let l=0,d=0;for(;l<a;){const h=r.getAt(d);l+=n.get(h.id)+o,d++}const u=Math.max(Math.min(d,s-i.rowCount),0);i.lastScrollTop=e,i.topRow.dataIndex=i.topIndex=u,i.topRow.setTop(i.calculateTop(u),!1),i.refresh()}else{const a=i.preciseRowOffsetHeight,o=t==null?Math.floor(e/a)-i.prependRowBuffer:t-Math.floor(i.rowCount/2),l=Math.max(Math.min(o,s-i.rowCount),0),d=i.client.scrollable.y,u=Math.min(i.client._bodyRectangle.height+d+i.appendBufferHeight,i.totalHeight);if(i.lastScrollTop=e,i.topRow.dataIndex=i.topIndex=l,i.topRow.setTop(Math.floor(l*a),!1),i.refresh(),i.bottomRow.bottom<u)for(i.calculateRowCount(!1,!1,!1);i.bottomRow.bottom<u&&i._rows[i.prependRowBuffer].top<d&&i.bottomRow.dataIndex<s-1;)i.displayRecordAtBottom();i.estimateTotalHeight()}if(t!=null){const{scrollable:a}=i.grid,o=i.getRow(t),l=o&&$.from(o._elementsArray[0]).center.y,d=a.viewport.center.y;o&&(a.y=e=Math.floor(a.y+(l-d)))}return e}warpIfNeeded(e){const t=this,i={newScrollTop:e,deltaTop:e-t.lastScrollTop};if(Math.abs(i.deltaTop)>t.rowCount*t.rowOffsetHeight*3){let r;t.scrollTargetRecordId&&(r=t.store.indexOf(t.scrollTargetRecordId)),t.grid.onFocusedRowDerender(),i.newScrollTop=t.jumpToPosition(e,r),i.deltaTop=0}return i}updateRenderedRows(e,t,i=!1){const r=this,n=r.client._bodyRectangle;if(r.rowCount===0)return 0;let s=r.totalHeight;if(t||Math.abs(e-r.lastScrollTop)>=r.rowOffsetHeight||r.topRow.top>e||r.bottomRow.bottom<e+n.height){const a=r.warpIfNeeded(e);r.scrollTargetRecordId=null,r.lastScrollTop=a.newScrollTop,a.deltaTop>0?r.fillBelow(a.newScrollTop):a.deltaTop<0&&r.fillAbove(a.newScrollTop),!r.fixedRowHeight&&!i&&r.correctError(a,n,e),s=r.estimateTotalHeight()}return s}correctError(e,t,i){const r=this;let n=0;(r.allHeightsKnown||e.deltaTop<0&&i<t.height*2||e.deltaTop>0&&i>r.totalHeight-t.height*2-3)&&(n=r.topRow.top-r.calculateTop(r.topRow.dataIndex)),n&&(r.offsetRows(-n),r.grid.scrollable.y=r.lastScrollTop=r.grid.scrollable.y-n)}fillAbove(e){const t=this,i=e-t.topRow.top-t.prependBufferHeight;let r=0;for(;r>i&&t.topIndex>0;)r-=t.displayRecordAtTop();t.trigger("renderDone")}fillBelow(e){const t=this,i=e-t.topRow.top-t.prependBufferHeight,r=t.store.count,n=t.rowCount;let s=0;for(;s<i&&t.topIndex+n<r&&t.topRow.top+t.topRow.offsetHeight<e;)s+=t.displayRecordAtBottom();t.trigger("renderDone")}estimateTotalHeight(e=!1){const t=this;if(t.grid.renderingRows)return;const i=t.store.count,r=i-t.heightMap.size,{bottomRow:n}=t;let s;if(t.fixedRowHeight)s=i*t.rowOffsetHeight;else{if(s=t.totalKnownHeight+t.heightMap.size*t.grid._rowBorderHeight+r*t.preciseRowOffsetHeight,n&&r){const a=n.bottom;(a>s||t.topIndex+t.rowCount>=i&&s>a&&a>0)&&(s=a,n.dataIndex<i-1&&(s+=(i-1-n.dataIndex)*t.preciseRowOffsetHeight))}s=Math.floor(s)}return s!==t.totalHeight&&t.trigger("changeTotalHeight",{totalHeight:s,immediate:e})!==!1&&(t._totalHeight=s),s}displayRecordAtTop(){var e;const t=this,{grid:i}=t,r=t.topIndex-1,n=t.store.getAt(r),s=t.bottomRow,a=s.top;return t.trigger("beforeTranslateRow",{row:s,newRecord:n}),s.dataIndex===((e=i.focusedCell)===null||e===void 0?void 0:e.rowIndex)&&i.onFocusedRowDerender(),s._top=t.topRow.top-t.getOffsetHeight(n),s.estimatedTop=!t.fixedRowHeight,s.render(r,n,!1),s._top=a,s.setBottom(t.topRow.top),s.estimatedTop=!1,t.topIndex--,t._rows.unshift(t._rows.pop()),s.offsetHeight}displayRecordAtBottom(){var e;const t=this,{grid:i}=t,r=t.topIndex+t.rowCount,n=t.store.getAt(r),s=t.topRow;return t.trigger("beforeTranslateRow",{row:s,newRecord:n}),s.dataIndex===((e=i.focusedCell)===null||e===void 0?void 0:e.rowIndex)&&i.onFocusedRowDerender(),s.dataIndex=r,s.setTop(t.bottomRow.bottom),s.render(r,n,!1),t.topIndex++,t._rows.push(t._rows.shift()),s.offsetHeight}}wd.featureClass="";wd._$name="RowManager";const N0={x:1};class xm extends Ke{addScroller(e){(this.xScrollers||(this.xScrollers=[])).push(e)}addPartner(e,t=N0){typeof t=="string"&&(t={[t]:1}),t.x&&(e.owner.initScroll(),this.xScrollers.forEach((i,r)=>i.addPartner(e.xScrollers[r],"x"))),t.y&&super.addPartner(e,"y")}removePartner(e){this.xScrollers.forEach((t,i)=>{t.isDestroyed||t.removePartner(e.xScrollers[i])}),super.removePartner(e)}updateOverflowX(e){var t;const i=e===!1;(t=this.xScrollers)===null||t===void 0||t.forEach(r=>r.overflowX=i?"hidden":"hidden-scroll"),this.widget.virtualScrollers.classList.toggle("b-hide-display",i)}scrollIntoView(e,t){if(e.nodeType===Element.ELEMENT_NODE&&this.element.contains(e)){for(const i of this.xScrollers)if(i.element.contains(e))return i.scrollIntoView(e,t)}else return super.scrollIntoView(e,t)}hasOverflow(e="y"){return e==="y"?this.scrollHeight>this.clientHeight:!1}set x(e){this.xScrollers&&(this.xScrollers[0].x=e)}get x(){return this.xScrollers?this.xScrollers[0].x:0}}xm._$name="GridScroller";class ro extends io{static get $name(){return"Header"}static get type(){return"gridheader"}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}get region(){var e;return(e=this.subGrid)===null||e===void 0?void 0:e.region}changeElement(e,t){const{region:i}=this;return this.getConfig("columns"),super.changeElement({className:{"b-grid-header-scroller":1,[`b-grid-header-scroller-${i}`]:i},children:[{reference:"headersElement",className:{"b-grid-headers":1,[`b-grid-headers-${i}`]:i},dataset:{region:i,reference:"headersElement",maxDepth:this.maxDepth}}]},t)}get overflowElement(){return this.headersElement}getColumnConfig(e){const{id:t,align:i,resizable:r,isLeaf:n,isParent:s,isLastInSubGrid:a,cls:o,childLevel:l,field:d,tooltip:u,children:h,isFocusable:f,grid:g}=e,m=g?.focusedCell,p=m?.rowIndex===-1&&m?.column===e;if(e.isVisible)return{className:{"b-grid-header":1,"b-grid-header-parent":s,[`b-level-${l}`]:1,[`b-depth-${e.meta.depth}`]:1,[`b-grid-header-align-${i}`]:i,"b-grid-header-resizable":r&&n,[o]:o,"b-collapsible":e.collapsible,"b-last-parent":s&&a,"b-last-leaf":n&&a},role:f?"columnheader":"presentation","aria-sort":"none","aria-label":e.ariaLabel,[f?"tabIndex":""]:p?0:-1,dataset:F(F({},ce.encodeConfig(u)),{},{columnId:t,[d?"column":""]:d}),children:[{className:"b-grid-header-text",children:[{[g&&f?"id":""]:`${g?.id}-column-${e.id}`,className:"b-grid-header-text-content"}]},h?{className:"b-grid-header-children",children:h.map(v=>this.getColumnConfig(v))}:null,{className:"b-grid-header-resize-handle"}]}}calculateMinWidthForSafari(){let e=0;return this.columns.visibleColumns.forEach(t=>{e+=t.calculateMinWidth()}),e}fixHeaderWidths(){this.fixCellWidths()}refreshHeaders(){const e=this;e.columns.traverse(t=>{const i=e.getBarCellElement(t.id);if(i){let r=t.headerText;t.headerRenderer&&(r=t.headerRenderer.call(t.thisObj||e,{column:t,headerElement:i})),t.headerWidgetMap&&Object.values(t.headerWidgetMap).forEach(s=>{s.render(t.textWrapper)}),t.icon&&(r=`<i class="${z.encodeHtml(t.icon)}"></i>`+(r||""));const n=i.querySelector(".b-grid-header-text-content");n&&(n.innerHTML=r||"")}}),e.fixHeaderWidths()}get columns(){const e=this,t=super.columns;return e.columnsDetacher||(e.columnsDetacher=t.ion({change(){e.initDepths()},thisObj:e}),e.initDepths()),t}set columns(e){super.columns=e}initDepths(e=this.columns.topColumns,t=null){const i=this;let r=0;t!=null&&t.meta&&t.meta.depth++;for(const n of e){const{meta:s}=n;s.depth=0,n.children&&(i.initDepths(n.children.filter(i.columns.chainedFilterFn),n),s.depth&&t&&(t.meta.depth+=s.depth)),s.depth>r&&(r=s.depth)}return t||(i.maxDepth=r),r}getHeader(e){return this.getBarCellElement(e)}get contentElement(){return this.element.firstElementChild}refreshContent(){const e=this;Z.sync({domConfig:{children:e.columns.topColumns.map(t=>e.getColumnConfig(t)),onlyChildren:!0,strict:!0,syncIdField:"columnId",releaseThreshold:0},targetElement:e.contentElement}),e.refreshHeaders()}onPaint({firstPaint:e}){e&&this.refreshContent()}}ro.initClass();ro._$name="Header";const yl={touchstart:"onElementTouchStart",touchmove:"onElementTouchMove",touchend:"onElementTouchEnd",mouseover:"onElementMouseOver",mouseout:"onElementMouseOut",mousedown:"onElementMouseDown",mousemove:"onElementMouseMove",mouseup:"onElementMouseUp",click:"onHandleElementClick",dblclick:"onElementDblClick",keyup:"onElementKeyUp",keypress:"onElementKeyPress",contextmenu:"onElementContextMenu",pointerdown:"onElementPointerDown",pointerup:"onElementPointerUp"},zh=["pageX","pageY","clientX","clientY","screenX","screenY"];function Dn(c,e=!0){c?.classList.toggle("b-hover",e)}function Xs(c,e,t=!0){e&&c&&Dn(e.getCell(c),t)}var B0=c=>class extends(c||P){static get $name(){return"GridElementEvents"}static get configurable(){return{longPressTime:400,enableUndoRedoKeys:!0,keyMap:{"Ctrl+z":"undoRedoKeyPress","Ctrl+Shift+z":"undoRedoKeyPress"," ":{handler:"clickCellByKey",weight:1e3}}}}initInternalEvents(){const t=Object.keys(yl),i=t.length,r={element:this.bodyElement,thisObj:this};for(let n=0;n<i;n++){const s=t[n];r[s]={handler:"handleEvent"},s.startsWith("touch")&&(r[s].passive=!1)}B.on(r),B.on({focusin:"onGridBodyFocusIn",element:this.bodyElement,thisObj:this,capture:!0})}getCellDataFromEvent(t,i=!1){const r=this,{columns:n}=r,{target:s}=t;let a=s.closest(".b-grid-cell");if(!a&&i&&!s.classList.contains("b-grid-row")&&!s.classList.contains("b-grid-subgrid")){const{top:l,left:d,right:u,bottom:h}=r.bodyContainer.getBoundingClientRect();let f,{x:g,y:m}=t;if(g>=d&&g<=u?m=f=Math.ceil(r[`${m<l?"first":"last"}FullyVisibleRow`].element.getBoundingClientRect().y):m>=l&&m<=h&&(g=f=Math.ceil(n.visibleColumns[g<d?0:n.visibleColumns.length-1].element.getBoundingClientRect().x)),f!==void 0){var o;a=(o=document.elementFromPoint(g,m))===null||o===void 0?void 0:o.closest(".b-grid-cell")}}if(a){const l=$e.get(a),{id:d,columnId:u}=l,h=r.store.getById(d),f=n.getById(u);return h?{cellElement:a,cellData:l,columnId:u,id:d,record:h,column:f,cellSelector:{id:d,columnId:u}}:null}}getHeaderDataFromEvent(t){const i=t.target.closest(".b-grid-header");if(i){const r=T.assign({},i.dataset),{columnId:n}=r,s=this.columns.getById(n);return s?{headerElement:i,headerData:r,columnId:n,column:s}:null}}handleEvent(t){!this.disabled&&yl[t.type]&&this[yl[t.type]](t)}onElementTouchStart(t){const i=this,r=i.getCellDataFromEvent(t);S.isTouchEvent=!0,t.touches.length===1&&(i.longPressTimeout=i.setTimeout(()=>{i.onElementLongPress(t),t.preventDefault(),i.longPressPerformed=!0},i.longPressTime)),r&&!t.defaultPrevented&&i.onFocusGesture(t)}onElementTouchMove(t){const i=this,{lastTouchTarget:r}=i,n=t.changedTouches[0],{pageX:s,pageY:a}=n,o=document.elementFromPoint(s,a);if(i.longPressTimeout&&(i.clearTimeout(i.longPressTimeout),i.longPressTimeout=null),o!==r){if(r){const l=new MouseEvent("mouseout",T.copyProperties({relatedTarget:o,pointerType:"touch",bubbles:!0},n,zh));l.preventDefault=()=>t.preventDefault(),r?.dispatchEvent(l)}if(o){const l=new MouseEvent("mouseover",T.copyProperties({relatedTarget:r,pointerType:"touch",bubbles:!0},n,zh));l.preventDefault=()=>t.preventDefault(),o?.dispatchEvent(l)}}i.lastTouchTarget=o}onElementTouchEnd(t){const i=this;i.longPressPerformed&&(t.cancelable&&t.preventDefault(),i.longPressPerformed=!1),i.longPressTimeout&&(i.clearTimeout(i.longPressTimeout),i.longPressTimeout=null)}onElementLongPress(t){}triggerCellMouseEvent(t,i,r=this.getCellDataFromEvent(i)){const n=this;if(r){const a=n.columns.getById(r.columnId),o={grid:n,record:r.record,column:a,cellSelector:r.cellSelector,cellElement:r.cellElement,target:i.target,event:i};if(n.trigger("cell"+z.capitalize(t),o),t==="click"){var s;(s=a.onCellClick)===null||s===void 0||s.call(a,o)}}}onElementMouseDown(t){const i=this,r=i.getCellDataFromEvent(t);i.skipFocusSelection=!0,i.isScrollbarOrRowBorderOrSplitterClick(t)?t.preventDefault():(i.triggerCellMouseEvent("mousedown",t,r),r&&!t.defaultPrevented&&i.onFocusGesture(t))}isScrollbarOrRowBorderOrSplitterClick({target:t,x:i,y:r}){if(t.closest(".b-grid-splitter")||t.matches(".b-grid-row, .b-virtual-width"))return!0;if(t.matches(".b-vertical-overflow")){const n=t.getBoundingClientRect();return i>n.right-S.scrollBarWidth}else if(t.matches(".b-horizontal-overflow")){const n=t.getBoundingClientRect();return r>n.bottom-S.scrollBarWidth-1}}onElementMouseMove(t){this.mouseMoveEvent=t}onElementMouseUp(t){}onElementPointerDown(t){}onElementPointerUp(t){}onHandleElementClick(t){this.trigger("beforeElementClick",{event:t})!==!1&&this.onElementClick(t)}onElementClick(t){const i=this,r=i.getCellDataFromEvent(t);r&&i.triggerCellMouseEvent("click",t,r)}onFocusGesture(t){const i=this,r=t.button===2,n=!r&&t.target.matches(".b-icon-tree-expand, .b-icon-tree-collapse"),s=!document.hasFocus()&&K.isMac&&r;if(n||s)t.preventDefault();else{var a;i.navigationEvent=t,(r||(a=i.focusedCell)!==null&&a!==void 0&&a.equals(new ne(t.target)))&&i.focusCell(new ne(t.target))}}onElementDblClick(t){const{target:i}=t;if(this.triggerCellMouseEvent("dblClick",t),i.classList.contains("b-grid-header-resize-handle")){const r=i.closest(".b-grid-header");this.columns.getById(r.dataset.columnId).resizeToFitContent()}}onElementMouseOver(t){if(!this.scrolling){const i=typeof t.buttons!="number"||t.buttons===0,r=t.target.closest(".b-grid-cell");i&&!r&&t.target.classList.contains("b-grid-row")&&this.setHovered(document.elementFromPoint(t.x,t.y-2).closest(".b-grid-cell")),r&&(i&&this.setHovered(r),this.triggerCellMouseEvent("mouseOver",t)),this.trigger("mouseOver",{event:t})}}onElementMouseOut(t){this.setHovered(null),this.scrolling||(t.target.closest(".b-grid-cell")&&this.triggerCellMouseEvent("mouseOut",t),this.trigger("mouseOut",{event:t}))}setHovered(t){var i,r;const n=this,{selectionMode:s}=n,a=s.rowNumber&&((i=n.columns.find(u=>u.type=="rownumber"))===null||i===void 0?void 0:i.id),o=s.checkbox&&((r=n.checkboxSelectionColumn)===null||r===void 0?void 0:r.id);if(n._hoveredCell){Dn(n._hoveredCell,!1);const u=$e.get(n._hoveredCell),{row:h}=u;if(h&&!h.isDestroyed&&(Xs(a,h,!1),Xs(o,h,!1)),u!=null&&u.columnId){var l;Dn((l=n.columns.getById(u.columnId))===null||l===void 0?void 0:l.element,!1)}n._hoveredCell=null}if(n._hoveredRow&&!n._hoveredRow.isDestroyed&&n._hoveredRow.removeCls("b-hover"),n._hoveredRow=null,t&&!n.scrolling){const u=$e.get(t),{row:h}=u;if(h)if(s.cell&&u.columnId!==a&&u.columnId!==o){var d;Dn(t),n._hoveredCell=t,Xs(o,h),Xs(a,h),Dn((d=n.columns.getById(u.columnId))===null||d===void 0?void 0:d.element)}else n._hoveredRow=h,h.addCls("b-hover")}}keyMapOnKeyDown(t){this.onElementKeyDown(t),super.keyMapOnKeyDown(t)}onElementKeyDown(t){if(t.handled)return;const i=this,r=i.focusedCell;if(r!=null&&r.isCell&&!r.isActionable){var n,s;const a=r.cell;(n=(s=i.columns.getById(a.dataset.columnId)).onCellKeyDown)===null||n===void 0||n.call(s,{event:t,cellElement:a})}}undoRedoKeyPress(t){var i;const{stm:r}=this.store;return r&&this.enableUndoRedoKeys&&!((i=this.features.cellEdit)!==null&&i!==void 0&&i.isEditing)?(r.onUndoKeyPress(t),!0):!1}clickCellByKey(t){const i=this,r=i.focusedCell,n=r?.cell,s=i.columns.getById(n.dataset.columnId);return r!=null&&r.isCell&&!r.isActionable&&s.onCellClick?(s.onCellClick({grid:i,column:s,record:i.store.getById(r.id),cellElement:n,target:t.target,event:t}),!0):!1}onElementKeyPress(t){}onElementKeyUp(t){}onElementContextMenu(t){const i=this,r=i.getCellDataFromEvent(t);r&&(i.triggerCellMouseEvent("contextMenu",t,r),S.isTouchEvent&&i.onFocusGesture(t))}onInternalResize(t,i,r,n,s){const a=this;a._devicePixelRatio&&a._devicePixelRatio!==globalThis.devicePixelRatio&&S.resetScrollBarWidth(),a._devicePixelRatio=globalThis.devicePixelRatio,a._bodyRectangle=$.client(a.bodyContainer),super.onInternalResize(...arguments),r!==s&&(a._bodyHeight=a.bodyContainer.offsetHeight,a.isPainted&&a.rowManager.initWithHeight(a._bodyHeight)),a.refreshVirtualScrollbars(),i!==n&&a.setTimeout(()=>{a.isDestroyed||a.updateResponsive(i,n)},0)}get widgetClass(){}};const z0={string:1,object:1,function:1};var V0=c=>class extends(c||P){static get $name(){return"GridFeatures"}set features(t){const i=this,r=G.getInstanceDefaultFeatures(this);t=i._features=T.assign({},t),r&&Object.keys(r).forEach(s=>{s in t||(t[s]=!0)});const n=G.getInstanceFeatures(this);for(const s of Object.keys(t)){const a=t[s];if(a){const o=!globalThis.__bryntum_code_editor_changed;if(z.uncapitalize(s)!==s){const d=`Invalid feature name '${s}', must start with a lowercase letter`;if(o)throw new Error(d);console.error(d),i._errorDuringConfiguration=d}const l=n[s];if(!l){const d=`Feature '${s}' not available, make sure you have imported it`;if(o)throw new Error(d);console.error(d),i._errorDuringConfiguration=d;return}Reflect.defineProperty(t,s,i.createFeatureInitializer(t,s,l,a))}}}get features(){return this._features}createFeatureInitializer(t,i,r,n){const s=[this],a=r.prototype.construct;return n===!0&&(n={}),z0[typeof n]&&(s[1]=n),{configurable:!0,get(){return delete t[i],r.prototype.construct=function(...o){t[i]=this,a.apply(this,o),r.prototype.construct=a},new r(...s)}}}hasFeature(t){const{features:i}=this;if(i){const r=Object.getOwnPropertyDescriptor(this.features,t);if(r)return Boolean(r.value||r.get)}return!1}hasActiveFeature(t){var i,r;return Boolean(((i=this.features)===null||i===void 0?void 0:i[t])&&!((r=this.features)!==null&&r!==void 0&&r[t].disabled))}getConfigValue(t,i){if(t==="features"){const a={};for(const o in this.features){var r,n,s;const l=(r=this.features[o])===null||r===void 0||(n=(s=r).getCurrentConfig)===null||n===void 0?void 0:n.call(s,i);l?T.isEmpty(l)?G.isDefaultFeatureForInstance(this.features[o].constructor,this)||(a[o]=!0):a[o]=l:a[o]=!1}return a}return super.getConfigValue(t,i)}get widgetClass(){}};const j0=Object.freeze({}),W0=Object.freeze({x:!1,y:!1}),U0=function(c){return this.focusableFinderCell.contains(c)?S.isFocusable(c)&&!c.disabled?S.NodeFilter.FILTER_ACCEPT:S.NodeFilter.FILTER_SKIP:S.NodeFilter.FILTER_REJECT};var Y0=c=>{var e;return e=class extends(c||P){static get $name(){return"GridNavigation"}onStoreRecordIdChange(i){var r;(r=super.onStoreRecordIdChange)===null||r===void 0||r.call(this,i);const{focusedCell:n}=this,{oldValue:s,value:a}=i;n&&n.id===s&&(n._id=a)}onFocusedRowDerender(){const i=this,{focusedCell:r}=i;if(r?.id!=null&&r.cell){const n=r.cell.contains(S.getActiveElement(i));if(i.hideHeaders)n&&i.revertFocus();else{const s=i.normalizeCellContext({rowIndex:-1,columnIndex:n?r.columnIndex:0});n?i.focusCell(s):s.cell.tabIndex=0}r.cell.tabIndex=-1}}navigateFirstCell(){this.focusCell(ne.FIRST_CELL)}navigateFirstColumn(){this.focusCell(ne.FIRST_COLUMN)}navigateLastCell(){this.focusCell(ne.LAST_CELL)}navigateLastColumn(){this.focusCell(ne.LAST_COLUMN)}navigatePrevPage(){this.focusCell(ne.PREV_PAGE)}navigateNextPage(){this.focusCell(ne.NEXT_PAGE)}activateHeader(i){if(i.target.classList.contains("b-grid-header")&&this.focusedCell.isColumnHeader){var r;const{column:n}=this.focusedCell;(r=n.onKeyDown)===null||r===void 0||r.call(n,i),this.getHeaderElement(n.id).click()}return!1}onEscape(i){const{focusedCell:r}=this;!i.target.closest(".b-dragging")&&r!==null&&r!==void 0&&r.isActionable&&(i.stopImmediatePropagation(),this._focusedCell=null,this.focusCell({rowIndex:r.rowIndex,column:r.column},{disableActionable:!0}))}onTab(i){const{target:r}=i,{focusedCell:n,bodyElement:s}=this,{isActionable:a,actionTargets:o}=n;if(a&&S.isEditable(r)&&!r.readOnly&&r===o[o.length-1])i.preventDefault(),this.navigateRight(i);else if(!a||r===o[o.length-1])return s.style.display="none",this.requestAnimationFrame(()=>s.style.display=""),!1}onShiftTab(i){const r=this,{target:n}=i,{focusedCell:s,bodyElement:a}=r,{cell:o,isActionable:l,actionTargets:d}=s,u=l&&S.isEditable(n)&&!n.readOnly,h=s.columnIndex===0&&s.rowIndex===(r.hideHeaders?0:-1);if(!h&&u&&n===d[0])i.preventDefault(),r.navigateLeft(i);else if(!l||n===d[0]){const f=!h&&!r.hideHeaders&&r.focusCell({rowIndex:-1,column:0},{disableActionable:!0});return f?(f.cell.tabIndex=-1,o.tabIndex=0,r._focusedCell=s):(a.style.display="none",r.requestAnimationFrame(()=>a.style.display="")),!1}}onSpace(i){return this.focusedCell.isActionable||i.preventDefault(),!1}get focusedCell(){return this._focusedCell}get isActionableLocation(){var i;return(i=this._focusedCell)===null||i===void 0?void 0:i.isActionable}set focusedCell(i){this.focusCell(i)}get focusedRecord(){var i;return(i=this._focusedCell)===null||i===void 0?void 0:i.record}get cellCSSSelector(){const i=this._focusedCell;return i?`[data-index=${i.rowIndex}] [data-column-id=${i.columnId}]`:""}afterHide(){super.afterHide(...arguments),this.lastFocusedCell=null}isFocused(i){var r;return Boolean((r=this._focusedCell)===null||r===void 0?void 0:r.equals(this.normalizeCellContext(i)))}get focusElement(){if(!this.isDestroying){let r;if(this.store.count&&this._focusedCell)r=this._focusedCell.target;else{var i;r=this.normalizeCellContext({rowIndex:-1,columnIndex:((i=this._focusedCell)===null||i===void 0?void 0:i.columnIndex)||0}).target}const n=super.focusElement;return n&&(!r||r.compareDocumentPosition(n)===Node.DOCUMENT_POSITION_PRECEDING)?n:r}}onPaint({firstPaint:i}){var r;const n=this;(r=super.onPaint)===null||r===void 0||r.call(this,...arguments);const s=this.normalizeCellContext({rowIndex:n.hideHeaders?0:-1,column:n.hideHeaders?0:n.columns.find(a=>!a.hidden&&a.isFocusable)});if(s.cell){n._focusedCell=s;const{target:a}=s;a===s.cell&&(s.cell.tabIndex=0)}}onGridBodyFocusIn(i){const r=this,{bodyElement:n}=r,s=r.focusedCell,a=s?.initialTarget||s?.target,{target:o,relatedTarget:l}=i,d=o.closest(r.focusableSelector);if(d&&(!ue.currentMouseDown||ue.isMouseDown(0)||ue.isMouseDown(2))){var u;const g=new ne(o),{cell:m}=g,p=s?.cell,v=g.actionTargets=r.findFocusables(d),y=(!r._fromFocusCell||r.selectOnFocus)&&(o===m||r._selectActionCell)&&!(o!=null&&o._isRevertingFocus);if(!r.store.getById(d.parentNode.dataset.id)&&m!==d){m.focus({preventScroll:!0});return}if(o.matches(r.focusableSelector)){if(r.disableActionable)g._target=m;else if(v.length){var h;r._selectActionCell=((h=ue.currentMouseDown)===null||h===void 0?void 0:h.target)===o,v[0].focus(),delete r._selectActionCell;return}}else{var f;if(s!=null&&s.target&&l&&(!ue.isMouseDown()||!n.contains((f=ue.currentMouseDown)===null||f===void 0?void 0:f.target))&&!n.contains(l)&&!g.equals(s)){a.focus();return}g._target=o}if(p&&(p.classList.remove("b-focused"),p.tabIndex=-1),m&&(m.classList.add("b-focused"),g.column.onCellFocus(g),m===o&&(m.tabIndex=0),m.contains(i.relatedTarget)&&a===o))return;r._focusedCell=g,(u=r.onCellNavigate)===null||u===void 0||u.call(r,r,s,g,y),r.trigger("navigate",{lastFocusedCell:s,focusedCell:g,event:i})}else a?.focus()}findFocusables(i){const{focusableFinder:r}=this,n=[];r.currentNode=this.focusableFinderCell=i;for(let s=r.nextNode();s;s=r.nextNode())n.push(s);return n}get focusableFinder(){const i=this;return i._focusableFinder||(i._focusableFinder=i.setupTreeWalker(i.bodyElement,S.NodeFilter.SHOW_ELEMENT,{acceptNode:U0.bind(i)})),i._focusableFinder}restoreActiveItem(i=this._focusedCell){if(this.rowManager.count)return isNaN(i)?i.isModel||(i=this.store.getById(i)):i=this.store.getAt(i),this.focusCell(i)}focusCell(i,r=j0){var n,s;const a=this,{_focusedCell:o}=a,{scroll:l,disableActionable:d}=r;if(((n=i)===null||n===void 0?void 0:n.rowIndex)===-1&&a.hideHeaders){a.revertFocus();return}i=typeof i=="number"&&o!==null&&o!==void 0&&o.isLocation?o.move(i):a.normalizeCellContext(i);const u="doSelect"in r?r.doSelect:!i.isActionable||i.initialTarget===i.cell;if(i.equals(o)){var h;return(h=a.onCellNavigate)===null||h===void 0||h.call(a,a,o,i,u),o}const f=a.getSubGridFromColumn(i.columnId),{cell:g}=i,m=g||a.getCell({rowIndex:a.rowManager.topIndex,columnId:i.columnId}),p=$.from(f.element),v=$.from(a.bodyElement),y=$.from(m).moveTo(null,p.y);return l===!1||i.rowIndex===-1?r=Object.assign({},r,W0):(r=Object.assign({},r,l),y.width>p.width||y.height>v.height?r.x=r.y=!1:r.column=i.columnId,a.scrollRowIntoView(i.id,r)),(a._hoveredRow||a._hoveredCell)&&a.setHovered(),a.disableActionable=d,a.selectOnFocus=u,a._fromFocusCell=!0,(s=i[d?"cell":"target"])===null||s===void 0||s.focus(),a.disableActionable=a.selectOnFocus=!1,delete a._fromFocusCell,i}blurCell(i){const r=this,n=r.getCell(i);n&&n.classList.remove("b-focused")}clearFocus(i){const r=this;r._focusedCell&&(r.lastFocusedCell=i?null:r._focusedCell,r.blurCell(r._focusedCell),r._focusedCell=null)}internalNextPrevCell(i=!0){const r=this,n=r._focusedCell;return n?r.focusCell({id:n.id,columnId:r.columns.getAdjacentVisibleLeafColumn(n.columnId,i,!0).id}):null}navigateRight(){var i;return(i=arguments[0])!==null&&i!==void 0&&i.fromKeyMap?this.focusCell(this.rtl?ne.PREV_CELL:ne.NEXT_CELL):(arguments[0]&&ae.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevCell(!this.rtl))}navigateLeft(){var i;return(i=arguments[0])!==null&&i!==void 0&&i.fromKeyMap?this.focusCell(this.rtl?ne.NEXT_CELL:ne.PREV_CELL):(arguments[0]&&ae.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevCell(Boolean(this.rtl)))}internalNextPrevRow(i,r=!0,n=!0){const s=this,a=s._focusedCell;if(!a)return!1;const o=s.store[`get${i?"Next":"Prev"}`](a.id,!1,r);if(o)return s.focusCell({id:o.id,columnId:a.columnId,scroll:{x:!1}});if(!i&&n&&!a.isColumnHeader)return this.clearFocus(),this.getHeaderElement(a.columnId).focus()}navigateDown(){var i;return(i=arguments[0])!==null&&i!==void 0&&i.fromKeyMap?this.focusCell(ne.DOWN):(arguments[0]&&ae.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevRow(!0,!1))}navigateUp(){var i;return(i=arguments[0])!==null&&i!==void 0&&i.fromKeyMap?this.focusCell(ne.UP):(arguments[0]&&ae.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevRow(!1,!1))}get widgetClass(){}},M(e,"configurable",{focusable:!1,focusableSelector:".b-grid-cell,.b-grid-header.b-depth-0",keyMap:{ArrowUp:{handler:"navigateUp",weight:10},ArrowRight:{handler:"navigateRight",weight:10},ArrowDown:{handler:"navigateDown",weight:10},ArrowLeft:{handler:"navigateLeft",weight:10},"Ctrl+Home":"navigateFirstCell",Home:"navigateFirstColumn","Ctrl+End":"navigateLastCell",End:"navigateLastColumn",PageUp:"navigatePrevPage",PageDown:"navigateNextPage",Enter:"activateHeader",Escape:{handler:"onEscape",weight:10},"Shift+Tab":{handler:"onShiftTab",preventDefault:!1},Tab:{handler:"onTab",preventDefault:!1}," ":{handler:"onSpace",preventDefault:!1}}}),e},G0=c=>class extends(c||P){static get $name(){return"GridResponsive"}static get defaultConfig(){return{responsiveLevels:Object.freeze({small:400,medium:600,large:"*"})}}getClosestBiggerLevel(t){const i=this,r=Object.keys(T.assign({},i.responsiveLevels));let n=null,s=99995,a=null;return r.forEach(o=>{let l=i.responsiveLevels[o];if(["number","string"].includes(typeof l)||(l=l.levelWidth),l==="*")a=o;else if(t<l){const d=l-t;d<s&&(s=d,n=o)}}),n||a}get responsiveLevel(){return this.getClosestBiggerLevel(this.width)}updateResponsive(t,i){const r=this,n=r.getClosestBiggerLevel(i),s=r.getClosestBiggerLevel(t);if(i===0||n!==s){const a=r.responsiveLevels[s];["number","string"].includes(typeof a)||r.applyState(a),r.columns.forEach(o=>{const l=o.responsiveLevels;l&&(l[s]?o.applyState(l[s]):l["*"]&&o.applyState(l["*"]))}),r.element.classList.remove("b-responsive-"+n),r.element.classList.add("b-responsive-"+s),r.trigger("responsive",{level:s,width:t,oldLevel:n,oldWidth:i})}}get widgetClass(){}};const q0={string:1,number:1},K0={dataset:1,batch:1};var X0=c=>{var e;return e=class extends(c||P){static get $name(){return"GridSelection"}construct(i){this._selectedCells=[],super.construct(i),i!=null&&i.selectedRecords&&(this.selectedRecords=i.selectedRecords)}getDefaultGridSelection(i){if(i.$name==="GridSelection")return i.configurable.selectionMode;if(i.superclass)return this.getDefaultGridSelection(i.superclass)}changeSelectionMode(i){const r=this;return r.selectionMode?(T.assign(r.selectionMode,i),r.selectionMode):(r.$defaultGridSelection=r.getDefaultGridSelection(r.constructor),new Proxy(i,{set(n,s,a){const o=T.assign({},n);return n[s]=a,r.updateSelectionMode(n,o),!0}}))}updateSelectionMode(i,r=this.$defaultGridSelection){const n=this,{columns:s,checkboxSelectionColumn:a}=n,o={},{rowReorder:l}=n.features;for(const h in i)i[h]!=r[h]&&(o[h]=i[h]);if(i.rowCheckboxSelection&&!i.checkboxOnly&&(i.checkboxOnly=!0,delete i.rowCheckboxSelection),o.column&&(i.cell=!0,i.multiSelect=!0),o.cell&&(i.checkboxOnly=!1),o.cell===!1&&(i.column=!1),o.checkboxOnly&&(i.checkbox||(i.checkbox=!0),i.cell=!1),o.checkbox===!1&&(o.checkboxOnly=!1,o.showCheckAll=!1),o.showCheckAll&&(i.checkbox=!0,i.multiSelect=!0),(o.includeChildren||o.includeParents)&&(i.multiSelect=!0),o.multiSelect===!1&&(i.column=i.showCheckAll=i.dragSelect=i.includeChildren=i.includeParents=!1),o.dragSelect&&(l!=null&&l.enabled&&l.gripOnly!==!0&&(l.showGrip=l.gripOnly=!0),i.multiSelect=!0,n._selectionListenersDetachers={}),o.dragSelect===!1&&n._selectionListenersDetachers){var d,u;(d=(u=n._selectionListenersDetachers).selectiondrag)===null||d===void 0||d.call(u),delete n._selectionListenersDetachers.selectiondrag}r&&(o.cell!==void 0||o.deselectFilteredOutRecords!==void 0||o.multiSelect!==void 0)&&n.deselectAll(),o.rowNumber?s.findRecord("type","rownumber")||(s.insert(0,F(F({},typeof i.rowNumber=="object"?i.rowNumber:{}),{},{type:"rownumber"})),n._selectionAddedRowNumberColumn=!0):o.rowNumber===!1&&n._selectionAddedRowNumberColumn&&(s.remove(s.findRecord("type","rownumber")),delete n._selectionAddedRowNumberColumn),(i.checkbox!==r?.checkbox||i.checkbox&&i.showCheckAll!==r?.showCheckAll)&&(r&&n.deselectAll(),n.isConfiguring?n.shouldInitCheckboxSelection=!0:n.initCheckboxSelection()),r&&i.checkbox&&r.checkbox&&i.checkboxIndex!==r.checkboxIndex&&a&&a.parent.insertChild(a,s.getAt(n.checkboxSelectionColumnInsertIndex)),n.trigger("selectionModeChange",T.clone(i)),n.afterSelectionModeChange(i)}afterConfigure(){this.shouldInitCheckboxSelection&&(this.shouldInitCheckboxSelection=!1,this.initCheckboxSelection()),super.afterConfigure()}initCheckboxSelection(){const i=this,{selectionMode:r,columns:n,checkboxSelectionColumn:s}=i,{checkbox:a}=r;if(s&&(i.checkboxSelectionColumn=null,n.remove(s)),a){var o,l;const d=be.getColumnClass("check"),u=a===!0?null:a;if(!d)throw new Error("CheckColumn must be imported for checkbox selection mode to work");const h=i.checkboxSelectionColumn=new d(T.assign({id:`${i.id}-selection-column`,width:"4em",minWidth:"4em",field:null,sortable:!1,filterable:!1,cellCls:"b-checkbox-selection",region:(o=i.items)===null||o===void 0||(l=o[0])===null||l===void 0?void 0:l.region,showCheckAll:r.showCheckAll,draggable:!1,resizable:!1,widgets:[{type:"checkbox",valueProperty:"checked",ariaLabel:"L{Checkbox.toggleRowSelect}"}]},u),n,{isSelectionColumn:!0});h.meta.depth=0,h._grid=i;const f=h.renderer;h.renderer=g=>{g.value=i.isSelected(g.record),f.call(h,g)},h.ion({toggle:"onCheckChange",toggleAll:"onCheckAllChange",thisObj:i}),n.insert(i.checkboxSelectionColumnInsertIndex,h)}}get checkboxSelectionColumnInsertIndex(){const{columns:i}=this;let{checkboxIndex:r}=this.selectionMode;return r?typeof r=="string"&&(r=i.indexOf(i.getById(r))):r=i.indexOf(i.findRecord("type","rownumber"))+1,r}afterSelectionChange(){}afterSelectionModeChange(){}changeSelectedRecordCollection(i){return i instanceof rt?i:new rt(i)}updateSelectedRecordCollection(i){i.ion({change:"onSelectedRecordCollectionChange",thisObj:this})}onSelectedRecordCollectionChange({added:i=[],removed:r}){this.selectedRecordCollection._fromSelection||(i=i.filter(n=>this.isSelectable(n)),this.performSelection({selectedCells:[],deselectedCells:[],selectedRecords:i,deselectedRecords:r}))}changeSelectedRecordCollectionSilent(i){this.selectedRecordCollection._fromSelection=!0;const r=i(this.selectedRecordCollection);return delete this.selectedRecordCollection._fromSelection,r}bindStore(i){var r;this.detachListeners("selectionStoreFilter"),i.ion({name:"selectionStoreFilter",filter:"onStoreFilter",thisObj:this}),(r=super.bindStore)===null||r===void 0||r.call(this,i)}unbindStore(i){this.detachListeners("selectionStoreFilter"),super.unbindStore(i)}onStoreFilter({source:i}){const r=this,n=[];for(const a of r.selectedRecords)i.includes(a)||n.push(a);const s=r.prepareSelection(r.selectionMode.deselectFilteredOutRecords?n:[]);if(r.isCellSelectionMode){const{deselectedCells:a}=r.prepareSelection(r.getSelectedCellsForRecords(n));a!=null&&a.length&&(s.deselectedCells=(s.deselectedCells||[]).concat(a))}(s.deselectedCells.length||s.deselectedRecords.length)&&(r.performSelection(s,!1),r.updateCheckboxHeader())}onStoreRecordIdChange({record:i,oldValue:r}){var n;(n=super.onStoreRecordIdChange)===null||n===void 0||n.call(this,...arguments),this.selectedRecordCollection.get(r)===i&&this.selectedRecordCollection.rebuildIndices()}onStoreRemove(i){var r;if((r=super.onStoreRemove)===null||r===void 0||r.call(this,i),!i.isCollapse){const n=this,s=i.records.filter(a=>this.isSelected(a));if(s.length){const a=n.prepareSelection(s);if(n.isCellSelectionMode){const{deselectedCells:o}=n.prepareSelection(n.getSelectedCellsForRecords(s));o!=null&&o.length&&(a.deselectedCells=(a.deselectedCells||[]).concat(o))}n.performSelection(a)}}}onStoreDataChange({action:i,source:r}){var n;const s=this,{selectionMode:a}=s;let o;if((n=super.onStoreDataChange)===null||n===void 0||n.call(this,...arguments),i==="pageLoad")a.preserveSelectionOnPageChange||(o=s.prepareSelection(null,null,!0)),s.updateCheckboxHeader();else if(K0[i]){const l=[];if(a.preserveSelectionOnDatasetChange===!1)o=s.prepareSelection(null,null,!0);else{l.push(...s.changeSelectedRecordCollectionSilent(d=>d.match(r.storage)));for(const d of s._selectedCells)r.getById(d.id)||l.push(d);o=s.prepareSelection(l)}}o&&(s.performSelection(o,!1),s.updateCheckboxHeader())}onStoreRemoveAll(){var i;(i=super.onStoreRemoveAll)===null||i===void 0||i.call(this),this.performSelection(this.prepareSelection(null,null,!0),!1)}onCheckChange({checked:i,record:r}){const n=this,s=!n.selectionMode.multiSelect&&i,a=!s&&!i?[r]:null,o=i?[r]:null;i&&!ue.shiftKeyDown&&(n._lastSelectionChecked=r),i&&n._lastSelectionChecked&&ue.shiftKeyDown?n.performSelection(n.internalSelectRange(n._lastSelectionChecked,r,!0)):n.performSelection(n.prepareSelection(a,o,s,!0))}updateCheckboxHeader(){const{selectionMode:i,checkboxSelectionColumn:r,store:n}=this;if(i.checkbox&&i.showCheckAll&&r!==null&&r!==void 0&&r.headerCheckbox){const s=n.count&&!n.some(a=>!this.isSelected(a));r.headerCheckbox.checked!==s&&(r.suspendEvents(),r.headerCheckbox.checked=s,r.resumeEvents())}}onCheckAllChange({checked:i}){this[i?"selectAll":"deselectAll"](this.store.isPaged&&this.selectionMode.preserveSelectionOnPageChange)}onSelectionDrag(i){const r=this,{_selectionStartCell:n}=r;if(ue.isMouseDown()||r.onSelectionEnd(),!n)return;const{items:s,_lastSelectionDragRegion:a}=r,o=r.getCellDataFromEvent(i,!0),l=o?.column.region,d=o?.cellSelector&&r.normalizeCellContext(o.cellSelector);if(d&&!d.equals(r._lastSelectionDragCell,!0)){if(r._isSelectionDragging||r.enableScrollingCloseToEdges(s),r._clearSelectionOnSelectionDrag&&!n.equals(d,!0)&&(r.deselectAll(),delete r._clearSelectionOnSelectionDrag),a&&l!==a){var u,h;const g=r.subGrids[a],m=r.subGrids[l],p=g.scrollable,v=m.scrollable,y=s.indexOf(g)-s.indexOf(m)<0;if(v.x=y?0:v.maxX,y?p.x<p.maxX-1:p.x>1)return;(u=r.scrollManager._activeScroll)===null||u===void 0||(h=u.horizontal)===null||h===void 0||h.stopScroll()}r._lastSelectionDragRegion=l,r._lastSelectionDragCell=d,r._isSelectionDragging=!0;const f=r._lastSelectionDragChange=r.internalSelectRange(n,d,r.isRowNumberSelecting(d)||r.isRowNumberSelecting(n));f.deselectedCells=f.deselectedCells.filter(g=>!r.isCellSelected(g)),f.deselectedRecords=f.deselectedRecords.filter(g=>!r.isSelected(g)),r.refreshGridSelectionUI(f),r.trigger("dragSelecting",f)}}onSelectionEnd(){var i,r;const n=this,s=n._lastSelectionDragChange;n._isSelectionDragging&&!n._selectionStartCell.equals(n._lastSelectionDragCell,!0)&&s&&n.performSelection(s,!1),n.disableScrollingCloseToEdges(n.items),n._isSelectionDragging=!1,n._lastSelectionDragChange=null,n._lastSelectionDragCell=null,(i=(r=n._selectionListenersDetachers).selectiondrag)===null||i===void 0||i.call(r),delete n._selectionListenersDetachers.selectiondrag}onHandleElementClick(i){const r=this;r.selectionMode.rowNumber&&i.target.closest(".b-rownumber-header")?(i.handled=!0,r.store.count&&r.store.some(n=>!r.isSelected(n))?r.selectAll():r.deselectAll()):r.selectionMode.column&&i.target.closest(".b-grid-header")&&(i.handled=!0,r.selectColumn(i,i.ctrlKey)),super.onHandleElementClick(i)}selectColumn(i,r=!1){const n=this,{store:s}=n,{columnId:a}=n.getHeaderDataFromEvent(i);n._shiftSelectRange=null,i.shiftKey||(n._shiftSelectColumn=a);const o=i.shiftKey&&n._shiftSelectColumn||a,l=n.internalSelectRange(n.normalizeCellContext({id:s.first.id,columnId:o}),n.normalizeCellContext({id:s.last.id,columnId:a}));r&&!l.selectedCells.some(d=>!n.isCellSelected(d))&&(l.deselectedCells=l.selectedCells,l.selectedCells=[]),r||(l.deselectedCells=n._selectedCells),n.cleanSelectionChange(l),n.performSelection(l)}isSelected(i){var r;return(r=i)!==null&&r!==void 0&&r.id&&(i=i.id),q0[typeof i]?Boolean(this.selectedRecordCollection.get(i)):!1}isCellSelected(i,r){return i=this.normalizeCellContext(i),this.isCellSelectionMode&&this._selectedCells.some(n=>i.equals(n,!0))||r&&this.isSelected(i)}isSelectable(i){return this.normalizeCellContext({id:i.id||i}).isSelectable}get selectedRecord(){return this.selectedRecords[this.selectedRecords.length-1]||null}set selectedRecord(i){this.selectRow({record:i})}get selectedRecords(){return this.selectedRecordCollection.values}set selectedRecords(i){this.selectRows(i)}spliceSelectedRecords(i,r,n){const s=this;if(typeof r=="number"){const a=[...s.selectedRecords];a.splice(i,r,...W.asArray(n)),s.performSelection(s.prepareSelection(null,a,!0,!0))}else s.performSelection(s.prepareSelection(r,n,!1,!0))}selectRow(i){(typeof i=="number"||i.isModel||!("record"in i))&&(i={records:[i]}),T.assignIf(i,{scrollIntoView:!0}),this.selectRows(i)}selectRows(i){(!i||Array.isArray(i)||i.isModel||typeof i=="number"||!("records"in i)&&!("record"in i))&&(i={records:W.asArray(i)||[]});const r=this,{store:n}=r,s=[],{records:a=i.record?[i.record]:[],column:o=r.columns.visibleColumns[0],scrollIntoView:l,addToSelection:d=arguments[1]}=i;for(let u of a)u=n.getById(u),u&&s.push(u);d||(r._shiftSelectRange=null),r.performSelection(r.prepareSelection(null,s,!d,!0)),s.length&&l&&r.scrollRowIntoView(s[0].id,{column:o})}selectAll(i=!1){const{store:r}=this,n=(r.isGrouped?r.allRecords:r.records).filter(s=>!s.isSpecialRow);this.performSelection(this.prepareSelection(null,n,!1,!0),!0,i)}deselectAll(i=!1,r=!1){const{store:n}=this,s=i?(n.isGrouped?n.allRecords:n.records).filter(a=>!a.isSpecialRow):null;this.performSelection(this.prepareSelection(s,null,!i),!0,r)}deselectRow(i){this.deselectRows(i)}deselectRows(i){const{store:r}=this,n=W.asArray(i).map(s=>r.getById(s)).filter(s=>s);this.performSelection(this.prepareSelection(n))}selectRange(i,r,n=!1){const s=this,{store:a}=s,o=s.internalSelectRange(a.getById(i),a.getById(r),!0);s._shiftSelectRange=null,s.performSelection(o)}get selectedCell(){return this._selectedCells[this._selectedCells.length-1]}set selectedCell(i){this.selectCells([i])}get selectedCells(){return[...this._selectedCells]}set selectedCells(i){this.selectCells(i)}get selectedCellCSSSelector(){const i=this.selectedCell,r=i&&this.getRowById(i.id);return!i||!r?"":`[data-index=${r.dataIndex}] [data-column-id=${i.columnId}]`}selectCell(i){var r;return"id"in i&&(i={cell:i},i=Object.assign({scrollIntoView:arguments[1],addToSelection:arguments[2],silent:arguments[3]},i)),(r=this.selectCells(i))===null||r===void 0?void 0:r[0]}selectCells(i){Array.isArray(i)&&(i={cells:i});const r=this,{cells:n=i.cell?[i.cell]:[],scrollIntoView:s=!0,addToSelection:a=!1,silent:o=!1}=i,l=r.prepareSelection(null,n,!a);return a||(r._shiftSelectRange=null),r.performSelection(l,!0,o),s&&r.scrollRowIntoView(n[0].id,{column:n[0].columnId}),r.isCellSelectionMode?l.selectedCells:l.selectedRecords}deselectCell(i){var r;return(r=this.deselectCells([i]))===null||r===void 0?void 0:r[0]}deselectCells(i){const r=this.prepareSelection(i);return this.performSelection(r),this.isCellSelectionMode?r.deselectedCells:r.deselectedRecords}toggleSelection(i){const r=this,{_focusedCell:n,selectionMode:s}=r,a=r.isRowNumberSelecting(n),o=r.isCellSelected(n,!0);if(s.selectOnKeyboardNavigation===!0||n.isActionable)return!1;r.performSelection(r.prepareSelection(o?n:null,o?null:n,!s.multiSelect,a)),i.preventDefault()}selectCellRange(i,r){this.performSelection(this.internalSelectRange(i,r))}getSelection(){return this.isRowSelectionMode?this.selectedRecords:this.selectedCells}cleanSelectionChange(i){const{deselectedRecords:r,selectedRecords:n,deselectedCells:s,selectedCells:a}=i;return r!=null&&r.length&&n!==null&&n!==void 0&&n.length&&(i.deselectedRecords=r.filter(o=>!n.some(l=>o===l))),s!=null&&s.length&&a!==null&&a!==void 0&&a.length&&(i.deselectedCells=s.filter(o=>!a.some(l=>o.equals(l,!0)))),i}getSelectedCellsForRecords(i){return this._selectedCells.filter(r=>r.id&&i.some(n=>n.id===r.id))}delayUntilMouseUp(i){const r=B.on({element:globalThis,blur:n=>i(n,r),mouseup:n=>i(n,r),thisObj:this,once:!0})}get isRowSelectionMode(){return!this.isCellSelectionMode}get isCellSelectionMode(){return this.selectionMode.cell===!0}isRowNumberSelecting(...i){return this.selectionMode.rowNumber&&!i.some(r=>r.column.type!=="rownumber")}extendSelectionLeft(){this.extendSelection("Left")}extendSelectionRight(){this.extendSelection("Right")}extendSelectionUp(){this.extendSelection("Up")}extendSelectionDown(){this.extendSelection("Down")}extendSelection(i){this._isKeyboardRangeSelecting=!0,this["navigate"+i](),this._isKeyboardRangeSelecting=!1}onCellNavigate(i,r,n,s){var a;const{selectionMode:o,_selectionListenersDetachers:l}=i,{rowReorder:d}=i.features,{multiSelect:u,deselectOnClick:h,dragSelect:f}=o,{ctrlKeyDown:g,shiftKeyDown:m}=ue,p=ue.isMouseDown(),v=ue.isMouseDown(2),y=ue.currentMouseDown||ue.currentKeyDown,C=y?.target;if(n=i.normalizeCellContext(n),!s||n.rowIndex===-1||(a=n.record)!==null&&a!==void 0&&a.isGroupHeader||y!=null&&y.fromKeyMap&&!o.selectOnKeyboardNavigation||i.columns.getById(n.columnId)===i.checkboxSelectionColumn||o.checkboxOnly||C&&d!==null&&d!==void 0&&d.gripOnly&&d.isElementDraggable(C,y)||y?.handled===!0)return;m||(i._isAddingToSelection=g&&u,i._selectionStartCell=n),u&&f&&p&&!l.selectiondrag&&(l.selectiondrag=B.on({name:"selectiondrag",element:globalThis,blur:"onSelectionEnd",mouseup:"onSelectionEnd",mousemove:"onSelectionDrag",thisObj:i}));const D=i._selectionStartCell,w=i._isAddingToSelection;if((m&&p||i._isKeyboardRangeSelecting)&&D&&u)i.performSelection(i.internalSelectRange(D,n,i.isRowNumberSelecting(D,n)));else{let E=!1,R=!0,x;if(i.isCellSelected(n,!0)){if(v)return;if(w||h)x=h?null:[n],R=!1;else if(i.selectedRecords.length+(i.isCellSelectionMode?i._selectedCells.length:0)<=1)return;E=h||u}!x&&!w&&(x=null,f&&E&&l.selectiondrag&&(i._clearSelectionOnSelectionDrag=!0));const k=(I,A)=>{var L;if(A?.(),(I==null||(L=I.target)===null||L===void 0?void 0:L.nodeType)===Node.ELEMENT_NODE){const O=new ne(I.target);if(O!=null&&O.grid&&!O.equals(n,!0))return}m||(i._shiftSelectRange=null),i.performSelection(i.prepareSelection(x,R&&[n],x===null,R&&i.isRowNumberSelecting(n)))};E?i.delayUntilMouseUp(k):k()}}prepareSelection(i,r,n=!1,s=!1){const a=this,o=a._isSelectionDragging,{includeParents:l}=a.selectionMode,d=[],u=[];let h=[],f=[];if(n)h=a._selectedCells,f=a.selectedRecords;else if(i)for(const p of W.asArray(i)){const v=a.normalizeCellContext(p),y=v?.record||(p.isModel?p:a.store.getById(v.id));if(!v.isSpecialRow&&(h.push(v),y&&!f.some(C=>C.id===y.id))){var g;if((o||a.isSelected(y))&&f.push(y),a.selectionMode.includeChildren&&a.selectionMode.multiSelect&&!y.isLeaf&&(g=y.allChildren)!==null&&g!==void 0&&g.length)for(const C of y.allChildren)!f.some(D=>D.id===C.id)&&(o||a.isSelected(C))&&f.push(C)}}if(r)for(const p of W.asArray(r)){const v=a.normalizeCellContext(p),y=v?.record||(p.isModel?p:a.store.getById(v.id));if(y&&!v.isSpecialRow&&(a.isCellSelectionMode&&!s&&u.push(v),(a.isRowSelectionMode||s)&&!d.some(C=>C.id===y.id))){var m;if(d.push(y),a.selectionMode.includeChildren&&a.selectionMode.multiSelect&&!y.isLeaf&&(m=y.allChildren)!==null&&m!==void 0&&m.length)for(const C of y.allChildren)d.some(D=>D.id===C.id)||d.push(C)}}if(l&&(f.length||d.length)){const p=[...f,...d];W.unique(p.filter(y=>y.parent&&!y.allChildren.some(C=>p.includes(C))).map(y=>y.parent)).forEach(y=>a.toggleParentSelection(y,d,f))}return a.cleanSelectionChange({selectedCells:u,selectedRecords:d,deselectedCells:h,deselectedRecords:f,deselectAll:n,action:d!=null&&d.length||u!=null&&u.length?"select":"deselect"})}toggleParentSelection(i,r,n){if(!i||i.isRoot)return;const s=this.isSelected(i),a=r.includes(i),o=n.includes(i),l=d=>this.isSelected(d)&&!n.includes(d)||r.includes(d);this.selectionMode.includeParents==="some"?i.allChildren.some(l)?(!s||o)&&!a&&r.push(i):s&&!o&&n.push(i):s?!o&&!a&&i.allChildren.some(d=>n.includes(d))&&n.push(i):a||i.allChildren.every(l)&&r.push(i),i.parent&&this.toggleParentSelection(i.parent,r,n)}internalSelectRange(i,r,n=!1){const s=this,a=s.isRowSelectionMode||n,o=s.prepareSelection(s._shiftSelectRange,s.getRange(i,r,a),!1,n);return s._shiftSelectRange=o[`selected${a?"Records":"Cells"}`],o}getRange(i,r,n=!1){const s=this,{store:a}=s,o=s.normalizeCellContext(i),l=s.normalizeCellContext(r),d=Math.min(o.rowIndex,l.rowIndex),u=Math.max(o.rowIndex,l.rowIndex),h=[],f=Math.min(o.columnIndex,l.columnIndex),g=Math.max(o.columnIndex,l.columnIndex);if(d===-1||u===-1)throw new Error("Record not found in selectRange");if(n){const m=a.getRange(d,u+1,!1);l.rowIndex<o.rowIndex&&m.reverse(),h.push(...m)}else for(let m=d;m<=u;m++)for(let p=f;p<=g;p++)h.push({rowIndex:m,columnIndex:p});return h.map(m=>s.normalizeCellContext(m))}performSelection(i,r=!0,n=!1){const s=this,{selectedRecords:a,selectedCells:o,deselectedRecords:l,deselectedCells:d,action:u}=i,h=s.isRowSelectionMode;if(s.trigger("beforeSelectionChange",{mode:h?"row":"cell",action:u,selected:(h?a:o)||[],deselected:(h?l:d)||[],selection:(h?s.selectedRecords:s.selectedCells)||[]})!==!1){if(s._selectedCells===d)s._selectedCells=[];else{const f=[];for(const g of s._selectedCells)d.some(m=>g.equals(m,!0))||f.push(g);s._selectedCells=f}if(i.deselectedRecords=[...i.deselectedRecords],l===s.selectedRecords)s.changeSelectedRecordCollectionSilent(f=>f.clear());else{const f=[];for(const g of s.selectedRecords)l.some(m=>g.id===m.id)||f.push(g);s.changeSelectedRecordCollectionSilent(g=>g.values=f)}if(o.length)for(const f of o)s._selectedCells.some(g=>g.equals(f,!0))||s._selectedCells.push(f);a.length&&s.changeSelectedRecordCollectionSilent(f=>f.add(...a)),r&&s.refreshGridSelectionUI(i),s.afterSelectionChange(i),n||s.triggerSelectionChangeEvent(i)}}refreshGridSelectionUI({selectedRecords:i,selectedCells:r,deselectedRecords:n,deselectedCells:s}){const a=this,{checkboxSelectionColumn:o}=a;o?.suspendEvents(),a.updateGridSelectionRecords(i,!0),a.updateGridSelectionRecords(n,!1),a.updateCheckboxHeader(),o?.resumeEvents(),a.isCellSelectionMode&&(a.updateGridSelectionCells(r,!0),a.selectionMode.column&&a.updateGridSelectionColumns(r)),a.updateGridSelectionCells(s,!1)}updateGridSelectionRecords(i,r){const{checkboxSelectionColumn:n}=this;if(i!=null&&i.length)for(let s=0;s<i.length;s++){const a=this.getRowFor(i[s]);a&&(a.toggleCls("b-selected",r),a.setAttribute("aria-selected",r),n&&!n.hidden&&!i[s].isSpecialRow&&(a.getCell(n.id).widget.checked=r))}}updateGridSelectionCells(i,r){if(i!=null&&i.length)for(let n=0;n<i.length;n++){const s=this.getCell(i[n]);s&&(s.setAttribute("aria-selected",r),s.classList.toggle("b-selected",r))}}updateGridSelectionColumns(i){const{count:r}=this.store;for(const s of this.columns.visibleColumns){var n;(n=s.element)===null||n===void 0||n.classList.toggle("b-selected",i?.filter(a=>a.columnId===s.id).length===r)}}triggerSelectionChangeEvent(i){const r=this.isRowSelectionMode;this.trigger("selectionChange",{mode:r?"row":"cell",action:i.action,selected:(r?i.selectedRecords:i.selectedCells)||[],deselected:(r?i.deselectedRecords:i.deselectedCells)||[],selection:(r?this.selectedRecords:this.selectedCells)||[]})}doDestroy(){var i;(i=this.selectedRecordCollection)===null||i===void 0||i.destroy(),this._selectedCells.length=0;for(const r in this._selectionListenersDetachers)this._selectionListenersDetachers[r]();super.doDestroy()}get widgetClass(){}},M(e,"configurable",{selectionMode:{cell:!1,multiSelect:!0,checkboxOnly:!1,checkbox:!1,checkboxPosition:null,showCheckAll:!1,deselectFilteredOutRecords:!1,includeChildren:!1,includeParents:!1,preserveSelectionOnPageChange:!1,preserveSelectionOnDatasetChange:!0,deselectOnClick:!1,dragSelect:!1,selectOnKeyboardNavigation:!0,column:!1,rowNumber:!1},keyMap:{"Shift+ArrowUp":"extendSelectionUp","Shift+ArrowDown":"extendSelectionDown","Shift+ArrowLeft":"extendSelectionLeft","Shift+ArrowRight":"extendSelectionRight"," ":{handler:"toggleSelection",weight:10}},selectedRecordCollection:{}}),e};const Z0=c=>c.columns.suspendEvents(),J0=c=>c.columns.resumeEvents(),Q0=c=>{c.columns.clearCaches(),c.columns.fillFromMaster()},bl=(c,e)=>c.stateSortIndex-e.stateSortIndex;var eS=c=>class extends(c||P){static get $name(){return"GridState"}static get configurable(){return{statefulEvents:["subGridCollapse","subGridExpand","horizontalScroll","stateChange"]}}updateStore(t,i){var r;(r=super.updateStore)===null||r===void 0||r.call(this,t,i),this.detachListeners("stateStoreListeners"),t?.ion({name:"stateStoreListeners",filter:"triggerUpdate",group:"triggerUpdate",sort:"triggerUpdate",thisObj:this})}updateColumns(t,i){var r;(r=super.updateColumns)===null||r===void 0||r.call(this,t,i),this.detachListeners("stateColumnListeners"),t.ion({name:"stateColumnListeners",change:"triggerUpdate",thisObj:this})}updateRowManager(t,i){var r;(r=super.updateRowManager)===null||r===void 0||r.call(this,t,i),this.detachListeners("stateRowManagerListeners"),t.ion({name:"stateRowManagerListeners",rowHeight:"triggerUpdate",thisObj:this})}triggerUpdate(){this.trigger("stateChange")}finalizeInit(){super.finalizeInit(),this.ion({selectionChange:"triggerUpdate",thisObj:this})}getState(){const t=this,i=t.element.style.cssText,r={rowHeight:t.rowHeight};if(i&&(r.style=i),t.selectedCell){const{id:n,columnId:s}=t.selectedCell;r.selectedCell={id:n,columnId:s}}return r.selectedRecords=t.selectedRecords.map(n=>n.id),r.columns=t.columns.allRecords.map(n=>n.getState()),r.store=t.store.state,r.scroll=t.storeScroll(),r.subGrids={},t.eachSubGrid(n=>{var s;const a=r.subGrids[n.region]=r.subGrids[n.region]||{};n.isPainted?n.flex==null&&(a.width=n.width):n.config.width!=null?a.width=n.config.width:a.flex=n.config.flex,a.collapsed=(s=n.collapsed)!==null&&s!==void 0?s:!1,a.collapsed&&(a._beforeCollapseState=n._beforeCollapseState)}),r}applyState(t){const i=this;if(i.suspendRefresh(),"columns"in t){let r=!1,n=!1;i.columns.suspendEvents(),i.eachSubGrid(Z0),t.columns.forEach((s,a)=>{const o=i.columns.getById(s.id);if(o){const l=o.generation;o.applyState(s),r=r||o.generation!==l,o.stateSortIndex=a,o.allIndex!==a&&(n=r=!0)}}),r&&i.eachSubGrid(Q0),n&&(i.eachSubGrid(s=>{s.columns.records.sort(bl),s.columns.allRecords.sort(bl)}),i.columns.sort({fn:bl,ascending:!0})),i.isPainted&&r&&i.renderContents(),i.columns.resumeEvents(),i.eachSubGrid(J0)}"subGrids"in t&&i.eachSubGrid(r=>{if(r.region in t.subGrids){const n=t.subGrids[r.region];"width"in n?r.width=n.width:"flex"in n&&(r.flex=n.flex),"collapsed"in n&&(r.collapsed=n.collapsed,r._beforeCollapseState=n._beforeCollapseState)}r.clearWidthCache()}),"rowHeight"in t&&(i.rowHeight=t.rowHeight),"style"in t&&(i.style=t.style),"selectedCell"in t&&(i.selectedCell=t.selectedCell),"store"in t&&(i.store.state=t.store),"selectedRecords"in t&&(i.selectedRecords=t.selectedRecords),i.resumeRefresh(!0),i.eachSubGrid(r=>r.refreshFakeScroll()),"scroll"in t&&(i.restoreScroll(t.scroll),t.scroll.scrollTop&&i.element.querySelectorAll(".b-resize-monitored").forEach(r=>{const n=Zi.fromElement(r);n&&n.onElementResize(r)}))}get widgetClass(){}};const Cl=Promise.resolve(),tS={block:"nearest"};class Rm extends Ke{static get configurable(){return{propagate:!1,overflowX:"hidden-scroll"}}scrollIntoView(e,t=tS){const i=this,{xDelta:r,yDelta:n}=i.getDeltaTo(e,t),s=r||n?i.scrollBy(r,n,t):Cl;return(t.highlight||t.focus)&&s.then(()=>{t.highlight&&(e instanceof $?e.translate(-r,-n).highlight():S.highlight(e)),t.focus&&e.focus&&e.focus()}),s}scrollBy(e,t,i){const r=t&&this.yScroller.scrollBy(0,t,i),n=e&&super.scrollBy(e,0,i);if(n&&n.cancel&&r&&r.cancel){const s=n.cancel,a=r.cancel;return n.cancel=r.cancel=()=>{s(),a()},Promise.all([n,r])}return n||r||Cl}scrollTo(e,t,i){const r=t!=null&&this.yScroller.scrollTo(null,t,i),n=e!=null&&super.scrollTo(e,null,i);if(i&&i.animate||this.syncPartners(),n&&n.cancel&&r&&r.cancel){const s=n.cancel,a=r.cancel;return n.cancel=r.cancel=()=>{s(),a()},Promise.all([n,r])}return n||r||Cl}get viewport(){const e=$.from(this.element);return e.intersect($.from(this.yScroller.element))||new $(e.x,e.y,e.width,0)}set y(e){this.yScroller&&(this.yScroller.y=e)}get y(){return this.yScroller?this.yScroller.y:0}get maxY(){return this.yScroller?this.yScroller.maxY:0}get scrollHeight(){return this.yScroller?this.yScroller.scrollHeight:0}get clientHeight(){return this.yScroller?this.yScroller.clientHeight:0}}Rm._$name="SubGridScroller";const iS=(c,e)=>c+e.getBoundingClientRect().width;class Mr extends N{static get $name(){return"SubGrid"}static get type(){return"subgrid"}static get defaultConfig(){return{insertRowsBefore:null,appendTo:null,monitorResize:!0,headerClass:null,footerClass:null,weight:null,collapsed:null,scrollable:{overflowX:"hidden-scroll"},scrollerClass:Rm,hasCalculatedWidth:null,sealedColumns:null}}static get configurable(){return{element:!0,header:{},footer:{},virtualScrollerElement:!0,splitterElement:!0,headerSplitter:!0,scrollerSplitter:!0,footerSplitter:!0,resizable:null,role:"presentation"}}construct(e){const t=this;if(super.construct(e),this.rowManager.ion({addRows:"onAddRow",thisObj:this}),K.isFirefox){const{element:i}=t,r=t.grid.scrollable;let n=0;i.addEventListener("wheel",({ctrlKey:s,deltaY:a,deltaX:o})=>{const l=Math.abs(a)>Math.abs(o);!s&&l&&!t.scrollEndDetacher&&r.y!==n&&(i.style.pointerEvents="none",n=r.y,t.scrollEndDetacher=r.ion({scrollEnd:async()=>{n=r.y,i.style.pointerEvents="",t.scrollEndDetacher=null},once:!0}))})}}doDestroy(){var e;const t=this;t.header.destroy(),t.footer.destroy(),(e=t.fakeScroller)===null||e===void 0||e.destroy(),t.virtualScrollerElement.remove(),t.splitterElements.forEach(i=>i.remove()),super.doDestroy()}get barConfig(){const e=this,{width:t,flex:i}=e.element.style,r={subGrid:e,parent:e,maxWidth:e.maxWidth||void 0,minWidth:e.minWidth||void 0};return i?r.flex=i:t&&(r.width=t),r}changeHeader(e){return new this.headerClass(T.assign({id:this.id+"-header"},this.barConfig,e))}changeFooter(e){return new this.footerClass(T.assign({id:this.id+"-footer"},this.barConfig,e))}get splitterElements(){return[this.splitterElement,this.headerSplitter,this.scrollerSplitter,this.footerSplitter]}toggleSplitterCls(e,t=!0){this.splitterElements.forEach(i=>i?.classList[t?"add":"remove"](e))}hideSplitter(){this.splitterElements.forEach(e=>e.classList.add("b-hide-display")),this.$showingSplitter=!1}showSplitter(){this.splitterElements.forEach(e=>e.classList.remove("b-hide-display")),this.$showingSplitter=!0}changeElement(e,t){const{region:i}=this;return super.changeElement({"aria-label":i,className:{"b-grid-subgrid":1,[`b-grid-subgrid-${i}`]:i,"b-grid-subgrid-collapsed":this.collapsed},dataset:{region:i}},t)}get rowElementConfig(){const{grid:e}=this;return{role:"row",className:e.rowCls,children:this.columns.visibleColumns.map((t,i)=>({role:"gridcell","aria-colindex":i+1,tabIndex:e.cellTabIndex,className:"b-grid-cell",dataset:{column:t.field||"",columnId:t.id}}))}}changeVirtualScrollerElement(){const e=S.createElement({role:"presentation",reference:"virtualScrollerElement",className:"b-virtual-scroller",tabIndex:-1,dataset:{region:this.region},children:[{reference:"virtualScrollerWidth",className:"b-virtual-width"}]});return this.virtualScrollerWidth=e.virtualScrollerWidth,e.virtualScrollerElement}changeSplitterElement(){const e=S.createElement({reference:"splitterElement",className:{"b-grid-splitter":1,"b-grid-splitter-collapsed":this.collapsed,"b-hide-display":1},dataset:{region:this.region},children:[K.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner b-grid-splitter-main",children:[{className:"b-grid-splitter-buttons",reference:"splitterButtons",children:[{className:"b-grid-splitter-button-collapse",children:[K.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-collapse-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M192 448c-8.188 0-16.38-3.125-22.62-9.375l-160-160c-12.5-12.5-12.5-32.75 0-45.25l160-160c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l137.4 137.4c12.5 12.5 12.5 32.75 0 45.25C208.4 444.9 200.2 448 192 448z"}]}]},{className:"b-grid-splitter-button-expand",children:[K.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-expand-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M64 448c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L178.8 256L41.38 118.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l160 160c12.5 12.5 12.5 32.75 0 45.25l-160 160C80.38 444.9 72.19 448 64 448z"}]}]}]}]}]});return this.splitterButtons=e.splitterButtons,e.splitterElement}get splitterConfig(){return{className:this.splitterElement.className.trim(),children:[K.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner"}],dataset:{region:this.region}}}changeHeaderSplitter(){return S.createElement(this.splitterConfig)}changeScrollerSplitter(){return S.createElement(this.splitterConfig)}changeFooterSplitter(){return S.createElement(this.splitterConfig)}render(...e){const t=this;super.render(...e),t.grid&&(t.updateHasFlex(),t.element.parentNode.insertBefore(t.splitterElement,t.element.nextElementSibling),t.splitterElements.forEach(i=>B.on({element:i,mouseenter:"onSplitterMouseEnter",mouseleave:"onSplitterMouseLeave",thisObj:t})),t._collapsed&&t.collapse())}refreshHeader(){this.header.refreshContent()}refreshFooter(){var e;(e=this.footer)===null||e===void 0||e.refreshContent()}eachWidget(e,t=!0){const i=this,r=[i.header,i.footer];for(let n=0;n<r.length;n++){const s=r[n];if(e(s)===!1)return;t&&s.eachWidget&&s.eachWidget(e,t)}}fixCellWidths(e){const{visibleColumns:t}=this.columns;let i=e.firstElementChild,r=0;for(;i;){const n=t[r],{element:s}=n;n.minWidth&&(i.style.minWidth=S.setLength(n.minWidth)),n.maxWidth&&(i.style.maxWidth=S.setLength(n.maxWidth)),n.flex?n.childLevel&&s?(i.style.flex=`0 0 ${s.getBoundingClientRect().width}px`,i.style.width=""):(i.style.flex=n.flex,i.style.width=""):n.width?i.style.width=S.setLength(n.width):i.style.flex=i.style.width=i.style.minWidth="",i=i.nextElementSibling,r++}}get totalFixedWidth(){return this.columns.totalFixedWidth}fixWidths(){const e=this,{element:t,header:i,footer:r}=e;if(!e.collapsed){if(e.flex)i.flex=e.flex,r&&(r.flex=e.flex),t.style.flex=e.flex;else{if(e.hasCalculatedWidth&&!e.columns.some(s=>!s.hidden&&s.flex)&&e.totalFixedWidth!==e.width){e.width=e.totalFixedWidth,e.hasCalculatedWidth=!0;return}let n=e.width;if(!n&&e.hasCalculatedWidth){n=0;for(const s of e.columns)!s.flex&&!s.hidden&&(n+=s.width)}t.style.width=`${n}px`,i.width=n,r&&(r.width=n)}e.syncScrollingPartners(!1)}}fixRowWidthsInSafariEdge(){if(K.isSafari){const e=this,{region:t,header:i}=e,r=i.calculateMinWidthForSafari();e.rowManager.forEach(n=>{const s=n.getElement(t);s&&(s.style.width=`${r}px`)}),i.headersElement.style.width=`${r}px`}}set width(e){const t=this;t.hasCalculatedWidth=!1,super.width=e,t.header.width=e,t.footer.width=e,t.isPainted&&t.onElementResize()}get width(){return super.width}set flex(e){const t=this;t.hasCalculatedWidth=!1,t.header.flex=e,t.footer.flex=e,super.flex=e,t.isPainted&&t.onElementResize()}get flex(){return super.flex}onInternalResize(e,t,i,r,n){const s=this,{grid:a}=s;super.onInternalResize(...arguments),a!=null&&a.isPainted&&(s.syncSplitterButtonPosition(),t!==r&&(a.trigger("horizontalScroll",{grid:a,subGrid:s,scrollLeft:s.scrollable.element.scrollLeft,scrollX:s.scrollable.x}),s.fakeScroller&&s.refreshFakeScroll(),a.syncFlexedSubCols(),s.fixRowWidthsInSafariEdge()),i!==n&&a.onHeightChange(),s.trigger("afterInternalResize",s))}syncParallelSplitters(e){const t=this,{grid:i}=t;if(t.splitterElement&&t.$showingSplitter)t.toggleSplitterCls("b-grid-splitter-collapsed",e);else{const r=i.getSubGrid(i.getPreviousRegion(t.region));r&&r.splitterElement&&r.syncParallelSplitters(e)}}onSplitterMouseEnter(){const e=this,{nextSibling:t}=e;!e.collapsed&&(!t||!t.collapsed)&&e.toggleSplitterCls("b-hover"),e.startSplitterButtonSyncing()}onSplitterMouseLeave(){const e=this,{nextSibling:t}=e;e.toggleSplitterCls("b-hover",!1),!e.collapsed&&(!t||!t.collapsed)&&e.stopSplitterButtonSyncing()}startSplitterButtonSyncing(){const e=this;e.splitterElement&&(e.syncSplitterButtonPosition(),e.splitterSyncScrollListener||(e.splitterSyncScrollListener=e.grid.scrollable.ion({scroll:"syncSplitterButtonPosition",thisObj:e})))}stopSplitterButtonSyncing(){this.splitterSyncScrollListener&&(this.splitterSyncScrollListener(),this.splitterSyncScrollListener=null)}syncSplitterButtonPosition(){const{grid:e}=this;this.splitterButtons.style.top=`${e.scrollable.y+(e.bodyHeight-(this.headerSplitter?e.headerHeight:0))/2}px`}get viewRectangle(){const{scrollable:e}=this;return new $(e.x,e.y,this.width||0,this.rowManager.viewHeight)}updateHasFlex(){this.scrollable.element.classList.toggle("b-has-flex",this.columns.hasFlex)}updateResizable(e){this.splitterElements.forEach(t=>S.toggleClasses(t,["b-disabled"],!e))}resizeColumnsToFitContent(){this.grid.beginGridMeasuring(),this.columns.visibleColumns.forEach(e=>{e.resizeToFitContent(null,null,!0)}),this.grid.endGridMeasuring()}get overflowingHorizontally(){return!this.collapsed&&this.scrollable.hasOverflow("x")}get overflowingVertically(){return!1}refreshFakeScroll(){const e=this,{element:t,virtualScrollerElement:i,virtualScrollerWidth:r,header:n,footer:s,scrollable:a}=e,o=[...n.contentElement.children].reduce(iS,0);a.scrollWidth=o,i.style.width=t.style.width,i.style.flex=t.style.flex,i.style.minWidth=t.style.minWidth,i.style.maxWidth=t.style.maxWidth,n.scrollable.syncOverflowState(),s.scrollable.syncOverflowState(),e.collapsed||(e.overflowingHorizontally?(r.style.width=`${a.scrollWidth||0}px`,e.grid.virtualScrollers.classList.remove("b-hide-display")):r.style.width=0)}initScroll(){const e=this,{scrollable:t,virtualScrollerElement:i}=e;e.syncPartnersOnFrame=e.createOnFrame(e.syncScrollingPartners),K.isFirefox&&t.element.addEventListener("wheel",r=>{r.deltaX&&(t.x+=r.deltaX,r.preventDefault())}),t.yScroller=e.grid.scrollable,t.yScroller.addScroller(t),e.fakeScroller=new Ke({element:i,overflowX:!0,widget:e}),t.ion({scroll:"onSubGridScroll",scrollend:"onSubGridScrollEnd",thisObj:e}),t.addPartner(e.fakeScroller,"x"),t.addPartner(e.header.scrollable,"x"),t.addPartner(e.footer.scrollable,"x"),e.refreshFakeScroll()}onSubGridScrollEnd(){const e=this;e.forceScrollUpdate||e.syncScrollingPartners(),e.scrolling=!1,S.scrollBarWidth||(e.grid.virtualScrollers.classList.remove("b-scrolling"),e.hideOverlayScroller())}onSubGridScroll(){this.forceScrollUpdate?(this.syncScrollingPartners(),this.forceScrollUpdate=!1):this.syncPartnersOnFrame()}showOverlayScroller(){this.hideOverlayScroller.cancel(),this.virtualScrollerElement.classList.add("b-show-virtual-scroller")}hideOverlayScroller(){this.virtualScrollerElement.classList.remove("b-show-virtual-scroller")}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}syncScrollingPartners(e=!0){const t=this,{grid:i}=t;!t.scrolling&&e&&(t.scrolling=!0,S.scrollBarWidth||(i.virtualScrollers.classList.add("b-scrolling"),t.showOverlayScroller())),i.trigger("horizontalScroll",{subGrid:t,grid:i,scrollLeft:t.scrollable.element.scrollLeft,scrollX:t.scrollable.x})}scrollColumnIntoView(e,t){const{columns:i,header:r}=this,n=r.scrollable;if(e=e instanceof ge?e:i.get(e)||i.getById(e)||i.getAt(e),e){const s=r.getHeader(e.id);if(s)return n.scrollIntoView($.from(s,null,!0),t)}}onAddRow({rows:e,isExport:t}){const i=this,r=i.rowElementConfig,n=document.createDocumentFragment();e.forEach(s=>{const a=S.createElement(r);n.appendChild(a),s.addElement(i.region,a),i.fixCellWidths(a)}),t||(i.fixRowWidthsInSafariEdge(),i.element.insertBefore(n,i.insertRowsBefore))}get rowElements(){return this.fromCache(".b-grid-row",!0)}clearRows(){this.emptyCache();const e=this.element.querySelectorAll(".b-grid-row"),t=document.createRange();e.length&&(t.setStartBefore(e[0]),t.setEndAfter(e[e.length-1]),t.deleteContents())}addNewRowElement(){const e=S.append(this.element,this.rowElementConfig);return this.fixCellWidths(e),e}get store(){return this.grid.store}get rowManager(){var e;return(e=this.grid)===null||e===void 0?void 0:e.rowManager}toggleTransitionClasses(e=!1){const t=this,i=t.grid,r=i.getSubGrid(i.getNextRegion(t.region)),n=i.resolveSplitter(r);r.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),r.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),t.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),t.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),n.classList[e?"remove":"add"]("b-grid-splitter-animate")}get collapsed(){return this._collapsed}set collapsed(e){this.isConfiguring?this._collapsed=e:e?this.collapse():this.expand()}async collapse(){const e=this,{grid:t,element:i}=e,r=t.getSubGrid(t.getNextRegion(e.region)),n=e.splitterElement?e:e.previousSibling;let{_beforeCollapseState:s}=e,a=0;if(!(t.rendered&&e._collapsed===!0))return t.eachSubGrid(o=>{o!==e&&!o._collapsed&&++a}),a===0&&await r.expand(),new Promise(o=>{if(s)o();else{s=e._beforeCollapseState={};let l=!1;e.width&&(l=!0,e.ion({afterinternalresize:()=>{o(e)},thisObj:e,once:!0})),s.width=e.width,s.elementWidth=i.style.width,r.element.style.flex===""&&(s.nextRegionWidth=r.width,r.width="",r.flex="1"),i.style.flex!==""&&(s.flex=i.style.flex,e.header.element.style.flex=i.style.flex=""),i.classList.add("b-grid-subgrid-collapsed"),e.virtualScrollerElement.classList.add("b-collapsed"),e.header.element.classList.add("b-collapsed"),e.footer.element.classList.add("b-collapsed"),e._collapsed=!0,e.width="",l||(e.syncParallelSplitters(!0),o(!1))}}).then(o=>{if(!e.isDestroyed){if(o!==!1){var l;t.refreshVirtualScrollbars(),e.syncParallelSplitters(!0),(l=n.startSplitterButtonSyncing)===null||l===void 0||l.call(n)}t.trigger("subGridCollapse",{subGrid:e}),t.afterToggleSubGrid({subGrid:e,collapsed:!0})}})}async expand(){const e=this,{grid:t,_beforeCollapseState:i}=e,r=t.getSubGrid(t.getNextRegion(e.region)),n=e.splitterElement?e:e.previousSibling;if(!(t.rendered&&e._collapsed!==!0))return new Promise(s=>{if(i!=null){let a=!1;e.width!==i.elementWidth&&(a=!0,e.ion({afterinternalresize(){e.setTimeout(()=>s(e),10)},thisObj:e,once:!0})),i.nextRegionWidth&&(r.width=i.nextRegionWidth,r.flex=null),e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,e.virtualScrollerElement.classList.remove("b-collapsed"),e.header.element.classList.remove("b-collapsed"),e.footer.element.classList.remove("b-collapsed"),i.flex?(e.width=i.width,e.header.flex=e.flex=i.flex,e.footer.flex=i.flex,e._width=null):e.width=i.elementWidth,e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,a?(n.stopSplitterButtonSyncing(),e.syncParallelSplitters(!1)):s(!1),delete e._beforeCollapseState}else s()}).then(s=>{s!==!1&&!e.isDestroyed&&(t.trigger("subGridExpand",{subGrid:e}),t.afterToggleSubGrid({subGrid:e,collapsed:!1}))})}}M(Mr,"delayable",{hideOverlayScroller:1e3});Mr.initClass();Mr._$name="SubGrid";var rS=c=>class extends(c||P){static get $name(){return"GridSubGrids"}static get properties(){return{subGrids:{}}}changeSubGridConfigs(t){const i=this,r=new Set;for(const n of i.columns){const{region:s}=n;s&&(t[s]||(t[s]={}),r.add(s))}t.normal&&T.isEmpty(t.normal)&&(t.normal=rs.defaultConfig.subGridConfigs.normal);for(const n of r)i.createSubGrid(n,t[n]);return i.items=i.subGrids,t}createSubGrid(t,i=null){const r=this,n=r.columns.makeChained(l=>l.region===t,["region"]),s=T.assign({type:"subgrid",id:`${r.id}-${t}Subgrid`,parent:r,grid:r,region:t,headerClass:r.headerClass,footerClass:r.footerClass,columns:n,weight:t},i||r.subGridConfigs[t]);let a=!1;!s.flex&&!s.width&&(s.width=n.totalFixedWidth,a=!0);const o=r.subGrids[t]=Mr.create(s);return o.hasCalculatedWidth=a,t===r.regions[0]&&(o.isFirstRegion=!0),o}onChildAdd(t){if(t.isSubGrid){const i=this,{items:r,headerContainer:n,virtualScrollers:s,footerContainer:a}=i,o=r.indexOf(t)*2;i.hideHeaders||(S.insertAt(n,t.headerSplitter,o),S.insertAt(n,t.header.element,o)),S.insertAt(s,t.scrollerSplitter,o),S.insertAt(s,t.virtualScrollerElement,o),S.insertAt(a,t.footerSplitter,o),S.insertAt(a,t.footer.element,o),r.forEach((l,d)=>{d<r.length-1&&l.showSplitter()}),o===0&&i.emptyTextEl&&t.element.appendChild(i.emptyTextEl)}return super.onChildAdd(t)}onChildRemove(t){if(super.onChildRemove(t),t.isSubGrid){const{items:i}=this;delete this.subGrids[t.region],W.remove(this.regions,t.region),t.destroy(),i.length&&i[i.length-1].hideSplitter()}}doDestroy(){this.eachSubGrid(t=>t.destroy()),super.doDestroy()}eachSubGrid(t,i=null){this.items.forEach((r,n)=>{r.isSubGrid&&t.call(i||r,r,n++)})}callEachSubGrid(t,...i){let r=null;return this.items.forEach((n,s)=>{if(n.isSubGrid&&n[t]){const a=n[t](...i);s===0&&(r=a)}}),r}get regions(){return this.items.map(t=>t.region)}getLastRegions(){const t=this.regions.slice(-2);return t.length===2?t:[t[0],t[0]]}getNextRegion(t){const i=this.regions;return i[i.indexOf(t)+1]||i[i.length-2]}getPreviousRegion(t){return this.regions[this.regions.indexOf(t)-1]}getSubGrid(t){return this.subGrids[t]}getSubGridFromColumn(t){return t=t instanceof ge?t:this.columns.getById(t)||this.columns.get(t),this.getSubGrid(t.region)}resolveSplitter(t){const i=this.getLastRegions();let r=t instanceof Mr?t.region:t;return i[1]===r&&(r=i[0]),this.subGrids[r].splitterElement}get widgetClass(){}};const nS=new String,sS={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",ColumnPicker:{column:"Column",columnsMenu:"Columns",hideColumn:"Hide column",hideColumnShort:"Hide",newColumns:"New columns"},Filter:{applyFilter:"Apply filter",filter:"Filter",editFilter:"Edit filter",on:"On",before:"Before",after:"After",equals:"Equals",lessThan:"Less than",moreThan:"More than",removeFilter:"Remove filter",disableFilter:"Disable filter"},FilterBar:{enableFilterBar:"Show filter bar",disableFilterBar:"Hide filter bar"},Group:{group:"Group",groupAscending:"Group ascending",groupDescending:"Group descending",groupAscendingShort:"Ascending",groupDescendingShort:"Descending",stopGrouping:"Stop grouping",stopGroupingShort:"Stop"},HeaderMenu:{moveBefore:c=>`Move before "${c}"`,moveAfter:c=>`Move after "${c}"`,collapseColumn:"Collapse column",expandColumn:"Expand column"},ColumnRename:{rename:"Rename"},MergeCells:{mergeCells:"Merge cells",menuTooltip:"Merge cells with same value when sorted by this column"},Search:{searchForValue:"Search for value"},Sort:{sort:"Sort",sortAscending:"Sort ascending",sortDescending:"Sort descending",multiSort:"Multi sort",removeSorter:"Remove sorter",addSortAscending:"Add ascending sorter",addSortDescending:"Add descending sorter",toggleSortAscending:"Change to ascending",toggleSortDescending:"Change to descending",sortAscendingShort:"Ascending",sortDescendingShort:"Descending",removeSorterShort:"Remove",addSortAscendingShort:"+ Ascending",addSortDescendingShort:"+ Descending"},Column:{columnLabel:c=>`${c.text?`${c.text} column. `:""}SPACE for context menu${c.sortable?", ENTER to sort":""}`,cellLabel:nS},Checkbox:{toggleRowSelect:"Toggle row selection",toggleSelection:"Toggle selection of entire dataset"},RatingColumn:{cellLabel:c=>{var e;return`${c.text?c.text:""} ${(e=c.location)!==null&&e!==void 0&&e.record?`rating : ${c.location.record[c.field]||0}`:""}`}},GridBase:{loadFailedMessage:"Data loading failed!",syncFailedMessage:"Data synchronization failed!",unspecifiedFailure:"Unspecified failure",networkFailure:"Network error",parseFailure:"Failed to parse server response",serverResponse:"Server response:",noRows:"No records to display",moveColumnLeft:"Move to left section",moveColumnRight:"Move to right section",moveColumnTo:c=>`Move column to ${c}`},CellMenu:{removeRow:"Delete"},RowCopyPaste:{copyRecord:"Copy",cutRecord:"Cut",pasteRecord:"Paste",rows:"rows",row:"row"},CellCopyPaste:{copy:"Copy",cut:"Cut",paste:"Paste"},PdfExport:{"Waiting for response from server":"Waiting for response from server...","Export failed":"Export failed","Server error":"Server error","Generating pages":"Generating pages...","Click to abort":"Cancel"},ExportDialog:{width:"40em",labelWidth:"12em",exportSettings:"Export settings",export:"Export",exporterType:"Control pagination",cancel:"Cancel",fileFormat:"File format",rows:"Rows",alignRows:"Align rows",columns:"Columns",paperFormat:"Paper format",orientation:"Orientation",repeatHeader:"Repeat header"},ExportRowsCombo:{all:"All rows",visible:"Visible rows"},ExportOrientationCombo:{portrait:"Portrait",landscape:"Landscape"},SinglePageExporter:{singlepage:"Single page"},MultiPageExporter:{multipage:"Multiple pages",exportingPage:({currentPage:c,totalPages:e})=>`Exporting page ${c}/${e}`},MultiPageVerticalExporter:{multipagevertical:"Multiple pages (vertical)",exportingPage:({currentPage:c,totalPages:e})=>`Exporting page ${c}/${e}`},RowExpander:{loading:"Loading",expand:"Expand",collapse:"Collapse"}};Be.publishLocale(sS);const Vh=new Promise(c=>c()),wl="GridBase:store",aS={block:"nearest",inline:"nearest"},oS={dataset:1,pageLoad:1,filter:1};class rs extends Ye.mixin(tg,ka,B0,V0,Y0,G0,X0,eS,rS,Vg){static get $name(){return"GridBase"}static get type(){return"gridbase"}static get delayable(){return{onGridVerticalScroll:{type:"raf"},bufferedAfterColumnsResized:250,bufferedElementResize:250}}static get configurable(){return{autoHeight:null,enableSticky:null,enableTextSelection:null,fillLastColumn:!0,positionMode:"translate",showDirty:null,subGridConfigs:{normal:{flex:1}},store:{value:{},$config:"nullify"},rowManager:{value:{},$config:["nullify","lazy"]},scrollManager:{value:{},$config:["nullify","lazy"]},columns:{value:[],$config:"nullify"},minHeight:"10em",hideFooters:!0,contentElMutationObserver:!1,trapFocus:!1,ariaElement:"bodyElement",cellTabIndex:-1,rowCls:{value:"b-grid-row",$config:{merge:this.mergeCls}},cellCls:{value:"b-grid-cell",$config:{merge:this.mergeCls}},emptyText:"L{noRows}",sortFeatureStore:"store"}}static get defaultConfig(){return{rowHeight:null,fixedRowHeight:null,defaultRowHeight:45,fullRowRefresh:!0,hideHeaders:null,preserveScrollOnDatasetChange:null,preserveFocusOnDatasetChange:!0,data:null,defaultRegion:"normal",destroyStore:null,maskDefaults:{cover:"body",target:"element"},columnLines:!0,resizeToFitIncludesHeader:!0,animateRemovingRows:!0,disableGridRowModelWarning:null,headerClass:ro,footerClass:Cd,testPerformance:!1,rowScrollMode:"move",monitorResize:!0,features:!0,scrollable:{overflowY:!0},scrollerClass:xm,refreshSuspended:0,transitionDuration:500,contextMenuTriggerEvent:"contextmenu",localizableProperties:["emptyText"],asyncEventSuffix:"",testConfig:{transitionDuration:50}}}static get properties(){return{_selectedRecords:[],_verticalScrollHeight:0,virtualScrollHeight:0,_scrollTop:null}}finishConfigure(e){const t=this,{initScroll:i}=t;t.initScroll=()=>!t.scrollInitialized&&i.call(t),super.finishConfigure(e),He.ion({locale:"onBeforeLocaleChange",prio:1,thisObj:t}),He.ion({locale:"onLocaleChange",prio:-1,thisObj:t}),ue.ion({theme:"onThemeChange",thisObj:t}),t.ion({subGridExpand:"onSubGridExpand",prio:-1,thisObj:t}),t.bufferedFixElementHeights=t.buffer("fixElementHeights",350,t),t.setGridClassList(t.element.classList)}onSubGridExpand(){this.renderContents()}onBeforeLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!0}onLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!1,this.isPainted&&this.renderContents()}finalizeInit(){super.finalizeInit(),this.store.isLoading&&this.onStoreBeforeRequest()}changeScrollManager(e,t){return t?.destroy(),e?Pa.new({element:this.element,owner:this},e):null}doDestroy(){var e;const t=this;t.detachListeners(wl),(e=t.scrollManager)===null||e===void 0||e.destroy();for(const r of Object.values(t.features)){var i;(i=r.destroy)===null||i===void 0||i.call(r)}t._focusedCell=null,t.columns.destroy(),super.doDestroy()}setGridClassList(e){Object.values(this.features).forEach(i=>{if(i.disabled)return;let r;Object.prototype.hasOwnProperty.call(i.constructor,"featureClass")?r=i.constructor.featureClass:r=`b-${i instanceof P?i.$$name:i.constructor.name}`,r&&e.add(r.toLowerCase())})}compose(){const{autoHeight:e,enableSticky:t,enableTextSelection:i,fillLastColumn:r,positionMode:n,showDirty:s}=this;return{class:{[`b-grid-${n}`]:1,"b-enable-sticky":t,"b-grid-notextselection":!i,"b-autoheight":e,"b-fill-last-column":r,"b-show-dirty":s}}}get cellCls(){const{_cellCls:e}=this;return e.value||e}get bodyConfig(){const{autoHeight:e,hideFooters:t,hideHeaders:i}=this;return{reference:"bodyElement",className:{"b-autoheight":e,"b-grid-panel-body":1},[this.hasHeader?"ariaLabelledBy":""]:`${this.id}-panel-title`,children:{headerContainer:{tag:"header",role:"row","aria-rowindex":1,className:{"b-grid-header-container":1,"b-hidden":i}},bodyContainer:{className:"b-grid-body-container",tabIndex:-1,role:"presentation",children:{verticalScroller:{className:"b-grid-vertical-scroller"}}},virtualScrollers:{className:"b-virtual-scrollers b-hide-display",style:K.isFirefox&&S.scrollBarWidth?{height:`${S.scrollBarWidth}px`}:void 0},footerContainer:{tag:"footer",className:{"b-grid-footer-container":1,"b-hidden":t}}}}}get contentElement(){return this.verticalScroller}get overflowElement(){return this.bodyContainer}updateHideFooters(e){var t;(t=this.footerContainer)===null||t===void 0||t.classList[e?"add":"remove"]("b-hidden")}changeColumns(e,t){const i=this;if(!e&&t)return i.isDestroying?t.owner===i&&t.destroy():t.removeAll(),t;if(e.isStore)return t?.owner===i&&t.destroy(),e.grid=i,e;if(Array.isArray(e)){if(t){i._suspendRenderContentsOnColumnsChanged=!0;const r=t.allRecords.filter(n=>!e.includes(n)&&n!==i.checkboxSelectionColumn);return t.remove(t.allRecords,!0),r.forEach(n=>{var s;return(s=n.destroy)===null||s===void 0?void 0:s.call(n)}),t.data=e,i._suspendRenderContentsOnColumnsChanged=!1,t}e={data:e}}if(t)throw new Error("Replacing ColumnStore is not supported");return be.new({grid:i,owner:i},e)}updateColumns(e,t){var i,r;const n=this;(i=super.updateColumns)===null||i===void 0||i.call(this,e,t),e.ion({refresh:n.onColumnsChanged,change:n.onColumnsChanged,sort:n.onColumnsChanged,thisObj:n}),e.ion(F0(n.onColumnsResized,n)),K.isTouchDevice&&(n.touch=!0,e.forEach(s=>{const{touchConfig:a}=s;a&&s.applyState(a)})),(r=n.bodyElement)===null||r===void 0||r.setAttribute("aria-colcount",e.visibleColumns.length)}onColumnsChanged({type:e,action:t,changes:i,record:r,records:n,isMove:s}){const a=i&&Object.keys(i).length===1;if(e==="refresh"&&t!=="batch"||t==="update"&&a&&"parentIndex"in i)return;const o=this,{columns:l,checkboxSelectionColumn:d}=o;if(!(!o.isPainted||s&&t==="remove")){if(t==="add")for(const u of n){const{region:h}=u;o.subGrids[h]||o.add(o.createSubGrid(h,o.subGridConfigs[h]))}if(t==="update"){if("width"in i||"minWidth"in i||"maxWidth"in i||"flex"in i){const u=r.region;l.visibleColumns.forEach(h=>{h.region===u&&h.repaintOnResize&&o.refreshColumn(h)}),o.afterColumnsChange({action:t,changes:i,column:r});return}if("text"in i&&a){r.subGrid.refreshHeader();return}if("hidden"in i){const u=o.getSubGridFromColumn(r.id);u.header.fixHeaderWidths(),u.footer.fixFooterWidths(),u.updateHasFlex()}}if(t==="dataset"||t==="batch"||t==="update"&&"region"in i){const u=l.getDistinctValues("region"),{toRemove:h,toAdd:f}=W.delta(u,o.regions,!0);o.remove(h.map(g=>o.getSubGrid(g))),o.add(f.map(g=>o.createSubGrid(g)))}if(d&&!l.includes(d)){const u=l.indexOf(l.findRecord("type","rownumber"))+1;l.insert(u,d,!0)}o._suspendRenderContentsOnColumnsChanged||o.renderContents(),o.syncFlexedSubCols(),o.bodyElement.setAttribute("aria-colcount",l.visibleColumns.length),o.afterColumnsChange({action:t,changes:i,column:r})}}onColumnsResized({changes:e,record:t}){const i=this;if(i.isConfiguring)return;const r=S.setLength(t.width),n=S.setLength(t.minWidth),s=S.setLength(t.maxWidth),a=i.getSubGridFromColumn(t.id);if(a.header.fixHeaderWidths(),a.footer.fixFooterWidths(),a.updateHasFlex(),!(t.flex&&t.childLevel)){(!i.cellEls||t!==i.lastColumnResized)&&(i.cellEls=S.children(i.element,`.b-grid-cell[data-column-id="${t.id}"]`),i.lastColumnResized=t);for(const l of i.cellEls)if("width"in e&&(l.style.width=r),"minWidth"in e&&(l.style.minWidth=n),"maxWidth"in e&&(l.style.maxWidth=s),"flex"in e){var o;l.style.flex=(o=t.flex)!==null&&o!==void 0?o:null}}i.resizingColumns||i.afterColumnsResized(t),i.syncFlexedSubCols()}afterColumnsResized(e){const t=this;t.eachSubGrid(i=>{!i.collapsed&&(!e||e.region===i.region)&&(i.fixWidths(),i.fixRowWidthsInSafariEdge())}),t.lastColumnResized=t.cellEls=null,t.bufferedAfterColumnsResized(e),t.onHeightChange()}syncFlexedSubCols(){const e=this.columns.query(t=>t.flex&&t.childLevel&&t.element);if(e)for(const t of e){const i=t.element.getBoundingClientRect().width,r=S.children(this.element,`.b-grid-cell[data-column-id="${t.id}"]`);for(const n of r)n.style.flex=`0 0 ${i}px`}}bufferedAfterColumnsResized(e){this.columns.usesAutoHeight&&this.refreshRows(),this.refreshVirtualScrollbars(),this.eachSubGrid(t=>{!t.collapsed&&(!e||e.region===t.region)&&t.refreshFakeScroll()})}bufferedElementResize(){this.refreshRows()}onInternalResize(e,t,i,r,n){S.scrollBarWidth&&t<r&&this.eachSubGrid(s=>{s.flex&&s.onElementResize(s.element)}),super.onInternalResize(...arguments),this.isPainted&&t!==r&&this.columns.usesFlexAutoHeight&&this.bufferedElementResize()}changeRowManager(e,t){const i=this;if(i._isRowMeasured||i.measureRowHeight(),t?.destroy(),e){const r=wd.new({grid:i,rowHeight:i.rowHeight,rowScrollMode:i.rowScrollMode||"move",autoHeight:i.autoHeight,fixedRowHeight:i.fixedRowHeight,internalListeners:{changeTotalHeight:"onRowManagerChangeTotalHeight",requestScrollChange:"onRowManagerRequestScrollChange",thisObj:i}},e);return i.relayEvents(r,["beforeRenderRow","renderRow"]),i._rowManager=null,r}}getRowHeight(e){return e.rowHeight}processRowHeight(e,t){}bindStore(e){const t=this.asyncEventSuffix;e.ion({name:wl,[`refresh${t}`]:"onStoreDataChange",[`add${t}`]:"onStoreAdd",[`remove${t}`]:"onStoreRemove",[`replace${t}`]:"onStoreReplace",[`removeAll${t}`]:"onStoreRemoveAll",[`move${t}`]:e.tree?null:"onFlatStoreMove",change:"relayStoreDataChange",idChange:"onStoreRecordIdChange",update:"onStoreUpdateRecord",beforeRequest:"onStoreBeforeRequest",afterRequest:"onStoreAfterRequest",exception:"onStoreException",commit:"onStoreCommit",thisObj:this}),super.bindStore(e)}unbindStore(e){this.detachListeners(wl),this.destroyStore&&e.destroy()}changeStore(e){if(e==null)return null;if(typeof e=="string"&&(e=se.getStore(e)),!e.isStore){var t;e=T.assign({data:this.data,tree:Boolean((t=this.initialConfig.features)===null||t===void 0?void 0:t.tree)},e),e.data||delete e.data,e.modelClass||(e.modelClass=Rr),e=new(e.readUrl?$t:se)(e)}return e}updateStore(e,t){var i;const r=this;if((i=super.updateStore)===null||i===void 0||i.call(this,e,t),t&&r.unbindStore(t),e&&(t&&r.deselectAll(),r.bindStore(e)),r.trigger("bindStore",{store:e,oldStore:t}),!r.isDestroying&&r.isPainted&&!r.refreshSuspended){var n;(n=r._rowManager)===null||n===void 0||n.reinitialize()}}onStoreUpdateRecord({source:e,record:t,changes:i}){const r=this;if(!r.refreshSuspended)if(r.forceFullRefresh)r.rowManager.refresh(),r.forceFullRefresh=!1;else{let n;if(t.isFieldModified("id")&&(n=r.getRowFor(t.meta.modified.id)),n=n||r.getRowFor(t),!n)return;if(r.fullRowRefresh||t.isSpecialRow){const s=e.indexOf(t);s!==-1&&n.render(s,t)}else r.columns.visibleColumns.forEach(s=>{const a=s.field;if(!(s.constructor.simpleRenderer&&!Object.prototype.hasOwnProperty.call(s.data,"renderer"))||i[a]){const l=n.getCell(a);l&&n.renderCell(l)}})}}refreshFromRowOnStoreAdd(e,t){const i=this,{rowManager:r}=i;r.renderFromRow(e),r.trigger("changeTotalHeight",{totalHeight:r.totalHeight}),i.store.count===1&&i.callEachSubGrid("refreshFakeScroll")}onMaskAutoClose(e){super.onMaskAutoClose(e),this.toggleEmptyText()}onStoreAdd({source:e,records:t,index:i,oldIndex:r,isChild:n,oldParent:s,parent:a,isMove:o,isExpandAll:l}){if(!this.isPainted||l||this.refreshSuspended)return;const d=o&&t.some(D=>{if(o[D.id]){const w=e.getById(D.meta.modified.parentId);return w?.isExpanded(e)&&w?.ancestorsExpanded(e)}});if(n&&!t[0].ancestorsExpanded(e)&&!d){if(!a.isLeaf){const D=this.rowManager.getRowById(a);D&&this.rowManager.renderRows([D])}return}this.rowManager.calculateRowCount(!1,!0,!0),e.isFiltered&&(i=e.indexOf(t[0]));const u=this,{rowManager:h}=u,{topIndex:f,rows:g,rowCount:m}=h,p=h.topIndex+h.rowCount-1,v=i,y=i+t.length-1,C=p>=e.count-t.length-1;s||r>-1||n&&o?h.refresh():v>=f&&v<f+m?u.refreshFromRowOnStoreAdd(g[v-f],...arguments):y>=f&&y<f+m?h.refresh():(C&&i>p&&h.fillBelow(u._scrollTop||0),h.estimateTotalHeight(!0))}onStoreException({action:e,type:t,response:i,exceptionType:r,error:n}){var s;const a=this;let o;switch(t){case"server":o=i.message||a.L("L{unspecifiedFailure}");break;case"exception":o=r==="network"?a.L("L{networkFailure}"):n?.message||(i==null||(s=i.parsedJson)===null||s===void 0?void 0:s.message)||a.L("L{parseFailure}");break}a.applyMaskError(`<div class="b-grid-load-failure">
                <div class="b-grid-load-fail">${a.L(e==="read"?"L{loadFailedMessage}":"L{syncFailedMessage}")}</div>
                ${i!=null&&i.url?`<div class="b-grid-load-fail">${i.url}</div>`:""}
                <div class="b-grid-load-fail">${a.L("L{serverResponse}")}</div>
                <div class="b-grid-load-fail">${o}</div>
            </div>`)}onStoreDataChange({action:e,changes:t,source:i,syncInfo:r}){var n,s;if(this.refreshSuspended||!this.rowManager)return;const a=this,o=i.isGrouped&&t&&i.groupers.some(l=>l.field in t);(n=super.onStoreDataChange)===null||n===void 0||n.call(this,...arguments),e==="batch"&&r!==null&&r!==void 0&&(s=r.removed)!==null&&s!==void 0&&s.length?a.rowManager.renderFromRow(a.topRow):(e==="dataset"&&a.rowManager.clearKnownHeights(),a.isPainted&&!o&&a.renderRows(Boolean(!(e in oS)||a.preserveScrollOnDatasetChange))),a.toggleEmptyText()}onStoreRecordIdChange(){super.onStoreRecordIdChange&&super.onStoreRecordIdChange(...arguments)}onStoreBeforeRequest(){this.applyLoadMask()}onStoreAfterRequest(e){this.loadMask&&!e.exception&&(this.masked=null,this.toggleEmptyText())}needsFullRefreshOnStoreRemove({isCollapse:e}){const t=this._features;return t?.group&&!t.group.disabled||t?.groupSummary&&!t.groupSummary.disabled||this.store.tree&&!e&&this.store.modelClass.convertEmptyParentToLeaf}onStoreRemove({records:e,isCollapse:t,isChild:i,isMove:r,isCollapseAll:n}){if(!this.isPainted||r||n)return;super.onStoreRemove&&super.onStoreRemove(...arguments);const s=this,{rowManager:a}=s;if(a.invalidateKnownHeight(e),s.animateRemovingRows&&!t&&!i){const o=e.reduce((l,d)=>{const u=a.getRowById(d.id);return u&&l.push(u),l},[]);if(o.length){const l=o[0];s.isAnimating=!0,B.onTransitionEnd({element:l._elementsArray[0],property:"left",duration:s.transitionDuration,thisObj:s,handler:()=>{s.isAnimating=!1,o.forEach(d=>!d.isDestroyed&&d.removeCls("b-removing")),a.refresh(),s.trigger("rowRemove"),s.afterRemove(arguments[0])}}),o.forEach(d=>d.addCls("b-removing"));return}}if(s.needsFullRefreshOnStoreRemove(...arguments))a.refresh(),s.afterRemove(arguments[0]);else{const o=a.topIndex;if(a.calculateRowCount(!1,!0,!0),a.topIndex!==o)a.renderFromRow(a.topRow);else{const{rows:l}=a,d=e.reduce((u,h)=>{const f=a.getRowById(h.id);return f&&(u=Math.min(u,l.indexOf(f))),u},l.length);l[d]?!s.refreshSuspended&&a.renderFromRow(l[d]):a.trigger("changeTotalHeight",{totalHeight:a.totalHeight})}s.trigger("rowRemove",{isCollapse:t}),s.afterRemove(arguments[0])}}onFlatStoreMove({from:e,to:t}){const{rowManager:i}=this,{topIndex:r,rowCount:n}=i,[s,a]=[e,t].sort((o,l)=>o-l);s>=r&&s<r+n?i.renderFromRow(i.rows[s-r]):a>=r&&a<r+n&&i.refresh()}onStoreReplace({records:e,all:t}){const{rowManager:i}=this;if(t)i.clearKnownHeights(),i.refresh();else{const r=e.reduce((n,[,s])=>{const a=this.getRowFor(s);return a&&n.push(a),n},[]);i.invalidateKnownHeight(e),i.renderRows(r)}}relayStoreDataChange(e){if(this.ariaElement.setAttribute("aria-rowcount",this.store.count+1),!this.project)return this.trigger("dataChange",F(F({},e),{},{store:e.source,source:this}))}onStoreRemoveAll(){super.onStoreRemoveAll&&super.onStoreRemoveAll(...arguments),this.isPainted&&(this.rowManager.clearKnownHeights(),this.renderRows(!1),this.toggleEmptyText())}onStoreCommit({changes:e}){if(this.showDirty&&e.modified.length){const t=[];e.modified.forEach(i=>{const r=this.rowManager.getRowFor(i);r&&t.push(r)}),this.rowManager.renderRows(t)}}get data(){return this._store?this._store.records:this._data}set data(e){this._store?this._store.data=e:this._data=e}populateHeaderMenu({column:e,items:t}){const i=this,{subGrids:r,regions:n}=i,{parent:s}=e;let a=!0;Object.entries(r).forEach(([o,l])=>{if(!l.sealedColumns&&e.draggable&&o!==e.region&&(!s&&r[e.region].columns.count>1||s&&s.children.length>1)){const d=l.element.compareDocumentPosition(r[e.region].element)===document.DOCUMENT_POSITION_PRECEDING,u=i.rtl?!d:d,h=n.length>2?i.L("L{moveColumnTo}",i.optionalL(o)):i.L(u?"L{moveColumnRight}":"L{moveColumnLeft}");t[`${o}Region`]={targetSubGrid:o,text:h,icon:"b-fw-icon b-icon-column-move-"+(u?"right":"left"),separator:a,onItem:({item:f})=>{e.traverse(g=>g.region=o),i.columns.insert(i.columns.indexOf(r[f.targetSubGrid].columns.last)+1,e),i.scrollColumnIntoView(e)}},a=!1}})}populateCellMenu({record:e,items:t}){}getColumnDragToolbarItems(e,t){return t}normalizeCellContext(e){const t=this,{columns:i}=t;return e.isLocation?e:e.isModel?new ne({grid:t,id:e.id,columnId:i.visibleColumns[0].id}):new ne(T.assign({grid:t},e))}getCell(e){const{store:t,columns:i}=this,{visibleColumns:r}=this.columns,n=isNaN(e.row)?isNaN(e.rowIndex)?t.indexOf(e.record||e.id):e.rowIndex:e.row,s=isNaN(e.column)?isNaN(e.columnIndex)?r.indexOf(e.column||i.getById(e.columnId)||i.get(e.field)||r[0]):e.columnIndex:e.column;return n>-1&&n<t.count&&s>-1&&s<r.length&&this.normalizeCellContext(e).cell||null}getHeaderElement(e){return e.isModel&&(e=e.id),this.fromCache(`.b-grid-header[data-column-id="${e}"]`)}getHeaderElementByField(e){const t=this.columns.get(e);return t?this.getHeaderElement(t):null}get bodyHeight(){return this._bodyHeight}get headerHeight(){const e=this;return e.isPainted&&!e._headerHeight&&(e._headerHeight=e.headerContainer.offsetHeight),e._headerHeight}get footerHeight(){const e=this;return e.isPainted&&!e._footerHeight&&(e._footerHeight=e.footerContainer.offsetHeight),e._footerHeight}get isTreeGrouped(){var e;return Boolean((e=this.features.treeGroup)===null||e===void 0?void 0:e.isGrouped)}getRecordFromElement(e){const t=e.closest(".b-grid-row");return t?this.store.getAt(t.dataset.index):null}getColumnFromElement(e){const t=e.closest(".b-grid-cell, .b-grid-header");if(!t)return null;if(t.matches(".b-grid-header"))return this.columns.getById(t.dataset.columnId);const i=$e.get(t);return this.columns.getById(i.columnId)}updateAutoHeight(e){T.assertBoolean(e,"autoHeight")}get columnLines(){return this._columnLines}set columnLines(e){T.assertBoolean(e,"columnLines"),S.toggleClasses(this.element,"b-no-column-lines",!e),this._columnLines=e}get keyMapElement(){return this.bodyElement}fixSizes(){this.callEachSubGrid("fixWidths");const e=this.headerContainer.querySelectorAll(".b-grid-header.b-depth-0");for(let t=0,{length:i}=e;t<i;t++)e[t].setAttribute("aria-colindex",t+1)}onRowManagerChangeTotalHeight({totalHeight:e,immediate:t}){return this.refreshTotalHeight(e,t)}refreshTotalHeight(e=this.rowManager.totalHeight,t=!1){const i=this;if(i.renderingRows||!i.isVisible)return!1;const r=i.scrollable,n=Math.abs(i.virtualScrollHeight-e),s=i._bodyRectangle.height,a=e-s;if(n){const o=a-i._scrollTop<s*2||i._verticalScrollHeight&&i._verticalScrollHeight-s<i._scrollTop;r.scrollHeight=i.virtualScrollHeight=e,i.isPainted&&(i.scrolling&&!o||n<100)&&!t?i.bufferedFixElementHeights():(i.virtualScrollHeightDirty&&i.virtualScrollHeightDirty(),i.bufferedFixElementHeights.cancel(),i.fixElementHeights())}}fixElementHeights(){const e=this,t=e.virtualScrollHeight,i=`${t}px`;e._verticalScrollHeight=t,e.verticalScroller.style.height=i,e.virtualScrollHeightDirty=!1,e.autoHeight&&(e.bodyContainer.style.height=i,e._bodyHeight=t,e.refreshBodyRectangle()),e.refreshVirtualScrollbars()}refreshBodyRectangle(){return this._bodyRectangle=$.client(this.bodyContainer)}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}enableScrollingCloseToEdges(e){this.scrollManager.startMonitoring({scrollables:[{element:this.scrollable.element,direction:"vertical"},...W.asArray(e||[]).map(t=>({element:(typeof t=="string"?this.subGrids[t]:t).scrollable.element}))],direction:"horizontal"})}disableScrollingCloseToEdges(e){this.scrollManager.stopMonitoring([this.scrollable.element,...W.asArray(e||[]).map(t=>(typeof t=="string"?this.subGrids[t]:t).element)])}onRowManagerRequestScrollChange({bottom:e}){this.scrollable.y=e-this.bodyHeight}initScroll(){const e=this,{scrollable:t}=e;e.scrollInitialized||(e.scrollInitialized=!0,t.contentElement=e.contentElement,t.ion({scroll:"onGridVerticalScroll",scrollend:"onGridVerticalScrollEnd",thisObj:e}),e.callEachSubGrid("initScroll"),K.isMobileSafari&&(t.element.style.transform="translate3d(0, 0, 0)"))}onGridVerticalScroll({source:e}){const t=this,{y:i}=e;i!==t._scrollTop&&(t._scrollTop=i,t.scrolling||(t.scrolling=!0,t.eachSubGrid(r=>r.suspendResizeMonitor=!0)),t.rowManager.updateRenderedRows(i),t.afterScroll({scrollTop:i}),t.trigger("scroll",{scrollTop:i}))}onGridVerticalScrollEnd(){this.scrolling=!1,this.eachSubGrid(e=>e.suspendResizeMonitor=!1)}async scrollRowIntoView(e,t=aS){const i=this,r=t.block||"nearest",{rowManager:n}=i,s=i.store.getById(e);if(s){let o;if(i.store.indexOf(s)===-1)return Vh;let l=i.scrollable,d=i.getRecordCoords(s);const u=$.from(l.element);if(d.virtual){const h=d.block,f=r!=="nearest"?t:{block:h};if(o=l.scrollIntoView(d,{block:"center"}),n.scrollTargetRecordId=s,n.updateRenderedRows(l.y,!0),d=i.getRecordCoords(s),n.lastScrollTop=l.y,d.virtual)return Vh;if(t.animate)l.suspendEvents(),r==="end"||r==="nearest"&&h==="end"?l.y-=u.bottom-d.bottom:(r==="start"||r==="nearest"&&h==="start")&&(l.y+=d.y-u.y),n.updateRenderedRows(l.y,!1,!0),h==="end"?l.y-=n.appendRowBuffer*n.rowHeight-1:l.y+=n.prependRowBuffer*n.rowHeight-1,l.scrollIntoView(i.getRecordCoords(s),Object.assign({},t,f)),l.resumeEvents();else{var a;t.recursive||await o,await((a=i.scrollRowIntoView)===null||a===void 0?void 0:a.call(i,s,Object.assign({recursive:!0},t,f)))}}else{let{column:h}=t;if(h){if(h.isModel||(h=i.columns.getById(h)||i.columns.get(h)),h){l=i.getSubGridFromColumn(h).scrollable;const f=$.from(n.getRowFor(s).getCell(h.id));d.x=f.x,d.width=f.width}}else t.x=!1;return l.scrollIntoView(d,t)}}}scrollColumnIntoView(e,t){return e=e instanceof ge?e:this.columns.get(e)||this.columns.getById(e)||this.columns.getAt(e),this.getSubGridFromColumn(e).scrollColumnIntoView(e,t)}scrollCellIntoView(e,t){return this.scrollRowIntoView(e.id,Object.assign({column:e.columnId},typeof t=="boolean"?{animate:t}:t))}scrollToBottom(e){return this.scrollRowIntoView(this.store.last,e)}scrollToTop(e){return this.scrollable.scrollBy(0,-this.scrollable.y,e)}storeScroll(){const e=this,t=e.storedScrollState={scrollTop:e.scrollable.y,scrollLeft:{}};return e.eachSubGrid(i=>{t.scrollLeft[i.region]=i.scrollable.x}),t}restoreScroll(e=this.storedScrollState){const t=this;t.eachSubGrid(i=>{const r=e.scrollLeft[i.region];if(r!=null){var n;i.scrollable.updateX(r),i.header.scrollable.updateX(r),i.footer.scrollable.updateX(r),(n=i.fakeScroller)===null||n===void 0||n.updateX(r)}}),t.scrollable.updateY(e.scrollTop)}beginGridMeasuring(){const e=this;if(e.$measureCellElements||(e.$measureCellElements=S.createElement({className:"b-grid-subgrid "+(!e._isRowMeasured&&e.hasFeature("stripe")?"b-stripe":""),reference:"subGridElement",style:{position:"absolute",top:"-10000px",left:"-100000px",visibility:"hidden",contain:"strict"},children:[{className:"b-grid-row",reference:"rowElement",children:[{className:"b-grid-cell",reference:"cellElement",style:{width:"auto",contain:K.isFirefox?"layout paint":"layout style paint"}}]}]})),e.getConfig("element"),e.verticalScroller.appendChild(e.$measureCellElements.subGridElement),!e.rendered){const t=e.appendTo||e.insertBefore||document.body,i=S.getRootElement(typeof t=="string"?document.getElementById(t):t);(!e.adopt||!i.contains(e.element))&&(i.appendChild(e.element),e.$removeAfterMeasuring=!0)}return e.$measureCellElements}endGridMeasuring(){this.$removeAfterMeasuring&&(this.element.remove(),this.$removeAfterMeasuring=!1),this.$measureCellElements.subGridElement.remove()}measureRowHeight(){const e=this,{rowElement:t}=e.beginGridMeasuring(),i=S.getStyleValue(t,["height","border-top-width","border-bottom-width"]),r=parseInt(i.height),n=K.isFirefox?globalThis.devicePixelRatio/Math.max(Math.trunc(globalThis.devicePixelRatio),1):1,s=i["border-top-width"]?Math.round(n*parseFloat(i["border-top-width"])):0,a=i["border-bottom-width"]?Math.round(n*parseFloat(i["border-bottom-width"])):0;(e.rowHeight==null||e.rowHeight===e._rowHeightFromStyle)&&(e.rowHeight=!isNaN(r)&&r?r:e.defaultRowHeight,e._rowHeightFromStyle=e.rowHeight),e._rowBorderHeight=s+a,e._isRowMeasured=!0,e.endGridMeasuring()}onThemeChange({theme:e}){this.whenVisible("measureRowHeight"),this.trigger("theme",{theme:e})}refreshRows(e=!1){const{element:t,rowManager:i}=this;t.classList.add("b-notransition"),e?i.returnToTop():i.refresh(),t.classList.remove("b-notransition")}refreshColumn(e){e.isVisible&&(e.isLeaf?this.rowManager.forEach(t=>t.renderCell(t.getCell(e.id))):e.children.forEach(t=>this.refreshColumn(t)))}refreshVirtualScrollbars(){const e=this,{headerContainer:t,footerContainer:i,virtualScrollers:r,scrollable:n,hasVerticalOverflow:s}=e,{classList:a}=r,o=!a.contains("b-hide-display"),l=Object.values(e.subGrids).some(u=>u.overflowingHorizontally),d=l!==o;if(d&&r.classList.toggle("b-hide-display",!l),S.scrollBarWidth){const u=s||n.overflowY==="scroll";t.classList.toggle("b-show-yscroll-padding",u),i.classList.toggle("b-show-yscroll-padding",u),r.classList.toggle("b-show-yscroll-padding",u),d&&(l&&e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange())}}get hasVerticalOverflow(){return this.scrollable.hasOverflow("y")}get contentHeight(){const e=this.rowManager;return Math.max(e.totalHeight,e.bottomRow?e.bottomRow.bottom:0)}onContentChange(){const e=this,t=e.rowManager;e.isVisible?(t.estimateTotalHeight(),e.paintListener=null,e.refreshTotalHeight(e.contentHeight),e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange()):e.paintListener||(e.paintListener=e.ion({paint:"onContentChange",once:!0,thisObj:e}))}triggerPaint(){this.isPainted||this.refreshBodyRectangle(),super.triggerPaint()}onHeightChange(){const e=this;e.refreshBodyRectangle(),e._bodyHeight=e.autoHeight?e.contentHeight:e.bodyContainer.offsetHeight}suspendRefresh(){this.refreshSuspended++}resumeRefresh(e){this.refreshSuspended&&!--this.refreshSuspended&&(e&&this.refreshRows(),this.trigger("resumeRefresh",{trigger:e}))}renderRows(e=!0){const t=this,i=e&&t.storeScroll();t.refreshSuspended||(t.trigger("beforeRenderRows"),t.renderingRows=!0,t.element.classList.add("b-grid-refreshing"),e||(t.scrollable.y=t._scrollTop=0),t.rowManager.reinitialize(!e),t.trigger("renderRows"),t.renderingRows=!1,t.onContentChange(),e&&t.restoreScroll(i),t.element.classList.remove("b-grid-refreshing"))}renderContents(){const e=this,{element:t,headerContainer:i,footerContainer:r,rowManager:n}=e;if(e.emptyCache(),e.isPainted){e._headerHeight=null,e.callEachSubGrid("refreshHeader",i),e.callEachSubGrid("refreshFooter",r),e.renderHeader(i,t),e.renderFooter(r,t),e.fixSizes();const s=n.removeAllRows();n.calculateRowCount(!1,!0,!0),n.rowCount&&(n.setPosition(s),e.renderRows())}}onPaintOverride(){}onPaint({firstPaint:e}){var t;const i=this;if(i.ariaElement.setAttribute("aria-rowcount",i.store.count+1),(t=super.onPaint)===null||t===void 0||t.call(this,...arguments),i.onPaintOverride()||!e)return;const{rowManager:r,store:n,element:s,headerContainer:a,bodyContainer:o,footerContainer:l}=i,d=S.scrollBarPadElement;let u,h=0;i.role=n!=null&&n.isTree?"treegrid":"grid",i.columns.ion({change:()=>u=!0,once:!0}),i.updateResponsive(i.width,0),u&&(i.callEachSubGrid("refreshHeader",a),i.callEachSubGrid("refreshFooter",l)),i.renderHeader(a,s),i.renderFooter(l,s),S.append(a,d),S.append(l,d),S.append(i.virtualScrollers,d),i.refreshBodyRectangle();const f=i.bodyContainer.offsetHeight;if(i.autoHeight?(i._bodyHeight=r.initWithHeight(s.offsetHeight-a.offsetHeight-l.offsetHeight,!0),o.style.height=i.bodyHeight+"px"):(i._bodyHeight=f,r.initWithHeight(i._bodyHeight,!0)),i.eachSubGrid(g=>{g.header.maxDepth>h&&(h=g.header.maxDepth)}),a.dataset.maxDepth=h,i.fixSizes(),(n.count||!n.isLoading)&&i.renderRows(),i.columns.usesAutoHeight){const{fonts:g}=document;g?.status!=="loaded"&&g.ready.then(()=>!i.isDestroyed&&i.refreshRows())}i.initScroll(),i.initInternalEvents()}render(){const e=this;e.requireSize=Boolean(e.owner),super.render(...arguments),e.autoHeight||(e.headerContainer.offsetHeight&&!e.bodyContainer.offsetHeight&&console.warn("Grid element not sized correctly, please check your CSS styles and review how you size the widget"),!("minHeight"in e.initialConfig)&&!("height"in e.initialConfig)&&parseInt(globalThis.getComputedStyle(e.element).minHeight)===e.height&&console.warn(`The ${e.$$name} is sized by its predefined minHeight, likely this is not intended. Please check your CSS and review how you size the widget, or assign a fixed height in the config. For more information, see the "Basics/Sizing the component" guide in docs.`))}renderHeader(e,t){}renderFooter(e,t){}beforeRenderCell(){}beforeRenderRow(){}afterRenderRow(){}afterScroll(){}processCellEditor(e){}afterColumnsChange(){}afterRemove(e){}afterToggleGroup(){}afterToggleSubGrid(){}syncMaskCover(e=this.masked){if(e){const t=e.cover==="body"&&this.rectangleOf("bodyContainer"),i=t&&this.rectangleOf("virtualScrollers"),{style:r}=e.element;r.marginTop=t?`${t.y}px`:"",r.height=t?`${t.height+(i?.height||0)}px`:""}}maskBody(e){let t;return this.bodyContainer&&(this.masked=ze.mergeConfigs(this.loadMaskDefaults,e),t=this.masked),t}unmaskBody(){this.masked=null}updateEmptyText(e){var t,i;(t=this.emptyTextEl)===null||t===void 0||t.remove(),this.emptyTextEl=S.createElement({parent:(i=this.firstItem)===null||i===void 0?void 0:i.element,className:"b-empty-text",[e!=null&&e.includes("<")?"html":"text"]:e})}toggleEmptyText(){const{bodyContainer:e,store:t}=this;e?.classList.toggle("b-grid-empty",!(t.count>0||t.isLoading||t.isCommitting))}updateReadOnly(e,t){if(super.updateReadOnly(e,t),!this.isConfiguring)for(const r of this.columns.bottomColumns){var i;(i=r.updateReadOnly)===null||i===void 0||i.call(r,e)}}getCurrentConfig(e){const t=super.getCurrentConfig(e),{store:i}=this,r=i.getInlineData(e),n=i.getCurrentConfig(e)||t.store;return r.length&&(t.data=r),n&&i.originalModelClass===Rr&&delete n.modelClass,T.isEmpty(n)||(t.store=n),t.store&&delete t.store.data,t}}rs.initClass();ae.setVersion("grid","5.3.0");rs._$name="GridBase";class no extends rs{static get $name(){return"Grid"}static get type(){return"grid"}}no.initClass();no._$name="Grid";class Tm extends no{static get $name(){return"TreeGrid"}static get type(){return"treegrid"}static get configurable(){return{store:{tree:!0}}}updateStore(e,t){if(e&&!e.tree)throw new Error("TreeGrid requires a Store configured with tree : true");super.updateStore(e,t)}}Tm.initClass();Tm._$name="TreeGrid";class ns extends Ze{configure(e){super.configure(e);const t=this;t.ion({change(){t.picker.selectedRecords=t.value}})}changePicker(e,t){const i=this;return super.changePicker(T.assign({},e,{type:"treegrid",minWidth:"35em",readOnly:i.readOnly,disableGridRowModelWarning:!0,selectedRecords:i.value.map(r=>i.store.getById(r)),selectionMode:{row:!0,multiSelect:i.multiSelect,rowCheckboxSelection:!0},internalListeners:{selectionChange({selection:r}){i.value=r}}}),t)}}M(ns,"$name","TreeCombo");M(ns,"type","treecombo");M(ns,"configurable",{multiSelect:!0,chipView:{itemTpl(c){return z.xss`${c.name}`},scrollable:{overflowX:"hidden-scroll"}}});ns.initClass();ns._$name="TreeCombo";const jh=(c,e)=>new Date(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),c.getMinutes(),c.getSeconds()+e,c.getMilliseconds()),it=function(){var c={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(this==null)throw new TypeError;var t=Object(this),i=t.length>>>0;if(i===0)return-1;var r=0;if(arguments.length>1&&(r=Number(arguments[1]),r!=r?r=0:r!=0&&r!=1/0&&r!=-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=i)return-1;for(var n=r>=0?r:Math.max(i-Math.abs(r),0);n<i;n++)if(n in t&&t[n]===e)return n;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),c.array={},c.array.sort=function(e,t){e.sort(function(i,r){return+i-+r}),t&&e[0]===0&&e.push(e.shift())},c.array.next=function(e,t,i){for(var r,n=i[0]!==0,s=0,a=t.length-1;a>-1;--a){if(r=t[a],r===e)return r;if(r>e||r===0&&n&&i[1]>e){s=a;continue}break}return t[s]},c.array.nextInvalid=function(e,t,i){for(var r=i[0],n=i[1],s=t.length,a=t[s-1]===0&&r!==0?n:0,o=e,l=t.indexOf(e),d=o;o===(t[l]||a);)if(o++,o>n&&(o=r),l++,l===s&&(l=0),o===d)return;return o},c.array.prev=function(e,t,i){for(var r,n=t.length,s=i[0]!==0,a=n-1,o=0;o<n;o++){if(r=t[o],r===e)return r;if(r<e||r===0&&s&&i[1]<e){a=o;continue}break}return t[a]},c.array.prevInvalid=function(e,t,i){for(var r=i[0],n=i[1],s=t.length,a=t[s-1]===0&&r!==0?n:0,o=e,l=t.indexOf(e),d=o;o===(t[l]||a);)if(o--,o<r&&(o=n),l--,l===-1&&(l=s-1),o===d)return;return o},c.day=c.D={name:"day",range:86400,val:function(e){return e.D||(e.D=c.date.getDate.call(e))},isValid:function(e,t){return c.D.val(e)===(t||c.D.extent(e)[1])},extent:function(e){if(e.DExtent)return e.DExtent;var t=c.M.val(e),i=c.DAYS_IN_MONTH[t-1];return t===2&&c.dy.extent(e)[1]===366&&(i=i+1),e.DExtent=[1,i]},start:function(e){return e.DStart||(e.DStart=c.date.next(c.Y.val(e),c.M.val(e),c.D.val(e)))},end:function(e){return e.DEnd||(e.DEnd=c.date.prev(c.Y.val(e),c.M.val(e),c.D.val(e)))},next:function(e,t){t=t>c.D.extent(e)[1]?1:t;var i=c.date.nextRollover(e,t,c.D,c.M),r=c.D.extent(i)[1];return t=t>r?1:t||r,c.date.next(c.Y.val(i),c.M.val(i),t)},prev:function(e,t){var i=c.date.prevRollover(e,t,c.D,c.M),r=c.D.extent(i)[1];return c.date.prev(c.Y.val(i),c.M.val(i),t>r?r:t||r)}},c.dayOfWeekCount=c.dc={name:"day of week count",range:604800,val:function(e){return e.dc||(e.dc=Math.floor((c.D.val(e)-1)/7)+1)},isValid:function(e,t){return c.dc.val(e)===t||t===0&&c.D.val(e)>c.D.extent(e)[1]-7},extent:function(e){return e.dcExtent||(e.dcExtent=[1,Math.ceil(c.D.extent(e)[1]/7)])},start:function(e){return e.dcStart||(e.dcStart=c.date.next(c.Y.val(e),c.M.val(e),Math.max(1,(c.dc.val(e)-1)*7+1||1)))},end:function(e){return e.dcEnd||(e.dcEnd=c.date.prev(c.Y.val(e),c.M.val(e),Math.min(c.dc.val(e)*7,c.D.extent(e)[1])))},next:function(e,t){t=t>c.dc.extent(e)[1]?1:t;var i=c.date.nextRollover(e,t,c.dc,c.M),r=c.dc.extent(i)[1];t=t>r?1:t;var n=c.date.next(c.Y.val(i),c.M.val(i),t===0?c.D.extent(i)[1]-6:1+7*(t-1));return n.getTime()<=e.getTime()?(i=c.M.next(e,c.M.val(e)+1),c.date.next(c.Y.val(i),c.M.val(i),t===0?c.D.extent(i)[1]-6:1+7*(t-1))):n},prev:function(e,t){var i=c.date.prevRollover(e,t,c.dc,c.M),r=c.dc.extent(i)[1];return t=t>r?r:t||r,c.dc.end(c.date.prev(c.Y.val(i),c.M.val(i),1+7*(t-1)))}},c.dayOfWeek=c.dw=c.d={name:"day of week",range:86400,val:function(e){return e.dw||(e.dw=c.date.getDay.call(e)+1)},isValid:function(e,t){return c.dw.val(e)===(t||7)},extent:function(){return[1,7]},start:function(e){return c.D.start(e)},end:function(e){return c.D.end(e)},next:function(e,t){return t=t>7?1:t||7,c.date.next(c.Y.val(e),c.M.val(e),c.D.val(e)+(t-c.dw.val(e))+(t<=c.dw.val(e)?7:0))},prev:function(e,t){return t=t>7?7:t||7,c.date.prev(c.Y.val(e),c.M.val(e),c.D.val(e)+(t-c.dw.val(e))+(t>=c.dw.val(e)?-7:0))}},c.dayOfYear=c.dy={name:"day of year",range:86400,val:function(e){return e.dy||(e.dy=Math.ceil(1+(c.D.start(e).getTime()-c.Y.start(e).getTime())/c.DAY))},isValid:function(e,t){return c.dy.val(e)===(t||c.dy.extent(e)[1])},extent:function(e){var t=c.Y.val(e);return e.dyExtent||(e.dyExtent=[1,t%4?365:366])},start:function(e){return c.D.start(e)},end:function(e){return c.D.end(e)},next:function(e,t){t=t>c.dy.extent(e)[1]?1:t;var i=c.date.nextRollover(e,t,c.dy,c.Y),r=c.dy.extent(i)[1];return t=t>r?1:t||r,c.date.next(c.Y.val(i),c.M.val(i),t)},prev:function(e,t){var i=c.date.prevRollover(e,t,c.dy,c.Y),r=c.dy.extent(i)[1];return t=t>r?r:t||r,c.date.prev(c.Y.val(i),c.M.val(i),t)}},c.hour=c.h={name:"hour",range:3600,val:function(e){return e.h||(e.h=c.date.getHour.call(e))},isValid:function(e,t){return c.h.val(e)===t},extent:function(){return[0,23]},start:function(e){return e.hStart||(e.hStart=c.date.next(c.Y.val(e),c.M.val(e),c.D.val(e),c.h.val(e)))},end:function(e){return e.hEnd||(e.hEnd=c.date.prev(c.Y.val(e),c.M.val(e),c.D.val(e),c.h.val(e)))},next:function(e,t){t=t>23?0:t;var i=c.date.next(c.Y.val(e),c.M.val(e),c.D.val(e)+(t<=c.h.val(e)?1:0),t);return!c.date.isUTC&&i.getTime()<=e.getTime()&&(i=c.date.next(c.Y.val(i),c.M.val(i),c.D.val(i),t+1)),i},prev:function(e,t){return t=t>23?23:t,c.date.prev(c.Y.val(e),c.M.val(e),c.D.val(e)+(t>=c.h.val(e)?-1:0),t)}},c.minute=c.m={name:"minute",range:60,val:function(e){return e.m||(e.m=c.date.getMin.call(e))},isValid:function(e,t){return c.m.val(e)===t},extent:function(e){return[0,59]},start:function(e){return e.mStart||(e.mStart=c.date.next(c.Y.val(e),c.M.val(e),c.D.val(e),c.h.val(e),c.m.val(e)))},end:function(e){return e.mEnd||(e.mEnd=c.date.prev(c.Y.val(e),c.M.val(e),c.D.val(e),c.h.val(e),c.m.val(e)))},next:function(e,t){var i=c.m.val(e),r=c.s.val(e),n=t>59?60-i:t<=i?60-i+t:t-i,s=new Date(e.getTime()+n*c.MIN-r*c.SEC);return!c.date.isUTC&&s.getTime()<=e.getTime()&&(s=new Date(e.getTime()+(n+120)*c.MIN-r*c.SEC)),s},prev:function(e,t){return t=t>59?59:t,c.date.prev(c.Y.val(e),c.M.val(e),c.D.val(e),c.h.val(e)+(t>=c.m.val(e)?-1:0),t)}},c.month=c.M={name:"month",range:2629740,val:function(e){return e.M||(e.M=c.date.getMonth.call(e)+1)},isValid:function(e,t){return c.M.val(e)===(t||12)},extent:function(){return[1,12]},start:function(e){return e.MStart||(e.MStart=c.date.next(c.Y.val(e),c.M.val(e)))},end:function(e){return e.MEnd||(e.MEnd=c.date.prev(c.Y.val(e),c.M.val(e)))},next:function(e,t){return t=t>12?1:t||12,c.date.next(c.Y.val(e)+(t>c.M.val(e)?0:1),t)},prev:function(e,t){return t=t>12?12:t||12,c.date.prev(c.Y.val(e)-(t>=c.M.val(e)?1:0),t)}},c.second=c.s={name:"second",range:1,val:function(e){return e.s||(e.s=c.date.getSec.call(e))},isValid:function(e,t){return c.s.val(e)===t},extent:function(){return[0,59]},start:function(e){return e},end:function(e){return e},next:function(e,t){var i=c.s.val(e),r=t>59?60-i:t<=i?60-i+t:t-i,n=new Date(e.getTime()+r*c.SEC);return!c.date.isUTC&&n.getTime()<=e.getTime()&&(n=new Date(e.getTime()+(r+7200)*c.SEC)),n},prev:function(e,t,i){return t=t>59?59:t,c.date.prev(c.Y.val(e),c.M.val(e),c.D.val(e),c.h.val(e),c.m.val(e)+(t>=c.s.val(e)?-1:0),t)}},c.time=c.t={name:"time",range:1,val:function(e){return e.t||(e.t=c.h.val(e)*3600+c.m.val(e)*60+c.s.val(e))},isValid:function(e,t){return c.t.val(e)===t},extent:function(){return[0,86399]},start:function(e){return e},end:function(e){return e},next:function(e,t){t=t>86399?0:t;var i=c.date.next(c.Y.val(e),c.M.val(e),c.D.val(e)+(t<=c.t.val(e)?1:0),0,0,t);return!c.date.isUTC&&i.getTime()<e.getTime()&&(i=c.date.next(c.Y.val(i),c.M.val(i),c.D.val(i),c.h.val(i),c.m.val(i),t+7200)),i},prev:function(e,t){return t=t>86399?86399:t,c.date.next(c.Y.val(e),c.M.val(e),c.D.val(e)+(t>=c.t.val(e)?-1:0),0,0,t)}},c.weekOfMonth=c.wm={name:"week of month",range:604800,val:function(e){return e.wm||(e.wm=(c.D.val(e)+(c.dw.val(c.M.start(e))-1)+(7-c.dw.val(e)))/7)},isValid:function(e,t){return c.wm.val(e)===(t||c.wm.extent(e)[1])},extent:function(e){return e.wmExtent||(e.wmExtent=[1,(c.D.extent(e)[1]+(c.dw.val(c.M.start(e))-1)+(7-c.dw.val(c.M.end(e))))/7])},start:function(e){return e.wmStart||(e.wmStart=c.date.next(c.Y.val(e),c.M.val(e),Math.max(c.D.val(e)-c.dw.val(e)+1,1)))},end:function(e){return e.wmEnd||(e.wmEnd=c.date.prev(c.Y.val(e),c.M.val(e),Math.min(c.D.val(e)+(7-c.dw.val(e)),c.D.extent(e)[1])))},next:function(e,t){t=t>c.wm.extent(e)[1]?1:t;var i=c.date.nextRollover(e,t,c.wm,c.M),r=c.wm.extent(i)[1];return t=t>r?1:t||r,c.date.next(c.Y.val(i),c.M.val(i),Math.max(1,(t-1)*7-(c.dw.val(i)-2)))},prev:function(e,t){var i=c.date.prevRollover(e,t,c.wm,c.M),r=c.wm.extent(i)[1];return t=t>r?r:t||r,c.wm.end(c.date.next(c.Y.val(i),c.M.val(i),Math.max(1,(t-1)*7-(c.dw.val(i)-2))))}},c.weekOfYear=c.wy={name:"week of year (ISO)",range:604800,val:function(e){if(e.wy)return e.wy;var t=c.dw.next(c.wy.start(e),5),i=c.dw.next(c.Y.prev(t,c.Y.val(t)-1),5);return e.wy=1+Math.ceil((t.getTime()-i.getTime())/c.WEEK)},isValid:function(e,t){return c.wy.val(e)===(t||c.wy.extent(e)[1])},extent:function(e){if(e.wyExtent)return e.wyExtent;var t=c.dw.next(c.wy.start(e),5),i=c.dw.val(c.Y.start(t)),r=c.dw.val(c.Y.end(t));return e.wyExtent=[1,i===5||r===5?53:52]},start:function(e){return e.wyStart||(e.wyStart=c.date.next(c.Y.val(e),c.M.val(e),c.D.val(e)-(c.dw.val(e)>1?c.dw.val(e)-2:6)))},end:function(e){return e.wyEnd||(e.wyEnd=c.date.prev(c.Y.val(e),c.M.val(e),c.D.val(e)+(c.dw.val(e)>1?8-c.dw.val(e):0)))},next:function(e,t){t=t>c.wy.extent(e)[1]?1:t;var i=c.dw.next(c.wy.start(e),5),r=c.date.nextRollover(i,t,c.wy,c.Y);c.wy.val(r)!==1&&(r=c.dw.next(r,2));var n=c.wy.extent(r)[1],s=c.wy.start(r);return t=t>n?1:t||n,c.date.next(c.Y.val(s),c.M.val(s),c.D.val(s)+7*(t-1))},prev:function(e,t){var i=c.dw.next(c.wy.start(e),5),r=c.date.prevRollover(i,t,c.wy,c.Y);c.wy.val(r)!==1&&(r=c.dw.next(r,2));var n=c.wy.extent(r)[1],s=c.wy.end(r);return t=t>n?n:t||n,c.wy.end(c.date.next(c.Y.val(s),c.M.val(s),c.D.val(s)+7*(t-1)))}},c.year=c.Y={name:"year",range:31556900,val:function(e){return e.Y||(e.Y=c.date.getYear.call(e))},isValid:function(e,t){return c.Y.val(e)===t},extent:function(){return[1970,2099]},start:function(e){return e.YStart||(e.YStart=c.date.next(c.Y.val(e)))},end:function(e){return e.YEnd||(e.YEnd=c.date.prev(c.Y.val(e)))},next:function(e,t){return t>c.Y.val(e)&&t<=c.Y.extent()[1]?c.date.next(t):c.NEVER},prev:function(e,t){return t<c.Y.val(e)&&t>=c.Y.extent()[0]?c.date.prev(t):c.NEVER}},c.fullDate=c.fd={name:"full date",range:1,val:function(e){return e.fd||(e.fd=e.getTime())},isValid:function(e,t){return c.fd.val(e)===t},extent:function(){return[0,3250368e7]},start:function(e){return e},end:function(e){return e},next:function(e,t){return c.fd.val(e)<t?new Date(t):c.NEVER},prev:function(e,t){return c.fd.val(e)>t?new Date(t):c.NEVER}},c.modifier={},c.modifier.after=c.modifier.a=function(e,t){var i=t[0];return{name:"after "+e.name,range:(e.extent(new Date)[1]-i)*e.range,val:e.val,isValid:function(r,n){return this.val(r)>=i},extent:e.extent,start:e.start,end:e.end,next:function(r,n){return n!=i&&(n=e.extent(r)[0]),e.next(r,n)},prev:function(r,n){return n=n===i?e.extent(r)[1]:i-1,e.prev(r,n)}}},c.modifier.before=c.modifier.b=function(e,t){var i=t[t.length-1];return{name:"before "+e.name,range:e.range*(i-1),val:e.val,isValid:function(r,n){return this.val(r)<i},extent:e.extent,start:e.start,end:e.end,next:function(r,n){return n=n===i?e.extent(r)[0]:i,e.next(r,n)},prev:function(r,n){return n=n===i?i-1:e.extent(r)[1],e.prev(r,n)}}},c.compile=function(e){var t=[],i=0,r;for(var n in e){var s=n.split("_"),a=s[0],o=s[1],l=e[n],d=o?c.modifier[o](c[a],l):c[a];t.push({constraint:d,vals:l}),i++}t.sort(function(h,f){var g=h.constraint.range,m=f.constraint.range;return m<g?-1:m>g?1:0}),r=t[i-1].constraint;function u(h){return h==="next"?function(f,g){return f.getTime()>g.getTime()}:function(f,g){return g.getTime()>f.getTime()}}return{start:function(h,f){for(var g=f,m=c.array[h],p=1e3,v;p--&&!v&&g;){v=!0;for(var y=0;y<i;y++){var C=t[y].constraint,D=C.val(g),w=C.extent(g),E=m(D,t[y].vals,w);if(!C.isValid(g,E)){g=C[h](g,E),v=!1;break}}}return g!==c.NEVER&&(g=h==="next"?r.start(g):r.end(g)),g},end:function(h,f){for(var g,m=c.array[h+"Invalid"],p=u(h),v=i-1;v>=0;v--){var y=t[v].constraint,C=y.val(f),D=y.extent(f),w=m(C,t[v].vals,D),E;w!==void 0&&(E=y[h](f,w),E&&(!g||p(g,E))&&(g=E))}return g},tick:function(h,f){return new Date(h==="next"?r.end(f).getTime()+c.SEC:r.start(f).getTime()-c.SEC)},tickSafe:function(h,f){return h==="next"?jh(r.end(f),1):jh(r.start(f),-1)},tickStart:function(h){return r.start(h)}}},c.schedule=function(e){if(!e)throw new Error("Missing schedule definition.");if(!e.schedules)throw new Error("Definition must include at least one schedule.");for(var t=[],i=e.schedules.length,r=[],n=e.exceptions?e.exceptions.length:0,s=0;s<i;s++)t.push(c.compile(e.schedules[s]));for(var a=0;a<n;a++)r.push(c.compile(e.exceptions[a]));function o(w,E,R,x,k){var I=C(w),A=E,L=1e6,O=[],_=[],V,Y,J=[],X=w==="next",q,oe=X?0:1,xe=X?1:0;if(R=R?new Date(R):new Date,!R||!R.getTime())throw new Error("Invalid start date.");for(d(w,t,O,R),h(w,r,_,R);L--&&A&&(V=D(O,I))&&!(x&&I(V,x));){if(n&&(f(w,r,_,V),Y=p(w,_,V))){u(w,t,O,Y);continue}if(k){var re=v(_,I);Y=y(w,t,O,V,re);var Se=X?[new Date(Math.max(R,V)),Y?new Date(x?Math.min(Y,x):Y):void 0]:[Y?new Date(x?Math.max(x,Y.getTime()+c.SEC):Y.getTime()+c.SEC):void 0,new Date(Math.min(R,V.getTime()+c.SEC))];if(q&&Se[oe].getTime()===q[xe].getTime()?(q[xe]=Se[xe],A++):(q=Se,J.push(q)),!Y)break;u(w,t,O,Y)}else J.push(X?new Date(Math.max(R,V)):m(t,O,V,x)),g(w,t,O,V);A--}for(var ie=0,le=J.length;ie<le;ie++){var ct=J[ie];J[ie]=Object.prototype.toString.call(ct)==="[object Array]"?[l(ct[0]),l(ct[1])]:l(ct)}return J.length===0?c.NEVER:E===1?J[0]:J}function l(w){if(w instanceof Date&&!isNaN(w.valueOf()))return new Date(w)}function d(w,E,R,x){for(var k=0,I=E.length;k<I;k++)R[k]=E[k].start(w,x)}function u(w,E,R,x){for(var k=C(w),I=0,A=E.length;I<A;I++)R[I]&&!k(R[I],x)&&(R[I]=E[I].start(w,x))}function h(w,E,R,x){for(var k=0,I=E.length;k<I;k++){var A=E[k].start(w,x);A?R[k]=[A,E[k].end(w,A)]:R[k]=c.NEVER}}function f(w,E,R,x){for(var k=C(w),I=0,A=E.length;I<A;I++)if(R[I]&&!k(R[I][0],x)){var L=E[I].start(w,x);L?R[I]=[L,E[I].end(w,L)]:R[I]=c.NEVER}}function g(w,E,R,x){for(var k=0,I=E.length;k<I;k++)if(R[k]&&R[k].getTime()===x.getTime()){const A=E[k].start(w,E[k].tick(w,x));A!==c.NEVER&&A.getTime()===R[k].getTime()?R[k]=E[k].start(w,E[k].tickSafe(w,x)):R[k]=A}}function m(w,E,R,x){for(var k,I=0,A=E.length;I<A;I++)if(E[I]&&E[I].getTime()===R.getTime()){var L=w[I].tickStart(R);if(x&&L<x)return x;(!k||L>k)&&(k=L)}return k}function p(w,E,R){for(var x=C(w),k,I=0,A=E.length;I<A;I++){var L=E[I];L&&!x(L[0],R)&&(!L[1]||x(L[1],R))&&(!k||x(L[1],k))&&(k=L[1])}return k}function v(w,E){for(var R,x=0,k=w.length;x<k;x++)w[x]&&(!R||E(R,w[x][0]))&&(R=w[x][0]);return R}function y(w,E,R,x,k){for(var I=C(w),A,L=0,O=E.length;L<O;L++){var _=R[L];if(_&&_.getTime()===x.getTime()){var V=E[L].end(w,_);if(k&&(!V||I(V,k)))return k;(!A||I(V,A))&&(A=V)}}return A}function C(w){return w==="next"?function(E,R){return!R||E.getTime()>R.getTime()}:function(E,R){return!E||R.getTime()>E.getTime()}}function D(w,E){for(var R=w[0],x=1,k=w.length;x<k;x++)w[x]&&E(R,w[x])&&(R=w[x]);return R}return{isValid:function(w){return o("next",1,w,w)!==c.NEVER},next:function(w,E,R){return o("next",w||1,E,R)},prev:function(w,E,R){return o("prev",w||1,E,R)},nextRange:function(w,E,R){return o("next",w||1,E,R,!0)},prevRange:function(w,E,R){return o("prev",w||1,E,R,!0)}}},c.setTimeout=function(e,t){var i=c.schedule(t),r;e&&n();function n(){var s=Date.now(),a=i.next(2,s);if(!a[0]){r=void 0;return}var o=a[0].getTime()-s;o<1e3&&(o=a[1]?a[1].getTime()-s:1e3),o<2147483647?r=setTimeout(e,o):r=setTimeout(n,2147483647)}return{isDone:function(){return!r},clear:function(){clearTimeout(r)}}},c.setInterval=function(e,t){if(!e)return;var i=c.setTimeout(n,t),r=i.isDone();function n(){r||(e(),i=c.setTimeout(n,t))}return{isDone:function(){return i.isDone()},clear:function(){r=!0,i.clear()}}},c.date={},c.date.timezone=function(e){c.date.build=e?function(r,n,s,a,o,l){return new Date(r,n,s,a,o,l)}:function(r,n,s,a,o,l){return new Date(Date.UTC(r,n,s,a,o,l))};var t=e?"get":"getUTC",i=Date.prototype;c.date.getYear=i[t+"FullYear"],c.date.getMonth=i[t+"Month"],c.date.getDate=i[t+"Date"],c.date.getDay=i[t+"Day"],c.date.getHour=i[t+"Hours"],c.date.getMin=i[t+"Minutes"],c.date.getSec=i[t+"Seconds"],c.date.isUTC=!e},c.date.UTC=function(){c.date.timezone(!1)},c.date.localTime=function(){c.date.timezone(!0)},c.date.UTC(),c.SEC=1e3,c.MIN=c.SEC*60,c.HOUR=c.MIN*60,c.DAY=c.HOUR*24,c.WEEK=c.DAY*7,c.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],c.NEVER=0,c.date.next=function(e,t,i,r,n,s){return c.date.build(e,t!==void 0?t-1:0,i!==void 0?i:1,r||0,n||0,s||0)},c.date.nextRollover=function(e,t,i,r){var n=i.val(e),s=i.extent(e)[1];return(t||s)<=n||t>s?new Date(r.end(e).getTime()+c.SEC):r.start(e)},c.date.prev=function(e,t,i,r,n,s){var a=arguments.length;return t=a<2?11:t-1,i=a<3?c.D.extent(c.date.next(e,t+1))[1]:i,r=a<4?23:r,n=a<5?59:n,s=a<6?59:s,c.date.build(e,t,i,r,n,s)},c.date.prevRollover=function(e,t,i,r){var n=i.val(e);return t>=n||!t?r.start(r.prev(e,r.val(e)-1)):r.start(e)},c.parse={},c.parse.cron=function(e,t){var i={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},r={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},n={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function s(y,C,D){return isNaN(y)?i[y]||null:Math.min(+y+(C||0),D||9999)}function a(y){var C={},D;for(D in y)D!=="dc"&&D!=="d"&&(C[D]=y[D].slice(0));return C}function o(y,C,D,w,E){var R=D;for(y[C]||(y[C]=[]);R<=w;)y[C].indexOf(R)<0&&y[C].push(R),R+=E||1;y[C].sort(function(x,k){return x-k})}function l(y,C,D,w){(C.d&&!C.dc||C.dc&&C.dc.indexOf(w)<0)&&(y.push(a(C)),C=y[y.length-1]),o(C,"d",D,D),o(C,"dc",w,w)}function d(y,C,D){var w={},E={};D===1?(o(C,"D",1,3),o(C,"d",i.MON,i.FRI),o(w,"D",2,2),o(w,"d",i.TUE,i.FRI),o(E,"D",3,3),o(E,"d",i.TUE,i.FRI)):(o(C,"D",D-1,D+1),o(C,"d",i.MON,i.FRI),o(w,"D",D-1,D-1),o(w,"d",i.MON,i.THU),o(E,"D",D+1,D+1),o(E,"d",i.TUE,i.FRI)),y.exceptions.push(w),y.exceptions.push(E)}function u(y,C,D,w,E,R){var x=y.split("/"),k=+x[1],I=x[0];if(I!=="*"&&I!=="0"){var A=I.split("-");w=s(A[0],R,E),E=s(A[1],R,E)||E}o(C,D,w,E,k)}function h(y,C,D,w,E,R){var x,k,I=C.schedules,A=I[I.length-1];y==="L"&&(y=w-1),(x=s(y,R,E))!==null?o(A,D,x,x):(x=s(y.replace("W",""),R,E))!==null?d(C,A,x):(x=s(y.replace("L",""),R,E))!==null?l(I,A,x,w-1):(k=y.split("#")).length===2?(x=s(k[0],R,E),l(I,A,x,s(k[1]))):u(y,A,D,w,E,R)}function f(y){return y.indexOf("#")>-1||y.indexOf("L")>0}function g(y,C){return f(y)&&!f(C)?1:y-C}function m(y){var C={schedules:[{}],exceptions:[]},D=y.replace(/(\s)+/g," ").split(" "),w,E,R,x;for(w in n)if(E=n[w],R=D[E[0]],R&&R!=="*"&&R!=="?"){x=R.split(",").sort(g);var k,I=x.length;for(k=0;k<I;k++)h(x[k],C,w,E[1],E[2],E[3])}return C}function p(y){var C=y.toUpperCase();return r[C]||C}var v=p(e);return m(t?v:"0 "+v)},c.parse.recur=function(){var e=[],t=[],i,r=e,n,s,a,o,l,d,u,h;function f(g,m,p){if(g=o?g+"_"+o:g,i||(r.push({}),i=r[0]),i[g]||(i[g]=[]),n=i[g],a){for(s=[],u=m;u<=p;u+=a)s.push(u);h={n:g,x:a,c:n.length,m:p}}s=l?[m]:d?[p]:s;var v=s.length;for(u=0;u<v;u+=1){var y=s[u];n.indexOf(y)<0&&n.push(y)}s=a=o=l=d=0}return{schedules:e,exceptions:t,on:function(){return s=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(g){return a=g||1,this},after:function(g){return o="a",s=[g],this},before:function(g){return o="b",s=[g],this},first:function(){return l=1,this},last:function(){return d=1,this},time:function(){for(var g=0,m=s.length;g<m;g++){var p=s[g].split(":");p.length<3&&p.push(0),s[g]=+p[0]*3600+ +p[1]*60+ +p[2]}return f("t"),this},second:function(){return f("s",0,59),this},minute:function(){return f("m",0,59),this},hour:function(){return f("h",0,23),this},dayOfMonth:function(){return f("D",1,d?0:31),this},dayOfWeek:function(){return f("d",1,7),this},onWeekend:function(){return s=[1,7],this.dayOfWeek()},onWeekday:function(){return s=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return f("dc",1,d?0:5),this},dayOfYear:function(){return f("dy",1,d?0:366),this},weekOfMonth:function(){return f("wm",1,d?0:5),this},weekOfYear:function(){return f("wy",1,d?0:53),this},month:function(){return f("M",1,12),this},year:function(){return f("Y",1970,2450),this},fullDate:function(){for(var g=0,m=s.length;g<m;g++)s[g]=s[g].getTime();return f("fd"),this},customModifier:function(g,m){var p=c.modifier[g];if(!p)throw new Error("Custom modifier "+g+" not recognized!");return o=g,s=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(g){var m=c[g];if(!m)throw new Error("Custom time period "+g+" not recognized!");return f(g,m.extent(new Date)[0],m.extent(new Date)[1]),this},startingOn:function(g){return this.between(g,h.m)},between:function(g,m){return i[h.n]=i[h.n].splice(0,h.c),a=h.x,f(h.n,g,m),this},and:function(){return i=r[r.push({})-1],this},except:function(){return r=t,i=null,this}}},c.parse.text=function(e){var t=c.parse.recur,i=0,r="",n,s={eof:/^$/,fullDate:/^(\d\d\d\d-\d\d-\d\dt\d\d:\d\d:\d\d)\b/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},a={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function o(w,E,R,x){return{startPos:w,endPos:E,text:R,type:x}}function l(w){var E=w instanceof Array?w:[w],R=/\s+/,x,k,I,A,L,O;for(E.push(R),L=i;!x||x.type===R;){O=-1,k=r.substring(L),x=o(L,L,r.split(R)[0]);var _,V=E.length;for(_=0;_<V;_++)A=E[_],I=A.exec(k),I&&I.index===0&&I[0].length>O&&(O=I[0].length,x=o(L,L+O,k.substring(0,O),A));x.type===R&&(L=x.endPos)}return x}function d(w){var E=l(w);return i=E.endPos,E}function u(w){for(var E=+C(w),R=v(s.through)?+C(w):E,x=[],k=E;k<=R;k++)x.push(k);return x}function h(w){for(var E=u(w);v(s.and);)E=E.concat(u(w));return E}function f(w){var E,R,x,k;v(s.weekend)?w.on(a.sun,a.sat).dayOfWeek():v(s.weekday)?w.on(a.mon,a.tue,a.wed,a.thu,a.fri).dayOfWeek():(E=C(s.rank),w.every(E),R=p(w),v(s.start)?(E=C(s.rank),w.startingOn(E),y(R.type)):v(s.between)&&(x=C(s.rank),v(s.and)&&(k=C(s.rank),w.between(x,k))))}function g(w){v(s.first)?w.first():v(s.last)?w.last():w.on(h(s.rank)),p(w)}function m(w){i=0,r=w,n=-1;for(var E=t();i<r.length&&n<0;){var R=y([s.every,s.after,s.before,s.onthe,s.on,s.of,s.in,s.at,s.and,s.except,s.also]);switch(R.type){case s.every:f(E);break;case s.after:l(s.time).type!==void 0?(E.after(C(s.time)),E.time()):l(s.fullDate).type!==void 0?(E.after(C(s.fullDate)),E.fullDate()):(E.after(C(s.rank)),p(E));break;case s.before:l(s.time).type!==void 0?(E.before(C(s.time)),E.time()):l(s.fullDate).type!==void 0?(E.before(C(s.fullDate)),E.fullDate()):(E.before(C(s.rank)),p(E));break;case s.onthe:g(E);break;case s.on:E.on(h(s.dayName)).dayOfWeek();break;case s.of:E.on(h(s.monthName)).month();break;case s.in:E.on(h(s.yearIndex)).year();break;case s.at:for(E.on(C(s.time)).time();v(s.and);)E.on(C(s.time)).time();break;case s.and:break;case s.also:E.and();break;case s.except:E.except();break;default:n=i}}return{schedules:E.schedules,exceptions:E.exceptions,error:n}}function p(w){var E=y([s.second,s.minute,s.hour,s.dayOfYear,s.dayOfWeek,s.dayInstance,s.day,s.month,s.year,s.weekOfMonth,s.weekOfYear]);switch(E.type){case s.second:w.second();break;case s.minute:w.minute();break;case s.hour:w.hour();break;case s.dayOfYear:w.dayOfYear();break;case s.dayOfWeek:w.dayOfWeek();break;case s.dayInstance:w.dayOfWeekCount();break;case s.day:w.dayOfMonth();break;case s.weekOfMonth:w.weekOfMonth();break;case s.weekOfYear:w.weekOfYear();break;case s.month:w.month();break;case s.year:w.year();break;default:n=i}return E}function v(w){var E=l(w).type===w;return E&&d(w),E}function y(w){var E=d(w);return E.type?E.text=D(E.text,w):n=i,E}function C(w){return y(w).text}function D(w,E){var R=w;switch(E){case s.time:var x=w.split(/(:|am|pm)/),k=x[3]==="pm"&&x[0]<12?parseInt(x[0],10)+12:x[0],I=x[2].trim();R=(k.length===1?"0":"")+k+":"+I;break;case s.rank:R=parseInt(/^\d+/.exec(w)[0],10);break;case s.monthName:case s.dayName:R=a[w.substring(0,3)];break;case s.fullDate:R=new Date(w.toUpperCase());break}return R}return m(e.toLowerCase())},c}();it.date.localTime();function Wh(c){const e=[],t=[];let i;const r=function*(){for(i||(i=c[Symbol.iterator]());e.length&&(yield*e,e.length=0),!!i;){const{value:s,done:a}=i.next();if(a){i=null,c=null;break}t.push(s),yield s}},n=function*(){for(i||(i=c[Symbol.iterator]());t.length&&(yield*t,t.length=0),!!i;){const{value:s,done:a}=i.next();if(a){i=null,c=null;break}e.push(s),yield s}};return[r(),n()]}function*lS(c,e){if(e<0)throw new Error("Batch size needs to a natural number");e=e|0;const t=[];for(const i of c)t.length===e&&(yield t,t.length=0),t.push(i);t.length>0&&(yield t)}function*dS(c,e){let t=0;for(const i of c)e(i,t++)&&(yield i)}function*cS(c,e){let t=0;for(const i of c)++t>e&&(yield i)}function uS(c,e){let t=0;for(const i of c)if(!e(i,t++))return!1;return!0}function hS(c,e){let t=0;for(const i of c)if(e(i,t++))return!0;return!1}function*fS(c,e){let t=0;for(const i of c)yield e(i,t++)}function gS(c,e,t){let i=0,r=t;for(const n of c)r=e(r,n,i++);return r}function*mS(c){const e=new Set;for(const t of c)e.has(t)||(e.add(t),yield t)}function*pS(c,e){const t=new Set;for(const i of c){const r=e(i);t.has(r)||(t.add(r),yield i)}}function*vS(c,e){let t=0;for(const i of c)if(e(i,t++))yield i;else return}function*yS(c){for(const e of c)yield*e}class Ni{constructor(e){if(this.iterable=void 0,!e)throw new Error("Require an iterable instance for chaining");this.iterable=e}derive(e){return this.iterable=void 0,new Ni(e)}copy(){const[e,t]=Wh(this.iterable);return this.iterable=t,new Ni(e)}split(){const[e,t]=Wh(this.iterable);return[new Ni(e),this.derive(t)]}inBatchesBySize(e){return this.derive(lS(this.iterable,e))}filter(e){return this.derive(dS(this.iterable,e))}drop(e){return this.derive(cS(this.iterable,e))}map(e){return this.derive(fS(this.iterable,e))}reduce(e,t){return gS(this,e,t)}concat(){return this.derive(yS(this.iterable))}uniqueOnly(){return this.derive(mS(this.iterable))}uniqueOnlyBy(e){return this.derive(pS(this.iterable,e))}every(e){return uS(this,e)}some(e){return hS(this,e)}takeWhile(e){return this.derive(vS(this.iterable,e))}*[Symbol.iterator](){let e=this.iterable;if(!e)throw new Error("Chained iterator already exhausted or used to derive the new one");this.iterable=void 0,yield*e,e=void 0}toArray(){return Array.from(this)}sort(e){return Array.from(this).sort(e)}toSet(){return new Set(this)}toMap(){return new Map(this)}flush(){for(const e of this);}memoize(){return new Mm(this)}}const bS=c=>new Ni(c),Li=bS;class Mm extends Ni{constructor(){super(...arguments),this.elements=[],this.$iterator=void 0}set iterable(e){this.$iterable=e}get iterable(){return this}derive(e){return new Ni(e)}*[Symbol.iterator](){const e=this.elements;if(this.$iterable){this.$iterator||(this.$iterator=this.$iterable[Symbol.iterator]());let t=this.$iterator,i=e.length;for(i>0&&(yield*e);;){if(e.length>i){for(let s=i;s<e.length;s++)yield e[s];i=e.length}if(!t)break;const{value:r,done:n}=t.next();n?(t=this.$iterator=null,this.$iterable=null):(e.push(r),i++,yield r)}}else yield*e}}const CS=c=>new Mm(c),wS=CS,wa=Symbol("MixinIdentity"),Hn=Symbol("MixinStateProperty");class SS{constructor(){this.baseEl=void 0,this.sourceEl=void 0,this.$elementsByTopoLevel=void 0,this.$topoLevels=void 0,this.linearizedByTopoLevelsSource=wS(this.linearizedByTopoLevels())}static new(e){const t=new this;return e&&Object.assign(t,e),t}get topoLevels(){return this.$topoLevels!==void 0?this.$topoLevels:this.$topoLevels=this.buildTopoLevels()}buildTopoLevels(){return Array.from(this.elementsByTopoLevel.keys()).sort((e,t)=>e-t)}get elementsByTopoLevel(){return this.$elementsByTopoLevel!==void 0?this.$elementsByTopoLevel:this.$elementsByTopoLevel=this.buildElementsByTopoLevel()}getOrCreateLevel(e,t){let i=e.get(t);return i||(i=[],e.set(t,i)),i}buildElementsByTopoLevel(){let e=0;const t=this.baseEl?Li(this.baseEl.walkDepthState.elementsByTopoLevel.values()).concat().toSet():new Set,i=Li(this.sourceEl.requirements).map(r=>r.walkDepthState.elementsByTopoLevel).concat().reduce((r,[n,s])=>(n>e&&(e=n),this.getOrCreateLevel(r,n).push(s),r),new Map);return this.getOrCreateLevel(i,e+1).push([this.sourceEl]),Li(i).map(([r,n])=>[r,Li(n).concat().uniqueOnly().filter(s=>!t.has(s)).sort((s,a)=>s.id-a.id)]).toMap()}*linearizedByTopoLevels(){yield*Li(this.topoLevels).map(e=>this.elementsByTopoLevel.get(e)).concat()}}let Uh=1;const DS=c=>class extends c{};class ua{}class Sd{constructor(){this.id=Uh++,this.requirements=[],this.baseClass=ua,this.identitySymbol=void 0,this.mixinLambda=DS,this.walkDepthState=void 0,this.$minimalClass=void 0,this.name=""}static new(e){const t=new this;e&&Object.assign(t,e),t.walkDepthState=SS.new({sourceEl:t,baseEl:xS(t.baseClass)});const i=t.mixinLambda,r=t.identitySymbol=Symbol(i.name),n=Object.assign(function(s){const a=i(s);return a.prototype[r]=!0,a},{[wa]:r,[Hn]:t});return Object.defineProperty(n,Symbol.hasInstance,{value:Yh}),t.mixinLambda=n,t}get minimalClass(){return this.$minimalClass!==void 0?this.$minimalClass:this.$minimalClass=this.buildMinimalClass()}getBaseClassMixinId(e){const t=this.constructor,i=t.baseClassesIds.get(e);if(i!==void 0)return i;const r=Uh++;return t.baseClassesIds.set(e,r),r}buildMinimalClass(){const e=this.constructor;let t=this.baseClass;const i=this.walkDepthState.linearizedByTopoLevelsSource.reduce((n,s)=>{const{cls:a,hash:o}=n,l=o+String.fromCharCode(s.id);let d=e.minimalClassesByLinearHash.get(l);return d||(d=s.mixinLambda(a),s.name=d.name,e.minimalClassesByLinearHash.set(l,d)),n.cls=d,n.hash=l,n},{cls:t,hash:String.fromCharCode(this.getBaseClassMixinId(t))}).cls,r=Object.assign(i,{[wa]:this.identitySymbol,[Hn]:this,mix:this.mixinLambda,derive:n=>fe([r,n],s=>class extends s{}),$:this,toString:this.toString.bind(this)});return Object.defineProperty(r,Symbol.hasInstance,{value:Yh}),r}toString(){return this.walkDepthState.linearizedByTopoLevelsSource.reduce((e,t)=>`${t.name}(${e})`,this.baseClass.name)}}Sd.minimalClassesByLinearHash=new Map;Sd.baseClassesIds=new Map;const ES=c=>Object.getPrototypeOf(c.prototype).constructor.hasOwnProperty(Hn),xS=c=>Object.getPrototypeOf(c.prototype).constructor[Hn],RS=(c,e)=>{let t;if(c.length>0){const n=c[c.length-1];!ES(n)&&n!==ua&&(t=n)}const i=[];return c.forEach((n,s)=>{const a=n[Hn];if(a!==void 0){const o=a.baseClass;if(o!==ua)if(t){if(t!==o){const l=o.prototype.isPrototypeOf(t.prototype),d=t.prototype.isPrototypeOf(o.prototype);if(!l&&!d)throw new Error("Base class mismatch");t=d?o:t}}else t=o;i.push(a)}else if(s!==c.length-1)throw new Error("Base class should be provided as the last element of the requirements array")}),Sd.new({requirements:i,mixinLambda:e,baseClass:t||ua}).minimalClass},Yh=function(c){return Boolean(c&&c[this[wa]])},Wt=(c,e)=>Boolean(c&&c[e[wa]]),fe=RS;var Nn;(function(c){c.Millisecond="millisecond",c.Second="second",c.Minute="minute",c.Hour="hour",c.Day="day",c.Week="week",c.Month="month",c.Quarter="quarter",c.Year="year"})(Nn||(Nn={}));var Gh;(function(c){c.MustStartOn="muststarton",c.MustFinishOn="mustfinishon",c.StartNoEarlierThan="startnoearlierthan",c.StartNoLaterThan="startnolaterthan",c.FinishNoEarlierThan="finishnoearlierthan",c.FinishNoLaterThan="finishnolaterthan"})(Gh||(Gh={}));var qh;(function(c){c.Normal="Normal",c.FixedDuration="FixedDuration",c.FixedEffort="FixedEffort",c.FixedUnits="FixedUnits"})(qh||(qh={}));var Kh;(function(c){c[c.NoError=0]="NoError",c[c.CyclicDependency=1]="CyclicDependency",c[c.DuplicatingDependency=2]="DuplicatingDependency"})(Kh||(Kh={}));var Xh;(function(c){c[c.StartToStart=0]="StartToStart",c[c.StartToEnd=1]="StartToEnd",c[c.EndToStart=2]="EndToStart",c[c.EndToEnd=3]="EndToEnd"})(Xh||(Xh={}));var Zh;(function(c){c.Project="Project",c.FromEvent="FromEvent",c.ToEvent="ToEvent"})(Zh||(Zh={}));var Jh;(function(c){c[c.SchedulerBasic=1]="SchedulerBasic",c[c.SchedulerPro=2]="SchedulerPro",c[c.Gantt=3]="Gantt"})(Jh||(Jh={}));var Qh;(function(c){c.Forward="Forward",c.Backward="Backward",c.None="None"})(Qh||(Qh={}));var ef;(function(c){c.Start="Start",c.End="End"})(ef||(ef={}));const En=new Date(-864e13),vr=new Date(864e13);var kr;(function(c){c[c.Left=0]="Left",c[c.Right=1]="Right"})(kr||(kr={}));var It;(function(c){c[c.FullRangeIterated=0]="FullRangeIterated",c[c.StoppedByIterator=1]="StoppedByIterator",c[c.MaxCacheExtendCyclesReached=2]="MaxCacheExtendCyclesReached",c[c.MaxRangeReached=3]="MaxRangeReached"})(It||(It={}));class TS{constructor(e){this.cacheFilledStartDate=vr,this.cacheFilledEndDate=En,this.intervalsCachingChunkDuration=30,this.intervalsCachingChunkUnit=Nn.Day,this.maxCacheExtendCycles=1e3,this.maxRange=5*365*24*60*60*1e3,e&&Object.assign(this,e)}includeWrappingRangeFrom(e,t,i){e.ensureCacheFilledForInterval(t,i),this.intervalCache.includeWrappingRange(e.intervalCache,t,i)}ensureCacheFilledForInterval(e,t){const i=this.cacheFilledStartDate.getTime(),r=this.cacheFilledEndDate.getTime();if(i!==vr.getTime()){const n=e.getTime(),s=t.getTime();if(i<=n&&s<=r)return;if(s<=i)t=new Date(i-1);else if(n>=r)e=new Date(r+1);else if(i<=n&&n<=r)e=new Date(r+1);else if(i<=s&&s<=r)t=new Date(i-1);else{this.ensureCacheFilledForInterval(e,new Date(i-1)),this.ensureCacheFilledForInterval(new Date(r+1),t);return}}(i===vr.getTime()||e.getTime()<r)&&(this.cacheFilledStartDate=e),(r===En.getTime()||r<t.getTime())&&(this.cacheFilledEndDate=t),this.fillCache(e,t)}fillCache(e,t){throw new Error("Abstract method")}clear(){this.cacheFilledStartDate=vr,this.cacheFilledEndDate=En,this.intervalCache.clear()}forEachAvailabilityInterval(e,t,i){var r;i=i||this;const n=e.startDate,s=e.endDate,a=n&&n.getTime(),o=s&&s.getTime(),l=(r=e.maxRange)!==null&&r!==void 0?r:this.maxRange,d=e.isForward!==!1;if(d?!n:!s)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");const u=this.intervalCache;let h=d?n:s,f=d?n:s;const g=f.getTime();for(let m=1;m<this.maxCacheExtendCycles;m++){d?this.ensureCacheFilledForInterval(h,s||b.add(h,this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit)):this.ensureCacheFilledForInterval(n||b.add(h,-this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit),h);let p=u.getIntervalOf(f,d?kr.Left:kr.Right);for(;p;){const v=p.startDate,y=p.endDate;if(d&&o&&v.getTime()>=o||!d&&a&&y.getTime()<=a)return It.FullRangeIterated;if(d&&v.getTime()-g>=l||!d&&g-y.getTime()>=l)return It.MaxRangeReached;if(d&&v.getTime()>this.cacheFilledEndDate.getTime()||!d&&y.getTime()<this.cacheFilledStartDate.getTime())break;f=d?y:v;const C=a&&v.getTime()<a?n:v,D=o&&y.getTime()>o?s:y;if(t.call(i,C,D,p.cacheInterval)===!1)return It.StoppedByIterator;p=d?u.getNextInterval(p):u.getPrevInterval(p)}if(d&&f.getTime()===vr.getTime()||!d&&f.getTime()===En.getTime())return It.FullRangeIterated;h=d?this.cacheFilledEndDate:this.cacheFilledStartDate}return It.MaxCacheExtendCyclesReached}}const MS=c=>Array.from(new Set(c));class Sa{constructor(e){if(this.intervals=[],e&&Object.assign(this,e),!this.calendar)throw new Error("Required attribute `calendar` is missing")}includeInterval(e){if(this.intervals.indexOf(e)==-1){const t=this.intervals.slice();return t.push(e),new Sa({intervals:t,calendar:this.calendar})}else return this}combineWith(e){return new Sa({intervals:this.intervals.concat(e.intervals),calendar:this.calendar})}getIsWorking(){if(this.isWorking!=null)return this.isWorking;const e=this.intervals=this.normalizeIntervals(this.intervals);return this.isWorking=e[0].isWorking}normalizeIntervals(e){const t=MS(e);return t.sort((i,r)=>r.getPriorityField()-i.getPriorityField()),t}}const Zs=(c,e,t=(i,r)=>i-r)=>{let i=0,r=e.length;for(;i<r;){const n=(i+r)/2|0,s=t(c,e[n]);if(s===0)return{found:!0,index:n};s<0?r=n:i=n+1}return{found:!1,index:r}};var Ir;(function(c){c[c.Exact=0]="Exact",c[c.Next=1]="Next"})(Ir||(Ir={}));class kS{constructor(e){this.keys=[],this.values=[],this.comparator=e||((t,i)=>t-i)}set(e,t){const i=Zs(e,this.keys,this.comparator);return i.found?this.values[i.index]=t:(this.keys.splice(i.index,0,e),this.values.splice(i.index,0,t)),i.index}insertAt(e,t,i){this.keys.splice(e,0,t),this.values.splice(e,0,i)}setValueAt(e,t){this.values[e]=t}get(e){const t=Zs(e,this.keys,this.comparator);return t.found?this.values[t.index]:void 0}getEntryAt(e){return e<this.keys.length?{key:this.keys[e],value:this.values[e]}:void 0}getKeyAt(e){return this.keys[e]}getValueAt(e){return this.values[e]}delete(e){const t=Zs(e,this.keys,this.comparator);t.found&&this.deleteAt(t.index)}size(){return this.keys.length}deleteAt(e){this.keys.splice(e,1),this.values.splice(e,1)}indexOfKey(e){const t=Zs(e,this.keys,this.comparator);return{found:t.found?Ir.Exact:Ir.Next,index:t.index}}map(e){const t=this.keys,i=this.values,r=[];for(let n=0;n<t.length;n++)r.push(e(i[n],t[n],n));return r}getAllEntries(){return this.map((e,t)=>({value:e,key:t}))}clear(){this.keys.length=0,this.values.length=0}}class IS{constructor(e){if(this.points=new kS((t,i)=>t.getTime()-i.getTime()),this.leftInfinityKey=En,this.rightInfinityKey=vr,Object.assign(this,e),this.emptyInterval===void 0||!this.combineIntervalsFn)throw new Error("All of `emptyPoint`, `combineIntervalsFn` are required");this.points.set(this.leftInfinityKey,this.emptyInterval)}size(){return this.points.size()}indexOf(e){return this.points.indexOfKey(e)}getDateAt(e){return this.points.getKeyAt(e)}getPointAt(e){return this.points.getValueAt(e)}getIntervalOf(e,t=kr.Left){let{found:i,index:r}=this.indexOf(e),n;return t===kr.Left?n=i===Ir.Exact?r:r-1:n=r-1,this.getIntervalWithStartDateIndex(n)}getPrevInterval(e){return e.startDateIndex===0?null:this.getIntervalWithStartDateIndex(e.startDateIndex-1)}getNextInterval(e){return e.startDateIndex>=this.size()-1?null:this.getIntervalWithStartDateIndex(e.startDateIndex+1)}getIntervalWithStartDateIndex(e){return{startDateIndex:e,startDate:this.getDateAt(e),endDate:e+1<this.size()?this.getDateAt(e+1):this.rightInfinityKey,cacheInterval:this.getPointAt(e)}}addInterval(e,t,i){const r=this.points,{found:n,index:s}=r.indexOfKey(e);let a,o;if(n==Ir.Exact){const l=i(o=r.getValueAt(s));r.setValueAt(s,l),a=s+1}else{const l=i(o=r.getValueAt(s-1));r.insertAt(s,e,l),a=s+1}for(;a<r.size()&&!(r.getKeyAt(a).getTime()>=t.getTime());){const d=i(o=r.getValueAt(a));r.setValueAt(a,d),a++}a===r.size()?r.insertAt(r.size(),t,this.emptyInterval):r.getKeyAt(a).getTime()===t.getTime()||r.insertAt(a,t,o)}includeWrappingRange(e,t,i){let r=e.getIntervalOf(t);for(;r&&(this.addInterval(r.startDate,r.endDate,n=>this.combineIntervalsFn(n,r.cacheInterval)),!(r.endDate.getTime()>i.getTime()));)r=e.getNextInterval(r)}getSummary(){return this.points.map((e,t)=>({label:e,date:t}))}clear(){this.points.clear(),this.points.set(this.leftInfinityKey,this.emptyInterval)}}class FS extends TS{constructor(e){if(super(e),this.staticIntervalsCached=!1,!this.unspecifiedTimeInterval)throw new Error("Required attribute `unspecifiedTimeInterval` is missing");this.intervalCache=new IS({emptyInterval:new Sa({intervals:[this.unspecifiedTimeInterval],calendar:this.calendar}),combineIntervalsFn:(t,i)=>t.combineWith(i)})}fillCache(e,t){var i;this.staticIntervalsCached||(this.cacheStaticIntervals(),this.staticIntervalsCached=!0),this.parentCache&&this.includeWrappingRangeFrom(this.parentCache,e,t);const r=e.getTime(),n=t.getTime(),s=(i=this.calendar.project)===null||i===void 0?void 0:i.timeZone;if(r>n)throw new Error("Invalid cache fill interval");this.forEachRecurrentInterval(a=>{const o=a.getStartDateSchedule(),l=a.getEndDateSchedule();let d=o.prev(1,e),u;if(l==="EOD"){const g=o.next(1,t);g!==it.NEVER?u=b.getStartOfNextDay(g,!0):u=it.NEVER}else u=l.next(1,t);if(d!==it.NEVER&&d.getTime()===r){const g=o.prev(2,e);g!==it.NEVER&&g.length===2&&(d=g[1])}if(u!==it.NEVER&&u.getTime()===n){const g=l.next(2,t);g!==it.NEVER&&g.length===2&&(u=g[1])}const h=o.next(1/0,d!==it.NEVER?d:e,u!==it.NEVER?new Date(u.getTime()-1):t);if(h===it.NEVER)return;const f=l==="EOD"?h.map(g=>b.getStartOfNextDay(g,!0)):l.next(1/0,new Date(h[0].getTime()+1),u!==it.NEVER?u:t);f!==it.NEVER&&(f.length>h.length?f.length=h.length:f.length<h.length&&(h.length=f.length),h.forEach((g,m)=>{let p=g,v=f[m];s!=null&&(p=Xe.toTimeZone(p,s),v=Xe.toTimeZone(v,s)),this.intervalCache.addInterval(p,v,y=>y.includeInterval(a))}))})}clear(){this.staticIntervalsCached=!1,super.clear()}cacheStaticIntervals(){this.forEachStaticInterval(e=>{var t;const i=(t=this.calendar.project)===null||t===void 0?void 0:t.timeZone;let{startDate:r,endDate:n}=e;i!=null&&(r=Xe.toTimeZone(r,i),n=Xe.toTimeZone(n,i)),this.intervalCache.addInterval(r,n,s=>s.includeInterval(e))})}forEachStaticInterval(e){this.intervalStore.forEach(t=>{t.isStatic()&&e(t)})}forEachRecurrentInterval(e){this.intervalStore.forEach(t=>{t.isRecurrent()&&e(t)})}}class Dd extends fe([],e=>{e.prototype;class t extends e{async commitAsync(){return this.project.commitAsync()}set project(r){this.$project=r}get project(){return this.$project}calculateProject(){throw new Error("Implement me")}setProject(r){return this.project=r}getProject(){return this.project?this.project:this.setProject(this.calculateProject())}getAssignmentStore(){const r=this.getProject();return r?.assignmentStore}getDependencyStore(){const r=this.getProject();return r?.dependencyStore}getEventStore(){const r=this.getProject();return r?.eventStore}getResourceStore(){const r=this.getProject();return r?.resourceStore}getCalendarManagerStore(){const r=this.getProject();return r?.calendarManagerStore}}return t}){}class Ut extends fe([Dd,se],e=>{const t=e.prototype;class i extends e{constructor(){super(...arguments),this.isLoadingData=!1,this.disableHasLoadedDataToCommitFlag=!1}construct(n={}){return n.asyncEvents={add:!0,remove:!0,removeAll:!0,change:!0,refresh:!0,replace:!0,move:!0,update:!0},t.construct.call(this,n)}trigger(n,s){const a=this,{asyncEvents:o,project:l}=a,d=o?.[n];return d&&(d===!0||d[s.action])?(t.trigger.call(a,`${n}PreCommit`,F({},s)),!l||l.isEngineReady()&&!l.isWritingData?t.trigger.call(a,n,s):!a.eventsSuspended&&l&&(l.dataReadyDetacher||(l.queuedDataReadyEvents=[],l.dataReadyDetacher=l.ion({dataReady(){this.queuedDataReadyEvents.forEach(([h,f,g,m])=>{h.trigger.call(f,g,m)}),l.queuedDataReadyEvents=null,l.dataReadyDetacher(),l.dataReadyDetacher=null},once:!0})),l.queuedDataReadyEvents.push([t,a,n,s])),!0):t.trigger.call(a,n,s)}calculateProject(){return this.project}setStoreData(n){var s;this.project&&!(this.syncDataOnLoad||this.disableHasLoadedDataToCommitFlag)&&(this.project.hasLoadedDataToCommit=!0),this.isLoadingData=!0,t.setStoreData.call(this,n),this.isLoadingData=!1,(s=this.project)===null||s===void 0||s.trigger("storeRefresh",{store:this})}async doAutoCommit(){this.suspendCount<=0&&this.project&&!this.project.isEngineReady()&&await this.project.commitAsync(),t.doAutoCommit.call(this)}async addAsync(n,s){const a=this.add(n,s);return await this.project.commitAsync(),a}async insertAsync(n,s,a){const o=this.insert(n,s,a);return await this.project.commitAsync(),o}async loadDataAsync(n){this.data=n,await this.project.commitAsync()}}return i}){}class so extends fe([Dd,de],e=>{const t=e.prototype;class i extends e{joinStore(n){let s=null;if(Wt(n,Ut)){const a=n.getProject();a&&!this.getProject()&&(this.setProject(a),s=a)}t.joinStore.call(this,n),s&&!s.isRepopulatingStores&&this.joinProject()}unjoinStore(n,s=!1){t.unjoinStore.call(this,n,s);const a=this.getProject(),o=Wt(n,Ut)&&a===n.getProject();a&&!a.isDestroying&&!a.isRepopulatingStores&&o&&(this.leaveProject(s),this.setProject(null)),o&&(this.graph=null)}joinProject(){}leaveProject(n=!1){}calculateProject(){const n=this.stores.find(s=>Wt(s,Ut)&&!!s.getProject());return n?.getProject()}async setAsync(n,s,a){var o;const l=this.set(n,s,a);return await((o=this.project)===null||o===void 0?void 0:o.commitAsync()),l}async getAsync(n){var s;return await((s=this.project)===null||s===void 0?void 0:s.commitAsync()),this.get(n)}get isStmRestoring(){const n=this.getProject();return n?.isRestoringData||n?.stm.isRestoring||!1}}return i}){}class km extends fe([so],e=>{e.prototype;class t extends e{static get fields(){return["name",{name:"startDate",type:"date"},{name:"endDate",type:"date"},"recurrentStartDate","recurrentEndDate","cls","iconCls",{name:"isWorking",type:"boolean",defaultValue:!1},{name:"priority",type:"number"}]}getCalendar(){return this.stores[0].calendar}resetPriority(){this.priorityField=null,this.getCalendar().getDepth()}getPriorityField(){if(this.priorityField!=null)return this.priorityField;let r=1e4+this.getCalendar().getDepth()*100,n=this.priority;return n==null&&(n=this.isRecurrent()?20:30),this.priorityField=r+n}isRecurrent(){return Boolean(this.recurrentStartDate&&this.recurrentEndDate&&this.getStartDateSchedule()&&this.getEndDateSchedule())}isStatic(){return Boolean(this.startDate&&this.endDate)}parseDateSchedule(r){let n=r;if(r&&r!==Object(r)&&(n=it.parse.text(r),n!==Object(n)||n.error>=0))try{n=JSON.parse(r)}catch{return null}return n}getStartDateSchedule(){if(this.startDateSchedule)return this.startDateSchedule;const r=this.parseDateSchedule(this.recurrentStartDate);return this.startDateSchedule=it.schedule(r)}getEndDateSchedule(){if(this.endDateSchedule)return this.endDateSchedule;if(this.recurrentEndDate==="EOD")return"EOD";const r=this.parseDateSchedule(this.recurrentEndDate);return this.endDateSchedule=it.schedule(r)}}return t}){}class AS extends fe([Ut],e=>{e.prototype;class t extends e{constructor(){super(...arguments),this.disableHasLoadedDataToCommitFlag=!0}static get defaultConfig(){return{modelClass:km}}}return t}){}class LS extends fe([km],e=>{e.prototype;class t extends e{getCalendar(){return this.calendar}getPriorityField(){return this.priorityField!=null?this.priorityField:this.priorityField=this.getCalendar().getDepth()}}return t}){}class Ed extends fe([Dd],e=>{e.prototype;class t extends e{get eventStore(){var r;return(r=this.project)===null||r===void 0?void 0:r.eventStore}get resourceStore(){var r;return(r=this.project)===null||r===void 0?void 0:r.resourceStore}get assignmentStore(){var r;return(r=this.project)===null||r===void 0?void 0:r.assignmentStore}get dependencyStore(){var r;return(r=this.project)===null||r===void 0?void 0:r.dependencyStore}get calendarManagerStore(){var r;return(r=this.project)===null||r===void 0?void 0:r.calendarManagerStore}getEventById(r){var n;return(n=this.eventStore)===null||n===void 0?void 0:n.getById(r)}getDependencyById(r){var n;return(n=this.dependencyStore)===null||n===void 0?void 0:n.getById(r)}getResourceById(r){var n;return(n=this.resourceStore)===null||n===void 0?void 0:n.getById(r)}getAssignmentById(r){var n;return(n=this.assignmentStore)===null||n===void 0?void 0:n.getById(r)}getCalendarById(r){var n;return(n=this.calendarManagerStore)===null||n===void 0?void 0:n.getById(r)}}return t}){}class OS extends fe([so],e=>{const t=e.prototype;class i extends e{constructor(){super(...arguments),this.version=1}static get fields(){return[{name:"version",type:"number"},"name",{name:"unspecifiedTimeIsWorking",type:"boolean",defaultValue:!0},{name:"intervals",type:"store",subStore:!0},"cls","iconCls"]}get intervalStoreClass(){return AS}get intervalStore(){return this.meta.intervalsStore}initIntervalsStore(n){n.storeClass=this.intervalStoreClass,n.modelClass=this.getDefaultConfiguration().calendarIntervalModelClass||this.intervalStoreClass.defaultConfig.modelClass,n.calendar=this}processIntervalsStoreData(n){this.bumpVersion()}isDefault(){const n=this.getProject();return n?this===n.defaultCalendar:!1}getDepth(){return this.childLevel+1}forEachAvailabilityInterval(n,s,a){const o=this.getProject().maxCalendarRange;return o&&(n=Object.assign({maxRange:o},n)),this.calendarCache.forEachAvailabilityInterval(n,s,a)}accumulateWorkingTime(n,s,a){if(s===0)return{finalDate:new Date(n),remainingDurationInMs:0};if(isNaN(s))throw new Error("Invalid duration");let o=n;const l=this.getProject().adjustDurationToDST;return this.forEachAvailabilityInterval(a?{startDate:n,isForward:!0}:{endDate:n,isForward:!1},(d,u,h)=>{let f=!0;if(h.getIsWorking()){let g=u.getTime()-d.getTime();s<=g?(l&&(s-=(a?d.getTimezoneOffset()-new Date(d.getTime()+s).getTimezoneOffset():new Date(u.getTime()-s).getTimezoneOffset()-u.getTimezoneOffset())*60*1e3),o=a?new Date(d.getTime()+s):new Date(u.getTime()-s),s=0,f=!1):(l&&(g+=(d.getTimezoneOffset()-u.getTimezoneOffset())*60*1e3),o=a?u:d,s-=g)}return f}),{finalDate:new Date(o),remainingDurationInMs:s}}calculateDurationMs(n,s,a=!1){let o=0;const l=n.getTime()<=s.getTime()||!a?1:-1;l<0&&([n,s]=[s,n]);const d=this.getProject().adjustDurationToDST;return this.forEachAvailabilityInterval({startDate:n,endDate:s},(u,h,f)=>{f.getIsWorking()&&(o+=h.getTime()-u.getTime(),d&&(o+=(u.getTimezoneOffset()-h.getTimezoneOffset())*60*1e3))}),o*l}calculateEndDate(n,s){const a=s>=0,o=this.accumulateWorkingTime(n,Math.abs(s),a);return o.remainingDurationInMs===0?o.finalDate:null}calculateStartDate(n,s){const a=s<=0,o=this.accumulateWorkingTime(n,Math.abs(s),a);return o.remainingDurationInMs===0?o.finalDate:null}skipNonWorkingTime(n,s=!0){let a;const o=this.forEachAvailabilityInterval(s?{startDate:n,isForward:!0}:{endDate:n,isForward:!1},(l,d,u)=>{if(u.getIsWorking())return a=s?l:d,!1});return o===It.MaxRangeReached||o===It.FullRangeIterated?"empty_calendar":a?new Date(a):new Date(n)}addInterval(n){return this.addIntervals([n])}addIntervals(n){return this.bumpVersion(),this.intervalStore.add(n)}removeInterval(n){return this.removeIntervals([n])}removeIntervals(n){return this.bumpVersion(),this.intervalStore.remove(n)}clearIntervals(n){return n||this.bumpVersion(),this.intervalStore.removeAll(n)}bumpVersion(){this.clearCache(),this.version++}get calendarCache(){if(this.$calendarCache!==void 0)return this.$calendarCache;const n=new LS({isWorking:this.unspecifiedTimeIsWorking});return n.calendar=this,this.$calendarCache=new FS({calendar:this,unspecifiedTimeInterval:n,intervalStore:this.intervalStore,parentCache:this.parent&&!this.parent.isRoot?this.parent.calendarCache:null})}clearCache(){this.$calendarCache&&this.$calendarCache.clear(),this.$calendarCache=void 0}resetPriorityOfAllIntervals(){this.traverse(n=>{n.intervalStore.forEach(s=>s.resetPriority())})}insertChild(n,s,a){let o=t.insertChild.call(this,...arguments);return Array.isArray(o)||(o=[o]),o.forEach(l=>{l.bumpVersion(),l.resetPriorityOfAllIntervals()}),o}joinProject(){t.joinProject.call(this),this.intervalStore.setProject(this.getProject())}leaveProject(){t.leaveProject.call(this),this.intervalStore.setProject(null),this.clearCache()}doDestroy(){this.leaveProject(),this.intervalStore.destroy(),super.doDestroy()}isDayHoliday(n){const s=b.clearTime(n),a=b.getNext(n,Nn.Day);let o=!1;return this.forEachAvailabilityInterval({startDate:s,endDate:a,isForward:!0},(l,d,u)=>(o=u.getIsWorking(),!o)),!o}getDailyHolidaysRanges(n,s){const a=[];for(n=b.clearTime(n);n<s;)this.isDayHoliday(n)&&a.push({startDate:n,endDate:b.getStartOfNextDay(n,!0,!0)}),n=b.getNext(n,Nn.Day);return a}getWorkingTimeRanges(n,s){const a=[];return this.forEachAvailabilityInterval({startDate:n,endDate:s,isForward:!0},(o,l,d)=>{if(d.getIsWorking()){const u=d.intervals[0];a.push({name:u.name,startDate:o,endDate:l})}}),a}getNonWorkingTimeRanges(n,s){const a=[];return this.forEachAvailabilityInterval({startDate:n,endDate:s,isForward:!0},(o,l,d)=>{if(!d.getIsWorking()){const u=d.intervals[0];a.push({name:u.name,iconCls:u.iconCls,cls:u.cls,startDate:o,endDate:l})}}),a}isWorkingTime(n,s,a){if(a){let o;const l=this.forEachAvailabilityInterval({startDate:n,endDate:s,isForward:!0},(d,u,h)=>{if(h.getIsWorking()&&d<=n&&u>=s)return o=!0,!1});return l===It.MaxRangeReached||l===It.FullRangeIterated?!1:o}else{const o=this.skipNonWorkingTime(n);return o&&o!=="empty_calendar"?s?o<s:o.getTime()===n.getTime():!1}}}return i}){}class PS extends fe([so],e=>{const t=e.prototype;class i extends e{getAssignmentFor(n){for(const a of(s=this.assigned)!==null&&s!==void 0?s:[]){var s;if(a.resource===n)return a}return null}isAssignedTo(n){return Boolean(this.getAssignmentFor(n))}async assign(n){const s=this.project.assignmentStore.modelClass;return this.addAssignment(new s({event:this,resource:n})),this.commitAsync()}async unassign(n){const s=this.getAssignmentFor(n);return this.removeAssignment(s),this.commitAsync()}leaveProject(){if(this.isInActiveTransaction&&this.assigned){const n=this.getEventStore();this.assigned.forEach(s=>n.assignmentsForRemoval.add(s))}t.leaveProject.call(this,...arguments)}remove(){if(this.parent){const n=this.getEventStore();t.remove.call(this),n&&n.afterEventRemoval()}else return t.remove.call(this)}addAssignment(n){return this.getProject().assignmentStore.add(n),n}removeAssignment(n){return this.getProject().assignmentStore.remove(n),n}}return i}){}class ss extends fe([so,Ed,de],e=>{const t=e.prototype;class i extends e{constructor(){super(...arguments),this.$isCalculating=!1,this.$changed={},this.$beforeChange={}}get isInActiveTransaction(){return!0}joinProject(){this.invalidate()}leaveProject(n=!1){var s;t.leaveProject.call(this,n),(s=this.project)===null||s===void 0||s.bufferedCommitAsync()}invalidate(){var n;(n=this.project)===null||n===void 0||n.invalidate(this)}getCurrentOrProposed(n){var s;return n in this.$changed&&this.$changed[n]!==!0?this.$changed[n]:(s=this.get(n))!==null&&s!==void 0?s:null}hasCurrentOrProposed(n){return n in this.$changed&&this.$changed[n]!=!0||this.get(n)!=null}propose(n){var s;if(this.project||(s=this.recurringTimeSpan)!==null&&s!==void 0&&s.project){const a=Object.keys(n);for(let o=0;o<a.length;o++){const l=a[o];this.$changed[l]=n[l]}this.invalidate()}else this.set(n)}setChanged(n,s,a=!0,o=!1){const l=this;l.$changed[n]=s,o&&(n in l.$beforeChange||(l.$beforeChange[n]=l.get(n)),l.setData(n,s)),a&&l.invalidate()}calculateInvalidated(){}finalizeInvalidated(n=!1){const s=this;s.$isCalculating=!0,n?s.setData(s.$changed):(s.setData(s.$beforeChange),s.set(s.$changed)),s.$changed={},s.$beforeChange={},s.$isCalculating=!1}}return i}){}const Im=c=>c instanceof Set||c instanceof Array?Li(c):Li([c]),$S=c=>new Promise(e=>setTimeout(e,c));class _S extends fe([Ut],e=>{const t=e.prototype;class i extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.allAssignmentsForRemoval=!1}remove(n,s){this.assignmentsForRemoval=Im(n).toSet();const a=t.remove.call(this,n,s);return this.assignmentsForRemoval.clear(),a}removeAll(n){this.allAssignmentsForRemoval=!0;const s=t.removeAll.call(this,n);return this.allAssignmentsForRemoval=!1,s}}return i}){}class HS extends fe([Ut],e=>{e.prototype;class t extends e{doDestroy(){var r;const n=[];(r=this.rootNode)!==null&&r!==void 0&&r.isDestroyed||this.traverse(s=>n.push(s)),super.doDestroy(),n.forEach(s=>s.destroy())}}return t}){}class NS extends fe([Ut],e=>{const t=e.prototype;class i extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}remove(n,s){this.dependenciesForRemoval=Im(n).toSet();const a=t.remove.call(this,n,s);return this.dependenciesForRemoval.clear(),a}removeAll(n){this.allDependenciesForRemoval=!0;const s=t.removeAll.call(this,n);return this.allDependenciesForRemoval=!1,s}}return i}){}const BS={splice:1,clear:1};class zS extends fe([Ut],e=>{const t=e.prototype;class i extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.dependenciesForRemoval=new Set}onDataChange(n){var s;const a=BS[n.action];super.onDataChange(n),a&&(s=n.removed)!==null&&s!==void 0&&s.length&&this.afterEventRemoval()}remove(n,s){const a=t.remove.call(this,n,s);return this.afterEventRemoval(),a}removeAll(n){const s=t.removeAll.call(this,n);return this.afterEventRemoval(),s}onNodeRemoveChild(n,s,a,o){const l=t.onNodeRemoveChild.call(this,...arguments);return this.afterEventRemoval(),l}afterEventRemoval(){const{assignmentsForRemoval:n,dependenciesForRemoval:s}=this;if(!n)return;const a=this.getAssignmentStore();if(a&&!a.allAssignmentsForRemoval&&n.size){const l=[...n].filter(d=>!a.assignmentsForRemoval.has(d));l.length>0&&a.remove(l)}n.clear();const o=this.getDependencyStore();if(o&&!o.allDependenciesForRemoval&&s.size){const l=[...s].filter(d=>!o.dependenciesForRemoval.has(d));l.length>0&&o.remove(l)}s.clear()}processRecord(n,s=!1){var a;if(!((a=this.project)!==null&&a!==void 0&&a.isRepopulatingStores)){const o=this.getById(n.id);if(o&&o!==n&&o.assigned)for(const d of o.assigned)d.event=n}return n}}return i}){}const VS={splice:1,clear:1};class jS extends fe([Ut],e=>{const t=e.prototype;class i extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set}onDataChange(n){var s;const a=VS[n.action];super.onDataChange(n),a&&(s=n.removed)!==null&&s!==void 0&&s.length&&this.afterResourceRemoval()}remove(n,s){const a=t.remove.call(this,n,s);return this.afterResourceRemoval(),a}removeAll(n){const s=t.removeAll.call(this,n);return this.afterResourceRemoval(),s}afterResourceRemoval(){const n=this.getAssignmentStore();if(n&&!n.allAssignmentsForRemoval){const s=[...this.assignmentsForRemoval].filter(a=>!n.assignmentsForRemoval.has(a));s.length>0&&n.remove(s)}this.assignmentsForRemoval.clear()}processRecord(n,s=!1){const a=this.getById(n.id);if(a&&a!==n)for(const l of a.assigned||[])l.resource=n;return n}}return i}){}class Si extends fe([ss],e=>{const t=e.prototype;class i extends e{constructor(){super(...arguments),this._startDate=null,this._endDate=null,this._duration=null}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number"},{name:"durationUnit",type:"durationunit",defaultValue:"day"}]}get startDate(){var n,s;return(n=(s=this._startDate)!==null&&s!==void 0?s:this.get("startDate"))!==null&&n!==void 0?n:null}get endDate(){var n,s;return(n=(s=this._endDate)!==null&&s!==void 0?s:this.get("endDate"))!==null&&n!==void 0?n:null}get duration(){var n,s;return(n=(s=this._duration)!==null&&s!==void 0?s:this.get("duration"))!==null&&n!==void 0?n:null}set startDate(n){this.proposeStartDate(n)}set endDate(n){this.proposeEndDate(n)}set duration(n){this.proposeDuration(n)}inSet(n,s,a,o,l){const d=this;return d.project&&!d.project.isWritingData&&typeof n!="string"&&!l&&("startDate"in n&&!("startDate"in d.$changed)&&(d.$changed.startDate=!0,d.invalidate()),"endDate"in n&&!("endDate"in d.$changed)&&(d.$changed.endDate=!0,d.invalidate())),t.inSet.call(d,n,s,a,o,l)}getStartDate(){return this.startDate}proposeStartDate(n,s=!("endDate"in this.$changed)){var a;(this.inSetting||n?.getTime()!==((a=this.startDate)===null||a===void 0?void 0:a.getTime()))&&(this._startDate=n,this.propose({startDate:n,keepDuration:s}))}async setStartDate(n,s=!0){var a;return this.proposeStartDate(n,s),(a=this.project)===null||a===void 0?void 0:a.commitAsync()}getEndDate(){return this.endDate}proposeEndDate(n,s=!1){var a;(this.inSetting||n?.getTime()!==((a=this.endDate)===null||a===void 0?void 0:a.getTime()))&&(this._endDate=n,this.propose({endDate:n,keepDuration:s}))}async setEndDate(n,s=!1){var a;return this.proposeEndDate(n,s),(a=this.project)===null||a===void 0?void 0:a.commitAsync()}getDuration(){return this.duration}proposeDuration(n,s,a=!0){this._duration=n,this.propose({duration:n,keepStart:a}),s&&this.propose({durationUnit:s})}async setDuration(n,s,a=!0){var o;return this.proposeDuration(n,s,a),(o=this.project)===null||o===void 0?void 0:o.commitAsync()}getDurationUnit(){return this.durationUnit}joinProject(){const n=this,s=n.$changed,a=n.getCurrentOrProposed("startDate"),o=n.getCurrentOrProposed("endDate"),l=n.getCurrentOrProposed("duration");if(a!=null&&(s.startDate=n._startDate=a),o!=null&&(s.endDate=n._endDate=o),l!=null&&(s.duration=n._duration=l),n.eventStore&&!n.eventStore.isLoadingData){var d;const h=(d=n.assignmentStore)===null||d===void 0?void 0:d.storage.findItem("event",null);if(h){var u;const f=(u=n.assignmentStore)===null||u===void 0?void 0:u.storage.findItem("eventId",n.id);if(f)for(const g of f)g.setChanged("event",n);else for(const g of h)g.getCurrentOrProposed("event")===n.id&&g.setChanged("event",n)}}t.joinProject.call(n)}applyValue(n,s,a,o,l){var d;(this.project||(d=this.recurringTimeSpan)!==null&&d!==void 0&&d.project)&&((s==="startDate"||s=="duration"||s==="endDate")&&(n=!0,this["_"+s]=a),o&&(n=!1)),t.applyValue.call(this,n,s,a,o,l)}afterChange(n,s,a,o,l){!this.$isCalculating&&!l&&this.setData({startDate:this.getCurrentOrProposed("startDate"),endDate:this.getCurrentOrProposed("endDate"),duration:this.getCurrentOrProposed("duration"),durationUnit:this.getCurrentOrProposed("durationUnit")}),t.afterChange.call(this,n,s,a,o,l)}calculateInvalidated(){const n=this,s=n.$changed,a="startDate"in s,o="endDate"in s,l="duration"in s,{startDate:d,endDate:u,duration:h,keepDuration:f,keepStart:g}=s;let m=null;a&&!o&&!l?d===null?s.endDate=null:n.hasCurrentOrProposed("endDate")&&d>n.getCurrentOrProposed("endDate")&&!f?(s.endDate=d,s.duration=0):n.hasCurrentOrProposed("duration")&&(f||!n.hasCurrentOrProposed("endDate"))?m="endDate":n.hasCurrentOrProposed("endDate")&&(m="duration"):!a&&o&&!l?u===null?s.startDate=null:n.hasCurrentOrProposed("startDate")&&!f&&u!==!0&&u<n.getCurrentOrProposed("startDate")?(s.startDate=u,s.duration=0):n.hasCurrentOrProposed("duration")&&(f||!n.hasCurrentOrProposed("startDate"))?m="startDate":n.hasCurrentOrProposed("startDate")&&(m="duration"):!a&&!o&&l?h===null?s.endDate=null:n.hasCurrentOrProposed("startDate")&&(g||!n.hasCurrentOrProposed("endDate"))?(g&&s.duration<0&&(s.duration=0),m="endDate"):n.hasCurrentOrProposed("endDate")&&(m="startDate"):a&&o&&!l?d===null&&u===null?s.duration=null:m="duration":a&&!o&&l?m="endDate":!a&&o&&l?m="startDate":a&&o&&l&&(h==null?m="duration":d==null?m="startDate":m="endDate");const p=n.getCurrentOrProposed("startDate"),v=n.getCurrentOrProposed("endDate"),y=n.getCurrentOrProposed("duration"),C=n.getCurrentOrProposed("durationUnit");let D,w;switch(m){case"startDate":s.startDate=b.add(v,-y,C);break;case"endDate":D=b.as("hour",y,C),w=b.as(C,D,"h"),s.endDate=b.add(p,w,C);break;case"duration":D=b.diff(p,v,"h"),s.duration=b.as(C,D,"h");break}"startDate"in s&&s.startDate!==!0&&(this._startDate=s.startDate),"endDate"in s&&s.endDate!==!0&&(this._endDate=s.endDate),"duration"in s&&s.duration!==!0&&(this._duration=s.duration),delete s.keepDuration,delete s.keepStart}}return i}){}class Bn extends fe([ss],e=>{const t=e.prototype;class i extends e{get assigned(){var n;return(n=this.project)===null||n===void 0?void 0:n.assignmentStore.getResourcesAssignments(this)}joinProject(){if(this.resourceStore&&!this.resourceStore.isLoadingData){var n;(n=this.assignmentStore)===null||n===void 0||n.query(s=>s.get("resource")===this.id).forEach(s=>s.setChanged("resource",this))}t.joinProject.call(this)}leaveProject(n=!1){if(this.assigned&&!n){const s=this.resourceStore;this.assigned.forEach(a=>s.assignmentsForRemoval.add(a))}t.leaveProject.call(this)}applyValue(n,s,a,o,l){l?.name==="id"&&this.assigned.forEach(d=>{d.set("resourceId",a)}),t.applyValue.call(this,n,s,a,o,l)}}return i}){}class xd extends fe([ss],e=>{const t=e.prototype;class i extends e{static get fields(){return[{name:"resource",isEqual:(n,s)=>n===s,persist:!1},{name:"event",isEqual:(n,s)=>n===s,persist:!1}]}setChanged(n,s,a){const{assignmentStore:o,eventStore:l,resourceStore:d,project:u}=this;let h=!1;if(n==="event"){const f=Wt(s,Si)?s:l?.$master.getById(s);f&&(h=!0),s=f||s}if(n==="resource"){const f=Wt(s,Bn)?s:d?.$master.getById(s);f&&(h=!0),s=f||s}t.setChanged.call(this,n,s,a,!0),o&&h&&!u.isPerformingCommit&&!o.isLoadingData&&!d.isLoadingData&&!o.skipInvalidateIndices&&o.invalidateIndices()}joinProject(){t.joinProject.call(this),this.setChanged("event",this.get("event")),this.setChanged("resource",this.get("resource"))}calculateInvalidated(){let{event:n=this.event,resource:s=this.resource}=this.$changed;if(n!==null&&!Wt(n,Si)){var a;const l=(a=this.eventStore)===null||a===void 0?void 0:a.getById(n);l&&this.setChanged("event",l,!1)}if(s!==null&&!Wt(s,Bn)){var o;const l=(o=this.resourceStore)===null||o===void 0?void 0:o.getById(s);l&&this.setChanged("resource",l,!1)}}finalizeInvalidated(n){const s=this.$changed;if("resource"in s){var a;s.resourceId=(a=s.resource)!==null&&a!==void 0&&a.isModel?s.resource.id:s.resource}if("event"in s){var o;s.eventId=(o=s.event)!==null&&o!==void 0&&o.isModel?s.event.id:s.event}t.finalizeInvalidated.call(this,n)}set event(n){this.setChanged("event",n)}get event(){const n=this.get("event");return n?.id!=null?n:null}set resource(n){this.setChanged("resource",n)}get resource(){const n=this.get("resource");return n?.id!=null?n:null}}return i}){}class as extends fe([Ut,Ed,se],e=>{const t=e.prototype;class i extends e{setProject(n){const s=t.setProject.call(this,n);return n&&this.joinProject(n),s}joinProject(n){}onCommitAsync(){}}return i}){}const tf=new Set;class Fm extends fe([_S,as],e=>{e.prototype;class t extends e{constructor(){super(...arguments),this.skipInvalidateIndices=!1}static get defaultConfig(){return{modelClass:xd,storage:{extraKeys:[{property:"event",unique:!1},{property:"resource",unique:!1},{property:"eventId",unique:!1}]}}}set data(r){this.allAssignmentsForRemoval=!0,super.data=r,this.allAssignmentsForRemoval=!1}getEventsAssignments(r){return this.storage.findItem("event",r,!0)||tf}getResourcesAssignments(r){return this.storage.findItem("resource",r.$original,!0)||tf}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}afterLoadData(){this.eventStore&&this.linkAssignments(this.eventStore,"event"),this.resourceStore&&this.linkAssignments(this.resourceStore,"resource")}linkAssignments(r,n){r=r.masterStore||r;const s=this.count&&this.storage.findItem(n,null,!0);if(s){for(const a of s){const o=r.getById(a.getCurrentOrProposed(n));o&&a.setChanged(n,o)}this.invalidateIndices()}}unlinkAssignments(r){this.forEach(n=>{var s,a,o;return n.setChanged(r,(s=(a=(o=n[r])===null||o===void 0?void 0:o.id)!==null&&a!==void 0?a:n?.getData(r))!==null&&s!==void 0?s:n[r+"Id"])}),this.invalidateIndices()}onCommitAsync(){this.updateIndices()}}return t}){}class Am extends fe([OS,ss],e=>{e.prototype;class t extends e{}return t}){}class WS extends fe([HS,as],e=>{e.prototype;class t extends e{static get defaultConfig(){return{tree:!0,modelClass:Am}}}return t}){}class Rd extends fe([ss],e=>{const t=e.prototype;class i extends e{static get fields(){return[{name:"fromEvent",isEqual:(n,s)=>n===s,persist:!1},{name:"toEvent",isEqual:(n,s)=>n===s,persist:!1}]}setChanged(n,s,a){var o;let l=!1;if(n==="fromEvent"||n==="toEvent"){var d;const h=Wt(s,Si)?s:(d=this.eventStore)===null||d===void 0?void 0:d.getById(s);h&&(l=!0),s=h||s}if(t.setChanged.call(this,n,s,a,!0),l&&!this.project.isPerformingCommit&&!((o=this.dependencyStore)!==null&&o!==void 0&&o.isLoadingData)){var u;(u=this.dependencyStore)===null||u===void 0||u.invalidateIndices()}}joinProject(){t.joinProject.call(this),this.setChanged("fromEvent",this.get("fromEvent")),this.setChanged("toEvent",this.get("toEvent"))}calculateInvalidated(){let{fromEvent:n,toEvent:s}=this.$changed;if(n!==null&&!Wt(n,Si)){var a;const l=(a=this.eventStore)===null||a===void 0?void 0:a.getById(n);l&&(this.$changed.fromEvent=l)}if(s!==null&&!Wt(s,Si)){var o;const l=(o=this.eventStore)===null||o===void 0?void 0:o.getById(s);l&&(this.$changed.toEvent=l)}}set fromEvent(n){this.setChanged("fromEvent",n)}get fromEvent(){const n=this.get("fromEvent");return n?.id!=null?n:null}set toEvent(n){this.setChanged("toEvent",n)}get toEvent(){const n=this.get("toEvent");return n?.id!=null?n:null}}return i}){}const rf=new Set;class Lm extends fe([NS,as],e=>{e.prototype;class t extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}static get defaultConfig(){return{modelClass:Rd,storage:{extraKeys:[{property:"fromEvent",unique:!1},{property:"toEvent",unique:!1}]}}}getIncomingDepsForEvent(r){return this.storage.findItem("toEvent",r)||rf}getOutgoingDepsForEvent(r){return this.storage.findItem("fromEvent",r)||rf}set data(r){this.allDependenciesForRemoval=!0,super.data=r,this.allDependenciesForRemoval=!1}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}onCommitAsync(){this.updateIndices()}}return t}){}class US extends fe([Si,PS],e=>{const t=e.prototype;class i extends e{get assigned(){var n,s;return(n=(s=this.project)===null||s===void 0?void 0:s.assignmentStore.getEventsAssignments(this))!==null&&n!==void 0?n:this.$cachedAssignments}leaveProject(n=!1){this.$cachedAssignments=this.assigned,super.leaveProject(n)}applyValue(n,s,a,o,l){if(s==="id"){var d;(d=this.assigned)===null||d===void 0||d.forEach(u=>u.set("eventId",a))}t.applyValue.call(this,n,s,a,o,l)}copy(n=null,s=null){const a=t.copy.call(this,n,s);return(T.isObject(s)&&!s.skipFieldIdentifiers||!T.isObject(s))&&(a.$cachedAssignments=this.assigned),a}}return i}){}class YS extends fe([Si],e=>{const t=e.prototype;class i extends e{get outgoingDeps(){return this.project.dependencyStore.getOutgoingDepsForEvent(this)}get incomingDeps(){return this.project.dependencyStore.getIncomingDepsForEvent(this)}leaveProject(){const n=this.eventStore;this.outgoingDeps&&this.outgoingDeps.forEach(s=>n.dependenciesForRemoval.add(s)),this.incomingDeps&&this.incomingDeps.forEach(s=>n.dependenciesForRemoval.add(s)),t.leaveProject.call(this)}}return i}){}class Td extends fe([Si,US,YS],e=>{e.prototype;class t extends e{}return t}){}class Om extends fe([zS,as],e=>{e.prototype;class t extends e{static get defaultConfig(){return{modelClass:Td}}joinProject(){var r;(r=this.assignmentStore)===null||r===void 0||r.linkAssignments(this,"event")}afterLoadData(){var r;this.afterEventRemoval(),(r=this.assignmentStore)===null||r===void 0||r.linkAssignments(this,"event")}}return t}){}class Pm extends fe([jS,as],e=>{const t=e.prototype;class i extends e{static get defaultConfig(){return{modelClass:Bn}}joinProject(){var n;(n=this.assignmentStore)===null||n===void 0||n.linkAssignments(this,"resource")}afterLoadData(){var n;(n=this.assignmentStore)===null||n===void 0||n.linkAssignments(this,"resource")}clear(n){var s;t.clear.call(this,n),(s=this.assignmentStore)===null||s===void 0||s.unlinkAssignments("resource")}}return i}){}class GS extends fe([],Ie){}class qS extends fe([],he){}class KS extends fe([GS,qS,de],e=>{const t=e.prototype;class i extends e{constructor(){super(...arguments),this.isRestoringData=!1}get isRepopulatingStores(){return!1}get isInitialCommit(){return!this.isInitialCommitPerformed||this.hasLoadedDataToCommit}construct(n={}){this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!1,this.isWritingData=!1,this.hasLoadedDataToCommit=!1;const s="silenceInitialCommit"in n?n.silenceInitialCommit:!0,a="adjustDurationToDST"in n?n.adjustDurationToDST:!1;this.maxCalendarRange="maxCalendarRange"in n?n.maxCalendarRange:15768e7,delete n.maxCalendarRange,delete n.silenceInitialCommit,delete n.adjustDurationToDST,t.construct.call(this,n),this.silenceInitialCommit=s,this.adjustDurationToDST=a}repopulateStore(n){}repopulateReplica(){}deferUntilRepopulationIfNeeded(n,s,a){s(...a)}attachStore(n){}detachStore(n){}async commitAsync(){throw new Error("Abstract method called")}isEngineReady(){throw new Error("Abstract method called")}getStm(){throw new Error("Abstract method called")}}return i}){}class XS extends fe([],he){}class ZS extends fe([KS,Ed,XS,de],e=>{const t=e.prototype;class i extends e{static get configurable(){return{stm:{},eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},eventModelClass:Td,assignmentModelClass:xd,resourceModelClass:Bn,dependencyModelClass:Rd,calendarModelClass:Am,eventStoreClass:Om,assignmentStoreClass:Fm,resourceStoreClass:Pm,dependencyStoreClass:Lm,calendarManagerStoreClass:WS,assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null}}construct(n={}){const s=this;if(s.$invalidated=new Set,s.isPerformingCommit=!1,s.silenceInitialCommit=!0,s.ongoing=Promise.resolve(),n.eventStore&&!n.assignmentStore){var a;const g=n.eventStore.masterStore||n.eventStore;(a=g.assignmentStore)!==null&&a!==void 0&&a.isAssignmentStore&&(n.assignmentStore=g.assignmentStore,s.isSharingAssignmentStore=!0)}t.construct.call(s,n),s.defaultCalendar=new s.calendarManagerStore.modelClass({unspecifiedTimeIsWorking:s.unspecifiedTimeIsWorking}),s.defaultCalendar.project=s;const{calendarsData:o,eventsData:l,dependenciesData:d,resourcesData:u,assignmentsData:h}=s;Boolean(o||l||d||u||h)?(s.loadInlineData({calendarsData:o,eventsData:l,dependenciesData:d,resourcesData:u,assignmentsData:h}),delete s.calendarsData,delete s.eventsData,delete s.dependenciesData,delete s.resourcesData,delete s.assignmentsData):s.bufferedCommitAsync()}doDestroy(){var n,s,a,o,l,d;const u=this;(n=u.eventStore)===null||n===void 0||n.destroy(),(s=u.dependencyStore)===null||s===void 0||s.destroy(),(a=u.assignmentStore)===null||a===void 0||a.destroy(),(o=u.resourceStore)===null||o===void 0||o.destroy(),(l=u.calendarManagerStore)===null||l===void 0||l.destroy(),u.defaultCalendar.destroy(),(d=u.stm)===null||d===void 0||d.destroy(),t.doDestroy.call(this)}async loadInlineData(n){const s=this;s.isLoadingInlineData=!0,n.calendarsData&&(s.calendarManagerStore.data=n.calendarsData),n.resourcesData&&(s.resourceStore.data=n.resourcesData),n.assignmentsData&&(s.assignmentStore.data=n.assignmentsData),n.eventsData&&(s.eventStore.data=n.eventsData),n.tasksData&&(s.eventStore.data=n.tasksData),n.dependenciesData&&(s.dependencyStore.data=n.dependenciesData),await s.commitLoad(),s.isLoadingInlineData=!1}async commitLoad(){await this.commitAsync(),this.isDestroyed||this.trigger("load")}joinStoreRecords(n){const s=a=>{a.setProject(this),a.joinProject()};n.rootNode?n.rootNode.traverse(s):n.forEach(s)}unJoinStoreRecords(n){const s=a=>{a.leaveProject(),a.setProject(this)};n.rootNode?n.rootNode.traverse(a=>{a!==n.rootNode&&s(a)}):n.forEach(s)}resolveStoreAndModelClass(n,s){const a=s?.storeClass||this[`${n}StoreClass`];let o=s?.modelClass;return o||(this.getDefaultConfiguration()[`${n}ModelClass`]!==a.getDefaultConfiguration().modelClass?o=a.getDefaultConfiguration().modelClass:o=this[`${n}ModelClass`]),{storeClass:a,modelClass:o}}setEventStore(n){this.eventStore=n}changeEventStore(n,s){const a=this,{stm:o}=a;if(a.detachStore(s),n instanceof se)n.project=a,o.addStore(n),a.joinStoreRecords(n);else{const{storeClass:l,modelClass:d}=a.resolveStoreAndModelClass("event",n);n=new l(T.assign({modelClass:d,project:a,stm:o},n))}if(s&&o.hasStore(s)){o.removeStore(s),a.unJoinStoreRecords(s);const{assignmentsForRemoval:l}=s;l.forEach(d=>{const u=d.event;if(u){const h=n.getById(u.id);h&&(d.event=h,l.delete(d))}}),s.afterEventRemoval()}return n.setProject(a),n}updateEventStore(n,s){this.attachStore(n),this.trigger("eventStoreChange",{store:n})}setAssignmentStore(n){this.assignmentStore=n}changeAssignmentStore(n,s){const a=this,{stm:o}=a;if(a.detachStore(s),s&&o.hasStore(s)&&(o.removeStore(s),a.unJoinStoreRecords(s)),n instanceof se)n.project=a,o.addStore(n),a.joinStoreRecords(n);else{const{storeClass:l,modelClass:d}=a.resolveStoreAndModelClass("assignment",n);n=new l(T.assign({modelClass:d,project:a,stm:o},n))}return n.setProject(a),n}updateAssignmentStore(n,s){this.attachStore(n),this.trigger("assignmentStoreChange",{store:n})}setResourceStore(n){this.resourceStore=n}changeResourceStore(n,s){const a=this,{stm:o}=a;if(a.detachStore(s),n instanceof se)n.project=a,o.addStore(n),a.joinStoreRecords(n);else{const{storeClass:l,modelClass:d}=a.resolveStoreAndModelClass("resource",n);n=new l(T.assign({modelClass:d,project:a,stm:o},n))}if(s&&o.hasStore(s)){o.removeStore(s),a.unJoinStoreRecords(s);const{assignmentsForRemoval:l}=s;l.forEach(d=>{const u=d.resource;if(u){const h=n.getById(u.id);h&&(d.resource=h,l.delete(d))}}),s.afterResourceRemoval()}return n.setProject(a),n}updateResourceStore(n,s){this.attachStore(n),this.trigger("resourceStoreChange",{store:n})}setDependencyStore(n){this.dependencyStore=n}changeDependencyStore(n,s){const a=this;if(a.detachStore(s),n instanceof se)n.project=a,a.stm.addStore(n),a.joinStoreRecords(n);else{const{storeClass:o,modelClass:l}=a.resolveStoreAndModelClass("dependency",n);n=new o(T.assign({modelClass:l,project:a,stm:a.stm},n))}return n}updateDependencyStore(n,s){this.attachStore(n),this.trigger("dependencyStoreChange",{store:n})}setCalendarManagerStore(n){this.calendarManagerStore=n}changeCalendarManagerStore(n,s){const a=this;if(a.detachStore(s),n instanceof se)a.stm.addStore(n);else{var o,l;const d=((o=n)===null||o===void 0?void 0:o.storeClass)||a.calendarManagerStoreClass,u=((l=n)===null||l===void 0?void 0:l.modelClass)||d.getDefaultConfiguration().modelClass||a.calendarModelClass;n=new d(T.assign({modelClass:u,project:a,stm:a.stm},n))}return n.setProject(a),n}updateCalendarManagerStore(n,s){this.attachStore(n),this.trigger("calendarManagerStoreChange",{store:n})}get calendar(){return this.$calendar||this.defaultCalendar}set calendar(n){this.$calendar=n}get effectiveCalendar(){return this.calendar}async addEvent(n){return this.eventStore.add(n),this.commitAsync()}async addAssignment(n){return this.assignmentStore.add(n),this.commitAsync()}async addResource(n){return this.resourceStore.add(n),this.commitAsync()}async addDependency(n){return this.dependencyStore.add(n),this.commitAsync()}bufferedCommitAsync(){this.hasPendingAutoCommit||this.setTimeout({fn:"commitAsync",delay:10})}get hasPendingAutoCommit(){return this.hasTimeout("commitAsync")}unScheduleAutoCommit(){this.clearTimeout("commitAsync")}async commitAsync(){return this.isPerformingCommit?this.ongoing:this.ongoing=this.doCommitAsync()}async doCommitAsync(){const n=this;if(n.isPerformingCommit=!0,n.unScheduleAutoCommit(),await $S(0),!n.isDestroyed){for(const d of n.$invalidated)d.calculateInvalidated();const{isInitialCommit:s,silenceInitialCommit:a}=n,o=s&&a;n.assignmentStore.onCommitAsync(),n.dependencyStore.onCommitAsync(),n.isInitialCommitPerformed=!0,n.hasLoadedDataToCommit=!1,n.isPerformingCommit=!1;const l=[n.assignmentStore,n.dependencyStore,n.eventStore,n.resourceStore,n.calendarManagerStore];if(l.forEach(d=>{var u;return(u=d.suspendAutoCommit)===null||u===void 0?void 0:u.call(d)}),n.isWritingData=!0,n.trigger("refresh",{isInitialCommit:s,isCalculated:!0}),o)for(const d of n.$invalidated)d.finalizeInvalidated(!0);else{for(const d of n.$invalidated)d.beginBatch(!0),d.finalizeInvalidated();for(const d of n.$invalidated)d.endBatch(!1,!0)}return n.isWritingData=!1,n.$invalidated.clear(),n.trigger("dataReady"),l.forEach(d=>{var u;return(u=d.resumeAutoCommit)===null||u===void 0?void 0:u.call(d)}),n.trigger("commitFinalized"),!0}}async propagateAsync(){return this.commitAsync()}invalidate(n){this.$invalidated.add(n),this.bufferedCommitAsync()}async isValidDependency(){return!0}getStm(){return this.stm}set stm(n){n=this.$stm=new Mg(T.assign({disabled:!0},n)),n.ion({restoringStop:async()=>{n.disable(),await this.commitAsync(),this.isDestroyed||(n.enable(),this.trigger("stateRestoringDone"))}})}get stm(){return this.$stm}isEngineReady(){return!this.hasPendingAutoCommit&&!this.isPerformingCommit&&this.isInitialCommitPerformed}}return i.applyConfigs=!0,i}){}class $m extends Zt{constructor(...e){super(...e),M(this,"compositeField",!0)}static get $name(){return"DurationColumn"}static get type(){return"duration"}static get isGanttColumn(){return!0}static get fields(){return[{name:"decimalPrecision",defaultValue:1}]}static get defaults(){return{min:null,max:null,step:1,largeStep:0,field:"fullDuration",text:"L{Duration}",instantUpdate:!0,filterType:"duration",sortable(e,t){const i=e[this.field],r=t[this.field];return i-r}}}construct(){super.construct(...arguments);const e=this.sortable;this.sortable=(...t)=>e.call(this,...t)}get defaultEditor(){const{max:e,min:t,step:i,largeStep:r}=this;return T.cleanupProperties({type:"duration",name:this.field,max:e,min:t,step:i,largeStep:r})}get durationUnitField(){return`${this.field}Unit`}formatValue(e,t){e instanceof Ue&&(t=e.unit,e=e.magnitude);const i=typeof this.grid.durationDisplayPrecision=="number"?this.grid.durationDisplayPrecision:this.decimalPrecision,r=Math.pow(10,i);return Math.round(e*r)/r+" "+b.getLocalizedNameOfUnit(t,e!==1)}defaultRenderer({record:e,isExport:t}){const i=e[this.field],r=typeof i,n=r==="number"?i:i?.magnitude,s=r==="number"?e[this.durationUnitField]:i?.unit;return typeof n!="number"?t?"":null:this.formatValue(n,s)}toClipboardString({record:e}){return e[this.field].toString()}fromClipboardString({string:e,record:t}){const i=b.parseDuration(e,!0,this.durationUnit);return i&&"magnitude"in i?i:t.fullDuration}calculateFillValue({value:e,record:t}){return this.fromClipboardString({string:e,record:t})}}be.registerColumnType($m);$m._$name="DurationColumn";class _m extends ge{static get $name(){return"ResourceCollapseColumn"}static get type(){return"resourceCollapse"}static get defaults(){return{width:"3em",align:"center",sortable:!1,groupable:!1,editor:!1,minWidth:0,cellCls:"b-resourcecollapse-cell",renderer:({record:e})=>({tag:"i",class:{"b-icon":1,"b-icon-expand-resource":1,"b-flip":e.eventLayout!=="none"}})}}onCellClick({record:e,event:t}){t.preventDefault(),e.eventLayout=e.eventLayout!=="none"?"none":"stack"}}be.registerColumnType(_m);_m._$name="ResourceCollapseColumn";class Hm extends ge{static get $name(){return"ResourceInfoColumn"}static get type(){return"resourceInfo"}static get fields(){return["showEventCount","showRole","showMeta","showImage","validNames","autoScaleThreshold","useNameAsImageName"]}static get defaults(){return{showImage:!0,showEventCount:!0,showMeta:null,showRole:!1,validNames:null,autoScaleThreshold:40,useNameAsImageName:!0,field:"name",htmlEncode:!1,width:140,cellCls:"b-resourceinfo-cell",editor:ae.isTestEnv?!1:"text"}}construct(...e){super.construct(...e),this.avatarRendering=new Di({element:this.grid.element})}doDestroy(){super.doDestroy(),this.avatarRendering.destroy()}getImageURL(e){const t=this.grid.resourceImagePath||"",i=t.split("//"),r=i.length>1?i[1]:t,n=z.joinPaths([r||"",e||""]);return i.length>1?i[0]+"//"+n:n}template(e,t){const i=this,{showImage:r,showRole:n,showMeta:s,showEventCount:a,grid:o}=i,{timeAxis:l,resourceImageExtension:d="",defaultResourceImageName:u}=o,h=typeof n=="string"?n:"role",f=a&&e.eventStore.getEvents({includeOccurrences:o.enableRecurringEvents,resourceRecord:e,startDate:l.startDate,endDate:l.endDate}).length;let g;if(r&&e.image!==!1)if(e.imageUrl)g=e.imageUrl;else{const m=typeof r=="string"?r:e.image||t&&i.useNameAsImageName&&t.toLowerCase()+d||u||"";g=m&&i.getImageURL(m),g&&!m.includes(".")&&(!i.validNames||i.validNames.includes(m))&&(g+=d)}return{class:"b-resource-info",children:[r&&i.avatarRendering.getResourceAvatar({resourceRecord:e,initials:e.initials,color:e.eventColor,iconCls:e.iconCls,imageUrl:g,defaultImageUrl:u&&this.getImageURL(u)}),n||a||s?{tag:"dl",children:[{tag:"dt",text:t},n?{tag:"dd",class:"b-resource-role",text:e[h]}:null,a?{tag:"dd",class:"b-resource-events",html:i.L("L{eventCountText}",f)}:null,s?{tag:"dd",class:"b-resource-meta",html:i.showMeta(e)}:null]}:t]}}defaultRenderer({grid:e,record:t,cellElement:i,value:r,isExport:n}){let s;return t.isSpecialRow?s="":n?s=r:(this.autoScaleThreshold&&e.rowHeight<this.autoScaleThreshold?i.style.fontSize=e.rowHeight/40+"em":i.style.fontSize="",s=this.template(t,r)),s}}be.registerColumnType(Hm);Hm._$name="ResourceInfoColumn";function JS(c,e){return c===e.length-1}function QS(c,e){return e===c.cells[c.cells.length-1]}class Md extends N{static get $name(){return"TimeAxisBase"}static get configurable(){return{compactCellWidthThreshold:15,model:null,cls:null,sizeProperty:null,positionProperty:null}}static get properties(){return{startDate:null,endDate:null,levels:[],size:null}}set range({startDate:e,endDate:t}){const i=this;(i.startDate-e||i.endDate-t)&&(i.startDate=e,i.endDate=t,i.refresh())}buildCells(e=this.startDate,t=this.endDate){var i;const r=this,{sizeProperty:n}=r,{stickyHeaders:s,isVertical:a}=r.client||{},o=[],{length:l}=r.levels,d=r.levels.map((u,h)=>{var f;const g=s&&(a||h<l-1);return{className:{"b-sch-header-row":1,[`b-sch-header-row-${u.position}`]:1,"b-sch-header-row-main":h===r.model.viewPreset.mainHeaderLevel,"b-lowest":JS(h,r.levels),"b-sticky-header":g},syncOptions:{releaseThreshold:5,syncIdField:"tickIndex"},dataset:{headerFeature:`headerRow${h}`,headerPosition:u.position},children:(f=u.cells)===null||f===void 0?void 0:f.filter(m=>m.start<t&&m.end>e).map(m=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[m.headerCellCls]:m.headerCellCls,[`b-align-${m.align}`]:m.align,"b-last":QS(u,m)},dataset:F({tickIndex:m.index},globalThis.DEBUG&&{date:m.start.getTime()}),style:{[r.positionProperty]:m.coord,[n]:m.width,[`min-${n}`]:m.width},children:[{tag:"span",role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":g},html:m.value}]}))}});return(i=r.client)===null||i===void 0||i.getHeaderDomConfigs(o),d.push(...o),{className:r.widgetClassList,syncOptions:{releaseThreshold:0},children:d}}render(e){super.render(e),this.refresh(!0)}refresh(e=!this.levels.length){const t=this,{columnConfig:i}=t.model,{levels:r}=t,n=r.length;if(e){r.length=0,i.forEach((a,o)=>r[o]={position:o,cells:a}),t.size=r[0].cells.reduce((a,o)=>a+=o.width,0);const s=t.element.parentElement;s&&(r.length!==n||e)&&(s.classList.remove(`b-sch-timeaxiscolumn-levels-${n}`),s.classList.add(`b-sch-timeaxiscolumn-levels-${r.length}`))}!t.startDate||!t.endDate||(Z.sync({domConfig:t.buildCells(),targetElement:t.element,syncIdField:"headerFeature"}),t.trigger("refresh"))}get widgetClass(){return"b-timeaxis"}}Md._$name="TimeAxisBase";class Nm extends Md{static get $name(){return"HorizontalTimeAxis"}static get type(){return"horizontaltimeaxis"}static get configurable(){return{model:null,sizeProperty:"width"}}get positionProperty(){var e;return(e=this.owner)!==null&&e!==void 0&&e.rtl?"right":"left"}get width(){return this.size}onModelUpdate(){this.model.availableSpace!==this.width&&this.refresh(!0)}updateModel(e){this.detachListeners("tavm"),e?.ion({name:"tavm",update:"onModelUpdate",thisObj:this})}}Nm._$name="HorizontalTimeAxis";class Kr extends N{construct(e){const t=this;e.scheduler._resourceColumns=t,super.construct(e),t.imagePath!=null&&t.element.classList.add("b-has-images"),B.on({element:t.element,delegate:".b-resourceheader-cell",capture:!0,click:"onResourceMouseEvent",dblclick:"onResourceMouseEvent",contextmenu:"onResourceMouseEvent",thisObj:t})}changeShowAvatars(e){var t;return(t=this.avatarRendering)===null||t===void 0||t.destroy(),e&&(this.avatarRendering=new Di({element:this.element})),e}updateShowAvatars(){this.isConfiguring||this.refresh()}updateResourceStore(e){const t=this;t.detachListeners("resourceStore"),e&&(e.ion({name:"resourceStore",changePreCommit:"onResourceStoreDataChange",thisObj:t}),e.count&&t.onResourceStoreDataChange({}))}onResourceStoreDataChange({action:e}){const t=this;t.getConfig("fillWidth"),t.getConfig("fitWidth"),t.updateWidthCache();const{element:i}=t,r=t.totalWidth;t.scheduler.variableColumnWidths?t._fillWidth=t._fitWidth=!1:(t._fillWidth=t.configuredFillWidth,t._fitWidth=t.configuredFitWidth),r!==t.width&&(S.setLength(i,"width",r),t.column.set("width",r,t.column.grid.isConfiguring)),e==="removeall"&&(i.innerHTML=""),(e==="remove"||e==="add"||e==="filter"||t.fitWidth||t.fillWidth)&&t.refreshWidths(),t.column.grid.toggleEmptyText()}get totalWidth(){return this.updateWidthCache()}updateWidthCache(){let e=0;const{scheduler:t}=this;return t.variableColumnWidths=!1,t.resourceStore.forEach(i=>{i.instanceMeta(t).insetStart=e,i.instanceMeta(t).insetEnd=e+(i.columnWidth||t.resourceColumnWidth),i.columnWidth==null?e+=t.resourceColumnWidth:(e+=i.columnWidth,t.variableColumnWidths=!0)}),e}changeColumnWidth(e){return this.refreshingWidths||(this.configuredColumnWidth=e),e}updateColumnWidth(e,t){const i=this;i.refreshingWidths||i.refreshWidths(),i.isConfiguring||(i.refresh(),i.trigger("columnWidthChange",{width:e,oldWidth:t}))}changeFillWidth(e){return this.configuredFillWidth=e}updateFillWidth(){this.isConfiguring||this.refreshWidths()}changeFitWidth(e){return this.configuredFitWidth=e}updateFitWidth(){this.isConfiguring||this.refreshWidths()}getImageURL(e){return z.joinPaths([this.imagePath||"",e||""])}updateImagePath(){this.isConfiguring||this.refresh()}updateAvailableWidth(e){this.refreshWidths()}refreshWidths(){var e;const t=this,{availableWidth:i,configuredColumnWidth:r}=t,n=(e=t.resourceStore)===null||e===void 0?void 0:e.count;if(!i||!n||t.scheduler.variableColumnWidths)return;t.refreshingWidths=!0;const s=t.fitWidth||t.fillWidth&&r*n<i,a=s?Math.floor(i/n):r,o=t.column.grid.enableEventAnimations&&Math.abs(t._columnWidth-a)>30;S.addTemporaryClass(t.element,"b-animating",o?300:0,t),t.columnWidth=a,t.refreshingWidths=!1}set visibleResources({firstResource:e,lastResource:t}){this.firstResource=e,this.lastResource=t,this.updateWidthCache(),this.refresh()}refresh(){const e=this,{firstResource:t,scheduler:i,resourceStore:r,lastResource:n}=e,{variableColumnWidths:s}=i,a=r.isGrouped&&r.groupers[0].field,o=[];if(e.element.classList.toggle("b-grouped",Boolean(a)),!e.column.grid.isConfiguring&&t>-1&&n>-1&&n<r.count){let u;for(let h=t;h<=n;h++){var l;const f=r.allResourceRecords[h],g=f.instanceMeta(r).groupParent,m=g?.groupChildren;if(a&&g.id!==((l=u)===null||l===void 0?void 0:l.dataset.resourceId)){const D=m[0].instanceMeta(i).insetStart,w=m[m.length-1].instanceMeta(i).insetEnd-D;u={className:"b-resourceheader-group-cell",dataset:{resourceId:g.id},style:{left:D,width:w},children:[{tag:"span",html:z.encodeHtml(m[0][a])},{className:"b-resourceheader-group-children",children:[]}]},o.push(u)}const p=f.instanceMeta(i),v=f.columnWidth||e.columnWidth,y=a?p.insetStart-u.style.left:s?p.insetStart:h*e.columnWidth,C={className:new Q({"b-resourceheader-cell":1}),dataset:{resourceId:f.id},style:{[i.rtl?"right":"left"]:y,width:v},children:[]};if(e.headerRenderer){const D=e.headerRenderer({elementConfig:C,resourceRecord:f});D!=null&&(C.html=D)}else{let D;if(f.imageUrl)D=f.imageUrl;else if(e.imagePath!=null&&f.image!==!1){var d;const w=f.image||((d=f.name)===null||d===void 0?void 0:d.toLowerCase())+e.imageExtension;D=e.getImageURL(w)}C.children.push(e.showAvatars&&e.avatarRendering.getResourceAvatar({resourceRecord:f,initials:f.initials,color:f.eventColor,iconCls:f.iconCls,defaultImageUrl:e.defaultImageName&&e.getImageURL(e.defaultImageName),imageUrl:D}),{tag:"span",className:"b-resource-name",html:z.encodeHtml(f.name)})}a?u.children[1].children.push(C):o.push(C)}}Z.sync({domConfig:{onlyChildren:!0,children:o},targetElement:e.element,syncIdField:"resourceId"})}onResourceMouseEvent(e){const t=e.target.closest(".b-resourceheader-cell"),i=this.resourceStore.getById(t.dataset.resourceId);this.trigger("resourceHeader"+z.capitalize(e.type),{resourceRecord:i,event:e})}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.resourceStore,delete t.column,delete t.type,t}}M(Kr,"$name","ResourceHeader");M(Kr,"type","resourceheader");M(Kr,"configurable",{resourceStore:null,headerRenderer:null,showAvatars:{value:!0,$config:"nullify"},fillWidth:!0,fitWidth:!1,columnWidth:150,imagePath:null,imageExtension:null,defaultImageName:null,availableWidth:null});M(Kr,"properties",{firstResource:-1,lastResource:-1});Kr._$name="ResourceHeader";class kd extends Ie(Ji){static get fields(){return[{name:"locked",persist:!1},{name:"flex",persist:!1},{name:"width",persist:!1},{name:"cellCls",persist:!1},{name:"field",persist:!1},"mode"]}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,resizable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cls:"b-sch-timeaxiscolumn",needWidth:!0,mode:null,region:"normal",exportable:!1,htmlEncode:!1}}static get type(){return"timeAxis"}construct(e){const t=this;super.construct(...arguments),t.thisObj=t,t.timeAxisViewModel=t.grid.timeAxisViewModel,t.mode=t.mode,t.grid.ion({paint:"onTimelinePaint",thisObj:t,once:!0})}static get autoExposeFields(){return!0}doDestroy(){var e,t;(e=this.resourceColumns)===null||e===void 0||e.destroy(),(t=this.timeAxisView)===null||t===void 0||t.destroy(),super.doDestroy()}set mode(e){const t=this,{grid:i}=t;t.set("mode",e),e==="horizontal"?t.timeAxisView=new Nm({model:t.timeAxisViewModel,compactCellWidthThreshold:t.compactCellWidthThreshold,owner:i,client:i}):e==="vertical"&&(t.resourceColumns=Kr.new({column:t,scheduler:i,resourceStore:i.resourceStore,imagePath:i.resourceImagePath,imageExtension:i.resourceImageExtension,defaultImageName:i.defaultResourceImageName},i.resourceColumns||{}),t.relayEvents(t.resourceColumns,["resourceheaderclick","resourceheaderdblclick","resourceheadercontextmenu"]))}get mode(){return this.get("mode")}onViewModelUpdate({source:e}){const t=this;t.mode==="horizontal"?(t.refreshHeader(!0),t.width=e.totalSize,t.grid.refresh(),t.subGrid.refreshFakeScroll()):t.mode==="vertical"&&t.grid.refreshRows()}onTimelinePaint({firstPaint:e}){const t=this;if(!!t.subGrid.insertRowsBefore&&e&&(t.subGridElement.classList.add("b-timeline-subgrid"),t.mode==="vertical")){var i;t.refreshHeader(),(i=t.grid)===null||i===void 0||i.onHeightChange()}}refreshHeader(e){const t=this,{element:i}=t;i&&(t.mode==="horizontal"?(!e&&t.timeAxisViewModel.update(void 0,void 0,!0),t.timeAxisView.rendered?t.timeAxisView.refresh(!0):(i.innerHTML="",t.timeAxisView.render(i))):t.mode==="vertical"&&(t.resourceColumns.currentElement||(i.innerHTML="",t.resourceColumns.render(i))))}internalRenderer(e){const{grid:t}=this;if(t.project.isInitialCommitPerformed||t.project.isDelayingCalculation)return t.currentOrientation.renderer(e),super.internalRenderer(e)}get timeAxisViewModel(){return this._timeAxisViewModel}set timeAxisViewModel(e){const t=this;t.detachListeners("tavm"),e?.ion({name:"tavm",update:"onViewModelUpdate",prio:-1e4,thisObj:t}),t._timeAxisViewModel=e,t.timeAxisView&&(t.timeAxisView.model=e)}getState(){const e=super.getState();return delete e.width,delete e.flex,e}}M(kd,"$name","TimeAxisColumn");be.registerColumnType(kd);kd._$name="TimeAxisColumn";class Bm extends Md{static get $name(){return"VerticalTimeAxis"}static get configurable(){return{cls:"b-verticaltimeaxis",sizeProperty:"height",positionProperty:"top",wrapText:!0}}buildHorizontalCells(){const e=this,{client:t}=e,i=t?.stickyHeaders,r=[],n=e.levels.reduce((s,a,o)=>{if(a.cells){var l;s.push(...(l=a.cells)===null||l===void 0?void 0:l.filter(d=>d.start<e.endDate&&d.end>e.startDate).map((d,u,h)=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[d.headerCellCls]:d.headerCellCls,[`b-align-${d.align}`]:d.align,"b-last":u===h.length-1,"b-lowest":o===e.levels.length-1},dataset:F({tickIndex:d.index,cellId:`${o}-${d.index}`,headerPosition:o},globalThis.DEBUG&&{date:d.start.getTime()}),style:{top:d.coord,height:d.width,minHeight:d.width},children:[{role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":i},html:d.value}]})))}return s},[]);return t?.getHeaderDomConfigs(r),n.push(...r),{className:e.widgetClassList,dataset:{headerFeature:"headerRow0",headerPosition:0},syncOptions:{releaseThreshold:5,syncIdField:"cellId"},children:n}}get height(){return this.size}}Bm._$name="VerticalTimeAxis";class Id extends ge{static get type(){return"verticalTimeAxis"}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,minWidth:0,resizable:!1,cellCls:"b-verticaltimeaxiscolumn",flex:1,alwaysClearCell:!1}}get isFocusable(){return!1}construct(e){super.construct(...arguments),this.view=new Bm({model:this.grid.timeAxisViewModel,client:this.grid})}renderer({cellElement:e,size:t}){this.view.render(e),t.height=this.view.height}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.id,delete t.region,delete t.type,delete t.field,delete t.ariaLabel,delete t.cellAriaLabel,t}}M(Id,"$name","VerticalTimeAxisColumn");be.registerColumnType(Id);Id._$name="VerticalTimeAxisColumn";var eD=c=>class extends c{static get $name(){return"AbstractCrudManagerValidation"}static get configurable(){return{validateResponse:!0,skipSuccessProperty:!0,crudLoadValidationWarningPrefix:"CrudManager load response error(s):",crudSyncValidationWarningPrefix:"CrudManager sync response error(s):",supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/scheduler/docs/api/Scheduler/crud/AbstractCrudManagerMixin#config-supportShortSyncResponse)',disableValidationNote:'Note: To disable this validation please set the "validateResponse" config to false'}}get crudLoadValidationMandatoryStores(){return[]}getStoreLoadResponseWarnings(t,i,r){const n=[],{storeId:s}=t,a=this.crudLoadValidationMandatoryStores,o={[s]:{}};return i?i.rows||(n.push(`- "${s}" store section should have a "rows" property with an array of the store records.`),o[s].rows=["..."]):a!=null&&a.includes(s)&&(n.push(`- No "${s}" store section found. It should contain the store data.`),o[s].rows=["..."]),n.length&&Object.assign(r,o),n}getLoadResponseWarnings(t){const i=[],r={};return this.skipSuccessProperty||(r.success=!0),this.forEachCrudStore((n,s,a)=>{i.push(...this.getStoreLoadResponseWarnings(a,t?.[s],r))}),i.length&&(i.push(`Please adjust your response to look like this:
`+JSON.stringify(r,null,4).replace(/"\.\.\."/g,"...")),i.push(this.disableValidationNote)),i}validateLoadResponse(t){const i=this.getLoadResponseWarnings(t);i.length&&console.warn(this.crudLoadValidationWarningPrefix+`
`+i.join(`
`))}getStoreSyncResponseWarnings(t,i,r,n){const s=[],a=[],o=[],{storeId:l}=t,d={[l]:{}},u=t.phantomIdField||this.phantomIdField,{modelClass:h}=t.store,{idField:f}=h,g=r?.rows||[],m=r?.removed||[];let p=!1;if(i!=null&&i.added&&(a.push(...i.added.filter(v=>!g.find(y=>y[u]==v[u])&&!m.find(y=>y[u]==v[u]||y[f]==v[u])).map(v=>({[u]:v[u],[f]:"..."}))),a.length)){const v=a.map(y=>"#"+y[u]).join(", ");s.push(`- "${l}" store "rows" section should mention added record(s) ${v} sent in the request. It should contain the added records identifiers (both phantom and "real" ones assigned by the backend).`)}if(this.supportShortSyncResponse)!a.length&&r&&((typeof r!="object"||Array.isArray(r))&&(s.push(`- "${l}" store section should be an Object.`),d[l]["..."]="..."),r.rows&&!Array.isArray(r.rows)&&(s.push(`- "${l}" store "rows" section should be an array`),a.push("...")),r.removed&&!Array.isArray(r.removed)&&(s.push(`- "${l}" store "removed" section should be an array:`),o.push("...")));else{if(i!=null&&i.updated){const v=i.updated.filter(y=>!g.find(C=>C[f]==y[f])).map(y=>({[f]:y[f]}));if(a.push(...v),v.length){const y=v.map(C=>"#"+C[f]).join(", ");s.push(`- "${l}" store "rows" section should mention updated record(s) ${y} sent in the request. It should contain the updated record identifiers.`),p=!0}}if(a.length&&a.push("..."),i!=null&&i.removed&&(o.push(...i.removed.filter(v=>!g.find(y=>y[f]==v[f])).map(v=>({[f]:v[f]}))),o.length)){const v=o.map(y=>"#"+y[f]).join(", ");s.push(`- "${l}" store "removed" section should mention removed record(s) ${v} sent in the request. It should contain the removed record identifiers.`),d[l].removed=o,o.push("..."),p=!0}}return a.length&&(d[l].rows=a),s.length||delete d[l],Object.assign(n,d),{messages:s,showSupportShortSyncResponseNote:p}}getSyncResponseWarnings(t,i){const r=[],n={},s=i.pack;this.skipSuccessProperty||(n.success=!0);let a=!1;return this.forEachCrudStore((o,l,d)=>{const u=this.getStoreSyncResponseWarnings(d,s?.[l],t[l],n);a=a||u.showSupportShortSyncResponseNote,r.push(...u.messages)}),r.length&&(r.push(`Please adjust your response to look like this:
`+JSON.stringify(n,null,4).replace(/"\.\.\.":\s*"\.\.\."/g,",,,").replace(/"\.\.\."/g,"...")),a&&r.push(this.supportShortSyncResponseNote),r.push(this.disableValidationNote)),r}validateSyncResponse(t,i){const r=this.getSyncResponseWarnings(t,i);r.length&&console.warn(this.crudSyncValidationWarningPrefix+`
`+r.join(`
`))}};class tD extends Error{}class nf extends tD{constructor(e={}){var t,i;super(e.message||e.request&&z.capitalize((t=e.request)===null||t===void 0?void 0:t.type)+" failed"||"Crud Manager request failed"),Object.assign(this,e),this.action=(i=this.request)===null||i===void 0?void 0:i.type}}const zm=function(c,e,t){return c.store&&(c=c.store),e.store&&(e=e.store),c=c[t]||0,e=e[t]||0,c<e?-1:c>e?1:0},iD=function(c,e){return zm(c,e,"loadPriority")},rD=function(c,e){return zm(c,e,"syncPriority")};var Vm=c=>{var e;c.$$meta=c.$meta;const t=[];return c.isEvents||t.push(Ie),c.isDelayable||t.push(he),t.push(eD),e=class extends(c||P).mixin(...t){static get $name(){return"AbstractCrudManagerMixin"}static get defaultConfig(){return{crudRevision:null,crudStores:[],storeIdProperty:"storeId",crudFilterParam:"filter",transport:{},trackResponseType:!1,supportShortSyncResponse:!0,phantomIdField:"$PhantomId",phantomParentIdField:"$PhantomParentId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],orderedCrudStores:[],writeAllFields:!1,crudIgnoreUpdates:0,autoSyncSuspendCounter:0,crudLoaded:!1,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}get isCrudManager(){return!0}construct(r={}){this._requestId=0,this.activeRequests={},this.crudStoresIndex={},super.construct(r)}afterConstruct(){super.afterConstruct(),this.autoLoad&&(this._autoLoadPromise=this.doAutoLoad())}get loadUrl(){var r,n;return(r=this.transport)===null||r===void 0||(n=r.load)===null||n===void 0?void 0:n.url}updateLoadUrl(r){T.setPath(this,"transport.load.url",r)}get syncUrl(){var r,n;return(r=this.transport)===null||r===void 0||(n=r.sync)===null||n===void 0?void 0:n.url}updateSyncUrl(r){T.setPath(this,"transport.sync.url",r)}getStoreDescriptor(r){return r?r instanceof se?this.crudStores.find(n=>n.store===r):typeof r=="object"?this.crudStoresIndex[r.storeId]:this.crudStoresIndex[r]||this.getStoreDescriptor(se.getStore(r)):null}fillStoreDescriptor(r){const{store:n}=r,{storeIdProperty:s=this.storeIdProperty,modelClass:a}=n;return r.storeId||(r.storeId=n[s]||n.id),r.idField||(r.idField=a.idField),r.phantomIdField||(r.phantomIdField=a.phantomIdField),r.phantomParentIdField||(r.phantomParentIdField=a.phantomParentIdField),"writeAllFields"in r||(r.writeAllFields=n.writeAllFields),r}updateCrudStoreIndex(){const r=this.crudStoresIndex={};this.crudStores.forEach(n=>n.storeId&&(r[n.storeId]=n))}getCrudStore(r){const n=this.getStoreDescriptor(r);return n?.store}forEachCrudStore(r,n=this){if(!r)throw new Error("Iterator function must be provided");this.crudStores.every(s=>r.call(n,s.store,s.storeId,s)!==!1)}set crudStores(r){this._crudStores=[],this.addCrudStore(r);for(const n of this._crudStores)n.loadPriority=n.syncPriority=0}get crudStores(){return this._crudStores}get orderedCrudStores(){return this._orderedCrudStores}set orderedCrudStores(r){return this._orderedCrudStores=r}set syncApplySequence(r){this._syncApplySequence=[],this.addStoreToApplySequence(r)}get syncApplySequence(){return this._syncApplySequence}internalAddCrudStore(r){const n=this;let s;return r instanceof se?s={store:r}:typeof r=="object"?(r.store||(r={storeId:r.id,store:new se(r)}),s=r):s={store:se.getStore(r)},n.fillStoreDescriptor(s),r=s.store,r.setCrudManager?r.setCrudManager(n):r.crudManager=n,r.pageSize=null,(n.loadUrl||n.syncUrl)&&(r.autoCommit=!1,r.autoLoad=!1,(r.createUrl||r.updateUrl||r.deleteUrl||r.readUrl)&&console.warn("You have configured an URL on a Store that is handled by a CrudManager that is also configured with an URL. The Store URL's should be removed.")),n.bindCrudStoreListeners(r),s}addCrudStore(r,n,s){var a;if(r=W.asArray(r),!((a=r)!==null&&a!==void 0&&a.length))return;const o=this,l=r.map(o.internalAddCrudStore,o);typeof n>"u"?o.crudStores.push(...l):(s&&((s instanceof se||typeof s!="object")&&(s=o.getStoreDescriptor(s)),n+=o.crudStores.indexOf(s)),o.crudStores.splice(n,0,...l)),o.orderedCrudStores.push(...l),o.updateCrudStoreIndex()}addPrioritizedStore(r){const n=this;n.hasCrudStore(r)||n.addCrudStore(r,W.findInsertionIndex(r,n.crudStores,iD)),n.hasApplySequenceStore(r)||n.addStoreToApplySequence(r,W.findInsertionIndex(r,n.syncApplySequence,rD))}hasCrudStore(r){var n;return(n=this.crudStores)===null||n===void 0?void 0:n.some(s=>s===r||s.store===r||s.storeId===r)}removeCrudStore(r){const n=this,s=n.crudStores,a=s.find(o=>o===r||o.store===r||o.storeId===r);if(a)n.unbindCrudStoreListeners(a.store),delete n.crudStoresIndex[a.storeId],W.remove(s,a),n.syncApplySequence&&n.removeStoreFromApplySequence(r);else throw new Error("Store not found in stores collection")}bindCrudStoreListeners(r){r.ion({name:r.id,addConfirmed:"onCrudStoreChange",change:"onCrudStoreChange",destroy:"onCrudStoreDestroy",thisObj:this})}unbindCrudStoreListeners(r){this.detachListeners(r.id)}addStoreToApplySequence(r,n,s){if(!r)return;r=W.asArray(r);const a=this,o=r.reduce((d,u)=>{const h=a.getStoreDescriptor(u);return h&&d.push(h),d},[]);if(typeof n>"u")a.syncApplySequence.push(...o);else{let d=n;s&&((s instanceof se||typeof s!="object")&&(s=a.getStoreDescriptor(s)),d+=a.syncApplySequence.indexOf(s)),a.syncApplySequence.splice(d,0,...o)}const l=a.syncApplySequence.map(({storeId:d})=>d);a.orderedCrudStores=[...a.syncApplySequence],a.crudStores.forEach(d=>{l.includes(d.storeId)||a.orderedCrudStores.push(d)})}removeStoreFromApplySequence(r){const n=this.syncApplySequence.findIndex(s=>s===r||s.store===r||s.storeId===r);n>-1&&(this.syncApplySequence.splice(n,1),this.orderedCrudStores.splice(n,1))}hasApplySequenceStore(r){return this.syncApplySequence.some(n=>n===r||n.store===r||n.storeId===r)}onCrudStoreDestroy({source:r}){this.removeCrudStore(r)}onCrudStoreChange(r){const n=this;n.crudIgnoreUpdates||(n.crudStoreHasChanges(r?.source)?(n.trigger("hasChanges"),n.autoSync&&n.scheduleAutoSync()):n.trigger("noChanges"))}suspendAutoSync(){this.autoSyncSuspendCounter++}resumeAutoSync(r=!0){const n=this;n.autoSyncSuspendCounter--,n.autoSyncSuspendCounter<=0&&(n.autoSyncSuspendCounter=0,r&&n.autoSync&&n.crudStoreHasChanges()&&n.sync())}get isAutoSyncSuspended(){return this.autoSyncSuspendCounter>0}scheduleAutoSync(){const r=this;!r.hasTimeout("autoSync")&&!r.isAutoSyncSuspended&&r.setTimeout({name:"autoSync",fn:()=>{r.sync().catch(n=>{})},delay:r.autoSyncTimeout})}async triggerFailedRequestEvents(r,n,s,a){const{options:o,type:l}=r;this.trigger("requestFail",{requestType:l,response:n,responseText:s,responseOptions:a}),this.trigger(l+"Fail",{response:n,responseOptions:a,responseText:s,options:o})}async internalOnResponse(r,n,s){const a=this,o=n?a.decode(n):null,{options:l,type:d}=r;if(n&&!o&&console.error("Failed to parse response: "+n),!o||(a.skipSuccessProperty?o.success===!1:!o.success))a.triggerFailedRequestEvents(r,o,n,s);else if(a.trigger("beforeResponseApply",{requestType:d,response:o})!==!1&&a.trigger(`before${z.capitalize(d)}Apply`,{response:o,options:l})!==!1){if(a.crudRevision=o.revision,await a.applyResponse(r,o,l),a.isDestroyed)return;a.trigger("requestDone",{requestType:d,response:o,responseOptions:s}),a.trigger(d,{response:o,responseOptions:s,options:l}),(d==="load"||!a.crudStoreHasChanges())&&(a.trigger("noChanges"),d==="load"&&a.emitCrudStoreEvents(r.pack.stores,"afterRequest"))}return o}suspendChangesTracking(){this.crudIgnoreUpdates++}resumeChangesTracking(r){this.crudIgnoreUpdates&&!--this.crudIgnoreUpdates&&!r&&this.onCrudStoreChange()}get isBatchingChanges(){return this.crudIgnoreUpdates>0}crudStoreHasChanges(r){return r?this.isCrudStoreDirty(this.getCrudStore(r)):this.crudStores.some(n=>this.isCrudStoreDirty(n.store))}isCrudStoreDirty(r){return Boolean(r.changes)}doAutoLoad(){return this.load().catch(r=>{})}emitCrudStoreEvents(r,n,s){const a=F({action:"read"+n},s);for(const o of this.crudStores)r.includes(o.storeId)&&o.store.trigger(n,a)}getLoadPackage(r){const n={type:"load",requestId:this.requestId},s=this.crudStores,a=Object.assign({},r);return delete a.request,n.stores=s.map(o=>{var l;const d=a?.[o.storeId],u=o.pageSize||((l=o.store)===null||l===void 0?void 0:l.pageSize);if(d||u){const h=Object.assign({storeId:o.storeId,page:1},d);return u&&(h.pageSize=u),o.currentPage=h.page,d&&delete a[o.storeId],h}return o.storeId}),Object.assign(n,a),n}loadCrudStore(r,n,s){const a=n?.rows;s!=null&&s.append||n!=null&&n.append?r.add(a):r.data=a,r.trigger("load",{data:a})}loadDataToCrudStore(r,n,s){const a=r.store,o=n?.rows;a.__loading=!0,o&&this.loadCrudStore(a,n,s,r),a.__loading=!1}loadCrudManagerData(r,n={}){this.suspendChangesTracking(),this.crudStores.forEach(s=>{const a=s.storeId,o=r[a];o&&this.loadDataToCrudStore(s,o,n[a])}),this.resumeChangesTracking(!0)}get isCrudManagerLoading(){return Boolean(this.activeRequests.load||this.applyingLoadResponse)}get isCrudManagerSyncing(){return Boolean(this.activeRequests.sync||this.applyingSyncResponse)}get isLoadingOrSyncing(){return Boolean(this.isCrudManagerLoading||this.isCrudManagerSyncing)}load(r){typeof r=="string"&&(r={request:{url:r}});const n=this,s=n.getLoadPackage(r);return new Promise((a,o)=>{if(n.trigger("beforeLoad",{pack:s})!==!1){var l;const{load:d}=n.activeRequests;d&&(n.cancelRequest(d.desc,d.reject),n.trigger("loadCanceled",{pack:s}));const u=U.assign({id:s.requestId,data:n.encode(s),type:"load",success:n.onCrudRequestSuccess,failure:n.onCrudRequestFailure,thisObj:n},(l=r)===null||l===void 0?void 0:l.request);n.activeRequests.load={type:"load",options:r,pack:s,resolve:a,reject(...h){u.success=u.failure=null,o(...h)},id:s.requestId,desc:n.sendRequest(u)},n.emitCrudStoreEvents(s.stores,"loadStart"),n.trigger("loadStart",{pack:s})}else n.trigger("loadCanceled",{pack:s}),o({cancelled:!0})})}getActiveCrudManagerRequest(r){let n=this.activeRequests[r];return!n&&this.trackResponseType&&(n=Object.values(this.activeRequests)[0]),n}prepareAddedRecordData(r,n){const s=this,{store:a}=n,{isTree:o}=a,l=n.phantomIdField||s.phantomIdField,d=n.phantomParentIdField||s.phantomParentIdField,u=a.modelClass.allFields.filter(g=>g.subStore),h=r.constructor,f=Object.assign(r.persistableData,{[l]:r.id});if(o){const{parent:g}=r;g&&!g.isRoot&&g.isPhantom&&(f[d]=g.id)}return s.resetIdsBeforeSync&&T.deletePath(f,h.idField),u.forEach(g=>{const m=r.get(g.name);m.allCount&&(f[g.dataSource]={added:m.getRange().map(p=>s.prepareAddedRecordData(p,{store:m}))})}),f}prepareAdded(r,n){return r.filter(s=>s.isValid).map(s=>this.prepareAddedRecordData(s,n))}prepareUpdated(r,n){const{store:s}=n,{isTree:a}=s,o=n.writeAllFields||n.writeAllFields!==!1&&this.writeAllFields,l=n.phantomParentIdField||this.phantomParentIdField,d=s.modelClass.allFields.filter(u=>u.subStore);if(n.store.tree){const u=n.store.rootNode;r=r.filter(h=>h!==u)}return r.filter(u=>u.isValid).reduce((u,h)=>{let f;if(o?f=h.persistableData:f=h.modificationDataToWrite,a){const{parent:g}=h;g&&!g.isRoot&&g.isPhantom&&(f[l]=g.id)}return d.forEach(g=>{const m=h.get(g.name);f[g.dataSource]=this.getCrudStoreChanges({store:m})}),T.isEmpty(f)||u.push(f),u},[])}prepareRemoved(r){return r.map(n=>{const s=n.constructor;return T.setPath({},s.idField,n.id)})}getCrudStoreChanges(r){const{store:n}=r;let{added:s=[],modified:a=[],removed:o=[]}=n.changes||{},l;return s.length&&(s=this.prepareAdded(s,r)),a.length&&(a=this.prepareUpdated(a,r)),o.length&&(o=this.prepareRemoved(o)),(s.length||a.length||o.length)&&(l={},s.length&&(l.added=s),a.length&&(l.updated=a),o.length&&(l.removed=o)),l}getChangesetPackage(){const{changes:r}=this;return r||this.forceSync?F({type:"sync",requestId:this.requestId,revision:this.crudRevision},r):null}get changes(){const r={};return this.crudStores.forEach(n=>{const s=this.getCrudStoreChanges(n);s&&(r[n.storeId]=s)}),Object.keys(r).length>0?r:null}getRowsToApplyChangesTo({store:r,storeId:n},s,a){var o,l;const d=this,{modelClass:u}=r,h=u.idField,{updated:f,removed:g}=a||{};let m,p,v;if(s){var y,C;v=!0;const D={};m=((y=s.rows)===null||y===void 0?void 0:y.slice())||[],p=((C=s.removed)===null||C===void 0?void 0:C.slice())||[],[...m,...p].forEach(w=>{const E=T.getPath(w,h);D[E]=!0}),d.supportShortSyncResponse&&(f?.forEach(w=>{const E=T.getPath(w,h);D[E]||m.push({[h]:E})}),g?.forEach(w=>{const E=T.getPath(w,h);D[E]||p.push({[h]:E})}))}else(f||g)&&(v=!1,m=f,p=g);return m=(o=m)!==null&&o!==void 0&&o.length?m:null,p=(l=p)!==null&&l!==void 0&&l.length?p:null,{rows:m,removed:p,remote:v}}applyChangesToStore(r,n,s){const a=this,o=r.phantomIdField||a.phantomIdField,{store:l}=r,d=l.modelClass.getFieldDataSource("id"),u=l.modelClass.allFields.filter(D=>D.subStore),{rows:h,removed:f,remote:g}=a.getRowsToApplyChangesTo(r,n,s),m=[],p=[];if(h)for(const D of h){var v;l.getById((v=D[o])!==null&&v!==void 0?v:D[d])?p.push(D):m.push(D)}const y=[];p.length&&u.length&&p.forEach(D=>{var w,E,R;const x=l.getById((w=D[o])!==null&&w!==void 0?w:D[d]),k=((E=s.added)===null||E===void 0?void 0:E.find(A=>A[o]==D[o]))||((R=s.updated)===null||R===void 0?void 0:R.find(A=>A[d]==D[d])),I={};u.forEach(A=>{const L=x.get(A.name);a.applyChangesToStore({store:L},D[A.dataSource],k?.[A.dataSource]),I[A.dataSource]="foo",delete D[A.dataSource]}),y.push([x,I])});const C=l.applyChangeset({removed:f,added:m,updated:p},null,o,g,!0);return y.forEach(([D,w])=>Object.assign(C.get(D.id),w)),C}applySyncResponse(r,n){const s=this,a=s.orderedCrudStores;s.applyingChangeset=s.applyingSyncResponse=!0,s.suspendChangesTracking();for(const l of a){var o;s.applyChangesToStore(l,r[l.storeId],n==null||(o=n.pack)===null||o===void 0?void 0:o[l.storeId])}s.resumeChangesTracking(!0),s.applyingChangeset=s.applyingSyncResponse=!1}applyLoadResponse(r,n){this.applyingLoadResponse=!0,this.loadCrudManagerData(r,n),this.applyingLoadResponse=!1}async applyResponse(r,n,s){const a=this;switch(a.trackResponseType&&n.type||r.type){case"load":a.validateResponse&&a.validateLoadResponse(n),a.applyLoadResponse(n,s);break;case"sync":a.validateResponse&&a.validateSyncResponse(n,r),a.applySyncResponse(n,r);break}}applyChangeset(r,n=null,s,a=!1){const o=this,l=a?new Map:void 0;o.suspendAutoSync(),o.suspendChangesTracking();for(const{store:d,phantomIdField:u}of o.orderedCrudStores)if(r[d.id]){const h=d.applyChangeset(r[d.id],n,u||o.phantomIdField,!0,a);h&&l.set(d.id,h)}return o.resumeChangesTracking(!0),o.resumeAutoSync(!1),l}get requestId(){return Number.parseInt(`${Date.now()}${this._requestId++}`)}sync(){const r=this;return r.clearTimeout("autoSync"),r.activeRequests.sync?(r.trigger("syncDelayed"),r.activeSyncPromise=r.activeSyncPromise.finally(()=>r.sync())):r.activeSyncPromise=new Promise((n,s)=>{const a=r.getChangesetPackage();if(!a){n(null);return}r.trigger("beforeSync",{pack:a})!==!1?(r.trigger("syncStart",{pack:a}),r.activeRequests.sync={type:"sync",pack:a,resolve:n,reject:s,id:a.requestId,desc:r.sendRequest({id:a.requestId,data:r.encode(a),type:"sync",success:r.onCrudRequestSuccess,failure:r.onCrudRequestFailure,thisObj:r})}):(r.trigger("syncCanceled",{pack:a}),s({cancelled:!0}))}).catch(n=>{if(n&&!n.cancelled)throw n;return n})}async onCrudRequestSuccess(r,n,s){var a;const o=this,{type:l,id:d}=s;if(o.isDestroyed)return;let u="";s=o.activeRequests[l];try{u=await r.text()}catch{}if(o.isDestroyed)return;if(((a=s)===null||a===void 0?void 0:a.id)!==d)throw new Error(`Interleaved ${l} operation detected`);o.activeRequests[l]=null;const h=await o.internalOnResponse(s,u,n);if(!o.isDestroyed){if(!h||(o.skipSuccessProperty?h?.success===!1:!(h!=null&&h.success))){const f={rawResponse:r,response:h,request:s};h!=null&&h.message&&(f.message=h.message),s.reject(new nf(f))}o["crud"+z.capitalize(s.type)+"ed"]=!0,s.resolve({response:h,rawResponse:r,responseText:u,request:s})}}async onCrudRequestFailure(r,n,s){var a;const o=this;if(o.isDestroyed)return;s=o.activeRequests[s.type];const l=n==null||(a=n.abortController)===null||a===void 0?void 0:a.signal;if(!Boolean(l?.aborted)){let u,h="";try{h=await r.text(),u=o.decode(h)}catch{}if(o.isDestroyed||(o.triggerFailedRequestEvents(s,u,h,n),o.isDestroyed))return;s.reject(new nf({rawResponse:r,request:s}))}o.activeRequests[s.type]=null}acceptChanges(){this.crudStores.forEach(r=>r.store.acceptChanges())}revertChanges(){this.revertCrudStoreChanges()}revertCrudStoreChanges(){this.orderedCrudStores.forEach(r=>r.store.revertChanges())}doDestroy(){const r=this,{load:n,sync:s}=r.activeRequests;for(n&&r.cancelRequest(n.desc,n.reject),s&&r.cancelRequest(s.desc,s.reject);r.crudStores.length>0;)r.removeCrudStore(r.crudStores[0]);super.doDestroy&&super.doDestroy()}},M(e,"configurable",{loadUrl:null,syncUrl:null,forceSync:null}),e};class jm extends P.mixin(Vm){get revision(){return this.crudRevision}set revision(e){this.crudRevision=e}get json(){return z.safeJsonStringify(this)}set json(e){typeof e=="string"&&(e=z.safeJsonParse(e)),this.forEachCrudStore(t=>{const i=`${t.storeId}Data`;e[i]&&(t.data=e[i])})}static get defaultConfig(){return{stores:null}}construct(e={}){e.stores&&(e.crudStores=e.stores,delete e.stores),super.construct(e)}toJSON(){const e={};return this.forEachCrudStore((t,i)=>e[`${i}Data`]=t.toJSON()),e}get inlineData(){return this.toJSON()}set inlineData(e){this.json=e}set stores(e){e!==this.crudStores&&(this.crudStores=e)}get stores(){return this.crudStores}get isLoading(){return this.isCrudManagerLoading}addStore(...e){return this.addCrudStore(...e)}removeStore(...e){return this.removeCrudStore(...e)}getStore(...e){return this.getCrudStore(...e)}hasChanges(...e){return this.crudStoreHasChanges(...e)}loadData(...e){return this.loadCrudManagerData(...e)}}jm._$name="AbstractCrudManager";var Wm=c=>class Um extends(c||P){static get $name(){return"AjaxTransport"}static get defaultMethod(){return{load:"GET",sync:"POST"}}cancelRequest(t,i){var r;(r=t.abort)===null||r===void 0||r.call(t),this.isDestroying||i({cancelled:!0})}shouldUseBodyForRequestData(t,i,r){return!(i==="HEAD"||i==="GET")&&!r}sendRequest(t){const i=this,{data:r}=t,n=i.transport[t.type]||{},s=U.assign({},n,n.requestConfig);t.url&&(s.url=t.url),s.method=s.method||Um.defaultMethod[t.type],s.params=U.assign(s.params||{},t.params);let{paramName:a}=s;if(i.shouldUseBodyForRequestData(n,s.method,a)?(s.body=r,s.headers=s.headers||{},s.headers["Content-Type"]=s.headers["Content-Type"]||"application/json"):(a=a||"data",s.params[a]=r),!s.url)throw new Error("Trying to request without URL specified");delete s.requestConfig,delete s.paramName;let o,l;function d(){s.queryParams=s.params,delete s.params;let h=!1;const f=U.assign({},s,s.fetchOptions);return o=et.fetch(s.url,f),o.catch(g=>{var m,p;o.done=!0,(m=i.trigger)===null||m===void 0||m.call(i,"responseReceived",{success:!1});const v=(p=f.abortController)===null||p===void 0?void 0:p.signal;return v&&(h=v.aborted,h||console.warn(g)),{error:g,cancelled:h}}).then(g=>{var m;o.done=!0,(m=i.trigger)===null||m===void 0||m.call(i,"responseReceived",{success:Boolean(g?.ok)});const p=g!=null&&g.ok?t.success:t.failure;return p?.call(t.thisObj||i,g,f,t)})}const u=i.trigger("beforeSend",{params:s.params,type:t.type,requestConfig:s,config:t});return U.isPromise(u)?l=u.then(d):l=d(),l.abort=()=>{if(!o.done){var h,f;(h=(f=o).abort)===null||h===void 0||h.call(f)}},l}},Ym=c=>class extends(c||P){static get $name(){return"JsonEncoder"}static get defaultConfig(){return{encoder:{}}}encode(t){var i;return t=Object.assign({},(i=this.encoder)===null||i===void 0?void 0:i.requestData,t),z.safeJsonStringify(t)}decode(t){return z.safeJsonParse(t)}},Gm=c=>{var e;return e=class extends c.mixin(Vg){static get $name(){return"CrudManagerView"}afterConstruct(){super.afterConstruct();const{crudManager:i,project:r}=this;this.loadMask&&(i||r).isCrudManagerLoading&&this.onCrudManagerLoadStart()}applySyncMask(){const{syncMask:i}=this;i&&(this.masked=ze.mergeConfigs(this.loadMaskDefaults,i))}bindCrudManager(i){this.detachListeners("crudManager"),i?.ion({name:"crudManager",loadStart:"onCrudManagerLoadStart",load:"onCrudManagerLoad",loadCanceled:"onCrudManagerLoadCanceled",syncStart:"onCrudManagerSyncStart",sync:"onCrudManagerSync",syncCanceled:"onCrudManagerSyncCanceled",requestFail:"onCrudManagerRequestFail",responseReceived:"onAjaxTransportResponseReceived",thisObj:this})}onCrudManagerLoadStart(){var i;this.applyLoadMask(),(i=this.toggleEmptyText)===null||i===void 0||i.call(this)}onCrudManagerSyncStart(){this.applySyncMask()}onCrudManagerRequestFinalize(i=!0,r,n){const s=this;if(i){var a;(a=s.toggleEmptyText)===null||a===void 0||a.call(s)}else s.masked||s.applyLoadMask(),s.applyMaskError(`<div class="b-grid-load-failure">
                    <div class="b-grid-load-fail">${s.L(`L{GridBase.${r}FailedMessage}`)}</div>
                    ${n&&n.message?`<div class="b-grid-load-fail">${s.L("L{CrudManagerView.serverResponseLabel}")} ${n.message}</div>`:""}
                </div>`)}onCrudManagerLoadCanceled(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSyncCanceled(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerLoad(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSync(){this.onCrudManagerRequestFinalize(!0,"sync"),this.refresh()}onCrudManagerRequestFail({requestType:i,response:r}){this.onCrudManagerRequestFinalize(!1,i,r)}onAjaxTransportResponseReceived(){const i=this;i.clearMaskDelay!=null?i.setTimeout(()=>i.masked=null,i.clearMaskDelay):i.masked=null}get widgetClass(){}},M(e,"config",{clearMaskDelay:null,testConfig:{clearMaskDelay:0}}),e},xi=c=>class extends(c||P){static get $name(){return"PartOfProject"}},nD=c=>class extends c{static get $name(){return"AssignmentModelMixin"}static get fields(){return["resourceId","eventId",{name:"drawDependencies",type:"boolean"},"event","resource"]}construct(t,...i){t=t||{};const r=t[this.fieldMap.eventId.dataSource],n=t[this.fieldMap.resourceId.dataSource];r!=null&&(t.event=r),n!=null&&(t.resource=n),super.construct(t,...i)}get eventResourceKey(){return this.buildEventResourceKey(this.event,this.resource)}buildEventResourceKey(t,i){let r,n;return t?r=t.isModel?t.id:t:r=this.internalId,i?n=i.isModel?i.id:i:n=this.internalId,`${r}-${n}`}buildIndexKey({event:t,resource:i}){return this.buildEventResourceKey(t,i)}set(t,i,...r){const n=this.fieldToKeys(t,i);if("resource"in n){var s;(s=n.resource)!==null&&s!==void 0&&s.id&&(n.resourceId=n.resource.id)}else"resourceId"in n&&this.constructor.isProAssignmentModel&&(n.resource=n.resourceId);if("event"in n){var a;(a=n.event)!==null&&a!==void 0&&a.id&&(n.eventId=n.event.id)}else"eventId"in n&&this.constructor.isProAssignmentModel&&(n.event=n.eventId);return super.set(n,null,...r)}afterChange(t,i,r,n,s){var a,o;const l=this;return!l.constructor.isProAssignmentModel&&i!==null&&i!==void 0&&i.resourceId&&((a=l.resource)===null||a===void 0?void 0:a.id)!==i.resourceId.value?l.resource=i.resourceId.value:l.constructor.isProAssignmentModel&&(o=l.project)!==null&&o!==void 0&&o.propagatingSyncChanges&&i!==null&&i!==void 0&&i.eventId&&!(i!=null&&i.event)&&(t.event.value===i.eventId.value||t.event.value.id===i.eventId.value)&&(delete i.eventId,delete l.meta.modified.eventId),super.afterChange(...arguments)}set resourceId(t){const{resource:i}=this;i!=null&&i.isModel&&i.id===t?this.set("resourceId",t):this.resource=t}get resourceId(){var t;return this.get("resourceId")||((t=this.resource)===null||t===void 0?void 0:t.id)}set eventId(t){const{event:i}=this;i!=null&&i.isModel&&i.id===t?this.set("eventId",t):this.event=t}get eventId(){var t;return this.get("eventId")||((t=this.event)===null||t===void 0?void 0:t.id)}get eventName(){var t;return(t=this.event)===null||t===void 0?void 0:t.name}get resourceName(){var t;return(t=this.resource)===null||t===void 0?void 0:t.name}getResource(){return this.resource}get isAssignment(){return!0}get isPersistable(){var t;const{event:i,resource:r,unjoinedStores:n,assignmentStore:s}=this,a=s?.crudManager;let o;return s?o=this.isValid&&i.isPersistable&&(a||!i.hasGeneratedId&&!r.hasGeneratedId):o=!this.isPhantom&&Boolean(n[0]),o&&super.isPersistable&&!((t=this.event)!==null&&t!==void 0&&t.isCreating)}get isValid(){return this.resource!=null&&this.event!=null}toString(){return this.resourceName?`${this.resourceName} ${Math.round(this.units)}%`:""}shouldRecordFieldChange(t,i,r){if(!super.shouldRecordFieldChange(t,i,r))return!1;if(t==="event"||t==="eventId"){var n;const a=(n=this.project)===null||n===void 0?void 0:n.eventStore;if(a&&a.oldIdMap[i]===a.getById(r))return!1}if(t==="resource"||t==="resourceId"){var s;const a=(s=this.project)===null||s===void 0?void 0:s.resourceStore;if(a&&a.oldIdMap[i]===a.getById(r))return!1}return!0}};const sD=xd;class ao extends nD(xi(sD.derive(de))){static get $name(){return"AssignmentModel"}get resource(){return super.resource}set resource(e){super.resource=e,this.setChanged("resourceId",this.constructor.asId(e))}}ao.exposeProperties();ao._$name="AssignmentModel";var aD=c=>class extends c{static get $name(){return"AssignmentStoreMixin"}static get defaultConfig(){return{loadPriority:300,syncPriority:300,storeId:"assignments"}}add(t,...i){t=W.asArray(t);for(let n=0;n<t.length;n++){var r;let s=t[n];if(s instanceof de||(t[n]=s=this.createRecord(s)),!this.isSyncingDataOnLoad&&this.storage.findIndex("eventResourceKey",s.eventResourceKey,!0)!==-1)throw new Error(`Duplicate assignment Event: ${s.eventId} to resource: ${s.resourceId}`);(r=s.event)!==null&&r!==void 0&&r.isCreating&&(s.isCreating=!0)}return super.add(t,...i)}includesAssignment(t,i){return this.storage.findIndex("eventResourceKey",`${t}-${i}`,!0)!==-1}setStoreData(t){super.setStoreData(t)}set storage(t){super.storage=t,this.storage.addIndex({property:"eventResourceKey",dependentOn:{event:!0,resource:!0}})}get storage(){return this._storage||super.storage}get isAssignmentStore(){return!0}getOccurrence(t,i){if(!t||!(i!=null&&i.isOccurrence))return t;const r=this;return{id:`${i.id}:a${t.id}`,event:i,resource:t.resource,eventId:i.id,resourceId:t.resource.id,isAssignment:!0,isOccurrenceAssignment:!0,instanceMeta(n){return r.occurrenceInstanceMeta(this,n)}}}occurrenceInstanceMeta(t,i){const r=this,n=i.id||i,{id:s}=t;let{occurrenceMeta:a}=r;return a||(a=r.occurrenceMeta={}),a[s]||(a[s]={}),a[s][n]||(a[s][n]={})}mapAssignmentsForEvent(t,i,r){t=this.eventStore.getById(t);const n=Boolean(i),s=Boolean(r);return n||s?t.assignments.reduce((a,o)=>{const l=n?i(o):o;return(!s||r(l))&&a.push(l),a},[]):t.assignments}mapAssignmentsForResource(t,i,r){t=this.resourceStore.getById(t);const n=Boolean(i),s=Boolean(r);return n||s?t.assignments.reduce((a,o)=>{const l=n?i(o):o;return(!s||r(l))&&a.push(l),a},[]):t.assignments}getAssignmentsForEvent(t){return t.assignments}removeAssignmentsForEvent(t){return this.remove(t.assignments)}getAssignmentsForResource(t){return t=this.resourceStore.getById(t),t.assignments}removeAssignmentsForResource(t){this.remove(this.getAssignmentsForResource(t))}getResourcesForEvent(t){return t.resources}getEventsForResource(t){var i;return t=this.resourceStore.getById(t),(i=t)===null||i===void 0?void 0:i.events}assignEventToResource(t,i,r=null,n=!1){var s;const a=this,o=n?new Set(t.assignments):null;if(i=W.asArray(i).map(u=>{var h;return(h=u.$original)!==null&&h!==void 0?h:u}),(s=a.eventStore)!==null&&s!==void 0&&s.usesSingleAssignment){var l;if((l=t.assignments)!==null&&l!==void 0&&l.length)return a.isEventAssignedToResource(t,i[0])||(t.resource=i[0]),[];t.resourceId=i[0].id}let d=[];return a.suspendAutoCommit(),i.forEach(u=>{const h=a.getAssignmentForEventAndResource(t,u);if(h)n&&o.delete(h);else{var f;const g={event:t,resource:u};d.push((f=r?.(g))!==null&&f!==void 0?f:g)}}),d=a.add(d),n&&a.remove(Array.from(o)),a.resumeAutoCommit(),d}unassignEventFromResource(t,i){const r=this,n=[];if(!i)return r.removeAssignmentsForEvent(t);i=W.asArray(i);for(let s=0;s<i.length;s++)r.isEventAssignedToResource(t,i[s])&&n.push(r.getAssignmentForEventAndResource(t,i[s]));return r.remove(n)}isEventAssignedToResource(t,i){return Boolean(this.getAssignmentForEventAndResource(t,i))}getAssignmentForEventAndResource(t,i){let r;return!(t=this.eventStore.getById(t))||!(r=t.assignments)||!(i=this.resourceStore.$master.getById(i))?null:this.getOccurrence(r.find(n=>{var s;return((s=n.resource)===null||s===void 0?void 0:s.$original)===i.$original}),t)}};const oD=xi(Fm.derive($t));class os extends aD(oD){static get defaultConfig(){return{modelClass:ao}}}M(os,"$name","AssignmentStore");os._$name="AssignmentStore";var lD=c=>class extends(c||P){static get $name(){return"ResourceStoreMixin"}get isResourceStore(){return!0}static get defaultConfig(){return{loadPriority:200,syncPriority:100,storeId:"resources",autoTree:!0}}construct(t){if(super.construct(t),!this.modelClass.isResourceModel)throw new Error("Model for ResourceStore must subclass ResourceModel")}removeAll(){const t=super.removeAll(...arguments);return t&&this.assignmentStore.removeAll(),t}onRecordIdChange({record:t,oldValue:i,value:r}){super.onRecordIdChange({record:t,oldValue:i,value:r}),t.isFieldModified("id")&&(this.isChangingId=!0,t.updateAssignmentResourceIds(),this.isChangingId=!1)}get allResourceRecords(){return this._allResourceRecords||(this._allResourceRecords=this.getAllDataRecords())}getAvailableResources({startDate:t,endDate:i}){return this.query(r=>this.eventStore.isDateRangeAvailable(t,i,null,r))}},dD=c=>class extends c{static get $name(){return"ResourceModelMixin"}static get isResourceModel(){return!0}static get fields(){return[{name:"name",type:"string",persist:!0},"eventColor","eventStyle","imageUrl","image",{name:"resourceMargin",type:"number"},{name:"barMargin",type:"number"},"eventLayout"]}updateAssignmentResourceIds(){this.assigned.forEach(t=>{t.resourceId=this.id})}syncId(t){super.syncId(t),this.updateAssignmentResourceIds()}get events(){return this.assignments.reduce((t,i)=>(i.event&&t.push(i.event),t),[])}get assignments(){return this.assigned?[...this.assigned]:[]}set assignments(t){t.forEach(i=>{i.resource=this})}getEvents(){return this.events}get isPersistable(){return super.isPersistable&&(!this.parent||this.parent.isPersistable)}unassignAll(){this.assignments&&this.assignmentStore.remove(this.assignments)}get initials(){const{name:t=""}=this;if(!t)return"";const i=t.split(" "),r=i[0][0],n=i.length>1?i[i.length-1][0]:"";return r+n}isWorkingTime(t){var i,r;const n=this.effectiveCalendar||((i=this.project)===null||i===void 0?void 0:i.calendar);return!n||((r=n.isWorkingTime)===null||r===void 0?void 0:r.call(n,t))}};const cD=Bn;class ls extends dD(xi(cD.derive(Rr))){static get $name(){return"ResourceModel"}}ls.exposeProperties();ls._$name="ResourceModel";const uD=xi(Pm.derive($t));class oo extends lD(uD){static get defaultConfig(){return{modelClass:ls}}}oo._$name="ResourceStore";var hD=c=>class extends(c||P){static get $name(){return"EventStoreMixin"}construct(t){super.construct(t),this.autoTree=!0}set filtersFunction(t){super.filtersFunction=t}get filtersFunction(){const t=super.filtersFunction;return t&&t!==ve.returnTrue?i=>i.isCreating||t(i):t}getEventCounts(t){const i=this,{filtersFunction:r,added:n}=i,s=i.getEvents(F(F({},t),{},{storeFilterFn:i.isFiltered?i.reapplyFilterOnAdd?r:a=>n.includes(a)?i.indexOf(a)>-1:r(a):null,dateMap:t.dateMap||!0}));return s.forEach((a,o)=>s.set(o,a.length)),s}forEachScheduledEvent(t,i=this){this.forEach(r=>{const{startDate:n,endDate:s}=r;if(n&&s)return t.call(i,r,n,s)})}getTotalTimeSpan(){let t=new Date(9999,0,1),i=new Date(0);return this.forEach(r=>{r.startDate&&(t=b.min(r.startDate,t)),r.endDate&&(i=b.max(r.endDate,i))}),t=t<new Date(9999,0,1)?t:null,i=i>new Date(0)?i:null,this.lastTotalTimeSpan={startDate:t||null,endDate:i||t||null}}isEventPersistable(t){return t.isPersistable}isDateRangeAvailable(t,i,r,n){if(n.data.generatedParent)return!1;const s=new Set(this.getEventsForResource(n));if(r!=null&&r.isAssignment&&r.event.resources.forEach(l=>{l.id!==r.resourceId&&this.getEventsForResource(l).forEach(d=>s.add(d))}),r){const a=r.isAssignment?r.event:r;s.delete(a)}return!Array.from(s).some(a=>a.isScheduled&&b.intersectSpans(t,i,a.startDate,a.endDate))}filterEventsForResource(t,i,r=this){return t.getEvents(this).filter(i.bind(r))}getResourcesForEvent(t){return t.isOccurrence&&(t=t.recurringTimeSpan),this.assignmentStore.getResourcesForEvent(t)}getEventsForResource(t){return this.assignmentStore.getEventsForResource(t)}getAssignmentsForEvent(t){return this.assignmentStore.getAssignmentsForEvent(t)||[]}getAssignmentsForResource(t){return this.assignmentStore.getAssignmentsForResource(t)||[]}assignEventToResource(t,i,r=!1){return this.assignmentStore.assignEventToResource(t,i,void 0,r)}unassignEventFromResource(t,i){this.assignmentStore.unassignEventFromResource(t,i)}reassignEventFromResourceToResource(t,i,r){const n=this,s=de.asId(r),a=n.assignmentStore.getAssignmentForEventAndResource(t,i);a?a.resourceId=s:n.assignmentStore.assignEventToResource(t,r)}isEventAssignedToResource(t,i){return this.assignmentStore.isEventAssignedToResource(t,i)}removeAssignmentsForEvent(t){this.assignmentStore.removeAssignmentsForEvent(t)}removeAssignmentsForResource(t){this.assignmentStore.removeAssignmentsForResource(t)}};const fD=()=>!0,gD=c=>!c.isRecurring;var mD=c=>{var e;return e=class extends c{getEvents({filter:i,date:r,startDate:n,endDate:s,startOnly:a,includeOccurrences:o,allowPartial:l,onlyAssigned:d=!1,dateMap:u=!1,dayTime:h=null,getDateIndex:f}){const g=this,m=arguments[0],{lastDateRange:p,added:v,filtersFunction:y}=g,C=i;if(d&&(m.filter=C?w=>C(w)&&w.resources.length:w=>w.resources.length),"startDate"in m||(n=m.startDate=r),"includeOccurrences"in m||(o=m.includeOccurrences=!0),"allowPartial"in m||(l=m.allowPartial=!a),m.storeFilterFn=g.isFiltered&&!m.ignoreFilters?g.reapplyFilterOnAdd?y:w=>v.includes(w)?g.indexOf(w)>-1:y(w):null,!s)if(n)s=m.endDate=b.clearTime(n),s.setDate(s.getDate()+1);else{if(o)throw new Error("getEvents MUST be passed startDate and endDate if recurring occurrences are requested");m.dateFilter=fD}m.dateFilter||(a?m.dateFilter=w=>{const E=w.hasBatchedChange("startDate")?w.get("startDate"):w.startDate;return E&&!(b.clearTime(E)-n)}:l?m.dateFilter=w=>{const E=w.hasBatchedChange("startDate")?w.get("startDate"):w.startDate,R=w.hasBatchedChange("endDate")?w.get("endDate"):w.endDate||E,x=!(E-R);return E&&(x?b.betweenLesserEqual(E,n,s):b.intersectSpans(E,R,n,s))}:m.dateFilter=w=>{const E=w.hasBatchedChange("startDate")?w.get("startDate"):w.startDate,R=w.hasBatchedChange("endDate")?w.get("endDate"):w.endDate||E;return E&&E>=n&&R<=s});const D={startDate:n,endDate:s};return g.processConfiguredListeners(),g.trigger("loadDateRange",{old:p||{},new:U.clone(D),changed:!p||p.startDate-D.startDate||p.endDate-D.endDate}),g.lastDateRange=U.clone(D),u?g.getEventsAsMap(m):g.getEventsAsArray(m)}getEventsAsArray({filter:i,date:r,resourceRecord:n,startDate:s=r,endDate:a,startOnly:o,includeOccurrences:l=!0,dayTime:d=null,dateFilter:u,storeFilterFn:h,getDateIndex:f}){const g=this,m=[];if(h?g.count:g.allCount){let v=n?g.getEventsForResource(n):null;if(!n){const y=g.useDayIndex(d),C=new Set,D=o?"startDate":"date";g.recurringEvents.forEach(w=>{y.dayTime.startOfDay(w.startDate)<=s&&C.add(w)});for(const w=new Date(s);w<a;w.setDate(w.getDate()+1)){const E=y.get(f?f(w):D,w);E?.forEach(R=>C.add(R))}v=[...C]}h&&(v=v.filter(h));for(let y=0,{length:C}=v;y<C;y++){const D=v[y];l&&D.isRecurring?m.push.apply(m,D.getOccurrencesForDateRange(s,a).filter(u)):u(D)&&m.push(D)}}return i?m.filter(i):m}getEventsAsMap({filter:i,date:r,resourceRecord:n,startDate:s=r,endDate:a,startOnly:o,includeOccurrences:l=!0,dateMap:d,dayTime:u=null,storeFilterFn:h,getDateIndex:f}){var g;const m=this;if((g=d)!==null&&g!==void 0&&g.clear?d.clear():d=new Map,m.count){const y=m.useDayIndex(u),C=o?"startDate":"date",D=[],w=R=>(!i||i(R))&&(!h||h(R)),E=R=>gD(R)&&w(R);if(u=y.dayTime,n)throw new Error("Querying for events for a resource and returning a date-keyed Map is not supported");var p;(p=m.recurringEvents)===null||p===void 0||p.forEach(R=>{u.startOfDay(R.startDate)<a&&D.push(R)});for(const R=new Date(s);R<a;R.setDate(R.getDate()+1)){var v;let[x,k]=y.get(f?f(R):C,R,!0);(v=x)!==null&&v!==void 0&&v.size&&(x=[...x].filter(E),x.length&&(d.get(k)||d.set(k,[]).get(k)).push(...x))}for(let R=0,{length:x}=D;R<x;R++){const k=D[R],I=(l?k.getOccurrencesForDateRange(s,a):[k]).filter(w),A=b.add(a,1,"day");for(let L,O=0,{length:_}=I;O<_;O++){const V=I[O],Y=u.startOfDay(V.startDate),J=f?f(Y):o?"startDate":"date",X=J==="startDate"||V.allDay?b.add(Y,1,"day"):b.min(V.endDate||b.add(V.startDate,V.duration,V.durationUnit),A);for(;Y<X;Y.setDate(Y.getDate()+1)){const q=u.dateKey(Y);(L=d.get(q))||d.set(q,L=[]),L.push(V)}}}}return d}},M(e,"$name","GetEventsMixin"),e};const ha={date:"_dateIndex",startDate:"_startDateIndex"},jl=Object.values(ha),sf=Object.freeze([]),{MILLIS_PER_DAY:af}=me;class Fd{constructor(e,t){this.dayTime=t||me.MIDNIGHT,this.store=e,this.users=[this.dayTime]}add(e,t,i){const r=this[ha[e]],n=this.dayTime.dateKey(t);(r[n]||(r[n]=new Set)).add(i)}addEvent(e){var t;let i=(t=this.dayTime.startOfDay(e.startDate))===null||t===void 0?void 0:t.getTime(),r;if(i){var n,s;r=(n=(s=e.endDate)===null||s===void 0?void 0:s.getTime())!==null&&n!==void 0?n:i,this.add("startDate",i,e);do this.add("date",i,e),i+=af;while(i<r)}}clear(){jl.forEach(e=>this[e]=Object.create(null))}get(e,t,i){!this.initialized&&this.initialize();let r=this[ha[e]],n;return t&&(n=this.dayTime.dateKey(t),r=i?[r[n],n]:r[n]),r}initialize(){this.initialized=!0,this.clear(),this.sync("splice",this.store.storage.allValues)}invalidate(){this.initialized=!1,jl.forEach(e=>this[e]=null)}matches(e){return this.dayTime.startShift===e.startShift}remove(e,t,i){const r=this[ha[e]],n=this.dayTime.dateKey(t),s=r[n];s&&s.delete(i)}removeEvent(e,t,i){var r;let n=(r=this.dayTime.startOfDay(t))===null||r===void 0?void 0:r.getTime(),s;if(n){var a;s=(a=i?.getTime())!==null&&a!==void 0?a:n,this.remove("startDate",n,e);do this.remove("date",n,e),n+=af;while(n<s)}}sync(e,t,i,r,n){var s,a;t=t||sf,i=i||sf;const o=this,l=t.length,d=i.length,u=r?.length;let h,f,g;if(!!o.initialized)switch(e){case"clear":o.clear();break;case"splice":if(u)for(t=t.slice(),i=i.slice(),h=0;h<u;h++)i.push(r[h][0]),t.push(r[h][1]);if(d)for(h=0;h<d;h++)g=i[h],o.removeEvent(g,g.startDate,g.endDate);if(l)for(h=0;h<l;h++)f=t[h],f.isScheduled&&!f.isParent&&o.addEvent(f);break;case"reschedule":g=t[0],o.removeEvent(g,((s=n.startDate)===null||s===void 0?void 0:s.oldValue)||g.startDate,((a=n.endDate)===null||a===void 0?void 0:a.oldValue)||g.endDate),o.sync("splice",t);break}}register(e){this.users.push(e)}unregister(e){const{users:t}=this,i=t.indexOf(e);return i>-1&&t.splice(i,1),!t.length}}const qm=Fd.prototype;jl.forEach(c=>qm[c]=null);qm.initialized=!1;Fd._$name="EventDayIndex";const{MIDNIGHT:of}=me;var pD=c=>{var e;return e=class extends c{construct(i){super.construct(i),this.dayIndices=null}afterLoadData(){var i;this.syncIndices("splice",this.storage.allValues),(i=super.afterLoadData)===null||i===void 0||i.call(this)}onDataChange({action:i,added:r,removed:n,replaced:s}){this.syncIndices(i,r,n,s),super.onDataChange(...arguments)}onDataReplaced(i,r){this.syncIndices("clear"),this.syncIndices("splice",this.storage.values),super.onDataReplaced(i,r)}onModelChange(i,r,n,s,a){("startDate"in n||"endDate"in n)&&this.syncIndices("reschedule",[i],null,null,n),super.onModelChange(...arguments)}invalidateDayIndices(){var i;(i=this.dayIndices)===null||i===void 0||i.forEach(r=>r.invalidate())}registerDayIndex(i){const r=this,n=r.dayIndices||(r.dayIndices=[]);let s,a;for(a=0;!s&&a<n.length;++a)n[a].matches(i)&&(s=n[a]).register(i);return!s&&n.push(s=new Fd(r,i)),s}syncIndices(...i){var r;(r=this.dayIndices)===null||r===void 0||r.forEach(n=>n.sync(...i))}unregisterDayIndex(i){const r=this,{dayIndices:n}=r;for(let s=n?.length;s-- >0;)if(n[s].matches(i)){n[s].unregister(i)&&n.splice(s,1);break}}useDayIndex(i){const r=this,{dayIndices:n}=r;i=i||of;for(let s=0;n&&s<n.length;++s)if(n[s].matches(i))return n[s];if(i.startShift)throw new Error(`No day index registered for ${i} on ${r.id}`);return r.registerDayIndex(of)}},M(e,"$name","DayIndexMixin"),e},vD=c=>class extends c{static get $name(){return"SharedEventStoreMixin"}static get defaultConfig(){return{loadPriority:100,syncPriority:200,storeId:"events",removeUnassignedEvent:!0,singleAssignment:null}}construct(t){if(super.construct(t,!0),this.singleAssignment&&(this.usesSingleAssignment=!0),!this.modelClass.isEventModel)throw new Error("The model for the EventStore must subclass EventModel")}append(t){return this.add(t)}get project(){return super.project}set project(t){if(super.project=t,this.detachListeners("project"),t){var i;(i=t.assignmentStore)!==null&&i!==void 0&&i.isAssignmentStore&&this.attachToAssignmentStore(t.assignmentStore),t.ion({name:"project",assignmentStoreChange:"onProjectAssignmentStoreChange",thisObj:this,prio:200})}}get usesSingleAssignment(){return this.isChained?this.masterStore.usesSingleAssignment:this._usesSingleAssignment}set usesSingleAssignment(t){this._usesSingleAssignment=t}processRecords(t){var i;const{assignmentStore:r}=this,n=[];return r&&(r.skipInvalidateIndices=!0),t=super.processRecords(t,r&&!((i=this.stm)!==null&&i!==void 0&&i.isRestoring)&&(s=>{const a=s.get("resourceId");!s.reassignedFromReplace&&a!=null&&(r.includesAssignment(s.id,a)||n.push({id:r.modelClass.generateId(""),resourceId:a,eventId:s.id})),s.reassignedFromReplace=!1})||void 0),r&&(r.storage.invalidateIndices(),r.skipInvalidateIndices=!1,r.add(n)),t}joinRecordsToStore(t){const{assignmentStore:i}=this;i?(i.skipInvalidateIndices=!0,super.joinRecordsToStore(t),i.storage.invalidateIndices(),i.skipInvalidateIndices=!1):super.joinRecordsToStore(t)}processRecord(t,i=!1){t=super.processRecord(t,i);const r=t.get("resourceId");if(r!=null&&!t.meta.skipEnforcingSingleAssignment){const n=this,{assignmentStore:s}=n,a=n.getById(t.id);if(a&&a!==t&&!i){const l=s.find(d=>d.eventId===t.id);l&&(l.resource=r,t.reassignedFromReplace=!0)}else n.$processResourceIds=!0;n.usesSingleAssignment=!0}return t}processResourceIds(){const{assignmentStore:t}=this;if(this.$processResourceIds&&t!==null&&t!==void 0&&t.isAssignmentStore&&!this.project.isSharingAssignmentStore){const i=[];this.forEach(r=>{const{resourceId:n,id:s}=r;n!=null&&i.push({id:t.modelClass.generateId(""),resourceId:n,eventId:s})}),t.useRawData={disableDefaultValue:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0},t.usesSingleAssignment=!1,t.verifyNoGeneratedIds=!1,t.data=i,t.usesSingleAssignment=!0,this.$processResourceIds=!1}}loadData(){super.loadData(...arguments),this.processResourceIds()}onBeforeRemoveAssignment({records:t}){var i;const r=this;if(r.removeUnassignedEvent&&!r.isRemoving&&!r.isSettingData&&!((i=r.stm)!==null&&i!==void 0&&i.isRestoring)&&!r.usesSingleAssignment&&!r.assignmentStore.isSyncingDataOnLoad&&!r.resourceStore.isSyncingDataOnLoad){const n=new Set;t.forEach(s=>{const{event:a}=s;a&&!a.isRemoved&&a.assignments.every(o=>t.includes(o))&&n.add(a)}),n.size&&r.remove([...n])}}onProjectAssignmentStoreChange({store:t}){this.attachToAssignmentStore(t)}attachToAssignmentStore(t){const i=this;i.detachListeners("assignmentStore"),t&&(i.processResourceIds(),t.ion({name:"assignmentStore",addPreCommit({records:r}){i.usesSingleAssignment&&!i.isSettingData&&!i.isAssigning&&r.forEach(n=>{const{event:s}=n;s!=null&&s.isEvent&&s.resourceId!==n.resourceId&&(s.meta.isAssigning=!0,s.set("resourceId",n.resourceId),s.meta.isAssigning=!1)})},beforeRemove:"onBeforeRemoveAssignment",removePreCommit({records:r}){i.usesSingleAssignment&&r.forEach(n=>{var s;(s=i.getById(n.eventId))===null||s===void 0||s.set("resourceId",null)})},removeAllPreCommit(){i.usesSingleAssignment&&!i.isSettingData&&i.allRecords.forEach(r=>r.set("resourceId",null))},update({record:r,changes:n}){if(i.usesSingleAssignment&&"resourceId"in n){const{event:s}=r;s.meta.isAssigning=!0,s.set("resourceId",n.resourceId.value),s.meta.isAssigning=!1}},thisObj:i}))}set data(t){this.isSettingData=!0,this.usesSingleAssignment&&!this.syncDataOnLoad&&!this.isChained&&this.assignmentStore.removeAll(!0),super.data=t,this.isSettingData=!1}trigger(t,i){const{changes:r}=i||{};return r&&"resourceId"in r&&Object.keys(r).length===1&&(i.isAssign=!0),super.trigger(...arguments)}};const lf=Object.freeze([]);var yD=c=>class extends(c||P){static get $name(){return"RecurringTimeSpansMixin"}construct(...t){const i=this;i.globalOccurrences=new Map,i.recurringEvents=new Set,super.construct(...t)}afterLoadData(){this.globalOccurrences.clear(),this.refreshRecurringEventsCache("clear"),this.refreshRecurringEventsCache("splice",this.storage.allValues),super.afterLoadData&&super.afterLoadData()}onDataChange({action:t,added:i,removed:r,replaced:n}){this.refreshRecurringEventsCache(t,i,r,n),super.onDataChange(...arguments)}refreshRecurringEventsCache(t,i=lf,r=lf,n){const s=this,{recurringEvents:a}=s,o=n?.length;switch(t){case"clear":a.clear();break;case"splice":{if(o){i=i.slice(),r=r.slice();for(let u=0;u<o;u++)r.push(n[u][0]),i.push(n[u][1])}const l=i.length,d=r.length;if(d&&a.size)for(let u=0;u<d;u++)a.delete(r[u]);if(l)for(let u=0;u<l;u++){const h=i[u];h.isRecurring&&a.add(h)}break}}}getById(t){let i=super.getById(t);return i||(i=this.globalOccurrences.get(this.modelClass.asId(t))),i}onModelChange(t,i,r,n,s){const a=this.isRecurrenceRelatedFieldChange(t,r);if(a&&!n&&t.removeOccurrences(),super.onModelChange(...arguments),a&&!n){const o={action:"batch",records:this.storage.values};this.trigger("refresh",o),this.trigger("change",o)}}isRecurrenceRelatedFieldChange(t,i){return t.isRecurring||"recurrenceRule"in i}getOccurrencesForTimeSpan(t,i,r){const n=[];return t.isRecurring&&t.recurrence.forEachOccurrence(i,r,s=>n.push(s)),n}set data(t){this.globalOccurrences.clear(),super.data=t}getRecurringTimeSpans(){return[...this.recurringEvents]}},bD=c=>class extends yD(c||P){static get $name(){return"RecurringEventsMixin"}getRecurringEvents(){return this.getRecurringTimeSpans()}isEventPersistable(t){return super.isEventPersistable(t)&&(!t.supportsRecurring||!t.isOccurrence)}};const Sl={startDate:1,endDate:1,constraintDate:1,deadlineDate:1};var CD=c=>{var e;return e=class extends(c||Ct){setLocalDate(i,r){this.set(i,this._inTimeZone?Xe.toTimeZone(r,this._inTimeZone):r,!0),this.data[i]=this[i]}getLocalDate(i){return this._inTimeZone&&this[i]?Xe.fromTimeZone(this[i],this._inTimeZone):this[i]}applyChangeset(i){const{_inTimeZone:r}=this;if(r!=null)for(const n in Sl)i[n]&&(this.setLocalDate(n,new Date(i[n])),delete i[n]);return super.applyChangeset(...arguments)}getFieldPersistentValue(i){if(this._inTimeZone){var r,n;const s=(r=(n=i?.field)!==null&&n!==void 0?n:i?.name)!==null&&r!==void 0?r:i;if(Sl[s])return this.getLocalDate(s)}return super.getFieldPersistentValue(i)}convertToTimeZone(i){const r=this,n=F({},r.meta.modified),s=F({},Sl);r.isTask&&!r.manuallyScheduled&&(delete s.startDate,delete s.endDate);for(const a in s)r[a]!=null?(s[a]=r[a],r._inTimeZone&&(s[a]=r.getLocalDate(a),n[a]&&(n[a]=Xe.fromTimeZone(n[a],r._inTimeZone)))):delete s[a];r._inTimeZone=i;for(const a in s)r.setLocalDate(a,s[a],!1),s[a]=1,r._inTimeZone&&n[a]&&(n[a]=Xe.toTimeZone(n[a],r._inTimeZone));r.clearChanges(!0,!0,s),T.isEmpty(n)||(r.meta.modified=n,r.stores.forEach(a=>a.modified.add(r)))}},M(e,"$name","TimeZonedDatesMixin"),e};class Ct extends de.mixin(CD){static get $name(){return"TimeSpan"}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number",allowNull:!0,internal:!0},{type:"durationunit",name:"durationUnit",defaultValue:"d",internal:!0},{name:"fullDuration",persist:!1,column:{type:"duration"}},{name:"cls",defaultValue:"",internal:!0},{name:"iconCls",internal:!0},{name:"style",type:"object",internal:!0},{name:"name",type:"string",defaultValue:""}]}afterConstruct(){super.afterConstruct(),this.normalize()}get eventStore(){const e=this;if(e.isOccurrence)return e.recurringTimeSpan.eventStore;if(!e._eventStore){var t;e._eventStore=(t=e.stores)===null||t===void 0?void 0:t.find(i=>i.isEventStore)}return e._eventStore}normalize(){const e=this,{startDate:t,endDate:i,duration:r,durationUnit:n}=e,s=r!=null;t&&i&&!s?e.setData("duration",b.diff(t,i,n,!0)):t&&!i&&s?e.setData("endDate",b.add(t,r,n)):!t&&i&&s&&e.setData("startDate",b.add(i,-r,n))}updateInternalCls(e){this._cls?this._cls.value=e:this._cls=new Q(e)}set internalCls(e){this.updateInternalCls(e),this.set("cls",this._cls.value)}get internalCls(){const{cls:e}=this;return e!=null&&e.isDomClassList?e:(this.internalCls=e,this._cls)}get cls(){return this._cls||(this._cls=new Q(super.get("cls"))),this._cls}set cls(e){this.internalCls=e}get startDate(){return this.get("startDate")}set startDate(e){this.setStartDate(e)}get endDate(){return this.get("endDate")}set endDate(e){this.setEndDate(e)}get endingDate(){const e=this,{endDate:t,startDate:i}=e;return t||b.add(i,e.duration,e.durationUnit)}get duration(){return this.get("duration")}set duration(e){this.setDuration(e,this.durationUnit)}get durationUnit(){return this.get("durationUnit")}setDuration(e,t=this.durationUnit){e=parseFloat(e);const i={duration:e,durationUnit:t};this.startDate?i.endDate=b.add(this.startDate,e,t):this.endDate&&(i.startDate=b.add(this.endDate,-e,t)),this.set(i)}getDurationInUnit(e,t){return this.starDate&&this.endDate?b.getDurationInUnit(this.startDate,this.endDate,e,t):b.as(e,this.duration,this.durationUnit)}get fullDuration(){return new Ue({unit:this.durationUnit,magnitude:this.duration})}set fullDuration(e){typeof e=="string"&&(e=b.parseDuration(e,!0,this.durationUnit)),this.setDuration(e.magnitude,e.unit)}setStartDate(e,t=!0){const i=this,r={startDate:e};if(e){let n;if(t)n=i.duration!=null;else if(i.endDate){if(r.duration=b.diff(e,i.endDate,i.durationUnit,!0),r.duration<0)throw new Error("Negative duration")}else n=this.duration!=null;n&&(r.endDate=b.add(e,i.getDurationInUnit("h"),"h"))}else r.duration=null;i.set(r)}setEndDate(e,t=!1){const i=this,r={endDate:e};if(e){let n;if(t===!0)n=i.duration!=null;else if(i.startDate){if(r.duration=b.diff(i.startDate,e,i.durationUnit,!0),r.duration<0)throw new Error("Negative duration")}else n=this.duration!=null;n&&(r.startDate=b.add(e,-i.duration,i.durationUnit))}i.set(r)}setStartEndDate(e,t,i){this.set({startDate:e,endDate:t},null,i)}get dates(){const e=[],t=b.startOf(this.startDate,"day"),i=this.endDate;for(let r=t;r<i;r=b.add(r,1,"day"))e.push(r);return e}get startDateMS(){var e;return(e=this.batching&&this.hasBatchedChange("startDate")?this.get("startDate"):this.startDate)===null||e===void 0?void 0:e.getTime()}get endDateMS(){var e;return(e=this.batching&&this.hasBatchedChange("endDate")?this.get("endDate"):this.endDate)===null||e===void 0?void 0:e.getTime()}get durationMS(){const{endDateMS:e,startDateMS:t}=this;return e&&t?e-t:b.asMilliseconds(this.duration||0,this.durationUnit)}get isMilestone(){return this.duration===0}inSetNormalize(e){if(typeof e!="string"){let{startDate:t,endDate:i,duration:r,durationUnit:n=this.durationUnit}=e;typeof t=="string"&&(t=this.getFieldDefinition("startDate").convert(t)),typeof i=="string"&&(i=this.getFieldDefinition("endDate").convert(i)),"duration"in e?(t&&!i&&(i=b.add(t,r,n,!0,!0)),!t&&i&&(t=b.add(i,-r,n,!0,!0))):t&&i&&(r=b.as(n,b.diff(t,i,"h",!0),"h"));const s=Object.isFrozen(e)?T.clone(e):e;return t&&(s.startDate=t),i&&(s.endDate=i),r!=null&&(s.duration=r),s}}inSet(e,t,i,r,n,s){return n||(e=this.inSetNormalize(e)||e),super.inSet(e,t,i,r,n,s)}applyValue(e,t,i,r,n){t==="cls"&&this.updateInternalCls(i),t==="fullDuration"&&(this[t]=i),super.applyValue(e,t,i,r,n)}forEachDate(e,t){return this.dates.forEach(e.bind(t))}get isScheduled(){const{startDateMS:e,endDateMS:t}=this;return t-e>=0}get isValid(){const{startDate:e,endDate:t}=this;return!e||!t||t-e>=0}shift(e,t=this.durationUnit){if(typeof e=="string"){const i=e;e=t,t=i}return this.setStartDate(b.add(this.startDate,e,t,!0),!0)}get wbsCode(){return this._wbsCode||this.indexPath.join(".")}set wbsCode(e){this._wbsCode=e}fullCopy(){return this.copy.apply(this,arguments)}intersects(e){return this.intersectsRange(e.startDate,e.endDate)}intersectsRange(e,t){const i=this.startDate,r=this.endDate;return i&&r&&b.intersectSpans(i,r,e,t)}split(e=.5){const t=this,i=t.copy(),{fullDuration:r,eventStore:n,assignmentStore:s}=t,a=new Ue(r),o=new Ue(r);let l,d;return typeof e=="string"?(l=new Ue(e),l.unit===a.unit?o.magnitude-=l.magnitude:(o.magnitude=b.as(l.unit,a)-l.magnitude,o.unit=l.unit,d=!0)):(l=new Ue(e>1?e:t.duration*e,t.durationUnit),o.magnitude-=l.magnitude),i.startDate=b.add(t.startDate,l.magnitude,l.unit),d?(i.fullDuration=o,t.fullDuration=l):(i.duration=o.magnitude,t.duration=l.magnitude),n&&(n.add(i),s&&!n.usesSingleAssignment&&s.add(t.assignments.map(u=>{const h=Object.assign({},u.data,{eventId:i.id,event:null,resource:null});return delete h.id,h}))),i}toICSString(e={}){if(!this.isScheduled)return"";const{startDate:t,endDate:i}=this,r=e.DTSTAMP||b.format(new Date,"uu");delete e.DTSTAMP;let n={};this.allDay?n={"DTSTART;VALUE=DATE":b.format(t,"u"),"DTEND;VALUE=DATE":b.format(i,"u")}:n={DTSTART:b.format(t,"uu"),DTEND:b.format(i,"uu")};const s=ae.scheduler&&ae.getVersion("scheduler")||ae.calendar&&ae.getVersion("calendar")||"",a={BEGIN:"VCALENDAR",VERSION:"2.0",CALSCALE:"GREGORIAN",PRODID:`-//Bryntum AB//Bryntum Scheduler ${s} //EN`,END:"VCALENDAR"},o=F(F(F(F({BEGIN:"VEVENT",UID:this.id+"@bryntum.com",CLASS:"PUBLIC",SUMMARY:this.name,DTSTAMP:r},n),this.recurrenceRule?{RRULE:this.recurrenceRule}:{}),e),{},{END:"VEVENT"}),l=Object.keys(a).map(u=>`${u}:${a[u]}`),d=Object.keys(o).map(u=>`${u}:${o[u]}`);return l.splice(l.length-1,0,...d),l.join(`
`)}exportToICS(e){if(this.isScheduled){const t=new Blob([this.toICSString(e)],{type:"text/calendar"});K.downloadBlob(t,(this.name||"Event")+".ics")}}isEditable(e){return this.getFieldDefinition(e)?!0:void 0}isFieldModified(e){return e==="fullDuration"?super.isFieldModified("duration")||super.isFieldModified("durationUnit"):super.isFieldModified(e)}}Ct._$name="TimeSpan";const wD=/^([+-]?[0-9])?(SU|MO|TU|WE|TH|FR|SA)$/,df=["SU","MO","TU","WE","TH","FR","SA"];class yt extends P{static decodeDay(e){let t,i;return(t=wD.exec(e))&&(i=[df.indexOf(t[2])],t[1]&&(t[1]=parseInt(t[1],10),i.push(t[1]))),i}static encodeDay(e){let t;return Array.isArray(e)&&([e,t]=e),(t?t.toString():"")+df[e]}static decode(e){const t=[];let i;if(e)for(let r=0;r<e.length;r++)(i=this.decodeDay(e[r]))&&t.push(i);return t}static encode(e){const t=[];let i;if(e)for(let r=0;r<e.length;r++)(i=this.encodeDay(e[r]))&&t.push(i);return t}}yt._$name="RecurrenceDayRuleEncoder";const SD=/ly$/i,Dl=c=>{const e=c.replace(SD,"");return e==="DAI"?"DAY":e},DD=(c,e,t,i)=>i.buildOccurrence(c,t),ED=c=>Wl=c;let Wl;class Ri extends P{static processIterationConfig(e){var t;const{recurrence:i}=e,{frequency:r,interval:n,timeSpan:s,endDate:a,count:o}=i;if(!e.syncingStartDate&&!s.meta.isSyncedWithRule){const f=b.add(s.startDate,n,Dl(r)),g=b.min(f,e.endDate||f);this.forEachDate({syncingStartDate:!0,startDate:s.startDate,endDate:g,recurrence:i,fn:DD})}const l=s.startDate;let{startDate:d=l,endDate:u=a}=e;d<l&&(d=l),a?(!u||u>a)&&(u=a):o&&d>l&&(this.forEachDate({recurrence:i,fn:ED}),(!u||u>Wl)&&(u=new Date(Wl.getTime()+1)));const h=d;return e.startOnly||(d=new Date(b.max(b.add(d,-n,Dl(r)),l))),Object.assign({extraArgs:[],startOnly:!Boolean(s.durationMS)},e,{startDate:d,endDate:u,timeSpan:s,timeSpanStart:l,earliestVisibleDate:h,endDateMS:(t=u)===null||t===void 0?void 0:t.getTime(),timeSpanStartMS:l.getTime(),earliestVisibleDateMS:h.getTime(),durationMS:s.durationMS,spansStart:d<=l&&u>l})}static getOccurrenceIndex(e){if(e.isOccurrence)return b.diff(e.recurringTimeSpan.startDate,e.startDate,Dl(e.recurringTimeSpan.recurrence.frequency))}static getNthDayInPeriod(e,t,i,r){let n,s,a;if(r){r>0?(s=1,a=e):(s=-1,a=t);const o=i-a.getDay();s*o<0&&(r+=s),n=new Date(a),n.setDate(a.getDate()+(r-s)*7+o),(n<e||n>t)&&(n=null)}return n}static buildDate(e,t,i){const r=new Date(e,t,i);if(r.getFullYear()===e&&r.getMonth()===t&&r.getDate()===i)return r}static isValidPosition(e){return Boolean(e)}static forEachDateAtPositions(e,t,i,r){const n=e.length,s={};for(let a=0;a<t.length;a++){const o=t[a];if(this.isValidPosition(o)){const l=o>0?e[o-1]:e[n+o];if(l&&!s[l.getTime()]&&(s[l.getTime()]=!0,i.call(r,l)===!1))return!1}}}static isInView(e,t,i,r,n){return(e?t>=i:t.valueOf()+r>i)&&!n.hasException(t)}static isInViewMS(e,t,i,r,n,s){return(e?i>=r:i+n>r)&&!s.hasException(t)}}M(Ri,"frequency","NONE");M(Ri,"MAX_OCCURRENCES_COUNT",1e6);Ri._$name="AbstractRecurrenceIterator";class Ad extends Ri{static forEachDate(e){const{startOnly:t,startDate:i,endDate:r,endDateMS:n,timeSpan:s,timeSpanStart:a,earliestVisibleDateMS:o,durationMS:l,spansStart:d,recurrence:u,fn:h,extraArgs:f,scope:g=this}=this.processIterationConfig(e),{interval:m}=u,p=i-a,v=m*864e5,y=Math.floor(p/v);let{count:C}=u,D=0,w=b.add(a,y*m,"day"),E=w.getTime();for(!r&&!C&&(C=this.MAX_OCCURRENCES_COUNT);!n||E<n;){const R=this.isInViewMS(t,w,E,o,l,s);if(D++,R&&(n&&E>n||h.apply(g,[w,D,D===1&&d,s,...f])===!1||C&&D>=C))break;w=b.add(w,m,"day"),E=w.getTime()}}}M(Ad,"frequency","DAILY");Ad._$name="DailyRecurrenceIterator";class Ld extends Ri{static forEachDate(e){var t;const{startOnly:i,startDate:r,endDateMS:n,timeSpan:s,timeSpanStart:a,timeSpanStartMS:o,earliestVisibleDateMS:l,durationMS:d,spansStart:u,recurrence:h,fn:f,extraArgs:g,scope:m=this}=this.processIterationConfig(e),{interval:p,days:v}=h,{weekStartDay:y}=b,C=a.getHours(),D=a.getMinutes(),w=a.getSeconds(),E=a.getMilliseconds();let R=0,{count:x}=h,k=yt.decode(v),I,A;if((t=k)!==null&&t!==void 0&&t.length||(k=[[a.getDay()]]),y>0)for(let L=0;L<k.length;L++)y>k[L][0]?k[L][0]=7-y-k[L][0]:k[L][0]-=y;for(k.sort((L,O)=>L[0]-O[0]),I=b.getNext(x||p>1?a:r,"week",0),!n&&!x&&(x=this.MAX_OCCURRENCES_COUNT);!n||I.getTime()<n;){for(let L=0;L<k.length;L++){A=new Date(I.getFullYear(),I.getMonth(),I.getDate()+k[L][0],C,D,w,E);const O=A.getTime();if(O>=o){const _=this.isInViewMS(i,A,O,l,d,s);if(R++,_&&(n&&O>=n||f.apply(m,[A,R,R===1&&u,s,...g])===!1||x&&R>=x))return}}I=b.getNext(I,"week",p)}}}M(Ld,"frequency","WEEKLY");Ld._$name="WeeklyRecurrenceIterator";class Od extends Ri{static getNthDayOfMonth(e,t){const i=b.daysInMonth(e);let r=null;return t&&Math.abs(t)<=i&&(r=new Date(e.getFullYear(),e.getMonth(),t<0?i+t+1:t)),r}static isValidPosition(e){return e&&Math.abs(e)>0&&Math.abs(e)<=31}static forEachDate(e){const{startOnly:t,startDate:i,endDate:r,timeSpan:n,timeSpanStart:s,earliestVisibleDate:a,durationMS:o,spansStart:l,recurrence:d,fn:u,extraArgs:h,scope:f=this}=this.processIterationConfig(e),{interval:g,days:m,count:p,positions:v}=d,y=yt.decode(m),C=v&&v.length,D={};let{monthDays:w}=d,E=0,R,x,k,I,A,L;for(x=b.startOf(p||g>1?s:i,"month"),k=new Date(b.getNext(x,"month",1)-1),!(w&&w.length)&&!(y&&y.length)&&(w=[s.getDate()]),y&&y.length&&y.forEach(O=>{O[1]&&(R=R||{},R[O[0]]=O[1])});(!r||r>x)&&(!p||E<p);){if(I=[],y&&y.length){if(y.forEach(O=>{const _=O[0];let V=1,Y=53;for(O[1]&&(V=Y=O[1]),L=V;L<=Y;L++)(A=this.getNthDayInPeriod(x,k,_,L))&&(A=b.copyTimeValues(A,s),D[A.getTime()]||(D[A.getTime()]=!0,I.push(A)))}),I.sort((O,_)=>O-_),!C){for(L=0;L<I.length;L++)if(A=I[L],A>=s){const O=this.isInView(t,A,a,o,n);if(E++,O&&(r&&A>=r||u.apply(f,[A,E,E===1&&l,n,...h])===!1||p&&E>=p))return!1}}}else{const O=[];for(L=0;L<w.length;L++)(A=this.getNthDayOfMonth(x,w[L]))&&!D[A.getTime()]&&(D[A.getTime()]=!0,O.push(A));for(O.sort((_,V)=>_-V),L=0;L<O.length;L++)if(A=b.copyTimeValues(O[L],s),C)I.push(A);else if(A>=s){const _=this.isInView(t,A,a,o,n);if(E++,_&&(r&&A>r||u.apply(f,[A,E,E===1&&l,n,...h])===!1||p&&E>=p))return}}C&&I.length&&this.forEachDateAtPositions(I,v,O=>{if(O>=s){const _=t?O>=a:O.valueOf()+o>a&&!n.hasException(O);if(E++,_&&(!r||O<=r)&&(u.apply(f,[O,E,E===1&&l,n,...h])===!1||p&&E>=p))return!1}}),x=b.getNext(x,"month",g),k=new Date(b.getNext(x,"month",1)-1)}}}M(Od,"frequency","MONTHLY");Od._$name="MonthlyRecurrenceIterator";class Pd extends Ri{static forEachDate(e){const{startOnly:t,startDate:i,endDate:r,timeSpan:n,timeSpanStart:s,earliestVisibleDate:a,durationMS:o,spansStart:l,recurrence:d,fn:u,extraArgs:h,scope:f=this}=this.processIterationConfig(e),{interval:g,days:m,count:p,positions:v}=d,y=yt.decode(m),C=v&&v.length,D={};let{months:w}=d,E=0,R,x,k,I,A,L;for(I=b.startOf(p||g>1?s:i,"year"),A=new Date(b.getNext(I,"year",1)-1),w&&w.sort((O,_)=>O-_),!(w&&w.length)&&!(y&&y.length)&&(w=[s.getMonth()+1]),y&&y.length&&y.forEach(O=>{O[1]&&(L=L||{},L[O[0]]=O[1])});(!r||r>I)&&(!p||E<p);){if(k=[],y&&y.length){if(y.forEach(O=>{const _=O[0];let V=1,Y=53;for(O[1]&&(V=Y=O[1]),R=V;R<=Y;R++)(x=this.getNthDayInPeriod(I,A,_,R))&&(x=b.copyTimeValues(x,s),D[x.getTime()]||(D[x.getTime()]=!0,k.push(x)))}),k.sort((O,_)=>O-_),!C){for(R=0;R<k.length;R++)if(x=k[R],x>=s){const O=this.isInView(t,x,a,o,n);if(E++,O&&(r&&x>=r||u.apply(f,[x,E,E===1&&l,n,...h])===!1||p&&E>=p))return}}}else for(R=0;R<w.length;R++)if((x=this.buildDate(I.getFullYear(),w[R]-1,s.getDate()))&&(x=b.copyTimeValues(x,s),!D[x.getTime()])){if(D[x.getTime()]=!0,C)k.push(x);else if(x>=s){const O=t?x>=a:x.valueOf()+o>a&&!n.hasException(x);if(E++,O&&(r&&x>=r||u.apply(f,[x,E,E===1&&l,n,...h])===!1||p&&E>=p))return}}C&&k.length&&this.forEachDateAtPositions(k,v,O=>{if(O>=s){const _=t?O>=a:O.valueOf()+o>a&&!n.hasException(O);if(E++,_&&(!r||O<r)&&(u.apply(f,[O,E,E===1&&l,n,...h])===!1||p&&E>=p))return!1}}),I=b.getNext(I,"year",g),A=new Date(b.getNext(I,"year",1)-1)}}}M(Pd,"frequency","YEARLY");Pd._$name="YearlyRecurrenceIterator";const Km={};[Ad,Ld,Od,Pd].forEach(c=>{Km[c.frequency]=c});function El(c){return c?typeof c=="string"&&(c=c.split(",").map(e=>parseInt(e,10))):c=null,c}function xD(c){return c?typeof c=="string"&&(c=c.split(",")):c=null,c}function Js(c,e){return String(c)===String(e)}function cf(c){return this.defaultValue&&c===void 0?this.defaultValue:this.allowNull&&c==null?null:(c=parseInt(c),isNaN(c)?void 0:c)}class Xm extends de{static get $name(){return"RecurrenceModel"}get isRecurrenceModel(){return!0}static get fields(){return[{name:"frequency",defaultValue:"DAILY"},{name:"interval",defaultValue:1,convert:cf},{name:"endDate",type:"date"},{name:"count",allowNull:!0,convert:cf},{name:"days",convert:xD,isEqual:Js},{name:"monthDays",convert:El,isEqual:Js},{name:"months",convert:El,isEqual:Js},{name:"positions",convert:El,isEqual:Js}]}get dateFormat(){return this._dateFormat||"YYYYMMDDTHHmmss"}set dateFormat(e){this._dateFormat=e}get recurrenceIterator(){return Km[this.frequency]}get timeSpan(){return this._timeSpan}set timeSpan(e){this._timeSpan=e}get rule(){const e=this,t=[];return e.frequency&&(t.push(`FREQ=${e.frequency}`),e.interval>1&&t.push(`INTERVAL=${e.interval}`),e.days&&e.days.length&&t.push("BYDAY="+e.days.join(",")),e.monthDays&&e.monthDays.length&&t.push("BYMONTHDAY="+e.monthDays.join(",")),e.months&&e.months.length&&t.push("BYMONTH="+e.months.join(",")),e.count&&t.push(`COUNT=${e.count}`),e.endDate&&t.push("UNTIL="+b.format(e.endDate,e.dateFormat)),e.positions&&e.positions.length&&t.push("BYSETPOS="+e.positions.join(","))),t.join(";")}set rule(e){const t=this,i={frequency:null,interval:null,count:null,endDate:null,days:null,monthDays:null,months:null,positions:null};if(t.beginBatch(),e){const r=e.split(";");for(let n=0,s=r.length;n<s;n++){const a=r[n].split("="),o=a[1];switch(a[0]){case"FREQ":i.frequency=o;break;case"INTERVAL":i.interval=o;break;case"COUNT":i.count=o,i.until=null;break;case"UNTIL":o?i.endDate=b.parse(o,t.dateFormat):i.endDate=null,i.count=null;break;case"BYDAY":i.days=o;break;case"BYMONTHDAY":i.monthDays=o;break;case"BYMONTH":i.months=o;break;case"BYSETPOS":i.positions=o;break}}}t.set(i),e&&t.sanitize(),t.endBatch()}construct(e={}){const t=this,{rule:i,timeSpan:r}=e;t._suspendedTimeSpanNotifying=0,delete e.timeSpan,delete e.rule,super.construct(...arguments),i&&(t.suspendTimeSpanNotifying(),t.rule=i,t.resumeTimeSpanNotifying()),t.timeSpan=r}forEachOccurrence(e,t,i){this.timeSpan.startDate&&this.recurrenceIterator.forEachDate({recurrence:this,startDate:e,endDate:t,fn(r,n,s,a){return i(a.buildOccurrence(r,s),s,n,r)}})}sanitize(){var e;const t=this,i=(e=t.timeSpan)===null||e===void 0?void 0:e.startDate,r={};switch(t.isSanitizing=!0,t.frequency){case"DAILY":r.positions=null,r.days=null,r.monthDays=null,r.months=null;break;case"WEEKLY":{r.positions=null,r.monthDays=null,r.months=null;const{days:s}=t;i&&s?.length===1&&s[0]===yt.encodeDay(i.getDay())&&(r.days=null);break}case"MONTHLY":{var n;(n=t.monthDays)!==null&&n!==void 0&&n.length&&(r.positions=null,r.days=null),r.months=null;const{monthDays:s}=t;i&&s?.length===1&&s[0]===i.getDate()&&(r.monthDays=null);break}case"YEARLY":{r.monthDays=null;const{months:s}=t;i&&s?.length===1&&s[0]===i.getMonth()+1&&(r.months=null);break}}t.set(r),t.isSanitizing=!1}copy(...e){const t=super.copy(...e);return t.dateFormat=this.dateFormat,t.timeSpan=this.timeSpan,t}afterChange(e,t,i){const r=super.afterChange(e,t,i),{timeSpan:n}=this;return this.isSanitizing||this.sanitize(),n&&(n.sanitizeRecurrenceData(this),this.isTimeSpanNotifyingSuspended||n.onRecurrenceChanged()),r}set(e,t,...i){const r=typeof e=="object"?e:{[e]:t};r.count?r.endDate=null:r.endDate&&(r.count=null),super.set(r,void 0,...i)}get isTimeSpanNotifyingSuspended(){return Boolean(this._suspendedTimeSpanNotifying)}suspendTimeSpanNotifying(){this._suspendedTimeSpanNotifying++}resumeTimeSpanNotifying(){this._suspendedTimeSpanNotifying&&this._suspendedTimeSpanNotifying--}}Xm._$name="RecurrenceModel";function RD(c){const e={},{dateFormat:t}=this;return c&&(c=typeof c=="string"?c.split(","):W.asArray(c),c.forEach(i=>{typeof i=="string"&&(i=b.parse(i,t)),isNaN(i)||(e[b.makeKey(i)]=1)})),e}function TD(c){const e=[],{dateFormat:t}=this;for(const i in c)c[i]&&e.push(b.format(b.parseKey(i),t));return e}const MD=[];var kD=c=>class extends(c||Ct){static get $name(){return"RecurringTimeSpan"}get supportsRecurring(){return!0}static get fields(){return[{name:"recurrenceRule",internal:!0},{name:"exceptionDates",convert:RD,serialize:TD,internal:!0}]}remove(){if(this.isOccurrence){const t=this,{recurringTimeSpan:i}=t;t.cancelBatch(),i.beginBatch(),t.detachFromRecurringEvent(),i.endBatch()}else return super.remove(...arguments)}get eventStore(){var t;let i=this.isOccurrence?this.recurringEvent.eventStore:super.eventStore;return!i&&(t=this.firstStore)!==null&&t!==void 0&&t.isRecurringTimeSpansMixin&&(i=this.firstStore),i}get recurrenceModel(){return this._recurrenceModel||Xm}set recurrenceModel(t){this._recurrenceModel=t}setRecurrence(t,i,r){const n=this;let s;t&&(t.isRecurrenceModel||(typeof t=="string"&&(t={frequency:t},i&&(t.interval=i),r&&(r instanceof Date?t.endDate=r:t.count=r)),t=new n.recurrenceModel(t)),t.timeSpan=n,s=t.rule),n.recurrence=t,n.recurrenceRule=s}get recurrence(){const t=this,i=t.recurrenceRule;return!t._recurrence&&i&&(t._recurrence=new t.recurrenceModel({rule:i,timeSpan:t,id:`${t.id}-recurrence`})),t._recurrence}set recurrence(t){const i=this;i._recurrence=t,t?(t.timeSpan=i,i.recurrenceRule=t.rule):i.isOccurrence?i.setData("recurrenceRule",null):i.recurrenceRule=null}get isRecurring(){return Boolean(!this.isOccurrence&&this.recurrence)}get isOccurrence(){return Boolean(this.recurringTimeSpan)}get recurringTimeSpan(){return this._recurringTimeSpan}get isPersistable(){return super.isPersistable&&(!this.supportsRecurring||!this.isOccurrence)}set recurringTimeSpan(t){this._recurringTimeSpan=t}getOccurrencesForDateRange(t,i=t){return this.eventStore.getOccurrencesForTimeSpan(this,t,i)}get occurrences(){if(this.isRecurring){const t=[];return this.occurrenceMap.forEach(i=>{i!==this&&t.push(i)}),t}return MD}get occurrenceMap(){return this._occurrencesMap||(this._occurrencesMap=new Map)}removeOccurrence(t){var i;const r=t.isTimeSpan?t.occurrenceDate:t;(i=this.eventStore)===null||i===void 0||i.globalOccurrences.delete(this.createRecurrenceKey(r)),this.occurrenceMap.delete(b.makeKey(r))}removeOccurrencesFrom(t){this.occurrenceMap.forEach((i,r)=>{b.parseKey(r)>=t&&this.removeOccurrence(i)})}removeOccurrences(){[this,...this.occurrences].forEach(t=>this.removeOccurrence(t))}onRecurrenceChanged(){var t;this.recurrenceRule=((t=this.recurrence)===null||t===void 0?void 0:t.rule)||null}sanitizeRecurrenceData(t=this.recurrence){if(t.endDate){const i=b.clearTime(t.endDate),{exceptionDates:r}=this;if(this.removeOccurrencesFrom(i),r)for(const n in r)b.parseKey(n)>=i&&delete r[n]}}get occurrenceDate(){var t;return((t=this.meta.modified)===null||t===void 0?void 0:t.startDate)||this.startDate}get occurrenceIndex(){return Ri.getOccurrenceIndex(this)}buildOccurrence(t,i){var r;const n=this,{occurrenceMap:s,recurrence:a,meta:o}=n,l=(r=n.eventStore)===null||r===void 0?void 0:r.globalOccurrences,d=b.makeKey(t),u=n.createRecurrenceKey(t,d),h=!(t-n.startDate),{fieldMap:f}=n.constructor;let g=l?.get(u),{duration:m}=n;n.endDate&&(n.allDay||!m)&&(m=b.as(n.durationUnit,n.endDate.getTime()-n.startDate.getTime()));const p=m!==void 0?b.add(t,m,n.durationUnit):void 0;return g||(i||h?(g=n,h||(n.setStartEndDate(t,p,!0),a.suspendTimeSpanNotifying(),a.sanitize(),a.resumeTimeSpanNotifying()),o.isSyncedWithRule=!0):(g=n.copy({[f.id.dataSource]:u,[f.startDate.dataSource]:t,[f.endDate.dataSource]:p,[f.duration.dataSource]:m,constraintDate:null,constraintType:null},{creatingOccurrence:!0}),g.recurringTimeSpan=n),l?.set(u,g),s.set(d,g)),g}createRecurrenceKey(t=this.startDate,i=null){return`_generated:${this.id}:${i||b.makeKey(t)}`}convertToRealEvent(t,i){var r;if(!this.isOccurrence)return;const n=this,{recurringTimeSpan:s,resource:a,occurrenceIndex:o,recurrence:l}=n,d=l&&s.recurrence.count,u=(t==null||(r=t.resourceRecords)===null||r===void 0?void 0:r.value)||n.data.newResource;s.beginBatch(),n.detachFromRecurringEvent(),n.clearChanges(),n.setData("id",n.generateId(s.eventStore)),u&&delete n.data.resourceId,s.eventStore.add(n,i),d&&(n.recurrence.count=d-o),(u||a)&&n.assign(u||a),u&&delete n.data.resourceRecords,t&&delete t.resourceRecords,s.endBatch()}afterChange(t,i,r,...n){const s=this,{eventStore:a}=s;return"recurrenceRule"in i&&(s._recurrence=null,a?.recurringEvents[i.recurrenceRule.value?"add":"delete"](s)),s.isOccurrence?s.convertToRealEvent(i,r):"newExceptionDate"in i&&(s.meta.modified.exceptionDates=!0,delete s.meta.modified.newExceptionDate,s.removeOccurrence(i.newExceptionDate.value)),super.afterChange(t,i,r,...n)}detachFromRecurringEvent(){const t=this,{recurringTimeSpan:i,occurrenceDate:r,startDate:n}=t;t.recurringTimeSpan=null,i.addExceptionDate(r),t.recurrenceRule&&(i.recurrence.endDate=b.add(n,-1,"minute"))}set newExceptionDate(t){if(t){const i=this.exceptionDates||(this.exceptionDates={});i[b.makeKey(t)]=1}}addExceptionDate(t){return this.set({newExceptionDate:t})}hasException(t){var i;return(i=this.exceptionDates)===null||i===void 0?void 0:i[b.makeKey(t)]}};const ID=1e3*60*60*24;var FD=c=>class extends c{static get $name(){return"EventModelMixin"}static get isEventModel(){return!0}static get fields(){return[{name:"resourceId",internal:!0},{name:"resources",column:{type:"resourceassignment"},persist:!1,internal:!0},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0,internal:!0},{name:"resizable",persist:!1,defaultValue:!0,internal:!0},{name:"allDay",type:"boolean",defaultValue:!1},{name:"eventStyle",internal:!0},{name:"eventColor",internal:!0},{name:"milestoneWidth",internal:!0},{name:"stickyContents",internal:!0}]}updateAssignmentEventIds(){this.assigned.forEach(t=>{t.eventId=this.id})}syncId(t){super.syncId(t),this.updateAssignmentEventIds()}get resources(){return this.assignments.reduce((t,{resource:i})=>(i&&t.push(i.$original),t),[])}set resources(t){t=W.asArray(t);const i=this,r=t.map(i.constructor.asId);if(i.usesSingleAssignment)i.set("resourceId",r[0]);else{const n=i.assignments.map(o=>o.resource.id),{onlyInA:s,onlyInB:a}=W.delta(r,n);i.assignmentStore.add(s.map(o=>({resource:o,event:i}))),i.assignmentStore.remove(a.map(o=>i.assignments.find(l=>l.resource.id===o)))}}forEachResource(t,i=this){for(const r of this.resources)if(t.call(i,r)===!1)return}getResource(t){return t==null?this.resource:this.resourceStore?this.resourceStore.getById(t):null}get startDate(){let t;if(this.isOccurrence)t=this.get("startDate");else{var i;t=(i=this._startDate)!==null&&i!==void 0?i:super.startDate}return this.allDay&&(t=this.constructor.getAllDayStartDate(t)),t}set startDate(t){this.batching?(this._startDate=t,this.set({startDate:t})):super.startDate=t}get endDate(){let t;if(this.isOccurrence)t=this.get("endDate");else{var i;t=(i=this._endDate)!==null&&i!==void 0?i:super.endDate}return this.allDay&&(t=this.constructor.getAllDayEndDate(t)),t}set endDate(t){this.batching?(this._endDate=t,this.set({endDate:t})):super.endDate=t}get wrapStartDate(){return this.startDate}set wrapStartDate(t){}get wrapEndDate(){return this.endDate}set wrapEndDate(t){}get isEvent(){return!0}get isDraggable(){return!this.readOnly&&this.draggable}get isResizable(){return!this.isMilestone&&(!this.isParent||this.manuallyScheduled)&&this.resizable}get isPersistable(){return super.isPersistable&&!this.isCreating}endBatch(){const{isPersistable:t,meta:{batchChanges:i}}=this;i&&("endDate"in i&&(delete this._endDate,this.postamble&&(this.wrapEndDate=null)),"startDate"in i&&(delete this._startDate,this.preamble&&(this.wrapStartDate=null))),super.endBatch(...arguments),this.isPersistable&&!t&&this.assignments.forEach(r=>{r.stores.forEach(n=>{n.updateModifiedBagForRecord(r)})})}get isCreating(){return super.isCreating}set isCreating(t){super.isCreating=t,this.assignments.forEach(i=>i.isCreating=t)}get usesSingleAssignment(){return!this.eventStore||this.eventStore.usesSingleAssignment}copy(...t){const i=super.copy(...t);return this.usesSingleAssignment||(i.resourceId=null),i}get persistableData(){const t=super.persistableData;return this.usesSingleAssignment||delete t.resourceId,t}get resource(){const{resources:t}=this;return t.length?t[0]:null}set resource(t){this.resourceId=this.constructor.asId(t)}get resourceId(){var t;return this.usesSingleAssignment?this.get("resourceId"):(t=this.resource)===null||t===void 0?void 0:t.id}set resourceId(t){this.applyResourceId(t)}get $linkedResources(){var t,i;return(t=(i=this.resources)===null||i===void 0?void 0:i.flatMap(r=>[r,...r.$links]))!==null&&t!==void 0?t:[]}applyResourceId(t,i=!1){const r=this,{assignments:n,assignmentStore:s,eventStore:a}=r;if(a)if(t!=null)if(r.meta.skipEnforcingSingleAssignment||(a.usesSingleAssignment=!0),n!=null&&n.length&&t!==n[0].resourceId){const o=Boolean(a.eventsSuspended);o&&s.suspendEvents(),n[0].resource=t,o&&s.resumeEvents()}else s.assignEventToResource(r,t);else s.remove(r.assignments);else i||r.set({resourceId:t})}applyValue(t,i,r,n,s){if(s&&s.name==="resourceId"&&!this.meta.isAssigning){const{eventStore:a}=this;a&&(a.isAssigning=!0),this.applyResourceId(r,!0),a&&(a.isAssigning=!1)}super.applyValue(t,i,r,n,s)}get assignments(){return[...this.assigned||[]]}assign(t,i=!1){const{eventStore:r}=this;r&&!r.usesSingleAssignment?r.assignEventToResource(this,t,i):(this.resourceId=this.constructor.asId(t),r||(this.meta.skipEnforcingSingleAssignment=!0))}unassign(t,i=!1){var r;const n=this;t=n.constructor.asId(t),n.meta.removingResource=i,(r=n.eventStore)===null||r===void 0||r.unassignEventFromResource(n,t),n.meta.removingResource=null}reassign(t,i){this.eventStore&&this.eventStore.reassignEventFromResourceToResource(this,t,i)}isAssignedTo(t){const i=this.constructor.asId(t);return this.assignments.some(r=>r.resourceId===i)}get predecessors(){var t;return[...(t=this.incomingDeps)!==null&&t!==void 0?t:[]]}get successors(){var t;return[...(t=this.outgoingDeps)!==null&&t!==void 0?t:[]]}get dependencies(){var t,i;return[...(t=this.incomingDeps)!==null&&t!==void 0?t:[],...(i=this.outgoingDeps)!==null&&i!==void 0?i:[]]}normalize(){}inSetNormalize(){}get recurringEvent(){return this.recurringTimeSpan}get isInterDay(){const{durationMS:t}=this;if(t>=ID||!t&&this.allDay)return!0;const{endDate:i,startDate:r}=this,n=b.clearTime(r);if(r&&i)return n.setDate(n.getDate()+1),(i||b.add(r,t))>n}static getAllDayStartDate(t){return t&&t.isEvent&&(t=t.get("startDate")),t&&(t=b.clearTime(t,!0)),t}static getAllDayEndDate(t){return t&&t.isEvent&&(t=t.get("endDate")),t&&(t.getHours()>0||t.getMinutes()>0||t.getSeconds()>0||t.getMilliseconds()>0)&&(t=b.getNext(t,"d",1)),t}static getAllDayDisplayStartDate(t){return t&&t.isEvent&&(t=t.get("startDate")),b.clearTime(t,!0)}static getAllDayDisplayEndDate(t,i){return t&&t.isEvent&&(i=t.get("endDate"),t=t.get("startDate")),i&&(t=this.constructor.getAllDayDisplayStartDate(t),b.clearTime(i,!0).valueOf()===i.valueOf()?i=b.add(i,b.DAY,-1):t.valueOf()!==i.valueOf()&&(i=b.clearTime(i,!0))),i}isEditable(t){switch(t){case"endDate":case"duration":case"fullDuration":return this.isLeaf}return super.isEditable(t)}};const AD=Td;class lo extends AD.derive(Ct).mixin(kD,xi,FD){static get $name(){return"EventModel"}}lo.exposeProperties();lo._$name="EventModel";const LD=xi(Om.derive($t));class ds extends LD.mixin(vD,bD,hD,pD,mD){static get defaultConfig(){return{modelClass:lo}}}M(ds,"$name","EventStore");ds._$name="EventStore";const OD=["SS","SF","FS","FF"];class ot extends de{static get $name(){return"DependencyBaseModel"}static get Type(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}static get fields(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"},{name:"highlighted",persist:!1,internal:!0}]}construct(e){const t=e[this.fieldMap.from.dataSource],i=e[this.fieldMap.to.dataSource];t!=null&&(e.fromEvent=t),i!=null&&(e.toEvent=i),super.construct(...arguments)}get eventStore(){var e;return this.eventStore||((e=this.unjoinedStores[0])===null||e===void 0?void 0:e.eventStore)}set from(e){const{fromEvent:t}=this;t!=null&&t.isModel&&t.id===e?this.set("from",e):this.fromEvent=e}get from(){return this.get("from")}set to(e){const{toEvent:t}=this;t!=null&&t.isModel&&t.id===e?this.set("to",e):this.toEvent=e}get to(){return this.get("to")}get hardType(){return this.getHardType()}set hardType(e){this.setHardType(e)}getHardType(){return this.get("type")}setHardType(e){let t;return e!==this.hardType&&(t=this.set({type:e,fromSide:null,toSide:null})),t}get lag(){return this.get("lag")}set lag(e){this.setLag(e)}setLag(e,t=this.lagUnit){if(arguments.length===1){typeof e=="number"?this.lag=e:(e=b.parseDuration(e),this.set({lag:e.magnitude,lagUnit:e.unit}));return}e=parseFloat(e),this.set({lag:e,lagUnit:t})}getLag(){return this.lag?`${this.lag<0?"-":"+"}${Math.abs(this.lag)}${b.getShortNameOfUnit(this.lagUnit)}`:""}get fullLag(){return new Ue({unit:this.lagUnit,magnitude:this.lag})}set fullLag(e){typeof e=="string"?this.setLag(e):this.setLag(e.magnitude,e.unit)}get isPersistable(){const e=this,{stores:t,unjoinedStores:i}=e,r=t[0];let n;if(r){const{fromEvent:s,toEvent:a}=e,o=r.crudManager;n=s&&(o||!s.hasGeneratedId)&&a&&(o||!a.hasGeneratedId)}else n=Boolean(i[0]);return n&&super.isPersistable}getDateRange(){const{fromEvent:e,toEvent:t}=this;if(e!=null&&e.isScheduled&&t!==null&&t!==void 0&&t.isScheduled){const i=ot.Type;let r,n;switch(this.type){case i.StartToStart:r=e.startDateMS,n=t.startDateMS;break;case i.StartToEnd:r=e.startDateMS,n=t.endDateMS;break;case i.EndToEnd:r=e.endDateMS,n=t.endDateMS;break;case i.EndToStart:r=e.endDateMS,n=t.startDateMS;break;default:throw new Error("Invalid dependency type: "+this.type)}return{start:Math.min(r,n),end:Math.max(r,n)}}return null}highlight(e){var t,i;const r=(t=(i=this.highlighted)===null||i===void 0?void 0:i.split(" "))!==null&&t!==void 0?t:[];r.includes(e)||(this.highlighted=r.concat(e).join(" "))}unhighlight(e){const{highlighted:t}=this;if(t){const i=t.split(" "),r=i.indexOf(e);r>=0&&(i.splice(r,1),this.highlighted=i.join(" "))}}isHighlightedWith(e){return this.highlighted&&this.highlighted.split(" ").includes(e)}getConnectorString(e){const t=OD[this.type];return e?t:this.type===ot.Type.EndToStart?"":t}toString(){return`${this.from}${this.getConnectorString()}${this.getLag()}`}get isValid(){const{fromEvent:e,toEvent:t,type:i}=this;return typeof i=="number"&&e&&t&&e!==t}get fromEventName(){var e;return((e=this.fromEvent)===null||e===void 0?void 0:e.name)||""}get toEventName(){var e;return((e=this.toEvent)===null||e===void 0?void 0:e.name)||""}shouldRecordFieldChange(e,t,i){if(!super.shouldRecordFieldChange(e,t,i))return!1;if(e==="from"||e==="to"||e==="fromEvent"||e==="toEvent"){var r;const n=(r=this.project)===null||r===void 0?void 0:r.eventStore;if(n&&n.oldIdMap[t]===n.getById(i))return!1}return!0}}ot.exposeProperties();ot._$name="DependencyBaseModel";const PD=Rd;class at extends xi(PD.derive(ot)){static get $name(){return"DependencyModel"}getTypeFromSides(e,t,i){const r=ot.Type,n=i?"right":"left",s=i?"left":"right";return e===n?t===n?r.StartToStart:r.StartToEnd:t===s?r.EndToEnd:r.EndToStart}}at.exposeProperties();at._$name="DependencyModel";var $D=c=>class extends c{static get $name(){return"DependencyStoreMixin"}static get defaultConfig(){return{loadPriority:400,syncPriority:400,storeId:"dependencies"}}reduceEventDependencies(t,i,r,n=!0,s){return s=s||(a=>this.getEventDependencies(a)),t=W.asArray(t),t.reduce((a,o)=>{o.children&&!n?o.traverse(l=>{a=s(l).reduce(i,a)}):a=s(o).reduce(i,a)},r),r}mapEventDependencies(t,i,r,n,s){return this.reduceEventDependencies(t,(a,o)=>(r(o)&&a.push(o),a),[],n,s)}mapEventPredecessors(t,i,r,n){return this.reduceEventPredecessors(t,(s,a)=>(r(a)&&s.push(a),s),[],n)}mapEventSuccessors(t,i,r,n){return this.reduceEventSuccessors(t,(s,a)=>(r(a)&&s.push(a),s),[],n)}getEventDependencies(t){return[].concat(t.predecessors||[],t.successors||[])}removeEventDependencies(t){this.remove(this.getEventDependencies(t))}removeEventPredecessors(t){this.remove(t.predecessors)}removeEventSuccessors(t,i){this.remove(t.successors)}getBySourceTargetId(t){return this.records.find(i=>t==this.constructor.makeDependencySourceTargetCompositeKey(i.from,i.to))}getDependencyForSourceAndTargetEvents(t,i){return t=de.asId(t),i=de.asId(i),this.getBySourceTargetId(this.constructor.makeDependencySourceTargetCompositeKey(t,i))}getEventsLinkingDependency(t,i){return this.getDependencyForSourceAndTargetEvents(t,i)||this.getDependencyForSourceAndTargetEvents(i,t)}async isValidDependency(t,i,r){let n=t,s=i;return t==null?!1:(t.isDependencyModel&&({fromEvent:n,toEvent:s}=t),n=this.eventStore.getById(n),s=this.eventStore.getById(s),n&&s?!n.project||!s.project?!1:this.project.isValidDependency(n,s,r):t!==i)}isValidDependencyToCreate(t,i,r){return this.isValidDependency(t,i,r)}getHighlightedDependencies(t){return this.records.reduce((i,r)=>(r.isHighlightedWith(t)&&i.push(r),i),[])}static makeDependencySourceTargetCompositeKey(t,i){return`source(${t})-target(${i})`}getTimeSpanDependencies(t){return this.getEventDependencies(t)}};const _D=xi(Lm.derive($t));class $d extends $D(_D.derive($t)){static get defaultConfig(){return{modelClass:at}}}$d._$name="DependencyStore";var HD=c=>class extends(c||P).mixin(Vm,Wm,Ym){static get defaultConfig(){return{project:null}}startConfigure(t){this.getConfig("project"),super.startConfigure(t),this._changesToClear=new Map}async doAutoLoad(){const{project:t}=this;return t&&await t.commitAsync(),super.doAutoLoad()}applyProjectResponse(t){const i=this,{project:r}=i;i.applyingProjectResponse=!0;const n=r.fieldMap.startDate,s=r.fieldMap.endDate,a=T.getPath(t,n.dataSource),o=T.getPath(t,s.dataSource);typeof a=="string"&&T.setPath(t,n.dataSource,n.convert(a)),typeof o=="string"&&T.setPath(t,s.dataSource,s.convert(o)),Object.assign(r,t),i._changesToClear.set(i,t),i.applyingProjectResponse=!1}loadCrudManagerData(t,i={}){const r=this,{project:n}=r;r.suspendChangesTracking(),super.loadCrudManagerData(...arguments),t!=null&&t.project&&(n.delayEnteringReplica?n.ion({recordsUnlinked:()=>{r.suspendChangesTracking(),r.applyProjectResponse(t.project),r.resumeChangesTracking()},once:!0}):r.applyProjectResponse(t.project)),r.resumeChangesTracking()}async sync(){const{project:t}=this;if(this.suspendAutoSync(),t&&await t.commitAsync(),!this.isDestroying)return this.resumeAutoSync(!1),super.sync()}async applyResponse(t,i,r){var n,s;const a=this;if(!(a.isDestroyed||(n=a.project)!==null&&n!==void 0&&n.isDestroyed)){if(a.trigger("startApplyResponse"),await super.applyResponse(t,i,r),i!=null&&i.project||a.supportShortSyncResponse&&t!==null&&t!==void 0&&(s=t.pack)!==null&&s!==void 0&&s.project){var o;a.applyProjectResponse(i.project||(t==null||(o=t.pack)===null||o===void 0?void 0:o.project))}if(a.project){var l,d;let u=t.type;a.trackResponseType&&(u=i.type||u);const h=`propagating${z.capitalize(u)}Changes`;a.suspendAutoSync(),a[h]=!0;const f=a.project.isInitialCommit&&!a.project.silenceInitialCommit;await a.project.commitAsync(),a[h]=!1,(l=a.resumeAutoSync)===null||l===void 0||l.call(a,f),(d=a.commitRespondedChanges)===null||d===void 0||d.call(a)}}}applySyncResponse(...t){var i;const r=this,n=(i=r.project)===null||i===void 0?void 0:i.stm.disabled;n===!1&&r.ignoreRemoteChangesInSTM&&r.project.stm.disable(),super.applySyncResponse(...t),n===!1&&r.project.stm.enable()}shouldClearRecordFieldChange(t,i,r){var n;const s=t[i];return i=t.getFieldDefinition(i),(n=i)!==null&&n!==void 0&&n.isEqual?i.isEqual(s,r):T.isEqual(s,r)}commitRespondedChanges(){this._changesToClear.forEach((t,i)=>{Object.entries(t).forEach(([r,n])=>{this.shouldClearRecordFieldChange(i,r,n)&&delete i.meta.modified[r]})}),this._changesToClear.clear()}applyChangesToStore(t,i,r,...n){const s=super.applyChangesToStore(t,i,r,...n);if(s.size&&this.project)for(const[a,o]of s){const l=t.store.getById(a);l&&this._changesToClear.set(l,o)}return s}},ND=c=>{var e;return e=class extends(c||de){static get configurable(){return{assignments:null,dependencies:null,resources:null,timeRanges:null}}get assignments(){return this.assignmentStore.records}updateAssignments(i){this.assignmentStore.data=i}get dependencies(){return this.dependencyStore.records}updateDependencies(i){this.dependencyStore.data=i}get resources(){return this.resourceStore.records}updateResources(i){this.resourceStore.data=i}get timeRanges(){return this.timeRangeStore.records}getTimeRanges(i,r){const n=this.timeRangeStore,s=[];for(const a of n)a.isRecurring?s.push(...a.getOccurrencesForDateRange(i,r)):a.startDate<r&&i<a.endDate&&s.push(a);return s}updateTimeRanges(i){this.timeRangeStore.data=i}getResourceTimeRanges(i,r){const n=this.resourceTimeRangeStore,s=[];for(const a of n)a.isRecurring?s.push(...a.getOccurrencesForDateRange(i,r)):a.startDate<r&&i<a.endDate&&s.push(a);return s}},M(e,"$name","ProjectModelCommon"),e};class Ti extends Ct{get domId(){return`${this.constructor.domIdPrefix}-${this.id}`}get isResourceTimeRange(){return!0}get resources(){return this.resource?[this.resource]:[]}get $linkedResources(){return this.resources}}M(Ti,"$name","ResourceTimeRangeModel");M(Ti,"fields",["resourceId","timeRangeColor"]);M(Ti,"relations",{resource:{foreignKey:"resourceId",foreignStore:"resourceStore",relatedCollectionName:"timeRanges",nullFieldOnRemove:!0}});M(Ti,"domIdPrefix","resourcetimerange");Ti._$name="ResourceTimeRangeModel";class co extends $t{static get defaultConfig(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:Ti,storeId:"resourceTimeRanges"}}set resourceStore(e){this._resourceStore=e,this.isConfiguring||this.initRelations(!0)}get resourceStore(){return this._resourceStore}getResourcesForEvent(e){return[e.resource]}getRanges({resourceRecord:e,startDate:t,endDate:i}){return e.timeRanges.flatMap(n=>n.supportsRecurring?n.getOccurrencesForDateRange(t,i):n.intersectsRange(t,i)?n:[]).sort((n,s)=>n.startDate-s.startDate)}}M(co,"$name","ResourceTimeRangeStore");co._$name="ResourceTimeRangeStore";var BD=c=>{var e;return e=class extends(c||de){afterConstruct(){super.afterConstruct(...arguments),this._storesWithDates=[this.taskStore,this.timeRangeStore,this.resourceTimeRangeStore]}relayStoreChange({source:i,action:r,records:n,replaced:s}){const a=this;if(a.timeZone&&a._storesWithDates.includes(i)){if(r==="dataset")a.convertStoresToTimeZone([i]),a.ignoreRecordChanges=!0,a.commitAsync();else if(["add","replace"].includes(r)){var o;!((o=n)!==null&&o!==void 0&&o.length)&&s!==null&&s!==void 0&&s.length&&(n=s),n.length&&n.forEach(l=>l._inTimeZone=a.timeZone)}}}convertStoresToTimeZone(i){var r;const n=this,{timeZone:s}=n,a=(r=n.stm)===null||r===void 0?void 0:r.autoRecord;a&&(n.stm.autoRecord=!1);for(const o of i)o&&o.forEach(l=>{var d;if(l.$ignoreChange=!0,(d=l.baselines)!==null&&d!==void 0&&d.count)for(const u of l.baselines)l._inTimeZone!==u._inTimeZone&&(u._inTimeZone=l._inTimeZone),u.convertToTimeZone(s);l.convertToTimeZone(s),delete l.$ignoreChange});a&&(n.stmAutoRecord=a)}updateTimeZone(i,r){const n=this,s=n._isConfiguringTimeZone||n.isConfiguring;if(n.calendarManagerStore.forEach(a=>a.bumpVersion()),n.convertStoresToTimeZone(n._storesWithDates),n.startDate){const a=r?Xe.fromTimeZone(n.startDate,r):n.startDate;n.startDate=i?Xe.toTimeZone(a,i):a}n.ignoreRecordChanges=!0,n.commitAsync().then(()=>{n.isDestroyed||n.trigger("timeZoneChange",{timeZone:i,oldTimeZone:r,isConfiguring:s}),delete n._isConfiguringTimeZone})}},M(e,"$name","ProjectModelTimeZoneMixin"),M(e,"configurable",{timeZone:{$config:"lazy",value:null}}),e},zD=c=>{var e;return e=class extends(c||de).mixin(ND,BD){static get $name(){return"ProjectModelMixin"}static get defaultConfig(){return{stm:{},timeRangeModelClass:Ct,resourceTimeRangeModelClass:Ti,timeRangeStoreClass:se,resourceTimeRangeStoreClass:co,eventStore:{},assignmentStore:{},dependencyStore:{},resourceStore:{},timeRangesData:null}}get inlineData(){return z.safeJsonParse(super.json)}set inlineData(i){this.json=i}construct(i={}){super.construct(...arguments),i.timeRangesData&&(this.timeRangeStore.data=i.timeRangesData),i.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=i.resourceTimeRangesData)}afterConstruct(){super.afterConstruct();const i=this;!i.timeRangeStore.stm&&i.stm.addStore(i.timeRangeStore),!i.resourceTimeRangeStore.stm&&i.stm.addStore(i.resourceTimeRangeStore)}attachStore(i){i?.ion({name:i.$$name,change:"relayStoreChange",thisObj:this})}detachStore(i){i&&this.detachListeners(i.$$name)}relayStoreChange(i){return super.relayStoreChange(i),this.trigger("change",F(F({store:i.source},i),{},{source:this}))}updateTimeRangeStore(i,r){this.detachStore(r),this.attachStore(i)}setTimeRangeStore(i){this.timeRangeStore=i}changeTimeRangeStore(i){return i&&!i.isStore&&(i=this.timeRangeStoreClass.new({modelClass:this.timeRangeModelClass},i)),i}updateResourceTimeRangeStore(i,r){this.detachStore(r),this.attachStore(i)}changeResourceTimeRangeStore(i){return i&&!i.isStore&&(i=this.resourceTimeRangeStoreClass.new({modelClass:this.resourceTimeRangeModelClass},i)),i}setResourceTimeRangeStore(i){this.resourceTimeRangeStore=i}get events(){return this.eventStore.records}updateEvents(i){this.eventStore.data=i}get resourceTimeRanges(){return this.resourceTimeRangeStore.records}updateResourceTimeRanges(i){this.resourceTimeRangeStore.data=i}async loadInlineData(i){return this.isLoadingInlineData=!0,i.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=i.resourceTimeRangesData),i.timeRangesData&&(this.timeRangeStore.data=i.timeRangesData),super.loadInlineData(i)}toJSON(){const i=this,r={eventsData:i.eventStore.toJSON(),resourcesData:i.resourceStore.toJSON(),dependenciesData:i.dependencyStore.toJSON(),timeRangesData:i.timeRangeStore.toJSON(),resourceTimeRangesData:i.resourceTimeRangeStore.toJSON()};return i.eventStore.usesSingleAssignment||(r.assignmentsData=i.assignmentStore.toJSON()),r}get json(){return super.json}changeJson(i){return typeof i=="string"&&(i=z.safeJsonParse(i)),i}updateJson(i){i&&this.loadInlineData(i)}afterChange(i,r){super.afterChange(...arguments),r.calendar&&this.trigger("calendarChange")}doDestroy(){this.timeRangeStore.destroy(),this.resourceTimeRangeStore.destroy(),super.doDestroy()}},M(e,"configurable",{json:null,timeRangeStore:{value:{id:"timeRanges",modelClass:Ct},$config:"nullify"},resourceTimeRangeStore:{value:{},$config:"nullify"},events:null,resourceTimeRanges:null}),e},VD=c=>class extends c{getCurrentConfig(t){const i=this,r=super.getCurrentConfig(t);if(r){for(const n of["eventStore","resourceStore","assignmentStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"]){const s=i[n];if(s){s.count&&(r[s.id+"Data"]=s.getInlineData(t));const a=s.getCurrentConfig(t);a&&Object.keys(a).length>0?r[n]=Object.assign(r[n]||{},a):r[n]&&Object.keys(r[n]).length===0&&delete r[n]}}return r.timeRangeStore&&((i.timeRangeStore.originalModelClass===i.timeRangeModelClass||i.timeRangeStore.originalModelClass.$name==="TimeSpan")&&delete r.timeRangeStore.modelClass,r.timeRangeStore.storeId==="timeRanges"&&delete r.timeRangeStore.storeId,Object.keys(r.timeRangeStore).length===1&&delete r.timeRangeStore),i.taskStore.isTaskStore&&(delete r.eventModelClass,delete r.eventStoreClass,delete r.children),r}}};class Zm extends P{set eventStore(e){const t=this;t.eventStoreDetacher&&t.eventStoreDetacher(),t._eventStore=e,e&&e.autoCommit&&(t.eventStoreDetacher=e.ion({beforecommit:t.onEventStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get eventStore(){return this._eventStore}set resourceStore(e){const t=this;t.resourceStoreDetacher&&t.resourceStoreDetacher(),t._resourceStore=e,e&&e.autoCommit&&(t.resourceStoreDetacher=e.ion({beforecommit:t.onResourceStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get resourceStore(){return this._resourceStore}set assignmentStore(e){const t=this;t.assignmentStoreDetacher&&t.assignmentStoreDetacher(),t._assignmentStore=e,e&&e.autoSync&&(t.assignmentStoreDetacher=e.ion({beforecommit:t.onAssignmentStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get assignmentStore(){return this._assignmentStore}set dependencyStore(e){const t=this;t.dependencyStoreDetacher&&t.dependencyStoreDetacher(),t._dependencyStore=e,e&&e.autoSync&&(t.dependencyStoreDetacher=e.ion({beforecommit:t.onDependencyStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get dependencyStore(){return this._dependencyStore}onEventStoreBeforeSync({changes:e}){const t=this;return t.removeNonPersistableRecordsToCreate(e),t.shallContinueSync(e)}onResourceStoreBeforeSync({changes:e}){const t=this;return t.removeNonPersistableRecordsToCreate(e),t.shallContinueSync(e)}onAssignmentStoreBeforeSync({changes:e}){const t=this;return t.removeNonPersistableRecordsToCreate(e),t.shallContinueSync(e)}onDependencyStoreBeforeSync({changes:e}){const t=this;return t.removeNonPersistableRecordsToCreate(e),t.shallContinueSync(e)}removeNonPersistableRecordsToCreate(e){const t=e.added||[];let i,r;for(r=t.length-1;r>=0;--r)i=t[r],i.isPersistable||t.splice(t.indexOf(i),1);t.length===0&&(e.added.length=0)}shallContinueSync(e){return Boolean(e.added&&e.added.length>0||e.modified&&e.modified.length>0||e.removed&&e.removed.length>0)}}Zm._$name="ModelPersistencyManager";const jD=ZS;class ir extends VD(zD(jD)){static get $name(){return"ProjectModel"}static get defaultConfig(){return{eventModelClass:lo,dependencyModelClass:at,resourceModelClass:ls,assignmentModelClass:ao,eventStoreClass:ds,dependencyStoreClass:$d,resourceStoreClass:oo,assignmentStoreClass:os}}construct(...e){super.construct(...e),ae.isTestEnv&&(globalThis.bryntum.testProject=this),this.modelPersistencyManager=this.createModelPersistencyManager()}createModelPersistencyManager(){return new Zm({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}doDestroy(){this.modelPersistencyManager.destroy(),super.doDestroy()}get taskStore(){return this.eventStore}}ir.applyConfigs=!0;ir.initClass();ir._$name="ProjectModel";class Fr extends jm.mixin(HD,Wm,Ym){static get defaultConfig(){return{projectClass:ir,resourceStoreClass:oo,eventStoreClass:ds,assignmentStoreClass:os,dependencyStoreClass:$d,resourceStore:{},eventStore:{},assignmentStore:{},dependencyStore:{},project:null}}buildProject(){return new this.projectClass(this.buildProjectConfig())}buildProjectConfig(){return T.cleanupProperties({eventStore:this.eventStore,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore,resourceTimeRangeStore:this.resourceTimeRangeStore})}set project(e){const t=this;e!==t._project&&(t.detachListeners("beforeDataReady"),t.detachListeners("afterDataReady"),t._project=e,e&&(t.eventStore=e.eventStore,t.resourceStore=e.resourceStore,t.assignmentStore=e.assignmentStore,t.dependencyStore=e.dependencyStore,t.timeRangeStore=e.timeRangeStore,t.resourceTimeRangeStore=e.resourceTimeRangeStore,e.ion({name:"beforeDataReady",dataReady:()=>t.suspendChangesTracking(),prio:100,thisObj:t}),e.ion({name:"afterDataReady",dataReady:()=>t.resumeChangesTracking(),prio:-100,thisObj:t})),t.eventStore||(t.eventStore={}),t.resourceStore||(t.resourceStore={}),t.assignmentStore||(t.assignmentStore={}),t.dependencyStore||(t.dependencyStore={}))}get project(){return this._project}get timeRangeStore(){var e;return(e=this._timeRangeStore)===null||e===void 0?void 0:e.store}set timeRangeStore(e){var t;this.setFeaturedStore("_timeRangeStore",e,(t=this.project)===null||t===void 0?void 0:t.timeRangeStoreClass)}get resourceTimeRangeStore(){var e;return(e=this._resourceTimeRangeStore)===null||e===void 0?void 0:e.store}set resourceTimeRangeStore(e){var t;this.setFeaturedStore("_resourceTimeRangeStore",e,(t=this.project)===null||t===void 0?void 0:t.resourceTimeRangeStoreClass)}get resourceStore(){var e;return(e=this._resourceStore)===null||e===void 0?void 0:e.store}set resourceStore(e){const t=this;t.setFeaturedStore("_resourceStore",e,t.resourceStoreClass)}get eventStore(){var e;return(e=this._eventStore)===null||e===void 0?void 0:e.store}set eventStore(e){const t=this;t.setFeaturedStore("_eventStore",e,t.eventStoreClass)}get assignmentStore(){var e;return(e=this._assignmentStore)===null||e===void 0?void 0:e.store}set assignmentStore(e){this.setFeaturedStore("_assignmentStore",e,this.assignmentStoreClass)}get dependencyStore(){var e;return(e=this._dependencyStore)===null||e===void 0?void 0:e.store}set dependencyStore(e){this.setFeaturedStore("_dependencyStore",e,this.dependencyStoreClass)}setFeaturedStore(e,t,i){var r;const n=this,s=(r=n[e])===null||r===void 0?void 0:r.store;if(s!==t){var a;t=se.getStore(t,((a=t)===null||a===void 0?void 0:a.storeClass)||i),s&&n.removeStore(s),n[e]=t&&{store:t}||null,n.addPrioritizedStore(n[e])}return n[e]}getChangesetPackage(){const e=super.getChangesetPackage();return e&&this.eventStore.usesSingleAssignment&&(delete e[this.assignmentStore.storeId],!this.crudStores.some(t=>e[t.storeId]))?null:e}get crudLoadValidationMandatoryStores(){return[this._eventStore.storeId,this._resourceStore.storeId]}}M(Fr,"$name","CrudManager");Fr._$name="CrudManager";class Ui extends de{static get fields(){return[{name:"base",type:"string"},{name:"name",type:"string"},{name:"rowHeight",defaultValue:24},{name:"tickWidth",defaultValue:50},{name:"tickHeight",defaultValue:50},{name:"displayDateFormat",defaultValue:"HH:mm"},{name:"shiftUnit",defaultValue:"hour"},{name:"shiftIncrement",defaultValue:1},{name:"defaultSpan",defaultValue:12},{name:"mainUnit"},{name:"start"},"timeResolution","headers","mainHeaderLevel","columnLinesFor"]}construct(){super.construct(...arguments),this.normalizeUnits()}generateId(e){const t=this,{headers:i}=t,r=[];let n=Object.getPrototypeOf(t.data).id;if(!n){for(let{length:s}=i,a=s-1;a>=0;a--){const{unit:o,increment:l}=i[a],d=l>1;r.push(`${d?l:""}${a?o:z.capitalize(o)}${d?"s":""}`)}n=r.join("And")}return e.count&&e.includes(n)&&(n+=`-${t.tickWidth}by${t.tickHeight||t.tickWidth}`,e.includes(n)&&(n+=`-${t.bottomHeader.increment}`,e.includes(n)&&(n=Or.generateId(`${n}-`)))),n}normalizeUnits(){const e=this,{timeResolution:t,headers:i,shiftUnit:r}=e;if(i)for(let n=0,{length:s}=i;n<s;n++){const a=i[n];a.unit=b.normalizeUnit(a.unit),a.splitUnit&&(a.splitUnit=b.normalizeUnit(a.splitUnit)),"increment"in a||(i[n]=Object.assign({increment:1},a))}t&&(t.unit=b.normalizeUnit(t.unit)),r&&(e.shiftUnit=b.normalizeUnit(r))}static normalizeHeaderConfig(e){const{headerConfig:t,columnLinesFor:i,mainHeaderLevel:r}=e,n=e.headers=[];if(t.top&&(i==="top"&&(e.columnLinesFor=0),r==="top"&&(e.mainHeaderLevel=0),n[0]=t.top),t.middle)i==="middle"&&(e.columnLinesFor=n.length),r==="middle"&&(e.mainHeaderLevel=n.length),n.push(t.middle);else throw new Error("ViewPreset.headerConfig must be configured with a middle");t.bottom&&(e.mainHeaderLevel=n.length-1,i==null?e.columnLinesFor=n.length-1:i==="bottom"&&(e.columnLinesFor=n.length),r==null&&(e.mainHeaderLevel=n.length-1),r==="bottom"&&(e.mainHeaderLevel=n.length),n.push(t.bottom))}set(){}inSet(){}get columnLinesFor(){return"columnLinesFor"in this.data?this.data.columnLinesFor:this.headers.length-1}get tickSize(){return this._tickSize||this.tickWidth}get tickWidth(){return"tickWidth"in this.data?this.data.tickWidth:50}get tickHeight(){return"tickHeight"in this.data?this.data.tickHeight:50}get headerConfig(){if(this.data.headerConfig)return this.data.headerConfig;const e={},{headers:t}=this,{length:i}=t;switch(i){case 1:e.middle=t[0];break;case 2:this.mainHeaderLevel===0?(e.middle=t[0],e.bottom=t[1]):(e.top=t[0],e.middle=t[1]);break;case 3:e.top=t[0],e.middle=t[1],e.bottom=t[2];break;default:throw new Error("headerConfig object not supported for >3 header levels")}return e}set mainHeaderLevel(e){this.data.mainHeaderLevel=e}get mainHeaderLevel(){return"mainHeaderLevel"in this.data?this.data.mainHeaderLevel:this.data.headers.length===3?1:this.headers.length-1}get mainHeader(){return this.headers[this.mainHeaderLevel]}get bottomHeader(){return this.headers[this.headers.length-1]}get leafUnit(){return this.bottomHeader.unit}get leafIncrement(){return this.bottomHeader.increment}get mainUnit(){return"mainUnit"in this.data?this.data.mainUnit:this.mainHeader.unit}get msPerPixel(){const{bottomHeader:e}=this;return Math.round(b.asMilliseconds(e.increment||1,e.unit)/this.tickWidth)}get isValid(){const e=this;let t=!0;for(const i of e.headers)t=t&&Boolean(b.normalizeUnit(i.unit));return e.timeResolution&&(t=t&&b.normalizeUnit(e.timeResolution.unit)),e.shiftUnit&&(t=t&&b.normalizeUnit(e.shiftUnit)),t}}M(Ui,"$name","ViewPreset");Ui._$name="ViewPreset";const WD={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",Object:{newEvent:"New event"},ResourceInfoColumn:{eventCountText:c=>c+" event"+(c!==1?"s":"")},Dependencies:{from:"From",to:"To",valid:"Valid",invalid:"Invalid"},DependencyType:{SS:"SS",SF:"SF",FS:"FS",FF:"FF",StartToStart:"Start-to-Start",StartToEnd:"Start-to-Finish",EndToStart:"Finish-to-Start",EndToEnd:"Finish-to-Finish",short:["SS","SF","FS","FF"],long:["Start-to-Start","Start-to-Finish","Finish-to-Start","Finish-to-Finish"]},DependencyEdit:{From:"From",To:"To",Type:"Type",Lag:"Lag","Edit dependency":"Edit dependency",Save:"Save",Delete:"Delete",Cancel:"Cancel",StartToStart:"Start to Start",StartToEnd:"Start to End",EndToStart:"End to Start",EndToEnd:"End to End"},EventEdit:{Name:"Name",Resource:"Resource",Start:"Start",End:"End",Save:"Save",Delete:"Delete",Cancel:"Cancel","Edit event":"Edit event",Repeat:"Repeat"},EventDrag:{eventOverlapsExisting:"Event overlaps existing event for this resource",noDropOutsideTimeline:"Event may not be dropped completely outside the timeline"},SchedulerBase:{"Add event":"Add event","Delete event":"Delete event","Unassign event":"Unassign event"},TimeAxisHeaderMenu:{pickZoomLevel:"Zoom",activeDateRange:"Date range",startText:"Start date",endText:"End date",todayText:"Today"},EventCopyPaste:{copyEvent:"Copy event",cutEvent:"Cut event",pasteEvent:"Paste event"},EventFilter:{filterEvents:"Filter tasks",byName:"By name"},TimeRanges:{showCurrentTimeLine:"Show current timeline"},PresetManager:{secondAndMinute:{displayDateFormat:"ll LTS",name:"Seconds"},minuteAndHour:{topDateFormat:"ddd MM/DD, hA",displayDateFormat:"ll LST"},hourAndDay:{topDateFormat:"ddd MM/DD",middleDateFormat:"LST",displayDateFormat:"ll LST",name:"Day"},day:{name:"Day/hours"},week:{name:"Week/hours"},dayAndWeek:{displayDateFormat:"ll LST",name:"Week/days"},dayAndMonth:{name:"Month"},weekAndDay:{displayDateFormat:"ll LST",name:"Week"},weekAndMonth:{name:"Weeks"},weekAndDayLetter:{name:"Weeks/weekdays"},weekDateAndMonth:{name:"Months/weeks"},monthAndYear:{name:"Months"},year:{name:"Years"},manyYears:{name:"Multiple years"}},RecurrenceConfirmationPopup:{"delete-title":"You are deleting an event","delete-all-message":"Do you want to delete all occurrences of this event?","delete-further-message":"Do you want to delete this and all future occurrences of this event, or only the selected occurrence?","delete-further-btn-text":"Delete All Future Events","delete-only-this-btn-text":"Delete Only This Event","update-title":"You are changing a repeating event","update-all-message":"Do you want to change all occurrences of this event?","update-further-message":"Do you want to change only this occurrence of the event, or this and all future occurrences?","update-further-btn-text":"All Future Events","update-only-this-btn-text":"Only This Event",Yes:"Yes",Cancel:"Cancel",width:600},RecurrenceLegend:{" and ":" and ",Daily:"Daily","Weekly on {1}":({days:c})=>`Weekly on ${c}`,"Monthly on {1}":({days:c})=>`Monthly on ${c}`,"Yearly on {1} of {2}":({days:c,months:e})=>`Yearly on ${c} of ${e}`,"Every {0} days":({interval:c})=>`Every ${c} days`,"Every {0} weeks on {1}":({interval:c,days:e})=>`Every ${c} weeks on ${e}`,"Every {0} months on {1}":({interval:c,days:e})=>`Every ${c} months on ${e}`,"Every {0} years on {1} of {2}":({interval:c,days:e,months:t})=>`Every ${c} years on ${e} of ${t}`,position1:"the first",position2:"the second",position3:"the third",position4:"the fourth",position5:"the fifth","position-1":"the last",day:"day",weekday:"weekday","weekend day":"weekend day",daysFormat:({position:c,days:e})=>`${c} ${e}`},RecurrenceEditor:{"Repeat event":"Repeat event",Cancel:"Cancel",Save:"Save",Frequency:"Frequency",Every:"Every",DAILYintervalUnit:"day(s)",WEEKLYintervalUnit:"week(s)",MONTHLYintervalUnit:"month(s)",YEARLYintervalUnit:"year(s)",Each:"Each","On the":"On the","End repeat":"End repeat","time(s)":"time(s)"},RecurrenceDaysCombo:{day:"day",weekday:"weekday","weekend day":"weekend day"},RecurrencePositionsCombo:{position1:"first",position2:"second",position3:"third",position4:"fourth",position5:"fifth","position-1":"last"},RecurrenceStopConditionCombo:{Never:"Never",After:"After","On date":"On date"},RecurrenceFrequencyCombo:{None:"No repeat",Daily:"Daily",Weekly:"Weekly",Monthly:"Monthly",Yearly:"Yearly"},RecurrenceCombo:{None:"None",Custom:"Custom..."},Summary:{"Summary for":c=>`Summary for ${c}`},ScheduleRangeCombo:{completeview:"Complete schedule",currentview:"Visible schedule",daterange:"Date range",completedata:"Complete schedule (for all events)"},SchedulerExportDialog:{"Schedule range":"Schedule range","Export from":"From","Export to":"To"},ExcelExporter:{"No resource assigned":"No resource assigned"},CrudManagerView:{serverResponseLabel:"Server response:"},DurationColumn:{Duration:"Duration"}};Be.publishLocale(WD);class _d extends Kt(se){static get $name(){return"PresetStore"}static get defaultConfig(){return{useRawData:!0,modelClass:Ui,zoomOrder:1}}set storage(e){super.storage=e,this.storage.addSorter((t,i)=>{const r=t.bottomHeader,n=i.bottomHeader;return(i.msPerPixel-t.msPerPixel||kt[r.unit]-kt[n.unit]||r.increment-n.increment)*this.zoomOrder})}get storage(){return super.storage}getById(e){return super.getById(e)||!this.isPresetManager&&zn.getById(e)}createRecord(e,...t){let i;if(e.isViewPreset)return e;if(typeof e=="string")i=this.getById(e);else if(typeof e=="number")i=this.getAt(e);else return e.base&&(e=this.copyBaseValues(e)),super.createRecord(e,...t);if(!i)throw new Error(`ViewPreset ${e} does not exist`);return i}updateLocalization(){super.updateLocalization();const e=this;let t=e.allRecords;e.isPresetManager&&(t=new Set(t.concat(Object.values(e.basePresets)))),t.forEach(i=>{let r=e.optionalL(`L{PresetManager.${i.id}}`,null,!0);typeof r=="string"&&i.baseId&&(r=e.optionalL(`L{PresetManager.${i.baseId}}`,null,!0)),r&&typeof r=="object"&&(i.originalDisplayDateFormat||(i.originalDisplayDateFormat=i.displayDateFormat),i.mainHeaderLevel===0&&r.topDateFormat&&(r.middleDateFormat=r.middleDateFormat||r.topDateFormat),i.setData("displayDateFormat",r.displayDateFormat||i.originalDisplayDateFormat),["top","middle","bottom"].forEach(n=>{const s=i.headerConfig[n],a=r[n+"DateFormat"];s&&(s.originalDateFormat||(s.originalDateFormat=s.dateFormat),a&&s.renderer&&(s.renderer=null),s.dateFormat=a||s.originalDateFormat)}),r.name?(i.unlocalizedName||(i.unlocalizedName=i.name),i.setData("name",r.name)):i.unlocalizedName&&i.unlocalizedName!==i.name&&(i.name=i.unlocalizedName,i.unlocalizedName=null))})}getCurrentConfig(e){return super.getCurrentConfig(e).data}copyBaseValues(e){let t=this.getById(e.base);if(!t)throw new Error(`ViewPreset base '${e.base}' does not exist.`);return t=T.clone(t.data),delete t.id,delete t.name,T.merge(t,e)}add(e){return e=Array.isArray(e)?e:[e],e.forEach(t=>{t.isViewPreset&&t.base&&(t.data=this.copyBaseValues(t.originalData))}),super.add(...arguments)}}_d._$name="PresetStore";class UD extends _d{static get $name(){return"PresetManager"}static get defaultConfig(){return{preventSubClassingModel:!0,basePresets:{secondAndMinute:{name:"Seconds",tickWidth:30,tickHeight:40,displayDateFormat:"ll LTS",shiftIncrement:10,shiftUnit:"minute",defaultSpan:24,timeResolution:{unit:"second",increment:5},headers:[{unit:"minute",dateFormat:"llll"},{unit:"second",increment:10,dateFormat:"ss"}]},minuteAndHour:{name:"Minutes",tickWidth:60,tickHeight:60,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"hour",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"hour",dateFormat:"ddd MM/DD, hA"},{unit:"minute",increment:30,dateFormat:"mm"}]},hourAndDay:{name:"Day",tickWidth:70,tickHeight:40,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"day",dateFormat:"ddd DD/MM"},{unit:"hour",dateFormat:"LT"}]},day:{name:"Day/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:1,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"day",dateFormat:"ddd DD/MM",splitUnit:"day"},{unit:"hour",renderer(e){return`
                                    <div class="b-sch-calendarcolumn-ct"><span class="b-sch-calendarcolumn-hours">${b.format(e,"HH")}</span>
                                    <span class="b-sch-calendarcolumn-minutes">${b.format(e,"mm")}</span></div>
                                `}}]},week:{name:"Week/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"week",defaultSpan:24,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"D d",splitUnit:"day"},{unit:"hour",dateFormat:"LT",renderer(e){return`
                                    <div class="sch-calendarcolumn-ct">
                                    <span class="sch-calendarcolumn-hours">${b.format(e,"HH")}</span>
                                    <span class="sch-calendarcolumn-minutes">${b.format(e,"mm")}</span>
                                    </div>
                                `}}]},dayAndWeek:{name:"Days & Weeks",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"day",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"hour",increment:1},headers:[{unit:"week",renderer(e){return b.getShortNameOfUnit("week")+"."+b.format(e,"WW MMM YYYY")}},{unit:"day",dateFormat:"dd DD"}]},dayAndMonth:{name:"Month",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"month",shiftIncrement:1,defaultSpan:1,mainUnit:"month",timeResolution:{unit:"hour",increment:1},headers:[{unit:"month",dateFormat:"MMMM YYYY"},{unit:"day",dateFormat:"DD"}]},weekAndDay:{name:"Week",tickWidth:100,tickHeight:80,displayDateFormat:"ll hh:mm A",shiftUnit:"week",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"YYYY MMMM DD"},{unit:"day",increment:1,dateFormat:"DD MMM"}]},weekAndMonth:{name:"Weeks",tickWidth:100,tickHeight:105,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"MMM YYYY"},{unit:"week",dateFormat:"DD MMM"}]},weekAndDayLetter:{name:"Weeks/weekdays",tickWidth:20,tickHeight:50,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"ddd DD MMM YYYY",verticalColumnWidth:115},{unit:"day",dateFormat:"d1",verticalColumnWidth:25}]},weekDateAndMonth:{name:"Months/weeks",tickWidth:30,tickHeight:40,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"YYYY MMMM"},{unit:"week",dateFormat:"DD"}]},monthAndYear:{name:"Months",tickWidth:110,tickHeight:110,displayDateFormat:"ll",shiftIncrement:3,shiftUnit:"month",defaultSpan:12,timeResolution:{unit:"day",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"month",dateFormat:"MMM YYYY"}]},year:{name:"Years",tickWidth:100,tickHeight:100,resourceColumnWidth:100,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"month",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"quarter",renderer(e,t,i){return b.getShortNameOfUnit("quarter").toUpperCase()+(Math.floor(e.getMonth()/3)+1)}}]},manyYears:{name:"Multiple years",tickWidth:40,tickHeight:50,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"year",increment:1},mainHeaderLevel:0,headers:[{unit:"year",increment:5,renderer:(e,t)=>e.getFullYear()+" - "+t.getFullYear()},{unit:"year",dateFormat:"YY",increment:1}]}},defaultPresets:["manyYears",{width:80,increment:1,resolution:1,base:"manyYears",resolutionUnit:"YEAR"},"year",{width:30,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},"monthAndYear","weekDateAndMonth","weekAndMonth","weekAndDayLetter","dayAndMonth","weekAndDay",{width:54,increment:1,resolution:1,base:"weekAndDay",resolutionUnit:"HOUR"},"hourAndDay",{width:64,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:2,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},"minuteAndHour",{width:30,increment:15,resolution:5,base:"minuteAndHour"},{width:130,increment:15,resolution:5,base:"minuteAndHour"},{width:60,increment:5,resolution:5,base:"minuteAndHour"},{width:100,increment:5,resolution:5,base:"minuteAndHour"},"secondAndMinute",{width:60,increment:10,resolution:5,base:"secondAndMinute"},{width:130,increment:5,resolution:5,base:"secondAndMinute"}],internalListeners:{locale:"updateLocalization"}}}set basePresets(e){const t=this._basePresets={};for(const i in e)e[i].id=i,t[i]=this.createRecord(e[i])}get basePresets(){return this._basePresets}set defaultPresets(e){for(let t=0,{length:i}=e;t<i;t++){const r=e[t],n=typeof r=="string",s=n?r:r.base;let a;if(n)a=this.basePresets[s];else{const o=Object.setPrototypeOf(T.clone(this.basePresets[s].data),{id:s}),{timeResolution:l}=o,d=o.headers[o.headers.length-1];o.id=void 0,"width"in r&&(o.tickWidth=r.width),"height"in r&&(o.tickHeight=r.height),"increment"in r&&(d.increment=r.increment),"resolution"in r&&(l.increment=r.resolution),"resolutionUnit"in r&&(l.unit=b.getUnitByName(r.resolutionUnit)),a=this.createRecord(o),a.baseId=s}this.add(a)}}getById(e){return super.getById(e)||this.basePresets[e]}registerPreset(e,t){const i=this.createRecord(Object.assign({id:e},t)),r=this.find(n=>n.equals(i));if(r)return r;if(i.isValid)this.add(i);else throw new Error("Invalid preset, please check your configuration");return i}getPreset(e){return typeof e=="number"&&(e=this.getAt(e)),typeof e=="string"?e=this.getById(e):e instanceof Ui||(e=this.createRecord(e)),e}normalizePreset(e){const t=this;if(!(e instanceof Ui)){if(typeof e=="string"){if(e=t.getPreset(e),!e)throw new Error("You must define a valid view preset. See PresetManager for reference")}else if(typeof e=="object"){if(e.base){const i=this.getById(e.base);if(!i)throw new Error(`ViewPreset base '${e.base}' does not exist`);e=T.merge(T.clone(i.data),e)}e.id?e=t.createRecord(e):(e=t.createRecord(T.assign({},e)),e.id=e.generateId(e))}}return e}deletePreset(e){typeof e=="string"?e=this.getById(e):typeof e=="number"&&(e=this.getAt(e)),e&&(this.remove(e),delete this.basePresets[e.id])}}const zn=new UD;class YD extends Ct{get startDate(){return this.data.startDate}get endDate(){return this.data.endDate}}class Jm extends se{static get defaultConfig(){return{modelClass:YD,continuous:!0,originalContinuous:null,include:null,autoAdjust:!0,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,tickCache:{},viewPreset:null,useRawData:{disableDuplicateIdCheck:!0,disableDefaultValue:!0,disableTypeConversion:!0}}}static get configurable(){return{generateTicks:null,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,defaultSpan:1,weekStartDay:null,forceFullTicks:null}}construct(e){const t=this;if(super.construct(e),t.originalContinuous=t.continuous,t.ion({change:({action:i})=>{i!=="filter"&&t.trigger("reconfigure",{supressRefresh:!1})},refresh:()=>t.trigger("reconfigure",{supressRefresh:!1}),endreconfigure:i=>t.trigger("reconfigure",i)}),t.startDate)t.internalOnReconfigure(),t.trigger("reconfigure");else if(t.viewPreset){const i=t.getAdjustedDates(new Date);t.startDate=i.startDate,t.endDate=i.endDate}}get isTimeAxis(){return!0}reconfigure(e,t=!1,i=!1){const r=this,n=r.getAdjustedDates(e.startDate,e.endDate),s={};if(r.trigger("beforeReconfigure",{startDate:n.startDate,endDate:n.endDate,config:e})!==!1){r.trigger("beginReconfigure"),r._configuredStartDate=e.startDate,r._configuredEndDate=e.endDate;for(const a in e)s[a]=r[a];if(Object.assign(r,e),r.internalOnReconfigure(i)===!1)return!1;r.trigger("endReconfigure",{suppressRefresh:t,config:e,oldConfig:s})}}internalOnReconfigure(e=!1){const t=this;t.isConfigured=!0;const i=t.getAdjustedDates(t.startDate,t.endDate,!0),r=t.getAdjustedDates(t.startDate,t.endDate),n=r.startDate,s=r.endDate;if(n>=s)throw new Error(`Invalid start/end dates. Start date must less than end date. Start date: ${n}. End date: ${s}.`);const{unit:a,increment:o=1}=t,l=t.generateTicks(n,s,a,o);t.suspendEvents(),t.data=l;const{count:d}=t;if(d===0){if(e)return t.resumeEvents(),!1;throw new Error("Invalid time axis configuration or filter, please check your input data.")}t.startDate=t.first.startDate,t.endDate=t.last.endDate,t.resumeEvents(),t.isContinuous?(t.adjustedStart=i.startDate,t.adjustedEnd=b.getNext(d>1?l[d-1].startDate:i.startDate,a,o,t.weekStartDay)):(t.adjustedStart=t.startDate,t.adjustedEnd=t.endDate),t.updateVisibleTickBoundaries(),t.updateTickCache(!0)}updateVisibleTickBoundaries(){const e=this,{count:t,unit:i,startDate:r,endDate:n,weekStartDay:s,increment:a=1}=e,o=b.getNormalizedUnitDuration(r,i)*a,l=b.getNormalizedUnitDuration(n,i)*a;do e.visibleTickStart=(r-e.adjustedStart)/o,e.autoAdjust&&(e.visibleTickStart=Math.floor(e.visibleTickStart)),e.visibleTickStart>=1&&(e.adjustedStart=b.getNext(e.adjustedStart,i,a,s));while(e.visibleTickStart>=1);do e.visibleTickEnd=t-(e.adjustedEnd-n)/l,t-e.visibleTickEnd>=1&&(e.adjustedEnd=b.getNext(e.adjustedEnd,i,-1,s));while(t-e.visibleTickEnd>=1);e.fullTicks=!e.visibleTickStart&&e.visibleTickEnd===t}get viewPreset(){return this._viewPreset}set viewPreset(e){const t=this;if(e=zn.getPreset(e),!(e instanceof Ui))throw new Error("TimeAxis must be configured with the ViewPreset instance that the Scheduler is using");t._viewPreset=e,Object.assign(t,{unit:e.bottomHeader.unit,increment:e.bottomHeader.increment||1,resolutionUnit:e.timeResolution.unit,resolutionIncrement:e.timeResolution.increment,mainUnit:e.mainHeader.unit,shiftUnit:e.shiftUnit||e.mainHeader.unit,shiftIncrement:e.shiftIncrement||1,defaultSpan:e.defaultSpan||1,presetName:e.id,headers:e.headers})}get weekStartDay(){var e;return(e=this._weekStartDay)!==null&&e!==void 0?e:b.weekStartDay}get resolution(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}}set resolution(e){this.resolutionUnit=e.unit,this.resolutionIncrement=e.increment}get resolutionUnit(){return this.forceFullTicks?this.unit:this._resolutionUnit}get resolutionIncrement(){return this.forceFullTicks?this.increment:this._resolutionIncrement}setTimeSpan(e,t,i=!1){t&&e-t===0&&(t=null);const r=this,{startDate:n,endDate:s}=r.getAdjustedDates(e,t);if(r.startDate-n!==0||r.endDate-s!==0)return r.reconfigure({startDate:n,endDate:s},!1,i)}shift(e,t=this.shiftUnit){const i=this;let{startDate:r,endDate:n}=i;i.isFiltered&&(r=i.allRecords[0].startDate,n=i.allRecords[i.allCount-1].endDate);let s=0;do r=b.add(r,e,t),n=b.add(n,e,t);while(s++<100&&i.setTimeSpan(r,n,{preventThrow:!0})===!1)}shiftNext(e=this.shiftIncrement){this.shift(e)}shiftPrevious(e=this.shiftIncrement){this.shift(-e)}filterBy(e,t=this){const i=this;i.filters.clear(),super.filterBy((r,n)=>e.call(t,r.data,n)),i.count===0&&(i.trigger("invalidFilter"),i.clearFilters())}triggerFilterEvent(e){const t=this;e.filters.count?t.continuous=!1:t.continuous=t.originalContinuous,t.updateTickCache(),super.triggerFilterEvent(e)}get isContinuous(){return this.continuous!==!1&&!this.isFiltered}getAdjustedDates(e,t,i=!1){const r=this;return t&&e-t===0&&(t=null),e=e||r.startDate,t=t||b.add(e,r.defaultSpan,r.mainUnit),r.autoAdjust||i?{startDate:r.floorDate(e,!1,r.autoAdjust?r.mainUnit:r.unit,1),endDate:r.ceilDate(t,!1,r.autoAdjust?r.mainUnit:r.unit,1)}:{startDate:e,endDate:t}}get startDate(){return this._start||(this.first?new Date(this.first.startDate):null)}set startDate(e){this._start=b.parse(e)}get endDate(){return this._end||(this.last?new Date(this.last.endDate):null)}set endDate(e){e&&(this._end=b.parse(e))}get startMS(){return this._startMS}get endMS(){return this._endMS}floorDate(e,t,i,r){t=t!==!1;const n=this,s=t?b.clone(n.startDate):null,a=r||n.resolutionIncrement,o=i||(t?n.resolutionUnit:n.mainUnit),l=(u,h)=>Math.floor(u/h)*h;if(t){const u=l(b.diff(s,e,o),a);return b.add(s,u,o,!1)}const d=b.clone(e);if(o==="week"){const u=d.getDay()||7,h=n.weekStartDay||7;b.add(b.startOf(d,"day",!1),u>=h?h-u:-(7-h+u),"day",!1),d.getDay()!==h&&d.getHours()===23&&b.add(d,1,"hour",!1)}else{b.startOf(d,o,!1);const u=["day","year"].includes(o)?1:0,h=o==="day"?"date":o,f=l(b.get(d,h)-u,a)+u;b.set(d,h,f)}return d}roundDate(e,t,i=this.resolutionUnit,r=this.resolutionIncrement||1){const n=this,s=b.clone(e);switch(t=b.clone(t||n.startDate),i){case"week":{b.startOf(s,"day",!1);let a=s.getDay()-n.weekStartDay,o;return a<0&&(a=7+a),Math.round(a/7)===1?o=7-a:o=-a,b.add(s,o,"day",!1)}case"month":{const a=b.diff(t,s,"month")+b.as("month",s.getDay()/b.daysInMonth(s)),o=Math.round(a/r)*r;return b.add(t,o,"month",!1)}case"quarter":return b.startOf(s,"month",!1),b.add(s,3-s.getMonth()%3,"month",!1);default:{const a=b.as(i,b.diff(t,s)),o=b.as(i,t.getTimezoneOffset()-s.getTimezoneOffset(),"minute"),l=Math.round((a+o)/r)*r;return b.add(t,l-o,i,!1)}}}ceilDate(e,t,i,r){const n=this;t=t!==!1,r=r||(t?n.resolutionIncrement:1);const s=i||(t?n.resolutionUnit:n.mainUnit),a=b.clone(e);let o=!1;switch(s){case"minute":o=!b.isStartOf(a,"minute");break;case"hour":o=!b.isStartOf(a,"hour");break;case"day":case"date":o=!b.isStartOf(a,"day");break;case"week":b.startOf(a,"day",!1),o=a.getDay()!==n.weekStartDay||!b.isEqual(a,e);break;case"month":b.startOf(a,"day",!1),o=a.getDate()!==1||!b.isEqual(a,e);break;case"quarter":b.startOf(a,"day",!1),o=a.getMonth()%3!==0||a.getDate()!==1||!b.isEqual(a,e);break;case"year":b.startOf(a,"day",!1),o=a.getMonth()!==0||a.getDate()!==1||!b.isEqual(a,e);break}return o?b.getNext(a,s,r,n.weekStartDay):a}get include(){return this._include}set include(e){const t=this;t._include=e,t.continuous=!e,t.isConfiguring||(t.startDate=t._configuredStartDate,t.endDate=t._configuredEndDate,t.internalOnReconfigure(),t.trigger("includeChange"))}processExclusion(e,t,i){const{include:r}=this;return r?Object.entries(r).some(([n,s])=>{if(!s)return!1;const{from:a,to:o}=s;if(b.compareUnits("day",i)>=0&&b.getLargerUnit(n)===i&&(a&&b.set(e,n,a),o)){let l=i;i==="day"&&(l="date"),b.set(t,{[l]:b.get(t,l)-1,[n]:o})}if(b.compareUnits(n,i)>=0){const l=n==="day"?e.getDay():b.get(e,n);if(a&&l<a||o&&l>=o)return!0}}):!1}initExclusion(){Object.entries(this.include).forEach(([e,t])=>{if(t){const{from:i,to:r}=t;t.lengthFactor=b.getUnitToBaseUnitRatio(e,b.getLargerUnit(e))/(r-i),t.lengthFactorExcl=b.getUnitToBaseUnitRatio(e,b.getLargerUnit(e))/(r-i-1),t.center=i+i/(t.lengthFactor-1)}})}updateGenerateTicks(){this.isConfiguring||this.reconfigure(this)}_generateTicks(e,t,i=this.unit,r=this.increment){const n=this,s=[],a=Boolean(n.include);let o,l,d,u=0,{startDate:h,endDate:f}=n.getAdjustedDates(e,t);for(n.tickCache={},a&&n.initExclusion();h<f;){if(o=b.getNext(h,i,r,n.weekStartDay),!n.autoAdjust&&o>f&&(o=f),i==="hour"&&r>1&&s.length>0&&u===0){const g=s[s.length-1];u=(g.startDate.getHours()+r)%24-g.endDate.getHours(),u!==0&&(o=b.add(o,u,"hour"))}d=!1,a?(l=new Date(o.getTime()),d=n.processExclusion(h,o,i)):l=o,d||(s.push({id:s.length+1,startDate:h,endDate:o}),n.tickCache[h.getTime()]=s.length-1),h=l}return s}get visibleTickTimeSpan(){const e=this;return e.isContinuous?e.visibleTickEnd-e.visibleTickStart:e.count}getTickFromDate(e){var t,i;const r=this,n=r.records,s=(t=(i=e.getTime)===null||i===void 0?void 0:i.call(e))!==null&&t!==void 0?t:e;let a=0,o=n.length-1,l,d,u,h;if(!n.length||s<n[0].startDateMS||s>n[o].endDateMS)return-1;if(r.isContinuous){for(;a<o;)l=a+o+1>>1,s>n[l].endDateMS?a=l+1:s<n[l].startDateMS?o=l-1:a=l;return d=n[a],u=d.startDateMS,s>u&&(h=d.endDateMS,a+=(s-u)/(h-u)),Math.min(Math.max(a,r.visibleTickStart),r.visibleTickEnd)}else for(let f=0;f<=o;f++)if(h=n[f].endDateMS,s<=h)return u=n[f].startDateMS,d=f+(s>u?(s-u)/(h-u):0),d}getDateFromTick(e,t){const i=this;if(e===i.visibleTickEnd)return i.endDate;const r=Math.floor(e),n=e-r,s=i.getAt(r);if(!s)return null;const a=r===0?i.adjustedStart:s.startDate,o=r===i.count-1&&i.isContinuous?i.adjustedEnd:s.endDate;let l=b.add(a,n*(o-a),"millisecond");return t&&(l=i[t+"Date"](l)),l}get ticks(){return this.records}updateTickCache(e=!1){const t=this;t.count?(t._start=t.first.startDate,t._end=t.last.endDate,t._startMS=t.startDate.getTime(),t._endMS=t.endDate.getTime()):t._start=t._end=t._startMs=t._endMS=null,e||(t.tickCache={},t.forEach((i,r)=>t.tickCache[i.startDate.getTime()]=r))}dateInAxis(e,t=!1){const i=this,r=i.startDate,n=i.endDate;if(i.isContinuous)return t?b.betweenLesserEqual(e,r,n):b.betweenLesser(e,r,n);{const s=i.getCount();let a,o,l;for(let d=0;d<s;d++)if(l=i.getAt(d),a=l.startDate,o=l.endDate,t&&e<=o||!t&&e<o)return e>=a}return!1}timeSpanInAxis(e,t){const i=this;return!t||t.getTime()===e.getTime()?this.dateInAxis(e,!0):i.isContinuous?b.intersectSpans(e,t,i.startDate,i.endDate):e<i.startDate&&t>i.endDate||i.getTickFromDate(e)!==i.getTickFromDate(t)}isTimeSpanInAxis(e){const t=this,{startMS:i,endMS:r}=t,{startDateMS:n,endDateMS:s}=e;if(!n||!s)return!1;if(s===n)return t.dateInAxis(e.startDate,!0);if(t.isContinuous)return s>i&&n<r;const a=t.getTickFromDate(e.startDate),o=t.getTickFromDate(e.endDate);return a===t.count&&b.isEqual(e.startDate,t.last.endDate)||o===0&&b.isEqual(e.endDate,t.first.startDate)?!1:n<i&&s>r||a!==o}forEachAuxInterval(e,t=1,i,r=this){const n=this.endDate;let s=this.startDate,a=0,o;if(s>n)throw new Error("Invalid time axis configuration");for(;s<n;)o=b.min(b.getNext(s,e,t,this.weekStartDay),n),i.call(r,s,o,a,o>=n),s=o,a++}}Jm._$name="TimeAxis";class Hd extends Kt(){static get $name(){return"RecurrenceLegend"}static get allDaysValueAsArray(){return["SU","MO","TU","WE","TH","FR","SA"]}static get allDaysValue(){return this.allDaysValueAsArray.join(",")}static get workingDaysValue(){return this.allDaysValueAsArray.filter((e,t)=>!b.nonWorkingDays[t]).join(",")}static get nonWorkingDaysValue(){return this.allDaysValueAsArray.filter((e,t)=>b.nonWorkingDays[t]).join(",")}static getLegend(e,t){const i=this,{timeSpan:r,interval:n,days:s,monthDays:a,months:o,positions:l}=e,d=t||r.startDate,u={interval:n};let h;switch(e.frequency){case"DAILY":return n===1?i.L("L{Daily}"):i.L("L{Every {0} days}",u);case"WEEKLY":return s&&s.length?u.days=i.getDaysLegend(s):d&&(u.days=b.getDayName(d.getDay())),i.L(n===1?"L{Weekly on {1}}":"L{Every {0} weeks on {1}}",u);case"MONTHLY":return s&&s.length&&l&&l.length?u.days=i.getDaysLegend(s,l):a&&a.length?(a.sort((f,g)=>f-g),u.days=i.arrayToText(a)):d&&(u.days=d.getDate()),i.L(n===1?"L{Monthly on {1}}":"L{Every {0} months on {1}}",u);case"YEARLY":return s&&s.length&&l&&l.length?u.days=i.getDaysLegend(s,l):u.days=d.getDate(),o&&o.length?(o.sort((f,g)=>f-g),o.length>2?h=f=>b.getMonthShortName(f-1):h=f=>b.getMonthName(f-1),u.months=i.arrayToText(o,h)):u.months=b.getMonthName(d.getMonth()),i.L(n===1?"L{Yearly on {1} of {2}}":"L{Every {0} years on {1} of {2}}",u)}}static getDaysLegend(e,t){const i=this,r={position:""};let n;if(t&&t.length&&(r.position=i.arrayToText(t,s=>i.L(`L{position${s}}`))),e.length)switch(e.sort((s,a)=>yt.decodeDay(s)[0]-yt.decodeDay(a)[0]),e.join(",")){case i.allDaysValue:r.days=i.L("L{day}");break;case i.workingDaysValue:r.days=i.L("L{weekday}");break;case i.nonWorkingDaysValue:r.days=i.L("L{weekend day}");break;default:e.length>2?n=s=>b.getDayShortName(yt.decodeDay(s)[0]):n=s=>b.getDayName(yt.decodeDay(s)[0]),r.days=i.arrayToText(e,n)}return i.L("L{daysFormat}",r)}static arrayToText(e,t){return t&&(e=e.map(t)),e.join(", ").replace(/,(?=[^,]*$)/,this.L("L{ and }"))}}Hd._$name="RecurrenceLegend";var Mi=c=>class extends c{static get $name(){return"AttachToProjectMixin"}async afterConstruct(){super.afterConstruct();const t=this,i=t.client||t.grid,{project:r}=i;i.projectSubscribers.push(t),r&&(t.attachToProject(r),t.attachToResourceStore(r.resourceStore),t.attachToEventStore(r.eventStore),t.attachToAssignmentStore(r.assignmentStore),t.attachToDependencyStore(r.dependencyStore),t.attachToCalendarManagerStore(r.calendarManagerStore))}attachToProject(t){this.detachListeners("project"),this._project=t}attachToEventStore(t){this.detachListeners("eventStore")}attachToResourceStore(t){this.detachListeners("resourceStore")}attachToAssignmentStore(t){this.detachListeners("assignmentStore")}attachToDependencyStore(t){this.detachListeners("dependencyStore")}attachToCalendarManagerStore(t){this.detachListeners("calendarManagerStore")}get project(){return this._project}get calendarManagerStore(){return this.project.calendarManagerStore}get assignmentStore(){return this.project.assignmentStore}get resourceStore(){return this.project.resourceStore}get eventStore(){return this.project.eventStore}get dependencyStore(){return this.project.dependencyStore}};const uf=["assignmentStore","dependencyStore","eventStore","resourceStore"];var Qm=c=>class extends(c||P){static get $name(){return"ProjectConsumer"}static get declarable(){return["projectStores"]}static get configurable(){return{projectModelClass:ir,project:{},destroyStores:null,projectSubscribers:[]}}startConfigure(t){this.getConfig("project"),super.startConfigure(t)}changeProject(t,i){const r=this,{projectStoreNames:n,projectDataNames:s}=r.constructor;if(r.projectCallbacks=new Set,t){if(r.buildingProjectConfig=!0,!t.isModel){if(r.isConfiguring){r._project=t;const{crudManager:l}=r;if(l){const{isCrudManager:d}=l;for(const u of n)l[u]&&(r[u]=l[u],d||delete l[u])}r.getConfig("projectStores");for(const d of s)r.getConfig(d)}const{eventStore:a}=t;let{_sharedProject:o}=r;if(a&&!a.isEventStoreMixin&&a.autoLoad&&!a.count&&(a.autoLoad=!1,r.delayAutoLoad=!0),o&&uf.some(l=>t[l]&&t[l]!==o[l])){for(const l of uf)t[l]&&t[l]===o[l]&&(t[l]=t[l].chain());o=null}t=o||new r.projectModelClass(t),delete r._project}r.buildingProjectConfig=!1}return t}updateProject(t,i){const r=this,{projectListeners:n,crudManager:s}=r;if(r.detachListeners("projectConsumer"),delete r._crudManager,t){n.thisObj=r,t.ion(n),t.isCrudManager?r.crudManager=t:s&&(s.project=t,r.crudManager=s),r.projectSubscribers.forEach(a=>a.attachToProject(t));for(const a of r.constructor.projectStoreNames)r[a]=t[a];r.delayAutoLoad&&(t.eventStore.autoLoad=!0,t.eventStore.load())}r.trigger("projectChange",{project:t})}changeCrudManager(t){if(this.buildingProjectConfig)this._crudManager=t.isCrudManager?t:Object.assign({},t);else return super.changeCrudManager(t)}onProjectDataReady(){const t=this;t.whenVisible(()=>{t.projectCallbacks.size&&(t.projectCallbacks.forEach(i=>i()),t.projectCallbacks.clear())},null,null,"onProjectDataReady")}onTimeZoneChange({timeZone:t,oldTimeZone:i}){const r=this;if(r.startDate){const n=i?Xe.fromTimeZone(r.startDate,i):r.startDate;r.startDate=t?Xe.toTimeZone(n,t):n}}whenProjectReady(t){this.isEngineReady?t():this.projectCallbacks.add(t)}get isEngineReady(){var t,i;return Boolean((t=(i=this.project).isEngineReady)===null||t===void 0?void 0:t.call(i))}doDestroy(){super.doDestroy(),this.destroyStores&&!this.project.isDestroyed&&this.project.destroy()}get projectStores(){const{projectStoreNames:t}=this.constructor;return t.map(i=>this[i])}static get projectStoreNames(){return Object.keys(this.projectStores)}static get projectDataNames(){return this.projectStoreNames.reduce((t,i)=>{const{dataName:r}=this.projectStores[i];return r&&t.push(r),t},[])}static setupProjectStores(t,i){const{projectStores:r}=t;if(r){const n={name:"projectConsumer",dataReady:"onProjectDataReady",change:"relayProjectDataChange",timeZoneChange:"onTimeZoneChange"},s={projectListeners:n};let a;for(const o in r){const{dataName:l}=r[o];s[o]=s[l]=null,l&&(Object.defineProperty(i.class.prototype,l,{configurable:!0,get(){var d;return(d=this.project[o])===null||d===void 0?void 0:d.records}}),this.createDataUpdater(o,l,a,i)),this.createStoreDescriptor(i,o,r[o],n),a=l}this.setupConfigs(i,s)}}static createDataUpdater(t,i,r,n){n.class.prototype[`update${z.capitalize(i)}`]=function(s){const{project:a}=this;r&&this.getConfig(r),this.buildingProjectConfig?a[`${i}Data`]=s:a[t].data=s}}static createStoreDescriptor(t,i,{listeners:r},n){const{prototype:s}=t.class,a=z.capitalize(i);n[`${i}Change`]=function({store:o}){this[i]=o},s[`change${a}`]=function(o,l){var d;const u=this,{project:h}=u,f=(d=o)===null||d===void 0?void 0:d.project;if(u.buildingProjectConfig){f!=null&&f.isProjectModel&&(u._sharedProject=f),h[i]=o;return}return u.initializingProject||h[i]!==o&&(h[`set${a}`](o),o=h[i]),o!==l&&(r&&(r.thisObj=u,r.name=`${i}Listeners`,u.detachListeners(r.name),o.ion(r)),u[`_${i}`]=o,u.projectSubscribers.forEach(g=>{var m;(m=g[`attachTo${a}`])===null||m===void 0||m.call(g,o)}),u[`_${i}`]=null),o}}relayProjectDataChange(t){return this.trigger("dataChange",F(F({project:t.source},t),{},{source:this}))}get widgetClass(){}};class Nd extends P{static get defaultConfig(){return{nbrOfBandsByResource:{},bandIndexToPxConvertFn:null,bandIndexToPxConvertThisObj:null}}clearCache(e){e?delete this.nbrOfBandsByResource[e.id]:this.nbrOfBandsByResource={}}applyLayout(e,t){return this.nbrOfBandsByResource[t.id]=this.layoutEventsInBands(e)}layoutEventsInBands(e){throw new Error("Implement in subclass")}}Nd._$name="HorizontalLayout";var Bd=c=>class extends(c||P){static get $name(){return"PackMixin"}static get defaultConfig(){return{coordProp:"top",sizeProp:"height",inBandCoordProp:"inBandTop",inBandSizeProp:"inBandHeight"}}isSameGroup(t,i){return this.grouped?t.group===i.group:!0}packEventsInBands(t,i){const r=this,{coordProp:n,sizeProp:s}=r;let a,o,l,d;for(let u=0,h=t.length;u<h;u++){if(o=t[u],a=r.findStartSlot(t,o),l=r.getCluster(t,u),l.length>1){for(o[n]=a.start,o[s]=a.end-a.start,d=1;d<l.length-1&&l[d+1].start-o.start===0;)d++;const m=r.findStartSlot(t,l[d]);m&&m.start<.8&&(l.length=d)}const f=l.length,g=(a.end-a.start)/f;for(d=0;d<f;d++)i(l[d],d,a,g);u+=f-1}return 1}findStartSlot(t,i){const{inBandSizeProp:r,inBandCoordProp:n,coordProp:s,sizeProp:a}=this,o=this.getPriorOverlappingEvents(t,i);let l;if(o.length===0)return{start:0,end:1};for(l=0;l<o.length;l++){const d=o[l],u=n in d?n:s,h=r in d?r:a;if(l===0&&d[u]>0)return{start:0,end:d[u]};if(d[u]+d[h]<(l<o.length-1?o[l+1][u]:1))return{start:d[u]+d[h],end:l<o.length-1?o[l+1][u]:1}}return!1}getPriorOverlappingEvents(t,i){const r=i.start,n=i.end,s=[];for(let a=0,o=t.indexOf(i);a<o;a++){const l=t[a];this.isSameGroup(l,i)&&b.intersectSpans(r,n,l.start,l.end)&&s.push(l)}return s.sort(this.sortOverlappers.bind(this)),s}sortOverlappers(t,i){const{coordProp:r}=this;return t[r]-i[r]}getCluster(t,i){const r=t[i],n=[r];if(i>=t.length-1)return n;let{start:s,end:a}=r;for(let o=i+1,l=t.length;o<l;o++){const d=t[o];if(!this.isSameGroup(d,r)||!b.intersectSpans(s,a,d.start,d.end))break;n.push(d),s=b.max(s,d.start),a=b.min(d.end,a)}return n}};class ep extends Nd.mixin(Bd){static get $name(){return"HorizontalLayoutPack"}static get configurable(){return{type:"pack"}}layoutEventsInBands(e){const t=this.packEventsInBands(e,(i,r,n,s)=>{i.height=s,i.top=n.start+r*s});return e.forEach(i=>{Object.assign(i,this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,i.top,i.height,i.eventRecord,i.resourceRecord))}),t}}ep._$name="HorizontalLayoutPack";class tp extends Nd{static get $name(){return"HorizontalLayoutStack"}static get configurable(){return{type:"stack"}}layoutEventsInBands(e,t=!1){let i=0;do{let r=0,n=e[0];for(;n;)t||(n.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,i,n.eventRecord,n.resourceRecord)),e.splice(r,1),r=this.findClosestSuccessor(n,e),n=e[r];i++}while(e.length>0);return i}findClosestSuccessor(e,t){const{endMS:i,group:r}=e,n=e.eventRecord&&e.eventRecord.duration===0;let s=1/0,a,o,l;for(let d=0,u=t.length;d<u;d++)if(l=t[d],o=l.startMS-i,o>=0&&o<s&&(o>0||l.endMS-l.startMS>0||!n)){if(this.grouped&&r!==l.group)break;a=d,s=o}return a}}tp._$name="HorizontalLayoutStack";class rr extends P{static get defaultConfig(){return{minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,div:document.createElement("div"),scheduler:null,template(e){return`<div class="b-sch-clockwrap b-sch-clock-${e.mode||this.mode} ${e.cls||""}">
                    <div class="b-sch-clock">
                        <div class="b-sch-hour-indicator">${b.format(e.date,"MMM")}</div>
                        <div class="b-sch-minute-indicator">${b.format(e.date,"D")}</div>
                        <div class="b-sch-clock-dot"></div>
                    </div>
                    <span class="b-sch-clock-text">${z.encodeHtml(e.text)}</span>
                </div>`}}}generateContent(e){return this.div.innerHTML=this.template(e)}updateDateIndicator(e,t){const i=e?.querySelector(".b-sch-hour-indicator"),r=e?.querySelector(".b-sch-minute-indicator");t&&i&&r&&K.isBrowserEnv&&(this.mode==="hour"?(i.style.transform=`rotate(${t.getHours()%12*30}deg)`,r.style.transform=`rotate(${t.getMinutes()*6}deg)`):(i.style.transform="none",r.style.transform="none"))}set mode(e){this._mode=e}get mode(){if(this._mode)return this._mode;const e=b.compareUnits(this.scheduler.timeAxisViewModel.timeResolution.unit,"day")<0,t=b.formatContainsHourInfo(this.scheduler.displayDateFormat);return e&&t?"hour":"day"}set template(e){this._template=e}get template(){return this._template}}rr._$name="ClockTemplate";class ip extends te{static get defaultConfig(){return{tooltipTemplate:e=>`
                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">
                    ${e.startClockHtml}
                    ${e.endClockHtml}
                    <div class="b-sch-tip-message">${e.message}</div>
                </div>
            `,showTooltip:!0,showExactDropPosition:!1,store:null,dragHelperConfig:null,tooltipCls:"b-eventdrag-tooltip"}}static get configurable(){return{constrainDragToTimeline:!0,constrainDragToResource:!0,constrainDragToTimeSlot:!1,tip:{$config:["lazy","nullify"],value:{align:{align:"b-t",allowTargetOut:!0},autoShow:!0,updateContentOnMouseMove:!0}},throttleDragEvent:!0}}static get pluginConfig(){return{chain:["onPaint"]}}internalSnapToPosition(e){var t;const{dragData:i}=this;(t=this.snapToPosition)===null||t===void 0||t.call(this,{assignmentRecord:i.assignmentRecord,eventRecord:i.eventRecord,resourceRecord:i.newResource||i.resourceRecord,startDate:i.startDate,endDate:i.endDate,snapTo:e})}buildDragHelperConfig(){const e=this,{client:t,constrainDragToTimeline:i,constrainDragToResource:r,constrainDragToTimeSlot:n,dragHelperConfig:s={}}=e,{timeAxisViewModel:a,isHorizontal:o}=t,l=o?r:n,d=o?n:r;return e.externalDropTargetSelector&&(s.dropTargetSelector=`.b-timeaxissubgrid,${e.externalDropTargetSelector}`),U.merge({name:e.constructor.name,positioning:"absolute",lockX:d,lockY:l,minX:!0,maxX:!0,constrain:!1,cloneTarget:!i,removeProxyAfterDrop:!1,dragWithin:i?null:document.body,hideOriginalElement:!0,dropTargetSelector:".b-timelinebase",dropTargetCls:e.externalDropTargetSelector?"b-drop-target":"",outerElement:t.timeAxisSubGridElement,targetSelector:t.eventSelector,scrollManager:i?t.scrollManager:null,createProxy:u=>e.createProxy(u),snapCoordinates:({element:u,newX:h,newY:f})=>{const{dragData:g}=e;if(e.constrainDragToTimeline&&!e.constrainDragToTimeSlot&&(e.showExactDropPosition||a.snap)){const p=g.draggedEntities[0],v=e.getCoordinate(p,u,[h,f]),y=a.getDateFromPosition(v,"round"),{calendar:C}=p;if(!C||y&&C.isWorkingTime(y,b.add(y,p.fullDuration))){const D=y&&a.getPositionFromDate(y);y&&y>=t.startDate&&D!=null&&(o?h=D:f=D)}}const m={x:h,y:f};return e.internalSnapToPosition(m),m},internalListeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",afterdragstart:"onAfterDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",abortFinalized:"onDragAbortFinalized",reset:"onDragReset",thisObj:e}},s,{isElementDraggable:(u,h)=>(!s||!s.isElementDraggable||s.isElementDraggable(u,h))&&e.isElementDraggable(u,h)})}onPaint({firstPaint:e}){var t;const i=this,{client:r}=i;(t=i.drag)===null||t===void 0||t.destroy(),i.drag=Yn.new(i.buildDragHelperConfig()),e&&r.rowManager.ion({changeTotalHeight:()=>{var n;return i.updateYConstraint((n=i.dragData)===null||n===void 0?void 0:n[`${r.scheduledEventName}Record`])},thisObj:i}),i.showTooltip&&(i.clockTemplate=new rr({scheduler:r}))}doDestroy(){var e,t,i;(e=this.drag)===null||e===void 0||e.destroy(),(t=this.clockTemplate)===null||t===void 0||t.destroy(),(i=this.tip)===null||i===void 0||i.destroy(),super.doDestroy()}get tipId(){return`${this.client.id}-event-drag-tip`}changeTip(e,t){const i=this;if(e){const r=ce.reconfigure(t,ce.mergeConfigs({forElement:i.element,id:i.tipId,getHtml:i.getTipHtml.bind(i),cls:i.tooltipCls,owner:i.client},e),{owner:i.client,defaults:{type:"tooltip"}});return r.ion({innerHtmlUpdate:"updateDateIndicator",thisObj:i}),r}else t?.destroy()}createProxy(e){const t=e.cloneNode(!0);return delete t.id,t.classList.add(`b-sch-${this.client.mode}`),t}onBeforeDragStart({context:e,event:t}){const i=this,{client:r}=i,n=i.getMinimalDragData(e,t),s=n?.[`${r.scheduledEventName}Record`],a=n.resourceRecord;if(r.readOnly||i.disabled||!s||s.isDraggable===!1||s.readOnly||a!=null&&a.readOnly)return!1;e.pointerStartDate=r.getDateFromXY([e.startClientX,e.startPageY],null,!1);const o=i.triggerBeforeEventDrag(`before${r.capitalizedEventName}Drag`,F(F({},n),{},{event:t,context:F(F({},e),n)}))!==!1;if(o){var l;i.updateYConstraint(s,a),(l=r[`before${r.capitalizedEventName}DragStart`])===null||l===void 0||l.call(r,e,n)}return o}onAfterDragStart({context:e,event:t}){}get isDragging(){var e;return(e=this.drag)===null||e===void 0?void 0:e.isDragging}get isActivelyDragging(){return this.isDragging&&!this.finalizing}onDragStart({context:e,event:t}){var i,r,n;const s=this,a=(i=s.findClientFromTarget(t,e))!==null&&i!==void 0?i:s.client;s.currentOverClient=a,s.drag.unifiedProxy=s.unifiedDrag,s.onMouseOverNewTimeline(a,!0);const o=s.dragData=s.getDragData(e);if(s.suspendElementRedrawing(e.element),s.showTooltip&&s.tip){const h=o.context.dragProxy?o.context.dragProxy.firstChild:e.element;s.tip.showBy(h)}s.triggerDragStart(o),(r=a[`after${a.capitalizedEventName}DragStart`])===null||r===void 0||r.call(a,e,o);const{eventMenu:l,taskMenu:d}=a.features,u=l||d;u==null||(n=u.hideContextMenu)===null||n===void 0||n.call(u,!1)}updateDateIndicator(){const{startDate:e,endDate:t}=this.dragData,{tip:i,clockTemplate:r}=this,n=i.element.querySelector(".b-sch-tooltip-enddate");r.updateDateIndicator(i.element,e),n&&r.updateDateIndicator(n,t)}findClientFromTarget(e,t){let{target:i}=e;if(/^touch/.test(e.type)){const n=$.from(t.element,null,!0).center;i=S.elementFromPoint(n.x,n.y)}const r=N.fromElement(i,"timelinebase");return r!=null&&r.isResourceHistogram?null:r}onDrag({context:e,event:t}){const i=this,r=i.dragData,n=r.startDate;let s;if(i.constrainDragToTimeline?s=i.client:s=i.findClientFromTarget(t,r.context),i.updateDragContext(e,t),!!s){if(s!==i.currentOverClient&&i.onMouseOverNewTimeline(s),r.dirty||!i.throttleDragEvent){const a=r.valid;i.triggerEventDrag(r,n),a!==r.valid&&(r.context.valid=r.externalDragValidity=r.valid)}i.showTooltip&&i.tip&&(i.tip.lastAlignSpec.allowTargetOut=!r.valid,i.tip.realign())}}onMouseOverNewTimeline(e,t){const i=this,{drag:{lockX:r,lockY:n}}=i,s=[];i.currentOverClient.element.classList.remove("b-dragging-"+i.currentOverClient.scheduledEventName),e.element.classList.add("b-dragging-"+e.scheduledEventName),t||i.currentOverClient.scrollManager.stopMonitoring(),r||s.push({element:e.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),n||s.push({element:e.scrollable.element,direction:"vertical"}),e.scrollManager.startMonitoring({scrollables:s,callback:i.drag.onScrollManagerScrollCallback}),i.currentOverClient=e}triggerBeforeEventDropFinalize(e,t,i){i.trigger(e,t)}onDrop({context:e,event:t}){var i;const r=this,{currentOverClient:n,dragData:s}=r;let a=!1;if((i=r.tip)===null||i===void 0||i.hide(),e.valid=e.valid&&r.isValidDrop(s),r.drag.removeProxyAfterDrop=Boolean(s.externalDropTarget),e.valid&&s.startDate&&s.endDate){let o=!1;s.finalize=async l=>{o||s.async?await r.finalize(l):e.valid=e.valid&&l},r.triggerBeforeEventDropFinalize(`before${n.capitalizedEventName}DropFinalize`,{context:s,domEvent:t},n),o=!0,e.async=s.async,!e.async&&!s.externalDropTarget&&(a=s.startDate-s.origStart!==0||s.newResource!==s.resourceRecord)}e.async||r.finalize(s.valid&&e.valid&&a)}onDragAbort({context:e}){var t;const i=this;i.client.currentOrientation.onDragAbort({context:e,dragData:i.dragData}),i.resetDraggedElements(),(t=i.tip)===null||t===void 0||t.hide(),i.triggerDragAbort(i.dragData)}onDragAbortFinalized({context:e}){var t,i;const r=this;r.triggerDragAbortFinalized(r.dragData),(t=(i=r.client)[`after${r.client.capitalizedEventName}DragAbortFinalized`])===null||t===void 0||t.call(i,e,r.dragData)}onDragReset({source:e}){var t;const i=this,r=i.currentOverClient;r?.scrollManager.stopMonitoring(),(t=e.context)!==null&&t!==void 0&&t.started&&(i.resetDraggedElements(),r.trigger(`${r.scheduledEventName}DragReset`)),r?.element.classList.remove("b-dragging-"+i.currentOverClient.scheduledEventName),i.dragData=null}resetDraggedElements(){const{dragData:e}=this,{eventBarEls:t,draggedEntities:i}=e;this.resumeRecordElementRedrawing(e.record),i.forEach((r,n)=>{this.resumeRecordElementRedrawing(r),t[n].classList.remove(this.drag.draggingCls),t[n].retainElement=!1}),e.context.element.retainElement=!1}onInternalInvalidDrop(e){var t;const i=this,{context:r}=i.drag;(t=i.tip)===null||t===void 0||t.hide(),i.triggerAfterDrop(i.dragData,!1),r.valid=!1,e&&i.drag.abort()}async finalize(e){const t=this,{dragData:i}=t;if(!i||t.finalizing)return;const{context:r,draggedEntities:n,externalDropTarget:s}=i;let a;return t.finalizing=!0,n.forEach((o,l)=>{t.resumeRecordElementRedrawing(o),i.eventBarEls[l].classList.remove(t.drag.draggingCls),i.eventBarEls[l].retainElement=!1}),r.element.retainElement=!1,s&&i.valid||e?(a=t.updateRecords(i),!s&&U.isPromise(a)&&(r.async=!0,await a),i.valid?(r.async&&r.finalize(),s&&t.client.refreshRows(!1),t.triggerAfterDrop(i,!0)):t.onInternalInvalidDrop(!0)):t.onInternalInvalidDrop(r.async||i.async),t.finalizing=!1,a}updateDragContext(e,t){const i=this,{drag:r}=i,n=i.dragData,s=i.currentOverClient,{isHorizontal:a}=s,[o]=n.draggedEntities,l=o.isAssignment?o.event:o,d=n.startDate,u=i.constrainDragToTimeSlot||(a?r.lockX:r.lockY);if(n.browserEvent=t,Object.assign(n,i.getProductDragContext(n)),u)n.timeDiff=0;else{const{dateConstraints:p}=n;let v;if(s.timeAxis.isContinuous){var h,f;const y=s.isHorizontal?(h=e.pageX)!==null&&h!==void 0?h:e.startPageX:(f=e.pageY)!==null&&f!==void 0?f:e.startPageY,C=s.getDateFromCoordinate(y,null,!1,!0);v=n.timeDiff=C-e.pointerStartDate}else{const y=i.resolveStartEndDates(e.element);n.valid=Boolean(y.startDate&&y.endDate),n.valid&&(v=y.startDate-n.origStart)}v!==null&&(n.startDate=i.adjustStartDate(n.origStart,v),p&&(n.startDate=b.constrain(n.startDate,p.start,p.end?new Date(p.end-l.durationMS):null)),n.endDate=b.add(n.startDate,l.fullDuration),n.valid&&(n.timeDiff=n.startDate-n.origStart))}const g=n.dirty=n.dirty||d-n.startDate!==0;if(n.valid)if(i.constrainDragToTimeline&&(n.endDate<=s.timeAxis.startDate||n.startDate>=s.timeAxis.endDate))n.valid=!1,n.context.message=i.L("L{EventDrag.noDropOutsideTimeline}");else if(g||n.externalDropTarget){const p=n.externalDragValidity=!t||e.pageX&&i.checkDragValidity(n,t);!p||typeof p=="boolean"?(n.valid=p!==!1,n.context.message=""):(n.valid=p.valid!==!1,n.context.message=p.message)}else{var m;n.valid=n.externalDragValidity!==!1&&((m=n.externalDragValidity)===null||m===void 0?void 0:m.valid)!==!1}else n.valid=!1;n.context.valid=n.valid}suspendRecordElementRedrawing(e,t=!0){this.suspendElementRedrawing(this.getRecordElement(e),t),e.instanceMeta(this.client).retainElement=t}resumeRecordElementRedrawing(e){this.suspendRecordElementRedrawing(e,!1)}suspendElementRedrawing(e,t=!0){e&&(e.retainElement=t)}resumeElementRedrawing(e){this.suspendElementRedrawing(e,!1)}getDragData(e){const t=this,{client:i,drag:r}=t,n=t.setupProductDragData(e),{record:s,eventBarEls:a,draggedEntities:o}=n,{startEvent:l}=r,d=s.isAssignment?s.event:s,u=d.startDate,h=d.endDate,f=i.timeAxis,g=u<f.startDate,m=h>f.endDate,p=i.isSchedulerBase?i.multiEventSelect:i.selectionMode.multiSelect,v=t.getCoordinate(d,e.element,[e.elementStartX,e.elementStartY]),y=t.getCoordinate(d,e.element,[e.startClientX,e.startClientY]);t.suspendRecordElementRedrawing(s),o.forEach(D=>t.suspendRecordElementRedrawing(D)),s.isAssignment?i.selectAssignment(s,l.ctrlKey&&p):i.selectEvent(s,l.ctrlKey&&p);const C=F(F({context:e},n),{},{sourceDate:g?u:i.getDateFromCoordinate(v),screenSourceDate:i.getDateFromCoordinate(y,null,!1),startDate:u,endDate:h,timeDiff:0,origStart:u,origEnd:h,startsOutsideView:g,endsOutsideView:m,duration:h-u,browserEvent:l});return a.forEach(D=>D.classList.remove("b-sch-event-hover","b-active")),a.length>1&&(e.relatedElements=a.slice(1)),C}setupConstraints(e,t,i,r){const n=this,s=!n.showExactDropPosition&&i>1?i:0,a=0;r?n.setXConstraint(e.left,e.right-t.width,s):n.setXConstraint(!0,!0,s),n.setYConstraint(e.top,e.bottom-t.height,a)}updateYConstraint(e,t){const i=this,{client:r}=i,{context:n}=i.drag,s=r.timeAxisViewModel.snapPixelAmount;if(n&&!i.drag.lockY){let a;if(i.constrainDragToTimeline)a=r.getScheduleRegion(t,e);else{i.setYConstraint(null,null,s);return}i.setYConstraint(a.top,a.bottom-n.element.offsetHeight,s)}else i.setYConstraint(null,null,s)}setXConstraint(e,t,i){const{drag:r}=this;r.minX=e,r.maxX=t}setYConstraint(e,t,i){const{drag:r}=this;r.minY=e,r.maxY=t}adjustStartDate(e,t){return this.client.timeAxis.roundDate(new Date(e-0+t),this.client.snapRelativeToEventStartDate?e:!1)}resolveStartEndDates(e){const t=this.currentOverClient,{timeAxis:i}=t,r=$.from(e.querySelector(t.eventInnerSelector),t.timeAxisSubGridElement),n=this.dragData,[s]=n.draggedEntities,{fullDuration:a}=s.isAssignment?s.event:s;let{start:o,end:l}=t.getStartEndDatesFromRectangle(r,"round",a,!i.isContinuous);if(o&&l)if(o=this.adjustStartDate(o,0),n.startsOutsideView)n.endsOutsideView||(o=l&&b.add(l,-a));else{if(!i.dateInAxis(o,!1)){const d=i.getTickFromDate(o);d>=0&&(o=i.getDateFromTick(d))}l=o&&b.add(o,a)}return{startDate:o,endDate:l}}getTipHtml(){const e=this,{dragData:t,client:i,tooltipTemplate:r}=e,{startDate:n,endDate:s,draggedEntities:a}=t,o=i.getFormattedDate(n),l=i.getFormattedEndDate(s,n),{valid:d,message:u,element:h,dragProxy:f}=t.context,g=f?f.firstChild:h,m=a[0],p=m.isTask?m:m.event;return e.tip.lastAlignSpec.target=g,r({valid:d,startDate:n,endDate:s,startText:o,endText:l,dragData:t,message:u||"",[i.scheduledEventName+"Record"]:p,startClockHtml:e.clockTemplate.template({date:n,text:o,cls:"b-sch-tooltip-startdate"}),endClockHtml:p.isMilestone?"":e.clockTemplate.template({date:s,text:l,cls:"b-sch-tooltip-enddate"})})}updateConstrainDragToTimeSlot(e){const t=this.client.isHorizontal?"lockX":"lockY";this.drag&&(this.drag[t]=e)}updateConstrainDragToResource(e){const t=this;if(t.drag){const{constrainDragToTimeSlot:i}=t,{isHorizontal:r}=t.client;e&&(t.constrainDragToTimeline=!0),t.drag.lockY=r?e:i,t.drag.lockX=r?i:e}}updateConstrainDragToTimeline(e){this.isConfiguring||Object.assign(this.drag,{cloneTarget:!e,dragWithin:e?null:document.body,scrollManager:e?this.client.scrollManager:null})}getElementFromContext(e){return e.grabbed||e.dragProxy||e.element}getRelatedRecords(e){return[]}getMinimalDragData(e,t){return{}}isValidDrop(e){throw new Error("Implement in subclass")}checkDragValidity(e){throw new Error("Implement in subclass")}updateRecords(e){throw new Error("Implement in subclass")}isElementDraggable(e,t){throw new Error("Implement in subclass")}getCoordinate(e,t,i){throw new Error("Implement in subclass")}setupProductDragData(e){throw new Error("Implement in subclass")}getProductDragContext(e){throw new Error("Implement in subclass")}getRecordElement(e){throw new Error("Implement in subclass")}}ip._$name="DragBase";const hf={top:"b-t",right:"b100-t100",bottom:"t-b",left:"b0-t0"};class uo extends te.mixin(Oa,Bg){static get $name(){return"EventResize"}static get configurable(){return{draggingItemCls:"b-sch-event-wrap-resizing",resizingItemInnerCls:"b-sch-event-resizing",leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSize:null,dynamicHandleSize:!0,allowResizeToZero:null,reservedSpace:5,touchHandleSize:null,dragThreshold:0,dragTouchStartDelay:0,draggingClsSelector:".b-timeline-base",showTooltip:!0,showExactResizePosition:!1,validatorFn:()=>!0,validatorFnThisObj:null,tip:{$config:["lazy","nullify"],value:{autoShow:!1,axisLock:!0,trackMouse:!1,updateContentOnMouseMove:!0,hideDelay:0}},tooltipTemplate:e=>`
                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">
                    ${e.startClockHtml}
                    ${e.endClockHtml}
                    <div class="b-sch-tip-message">${e.message}</div>
                </div>
            `,ignoreSelector:".b-sch-terminal",dragActiveCls:"b-resizing-event"}}static get pluginConfig(){return{chain:["render","onEventDataGenerated","isEventElementDraggable"]}}doDestroy(){var e;super.doDestroy(),(e=this.dragging)===null||e===void 0||e.destroy()}render(){const e=this,{client:t}=e;e.dragSelector=e.dragItemSelector=t.eventSelector,e.dragRootElement=e.dropRootElement=t.timeAxisSubGridElement,e.dragLock=t.isVertical?"y":"x"}isEventElementDraggable(e,t,i,r){const n=this,s=t?.resizable;return n.disabled||!s||t.isMilestone?!0:(s!==!0&&s!=="start"||!n.isOverStartHandle(r,e))&&(s!==!0&&s!=="end"||!n.isOverEndHandle(r,e))}onEventDataGenerated({eventRecord:e,wrapperCls:t,cls:i}){var r,n;e===((r=this.dragging)===null||r===void 0||(n=r.context)===null||n===void 0?void 0:n.eventRecord)&&(t["b-active"]=t[this.draggingItemCls]=t["b-over-resize-handle"]=i["b-resize-handle"]=i[this.resizingItemInnerCls]=1)}onDragPointerMove(e){var t;const{client:i,dragging:r}=this,{visibleDateRange:n,isHorizontal:s}=i,a=s&&i.rtl,o=s?"X":"Y",l=globalThis[`page${o}Offset`],d=e[`page${o}`]+(((t=r.context)===null||t===void 0?void 0:t.offset)||0),u=$.from(i.timeAxisSubGridElement,null,!0),h=u.getStart(a,s),f=u.getEnd(a,s);let g=i.getDateFromCoord({coord:d,local:!1});a?d-l>h?g=n.startDate:d<f&&(g=n.endDate):d-l<h?g=n.startDate:d-l>f&&(g=n.endDate),r.clientStartCoord=h,r.clientEndCoord=f,r.date=g,super.onDragPointerMove(e)}get isResizing(){return Boolean(this.dragging)}beforeDrag(e){const{client:t}=this,i=t.resolveTimeSpanRecord(e.itemElement),r=!t.isGanttBase&&t.resolveResourceRecord(t.isVertical?e.startEvent:e.itemElement);return this.disabled||t.readOnly||r!=null&&r.readOnly||i&&(i.readOnly||!(i.project||i.isOccurrence))||super.beforeDrag(e)===!1?!1:(e.mousedownDate=e.date=t.getDateFromCoordinate(e.event[`page${t.isHorizontal?"X":"Y"}`],null,!1),this.triggerBeforeResize(e))}dragStart(e){var t,i;const r=this,{client:n,tip:s}=r,{startEvent:a,itemElement:o}=e,l=n.scheduledEventName,d=n.resolveEventRecord(o),{isBatchUpdating:u,wrapStartDate:h,wrapEndDate:f}=d,g=(t=n.features.eventBuffer)===null||t===void 0?void 0:t.enabled,m=u?d.get("startDate"):d.startDate,p=u?d.get("endDate"):d.endDate,v=r.dragLock==="x",y=v&&n.rtl,C=r.isOverEndHandle(a,o),D=C?"endDate":"startDate",w=g?C?"wrapEndDate":"wrapStartDate":null,E=C?"startDate":"endDate",R=C?"setEndDate":"setStartDate",x=C?"setStartDate":"setEndDate",k=$.from(o),I=v?a.clientX:a.clientY,A=C?k.getEnd(y,v):k.getStart(y,v),L=e.context={eventRecord:d,element:o,timespanRecord:d,taskRecord:d,owner:r,valid:!0,oldValue:C?p:m,startDate:m,endDate:p,offset:g?0:A-I,edge:v?C?"right":"left":C?"bottom":"top",finalize:r.finalize,event:e.event,originalStartDate:m,originalEndDate:p,wrapStartDate:h,wrapEndDate:f,draggingEnd:C,toSet:D,wrapToSet:w,otherEnd:E,setMethod:R,setOtherMethod:x};d.meta.isResizing=!0,n.element.classList.add(...r.dragActiveCls.split(" ")),n.listenToBatchedUpdates||n.beginListeningForBatchedUpdates(),u||r.beginEventRecordBatch(d),r.setupProductResizeContext(L,a),r.triggerEventResizeStart(`${l}ResizeStart`,F({[`${l}Record`]:d,event:a},r.getResizeStartParams(L)),L),L.resizedRecord=((i=n.resolveAssignmentRecord)===null||i===void 0?void 0:i.call(n,L.element))||d,s&&(s.show(),s.align=hf[L.edge],s.showBy(r.getTooltipTarget(e)))}triggerBeforeResize(e){const{client:t}=this,i=t.resolveTimeSpanRecord(e.itemElement);return t.trigger(`before${t.capitalizedEventName}Resize`,F({[`${t.scheduledEventName}Record`]:i,event:e.event},this.getBeforeResizeParams({event:e.startEvent,element:e.itemElement})))}triggerEventResizeStart(e,t,i){var r,n;this.client.trigger(e,t),(r=(n=this.client)[`after${z.capitalize(e)}`])===null||r===void 0||r.call(n,i,t)}triggerEventResizeEnd(e,t){this.client.trigger(e,t)}triggerEventPartialResize(e,t){this.client.trigger(e,t)}triggerBeforeEventResizeFinalize(e,t){this.client.trigger(e,t)}dragEnter(e){var t;return((t=e.context)===null||t===void 0?void 0:t.owner)===this}resizeEventPartiallyInternal(e,t){var i;const{client:r}=this,{toSet:n}=t;if((i=r.features.eventBuffer)!==null&&i!==void 0&&i.enabled){if(n==="startDate"){const s=t.startDate.getTime()-t.originalStartDate.getTime();e.wrapStartDate=new Date(t.wrapStartDate.getTime()+s)}else if(n==="endDate"){const s=t.endDate.getTime()-t.originalEndDate.getTime();e.wrapEndDate=new Date(t.wrapEndDate.getTime()+s)}}e.set(n,t[n])}applyDateConstraints(e,t,i){var r,n;const s=(r=i.dateConstraints)===null||r===void 0?void 0:r.start,a=(n=i.dateConstraints)===null||n===void 0?void 0:n.end;return(s||a)&&(e=b.constrain(e,s,a),i.snappedDate=b.constrain(i.snappedDate,s,a)),e}moveDrag(e){const t=this,{client:i,tip:r}=t,n=t.dragLock==="x",s=n?"X":"Y",a=i.scheduledEventName,{visibleDateRange:o,enableEventAnimations:l,timeAxis:d,weekStartDay:u}=i,h=n&&i.rtl,{resolutionUnit:f,resolutionIncrement:g}=d,{event:m,context:p}=e,{eventRecord:v}=p,y=p.offset*(h?-1:1),{isOccurrence:C}=v,D=v.get("startDate"),w=v.get("endDate"),E=m[`client${s}`]+y,R=$.from(i.timeAxisSubGridElement,null,!0),x=R.getStart(h,n),k=R.getEnd(h,n);p.event=m,m.isScroll&&(e.date=i.getDateFromCoordinate(m[`page${s}`]+y,null,!1));let I,A,{date:L}=e,{toSet:O,otherEnd:_,draggingEnd:V}=p;h?E>x?L=e.date=o.startDate:E<k&&(L=e.date=o.endDate):E<x?L=e.date=o.startDate:E>k&&(L=e.date=o.endDate),O==="endDate"?L<D&&(I=-1):L>w&&(I=1),I&&t.onDragEndSwitch&&(t.onDragEndSwitch(p,L,I),_=p.otherEnd,O=p.toSet),i.snapRelativeToEventStartDate&&(L=d.roundDate(L,p.oldValue)),p.snappedDate=b.round(L,d.resolution,null,u);const Y=b.diff(L,p[_],f)*(V?-1:1);if(t.isEventDragCreate)p.tooNarrow=Y<g/2;else if(Y<g)if(t.allowResizeToZero)p.snappedDate=L=p[_];else{const J=_==="startDate"?1:-1;p.snappedDate=L=d.roundDate(b.add(v.get(_),g*J,f)),A=!0}if(L=t.applyDateConstraints(L,v,p),!p.date||L-p.date||A){if(p.date=L,p[O]=t.showExactResizePosition||i.timeAxisViewModel.snap?p.snappedDate:L,!(p[O]-p[O==="startDate"?"endDate":"startDate"])&&!t.allowResizeToZero){p.valid=!1;return}if(v.get(O)-p[O]){if(p.valid=t.checkValidity(p,m),p.message="",p.valid&&typeof p.valid!="boolean"&&(p.message=p.valid.message,p.valid=p.valid.valid),p.valid=p.valid!==!1,p.valid){const J={[`${a}Record`]:v,startDate:D,endDate:w,element:e.itemElement,context:p};J[O]=p[O],t.triggerEventPartialResize(`${a}PartialResize`,J),C&&v.stores.push(i.eventStore),i.enableEventAnimations=!1,this.resizeEventPartiallyInternal(v,p),i.enableEventAnimations=l,C&&(v.stores.length=0)}p.tooNarrow&&(p.valid=!1)}}r&&(r.align=hf[p.edge],r.alignTo(t.getTooltipTarget(e))),super.moveDrag(e)}dragEnd(e){const{context:t}=e;t&&(t.event=e.event),e.aborted?t?.finalize(!1):!this.isEventDragCreate&&!e.started&&!B.getPagePoint(e.event).equals(B.getPagePoint(e.startEvent))&&(this.dragStart(e),this.cleanup(e.context,!1))}async dragDrop({context:e,event:t}){var i;e[e.toSet]=e.snappedDate;const{client:r}=this,{startDate:n,endDate:s}=e;let a;(i=this.tip)===null||i===void 0||i.hide(),e.valid=n&&s&&(this.allowResizeToZero||s-n>0)&&e[e.toSet]-e.oldValue&&e.valid!==!1,e.valid&&(this.triggerBeforeEventResizeFinalize(`before${r.capitalizedEventName}ResizeFinalize`,{context:e,event:t,[`${r.scheduledEventName}Record`]:e.eventRecord}),a=!0),e.async||await e.finalize(a)}async finalize(e){const t=this.owner,i=this,{eventRecord:r,oldValue:n,toSet:s}=i,{snapRelativeToEventStartDate:a,timeAxis:o}=t.client;let l=!1;e?(a&&(i[s]=i.snappedDate=o.roundDate(i.date,n)),l=await t.internalUpdateRecord(i,r)):(t.cancelEventRecordBatch(r),r.isOccurrence&&r.resources.forEach(d=>t.client.repaintEventsForResource(d))),t.cleanup(i,l)}cleanup(e,t){var i;const r=this,{client:n}=r,{element:s,eventRecord:a}=e,o=n.scheduledEventName;a.meta.isResizing=!1,n.endListeningForBatchedUpdates(),(i=r.tip)===null||i===void 0||i.hide(),r.unHighlightHandle(s),n.element.classList.remove(...r.dragActiveCls.split(" ")),r.triggerEventResizeEnd(`${o}ResizeEnd`,F({changed:t,[`${o}Record`]:a},r.getResizeEndParams(e)))}async internalUpdateRecord(e,t){const{client:i}=this,{generation:r}=t;if(t.isOccurrence)i.endListeningForBatchedUpdates(),t[t.batching>1?"endBatch":"cancelBatch"](),t.set(Ct.prototype.inSetNormalize.call(t,{startDate:e.startDate,endDate:e.endDate}));else{const s={[e.toSet]:e[e.toSet]};if(t.isEntity){var n;const{startDate:a,endDate:o,draggingEnd:l}=e;e.duration=s.duration=t.run("calculateProjectedDuration",a,o),s[e.toSet]=t.run("calculateProjectedXDateWithDuration",l?a:o,l,e.duration);const d=!t[e.otherEnd];d&&(s[e.otherEnd]=e[e.otherEnd]),t.set(s),i.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(t),(n=i.features.eventBuffer)!==null&&n!==void 0&&n.enabled&&(t[e.wrapToSet]=null);const u=[];d&&u.push(t[e.setOtherMethod](s[e.otherEnd],!1)),u.push(t[e.setMethod](s[e.toSet],!1)),await Promise.all(u),t.endBatch()}else{const a=Object.assign({},t.meta.batchChanges);delete a[e.toSet],i.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(t),t.set(a),t[e.setMethod](s[e.toSet],!1)}}return await i.project.commitAsync(),t.generation!==r}onDragItemMouseMove(e){e.pointerType!=="touch"&&!this.handleSelector&&this.checkResizeHandles(e)}checkResizeHandles(e){const t=this,{overItem:i}=t;if(i&&!t.client.readOnly&&(!t.allowResize||t.allowResize(i,e))){const r=t.client.resolveTimeSpanRecord(i);if(r!=null&&r.readOnly)return;t.isOverAnyHandle(e,i)?t.highlightHandle():t.unHighlightHandle()}}onDragItemMouseLeave(e,t){this.unHighlightHandle(t)}highlightHandle(){var e,t;const{overItem:i,client:r}=this;((e=(t=i.syncIdMap)===null||t===void 0?void 0:t[r.scheduledEventName])!==null&&e!==void 0?e:i.querySelector(r.eventInnerSelector)).classList.add("b-resize-handle"),i.classList.add("b-over-resize-handle")}unHighlightHandle(e=this.overItem){if(e){var t,i;const r=this,n=(t=(i=e.syncIdMap)===null||i===void 0?void 0:i[r.client.scheduledEventName])!==null&&t!==void 0?t:e.querySelector(r.client.eventInnerSelector);n&&n.classList.remove("b-resize-handle",r.resizingItemInnerCls),e.classList.remove("b-over-resize-handle",r.draggingItemCls)}}isOverAnyHandle(e,t){return this.isOverStartHandle(e,t)||this.isOverEndHandle(e,t)}isOverStartHandle(e,t){var i;return(i=this.getHandleRect("start",e,t))===null||i===void 0?void 0:i.contains(B.getPagePoint(e))}isOverEndHandle(e,t){var i;return(i=this.getHandleRect("end",e,t))===null||i===void 0?void 0:i.contains(B.getPagePoint(e))}getHandleRect(e,t,i){if(this.overItem){if(i=t.target.closest(`.${this.client.eventCls}`)||i.querySelector(`.${this.client.eventCls}`),!i)return;const r=this,n=e==="start",{client:s}=r,a=Boolean(s.rtl),o=r.dragLock,l=o==="x",d=l?"width":"height",u=`${l?n&&!a?"left":"right":n?"top":"bottom"}Handle`,{offsetWidth:h}=i,f=s.resolveTimeSpanRecord(i),g=f?.isResizable,m=$.from(i),p=m.clone(),v=window.getComputedStyle(i,":before"),y=!r.handleSelector&&!K.isHoverableDevice?r.touchHandleSize:void 0,C=y||r.handleSize||parseFloat(v[d]),D=r.handleVisibilityThreshold||2*r.handleSize,w=r.dynamicHandleSize?r.reservedSpace/2:0,E=[0,0,0,0];if(!r.disabled&&r[u]&&(h>=D||r.dynamicHandleSize)&&(g===!0||g===e)&&(!l&&!n||l&&a===n?(p[o]+=m[d]-C,E[l?3:0]=m[d]/2+w):E[l?1:2]=m[d]/2+w,m.deflate(...E),p[d]=C,p.constrainTo(m),p[d]))return p}}setupDragContext(e){const t=this;if(t.overItem&&t.isOverAnyHandle(e,t.overItem)&&t.isElementResizable(t.overItem,e)){const i=super.setupDragContext(e);return i.scrollManager=t.client.scrollManager,i}}changeHandleSize(){ae.deprecate("Scheduler","6.0.0","Handle size is from CSS")}changeTouchHandleSize(){ae.deprecate("Scheduler","6.0.0","Handle size is from CSS")}changeTip(e,t){const i=this;if(!i.showTooltip)return null;if(e)e.isTooltip?e.owner=i:e=ce.reconfigure(t,ce.mergeConfigs({id:i.tipId},e,{getHtml:i.getTipHtml.bind(i),owner:i.client},i.tip),{owner:i,defaults:{type:"tooltip"}}),e.ion({innerhtmlupdate:"updateDateIndicator",thisObj:i}),i.clockTemplate=new rr({scheduler:i.client});else if(t){var r;t.destroy(),(r=i.clockTemplate)===null||r===void 0||r.destroy()}return e}isElementResizable(e,t){var i,r;const n=this,{client:s}=n,a=s.resolveTimeSpanRecord(e);if(s.readOnly)return!1;let o=a?.isResizable;const l=(i=(r=e)===null||r===void 0?void 0:r.syncIdMap[s.scheduledEventName])!==null&&i!==void 0?i:e,d=t.target.closest('[class$="-handle"]');if(!o||d&&d!==l||(e=t.target.closest(n.dragSelector),!e))return!1;const u=e.classList.contains("b-sch-event-startsoutside"),h=e.classList.contains("b-sch-event-endsoutside");if(o===!0){if(u&&h)return!1;if(u)o="end";else if(h)o="start";else return n.isOverStartHandle(t,e)||n.isOverEndHandle(t,e)}return u&&o==="start"||h&&o==="end"?!1:!!(n.isOverStartHandle(t,e)&&o==="start"||n.isOverEndHandle(t,e)&&o==="end")}updateDateIndicator(){const{clockTemplate:e}=this,{eventRecord:t,draggingEnd:i,snappedDate:r}=this.dragging.context,n=i?t.get("startDate"):r,s=i?r:t.get("endDate"),{element:a}=this.tip;e.updateDateIndicator(a.querySelector(".b-sch-tooltip-startdate"),n),e.updateDateIndicator(a.querySelector(".b-sch-tooltip-enddate"),s)}getTooltipTarget({itemElement:e,context:t}){const i=this,{rtl:r}=i.client,n=$.from(e,null,!0);return i.dragLock==="x"?(!r&&t.edge==="right"||r&&t.edge==="left"?n.x=n.right-1:n.x-=i.tip.anchorSize[0]/2,n.width=i.tip.anchorSize[0]/2):(t.edge==="bottom"&&(n.y=n.bottom-1),n.height=i.tip.anchorSize[1]/2),{target:n}}basicValidityCheck(e,t){return e.startDate&&(e.endDate>e.startDate||this.allowResizeToZero)&&this.validatorFn.call(this.validatorFnThisObj||this,e,t)}getTipHtml({tip:e}){const t=this,{startDate:i,endDate:r,toSet:n,snappedDate:s,valid:a,message:o="",timespanRecord:l}=t.dragging.context;if(!i||!r)return e.html;const d={record:l,valid:a,message:o,startDate:i,endDate:r,[n]:s};return d.startText=t.client.getFormattedDate(d.startDate),d.endText=t.client.getFormattedDate(d.endDate),d.startClockHtml=t.clockTemplate.template({date:d.startDate,text:d.startText,cls:"b-sch-tooltip-startdate"}),d.endClockHtml=t.clockTemplate.template({date:d.endDate,text:d.endText,cls:"b-sch-tooltip-enddate"}),t.tooltipTemplate(d)}beginEventRecordBatch(e){e.beginBatch()}cancelEventRecordBatch(e){e.cancelBatch()}getBeforeResizeParams(e){const{client:t}=this;return{resourceRecord:t.resolveResourceRecord(t.isVertical?e.event:e.element)}}getResizeStartParams(e){return{resourceRecord:e.resourceRecord}}getResizeEndParams(e){return{resourceRecord:e.resourceRecord,event:e.event}}setupProductResizeContext(e,t){var i,r,n;const{client:s}=this,{element:a}=e,o=s.resolveEventRecord(a),l=(i=s.resolveResourceRecord)===null||i===void 0?void 0:i.call(s,a),d=(r=s.resolveAssignmentRecord)===null||r===void 0?void 0:r.call(s,a);Object.assign(e,{eventRecord:o,taskRecord:o,resourceRecord:l,assignmentRecord:d,dateConstraints:(n=s.getDateConstraints)===null||n===void 0?void 0:n.call(s,l,o)})}checkValidity(e,t){return(this.client.allowOverlap||this.client.isDateRangeAvailable(e.startDate,e.endDate,e.eventRecord,e.resourceRecord))&&this.basicValidityCheck(e,t)}get tipId(){return`${this.client.id}-event-resize-tip`}}uo._$name="EventResize";G.registerFeature(uo,!0,"Scheduler");G.registerFeature(uo,!1,"ResourceHistogram");const GD=function(c){var e,t;return(e=this.source)!==null&&e!==void 0&&(t=e.client.features.taskEdit)!==null&&t!==void 0&&t._canceling?!1:B.getDistanceBetween(this.startEvent,c)};class ho extends uo{construct(e,t){t?.showTooltip===!1&&(t.tip=null),super.construct(...arguments)}changeValidatorFn(e){this.createValidatorFn=e}render(){const e=this,{client:t}=e;e.dragRootElement=e.dropRootElement=t.timeAxisSubGridElement,e.dragLock=t.isVertical?"y":"x"}onDragEndSwitch(e){const{client:t}=this,{enableEventAnimations:i}=t,{eventRecord:r,draggingEnd:n}=e,s=this.dragLock==="x",{initialDate:a}=this.dragging;t.enableEventAnimations=!1,r.set({startDate:a,endDate:a}),n?Object.assign(e,{endDate:a,toSet:"startDate",otherEnd:"endDate",setMethod:"setStartDate",setOtherMethod:"setEndDate",edge:s?"left":"top"}):Object.assign(e,{startDate:a,toSet:"endDate",otherEnd:"startDate",setMethod:"setEndDate",setOtherMethod:"setStartDate",edge:s?"right":"bottom"}),e.draggingEnd=this.draggingEnd=!n,t.enableEventAnimations=i}beforeDrag(e){const t=this,i=super.beforeDrag(e),{pan:r,eventDragSelect:n}=t.client.features;return i!==!1&&(t.preventMultiple&&!t.isRowEmpty(e.rowRecord)||t.disabled||r&&!r.disabled||n&&!n.disabled)?!1:i}startDrag(e){const t=super.startDrag(e);if(t!==!1){const{context:i}=e;e.initialDate=i.eventRecord.get(this.draggingEnd?"startDate":"endDate"),this.client.trigger("dragCreateStart",{proxyElement:e.element,eventElement:e.element,eventRecord:i.eventRecord,resourceRecord:i.resourceRecord}),e.context.offset=0,e.context.oldValue=e.mousedownDate}return t}isOverEndHandle(){return this.draggingEnd}setupDragContext(e){const{client:t}=this;if(t.matchScheduleCell(e.target)){var i;const r=(i=t.resolveResourceRecord(e))===null||i===void 0?void 0:i.$original;if(r&&!r.isSpecialRow){const n=Oa().prototype.setupDragContext.call(this,e),s=[];return t.isVertical?s.push({element:t.scrollable.element,direction:"vertical"}):s.push({element:t.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),n.scrollManager=t.scrollManager,n.monitoringConfig={scrollables:s},n.resourceRecord=n.rowRecord=r,n.getDistance=GD,n}}}async dragDrop({context:e,event:t}){var i;e[e.toSet]=e.snappedDate;const{client:r}=this,{startDate:n,endDate:s,eventRecord:a}=e,{generation:o}=a;let l;(i=this.tip)===null||i===void 0||i.hide(),await r.project.commitAsync(),a.generation!==o&&(e.eventRecord[e.toSet]=e.oldValue,e.eventRecord[e.toSet]=e[e.toSet]),e.valid=n&&s&&s-n>0&&e[e.toSet]-e.oldValue&&e.valid!==!1,e.valid&&(r.trigger("beforeDragCreateFinalize",{context:e,event:t,proxyElement:e.element,eventElement:e.element,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord}),l=!0),e.async||await e.finalize(l)}updateDragTolerance(e){this.dragThreshold=e}changeTip(e,t){return super.changeTip(!e||e.isTooltip?e:T.assign({id:`${this.client.id}-drag-create-tip`},e),t)}async finalize(e){const t=this.owner,i=this,r=()=>{t.isDestroyed||(t.client.trigger("afterDragCreate",{proxyElement:i.element,eventElement:i.element,eventRecord:i.eventRecord,resourceRecord:i.resourceRecord}),t.cleanup(i))};if(e)await t.finalizeDragCreate(i),r();else{var n;(n=t.onAborted)===null||n===void 0||n.call(t,i),r()}}async finalizeDragCreate(e){var t;await this.internalUpdateRecord(e,e.eventRecord),this.client.trigger("dragCreateEnd",{eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,event:e.event,eventElement:e.element}),(t=this.client)===null||t===void 0||t.trigger("eventAutoCreated",{eventRecord:e.eventRecord,resourceRecord:e.resourceRecord})}cleanup(e){var t;const{client:i}=this,{eventRecord:r}=e;r.meta.isResizing=!1,i.endListeningForBatchedUpdates(),(t=this.tip)===null||t===void 0||t.hide(),i.element.classList.remove(...this.dragActiveCls.split(" ")),e.element.parentElement.classList.remove("b-sch-dragcreating")}onElementContextMenu(){if(this.proxy)return!1}prepareCreateContextForFinalization(e,t,i,r=!1){return F(F({},e),{},{async:r,event:t,finalize:i})}onEventDataGenerated(e){var t,i;((t=this.dragging)===null||t===void 0||(i=t.context)===null||i===void 0?void 0:i.eventRecord)===e.eventRecord&&(e.wrapperCls["b-sch-dragcreating"]=!0,e.wrapperCls["b-too-narrow"]=this.dragging.context.tooNarrow)}triggerBeforeResize(){}triggerEventResizeStart(){}checkValidity(e,t){throw new Error("Implement in subclass")}triggerDragCreateEnd(e,t){throw new Error("Implement in subclass")}handleBeforeDragCreate(e,t){throw new Error("Implement in subclass")}isRowEmpty(e){throw new Error("Implement in subclass")}}M(ho,"configurable",{showTooltip:!0,dragTolerance:2,preventMultiple:!1,dragTouchStartDelay:300,validatorFnThisObj:null,tipTemplate:c=>`
            <div class="b-sch-tip-${c.valid?"valid":"invalid"}">
                ${c.startClockHtml}
                ${c.endClockHtml}
                <div class="b-sch-tip-message">${c.message}</div>
            </div>
        `,dragActiveCls:"b-dragcreating"});M(ho,"pluginConfig",{chain:["render","onEventDataGenerated"],before:["onElementContextMenu"]});ho._$name="DragCreateBase";const $i=b,qD=["startDate","endDate","resource","recurrenceRule"],ff=c=>{if(c.length===1)return c[0].value;if(c.length===2){const[e,t]=c[0]instanceof ad?c:c.reverse(),i=$i.parse(e.value);return i&&t.value&&i.setHours(t.value.getHours(),t.value.getMinutes(),t.value.getSeconds(),t.value.getMilliseconds()),i?b.clone(i):null}return null},KD=(c,e)=>{const t=new Date(c.getTime());return t.setHours(e.getHours(),e.getMinutes()),t},xl=(c,e,t)=>{if(c&&e&&t.endDateField&&t.endTimeField){const i=$i.add(KD(t.startDateField.value,t.startTimeField.value),t.eventRecord.durationMS,"milliseconds");t.endDateField.value=i,t.endTimeField.value=$i.clone(i)}};class rp extends te{static get configurable(){return{saveAndCloseOnEnter:!0,triggerEvent:null,dateFormat:"L",timeFormat:"LT",editorConfig:null,items:null,weekStartDay:null}}construct(e,t){const i=this;e.eventEdit=i,super.construct(e,T.assign({weekStartDay:e.weekStartDay},t)),i.clientListenersDetacher=e.ion({[i.triggerEvent]:"onActivateEditor",dragCreateEnd:"onDragCreateEnd",eventAutoCreated:"onEventAutoCreated",thisObj:i})}doDestroy(){var e;this.clientListenersDetacher(),(e=this._editor)===null||e===void 0||e.destroy(),super.doDestroy()}onEventAutoCreated(){}changeEditorConfig(e){const{items:t}=this;return t&&(e=U.clone(e),e.items=pe.merge(t,e.items)),e}changeItems(e){return this.cleanItemsConfig(e),e}cleanItemsConfig(e){for(const t in e){const i=e[t];i===!0?delete e[t]:i!=null&&i.items&&this.cleanItemsConfig(i.items)}}onDatesChange(e){var t,i;const r=this,n=e.source,s=e.value;if(r.startDateField&&r.endDateField&&(r.endDateField.min=r.startDateField.value),r.endTimeField){var a,o;$i.isEqual($i.clearTime((a=r.startDateField)===null||a===void 0?void 0:a.value),$i.clearTime((o=r.endDateField)===null||o===void 0?void 0:o.value))?r.endTimeField.min=r.startTimeField.value:r.endTimeField.min=null}switch(n.ref){case"startDateField":!((t=r.startTimeField)===null||t===void 0)&&t.value&&xl(s,r.startTimeField.value,r);break;case"startTimeField":!((i=r.startDateField)===null||i===void 0)&&i.value&&xl(r.startDateField.value,s,r);break}}async save(){throw new Error("Implement in subclass")}get values(){const e=this,{editor:t}=e,i=[],r=[],{values:n}=t;return qD.forEach(s=>delete n[s]),t.eachWidget(s=>{var a;const{name:o}=s;if(!o||s.hidden||s.up(l=>l===e.recurrenceEditor)){delete n[o];return}switch(o){case"startDate":i.push(s);break;case"endDate":r.push(s);break;case"resource":n[o]=s.record;break;case"recurrenceRule":n[o]=((a=t.widgetMap.recurrenceCombo)===null||a===void 0?void 0:a.value)==="none"?"":s.value;break}},!0),n.allDay&&!e.eventRecord.allDay&&(i.push(e.startTimeField),r.push(e.endTimeField)),i.length&&(n.startDate=ff(i)),r.length&&(n.endDate=ff(r)),"startDate"in n&&"endDate"in n&&(n.duration=$i.diff(n.startDate,n.endDate,e.editor.record.durationUnit,!0)),n}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:t}=this;return this.assignmentStore&&delete t.resource,e.set(t)}onBeforeEditorShow(){const{eventRecord:e,editor:t}=this.editingContext,{nameField:i}=t.widgetMap;i&&e.isCreating&&(t.assigningValues=!0,i.value="",t.assigningValues=!1,i._configuredPlaceholder=i.placeholder,i.placeholder=e.name)}resetEditingContext(){const e=this;if(!e.editingContext)return;const{client:t}=e,{editor:i,eventRecord:r}=e.editingContext,{eventStore:n}=t,{nameField:s}=i.widgetMap;if(r.isCreating){if(t.isTimelineBase){var a;(a=e.editingContext.eventElement)===null||a===void 0||a.closest("[data-event-id]").classList.add("b-released")}n.remove(r),r.isCreating=!1}s&&(s.placeholder=s._configuredPlaceholder),t.element.classList.remove("b-eventeditor-editing"),e.targetEventElement=e.editingContext=i._record=null}onPopupKeyDown({event:e}){const t=this;!t.readOnly&&e.key==="Enter"&&t.saveAndCloseOnEnter&&e.target.tagName.toLowerCase()==="input"&&(e.preventDefault(),e.target.name==="startDate"&&t.startTimeField&&xl(t.startDateField.value,t.startTimeField.value,t),t.onSaveClick())}async onSaveClick(){this.editor.focus();const e=await this.save();return e&&(this.editor.close(),this.client.trigger("afterEventEdit")),e}async onDeleteClick(){if(await this.deleteEvent()){const{editor:t}=this;(!t.autoClose||t.containsFocus)&&t.close(),this.client.trigger("afterEventEdit")}}onCancelClick(){this.editor.close(),this.client.trigger("afterEventEdit")}}rp._$name="EditBase";class fo extends te.mixin(Mi){static get pluginConfig(){return{chain:["getEventsToRender","onEventDataGenerated","noFeatureElementsInAxis"],override:["resolveResourceRecord"]}}noFeatureElementsInAxis(){const{timeAxis:e}=this.client;return!this.needsRefresh&&this.store&&!this.store.storage.values.some(t=>e.isTimeSpanInAxis(t))}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}updateTabIndex(){this.isConfiguring||this.client.refresh()}getEventsToRender(e,t){throw new Error("Implement in subclass")}onEventDataGenerated(e){const t=this,{eventRecord:i,iconCls:r}=e;t.shouldInclude(i)&&(t.client.isVertical?e.width=e.resourceRecord.columnWidth||t.client.resourceColumnWidth:e.top=0,e.fillSize=!0,e.wrapperCls[t.rangeCls]=1,e.wrapperCls[`b-sch-color-${i.timeRangeColor}`]=i.timeRangeColor,e.eventContent.text=i.name,e.children.push(e.eventContent),e.tabIndex=t.tabIndex!=null?String(t.tabIndex):null,r?.length>0&&e.children.unshift({tag:"i",className:r.toString()}),e.eventId=t.generateElementId(i))}generateElementId(e){return e.domId}resolveResourceTimeRangeRecord(e){var t;return e==null||(t=e.closest(`.${this.rangeCls}`))===null||t===void 0?void 0:t.elementData.eventRecord}getElementFromResourceTimeRangeRecord(e){return this.client.foregroundCanvas.syncIdMap[e.domId]}resolveResourceRecord(e){var t;return this.overridden.resolveResourceRecord(...arguments)||((t=this.resolveResourceTimeRangeRecord(e.target||e))===null||t===void 0?void 0:t.resource)}shouldInclude(e){throw new Error("Implement in subclass")}onStoreChange(e){(e.action==="removeall"||e.action==="dataset")&&(this.needsRefresh=!0),this.client.onInternalEventStoreChange(e),this.needsRefresh=!1}}M(fo,"configurable",{tabIndex:null});fo.featureClass="";fo._$name="ResourceTimeRangesBase";class zd extends Aa{}zd._$name="TimeSpanMenuBase";class np extends te{static get defaultConfig(){return{autoUpdate:!1,hoverDelay:250,hideDelay:100,template:null,cls:null,align:{align:"b-t"},clockTemplate:null,monitorRecordUpdate:null,testConfig:{hoverDelay:0}}}static get pluginConfig(){return{chain:["onPaint"]}}construct(e,t){const i=this;t=i.processConfig(t),super.construct(e,t),i.forSelector||(i.forSelector=`${e.eventInnerSelector}:not(.b-dragproxy)`),i.clockTemplate=new rr({scheduler:e}),e.ion({[`before${e.scheduledEventName}drag`]:()=>{var r;(r=i.tooltip)===null||r===void 0||r.hide()}})}processConfig(e){return typeof e=="function"?{template:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.destroyProperties("clockTemplate","tooltip"),super.doDestroy()}doDisable(e){this.tooltip&&(this.tooltip.disabled=e),super.doDisable(e)}onPaint({firstPaint:e}){if(e){var t;const i=this,{client:r}=i,n=[".b-dragselecting",".b-eventeditor-editing",".b-taskeditor-editing",".b-resizing-event",".b-task-percent-bar-resizing-task",".b-dragcreating",`.b-dragging-${r.scheduledEventName}`,".b-creating-dependency",".b-dragproxy"].map(s=>`:not(${s})`).join("");(t=i.tooltip)===null||t===void 0||t.destroy(),i.tooltip=new ce(F(F({axisLock:"flexible",id:i.tipId||`${i.client.id}-event-tip`,cls:i.tipCls,forSelector:`.b-timelinebase${n} .b-grid-body-container:not(.b-scrolling) ${i.forSelector}`,scrollAction:"realign",forElement:r.timeAxisSubGridElement,showOnHover:!0,anchorToTarget:!0,getHtml:i.getTipHtml.bind(i),disabled:i.disabled},i.config),{},{internalListeners:i.configuredListeners})),i.tooltip.ion({innerhtmlupdate:"updateDateIndicator",overtarget:"onOverNewTarget",show:"onTipShow",hide:"onTipHide",thisObj:i})}}processConfiguredListeners(){}addListener(...e){var t;const i=super.addListener(...e),r=(t=this.tooltip)===null||t===void 0?void 0:t.addListener(...e);if(i||r)return()=>{i?.(),r?.()}}removeListener(...e){var t;super.removeListener(...e),(t=this.tooltip)===null||t===void 0||t.removeListener(...e)}updateDateIndicator(){const e=this,t=e.tooltip,i=t.element.querySelector(".b-sch-tooltip-enddate");!e.record||(e.clockTemplate.updateDateIndicator(t.element,e.record.startDate),i&&e.clockTemplate.updateDateIndicator(i,e.record.endDate))}resolveTimeSpanRecord(e){return this.client.resolveTimeSpanRecord(e)}getTipHtml({tip:e,activeTarget:t}){const i=this,{client:r}=i,n=i.recordType||`${r.scheduledEventName}Record`,s=i.resolveTimeSpanRecord(t);if(s?.startDate instanceof Date){const{startDate:a,endDate:o}=s,l=r.getFormattedDate(a),d=r.getDisplayEndDate(o,a),u=r.getFormattedDate(d);return e.eventRecord=s,i.template({tip:e,[`${n}`]:s,startDate:a,endDate:o,startText:l,endText:u,startClockHtml:i.clockTemplate.template({date:a,text:l,cls:"b-sch-tooltip-startdate"}),endClockHtml:s.isMilestone?"":i.clockTemplate.template({date:d,text:u,cls:"b-sch-tooltip-enddate"})})}else return e.hide(),""}get record(){return this.tooltip.eventRecord}onTipShow(){const e=this;e.monitorRecordUpdate&&!e.updateListener&&(e.updateListener=e.client.eventStore.ion({update:e.onRecordUpdate,thisObj:e}))}onTipHide(){var e;this.tooltip.eventRecord=null,(e=this.updateListener)===null||e===void 0||e.call(this),this.updateListener=null}onOverNewTarget({newTarget:e}){this.tooltip.eventRecord=this.resolveTimeSpanRecord(e)}onRecordUpdate({record:e}){e===this.record&&(this.tooltip.alignTo(),this.tooltip.updateContent())}}np._$name="TooltipBase";class Xr extends te.mixin(he){static get defaultConfig(){return{rangeCls:"b-sch-range",lineCls:"b-sch-line",enableResizing:!1,showTooltip:!0,tooltipTemplate:null,dragTipTemplate:e=>`
                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">
                    <div class="b-sch-tip-name">${z.encodeHtml(e.name)||""}</div>
                    ${e.startClockHtml}
                    ${e.endClockHtml||""}
                </div>
            `,baseCls:"b-sch-timerange",headerRenderer:null,bodyRenderer:null,cls:null,narrowThreshold:80}}construct(e,t){const i=this;super.construct(e,t),e.isVertical&&e.ion({renderRows:i.onUIReady,thisObj:i,once:!0}),i.cls=i.cls||`b-sch-${i.constructor.$$name.toLowerCase()}`,i.baseSelector=`.${i.baseCls}.${i.cls}`,i.enableResizing&&(i.showHeaderElements=!0)}doDestroy(){var e,t,i,r;const n=this;n.detachListeners("timeAxisViewModel"),n.detachListeners("timeAxis"),(e=n.clockTemplate)===null||e===void 0||e.destroy(),(t=n.tip)===null||t===void 0||t.destroy(),(i=n.drag)===null||i===void 0||i.destroy(),(r=n.resize)===null||r===void 0||r.destroy(),super.doDestroy()}doDisable(e){this.renderRanges(),super.doDisable(e)}setupTimeAxisViewModelListeners(){const e=this;e.detachListeners("timeAxisViewModel"),e.detachListeners("timeAxis"),e.client.timeAxisViewModel.ion({name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",thisObj:e}),e.client.timeAxis.ion({name:"timeAxis",includeChange:"renderRanges",thisObj:e})}onUIReady(){const e=this,{client:t}=e;t.ion({timeAxisViewModelChange:e.setupTimeAxisViewModelListeners,thisObj:e}),e.setupTimeAxisViewModelListeners(),t.hideHeaders||(e.headerContainerElement&&B.on({click:e.onTimeRangeClick,dblclick:e.onTimeRangeClick,contextmenu:e.onTimeRangeClick,delegate:e.baseSelector,element:e.headerContainerElement,thisObj:e}),e.enableResizing&&(e.drag=Yn.new({name:"rangeDrag",lockX:t.isVertical,lockY:t.isHorizontal,constrain:!0,outerElement:e.headerContainerElement,targetSelector:`${e.baseSelector}`,isElementDraggable:(i,r)=>!t.readOnly&&e.isElementDraggable(i,r),rtlSource:t,internalListeners:{dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",reset:"onDragReset",abort:"onInvalidDrop",thisObj:e}},e.dragHelperConfig),e.resize=La.new({direction:t.mode,targetSelector:`${e.baseSelector}.b-sch-range`,outerElement:e.headerContainerElement,isElementResizable:i=>!i.matches(".b-dragging,.b-readonly"),internalListeners:{resizestart:"onResizeStart",resizing:"onResizeDrag",resize:"onResize",cancel:"onInvalidResize",reset:"onResizeReset",thisObj:e}},e.resizeHelperConfig))),e.renderRanges(),e.tooltipTemplate&&(e.hoverTooltip=new ce({forElement:e.headerContainerElement,getHtml({activeTarget:i}){const r=e.resolveTimeRangeRecord(i);return e.tooltipTemplate({timeRange:r})},forSelector:"."+e.baseCls+(e.cls?"."+e.cls:"")}))}refresh(){this._timeRanges=null,this.renderRanges()}getDOMConfig(e,t){const i=this,r=[],n=[];if(!i.disabled){i._labelRotationMap={};for(const s of i.timeRanges){const a=i.renderRange(s,e,t);a&&(r.push(a.bodyConfig),n.push(a.headerConfig))}}return[r,n]}renderRanges(){const e=this,{foregroundCanvas:t}=e.client;if(t&&e.client.isPainted){const{headerContainerElement:i}=e,r=[],[n,s]=e.getDOMConfig();e.bodyCanvas||(e.bodyCanvas=S.createElement({className:`b-timeranges-canvas ${e.cls}-canvas`,parent:t,retainElement:!0})),Z.sync({targetElement:e.bodyCanvas,childrenOnly:!0,domConfig:{children:n,syncOptions:{releaseThreshold:0,syncIdField:"id"}},callback:e.showHeaderElements?null:({targetElement:a,action:o})=>{(o==="reuseElement"||o==="newElement"||o==="reuseOwnElement")&&r.push(a)}}),e.showHeaderElements&&!e.headerCanvas&&(e.headerCanvas=S.createElement({className:`${e.cls}-canvas`,parent:i,retainElement:!0})),e.headerCanvas&&Z.sync({targetElement:e.headerCanvas,childrenOnly:!0,domConfig:{children:s,syncOptions:{releaseThreshold:0,syncIdField:"id"}}});for(const a of r)e.cacheRotation(a.elementData.timeRange,a);for(const a of r)e.applyRotation(a.elementData.timeRange,a)}}get timeRanges(){return[]}shouldRenderRange(e,t=this.client.visibleDateRange.startDate,i=this.client.visibleDateRange.endDate){const{timeAxis:r}=this.client,{startDate:n,endDate:s,duration:a}=e;return Boolean(n&&(!r.isFiltered||r.isTimeSpanInAxis(e))&&b.intersectSpans(t,i,n,a?s:b.add(n,this._lineBufferDurationMS)))}getRangeDomConfig(e,t,i,r=0){const n=this,{client:s}=n,{rtl:a}=s,o=s.getCoordinateFromDate(b.max(e.startDate,t),{respectExclusion:!0})-r,l=e.endDate?s.getCoordinateFromDate(b.min(e.endDate,i),{respectExclusion:!0,isEnd:!0})-r:o,d=Math.abs(l-o),u=d>0,h=a?`calc(${o}px - 100%)`:`${o}px`;return{className:{[n.baseCls]:1,[n.cls]:n.cls,[n.rangeCls]:u,[n.lineCls]:!u,[e.cls]:e.cls,"b-narrow-range":u&&d<n.narrowThreshold,"b-readonly":e.readOnly,"b-rtl":a},dataset:{id:e.id},elementData:{timeRange:e},style:s.isVertical?`transform: translateY(${h}); ${u?`height:${d}px`:""};`:`transform: translateX(${h}); ${u?`width:${d}px`:""};`}}renderRange(e,t,i){const r=this,{client:n}=r,{timeAxis:s}=n;if(r.shouldRenderRange(e,t,i)&&s.startDate){const a=r.getRangeDomConfig(e,s.startDate,s.endDate),o=e.iconCls&&z.xss`<i class="${e.iconCls}"></i>`,l=e.name&&z.encodeHtml(e.name),d=l||o?`<label>${o||""}${l||"&nbsp;"}</label>`:"",u=F(F({},a),{},{style:a.style+(e.style||""),html:r.bodyRenderer?r.bodyRenderer({timeRange:e}):r.showHeaderElements&&!r.showLabelInBody?"":d});let h;return r.showHeaderElements&&(h=F(F({},a),{},{html:r.headerRenderer?r.headerRenderer({timeRange:e}):r.showLabelInBody?"":d})),{bodyConfig:u,headerConfig:h}}}cacheRotation(e,t){if(!e.iconCls&&!e.name||!e.duration)return;const i=t.firstElementChild;i&&!e.recurringTimeSpan&&(this._labelRotationMap[e.id]=this.client.isVertical?i.offsetHeight<t.offsetHeight:i.offsetWidth>t.offsetWidth)}applyRotation(e,t){var i,r,n;const s=this._labelRotationMap[(i=(r=e.recurringTimeSpan)===null||r===void 0?void 0:r.id)!==null&&i!==void 0?i:e.id];(n=t.firstElementChild)===null||n===void 0||n.classList.toggle("b-vertical",Boolean(s))}getBodyElementByRecord(e){const t=typeof e=="string"?e:e?.id;return t!=null&&Z.getChild(this.bodyCanvas,t)}resolveTimeRangeRecord(e){}get headerContainerElement(){const e=this,{isVertical:t,timeView:i,timeAxisColumn:r}=e.client;return e._headerContainerElement||(t&&i.element?e._headerContainerElement=i.element.parentElement:t||(e._headerContainerElement=r.element)),e._headerContainerElement}get showHeaderElements(){return!this.client.hideHeaders&&this._showHeaderElements}updateShowHeaderElements(e){const{client:t}=this;this.isConfiguring||(t.element.classList.toggle("b-sch-timeranges-with-headerelements",Boolean(e)),this.renderRanges())}populateTimeAxisHeaderMenu({column:e,items:t}){}onPaint({firstPaint:e}){e&&this.client.isHorizontal&&this.onUIReady()}onSchedulerHorizontalScroll(){this.client.isHorizontal&&this.renderRanges()}afterScroll(){this.client.isVertical&&this.renderRanges()}onInternalResize(e,t,i,r,n){this.client.isVertical&&n!==i&&this.renderRanges()}onTimeAxisViewModelUpdate({source:e}){this._lineBufferDurationMS=e.getDateFromPosition(50)-e.getDateFromPosition(0),this.refresh()}onTimeRangeClick(e){const t=this.resolveTimeRangeRecord(e.target);this.client.trigger(`timeRangeHeader${z.capitalize(e.type)}`,{event:e,timeRangeRecord:t})}showTip(e){const t=this;t.showTooltip&&(t.clockTemplate=new rr({scheduler:t.client}),t.tip=new ce(T.assign({id:`${t.client.id}-time-range-tip`,cls:"b-interaction-tooltip",align:"b-t",autoShow:!0,updateContentOnMouseMove:!0,forElement:e.element,getHtml:()=>t.getTipHtml(e.record,e.element)},t.showTooltip)))}destroyTip(){this.tip&&(this.tip.destroy(),this.tip=null)}isElementDraggable(e){return e=e.closest(this.baseSelector+":not(.b-resizing):not(.b-readonly)"),e&&!e.classList.contains("b-over-resize-handle")}onDragStart({context:e}){const{client:t,drag:i}=this;t.isVertical?(i.minY=0,i.maxY=t.timeAxisViewModel.totalSize-e.element.offsetHeight,i.minX=0,i.maxX=Number.MAX_SAFE_INTEGER):(i.minX=0,i.maxX=t.timeAxisViewModel.totalSize-e.element.offsetWidth,i.minY=0,i.maxY=Number.MAX_SAFE_INTEGER),t.element.classList.add("b-dragging-timerange")}onDrop({context:e}){this.client.element.classList.remove("b-dragging-timerange")}onInvalidDrop(){this.drag.reset(),this.client.element.classList.remove("b-dragging-timerange"),this.destroyTip()}onDrag(){}onDragReset(){}onResizeStart(){}onResizeDrag(){}onResize(){}onInvalidResize(){}onResizeReset(){}getTipHtml(e,t){const i=this,{client:r}=i,n=$.from(t),s=n.getStart(r.rtl,r.isHorizontal),a=n.getEnd(r.rtl,r.isHorizontal),o=r.getDateFromCoordinate(s,"round",!1),l=e.endDate&&r.getDateFromCoordinate(a,"round",!1),d=r.getFormattedDate(o),u=l&&r.getFormattedEndDate(l,o);return i.dragTipTemplate({name:e.name||"",startDate:o,endDate:l,startText:d,endText:u,startClockHtml:i.clockTemplate.template({date:o,text:d,cls:"b-sch-tooltip-startdate"}),endClockHtml:u&&i.clockTemplate.template({date:l,text:u,cls:"b-sch-tooltip-enddate"})})}}M(Xr,"configurable",{showHeaderElements:!0});M(Xr,"pluginConfig",{chain:["onPaint","populateTimeAxisHeaderMenu","onSchedulerHorizontalScroll","afterScroll","onInternalResize"]});Xr._$name="AbstractTimeRanges";const XD=Object.freeze({});class sp extends he(te){static get $name(){return"ColumnLines"}static get delayable(){return{refresh:{type:"raf",cancelOutstanding:!0}}}static get pluginConfig(){return{after:["render","updateCanvasSize","onVisibleDateRangeChange","onVisibleResourceRangeChange"]}}construct(e,t){e.useBackgroundCanvas=!0,super.construct(e,t)}doDisable(e){super.doDisable(e),this.isConfiguring||this.refresh()}render(){this.refresh()}getColumnLinesDOMConfig(e,t){const i=this,{client:r}=i,{rtl:n}=r,s=n?-1:1,{timeAxisViewModel:a,isHorizontal:o,resourceStore:l,variableColumnWidths:d}=r,{columnConfig:u}=a,h=a.columnLinesFor,f=Math.max(h-1,0),g=e.getTime(),m=t.getTime(),p=[],v=new Set,y=o?"X":"Y";if(!i.disabled){const C=(D,w)=>{const E=D.start.getTime();E>g&&E<m&&!v.has(E)&&(v.add(E),p.push({role:"presentation",className:w?"b-column-line-major":"b-column-line",style:{transform:`translate${y}(${D.coord*s}px)`},dataset:{line:w?`major-${D.index}`:`line-${D.index}`}}))};if(h!==f)for(let D=1;D<=u[f].length-1;D++)C(u[f][D],!0);for(let D=1;D<=u[h].length-1;D++)C(u[h][D],!1);if(!o&&r.columnLines){const{columnWidth:D}=r.resourceColumns,{first:w,last:E}=r.currentOrientation.getResourceRange(!0);if(w>-1)for(let R=w;R<E+1;R++){const x=l.getAt(R),k=x.instanceMeta(r),I=d?k.insetStart+x.columnWidth-1:(R+1)*D-1;p.push({className:"b-column-line b-resource-column-line",style:{transform:`translateX(${I*s}px)`},dataset:{line:`resource-${R}`}})}}}return p}refresh(){const e=this,{client:t}=e,{timeAxis:i}=t,{startDate:r,endDate:n}=t.visibleDateRange||XD;if(!i.startDate||!r)return;e.element||(e.element=S.createElement({parent:t.backgroundCanvas,className:"b-column-lines-canvas"}));const a=e.getColumnLinesDOMConfig(r,n);Z.sync({targetElement:e.element,onlyChildren:!0,domConfig:{children:a,syncOptions:{releaseThreshold:4}},syncIdField:"line"})}onVisibleDateRangeChange(){this.refresh()}onVisibleResourceRangeChange({firstResource:e,lastResource:t}){this.refresh()}updateCanvasSize(){this.refresh()}}sp._$name="ColumnLines";G.registerFeature(sp,!0,["Scheduler","Gantt"]);var ZD=c=>class extends(c||P){static get $name(){return"DependencyCreation"}static get defaultConfig(){return{allowDropOnEventBar:!0,showCreationTooltip:!0,creationTooltip:null,terminalCls:"b-sch-terminal",terminalSides:["start","top","end","bottom"],allowCreate:!0}}construct(t,i){super.construct(t,i);const r=this;r.view=t,r.eventName=t.scheduledEventName,t.ion({readOnly:()=>r.updateCreateListeners()}),r.updateCreateListeners(),r.chain(t,"onElementTouchMove","onElementTouchMove")}doDestroy(){var t,i;const r=this;r.detachListeners("view"),r.creationData=null,(t=r.pointerUpMoveDetacher)===null||t===void 0||t.call(r),(i=r.creationTooltip)===null||i===void 0||i.destroy(),super.doDestroy()}updateCreateListeners(){const t=this;!t.view||(t.detachListeners("view"),t.isCreateAllowed&&t.view.ion({name:"view",[`${t.eventName}mouseenter`]:"onTimeSpanMouseEnter",[`${t.eventName}mouseleave`]:"onTimeSpanMouseLeave",thisObj:t}))}set allowCreate(t){this._allowCreate=t,this.updateCreateListeners()}get allowCreate(){return this._allowCreate}get isCreateAllowed(){return this.allowCreate&&!this.view.readOnly&&!this.disabled}onTimeSpanMouseEnter({event:t,source:i,[`${this.eventName}Record`]:r,[`${this.eventName}Element`]:n}){if(!r.isCreating&&!r.readOnly&&(!this.client.features.nestedEvents||r.parent.isRoot)){const s=this,{creationData:a}=s,o=S.down(n,i.eventInnerSelector);r!==a?.source&&(s.showTerminals(r,o),a&&t.target.closest(s.client.eventSelector)&&(a.timeSpanElement=o,s.onOverTargetEventBar(t)))}}onTimeSpanMouseLeave(t){var i;const r=this,{creationData:n}=r,s=t[`${r.eventName}Element`],a=S.down(s,r.view.eventInnerSelector),o=(i=t.event)===null||i===void 0?void 0:i.relatedTarget,l=n?.timeSpanElement;!o||((!n||!l||!o||!S.isDescendant(l,o))&&(t.event.isTrusted||a!==n?.sourceElement)&&r.hideTerminals(s),n&&!n.finalizing&&(n.timeSpanElement=null,r.onOverNewTargetWhileCreating(void 0,void 0,t)))}onTerminalMouseOver(t){this.creationData&&this.onOverTargetEventBar(t)}onTerminalMouseOut(t){const i=this,{creationData:r}=i,n=t.target.closest(i.view.eventSelector);n&&(!i.showingTerminalsFor||!S.isDescendant(n,i.showingTerminalsFor))&&(!r||n!==r.timeSpanElement)&&(i.hideTerminals(n),i.view.unhover(n,t)),r&&i.onOverNewTargetWhileCreating(t.relatedTarget,r.target,t)}onTerminalPointerDown(t){const i=this;if(t.button===0&&!i.creationData){var r;const n=i.view,s=n.timeAxisSubGridElement,a=t.target,o=a.closest(n.eventInnerSelector),l=$.from(n.element,document.body);t.stopPropagation(),i.creationData={sourceElement:o,source:n.resolveTimeSpanRecord(o).$original,fromSide:a.dataset.side,startPoint:$.from(a,s).center,startX:t.pageX-l.x+n.scrollLeft,startY:t.pageY-l.y+n.scrollTop,valid:!1,sourceResource:(r=n.resolveResourceRecord)===null||r===void 0?void 0:r.call(n,t),tooltip:i.creationTooltip},i.pointerUpMoveDetacher=B.on({pointerup:{element:n.element.getRootNode(),handler:"onMouseUp",passive:!1},pointermove:{element:s,handler:"onMouseMove",passive:!1},thisObj:i}),i.documentPointerUpDetacher=B.on({pointerup:{element:document,handler:"onDocumentMouseUp"},keydown:{element:document,handler:({key:d})=>{d==="Escape"&&i.abort()}},thisObj:i})}}onElementTouchMove(t){var i;(i=super.onElementTouchMove)===null||i===void 0||i.call(this,t),this.connector&&t.preventDefault()}onMouseMove(t){const i=this,{view:r,creationData:n}=i,s=$.from(r.element,document.body),a=t.pageX-s.x+r.scrollLeft-n.startX,o=t.pageY-s.y+r.scrollTop-n.startY,l=Math.round(Math.sqrt(a*a+o*o))-3,d=Math.atan2(o,a);let{connector:u}=i;if(!u){if(i.onRequestDragCreate(t)===!1)return;u=i.connector}u.style.width=`${l}px`,u.style.transform=`rotate(${d}rad)`,i.lastMouseMoveEvent=t}onRequestDragCreate(t){const i=this,{view:r,creationData:n}=i;if(r.trigger("beforeDependencyCreateDrag",{data:n,source:n.source})===!1)return i.abort(),!1;if(r.element.classList.add("b-creating-dependency"),i.createConnector(n.startPoint.x,n.startPoint.y),r.trigger("dependencyCreateDragStart",{data:n,source:n.source}),i.showCreationTooltip){const s=i.creationTooltip||(i.creationTooltip=i.createDragTooltip());i.creationData.tooltip=s,s.disabled=!1,s.show(),s.onMouseMove(t)}r.scrollManager.startMonitoring({scrollables:[{element:r.timeAxisSubGrid.scrollable.element,direction:"horizontal"},{element:r.scrollable.element,direction:"vertical"}],callback:()=>i.lastMouseMoveEvent&&i.onMouseMove(i.lastMouseMoveEvent)})}onOverTargetEventBar(t){var i;const r=this,{view:n,creationData:s,allowDropOnEventBar:a}=r,{target:o}=t;let l=n.resolveTimeSpanRecord(o).$original;(i=l)!==null&&i!==void 0&&i.isEventSegment&&(l=l.event),!(U.isPromise(s.valid)||!a&&!o.classList.contains(r.terminalCls))&&l!==s.source&&r.onOverNewTargetWhileCreating(o,l,t)}async onOverNewTargetWhileCreating(t,i,r){const n=this,{view:s,creationData:a,allowDropOnEventBar:o,connector:l}=n;if(!U.isPromise(a.valid)&&!a.finalizing&&!!l){if(l.classList.remove("b-valid","b-invalid"),a.timeSpanElement&&S.removeClsGlobally(a.timeSpanElement,"b-sch-terminal-active"),!i||i===a.source||!o&&!t.classList.contains(n.terminalCls))a.target=a.toSide=null,a.valid=!1,l.classList.add("b-invalid");else{var d,u;const h=a.target=i,{source:f}=a;let g=t.dataset.side;o&&!t.classList.contains(n.terminalCls)&&(g=n.getTargetSideFromType(n.dependencyStore.modelClass.fieldMap.type.defaultValue||ot.Type.EndToStart)),s.resolveResourceRecord&&(a.targetResource=s.resolveResourceRecord(r));let m;a.toSide=g;const p=a.fromSide,v=D=>{n.isDestroyed||(a.valid=D,t.classList.add(D?"b-valid":"b-invalid"),l.classList.add(D?"b-valid":"b-invalid"),s.trigger("dependencyValidationComplete",{data:a,source:f,target:h,dependencyType:m}))};switch(!0){case(p==="start"&&g==="start"):m=ot.Type.StartToStart;break;case(p==="start"&&g==="end"):m=ot.Type.StartToEnd;break;case(p==="end"&&g==="start"):m=ot.Type.EndToStart;break;case(p==="end"&&g==="end"):m=ot.Type.EndToEnd;break}s.trigger("dependencyValidationStart",{data:a,source:f,target:h,dependencyType:m});let y=a.valid=n.dependencyStore.isValidDependency(f,h,m);U.isPromise(y)&&(y=await y),v(y);const C=y?"b-valid":"b-invalid";l.classList.add(C),(d=a.timeSpanElement)===null||d===void 0||(u=d.querySelector(`.b-sch-terminal[data-side=${g}]`))===null||u===void 0||u.classList.add("b-sch-terminal-active",C)}n.updateCreationTooltip()}}async onMouseUp(){var t;const i=this,r=i.creationData;if(r.finalizing=!0,(t=i.pointerUpMoveDetacher)===null||t===void 0||t.call(i),r.valid)if(await i.view.trigger("beforeDependencyCreateFinalize",r)===!1?r.valid=!1:U.isPromise(r.valid)&&(r.valid=await r.valid),r.valid){let s=i.createDependency(r);s!==null&&(U.isPromise(s)&&(s=await s),r.dependency=s,i.view.trigger("dependencyCreateDrop",{data:r,source:r.source,target:r.target,dependency:s}),i.doAfterDependencyDrop(r))}else i.doAfterDependencyDrop(r);else r.valid=!1,i.doAfterDependencyDrop(r);i.abort()}doAfterDependencyDrop(t){this.view.trigger("afterDependencyCreateDrop",F({data:t},t))}onDocumentMouseUp({target:t}){this.view.timeAxisSubGridElement.contains(t)||this.abort()}abort(){var t,i;const r=this,{view:n,creationData:s}=r;if(s){const{source:a,sourceResource:o,target:l,targetResource:d}=s;if(a){const u=n.getElementFromEventRecord(a,o);u&&r.hideTerminals(u)}if(l){const u=n.getElementFromEventRecord(l,d);u&&r.hideTerminals(u)}}r.creationTooltip&&(r.creationTooltip.disabled=!0),r.creationData=r.lastMouseMoveEvent=null,(t=r.pointerUpMoveDetacher)===null||t===void 0||t.call(r),(i=r.documentPointerUpDetacher)===null||i===void 0||i.call(r),r.removeConnector()}createConnector(t,i){const r=this,{view:n}=r;r.clearTimeout(r.removeConnectorTimeout),r.connector=S.createElement({parent:n.timeAxisSubGridElement,className:`${r.baseCls}-connector`,style:`left:${t}px;top:${i}px`}),n.element.classList.add("b-creating-dependency")}createDragTooltip(){const t=this,{view:i}=t;return t.creationTooltip=ce.new({id:`${i.id}-dependency-drag-tip`,cls:"b-sch-dependency-creation-tooltip",loadingMsg:"",anchorToTarget:!1,forElement:i.timeAxisSubGridElement,trackMouse:!0,constrainTo:null,header:{dock:"right"},internalListeners:{beforeShow:"updateCreationTooltip",thisObj:t}},t.creationTooltip)}removeConnector(){const t=this,{connector:i,view:r}=t;i&&(i.classList.add("b-removing"),i.style.width="0",t.removeConnectorTimeout=t.setTimeout(()=>{i.remove(),t.connector=null},200)),r.element.classList.remove("b-creating-dependency"),t.creationTooltip&&t.creationTooltip.hide(),r.scrollManager.stopMonitoring()}showTerminals(t,i){const r=this;if(!r.isCreateAllowed||!t.project)return;const n=r.terminalCls,s=`${n}s-visible`;i=S.down(i,r.view.eventInnerSelector),!i.classList.contains(s)&&!r.view.element.classList.contains("b-resizing-event")&&!r.view.readOnly&&(r.terminalSides.forEach(a=>{a=r.fixSide(a);const o=S.createElement({parent:i,className:`${n} ${n}-${a}`,dataset:{side:a,feature:!0}});o.detacher=B.on({element:o,mouseover:"onTerminalMouseOver",mouseout:"onTerminalMouseOut",pointerdown:{handler:"onTerminalPointerDown",capture:!0},thisObj:r})}),i.classList.add(s),t.internalCls.add(s),r.showingTerminalsFor=i)}fixSide(t){return t==="left"?"start":t==="right"?"end":t}hideTerminals(t){const i=this,r=i.client.getTimeSpanMouseEventParams(t),n=r?.[`${i.eventName}Record`],s=`${i.terminalCls}s-visible`;S.forEachSelector(t,`.${i.terminalCls}`,a=>{a.detacher&&a.detacher(),a.remove()}),S.down(t,i.view.eventInnerSelector).classList.remove(s),n.internalCls.remove(s),i.showingTerminalsFor=null}createDependency(t){const{source:i,target:r,fromSide:n,toSide:s}=t,a=(n==="start"?0:2)+(s==="end"?1:0),o=this.dependencyStore.add({from:i.id,to:r.id,type:a,fromSide:n,toSide:s});return o!==null?o[0]:null}getTargetSideFromType(t){return t===ot.Type.StartToStart||t===ot.Type.EndToStart?"start":"end"}updateCreationTooltip(){const t=this,i=t.creationData,{valid:r}=i,n=t.creationTooltip,{classList:s}=n.element;if(U.isPromise(r))return s.remove("b-invalid"),s.add("b-checking"),new Promise(a=>r.then(o=>{i.valid=o,n.isDestroyed||a(t.updateCreationTooltip())}));n.html=t.creationTooltipTemplate(i)}creationTooltipTemplate(t){var i,r;const n=this,{tooltip:s,valid:a}=t,{classList:o}=s.element;Object.assign(t,{fromText:z.encodeHtml(t.source.name),toText:z.encodeHtml((i=(r=t.target)===null||r===void 0?void 0:r.name)!==null&&i!==void 0?i:""),fromSide:t.fromSide,toSide:t.toSide||""});let l,d;return o.toggle("b-invalid",!a),o.remove("b-checking"),a===!0?(l="valid",d=n.L("L{Dependencies.valid}")):(l="invalid",d=n.L("L{Dependencies.invalid}")),s.title=`<i class="b-icon b-icon-${l}"></i>${d}`,{children:[{className:"b-sch-dependency-tooltip",children:[{dataset:{ref:"fromLabel"},tag:"label",text:n.L("L{Dependencies.from}")},{dataset:{ref:"fromText"},text:t.fromText},{dataset:{ref:"fromBox"},className:`b-sch-box b-${t.fromSide}`},{dataset:{ref:"toLabel"},tag:"label",text:n.L("L{Dependencies.to}")},{dataset:{ref:"toText"},text:t.toText},{dataset:{ref:"toBox"},className:`b-sch-box b-${t.toSide}`}]}]}}doDisable(t){this.isConfiguring||this.updateCreateListeners(),super.doDisable(t)}};const Qs=25;var JD=c=>{var e;return e=class extends c{constructor(...i){super(...i),M(this,"gridCache",null)}getDependenciesToConsider(i,r,n,s){const a=this,{gridCache:o}=a,{timeAxis:l}=a.client;if(o){const d=new Set,u=Math.floor((i-l.startMS)/a.MS_PER_CELL),h=Math.floor((r-l.startMS)/a.MS_PER_CELL),f=Math.floor(n/Qs),g=Math.floor(s/Qs);for(let m=u;m<=h;m++){const p=o[m];if(p)for(let v=f;v<=g;v++){const y=p[v];if(y)for(let C=0;C<y.length;C++)d.add(y[C])}}return d}}afterDrawDependency(i,r,n,s,a){const o=this;if(o.constructGridCache){const{MS_PER_CELL:u}=o,{startMS:h,endMS:f}=o.client.timeAxis,g=Math.ceil((f-h)/u),m=Math.floor((s-h)/u),p=Math.floor((a-h)/u),v=Math.floor(r/Qs),y=Math.floor(n/Qs),C=Math.min(m,p),D=Math.max(m,p),w=Math.min(v,y),E=Math.max(v,y);if(C<0&&D<0||C>g&&D>g)return;const R=Math.max(C,0),x=Math.min(D,g);for(let k=R;k<=x;k++){var l;const I=(l=o.gridCache[k])!==null&&l!==void 0?l:o.gridCache[k]={};for(let A=w;A<=E;A++){var d;((d=I[A])!==null&&d!==void 0?d:I[A]=[]).push(i)}}}}beforeDraw(){const i=this;if(!i.gridCache){const{visibleDateRange:r}=i.client;i.constructGridCache=!0,i.MS_PER_CELL=Math.max(r.endMS-r.startMS,1e3),i.gridCache={}}}afterDraw(){this.constructGridCache=!1}reset(){this.gridCache=null}},M(e,"$name","DependencyGridCache"),e};const QD=Math.min(1/globalThis.devicePixelRatio,.75),eE=["start","end","top","bottom"],hi=(c,e)=>Math.abs(c-e)<.1;class Dr extends P{static get configurable(){return{startSide:"right",startArrowMargin:12,startShift:0,endSide:"left",endArrowMargin:12,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null,client:{}}}findPath(e,t){const i=this,r=e;let n,s,a,o,l,d,u,h,f,g,m,p,v,y,C,D,w,E,R,x,k,I,A,L,O,_,V,Y,J;for(t=W.asArray(t),J=0;e&&!Y;){if(n=Object.assign(i.config,e),s=n.startBox,a=n.endBox,o=n.startShift,l=n.endShift,d=n.startSide,u=n.endSide,h=n.startArrowMargin,f=n.endArrowMargin,g=n.horizontalMargin,m=n.verticalMargin,p=n.hasOwnProperty("startHorizontalMargin")?n.startHorizontalMargin:g,v=n.hasOwnProperty("startVerticalMargin")?n.startVerticalMargin:m,y=n.hasOwnProperty("endHorizontalMargin")?n.endHorizontalMargin:g,C=n.hasOwnProperty("endVerticalMargin")?n.endVerticalMargin:m,D=n.hasOwnProperty("otherHorizontalMargin")?n.otherHorizontalMargin:g,w=n.hasOwnProperty("otherVerticalMargin")?n.otherVerticalMargin:m,E=n.otherBoxes,d=i.normalizeSide(d),u=i.normalizeSide(u),R=i.getConnectionCoordinatesFromBoxSideShift(s,d,o),x=i.getConnectionCoordinatesFromBoxSideShift(a,u,l),O=i.calcGridBaseBoxFromBoxAndDrawParams(s,d,h,p,v),_=i.calcGridBaseBoxFromBoxAndDrawParams(a,u,f,y,C),eE.forEach(q=>{Math.abs(O[q]-_[q])<=QD&&(_[q]=O[q])}),i.shouldLookForPath(s,a,O,_)){var X;E=(X=E)===null||X===void 0?void 0:X.map(q=>i.calcGridBaseBoxFromBoxAndDrawParams(q,!1,0,D,w)),k=i.getConnectionCoordinatesFromBoxSideShift(O,d,o),I=i.getConnectionCoordinatesFromBoxSideShift(_,u,l),V=i.buildPathGrid(O,_,k,I,d,u,E),A=i.convertDecartPointToGridPoint(V,k),L=i.convertDecartPointToGridPoint(V,I),Y=i.findPathOnGrid(V,A,L,d,u)}for(e=!1;!Y&&!e&&t&&J<t.length;J++)e=t[J](n,r)}return Y&&(Y=i.prependPathWithArrowStaffSegment(Y,R,d),Y=i.appendPathWithArrowStaffSegment(Y,x,u),Y=i.optimizePath(Y)),Y}static calculateRelativePosition(e,t,i=!1){const r=i?"top":"start",n=i?"bottom":"end";let s;return e[n]<t[r]?s=0:e[n]<=t[n]&&e[n]>=t[r]&&e[r]<t[r]?s=1:e[r]>=t[r]&&e[n]<=t[n]?s=2:e[r]<t[r]&&e[n]>t[n]?s=-2:e[r]<=t[n]&&e[n]>t[n]?s=3:s=4,s}static boxOverlapChanged(e,t,i,r,n=!1){const s=Dr.calculateRelativePosition,a=s(e,t,n),o=s(i,r,n);return a!==o}shouldLookForPath(e,t,i,r){let n=!0;return(e.end-e.start<=this.startArrowMargin||t.end-t.start<=this.endArrowMargin)&&Math.abs(Dr.calculateRelativePosition(e,t,!0))===2&&(n=!Dr.boxOverlapChanged(e,t,i,r)),n}getConnectionCoordinatesFromBoxSideShift(e,t,i){let r;switch(t){case"left":r={x:e.start,y:(e.top+e.bottom)/2+i};break;case"right":r={x:e.end,y:(e.top+e.bottom)/2+i};break;case"top":r={x:(e.start+e.end)/2+i,y:e.top};break;case"bottom":r={x:(e.start+e.end)/2+i,y:e.bottom};break}return r}calcGridBaseBoxFromBoxAndDrawParams(e,t,i,r,n){let s;switch(this.normalizeSide(t)){case"left":s={start:e.start-Math.max(i,r),end:e.end+r,top:e.top-n,bottom:e.bottom+n};break;case"right":s={start:e.start-r,end:e.end+Math.max(i,r),top:e.top-n,bottom:e.bottom+n};break;case"top":s={start:e.start-r,end:e.end+r,top:e.top-Math.max(i,n),bottom:e.bottom+n};break;case"bottom":s={start:e.start-r,end:e.end+r,top:e.top-n,bottom:e.bottom+Math.max(i,n)};break;default:s={start:e.start-r,end:e.end+r,top:e.top-n,bottom:e.bottom+n}}return s}normalizeSide(e){const{rtl:t}=this.client;return e==="start"?t?"right":"left":e==="end"?t?"left":"right":e}buildPathGrid(e,t,i,r,n,s,a){let o,l,d,u,h,f,g,m,p,v,y,C,D;const w={},E=[];for(o=[e.start,n==="left"||n==="right"?(e.start+e.end)/2:i.x,e.end,t.start,s==="left"||s==="right"?(t.start+t.end)/2:r.x,t.end],l=[e.top,n==="top"||n==="bottom"?(e.top+e.bottom)/2:i.y,e.bottom,t.top,s==="top"||s==="bottom"?(t.top+t.bottom)/2:r.y,t.bottom],a&&a.forEach(R=>{o.push(R.start,(R.start+R.end)/2,R.end),l.push(R.top,(R.top+R.bottom)/2,R.bottom)}),o=[...new Set(o.sort((R,x)=>R-x))],l=[...new Set(l.sort((R,x)=>R-x))],f=0,m=l.length;f<m;++f)for(w[f]=w[f]||{},d=l[f],h=0,g=o.length;h<g;++h){if(u=o[h],C=(u<=e.start||u>=e.end||d<=e.top||d>=e.bottom)&&(u<=t.start||u>=t.end||d<=t.top||d>=t.bottom),a)for(p=0,v=a.length;C&&p<v;++p)y=a[p],C=u<=y.start||u>=y.end||d<=y.top||d>=y.bottom||u===i.x&&d===i.y||u===r.x&&d===r.y;D={distance:Number.MAX_SAFE_INTEGER,permitted:C,x:u,y:d,ix:h,iy:f},w[f][h]=D,E.push(D)}return{width:o.length,height:l.length,xs:o,ys:l,points:w,linearPoints:E}}convertDecartPointToGridPoint(e,t){const i=e.xs.indexOf(t.x),r=e.ys.indexOf(t.y);return e.points[r][i]}findPathOnGrid(e,t,i,r,n){const s=this;let a=!1;return t.permitted&&i.permitted&&(e=s.waveForward(e,t,0),a=s.collectPath(e,i,n)),a}getGridPointNeighbors(e,t,i){const r=t.ix,n=t.iy,s=[];let a;return n<e.height-1&&(a=e.points[n+1][r],(!i||i(a))&&s.push(a)),n>0&&(a=e.points[n-1][r],(!i||i(a))&&s.push(a)),r<e.width-1&&(a=e.points[n][r+1],(!i||i(a))&&s.push(a)),r>0&&(a=e.points[n][r-1],(!i||i(a))&&s.push(a)),s}waveForward(e,t,i){const r=this;return va.preWalkUnordered([t,i],([n,s])=>r.getGridPointNeighbors(e,n,a=>a.permitted&&a.distance>s+1).map(a=>[a,s+1]),([n,s])=>n.distance=s),e}collectPath(e,t,i){const r=this,n=[];let s=!0,a,o,l,d;for(;s&&t.distance;)if(a=r.getGridPointNeighbors(e,t,u=>u.permitted&&u.distance===t.distance-1),s=a.length>0,s){switch(a=a.sort((u,h)=>{let f,g;f=u.ix-t.ix,g=u.iy-t.iy;const m=(i==="left"||i==="right")&&g===0||(i==="top"||i==="bottom")&&f===0?-1:1;f=h.ix-t.ix,g=h.iy-t.iy;const p=(i==="left"||i==="right")&&g===0||(i==="top"||i==="bottom")&&f===0?-1:1;if(m>p)return 1;if(m<p)return-1;if(m===p)return u.y>h.y?-1:1}),o=a[0],n.push({x1:o.x,y1:o.y,x2:t.x,y2:t.y}),l=o.ix-t.ix,d=o.iy-t.iy,!0){case(!d&&l>0):i="left";break;case(!d&&l<0):i="right";break;case(!l&&d>0):i="top";break;case(!l&&d<0):i="bottom";break}t=o}return s&&n.reverse()||!1}prependPathWithArrowStaffSegment(e,t,i){if(e.length>0){const r=e[0],n={x2:r.x1,y2:r.y1};switch(i){case"left":n.x1=t.x,n.y1=r.y1;break;case"right":n.x1=t.x,n.y1=r.y1;break;case"top":n.x1=r.x1,n.y1=t.y;break;case"bottom":n.x1=r.x1,n.y1=t.y;break}e.unshift(n)}return e}appendPathWithArrowStaffSegment(e,t,i){if(e.length>0){const r=e[e.length-1],n={x1:r.x2,y1:r.y2};switch(i){case"left":n.x2=t.x,n.y2=r.y2;break;case"right":n.x2=t.x,n.y2=r.y2;break;case"top":n.x2=r.x2,n.y2=t.y;break;case"bottom":n.x2=r.x2,n.y2=t.y;break}e.push(n)}return e}optimizePath(e){const t=[];let i,r;if(e.length>0)for(i=e.shift(),t.push(i);e.length>0;)r=e.shift(),hi(i.x1,r.x1)&&hi(i.y1,r.y1)&&hi(i.x2,r.x2)&&hi(i.y2,r.y2)?i=r:hi(i.y1,i.y2)&&hi(r.y1,r.y2)?i.x2=r.x2:hi(i.x1,i.x2)&&hi(r.x1,r.x2)?i.y2=r.y2:(t.push(r),i=r);return t}}Dr._$name="RectangularPathFinder";function gf(c){return c.x1===c.x2?c.y2>c.y1?"d":"u":c.x2>c.x1?"r":"l"}function Rl(c){return c.x1===c.x2?c.y2-c.y1:c.x2-c.x1}function tE(c,e,t){const i=gf(c)+gf(e),r=t*(i.includes("l")?-1:1),n=t*(i.includes("u")?-1:1);return`a${r},${n} 0 0 ${i==="ur"||i==="lu"||i==="dl"||i==="rd"?1:0} ${r},${n}`}function iE(c,e,t,i,r){let n=c.x1===c.x2?"v":"h",s=i;if(i){const a=Rl(c),o=e?Math.abs(Rl(e)):Number.MAX_SAFE_INTEGER,l=Math.sign(a);r==null&&(r=i),(Math.abs(a)<i*2||o<i*2)&&(s=Math.min(Math.abs(a),o)/2);const d=t==="single"?0:t==="first"?s:t==="between"?r+s:r,u=a-d*l;n+=Math.sign(u)!==l?0:u,t!=="last"&&t!=="single"&&s>0&&(n+=` ${tE(c,e,s)}`)}else n+=Rl(c);return{line:n,currentRadius:i!==s?s:null}}function rE(c,e){const{length:t}=e;if(!t)return"";let i=null;return`M${e[0].x1},${e[0].y1} ${e.map((r,n)=>{const s=t===1?"single":n===t-1?"last":n===0?"first":"between",a=iE(r,e[n+1],s,c,i);return{currentRadius:i}=a,a.line}).join(" ")}`}var nE=c=>{var e;return e=class extends c{constructor(...i){super(...i),M(this,"lineCache",{})}onSVGReady(){const i=this;i.pathFinder=new Dr(F(F({},i.pathFinderConfig),{},{client:i.client})),i.lineDefAdjusters=i.createLineDefAdjusters(),i.createMarker()}changeRadius(i){return i!==null&&T.assertNumber(i,"radius"),i}updateRadius(){this.isConfiguring||this.reset()}updateRenderer(){this.isConfiguring||this.reset()}changeClickWidth(i){return i!==null&&T.assertNumber(i,"clickWidth"),i}updateClickWidth(){this.isConfiguring||this.reset()}createMarker(){var i,r;const n=this,{markerDef:s}=n,a=this.client.svgCanvas,o=s?`${n.client.id}-arrowEnd`:"arrowEnd";(i=n.marker)===null||i===void 0||i.remove(),a.style.setProperty("--scheduler-dependency-marker",`url(#${o})`),n.marker=S.createElement({parent:a,id:o,tag:"marker",className:"b-sch-dependency-arrow",ns:"http://www.w3.org/2000/svg",markerHeight:11,markerWidth:11,refX:8.5,refY:3,viewBox:"0 0 9 6",orient:"auto-start-reverse",markerUnits:"userSpaceOnUse",retainElement:!0,children:[{tag:"path",ns:"http://www.w3.org/2000/svg",d:(r=n.markerDef)!==null&&r!==void 0?r:"M3,0 L3,6 L9,3 z"}]})}updateMarkerDef(){this.isConfiguring||this.createMarker()}getAssignmentElement(i){var r;return((r=this.client.features.eventDrag)===null||r===void 0?void 0:r.getProxyElement(i))||this.client.getElementFromAssignmentRecord(i)}getDomConfigs(i,r,n,s){const a=this,o=a.getDependencyKey(i,r,n),l=a.lineCache[o];if(a.constructLineCache||!l||s||a.drawingLive&&(a.getAssignmentElement(r)||a.getAssignmentElement(n))){const h=a.prepareLineDef(i,r,n,s),f=h&&a.pathFinder.findPath(h,a.lineDefAdjusters),{client:g,clickWidth:m}=a,{toEvent:p}=i;if(f){var d,u;const v=a.highlighted.get(i),y={tag:"path",ns:"http://www.w3.org/2000/svg",d:rE((d=a.radius)!==null&&d!==void 0?d:0,f),role:"presentation",dataset:{syncId:o,depId:i.id,fromId:r.id,toId:n.id},elementData:{dependency:i,points:f},class:{[a.baseCls]:1,[i.cls]:i.cls,[i.highlighted]:i.highlighted,[v&&[...v].join(" ")]:v,[a.noMarkerCls]:h.hideMarker,"b-inactive":i.active===!1,"b-sch-bidirectional-line":i.bidirectional,"b-readonly":i.readOnly,"b-sch-dependency-ends-outside":!p.milestone&&(p.endDate<=g.startDate||g.endDate<=p.startDate)||p.milestone&&(p.endDate<g.startDate||g.endDate<p.startDate)}};(u=a.renderer)===null||u===void 0||u.call(a,{domConfig:y,points:f,dependencyRecord:i,fromAssignmentRecord:r,toAssignmentRecord:n,fromBox:h.startBox,toBox:h.endBox,fromSide:h.startSide,toSide:h.endSide});const C=[y];return m>1&&C.push(F(F({},y),{},{class:F(F({},y.class),{},{"b-click-area":1}),dataset:F(F({},y.dataset),{},{syncId:`${y.dataset.syncId}-click-area`}),style:{strokeWidth:m}})),a.lineCache[o]=C}return a.lineCache[o]=null}return l}generateBoundaryBoxes(i,r){return r==="bottom"?[{start:i.left,end:i.left+i.width/2,top:i.rowTop,bottom:i.rowBottom},{start:i.left+i.width/2,end:i.right,top:i.rowTop,bottom:i.rowBottom}]:[{start:i.left-this.pathFinder.startArrowMargin,end:i.right+this.pathFinder.startArrowMargin,top:i.rowTop,bottom:i.rowBottom}]}getAssignmentBounds(i){const{client:r}=this,n=this.getAssignmentElement(i);if(n&&!r.isExporting){const s=$.from(n,this.relativeTo);if(r.isHorizontal){let a=r.getRowById(i.resource.id);if(s.y<a.top||s.bottom>a.bottom){const o=r.rowManager.getRowAt(s.center.y,!0);o&&(a=o)}s.rowTop=a.top,s.rowBottom=a.bottom}return s}return r.isEngineReady&&r.getAssignmentEventBox(i,!0)}getConnectorStartSide(i){return this.client.currentOrientation.getConnectorStartSide(i)}getConnectorEndSide(i){return this.client.currentOrientation.getConnectorEndSide(i)}getDependencyStartSide(i){const{fromEvent:r,type:n,fromSide:s}=i;if(s)return s;switch(!0){case n===at.Type.StartToEnd:case n===at.Type.StartToStart:return this.getConnectorStartSide(r);case n===at.Type.EndToStart:case n===at.Type.EndToEnd:return this.getConnectorEndSide(r);default:return this.getConnectorEndSide(r)}}getDependencyEndSide(i){const{toEvent:r,type:n,toSide:s}=i;if(s)return s;switch(!0){case n===at.Type.EndToEnd:case n===at.Type.StartToEnd:return this.getConnectorEndSide(r);case n===at.Type.EndToStart:case n===at.Type.StartToStart:return this.getConnectorStartSide(r);default:return this.getConnectorStartSide(r)}}createLineDefAdjusters(){const{client:i}=this;function r(a){const{barMargin:o}=i;let l=!1;return(a.startArrowMargin>o||a.endArrowMargin>o)&&(a.startArrowMargin=a.endArrowMargin=o,l=!0),l&&a}function n(a){let o=!1;return(a.startArrowMargin>0||a.endArrowMargin>0)&&(a.startArrowMargin=a.endArrowMargin=0,o=!0),o&&a}function s(a,o){let l=!1;return a.horizontalMargin>2&&(a.horizontalMargin=1,l=!0,o.hideMarker=!0),l&&a}return[r,n,s]}adjustLineDef(i,r){return r}prepareLineDef(i,r,n,s){var a,o;const l=this,d=l.getDependencyStartSide(i),u=l.getDependencyEndSide(i),h=(a=s?.from)!==null&&a!==void 0?a:l.getAssignmentBounds(r),f=(o=s?.to)!==null&&o!==void 0?o:l.getAssignmentBounds(n),g=[];if(!h||!f)return null;let{startArrowMargin:m,verticalMargin:p}=l.pathFinder;return l.client.isHorizontal&&(h.rowTop!=null&&h.rowTop!==f.rowTop&&g.push(...l.generateBoundaryBoxes(h,d)),i.bidirectional||(/(top|bottom)/.test(d)&&(m=l.client.barMargin/2),p=l.client.barMargin/2)),l.adjustLineDef(i,{startBox:h,endBox:f,otherBoxes:g,startArrowMargin:m,verticalMargin:p,otherVerticalMargin:0,otherHorizontalMargin:0,startSide:d,endSide:u})}beforeDraw(){super.beforeDraw(),Object.keys(this.lineCache).length||(this.constructLineCache=!0)}afterDraw(){super.afterDraw(),this.constructLineCache=!1}reset(){super.reset(),this.lineCache={}}},M(e,"$name","DependencyLineGenerator"),e};const sE=["start","start","end","end"],aE=["start","end","start","end"];var oE=c=>{var e;return e=class extends c{changeTooltip(i,r){const n=this;return r?.destroy(),!n.showTooltip||!i?null:ce.new({align:"b-t",id:`${n.client.id}-dependency-tip`,forSelector:`.b-timelinebase:not(.b-eventeditor-editing):not(.b-resizing-event):not(.b-dragcreating):not(.b-dragging-event):not(.b-creating-dependency) .${n.baseCls}`,forElement:n.client.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:0,anchorToTarget:!1,textContent:!1,trackMouse:!1,getHtml:n.getHoverTipHtml.bind(n)},i)}getHoverTipHtml({activeTarget:i}){return this.tooltipTemplate(this.resolveDependencyRecord(i))}},M(e,"$name","DependencyTooltip"),M(e,"configurable",{showTooltip:!0,tooltipTemplate(t){return{children:[{className:"b-sch-dependency-tooltip",children:[{tag:"label",text:this.L("L{Dependencies.from}")},{text:t.fromEvent.name},{className:`b-sch-box b-${t.fromSide||sE[t.type]}`},{tag:"label",text:this.L("L{Dependencies.to}")},{text:t.toEvent.name},{className:`b-sch-box b-${t.toSide||aE[t.type]}`}]}]}},tooltip:{$config:"nullify",value:{}}}),e};const lE={click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu"},mf=c=>{var e;const t=[c];return(e=c.resource)!==null&&e!==void 0&&e.hasLinks&&t.push(...c.resource.$links.map(i=>({id:`${i.id}_${c.id}`,resource:i,event:c.event,drawDependencies:c.drawDependencies}))),t};class Zr extends te.mixin(Mi,he,ZD,JD,nE,oE){constructor(...e){super(...e),M(this,"domConfigs",new Map),M(this,"drawingLive",!1),M(this,"lastScrollX",null),M(this,"highlighted",new Map),M(this,"visibleResources",null),M(this,"usingLinks",null),M(this,"visibleDateRange",null),M(this,"relativeTo",null)}static get pluginConfig(){return{chain:["render","onPaint","onElementClick","onElementDblClick","onElementContextMenu","onElementMouseOver","onElementMouseOut","bindStore"],assign:["getElementForDependency","getElementsForDependency","resolveDependencyRecord"]}}construct(e,t){super.construct(e,t);const{scheduledEventName:i}=e;e.ion({svgCanvasCreated:"onSVGReady",animationStart:"refresh",[i+"DragStart"]:"refresh",[i+"ResizeStart"]:"refresh",[i+"SegmentDragStart"]:"refresh",[i+"SegmentResizeStart"]:"refresh",timelineViewportResize:"reset",timeAxisViewModelUpdate:"reset",toggleNode:"reset",thisObj:this}),e.rowManager.ion({refresh:"reset",changeTotalHeight:"reset",thisObj:this}),this.bindStore(e.store)}doDisable(e){this.isConfiguring||(this._isDisabling=e,this.draw(),this._isDisabling=!1),super.doDisable(e)}get rowStore(){return this.client.isVertical?this.client.resourceStore:this.client.store}bindStore(e){const t=this;t.client.isVertical||(t.detachListeners("store"),t.client.usesDisplayStore&&(e?.ion({name:"store",refresh:"onStoreRefresh",thisObj:t}),t.reset()))}onStoreRefresh(){this.reset()}attachToProject(e){super.attachToProject(e),e?.ion({name:"project",commitFinalized:"reset",thisObj:this})}attachToResourceStore(e){super.attachToResourceStore(e),e?.ion({name:"resourceStore",change:"onResourceStoreChange",refresh:"onResourceStoreChange",thisObj:this})}onResourceStoreChange(){this.usingLinks=null,this.reset()}attachToEventStore(e){super.attachToEventStore(e),e?.ion({name:"eventStore",refresh:"reset",thisObj:this})}attachToAssignmentStore(e){super.attachToAssignmentStore(e),e?.ion({name:"assignmentStore",refresh:"reset",thisObj:this})}attachToDependencyStore(e){super.attachToDependencyStore(e),e?.ion({name:"dependencyStore",change:"reset",refresh:"reset",thisObj:this})}updateDrawOnScroll(e){const t=this;t.detachListeners("scroll"),e?t.client.ion({name:"scroll",scroll:"doRefresh",horizontalScroll:"onHorizontalScroll",prio:-100,thisObj:t}):(t.client.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:t}),t.client.timeAxisSubGrid.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:t}))}onHorizontalScroll({subGrid:e,scrollX:t}){t!==this.lastScrollX&&e===this.client.timeAxisSubGrid&&(this.lastScrollX=t,this.draw())}onPaint(){this.refresh()}static getLocalizedDependencyType(e){return e?this.L(`L{DependencyType.${e}}`):""}getElementForDependency(e,t,i){return this.getElementsForDependency(e,t,i)[0]}getElementsForDependency(e,t,i){let r=`[data-dep-id="${e.id}"]`;return t&&(r+=`[data-from-id="${t.id}"]`),i&&(r+=`[data-to-id="${i.id}"]`),Array.from(this.client.svgCanvas.querySelectorAll(r))}resolveDependencyRecord(e){var t;return(t=e.elementData)===null||t===void 0?void 0:t.dependency}isDependencyElement(e){return e.matches(`.${this.baseCls}`)}onElementClick(e){const t=this.resolveDependencyRecord(e.target);if(t){const i=lE[e.type];this.client.trigger(`dependency${i}`,{dependency:t,event:e})}}onElementDblClick(e){return this.onElementClick(e)}onElementContextMenu(e){return this.onElementClick(e)}onElementMouseOver(e){const t=this,i=t.resolveDependencyRecord(e.target);i&&(t.client.trigger("dependencyMouseOver",{dependency:i,event:e}),t.overCls&&t.highlight(i))}onElementMouseOut(e){const t=this,i=t.resolveDependencyRecord(e.target);i&&(t.client.trigger("dependencyMouseOut",{dependency:i,event:e}),t.overCls&&t.unhighlight(i))}isDependencyVisible(e){const t=this,{rowStore:i}=t,{fromEvent:r,toEvent:n}=e;if(!r||!n)return!1;const s=r.resource,a=n.resource;return!i.isAvailable(s)||!i.isAvailable(a)?!1:r.isModel&&!s.instanceMeta(i).hidden&&!a.instanceMeta(i).hidden}updateHighlightDependenciesOnEventHover(e){const t=this;if(e){const{client:i}=t;i.ion({name:"highlightOnHover",[`${i.scheduledEventName}MouseEnter`]:r=>t.highlightEventDependencies(r.eventRecord||r.taskRecord),[`${i.scheduledEventName}MouseLeave`]:r=>t.unhighlightEventDependencies(r.eventRecord||r.taskRecord),thisObj:t})}else t.detachListeners("highlightOnHover")}highlight(e,t=this.overCls){let i=this.highlighted.get(e);i||this.highlighted.set(e,i=new Set),i.add(t),this.lineCache={},this.refresh()}unhighlight(e,t=this.overCls){const i=this.highlighted.get(e);i&&(i.delete(t),i.size||this.highlighted.delete(e)),this.lineCache={},this.refresh()}highlightEventDependencies(e,t){e.dependencies.forEach(i=>this.highlight(i,t))}unhighlightEventDependencies(e,t){e.dependencies.forEach(i=>this.unhighlight(i,t))}getDependenciesToConsider(e,t,i,r){var n,s;return(n=(s=super.getDependenciesToConsider)===null||s===void 0?void 0:s.call(this,e,t,i,r))!==null&&n!==void 0?n:this.project.dependencyStore.records.filter(a=>a.isValid)}getDependencyKey(e,t,i){return`dep:${e.id};from:${t.id};to:${i.id}`}drawDependency(e,t=!1,i=null){var r,n;const s=this,{domConfigs:a,client:o,rowStore:l,topIndex:d,bottomIndex:u}=s,{eventStore:h,useInitialAnimation:f}=o,{idMap:g}=l,{startMS:m,endMS:p}=s.visibleDateRange,{fromEvent:v,toEvent:y}=e;let C=v.assigned,D=y.assigned;if(v.isScheduled&&y.isScheduled&&h.includes(v)&&h.includes(y)&&(r=C)!==null&&r!==void 0&&r.size&&(n=D)!==null&&n!==void 0&&n.size){s.usingLinks&&(C=[...C].flatMap(mf),D=[...D].flatMap(mf));for(const k of C)for(const I of D){var w,E,R,x;const A=(w=g[(E=k.resource)===null||E===void 0?void 0:E.id])===null||w===void 0?void 0:w.index,L=(R=g[(x=I.resource)===null||x===void 0?void 0:x.id])===null||R===void 0?void 0:R.index,O=Math.min(v.startDateMS,y.startDateMS),_=Math.max(v.endDateMS,y.endDateMS);if(o.isExporting||A!=null&&L!=null&&k.drawDependencies!==!1&&I.drawDependencies!==!1&&l.isAvailable(k.resource)&&l.isAvailable(I.resource)&&!(A<d&&L<d||A>u&&L>u||O<m&&_<m||O>p&&_>p)){const V=s.getDependencyKey(e,k,I),Y=s.getDomConfigs(e,k,I,i);Y?(f&&(Y[0].style={animationDelay:`${Math.max(A,L)/20*1e3}ms`}),a.set(V,Y)):a.delete(V)}s.afterDrawDependency(e,A,L,O,_)}}t||s.domSync()}afterDrawDependency(e,t,i,r,n){var s;(s=super.afterDrawDependency)===null||s===void 0||s.call(this,e,t,i,r,n)}beforeDraw(){var e;(e=super.beforeDraw)===null||e===void 0||e.call(this)}afterDraw(){var e;(e=super.afterDraw)===null||e===void 0||e.call(this)}domSync(e=this.client.svgCanvas){Z.sync({targetElement:e,domConfig:{onlyChildren:!0,children:Array.from(this.domConfigs.values()).flat()},syncIdField:"syncId",releaseThreshold:0,strict:!0,callback(){}})}fillDrawingCache(){const e=this,{client:t}=e;e.relativeTo=$.from(t.foregroundCanvas),e.visibleResources=t.visibleResources,e.visibleDateRange=t.visibleDateRange,e.topIndex=e.rowStore.indexOf(e.visibleResources.first),e.bottomIndex=e.rowStore.indexOf(e.visibleResources.last),e.usingLinks==null&&(e.usingLinks=t.resourceStore.some(i=>i.hasLinks))}draw(){const e=this,{client:t}=e;if(!(t.refreshSuspended||!t.foregroundCanvas||!t.isEngineReady||e.disabled&&!e._isDisabling||t.isExporting)){if(e.fillDrawingCache(),e.domConfigs.clear(),t.firstVisibleRow&&t.lastVisibleRow&&t.timeAxis.count&&!e.disabled&&e.visibleDateRange.endMS-e.visibleDateRange.startMS>0){const{visibleDateRange:i}=t,{topIndex:r,bottomIndex:n}=e,s=e.getDependenciesToConsider(i.startMS,i.endMS,r,n);e.beforeDraw();for(const a of s)e.drawDependency(a,!0);e.afterDraw()}e.domSync(),t.trigger("dependenciesDrawn")}}doRefresh(){var e,t,i,r;const n=this,{client:s}=n,{scheduledEventName:a}=s;n.draw(),n.drawingLive=s.isAnimating||s.useInitialAnimation||((e=s.features[`${a}Drag`])===null||e===void 0?void 0:e.isActivelyDragging)||((t=s.features[`${a}Resize`])===null||t===void 0?void 0:t.isResizing)||((i=s.features[`${a}SegmentDrag`])===null||i===void 0?void 0:i.isActivelyDragging)||((r=s.features[`${a}SegmentResize`])===null||r===void 0?void 0:r.isResizing),n.drawingLive&&n.refresh()}refresh(){!this.client.refreshSuspended&&!this.disabled&&this.client.isPainted&&this.doRefresh()}reset(){var e;(e=super.reset)===null||e===void 0||e.call(this),this.refresh()}drawForEvent(){ae.deprecate("Scheduler","6.0.0","Dependencies.drawForEvent() is no longer needed"),this.refresh()}render(){this.client.getConfig("svgCanvas")}}M(Zr,"$name","Dependencies");M(Zr,"configurable",{overCls:"b-sch-dependency-over",baseCls:"b-sch-dependency",noMarkerCls:"b-sch-dependency-markerless",markerDef:null,radius:null,renderer:null,highlightDependenciesOnEventHover:null,drawOnScroll:!0,clickWidth:null});M(Zr,"delayable",{doRefresh:10});Zr._$name="Dependencies";G.registerFeature(Zr,!1,["Scheduler","ResourceHistogram"]);G.registerFeature(Zr,!0,"SchedulerPro");class ap extends We{static get $name(){return"DependencyEditor"}static get defaultConfig(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible"}}processWidgetConfig(e){const{dependencyEditFeature:t}=this;return e.ref==="lagField"&&!t.showLagField||e.ref==="deleteButton"&&!t.showDeleteButton?!1:super.processWidgetConfig(e)}afterShow(...e){const{deleteButton:t}=this.widgetMap;t&&(t.hidden=!this.record.isPartOfStore()),super.afterShow(...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}}ap._$name="DependencyEditor";class op extends te{static get $name(){return"DependencyEdit"}static get configurable(){return{autoClose:!0,saveAndCloseOnEnter:!0,showDeleteButton:!0,triggerEvent:"dependencydblclick",showLagField:!1,dependencyRecord:null,editorConfig:{title:"L{Edit dependency}",localeClass:this,closable:!0,defaults:{localeClass:this},items:{fromNameField:{type:"display",weight:100,label:"L{From}"},toNameField:{type:"display",weight:200,label:"L{To}"},typeField:{type:"combo",weight:300,label:"L{Type}",name:"type",editable:!1,valueField:"id",displayField:"name",localizeDisplayFields:!0,buildItems:function(){const e=this.parent;return Object.keys(at.Type).map(t=>({id:at.Type[t],name:e.L(t),localeKey:t}))}},lagField:{type:"duration",weight:400,label:"L{Lag}",name:"lag",allowNegative:!0}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler"},saveButton:{color:"b-green",text:"L{Save}"},deleteButton:{color:"b-gray",text:"L{Delete}"},cancelButton:{color:"b-gray",text:"L{Object.Cancel}"}}}}}}construct(e,t){const i=this;if(e.dependencyEdit=i,super.construct(e,t),!e.features.dependencies)throw new Error("Dependencies feature required when using DependencyEdit");i.clientListenersDetacher=e.ion({[i.triggerEvent]:i.onActivateEditor,thisObj:i})}doDestroy(){var e;this.clientListenersDetacher(),(e=this.editor)===null||e===void 0||e.destroy(),super.doDestroy()}changeEditorConfig(e){const t=this,{autoClose:i,cls:r,client:n}=t;return T.assign({owner:n,align:"b-t",id:`${n.id}-dependency-editor`,autoShow:!1,anchor:!0,scrollAction:"realign",clippedBy:[n.timeAxisSubGridElement,n.bodyContainer],constrainTo:globalThis,autoClose:i,cls:r},e)}get isValid(){return Object.values(this.editor.widgetMap).every(e=>!e.name||e.hidden?!0:e.isValid!==!1)}get values(){const e={};return this.editor.eachWidget(t=>{!t.name||t.hidden||(e[t.name]=t.value)},!0),e}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:t}=this;t.lag&&(t.lagUnit=t.lag.unit,t.lag=t.lag.magnitude),"type"in t&&(e.fromSide!=null&&(t.fromSide=null),e.toSide!=null&&(t.toSide=null)),T.cleanupProperties(t,!0),e.set(t)}onPopupKeyDown({event:e}){e.key==="Enter"&&this.saveAndCloseOnEnter&&e.target.tagName.toLowerCase()==="input"&&(e.preventDefault(),this.onSaveClick())}onSaveClick(){this.save()&&this.editor.hide()}onDeleteClick(){this.deleteDependency(),this.editor.hide()}onCancelClick(){this.editor.hide()}internalShowEditor(e){const t=this,{client:i}=t;let r=t.lastPointerDownCoordinate;if(i.trigger("beforeDependencyEdit",{dependencyEdit:t,dependencyRecord:e})===!1)return;const n=t.getEditor(e);if(t.loadRecord(e),i.trigger("beforeDependencyEditShow",{dependencyEdit:t,dependencyRecord:e,editor:n}),!r){const s=$.from(t.client.element).center;r=[s.x-n.width/2,s.y-n.height/2]}n.showBy(r)}editDependency(e){this.client.readOnly||e.readOnly||this.internalShowEditor(e)}getEditor(){var e,t,i;const r=this;let{editor:n}=r;return n||(n=r.editor=ap.new({dependencyEditFeature:r,autoShow:!1,anchor:!0,scrollAction:"realign",constrainTo:globalThis,autoClose:r.autoClose,cls:r.cls,rootElement:r.client.rootElement,internalListeners:{keydown:r.onPopupKeyDown,thisObj:r}},r.editorConfig),n.items.length===0&&console.warn("Editor configured without any `items`"),n.eachWidget(s=>{const a=s.ref||s.id;a&&!r[a]&&(r[a]=s)}),(e=r.saveButton)===null||e===void 0||e.ion({click:"onSaveClick",thisObj:r}),(t=r.deleteButton)===null||t===void 0||t.ion({click:"onDeleteClick",thisObj:r}),(i=r.cancelButton)===null||i===void 0||i.ion({click:"onCancelClick",thisObj:r}),r.editor)}loadRecord(e){const t=this;t.fromNameField.value=e.fromEvent.name,t.toNameField.value=e.toEvent.name,t.lagField&&(t.lagField.value=new Ue(e.lag,e.lagUnit)),t.editor.record=t.dependencyRecord=e}async save(){const e=this,{client:t,dependencyRecord:i}=e;if(!i||!e.isValid)return;const{dependencyStore:r,values:n}=e;if(t.trigger("beforeDependencySave",{dependencyRecord:i,values:n})!==!1){var s;if(e.onBeforeSave(i),e.updateRecord(i),r&&!i.stores.length){if(t.trigger("beforeDependencyAdd",{dependencyRecord:i,dependencyEdit:e})===!1)return;r.add(i)}await((s=t.project)===null||s===void 0?void 0:s.commitAsync()),t.trigger("afterDependencySave",{dependencyRecord:i}),e.onAfterSave(i)}return i}async deleteDependency(){const{client:e,editor:t,dependencyRecord:i}=this;if(e.trigger("beforeDependencyDelete",{dependencyRecord:i})!==!1){var r;return t.containsFocus&&t.revertFocus(),e.dependencyStore.remove(i),await((r=e.project)===null||r===void 0?void 0:r.commitAsync()),!0}return!1}get dependencyStore(){return this.client.dependencyStore}onActivateEditor({dependency:e,event:t}){this.disabled||(this.lastPointerDownCoordinate=[t.clientX,t.clientY],this.editDependency(e))}}op._$name="DependencyEdit";G.registerFeature(op,!1);class cs extends te.mixin(he){static get $name(){return"ScheduleContext"}construct(e,t){super.construct(e,t);const{triggerEvent:i}=this,r={datachange:"syncContextElement",timeaxisviewmodelupdate:"onTimeAxisViewModelUpdate",presetchange:"clearContext",thisObj:this};i==="mouseover"?r.timelineContextChange="onTimelineContextChange":((i==="click"||i==="mousedown")&&(r.schedulecontextmenu="onScheduleContextGesture"),Object.assign(r,F({[`schedule${i}`]:"onScheduleContextGesture",[`event${i}`]:"onScheduleContextGesture"},r))),e.useBackgroundCanvas=!0,e.ion(r),e.rowManager.ion({rowheight:"syncContextElement",thisObj:this})}changeTriggerEvent(e){return(e==="hover"||e==="mousemove")&&(e="mouseover"),e}get element(){return this._element||(this._element=S.createElement({parent:this.client.backgroundCanvas,className:"b-schedule-selected-tick"}))}onTimelineContextChange({context:e}){this.context=e}onScheduleContextGesture(e){this.context=e}onTimeAxisViewModelUpdate({source:e}){var t;e.timeAxis.includes((t=this.context)===null||t===void 0?void 0:t.tick)?this.syncContextElement():this.clearContext()}clearContext(){this.context=null}updateContext(e,t){this.syncContextElement()}syncContextElement(){if(this.context&&this.enabled){const e=this,{client:t,element:i,context:r,renderer:n}=e,{isVertical:s}=t,{style:a}=i,o=s?t.rowManager.rows[0]:t.getRowFor(r.resourceRecord);if(o){const{tickStartDate:l,tickEndDate:d,resourceRecord:u}=r,h=t.currentOrientation.getTimeSpanRenderData({startDate:l,endDate:d,startDateMS:l.getTime(),endDateMS:d.getTime()},u);let f,g,m;s?(f=h.top,g=h.resourceWidth,m=h.height):(f=o.top,g=h.width,m=o.height),a.display="",a.width=`${g}px`,a.height=`${m}px`,S.setTranslateXY(i,h.left,f),r.index=o.index,i.innerHTML="",n&&e.callback(n,e,[r,i])}else a.display="none"}else this.element.style.display="none"}}M(cs,"delayable",{syncContextElement:"raf"});M(cs,"configurable",{triggerEvent:"click",renderer:null,context:{$config:{equal(c,e){return c?.index===e?.index&&c?.tickParentIndex===e?.tickParentIndex&&!((c?.tickStartDate||0)-(e?.tickStartDate||0))}}}});cs.featureClass="b-scheduler-context";cs._$name="ScheduleContext";G.registerFeature(cs,!1,["Scheduler"]);class Jr extends te{constructor(...e){super(...e),M(this,"clipboardRecords",[]),M(this,"entityName","event")}construct(e,t){super.construct(e,t),e.ion({eventclick:this.onEventClick,scheduleclick:this.onScheduleClick,projectChange:()=>{this.clearClipboard(),this._cellClickedContext=null},thisObj:this}),this.scheduler=e}onEventDataGenerated(e){const{assignmentRecord:t}=e;t&&(e.cls["b-cut-item"]=t.meta.isCut)}onEventClick(e){this._cellClickedContext=null}onScheduleClick(e){this._cellClickedContext=e}isActionAvailable(e,t,i){var r;const n=this.client.features.cellEdit;return!this.disabled&&globalThis.getSelection().toString().length===0&&!(n!=null&&n.isEditing)&&Boolean(i.target.closest(".b-timeaxissubgrid"))&&!((r=this.client.focusedCell)!==null&&r!==void 0&&r.isSpecialRow)}copy(){this.copyEvents()}cut(){this.copyEvents(void 0,!0)}paste(){this.pasteEvents()}copyEvents(e=this.scheduler.selectedAssignments,t=!1){const i=this,{scheduler:r,entityName:n}=i;if(!(e!=null&&e.length))return;let s=e.slice();e[0].isEventModel&&(s=e.map(o=>o.assignments).flat()),t&&(s=s.filter(o=>!o.event.readOnly));const a=s.map(o=>o.event);!s.length||r.readOnly||r.trigger("beforeCopy",{assignmentRecords:s,records:a,eventRecords:a,isCut:t,entityName:n})===!1||(s.length>0&&r.trigger("copy",{assignmentRecords:s,eventRecords:a,isCut:t,entityName:n}),i._isCut=t,i.clipboard={assignmentRecords:s,eventRecords:a},r.assignmentStore.forEach(o=>{o.meta.isCut=t&&s.includes(o)}),r.refreshWithTransition())}pasteEvents(e,t){const i=this,{clipboard:r,scheduler:n,entityName:s}=i,{assignmentRecords:a,eventRecords:o}=r,l=i._isCut;if(arguments.length===0){const f=i._cellClickedContext||{};e=f.date,t=f.resourceRecord}if(t){if(t.readOnly)return;t=t.$original}if(!r||n.trigger("beforePaste",{assignmentRecords:a,records:o,eventRecords:o,resourceRecord:t||a[0].resource,date:e,isCut:l,entityName:s})===!1)return;let d=null;const u=new Set;for(const f of a){let{event:g}=f;const m=t||f.resource,p=e||f.event.startDate;if(u.has(g)){l&&f.remove();continue}if(u.add(g),l)f.meta.isCut=!1,f.resource=m,d=f;else if(n.eventStore.usesSingleAssignment||i.copyPasteAction==="clone")g=g.copy(),g.name=i.generateNewName(g),n.eventStore.add(g),g.assign(m),d=n.assignmentStore.last;else if(!g.resources.includes(m)){const v=f.copy();v.resource=m,[d]=n.assignmentStore.add(v)}g.startDate=p,g.constraintDate&&(g.constraintDate=null)}r&&n.trigger("paste",{assignmentRecords:a,eventRecords:o,resourceRecord:t,date:e,isCut:l,entityName:s});const h=n.ion({renderEvent({assignmentRecord:f}){f===d&&(n.navigateTo(f,{scrollIntoView:!1}),h())}});l&&i.clearClipboard()}clearClipboard(){const e=this;e._isCut&&(e.clipboard.assignmentRecords.forEach(t=>{t.meta.isCut=!1}),e.scheduler.refreshWithTransition(),e._isCut=!1),e.clipboard=null}populateEventMenu({assignmentRecord:e,items:t}){const i=this;i.scheduler.readOnly||(t.copyEvent={text:"L{copyEvent}",localeClass:i,icon:"b-icon b-icon-copy",weight:110,onItem:()=>i.copyEvents([e].concat(i.scheduler.selectedAssignments.filter(r=>r!==e)))},t.cutEvent={text:"L{cutEvent}",localeClass:i,icon:"b-icon b-icon-cut",weight:120,disabled:e.event.readOnly,onItem:()=>i.copyEvents([e].concat(i.scheduler.selectedAssignments.filter(r=>r!==e)),!0)})}populateScheduleMenu({items:e,resourceRecord:t}){const i=this,{scheduler:r}=i;!r.readOnly&&i.clipboard&&(e.pasteEvent={text:"L{pasteEvent}",localeClass:i,icon:"b-icon b-icon-paste",disabled:r.resourceStore.count===0||t.readOnly,weight:110,onItem:({date:n,resourceRecord:s})=>i.pasteEvents(n,s,r.getRowFor(s))})}generateNewName(e){const t=e[this.nameField];let i=2;for(;this.client.eventStore.findRecord(this.nameField,`${t} - ${i}`);)i++;return`${t} - ${i}`}}M(Jr,"$name","EventCopyPaste");M(Jr,"pluginConfig",{assign:["copyEvents","pasteEvents"],chain:["populateEventMenu","populateScheduleMenu","onEventDataGenerated"]});M(Jr,"configurable",{nameField:"name",keyMap:{"Ctrl+C":"copy","Ctrl+X":"cut","Ctrl+V":"paste"},copyPasteAction:"clone"});Jr.featureClass="b-event-copypaste";Jr._$name="EventCopyPaste";G.registerFeature(Jr,!0,"Scheduler");class Vd extends ip{static get $name(){return"EventDrag"}static get configurable(){return{constrainDragToResource:!1,constrainDragToTimeSlot:!1,externalDropTargetSelector:null,validatorFn:()=>{},validatorFnThisObj:null,unifiedDrag:null,snapToPosition:null,copyKey:"SHIFT",copyMode:"auto",mode:"move",capitalizedEventName:null}}afterConstruct(){this.capitalizedEventName=this.capitalizedEventName||this.client.capitalizedEventName,super.afterConstruct(...arguments)}changeMode(e){const{dragData:t,copyMode:i}=this;if((i==="event"||i==="auto"||i==="assignment"&&!this.scheduler.eventStore.usesSingleAssignment)&&(!t||t.eventRecords.every(r=>!r.isRecurring)))return e}updateMode(e){this.dragData&&(e==="copy"?this.setCopying():this.setMoving(),this.client.trigger("eventDragModeChange",{mode:e}))}setCopying(){const{dragData:e}=this;!e||(e.eventBarCopies.some(t=>t.isConnected)?e.eventBarCopies.forEach(t=>{t.classList.remove("b-hidden")}):e.eventBarCopies.forEach(t=>{t.classList.add("b-drag-proxy-copy"),t.classList.remove("b-hidden"),e.context.grabbedParent.appendChild(t),t.retainElement=!0}))}setMoving(){const{dragData:e}=this;!e||e.eventBarCopies.forEach(t=>{t.classList.add("b-hidden")})}get scheduler(){return this.client}onAfterDragStart(e){const t=this,{context:{element:i}}=e;super.onAfterDragStart(e),t.handleKeyDownOrMove(e.event),t.keyEventDetacher=B.on({element:S.getRootElement(i),keydown:t.handleKeyDownOrMove,keyup:t.handleKeyUp,thisObj:t})}onDragReset(e){var t;super.onDragReset(e),(t=this.keyEventDetacher)===null||t===void 0||t.call(this),this.mode="move"}onDrop(e){var t;return(t=this.dragData.eventBarCopies)===null||t===void 0||t.forEach(i=>i.remove()),super.onDrop(e)}getDraggableElement(e){return e?.closest(this.drag.targetSelector)}resolveEventRecord(e,t=this.client){return t.resolveEventRecord(e)}isElementDraggable(e,t){var i;const r=this,{client:n}=r,s=r.getDraggableElement(e);if(!s||r.disabled||n.readOnly||e.matches('[class$="-handle"]'))return!1;const a=r.resolveEventRecord(s,n);return!a||!a.isDraggable||a.readOnly?!1:!(((i=n[`is${r.capitalizedEventName}ElementDraggable`])===null||i===void 0?void 0:i.call(n,s,a,e,t))===!1)}getTriggerParams(e){const{assignmentRecords:t,eventRecords:i,resourceRecord:r,browserEvent:n}=e;return{context:e,eventRecords:i,resourceRecord:r,assignmentRecords:t,event:n,domEvent:n}}triggerBeforeEventDrag(e,t){return this.client.trigger(e,t)}triggerEventDrag(e,t){this.client.trigger("eventDrag",Object.assign(this.getTriggerParams(e),{startDate:e.startDate,endDate:e.endDate,newResource:e.newResource}))}triggerDragStart(e){this.client.navigator.skipNextClick=!0,this.client.trigger("eventDragStart",this.getTriggerParams(e))}triggerDragAbort(e){this.client.trigger("eventDragAbort",this.getTriggerParams(e))}triggerDragAbortFinalized(e){this.client.trigger("eventDragAbortFinalized",this.getTriggerParams(e))}triggerAfterDrop(e,t){const i=this;if(i.currentOverClient.trigger("afterEventDrop",Object.assign(i.getTriggerParams(e),{valid:t})),!t){const{assignmentStore:r,eventStore:n}=i.client;i.dragData.initialAssignmentsState.find(({resource:a,assignment:o},l)=>{var d;return!r.includes(o)||!n.includes(o.event)||a.id!==((d=i.dragData.assignmentRecords[l])===null||d===void 0?void 0:d.resourceId)})&&i.client.refresh()}i.client.setTimeout(()=>i.client.navigator.skipNextClick=!1,10)}handleKeyDownOrMove(e){this.mode!=="copy"&&(e.key&&B.specialKeyFromEventKey(e.key)===this.copyKey.toLowerCase()||e[`${this.copyKey.toLowerCase()}Key`])&&(this.mode="copy")}handleKeyUp(e){B.specialKeyFromEventKey(e.key)===this.copyKey.toLowerCase()&&(this.mode="move")}isValidDrop(e){const{newResource:t,resourceRecord:i}=e,r=e.draggedEntities[0];return t?t.isSpecialRow||t.readOnly?!1:i!==t?!r.event.resources.includes(t):!0:!this.constrainDragToTimeline&&this.externalDropTargetSelector?Boolean(e.browserEvent.target.closest(this.externalDropTargetSelector)):!1}checkDragValidity(e,t){var i;const r=this,n=r.currentOverClient;let s;if((i=e.newResource)!==null&&i!==void 0&&i.readOnly)return!1;if(!n.allowOverlap&&!n.isDateRangeAvailable(e.startDate,e.endDate,e.draggedEntities[0],e.newResource)?s={valid:!1,message:r.L("L{eventOverlapsExisting}")}:s=r.validatorFn.call(r.validatorFnThisObj||r,e,t),!s||s.valid){var a,o;s=(a=(o=n.checkEventDragValidity)===null||o===void 0?void 0:o.call(n,e,t))!==null&&a!==void 0?a:s}return s}async updateRecords(e){const t=this,i=t.client,r=t.currentOverClient,n=t.mode==="copy";let s;return e.externalDropTarget||(i.eventStore.suspendAutoCommit(),r.eventStore.suspendAutoCommit(),s=await t.updateAssignments(i,r,e,n),i.eventStore.resumeAutoCommit(),r.eventStore.resumeAutoCommit()),r.trigger("eventDrop",Object.assign(t.getTriggerParams(e),{isCopy:n,copyMode:t.copyMode,domEvent:e.browserEvent,targetEventRecord:e.targetEventRecord,targetResourceRecord:e.newResource,externalDropTarget:e.externalDropTarget})),s}async updateAssignments(e,t,i,r){const n=this,{copyMode:s}=n,a=e!==t,{isVertical:o}=t,{assignmentStore:l,eventStore:d}=e,{assignmentStore:u,eventStore:h}=t,f=e.isVertical?e.resourceStore:e.store,g=o?t.resourceStore:t.store,{eventRecords:m,assignmentRecords:p,timeDiff:v,initialAssignmentsState:y,resourceRecord:C,newResource:D}=i,{unifiedDrag:w}=n,E=h.usesSingleAssignment||h.usesSingleAssignment!==!1&&d.usesSingleAssignment,R=n.adjustStartDate(p[0].event.startDate,v),x=[],k=[],I=[],A=[],L=[],O=new Set,_=f.getAllDataRecords();e.suspendRefresh(),t.suspendRefresh();let V=!1,Y=!1,J;a?J=g.indexOf(D)-f.indexOf(C):n.constainDragToResource?J=0:o&&g.isGrouped?J=_.indexOf(C)-_.indexOf(D):J=f.indexOf(C)-f.indexOf(D),o&&m.forEach((re,Se)=>{const ie=i.eventBarEls[Se];delete re.instanceMeta(e).hasTemporaryDragElement,ie.dataset.transient&&ie.remove()});const X=i.eventBarEls.slice(),q=[],oe={};for(let re=0;re<p.length;re++){const Se=p[re];let ie=Se.event,le;if(r?(le=Se.copy(),oe[Se.id]=le):le=Se,!le.isOccurrenceAssignment&&(!l.includes(Se)||!d.includes(ie))){X[re].remove(),X.splice(re,1),p.splice(re,1),re--;continue}const ct=y[re],nt=ie,Nt=ct.startDate,xt=ct.resource,ar=this.constrainDragToTimeSlot?Nt:w?R:n.adjustStartDate(Nt,v);if(l!==u){const Je=nt.assignments.length>1||r;let Rt;r?Rt=le:(Rt=le.copy(),oe[le.id]=Rt),Rt.event&&!E&&(Rt.event=Rt.event.id,Rt.resource=Rt.resource.id),r||A.push(le),Je||k.push(nt),(r&&(s==="event"||s==="auto"&&h.usesSingleAssignment)||!h.getById(nt.id))&&(ie=h.createRecord(F(F({},nt.data),{},{id:r&&(s==="event"||s==="auto")?void 0:nt.id,calendar:null})),Rt.set({eventId:ie.id,event:ie}),x.push(ie)),E||I.push(Rt),le=Rt}let Fe=D,uc=null;if(!w)if(a){if(re>0){const Je=f.indexOf(xt);Fe=g.getAt(Je+J)||Fe}}else if(J!==0){var xe;let Je;o&&g.isGrouped?(Je=Math.max(Math.min(_.indexOf(xt)-J,_.length-1),0),Fe=_[Je]):(Je=Math.max(Math.min(f.indexOf(xt)-J,f.count-1),0),Fe=f.getAt(Je),Fe.isSpecialRow&&(Fe=f.getNext(Fe,!1,!0)||f.getPrevious(Fe,!1,!0))),Fe=(xe=Fe)===null||xe===void 0?void 0:xe.$original}else Fe=xt;if(le.resourceId!==Fe.id?(uc=f.getById(le.resourceId),r&&l===u?(le.resource=Fe,le.event=h.getById(le.eventId),(s==="event"||d.usesSingleAssignment&&s==="auto")&&(ie=ie.copy(),le.event=ie,h.usesSingleAssignment&&(ie.resource=Fe,ie.resourceId=Fe.id)),!u.find(Je=>Je.eventId===le.eventId&&Je.resourceId===le.resourceId)&&!I.find(Je=>Je.eventId===le.eventId&&Je.resourceId===le.resourceId)&&(x.push(ie),I.push(le))):le.resource=Fe,ie.isEvent&&O.add(ie),V=!0,ie.isOccurrence&&ie.set("newResource",Fe),a&&E&&(ie.resourceId=Fe.id)):r&&(s==="event"||s==="auto"&&d.usesSingleAssignment)&&!x.includes(ie)&&(ie=ie.copy(),x.push(ie),le.event=ie,h.usesSingleAssignment&&ie.set({resource:Fe,resourceId:Fe.id}),I.push(le)),!L.find(Je=>Je.draggedEvent===ie)&&!b.isEqual(ie.startDate,ar)){for(;!ie.isOccurrence&&ie.isBatchUpdating;)ie.endBatch(!0);ie.startDate=ar,L.push({draggedEvent:ie,originalStartDate:Nt}),ie.isEvent&&O.add(ie),Y=!0}t.processEventDrop({eventRecord:ie,resourceRecord:Fe,element:re===0?i.context.element:i.context.relatedElements[re-1],context:i,toScheduler:t,reassignedFrom:uc,eventsToAdd:x,addedEvents:q,draggedAssignment:le}),t.trigger("processEventDrop",{originalAssignment:Se,draggedAssignment:le,context:i,copyMode:s,isCopy:r})}if(l.remove(A),d.remove(k),u.add(I),r&&l===u){const{syncIdMap:re}=e.foregroundCanvas;Object.entries(oe).forEach(([Se,ie])=>{const le=re[Se];delete re[Se],re[ie.id]=le})}if(x.length&&q.push(...h.add(x)),!n.constrainDragToTimeline)for(let re=0;re<p.length;re++){const Se=oe[p[re].id]||p[re],ie=Se.event,le=q?.find(xt=>xt.id===ie.id)||ie,ct=i.eventBarEls[re],nt=re===0?i.context.element:i.context.relatedElements[re-1],Nt=t.isInTimeAxis(le);if(r||Z.removeChild(ct.parentElement,ct),le.resource&&(o||t.rowManager.getRowFor(le.resource))&&Nt){if(!le.parent||le.parent.isRoot){const xt=$.from(nt,t.foregroundCanvas,!0);S.setTopLeft(nt,xt.y,xt.x),Z.addChild(t.foregroundCanvas,nt,le.assignments[0].id),a&&t.processCrossSchedulerEventDrop({eventRecord:le,toScheduler:t})}nt.classList.remove("b-sch-event-hover","b-active","b-drag-proxy","b-dragging"),nt.retainElement=!1}}q?.forEach(re=>O.add(re)),(A.length||k.length||I.length||x.length)&&(V=!0),(V||Y)&&(E&&O.forEach(re=>re.beginBatch()),await Promise.all([t.project!==e.project?t.project.commitAsync():null,e.project.commitAsync()]),E&&O.forEach(re=>re.endBatch(!1,!0))),V||(V=L.some(({draggedEvent:re,originalStartDate:Se})=>!b.isEqual(re.startDate,Se))),t.resumeRefresh(),e.resumeRefresh(),p.length>0&&(V?(t.fillTicks&&X.forEach(re=>delete re.lastDomConfig),t.refreshWithTransition(),a&&(e.refreshWithTransition(),t.selectedEvents=q)):i.valid=!1)}getProductDragContext(e){const t=this,{currentOverClient:i}=t,r=e.browserEvent.target,n=e.newResource||e.resourceRecord,s=e.targetEventRecord;let a=i?t.resolveEventRecord(r,i):null,o,l;e.eventRecords.includes(a)&&(a=null),t.constrainDragToResource?o=e.resourceRecord:t.constrainDragToTimeline?i&&(o=t.resolveResource()||e.newResource||e.resourceRecord):o=t.resolveResource();const{assignmentRecords:d,eventRecords:u}=e,h=n!==o;let f=Boolean(o&&!o.isSpecialRow);return!o&&t.externalDropTargetSelector&&(l=r.closest(t.externalDropTargetSelector),f=Boolean(l)),{valid:f,externalDropTarget:l,eventRecords:u,assignmentRecords:d,newResource:o,targetEventRecord:a,dirty:h||a!==s,proxyElements:[e.context.element,...e.context.relatedElements||[]]}}getMinimalDragData(e){const t=this,{scheduler:i}=t,r=t.getElementFromContext(e),n=t.resolveEventRecord(r,i),s=i.resolveResourceRecord(r),a=i.resolveAssignmentRecord(r),o=a?[a]:[];a&&(i.isAssignmentSelected(o[0])||t.drag.startEvent.ctrlKey)&&o.push.apply(o,t.getRelatedRecords(a));const l=[...new Set(o.map(d=>d.event))];return{eventRecord:n,resourceRecord:s,assignmentRecord:a,eventRecords:l,assignmentRecords:o}}setupProductDragData(e){var t;const i=this,{scheduler:r}=i,n=i.getElementFromContext(e),{eventRecord:s,resourceRecord:a,assignmentRecord:o,assignmentRecords:l}=i.getMinimalDragData(e),d=[];if(i.constrainDragToResource&&!a)throw new Error("Resource could not be resolved for event: "+s.id);let u;if(i.constrainDragToTimeline){var h;u=(h=i.getDateConstraints)===null||h===void 0?void 0:h.call(i,a,s);const f=i.constrainRectangle=i.getConstrainingRectangle(u,a,s),g=$.from(n,r.timeAxisSubGridElement);super.setupConstraints(f,g,r.timeAxisViewModel.snapPixelAmount,Boolean(u.start))}return l.forEach(f=>{let g=r.getElementFromAssignmentRecord(f,!0);g||(g=r.currentOrientation.addTemporaryDragElement(f.event,f.resource)),d.push(g)}),{record:o,draggedEntities:l,dateConstraints:(t=u)!==null&&t!==void 0&&t.start?u:null,eventBarCopies:d.map(f=>i.createProxy(f)),eventBarEls:d}}getDateConstraints(e,t){var i;const{scheduler:r}=this,n=(i=r.getDateConstraints)===null||i===void 0?void 0:i.call(r,e,t);let s,a;return this.constrainDragToTimeSlot?(s=t.startDate,a=t.endDate):n&&(s=n.start,a=n.end),{start:s,end:a}}getConstrainingRectangle(e,t,i){return this.scheduler.getScheduleRegion(this.constrainDragToResource&&t,i,!0,e&&{start:e.start,end:e.end})}getDragData(e){const t=this.getMinimalDragData(e)||{};return F(F(F({},super.getDragData(e)),t),{},{initialAssignmentsState:t.assignmentRecords.map(i=>({startDate:i.event.startDate,resource:i.resource,assignment:i}))})}getRelatedRecords(e){return this.scheduler.selectedAssignments.filter(t=>t!==e&&!t.resource.readOnly&&t.event.isDraggable)}getCoordinate(e,t,i){const r=this.currentOverClient;if(r.isHorizontal){let n=i[0];if(r.milestoneLayoutMode!=="default"&&e.isMilestone)switch(r.milestoneAlign){case"center":n+=t.offsetWidth/2;break;case"end":n+=t.offsetWidth;break}return n}else{let n=i[1];if(r.milestoneLayoutMode!=="default"&&e.isMilestone)switch(r.milestoneAlign){case"center":n+=t.offsetHeight/2;break;case"end":n+=t.offsetHeight;break}return n}}resolveResource(){const e=this,t=e.currentOverClient,{isHorizontal:i}=t,{context:r,browserEvent:n,dragProxy:s}=e.dragData,a=s||r.element,o=$.from(a,null,!0),l=t.isVertical||e.unifiedDrag?r.clientY:o.center.y,d=$.from(a,t.timeAxisSubGridElement,!0),{x:u,y:h}=d.center,f=e.getMouseMoveEventTarget(n);let g=null;if(t.element.contains(f))if(i){const m=t.rowManager.getRowAt(l);g=m&&t.store.getAt(m.dataIndex)}else g=t.resolveResourceRecord(t.timeAxisSubGridElement.querySelector(".b-sch-timeaxis-cell"),[u,h]);return g}adjustStartDate(e,t){const i=this.currentOverClient;return i.timeAxis.roundDate(new Date(e-0+t),i.snapRelativeToEventStartDate?e:!1)}getRecordElement(e){return this.client.getElementFromAssignmentRecord(e,!0)}getProxyElement(e){if(this.isDragging){const t=this.dragData.assignmentRecords.indexOf(e);if(t>=0)return this.dragData.proxyElements[t]}return null}getMouseMoveEventTarget(e){return e.target}}Vd._$name="EventDrag";G.registerFeature(Vd,!0,"Scheduler");G.registerFeature(Vd,!1,"ResourceHistogram");class us extends ho{get scheduler(){return this.client}get store(){return this.client.eventStore}updateLockLayout(e){this.dragActiveCls=`b-dragcreating${e?" b-dragcreate-lock":""}`}handleBeforeDragCreate(e,t,i){var r;const{resourceRecord:n}=e;if(n.readOnly)return!1;const{scheduler:s}=this,a=!s.isSchedulerPro||t.ignoreResourceCalendar||n.isWorkingTime(e.mousedownDate),o=a&&s.trigger("beforeDragCreate",{resourceRecord:n,date:e.mousedownDate,event:i});return this.dateConstraints=(r=s.getDateConstraints)===null||r===void 0?void 0:r.call(s,n,t),o}dragStart(e){var t;const i=this,{client:r}=i,{eventStore:n,assignmentStore:s,enableEventAnimations:a}=r,{resourceRecord:o}=e,l=i.createEventRecord(e),d=[o];if(l.set("duration",b.diff(l.startDate,l.endDate,l.durationUnit,!0)),l.isCreating=!0,l.meta.isDragCreating=!0,r.features.taskEdit&&r.features.taskEdit.doCancel(),i.handleBeforeDragCreate(e,l,e.event)===!1)return!1;let u=[];return o&&(u=s.assignEventToResource(l,o)),r.trigger("beforeEventAdd",{eventRecord:l,resourceRecords:d,assignmentRecords:u})===!1?(s.remove(u),!1):(i.lockLayout&&(l.meta.excludeFromLayout=!0),(t=r.onEventCreated)===null||t===void 0||t.call(r,l),r.enableEventAnimations=!1,n.addAsync(l).then(()=>r.enableEventAnimations=a),r.isCreating=!0,r.refreshRows(),r.isCreating=!1,e.itemElement=e.element=r.getElementFromEventRecord(l),S.isInView(e.itemElement)||r.scrollable.scrollIntoView(e.itemElement,{animate:!0,edgeOffset:r.barMargin}),super.dragStart(e))}checkValidity(e,t){const i=this,{client:r}=i;return e.resourceRecord=i.dragging.resourceRecord,(r.allowOverlap||r.isDateRangeAvailable(e.startDate,e.endDate,e.eventRecord,e.resourceRecord))&&i.createValidatorFn.call(i.validatorFnThisObj||i,e,t)}isRowEmpty(e){const t=this.store.getEventsForResource(e);return!t||!t.length}triggerBeforeFinalize(e){this.client.trigger("beforeDragCreateFinalize",e)}createEventRecord(e){const t=this,{client:i}=t,r=i.isHorizontal?"X":"Y",{timeAxis:n,eventStore:s,weekStartDay:a}=i,{event:o,mousedownDate:l}=e,d=t.draggingEnd=o[`page${r}`]>e.startEvent[`page${r}`],u={name:s.modelClass.fieldMap.name.defaultValue||t.L("L{Object.newEvent}"),startDate:d?b.floor(l,n.resolution,null,a):l,endDate:d?l:b.ceil(l,n.resolution,null,a)};return i.project.isGanttProjectMixin&&T.assign(u,{constraintDate:u.startDate,constraintType:"startnoearlierthan"}),s.createRecord(u)}async finalizeDragCreate(e){const{meta:t}=e.eventRecord;return t.excludeFromLayout=!1,t.isDragCreating=!1,this.client.hasEventEditor||(e.eventRecord.isCreating=!1),super.finalizeDragCreate(e)}getTipHtml(...e){const t=super.getTipHtml(...e),{element:i}=this.tip;return i.classList.add("b-sch-dragcreate-tooltip"),i.classList.toggle("b-too-narrow",this.dragging.context.tooNarrow),t}onAborted(e){var t,i;const{eventRecord:r,resourceRecord:n}=e;(t=(i=this.store).unassignEventFromResource)===null||t===void 0||t.call(i,r,n),this.store.remove(r)}}M(us,"$name","EventDragCreate");M(us,"configurable",{validatorFn:()=>!0,lockLayout:!1});us._$name="EventDragCreate";G.registerFeature(us,!0,"Scheduler");G.registerFeature(us,!1,"ResourceHistogram");class go extends he(te){constructor(...e){super(...e),M(this,"targetSelector",".b-sch-timeaxis-cell, .b-timeaxissubgrid")}construct(e,t){e.multiEventSelect=!0,super.construct(e,t)}onElementMouseDown(e){const t=this,{client:i}=t,{foregroundCanvas:r}=i,{target:n,button:s,touches:a,clientX:o,clientY:l}=e,d=$.from(r,!0);a||s!==0||t.disabled||!n.matches(t.targetSelector)||i.trigger("beforeEventDragSelect",{event:e})===!1||(t.startX=o-d.x,t.startY=l-d.y,t.element=S.createElement({tag:"div",className:"b-dragselect-rect",parent:i.foregroundCanvas,retainElement:!0,style:{transform:`translate(${t.startX}px, ${t.startY}px)`}}),i.element.classList.add("b-dragselecting"),i.clearEventSelection(),t.subGridElementRect=$.from(i.timeAxisSubGridElement,!0),i.navigator.disabled=!0,i.enableScrollingCloseToEdges(i.timeAxisSubGrid),t.mouseUpDetacher=B.on({element:document,mouseup:"onDocumentMouseUp",thisObj:t}))}get eventRectangles(){const{client:e}=this;return Array.from(e.element.querySelectorAll(e.eventSelector)).map(t=>({rectangle:$.from(t,!0),record:e.resolveAssignmentRecord(t)}))}onElementMouseMove(e){const t=this;if(typeof t.startX=="number"){const i=t.rectangle=$.from(t.client.foregroundCanvas,!0),r=Math.min(Math.max(e.clientX-i.x,0),i.width+1),n=Math.min(Math.max(e.clientY-i.y,0),i.height+1),s=new $(t.startX,t.startY,r-t.startX,n-t.startY);S.setTranslateXY(t.element,s.x,s.y),t.element.style.width=`${s.width}px`,t.element.style.height=`${s.height}px`,t.updateSelection()}}onDocumentMouseUp(e){var t;const i=this,{client:r}=i,{selectedAssignments:n,navigator:s}=r;if(r.disableScrollingCloseToEdges(r.timeAxisSubGrid),(t=i.element)===null||t===void 0||t.remove(),r.element.classList.remove("b-dragselecting"),i.startX=i.startY=null,s.skipNextClick=r.timeAxisSubGridElement.contains(e.target),s.disabled=!1,n.length){var a;s.skipScrollIntoView=!0,r.activeAssignment=n[n.length-1],(a=s.activeItem)===null||a===void 0||a.focus(),s.skipScrollIntoView=!1}i.mouseUpDetacher()}updateSelection(){const e=this,t=e.rectangle=$.from(e.element,!0),{eventRectangles:i,client:r}=e,n=r.selectedAssignments.reduce((s,a)=>(r.getElementFromAssignmentRecord(a)||s.push(a),s),[]);for(const s of i)t.intersect(s.rectangle,!0)&&!s.selected&&(s.selected=!0,n.push(s.record));r.selectedAssignments=n}}M(go,"$name","EventDragSelect");M(go,"pluginConfig",{chain:["onElementMouseDown","onElementMouseMove"]});go._$name="EventDragSelect";G.registerFeature(go,!1,"Scheduler");class jd extends We{static get type(){return"eventeditor"}static get $name(){return"EventEditor"}static get configurable(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible",scrollable:{overflowY:!0},readOnly:null,titleRenderer:null}}updateLocalization(){super.updateLocalization(...arguments),this.initialTitle=this.title||""}chainResourceStore(){return this.eventEditFeature.resourceStore.chain(e=>!e.isSpecialRow,null,{storeClass:se,excludeCollapsedRecords:!1})}processWidgetConfig(e){var t;if((t=e.type)!==null&&t!==void 0&&t.includes("date")&&e.weekStartDay==null&&(e.weekStartDay=this.weekStartDay),e.type==="extraItems")return!1;const{eventEditFeature:i}=this,r={};if(e.ref==="resourceField"){const{store:n}=e;e.store=this.chainResourceStore(),n&&e.store.setConfig(n),"multiSelect"in e||(e.multiSelect=!i.eventStore.usesSingleAssignment)}return(e.name==="startDate"||e.name==="endDate")&&e.type==="date"&&(r.format=i.dateFormat),(e.name==="startDate"||e.name==="endDate")&&e.type==="time"&&(r.format=i.timeFormat),Object.assign(e,r),super.processWidgetConfig(e)}onBeforeShow(...e){var t;const i=this,{record:r,titleRenderer:n}=i,{deleteButton:s}=i.widgetMap;s&&(s.hidden=i.readOnly||r.isCreating),n?i.title=i.callback(n,i,[r]):i.title=i.initialTitle,(t=super.onBeforeShow)===null||t===void 0||t.call(this,...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}updateReadOnly(e){const{deleteButton:t,saveButton:i,cancelButton:r}=this.widgetMap;super.updateReadOnly(e),t&&(t.hidden=e),i&&(i.hidden=e),r&&(r.hidden=e)}}jd.initClass();jd._$name="EventEditor";class Wd extends We{static get $name(){return"RecurrenceConfirmationPopup"}static get type(){return"recurrenceconfirmation"}static get defaultConfig(){return{localizableProperties:[],align:"b-t",autoShow:!1,autoClose:!1,closeAction:"onRecurrenceClose",modal:!0,centered:!0,scrollAction:"realign",constrainTo:globalThis,draggable:!0,closable:!0,floating:!0,eventRecord:null,cls:"b-sch-recurrenceconfirmation",bbar:{defaults:{localeClass:this},items:{changeSingleButton:{weight:100,cls:"b-raised",color:"b-blue",text:"L{update-only-this-btn-text}",onClick:"up.onChangeSingleButtonClick"},changeMultipleButton:{weight:200,color:"b-green",text:"L{Object.Yes}",onClick:"up.onChangeMultipleButtonClick"},cancelButton:{weight:300,color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelButtonClick"}}}}}get changeMultipleButton(){return this.widgetMap.changeMultipleButton}get changeSingleButton(){return this.widgetMap.changeSingleButton}get cancelButton(){return this.widgetMap.cancelButton}onChangeMultipleButtonClick(){this.processMultipleRecords(),this.hide()}onChangeSingleButtonClick(){this.processSingleRecord(),this.hide()}onCancelButtonClick(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}onRecurrenceClose(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}confirm(e={}){const t=this;return["actionType","eventRecord","title","html","changerFn","cancelFn","finalizerFn","thisObj"].forEach(i=>{i in e&&(t[i]=e[i])}),t.updatePopupContent(),super.show(e)}updatePopupContent(){const e=this,{changeMultipleButton:t,changeSingleButton:i,cancelButton:r}=e.widgetMap,{eventRecord:n,actionType:s="update"}=e;n?.isRecurring?(t.text=e.L("L{Object.Yes}"),e.html=e.L(`${s}-all-message`)):(t.text=e.L(`${s}-further-btn-text`),e.html=e.L(`${s}-further-message`)),i.text=e.L(`${s}-only-this-btn-text`),r.text=e.L("L{Object.Cancel}"),e.width=e.L("L{width}"),e.title=e.L(`${s}-title`)}processMultipleRecords(){const{eventRecord:e,changerFn:t,thisObj:i,finalizerFn:r}=this;e.beginBatch(),t&&this.callback(t,i,[e]),e.endBatch(),r&&this.callback(r,i,[e])}processSingleRecord(){var e;const{eventRecord:t,changerFn:i,thisObj:r,finalizerFn:n}=this;t.beginBatch();let s;t!=null&&t.isRecurring&&t.recurrence.forEachOccurrence(t.startDate,null,(a,o,l)=>{if(l>1)return s=a,!1}),(e=s)===null||e===void 0||e.convertToRealEvent(),t.recurrence=null,i&&this.callback(i,r,[t]),t.recurrenceRule=null,t.endBatch(),n&&this.callback(n,r,[t])}updateLocalization(){this.updatePopupContent(),super.updateLocalization()}}Wd.initClass();Wd._$name="RecurrenceConfirmationPopup";class Qr extends Ze{buildItems(){return[...this.addNone?[{text:"L{None}",value:"NONE"}]:[],{value:"DAILY",text:"L{Daily}"},{value:"WEEKLY",text:"L{Weekly}"},{value:"MONTHLY",text:"L{Monthly}"},{value:"YEARLY",text:"L{Yearly}"}]}}M(Qr,"$name","RecurrenceFrequencyCombo");M(Qr,"type","recurrencefrequencycombo");M(Qr,"configurable",{editable:!1,displayField:"text",valueField:"value",localizeDisplayFields:!0,addNone:!1});Qr.initClass();Qr._$name="RecurrenceFrequencyCombo";class lp extends Qr{static get $name(){return"RecurrenceCombo"}static get type(){return"recurrencecombo"}static get defaultConfig(){return{customValue:"custom",placeholder:"None",splitCls:"b-recurrencecombo-split",items:!0,highlightExternalChange:!1}}buildItems(){const e=this;return[{value:"none",text:"L{None}"},...super.buildItems(),{value:e.customValue,text:"L{Custom}",cls:e.splitCls}]}set value(e){e=e||"none",super.value=e}get value(){return super.value}set recurrence(e){const t=this;e?t.value=t.isCustomRecurrence(e)?t.customValue:e.frequency:t.value=null}isCustomRecurrence(e){const{interval:t,days:i,monthDays:r,months:n}=e;return Boolean(t>1||i&&i.length||r&&r.length||n&&n.length)}}lp.initClass();lp._$name="RecurrenceCombo";class dp extends Ft{static get $name(){return"RecurrenceLegendButton"}static get type(){return"recurrencelegendbutton"}static get defaultConfig(){return{localizableProperties:[],recurrence:null}}set recurrence(e){this._recurrence=e,this.updateLegend()}get recurrence(){return this._recurrence}set eventStartDate(e){this._eventStartDate=e,this.updateLegend()}get eventStartDate(){return this._eventStartDate}updateLegend(){const{recurrence:e}=this;this.text=e?Hd.getLegend(e,this.eventStartDate):""}onLocaleChange(){this.updateLegend()}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}}dp.initClass();dp._$name="RecurrenceLegendButton";class cp extends Ze{static get $name(){return"RecurrenceDaysCombo"}static get type(){return"recurrencedayscombo"}static get defaultConfig(){const e=["SU","MO","TU","WE","TH","FR","SA"],t=e.join(",");return{allDaysValue:t,editable:!1,defaultValue:t,workingDaysValue:e.filter((i,r)=>!b.nonWorkingDays[r]).join(","),nonWorkingDaysValue:e.filter((i,r)=>b.nonWorkingDays[r]).join(","),splitCls:"b-recurrencedays-split",displayField:"text",valueField:"value"}}buildItems(){const e=this;return e._weekDays=null,e.weekDays.concat([{value:e.allDaysValue,text:e.L("L{day}"),cls:e.splitCls},{value:e.workingDaysValue,text:e.L("L{weekday}")},{value:e.nonWorkingDaysValue,text:e.L("L{weekend day}")}])}get weekDays(){const e=this;if(!e._weekDays){const t=b.weekStartDay,i=b.getDayNames().map((r,n)=>({text:r,value:yt.encodeDay(n)}));e._weekDays=i.slice(t).concat(i.slice(0,t))}return e._weekDays}set value(e){const t=this;e&&Array.isArray(e)&&(e=e.join(",")),(!e||!t.store.findRecord("value",e))&&(e=t.defaultValue),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(",")),e}}cp.initClass();cp._$name="RecurrenceDaysCombo";class up extends _t{static get $name(){return"RecurrenceDaysButtonGroup"}static get type(){return"recurrencedaysbuttongroup"}static get defaultConfig(){return{defaults:{cls:"b-raised",toggleable:!0}}}construct(e={}){const t=this;e.columns=7,e.items=t.buildItems(),super.construct(e)}updateItemText(e){const t=yt.decodeDay(e.value)[0];e.text=b.getDayName(t).substring(0,3)}buildItems(){const e=this;if(!e.__items){const t=b.weekStartDay,i=b.getDayNames().map((r,n)=>({text:r.substring(0,3),value:yt.encodeDay(n)}));e.__items=i.slice(t).concat(i.slice(0,t))}return e.__items}set value(e){e&&Array.isArray(e)&&(e=e.join(",")),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(",")),e}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}}up.initClass();up._$name="RecurrenceDaysButtonGroup";class hp extends _t{static get $name(){return"RecurrenceMonthDaysButtonGroup"}static get type(){return"recurrencemonthdaysbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}get minValue(){return 1}get maxValue(){return 31}construct(e={}){const t=this;e.columns=7,e.items=t.buildItems(),super.construct(e)}buildItems(){const e=this,t=[];for(let i=e.minValue;i<=e.maxValue;i++)t.push({text:i+"",value:i});return t}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}}hp.initClass();hp._$name="RecurrenceMonthDaysButtonGroup";class fp extends _t{static get $name(){return"RecurrenceMonthsButtonGroup"}static get type(){return"recurrencemonthsbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}construct(e={}){const t=this;e.columns=4,e.items=t.buildItems(),super.construct(e)}buildItems(){return b.getMonthNames().map((e,t)=>({text:e.substring(0,3),value:t+1}))}updateItemText(e){e.text=b.getMonthName(e.value-1).substring(0,3)}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}}fp.initClass();fp._$name="RecurrenceMonthsButtonGroup";class gp extends Ze{static get $name(){return"RecurrenceStopConditionCombo"}static get type(){return"recurrencestopconditioncombo"}static get defaultConfig(){return{editable:!1,placeholder:"Never",displayField:"text",valueField:"value"}}buildItems(){return[{value:"never",text:this.L("L{Never}")},{value:"count",text:this.L("L{After}")},{value:"date",text:this.L("L{On date}")}]}set value(e){e=e||"never",super.value=e}get value(){return super.value}get recurrence(){return this._recurrence}set recurrence(e){let t=null;e.endDate?t="date":e.count&&(t="count"),this._recurrence=e,this.value=t}}gp.initClass();gp._$name="RecurrenceStopConditionCombo";class mp extends Ze{static get $name(){return"RecurrencePositionsCombo"}static get type(){return"recurrencepositionscombo"}static get defaultConfig(){return{editable:!1,splitCls:"b-sch-recurrencepositions-split",displayField:"text",valueField:"value",defaultValue:1,maxPosition:5}}buildItems(){const e=this;return e.buildDayNumbers().concat([{value:"-1",text:e.L("L{position-1}"),cls:e.splitCls}])}buildDayNumbers(){const e=this;return W.populate(e.maxPosition,t=>({value:t+1,text:e.L(`position${t+1}`)}))}set value(e){const t=this;e&&Array.isArray(e)&&(e=e.join(",")),(!e||!t.store.findRecord("value",e))&&(e=t.defaultValue),super.value=e}get value(){const e=super.value;return e?`${e}`.split(",").map(t=>parseInt(t,10)):[]}}mp.initClass();mp._$name="RecurrencePositionsCombo";class hs extends Ye{updateRecord(e){super.updateRecord(e);const t=this,{frequencyField:i,daysButtonField:r,monthDaysButtonField:n,monthsButtonField:s,monthDaysRadioField:a,positionAndDayRadioField:o,stopRecurrenceField:l}=t.widgetMap;if(e){const d=e.timeSpan,u=d?.startDate;u&&((!e.days||!e.days.length)&&(r.value=[yt.encodeDay(u.getDay())]),(!e.monthDays||!e.monthDays.length)&&(n.value=u.getDate()),(!e.months||!e.months.length)&&(s.value=u.getMonth()+1)),e.days&&e.positions?(o.check(),t.isPainted||a.uncheck()):(a.check(),t.isPainted||o.uncheck()),l.recurrence=e}else i.value="NONE"}syncEventRecord(e){const t=this.getValues(i=>i.name in e&&!i.disabled);"endDate"in t||(t.endDate=null),"count"in t||(t.count=null),e.set(t)}toggleStopFields(){const e=this,{countField:t,endDateField:i}=e.widgetMap;switch(e.widgetMap.stopRecurrenceField.value){case"count":t.show(),t.enable(),i.hide(),i.disable();break;case"date":t.hide(),t.disable(),i.show(),i.enable();break;default:t.hide(),i.hide(),t.disable(),i.disable()}}onMonthDaysRadioFieldChange({checked:e}){const{monthDaysButtonField:t}=this.widgetMap;t.disabled=!e||!this.isWidgetAvailableForFrequency(t)}onPositionAndDayRadioFieldChange({checked:e}){const{daysCombo:t,positionsCombo:i}=this.widgetMap;t.disabled=i.disabled=!e||!this.isWidgetAvailableForFrequency(t)}onStopRecurrenceFieldChange(){this.toggleStopFields()}isWidgetAvailableForFrequency(e,t=this.widgetMap.frequencyField.value){return!e.forFrequency||e.forFrequency.includes(t)}onFrequencyFieldChange({value:e,oldValue:t,valid:i}){const r=this,n=r.queryAll(o=>"forFrequency"in o),{intervalField:s,stopRecurrenceField:a}=r.widgetMap;if(i&&e){for(let o=0;o<n.length;o++){const l=n[o];r.isWidgetAvailableForFrequency(l,e)?(l.show(),l.enable()):(l.hide(),l.disable())}s.hidden=a.hidden=e==="NONE",e!=="NONE"&&(s.hint=r.L(`L{RecurrenceEditor.${e}intervalUnit}`)),t==="NONE"&&s.value==null&&(s.value=1),r.toggleFieldsState()}}toggleFieldsState(){const e=this,{widgetMap:t}=e;e.onMonthDaysRadioFieldChange({checked:t.monthDaysRadioField.checked}),e.onPositionAndDayRadioFieldChange({checked:t.positionAndDayRadioField.checked}),e.onStopRecurrenceFieldChange()}updateLocalization(){const{countField:e,intervalField:t,frequencyField:i}=this.widgetMap;e.hint=this.L("L{RecurrenceEditor.time(s)}"),i.value&&i.value!=="NONE"&&(t.hint=this.L(`L{RecurrenceEditor.${i.value}intervalUnit}`)),super.updateLocalization()}}M(hs,"$name","RecurrenceEditorPanel");M(hs,"type","recurrenceeditorpanel");M(hs,"configurable",{cls:"b-recurrenceeditor",record:!1,addNone:!1,items:{frequencyField:{type:"recurrencefrequencycombo",name:"frequency",label:"L{RecurrenceEditor.Frequency}",weight:10,onChange:"up.onFrequencyFieldChange",addNone:"up.addNone"},intervalField:{type:"numberfield",weight:15,name:"interval",label:"L{RecurrenceEditor.Every}",min:1,required:!0},daysButtonField:{type:"recurrencedaysbuttongroup",weight:20,name:"days",forFrequency:"WEEKLY"},monthDaysRadioField:{type:"checkbox",weight:30,toggleGroup:"radio",forFrequency:"MONTHLY",label:"L{RecurrenceEditor.Each}",checked:!0,onChange:"up.onMonthDaysRadioFieldChange"},monthDaysButtonField:{type:"recurrencemonthdaysbuttongroup",weight:40,name:"monthDays",forFrequency:"MONTHLY"},monthsButtonField:{type:"recurrencemonthsbuttongroup",weight:50,name:"months",forFrequency:"YEARLY"},positionAndDayRadioField:{type:"checkbox",weight:60,toggleGroup:"radio",forFrequency:"MONTHLY|YEARLY",label:"L{RecurrenceEditor.On the}",onChange:"up.onPositionAndDayRadioFieldChange"},positionsCombo:{type:"recurrencepositionscombo",weight:80,name:"positions",forFrequency:"MONTHLY|YEARLY"},daysCombo:{type:"recurrencedayscombo",weight:90,name:"days",forFrequency:"MONTHLY|YEARLY",flex:1},stopRecurrenceField:{type:"recurrencestopconditioncombo",weight:100,label:"L{RecurrenceEditor.End repeat}",onChange:"up.onStopRecurrenceFieldChange"},countField:{type:"numberfield",weight:110,name:"count",min:2,required:!0,disabled:!0,label:" "},endDateField:{type:"datefield",weight:120,name:"endDate",hidden:!0,disabled:!0,label:" ",required:!0}}});hs.initClass();hs._$name="RecurrenceEditorPanel";class pp extends We{static get $name(){return"RecurrenceEditor"}static get type(){return"recurrenceeditor"}static get configurable(){return{draggable:!0,closable:!0,floating:!0,cls:"b-recurrenceeditor",title:"L{Repeat event}",autoClose:!0,width:470,items:{recurrenceEditorPanel:{type:"recurrenceeditorpanel",title:null}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler",weight:100},saveButton:{color:"b-green",text:"L{Save}",onClick:"up.onSaveClick",weight:200},cancelButton:{color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick",weight:300}}}}}updateReadOnly(e){super.updateReadOnly(e),this.bbar.hidden=e}get recurrenceEditorPanel(){return this.widgetMap.recurrenceEditorPanel}updateRecord(e){this.recurrenceEditorPanel.record=e}onSaveClick(){const e=this;e.saveHandler?e.saveHandler.call(e.thisObj||e,e,e.record):(e.recurrenceEditorPanel.syncEventRecord(),e.close())}onCancelClick(){const e=this;e.cancelHandler?e.cancelHandler.call(e.thisObj||e,e,e.record):e.close()}}pp.initClass();pp._$name="RecurrenceEditor";var dE=c=>class extends(c||P){static get $name(){return"RecurringEventEdit"}static get configurable(){return{recurringEventsItems:{recurrenceCombo:{type:"recurrencecombo",label:"L{EventEdit.Repeat}",ref:"recurrenceCombo",weight:700},editRecurrenceButton:{type:"recurrencelegendbutton",ref:"editRecurrenceButton",name:"recurrenceRule",color:"b-gray",menuIcon:null,flex:1,weight:800,ignoreParentReadOnly:!0}},showRecurringUI:null}}changeEditorConfig(t){return t.items=F(F({},t.items),this.recurringEventsItems),t=super.changeEditorConfig(t),t}construct(t,i){super.construct(t,i),this.scheduler.ion({beforeEventSave:"onRecurrableEventBeforeSave",thisObj:this})}doDestroy(){var t,i;(t=this._recurrenceConfirmation)===null||t===void 0||t.destroy(),(i=this._recurrenceEditor)===null||i===void 0||i.destroy(),super.doDestroy()}onEditorConstructed(t){var i;const r=this;t.ion({hide:r.onRecurringEventEditorHide,thisObj:r}),r.editRecurrenceButton&&(r.editRecurrenceButton.menu=r.recurrenceEditor),(i=r.recurrenceCombo)===null||i===void 0||i.ion({change:r.onRecurrenceComboChange,thisObj:r})}updateReadOnly(t){this._recurrenceEditor&&(this._recurrenceEditor.readOnly=t)}internalShowEditor(){this.toggleRecurringFieldsVisibility(this.client.enableRecurringEvents&&this.showRecurringUI!==!1)}toggleRecurringFieldsVisibility(t=!0){var i,r,n,s;const a=t?"show":"hide";(i=this.editRecurrenceButton)===null||i===void 0||(r=i[a])===null||r===void 0||r.call(i),(n=this.recurrenceCombo)===null||n===void 0||(s=n[a])===null||s===void 0||s.call(n)}onRecurringEventEditorHide(){var t,i;(t=this.recurrenceEditor)!==null&&t!==void 0&&t.isVisible&&this.recurrenceEditor.hide(),(i=this.recurrenceConfirmation)!==null&&i!==void 0&&i.isVisible&&this.recurrenceConfirmation.hide()}makeRecurrence(t){const i=this.eventRecord,r=i.copy();let n=i.recurrence;return!t&&n?n=n.copy():n=new i.recurrenceModel(t?{rule:t}:{}),n.timeSpan=r,r.setStartDate(this.values.startDate),n.suspendTimeSpanNotifying(),n}onRecurrableEventBeforeSave({eventRecord:t,context:i}){const r=this;r.isEditing&&!t.isCreating&&t.supportsRecurring&&(t.isRecurring||t.isOccurrence)&&(r.recurrenceConfirmation.confirm({actionType:"update",eventRecord:t,changerFn(){i.finalize(!0)},cancelFn(){i.finalize(!1)}}),i.async=!0)}set recurrenceConfirmation(t){this._recurrenceConfirmation=t}get recurrenceConfirmation(){const t=this;let i=t._recurrenceConfirmation;return(!i||!i.$$name)&&(i=N.create(F({type:"recurrenceconfirmation",owner:t.editor},i)),t._recurrenceConfirmation=i),i}set recurrenceEditor(t){this._recurrenceEditor=t}get recurrenceEditor(){const t=this;let i=t._recurrenceEditor;return(!i||!i.$$name)&&(t._recurrenceEditor=i=N.create(F({type:"recurrenceeditor",autoShow:!1,centered:!0,modal:!0,constrainTo:globalThis,anchor:!1,rootElement:t.rootElement,saveHandler:t.recurrenceEditorSaveHandler,onBeforeShow:t.onBeforeShowRecurrenceEditor.bind(t),thisObj:t},i)),i.readOnly=t._readOnly),i}onBeforeShowRecurrenceEditor(){const t=this,{recurrenceEditor:i,eventRecord:r}=t;i&&r!==null&&r!==void 0&&r.supportsRecurring&&(t.recurrence||(t.recurrence=t.makeRecurrence()),t.recurrence.timeSpan.setStartDate(t.values.startDate),i.record=t.recurrence,i.centered=!0)}loadRecurrenceData(t){this.recurrence=t,this.updateRecurrenceFields(t)}updateRecurrenceFields(t){const i=this,{editRecurrenceButton:r}=i;i.recurrenceCombo&&(i.recurrenceCombo.recurrence=t),r&&(r.recurrence=t,r.value=t?t.rule:null,t&&i.client.enableRecurringEvents&&i.showRecurringUI!==!1?r.show():r.hide())}onRecurrenceComboChange({source:t,value:i,userAction:r}){if(r){const n=this,{recurrenceEditor:s}=n;i===t.customValue?(n.recurrenceCombo.recurrence=n.makeRecurrence(),s.centered?s.show():s.show((n.editRecurrenceButton||t).element)):n.loadRecurrenceData(i&&i!=="none"?n.makeRecurrence(`FREQ=${i}`):null)}}recurrenceEditorSaveHandler(t,i){t.recurrenceEditorPanel.syncEventRecord(i),this.updateRecurrenceFields(i),t.close()}onDatesChange(...t){if(super.onDatesChange(...t),!this.loadingRecord&&this.editRecurrenceButton){const{startDate:i}=this.values;i&&(this.editRecurrenceButton.eventStartDate=i)}}internalLoadRecord(t){t!=null&&t.supportsRecurring&&this.loadRecurrenceData(t.recurrence?this.makeRecurrence():null)}updateRecord(t){return t.recurrenceRule&&!this.recurrence&&(t.recurrenceRule=null),super.updateRecord(t)}};class vp extends Ze{static get $name(){return"ResourceCombo"}static get type(){return"resourcecombo"}static get configurable(){return{showEventColor:!1,picker:{cls:"b-resourcecombo-picker",itemIconTpl(e,t){const{eventColor:i}=e,r=!S.isNamedColor(i),n=i?r?` style="color:${i}"`:"":' style="display:none"';return`<div class="b-icon b-icon-square${!i||r?"":` b-sch-foreground-${i}`}"${n}></div>`}}}}changeShowEventColor(e){return Boolean(e)}updateShowEventColor(e){const{_picker:t}=this,i=e?"add":"remove";this.element.classList[i]("b-show-event-color"),t?.element.classList[i]("b-show-event-color")}changePicker(e,t){var i;return e=super.changePicker(e,t),(i=e)===null||i===void 0||i.element.classList[this.showEventColor?"add":"remove"]("b-show-event-color"),e}get innerElements(){return[{class:"b-icon b-resource-icon b-icon-square b-hide-display",reference:"resourceIcon"},this.inputElement]}syncInputFieldValue(){var e,t;const i=this,{resourceIcon:r,lastResourceIconCls:n}=i,{classList:s}=r,a=(e=(t=i.selected)===null||t===void 0?void 0:t.eventColor)!==null&&e!==void 0?e:"";super.syncInputFieldValue(),r.style.color="",n&&s.remove(n),i.lastResourceIconCls=null,a?(S.isNamedColor(a)?(i.lastResourceIconCls=`b-sch-foreground-${a}`,s.add(i.lastResourceIconCls)):r.style.color=a,s.remove("b-hide-display")):s.add("b-hide-display")}}vp.initClass();vp._$name="ResourceCombo";const pf=/[^\w\d]/g;class fs extends rp.mixin(dE,he){static get $name(){return"EventEdit"}static get configurable(){return{triggerEvent:"eventdblclick",typeField:"eventType",eventRecord:null,readOnly:null,editorConfig:{type:"eventeditor",title:"L{EventEdit.Edit event}",closable:!0,localeClass:this,defaults:{localeClass:this},items:{nameField:{type:"text",label:"L{Name}",clearable:!0,name:"name",weight:100,required:!0},resourceField:{type:"resourcecombo",label:"L{Resource}",name:"resource",editable:!0,valueField:"id",displayField:"name",highlightExternalChange:!1,destroyStore:!0,weight:200},startDateField:{type:"date",cls:"b-inline",clearable:!1,required:!0,label:"L{Start}",name:"startDate",validateDateOnly:!0,weight:300},startTimeField:{type:"time",clearable:!1,required:!0,name:"startDate",cls:"b-match-label",weight:400},endDateField:{type:"date",cls:"b-inline",clearable:!1,required:!0,label:"L{End}",name:"endDate",validateDateOnly:!0,weight:500},endTimeField:{type:"time",clearable:!1,required:!0,name:"endDate",cls:"b-match-label",weight:600}},bbar:{hideWhenEmpty:!0,defaults:{localeClass:this},items:{saveButton:{color:"b-blue",cls:"b-raised",text:"L{Save}",weight:100},deleteButton:{text:"L{Delete}",weight:200},cancelButton:{text:"L{Object.Cancel}",weight:300}}}},targetEventElement:null}}static get pluginConfig(){return{chain:["populateEventMenu","onEventEnterKey","editEvent"]}}construct(e,t){this.readOnly=e.readOnly,super.construct(e,t),e.ion({projectChange:"onChangeProject",readOnly:"onClientReadOnlyToggle",thisObj:this})}get scheduler(){return this.client}get readOnly(){return this._editor?this.editor.readOnly:this._readOnly}updateReadOnly(e){super.updateReadOnly(e),this._editor&&(this.editor.readOnly=e)}onClientReadOnlyToggle({readOnly:e}){this.readOnly=e}get editor(){var e,t,i,r,n;const s=this,a={beforehide:"resetEditingContext",beforeshow:"onBeforeEditorShow",keydown:"onPopupKeyDown",thisObj:s};let{_editor:o}=s;return o||(o=s._editor=N.create(s.getEditorConfig()),!o.floating&&!o.positioned&&(o.element.parentNode||s.client.add(o),delete a.beforehide,delete a.beforShow,a.beforeToggleReveal="onBeforeEditorToggleReveal"),o.readOnly=s._readOnly,o.items.length===0&&console.warn("Event Editor configured without any `items`"),o.ion(a),s.scheduler.relayEvents(o,["beforeSetRecord"],"eventEdit"),Object.values(o.widgetMap).forEach(l=>{const d=l.ref||l.id;if(d&&!s[d])switch(s[d]=l,l.name){case"startDate":case"endDate":l.ion({change:"onDatesChange",thisObj:s});break}}),(e=s.onEditorConstructed)===null||e===void 0||e.call(s,o),(t=s.eventTypeField)===null||t===void 0||t.ion({change:"onEventTypeChange",thisObj:s}),(i=s.saveButton)===null||i===void 0||i.ion({click:"onSaveClick",thisObj:s}),(r=s.deleteButton)===null||r===void 0||r.ion({click:"onDeleteClick",thisObj:s}),(n=s.cancelButton)===null||n===void 0||n.ion({click:"onCancelClick",thisObj:s}),o)}getEditorConfig(){const e=this,t=new Date(2e3,12,31,23,55,55),i=b.format(t,e.dateFormat).replace(pf,"").length,r=b.format(t,e.timeFormat).replace(pf,"").length,n=i+r,{cls:s,scheduler:a}=e,o=T.assign({owner:a,eventEditFeature:e,weekStartDay:e.weekStartDay,align:"b-t",id:`${a.id}-event-editor`,autoShow:!1,anchor:!0,scrollAction:"realign",constrainTo:globalThis,cls:s},e.editorConfig);return N.prototype.getRenderContext(o)[0]&&(o.floating=!1),o.floating===!1&&!o.positioned&&(o.collapsible={type:"overlay",direction:"right",autoClose:!1,tool:null,recollapseTool:null},o.collapsed=!0,o.hidden=o.anchor=!1,o.hide=function(){this.collapsible.toggleReveal(!1)}),o.onElementCreated=function({element:l}){l.style.setProperty("--date-time-length",`${n}em`),l.style.setProperty("--date-width-difference",`${(i-r)/2}em`)},o}internalShowEditor(e,t,i=null){var r,n,s;const a=this,{scheduler:o}=a,l=((r=i)===null||r===void 0||(n=r.target)===null||n===void 0?void 0:n.nodeType)===Element.ELEMENT_NODE?i.target:o.getElementFromEventRecord(e,t),d=e.isPartOfStore(o.eventStore);if(i=(s=i)!==null&&s!==void 0?s:{target:l,anchor:!0},i.target||!d||e.isCreating){var u;if(o.trigger("beforeEventEdit",{eventEdit:a,eventRecord:e,resourceRecord:t,eventElement:l})===!1)return o.element.classList.remove("b-eventeditor-editing"),!1;a.resourceRecord=t;const{editor:h}=a;a.editingContext={eventRecord:e,resourceRecord:t,eventElement:l,editor:h,isPartOfStore:d},(u=super.internalShowEditor)===null||u===void 0||u.call(this,e,t,i),a.typeField&&a.toggleEventType(e.get(a.typeField)),a.loadRecord(e,t),h.collapsed?h.setTimeout(async()=>{await h.collapsible.toggleReveal(!0),h.focus()},100):h.centered||!h.anchor||!h.floating?h.show():l?(a.targetEventElement=l,h.showBy(i)):(h.show(),h.updateCentered(!0));const f=o.timeAxisViewModel.timeResolution;if(f.unit==="hour"||f.unit==="minute"){const g=`${f.increment}${f.unit}`;a.startTimeField&&(a.startTimeField.step=g),a.endTimeField&&(a.endTimeField.step=g)}a.detachListeners("changesWhileEditing"),o.eventStore.ion({change:a.onChangeWhileEditing,refresh:a.onChangeWhileEditing,thisObj:a,name:"changesWhileEditing"})}}onChangeWhileEditing(){const e=this;e.isEditing&&e.editingContext.isPartOfStore&&!e.eventRecord.isPartOfStore(e.scheduler.eventStore)&&e.onCancelClick()}onBeforeEditorShow(){super.onBeforeEditorShow(...arguments),this.scheduler.trigger("beforeEventEditShow",F({eventEdit:this},this.editingContext))}updateTargetEventElement(e,t){e?.classList.add("b-editing"),t?.classList.remove("b-editing")}editEvent(e,t,i=null){const r=this,{simpleEventEdit:n}=r.client.features;if(r.isEditing&&r.resetEditingContext(),r.disabled||e.readOnly||e.isCreating&&n!==null&&n!==void 0&&n.enabled)return;const s=r.doEditEvent(...arguments);return r.isEditing&&r.scheduler.element.classList.add("b-eventeditor-editing"),s}get isEditing(){const{_editor:e}=this;return Boolean(e?.isVisible&&!(e.collapsed&&!e.revealed))}doEditEvent(e,t,i=null){const r=this,{scheduler:n}=r,s=e.isCreating;t||(t=e.resource||r.resourceStore.getById(e.resourceId)),s&&Ct.prototype.normalize.call(e),i||s?r.internalShowEditor(e,t,i?{target:i}:null):n.scrollResourceEventIntoView(t,e,{animate:!0,edgeOffset:0,extendTimeAxis:!1}).then(()=>r.internalShowEditor(e,t),()=>n.element.classList.remove("b-eventeditor-editing"))}loadRecord(e,t){this.loadingRecord=!0,this.internalLoadRecord(e,t),this.loadingRecord=!1}get eventRecord(){var e;return(e=this._editor)===null||e===void 0?void 0:e.record}internalLoadRecord(e,t){var i;const r=this,{eventStore:n}=r.client,{editor:s,resourceField:a}=r;if(r.resourceRecord=t,a&&((i=a.store)===null||i===void 0?void 0:i.masterStore)!==r.resourceStore&&(a.store=s.chainResourceStore()),s.record=e,a){const o=n.assignmentStore.getResourcesForEvent(e);s.assigningValues=!0,!e.isOccurrence&&!n.storage.includes(e,!0)&&t?r.resourceField.value=t[r.resourceField.valueField]:r.assignmentStore&&(r.resourceField.value=o.map(l=>l[r.resourceField.valueField])),s.assigningValues=!1}super.internalLoadRecord(e,t)}toggleEventType(e){this.editor.element.dataset.eventType=e||"",this.editor.eachWidget(t=>{var i;!((i=t.dataset)===null||i===void 0)&&i.eventType&&(t.hidden=t.dataset.eventType!==e)})}async finalizeEventSave(e,t,i,r){const n=this,{scheduler:s,assignmentStore:a}=n;a.suspendAutoCommit(),s.suspendRefresh(),n.onBeforeSave(e),e.beginBatch(),n.updateRecord(e),e.endBatch(),e.isOccurrence?t&&e.set("resourceRecords",t):n.resourceField&&a.assignEventToResource(e,t,null,!0),e.isCreating=!1,await s.project.commitAsync(),a.resumeAutoCommit(),s.resumeRefresh(!0),s.trigger("afterEventSave",{eventRecord:e}),n.onAfterSave(e),i(e)}save(){return new Promise((e,t)=>{var i;const r=this,{scheduler:n,eventRecord:s}=r;if(!s||!r.editor.isValid){e(!1);return}const{eventStore:a,values:o}=r,l=((i=r.resourceField)===null||i===void 0?void 0:i.records)||(r.resourceRecord?[r.resourceRecord]:[]);if(!r.scheduler.allowOverlap&&a){let{startDate:u,endDate:h}=o;if(h||("duration"in o?h=b.add(u,o.duration,o.durationUnit||s.durationUnit):"fullDuration"in o?h=b.add(u,o.fullDuration):h=s.endDate),l.some(g=>!a.isDateRangeAvailable(u,h,s,g))){e(!1);return}}const d={finalize(u){try{u!==!1?r.finalizeEventSave(s,l,e,t):e(!1)}catch(h){t(h)}}};if(n.trigger("beforeEventSave",{eventRecord:s,resourceRecords:l,values:o,context:d})===!1){e(!1);return}d.async||d.finalize()})}deleteEvent(){return this.detachListeners("changesWhileEditing"),new Promise((e,t)=>{const i=this,{eventRecord:r,editor:n}=i;i.scheduler.removeEvents([r],s=>{s&&n.containsFocus&&n.revertFocus(),e(s)},n)})}onChangeProject(){this.resourceField&&(this.resourceField.store={})}get eventStore(){return this.scheduler.project.eventStore}get resourceStore(){return this.scheduler.project.resourceStore}get assignmentStore(){return this.scheduler.project.assignmentStore}onActivateEditor({eventRecord:e,resourceRecord:t,eventElement:i}){this.editEvent(e,t,i)}onDragCreateEnd({eventRecord:e,resourceRecord:t,proxyElement:i}){this.editEvent(e,t,i)}onEventEnterKey({assignmentRecord:e,eventRecord:t,target:i}){const{client:r}=this,n=i[i.matches(r.eventSelector)?"querySelector":"closest"](r.eventInnerSelector);e?this.editEvent(t,e.resource,n):t&&this.editEvent(t,t.resource,n)}onEventTypeChange({value:e}){this.toggleEventType(e)}populateEventMenu({eventRecord:e,resourceRecord:t,items:i}){!this.scheduler.readOnly&&!this.disabled&&(i.editEvent={text:"L{EventEdit.Edit event}",localeClass:this,icon:"b-icon b-icon-edit",weight:100,disabled:e.readOnly,onItem:()=>{this.editEvent(e,t)}})}onBeforeEditorToggleReveal({reveal:e}){this[e?"onBeforeEditorShow":"resetEditingContext"]()}resetEditingContext(){this.detachListeners("changesWhileEditing"),super.resetEditingContext(),this.resourceRecord=null}}fs._$name="EventEdit";G.registerFeature(fs,!0,"Scheduler");G.registerFeature(fs,!1,["SchedulerPro","ResourceHistogram"]);fs.initClass();class mo extends te{static get $name(){return"EventFilter"}static get pluginConfig(){return{chain:["populateTimeAxisHeaderMenu"]}}populateTimeAxisHeaderMenu({items:e}){const t=this;e.eventsFilter={text:"L{filterEvents}",icon:"b-fw-icon b-icon-filter",disabled:t.disabled,localeClass:t,weight:100,menu:{type:"popup",localeClass:t,items:{nameFilter:{weight:110,type:"textfield",cls:"b-eventfilter b-last-row",clearable:!0,keyStrokeChangeDelay:300,label:"L{byName}",localeClass:t,width:200,internalListeners:{change:t.onEventFilterChange,thisObj:t}}},onBeforeShow({source:i}){const[r]=i.items,n=t.store.filters.getBy("property","name");r.value=n?.value||""}}}}onEventFilterChange({value:e}){e!==""?this.store.filter("name",e):this.store.removeFilter("name")}get store(){const{client:e}=this;return e.isGanttBase?e.store:e.eventStore}}mo.featureClass="b-event-filter";mo._$name="EventFilter";G.registerFeature(mo,!0,["Scheduler","Gantt"]);G.registerFeature(mo,!1,"ResourceHistogram");class gs extends zd{static get $name(){return"EventMenu"}static get configurable(){return{processItems:null,type:"event"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateEventMenu"),e}get resourceStore(){return this.client.isHorizontal?this.client.store:this.client.resourceStore}getDataFromEvent(e){var t;const i=super.getDataFromEvent(e),r=i.targetElement,{client:n}=this,s=n.resolveEventRecord(r),a=s&&((t=n.resolveResourceRecord(r)||this.resourceStore.last)===null||t===void 0?void 0:t.$original),o=s&&n.resolveAssignmentRecord(r);return Object.assign(i,{eventElement:r,eventRecord:s,resourceRecord:a,assignmentRecord:o})}getTargetElementFromEvent({target:e}){return e.closest(this.client.eventSelector)||e}shouldShowMenu(e){return e.eventRecord}showContextMenuFor(e,{targetElement:t,event:i}={}){this.disabled||!t&&(t=this.getElementFromRecord(e),!t)||S.triggerMouseEvent(t,this.tiggerEvent)}getElementFromRecord(e){return this.client.getElementsFromEventRecord(e)[0]}populateEventMenu({items:e,eventRecord:t,assignmentRecord:i}){const{client:r}=this;e.deleteEvent={disabled:t.readOnly||i?.readOnly,hidden:r.readOnly},e.unassignEvent={disabled:t.readOnly||i?.readOnly,hidden:r.readOnly||r.eventStore.usesSingleAssignment}}changeItems(e){const{client:t}=this;return U.merge({deleteEvent:{text:"L{SchedulerBase.Delete event}",icon:"b-icon b-icon-trash",weight:200,onItem({menu:i,eventRecord:r}){var n;const s=(n=i.focusInEvent)===null||n===void 0?void 0:n.relatedTarget;s&&(s.focus(),t.navigator.activeItem=s),t.removeEvents(t.isEventSelected(r)?t.selectedEvents:[r])}},unassignEvent:{text:"L{SchedulerBase.Unassign event}",icon:"b-icon b-icon-unassign",weight:300,onItem({menu:i,eventRecord:r,resourceRecord:n}){var s;const a=(s=i.focusInEvent)===null||s===void 0?void 0:s.relatedTarget;a&&(a.focus(),t.navigator.activeItem=a),r.unassign(n)}}},e)}}gs.featureClass="";gs._$name="EventMenu";G.registerFeature(gs,!0,"Scheduler");G.registerFeature(gs,!1,"ResourceHistogram");var yp=c=>{var e;return e=class extends c{getNonWorkingTimeRanges(i,r,n){if(!i.getNonWorkingTimeRanges){const s=[];return i.forEachAvailabilityInterval({startDate:r,endDate:n,isForward:!0},(a,o,l)=>{for(const[d,u]of l.intervalGroups)u.getIsWorking()||s.push({name:d.name,iconCls:d.iconCls,cls:d.cls,startDate:a,endDate:o})}),s}return i.getNonWorkingTimeRanges(r,n)}getCalendarTimeRanges(i,r=!1){const n=this,{timeAxis:s,fillTicks:a}=n.client,{unit:o,increment:l}=s,d=!n.maxTimeAxisUnit||b.compareUnits(o,n.maxTimeAxisUnit)<=0;if(i&&d&&s.count){const u=n.getNonWorkingTimeRanges(i,s.startDate,s.endDate),h=u.map(m=>new Ct({name:m.name,cls:`b-nonworkingtime ${m.cls||""}`,startDate:m.startDate,endDate:m.endDate})),f=[];let g=null;for(const m of h)g&&m.startDate<=g.endDate&&(r||m.name===g.name)&&m.duration>0?g.endDate=m.endDate:(f.push(m),m.id=`nonworking-${f.length}`,g=m);return a&&f.forEach(m=>{m.setStartEndDate(b.ceil(m.startDate,{magnitude:l,unit:o}),b.floor(m.endDate,{magnitude:l,unit:o}))}),f}else return[]}setupDefaultCalendar(){const{client:i,project:r}=this;!this.autoGeneratedWeekends&&!i.isSchedulerPro&&!i.isGantt&&r.effectiveCalendar===r.defaultCalendar&&!r.defaultCalendar.intervalStore.count&&(this.autoGeneratedWeekends=!0,this.updateDefaultCalendar())}updateDefaultCalendar(){if(this.autoGeneratedWeekends){const i=this.client.project.effectiveCalendar,r=this.defaultNonWorkingIntervals,n=Boolean(r.length);i.clearIntervals(n),n&&i.addIntervals(r)}}updateLocalization(){var i;(i=super.updateLocalization)===null||i===void 0||i.call(this),this.autoGeneratedWeekends&&this.updateDefaultCalendar()}get defaultNonWorkingIntervals(){const i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return b.nonWorkingDaysAsArray.map(r=>({recurrentStartDate:`on ${i[r]} at 0:00`,recurrentEndDate:`on ${i[(r+1)%7]} at 0:00`,isWorking:!1}))}},M(e,"$name","NonWorkingTimeMixin"),M(e,"configurable",{maxTimeAxisUnit:"week"}),e};class ms extends te.mixin(Mi,yp){doDisable(e){this.client.refresh(),super.doDisable(e)}attachToCalendarManagerStore(e){super.attachToCalendarManagerStore(e);const t=this;e.ion({name:"calendarManagerStore",change:"onCalendarChange",thisObj:t}),t.client.isScheduler&&t.project.effectiveCalendar.intervals.ion({name:"calendarManagerStore",change:"onCalendarChange",thisObj:t}),t.setupDefaultCalendar()}onCalendarChange(){this.calendarRangeCache.clear()}onTimeAxisViewModelUpdate(){this.calendarRangeCache.clear()}getRangeDomConfig(e,t,i,r){const n=this,{client:s}=n,{rtl:a}=s,o=s.getCoordinateFromDate(b.max(e.startDate,t))-r,l=e.endDate?s.getCoordinateFromDate(b.min(e.endDate,i))-r:o,d=Math.abs(l-o),u=d>0,h=a?`calc(${o}px - 100%)`:`${o}px`;return{className:{"b-sch-timerange":1,"b-sch-range":1,"b-sch-nonworkingtime":1,[e.cls]:e.cls,"b-rtl":a},dataset:{id:e.id},elementData:{timeRange:e},style:s.isVertical?`transform: translateY(${h}); ${u?`height:${d}px`:""};`:`transform: translateX(${h}); ${u?`width:${d}px`:""};`}}getCalendarTimeRanges(e){let t=this.calendarRangeCache.get(e);return t||(t=super.getCalendarTimeRanges(e,!0),this.calendarRangeCache.set(e,t)),t}onEventDataGenerated({eventRecord:e,endMS:t,startMS:i,start:r,end:n,left:s,top:a,children:o}){if(this.enabled){var l;const{isVertical:d}=this.client,u=(l=e.effectiveCalendarsCombination)!==null&&l!==void 0?l:this.client.project.calendar;for(const h of this.getCalendarTimeRanges(u))if(h.startDateMS<t&&h.endDateMS>i){const f=this.getRangeDomConfig(h,r,n,d?a:s);o.push(f)}}}}M(ms,"$name","EventNonWorkingTime");M(ms,"pluginConfig",{chain:["onTimeAxisViewModelUpdate","updateLocalization","onEventDataGenerated"]});M(ms,"properties",{calendarRangeCache:new Map});ms._$name="EventNonWorkingTime";G.registerFeature(ms,!1,"Scheduler");class Ud extends np{static get $name(){return"EventTooltip"}static get defaultConfig(){return{template:e=>`
                ${e.eventRecord.name?z.xss`<div class="b-sch-event-title">${e.eventRecord.name}</div>`:""}
                ${e.startClockHtml}
                ${e.endClockHtml}`,cls:"b-sch-event-tooltip",monitorRecordUpdate:!0,scrollAction:"hide"}}construct(e,t){const i=this;super.construct(e,t),typeof i.align=="string"&&(i.align={align:i.align})}onPaint({firstPaint:e}){if(super.onPaint(...arguments),e){const t=this,i=t.client.features.dependencies;if(i){const r=t.align.offset;t.tooltip.ion({beforeShow:({source:n})=>{i.disabled?n.align.offset=r:n.align.offset=[0,10]}})}}}}Ud._$name="EventTooltip";G.registerFeature(Ud,!0,"Scheduler");G.registerFeature(Ud,!1,"ResourceHistogram");const cE={add:1,remove:1,update:1,removeAll:1,filter:1};class bp extends qa{static get $name(){return"GroupSummary"}static get defaultConfig(){return{showTooltip:!0,summaries:null,renderer:null}}static get properties(){return{footersToUpdate:new Set}}static get pluginConfig(){return{chain:["render"]}}construct(e,t){const i=this;if(e.isVertical)throw new Error("GroupSummary feature is not supported in vertical mode");i.scheduler=e,super.construct(e,t),!i.summaries&&i.renderer&&(i.summaries=[{renderer:i.renderer}]),e.isSchedulerBase&&(e.eventStore.ion({changePreCommit:i.onEventStoreChange,thisObj:i}),e.ion({timeAxisViewModelUpdate:i.onTimeAxisChange,thisObj:i}),e.project.ion({dataReady:i.onProjectDataReady,thisObj:i}))}doDestroy(){var e;(e=this._tip)===null||e===void 0||e.destroy(),super.doDestroy()}onTimeAxisChange(){this.scheduler.rowManager.forEach(e=>{e.isGroupFooter&&e.render()})}onEventStoreChange({action:e,record:t,records:i,changes:r}){if(cE[e]){var n;const{rowManager:s}=this.scheduler,a=t?[t]:i,o=new Set;if(a.forEach(l=>l.resources.forEach(d=>o.add(d))),(r==null||(n=r.resourceId)===null||n===void 0?void 0:n.oldValue)!=null){const l=this.scheduler.resourceStore.getById(r.resourceId.oldValue);l&&o.add(l)}for(const l of o){let d=s.getRowFor(l);if(this.target==="header")for(;d&&!d.isGroupHeader;)d=s.getRow(d.index-1);else for(;d&&!d.isGroupFooter;)d=s.getRow(d.index+1);d&&this.footersToUpdate.add(d)}}}onProjectDataReady(){const{footersToUpdate:e,client:t}=this;if(t.isVisible){if(e.size){for(const r of e){var i;(i=r.render)===null||i===void 0||i.call(r)}e.clear()}}else t.whenVisible("refresh",t,[!0])}onBeforeRenderRow({row:e,record:t}){if(e.isGroupFooter&&!t.meta.hasOwnProperty("groupFooterFor")){const i=e.elements.normal.querySelector(".b-sch-timeaxis-cell");i&&(i.innerHTML="")}super.onBeforeRenderRow(...arguments)}generateHtml(e,t,i,r,n,s){if(e.type==="timeAxis"){const a=this,{scheduler:o}=a,{eventStore:l}=o,d=o.timeAxisViewModel.columnConfig;let u="";const h=o.getResourcesEventsPerTick(t,({event:f})=>f.resources.some(g=>t.includes(g))&&(!l.isFiltered||l.records.includes(f)));return o.timeAxis.forEach((f,g)=>{const m=h[g]||[],p=a.summaries.map(v=>`<div class="b-timeaxis-summary-value">${v.renderer({startDate:f.startDate,endDate:f.endDate,resourceStore:o.resourceStore,events:m,resources:t,eventStore:l,groupRecord:r,groupField:n,groupValue:s})}</div>`).join("");u+=`<div class="b-timeaxis-tick" style="width: ${d[d.length-1][g].width}px">${p}</div>`}),`<div class="b-timeaxis-group-summary">${u}</div>`}return super.generateHtml(e,t,i,r,n,s)}updateSummaryHtml(e,t,i){const r=super.updateSummaryHtml(e,t,i);if(t.type==="timeAxis"){const n={count:0,height:0};return this.summaries.forEach(s=>{s.height?n.height+=s.height:n.count++}),n}return r}getTipHtml({activeTarget:e}){const t=this,i=Array.from(e.parentElement.children).indexOf(e),r=t.scheduler.timeAxis.getAt(i);let n=`<header>${t.L("L{Summary.Summary for}",t.scheduler.getFormattedDate(r.startDate))}</header>`,s=!1;return S.forEachSelector(e,".b-timeaxis-summary-value",(a,o)=>{const l=t._labels[o],d=a.innerText.trim();n+=`<label>${l||""}</label><div class="b-timeaxis-summary-value">${d}</div>`,a.innerHTML&&(s=!0)}),s?n:null}render(){const e=this,{scheduler:t}=e;if(t.isSchedulerBase){var i;(i=e.summaries)!==null&&i!==void 0&&i.some(r=>r.label)&&e.showTooltip&&!e._tip&&(e._labels=e.summaries.map(r=>r.label||""),e._tip=new ce({id:`${t.id}-groupsummary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:0,forElement:t.timeAxisSubGridElement,anchorToTarget:!0,forSelector:".b-timeaxis-group-summary .b-timeaxis-tick",getHtml:e.getTipHtml.bind(e)}))}}removeSummaryElements(e){const t=e.querySelector(".b-timeaxis-group-summary");t?.remove(),super.removeSummaryElements()}hasSummary(e){return super.hasSummary(e)||e.isTimeAxisColumn}}bp._$name="GroupSummary";G.registerFeature(bp,!1,"Scheduler");class Yd extends te{static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove"]}}onElementMouseDown(e){const t=this;if(!(e.touches||e.button!==0||t.disabled)&&e.target.closest(".b-sch-header-timeaxis-cell")){const i=t.client.subGrids.normal.header.headersElement;t.startX=e.clientX,t.element=S.createElement({parent:i,tag:"div",className:"b-headerzoom-rect"}),t.headerElementRect=$.from(i),B.on({element:document,mouseup:"onMouseUp",thisObj:t,once:!0})}}onElementMouseMove(e){const t=this;if(typeof t.startX=="number"){const i=Math.max(e.clientX,t.headerElementRect.left),r=Math.min(t.startX,i),n=Math.abs(t.startX-i),s=new $(r-t.headerElementRect.x+t.client.scrollLeft,0,n,t.headerElementRect.height);S.setTranslateX(t.element,s.left),t.element.style.width=s.width+"px"}}onMouseUp(){const e=this;if(typeof e.startX=="number"){const{client:t}=e,i=$.from(e.element),r=t.getDateFromCoordinate(i.left,"round",!1),n=t.getDateFromCoordinate(i.right,"round",!1);e.element.remove(),e.startX=null,t.zoomToSpan({startDate:r,endDate:n})}}}M(Yd,"$name","HeaderZoom");Yd._$name="HeaderZoom";G.registerFeature(Yd,!1,"Scheduler");const uE=["top","before","after","bottom"],hE=(c,e)=>{switch(c){case"top":return"b-b";case"after":return e.rtl?"r-r":"l-l";case"right":return"l-l";case"bottom":return"t-t";case"before":return e.rtl?"l-l":"r-r";case"left":return"r-r"}},fE={top:1,bottom:1},gE={estimate:1,measure:1},mE={before:1,after:1};class Gd extends te{static get $name(){return"Labels"}static get configurable(){return{labelCls:"b-sch-label",top:null,after:null,right:null,bottom:null,before:null,left:null,thisObj:null,blurAction:"cancel",labelLayoutMode:"default",labelCharWidth:7}}static get pluginConfig(){return{chain:["onEventDataGenerated"]}}construct(e,t){const i=this;if(e.isVertical)throw new Error("Labels feature is not supported in vertical mode");i.scheduler=e,super.construct(e,t),(i.top||i.bottom||i.before||i.after)&&i.updateHostClasslist()}updateHostClasslist(){const{top:e,bottom:t}=this,{classList:i}=this.scheduler.element;i.remove("b-labels-topbottom"),i.remove("b-labels-top"),i.remove("b-labels-bottom"),(e||t)&&(i.add("b-labels-topbottom"),e&&i.add("b-labels-top"),t&&i.add("b-labels-bottom"))}onLabelDblClick(e){const t=this,i=e.target;if(i&&!t.scheduler.readOnly){const{side:r}=i.dataset,n=t[r],{editor:s,field:a}=n;if(s){const o=this.scheduler.resolveEventRecord(e.target);return o.readOnly?void 0:(s instanceof Gt||(n.editor=new Gt({blurAction:t.blurAction,inputField:s,scrollAction:"realign"})),n.editor.render(t.scheduler.element),n.editor.startEdit({target:i,align:hE(r,t.client),matchSize:!1,record:o,field:a}),e.stopImmediatePropagation(),!1)}}}changeTop(e){return this.processLabelSpec(e,"top")}updateTop(){this.updateHostClasslist()}changeAfter(e){return this.processLabelSpec(e,"after")}updateAfter(){this.updateHostClasslist()}changeRight(e){this[this.client.rtl?"before":"after"]=e}changeBottom(e){return this.processLabelSpec(e,"bottom")}updateBottom(){this.updateHostClasslist()}changeBefore(e){return this.processLabelSpec(e,"before")}updateBefore(){this.updateHostClasslist()}changeLeft(e){this[this.client.rtl?"after":"before"]=e}processLabelSpec(e,t){if(typeof e=="function")e={renderer:e};else if(typeof e=="string")e={field:e};else if(e)e=Object.setPrototypeOf({},e);else return null;const{scheduler:i}=this,{eventStore:r,resourceStore:n,taskStore:s,id:a}=i,{field:o,editor:l}=e;if(fE[t]&&(i.milestoneWidth=null),r&&!s?e.recordType="event":e.recordType="task",o){let d;r&&!s&&(d=r.modelClass.fieldMap[o],d?(e.fieldDef=d,e.recordType="event"):Reflect.has(r.modelClass.prototype,o)&&(e.recordType="event")),!d&&s&&(d=s.modelClass.fieldMap[o],d?(e.fieldDef=d,e.recordType="task"):Reflect.has(n.modelClass.prototype,o)&&(e.recordType="task")),!d&&n&&(d=n.modelClass.fieldMap[o],d?(e.fieldDef=d,e.recordType="resource"):Reflect.has(n.modelClass.prototype,o)&&(e.recordType="resource")),l&&(typeof l=="boolean"?i.editor={type:"textfield"}:typeof l=="string"&&(i.editor={type:l}),B.on({element:i.timeAxisSubGrid.element,delegate:".b-sch-label",dblclick:"onLabelDblClick",thisObj:this}))}return e}doDisable(e){super.doDisable(e),this.client.isPainted&&this.client.refresh()}generateLabelConfigs(e){const t=this,i=[];for(const r of uE)if(t[r]){const{field:n,fieldDef:s,recordType:a,renderer:o,thisObj:l}=t[r],d={tag:"label",className:{[t.labelCls]:1,[`${t.labelCls}-${r}`]:1},dataset:{side:r,taskFeature:`label-${r}`}};let u;const h=`${a}Record`,f=e[h];o?u=o.call(l||t.thisObj||t,{[h]:f,resourceRecord:e.resourceRecord,assignmentRecord:e.assignmentRecord,domConfig:d}):(u=f[n],s?.type==="date"&&!o?u=b.format(u,t.client.displayDateFormat):u=z.encodeHtml(u)),d.html=u||"\xA0",i.push(d)}return i}measureLabels(e,t){const i=this,r=i.client.timeAxisViewModel.getSingleUnitInPixels("millisecond");for(const n of e)if(mE[n.dataset.side]){let{html:s}=n,a=0;if(i.labelLayoutMode==="estimate")s.includes("<")&&(s=S.stripTags(s)),a=s.length*i.labelCharWidth+18;else{const l=i.labelMeasureElement||(i.labelMeasureElement=S.createElement({className:"b-sch-event-wrap b-measure-label",parent:i.client.foregroundCanvas}));l.retainElement=!0,Z.sync({targetElement:l,childrenOnly:!0,domConfig:{children:[n]}}),a=l.firstElementChild.offsetWidth}const o=a/r;switch(n.dataset.side){case"before":t.startMS-=o;break;case"after":t.endMS+=o;break}}}onEventDataGenerated(e){var t;if(!this.disabled&&!((t=e.eventRecord)!==null&&t!==void 0&&t.isResourceTimeRange)){const i=this.generateLabelConfigs(e);gE[this.labelLayoutMode]&&this.measureLabels(i,e),e.wrapperChildren.push(...i)}}updateLabelLayoutMode(){this.isConfiguring||this.client.refreshWithTransition()}updateLabelCharWidth(){this.isConfiguring||this.client.refreshWithTransition()}}Gd.featureClass="b-sch-labels";Gd._$name="Labels";G.registerFeature(Gd,!1,"Scheduler");class ps extends Xr.mixin(Mi,yp){static get defaultConfig(){return{highlightWeekends:null,hideRangesOnZooming:!0,showHeaderElements:!0,showLabelInBody:!0,autoGeneratedWeekends:!1}}doDestroy(){this.attachToCalendar(null),super.doDestroy()}set highlightWeekends(e){ae.deprecate("Scheduler","6.0.0","Deprecated in favour of disabling the feature"),this.disabled=!e}get highlightWeekends(){return!this.disabled}onConfigChange({name:e}){!this.isConfiguring&&e==="fillTicks"&&this.refresh()}attachToProject(e){super.attachToProject(e),this.attachToCalendar(e.effectiveCalendar),!e.graph&&!this.client.isScheduler&&e.ion({name:"project",dataReady:{fn:()=>this.attachToCalendar(e.effectiveCalendar),once:!0},thisObj:this}),e.ion({name:"project",calendarChange:()=>this.attachToCalendar(e.effectiveCalendar),thisObj:this})}onTimeAxisViewModelUpdate(...e){return this._timeAxisUnitDurationMs=null,super.onTimeAxisViewModelUpdate(...e)}attachToCalendar(e){const t=this,{project:i,client:r}=t;t.detachListeners("calendar"),t.autoGeneratedWeekends=!1,e&&(t.setupDefaultCalendar(),e.intervalStore.ion({name:"calendar",change:()=>t.setTimeout(()=>t.refresh(),1)})),r.isEngineReady&&!r.project.isDelayingCalculation&&!r.isDestroying?t.refresh():i.isDestroyed||(t.detachListeners("initialProjectListener"),i.ion({name:"initialProjectListener",refresh({isCalculated:n}){n!==!1&&(t.refresh(),t.detachListeners("initialProjectListener"))},thisObj:t}))}get calendar(){var e;return(e=this.project)===null||e===void 0?void 0:e.effectiveCalendar}get timeAxisUnitDurationMs(){return this._timeAxisUnitDurationMs||(this._timeAxisUnitDurationMs=b.as("ms",1,this.client.timeAxis.unit)),this._timeAxisUnitDurationMs}shouldRenderRange(e){return super.shouldRenderRange(e)&&(!this.hideRangesOnZooming||e.durationMS>=this.timeAxisUnitDurationMs)}get timeRanges(){const e=this;return e._timeRanges||(e._timeRanges=e.getCalendarTimeRanges(e.calendar)),e._timeRanges}}M(ps,"$name","NonWorkingTime");M(ps,"pluginConfig",{chain:["onPaint","attachToProject","updateLocalization","onConfigChange","onSchedulerHorizontalScroll"]});ps._$name="NonWorkingTime";G.registerFeature(ps,!1,"Scheduler");G.registerFeature(ps,!0,["SchedulerPro","Gantt","ResourceHistogram"]);class po extends te{get targetSelector(){return`.b-sch-timeaxis-cell,.b-timeline-subgrid${this.enableInHeader?",.b-sch-header-timeaxis-cell,.b-sch-header-text":""}`}static get pluginConfig(){return{chain:["onElementMouseDown"]}}onElementMouseDown(e){const t=this,{client:i}=t,{button:r,touches:n,target:s,clientX:a,clientY:o}=e,l=i.features.taskDrag||i.features.eventDrag,d=i.readOnly||!(l!=null&&l.enabled);n||r!==0||t.disabled||i.trigger("beforePan",{event:e})===!1||(s.matches(t.targetSelector)||d&&s.closest(i.eventSelector))&&(t.mouseX=a,t.mouseY=o,t.onHeader=t.enableInHeader&&s.closest(".b-sch-header-timeaxis-cell"),t.mouseDetacher=B.on({element:document,mousemove:"onMouseMove",mouseup:"onMouseUp",thisObj:t}))}onMouseMove(e){const t=this,{client:i}=t,r=i.timeAxisSubGrid.scrollable,n=i.scrollable,s=e.clientX,a=e.clientY;e.preventDefault(),t.vertical&&(i.isVertical||!t.onHeader)&&n.scrollBy(0,t.mouseY-a),t.horizontal&&(i.isHorizontal||!t.onHeader)&&r.scrollBy(t.mouseX-s),t.mouseX=s,t.mouseY=a}onMouseUp(){this.mouseDetacher(),this.mouseDetacher=null}get isActive(){return Boolean(this.mouseDetacher)}}M(po,"$name","Pan");M(po,"configurable",{horizontal:!0,vertical:!0,enableInHeader:!0});po._$name="Pan";G.registerFeature(po,!1,["Scheduler","Gantt"]);class vs extends fo{static get pluginConfig(){const e=super.pluginConfig;return F(F({},e),{},{override:["matchScheduleCell",...e.override],assign:["resolveResourceTimeRangeRecord","getElementFromResourceTimeRangeRecord"]})}updateEnableMouseEvents(e){var t;const i=this,{client:r}=i;if((t=i.mouseEventsDetacher)===null||t===void 0||t.call(i),i.mouseEventsDetacher=null,e){let n=function(){i.mouseEventsDetacher=B.on({element:r.foregroundCanvas,delegate:`.${i.rangeCls}`,mousedown:"handleRangeMouseEvent",mouseup:"handleRangeMouseEvent",click:"handleRangeMouseEvent",dblclick:"handleRangeMouseEvent",contextmenu:"handleRangeMouseEvent",mouseover:"handleRangeMouseEvent",mouseout:"handleRangeMouseEvent",thisObj:i})};r.whenVisible(n)}r.element.classList.toggle("b-interactive-resourcetimeranges",Boolean(e))}attachToProject(e){const t=this,{client:i}=t;if(super.attachToProject(e),!e.resourceTimeRangeStore){e.resourceTimeRangeStore=i.resourceTimeRangeStore||new co({owner:t});const{crudManager:n}=i;n&&!n.resourceTimeRangeStore&&(n.resourceTimeRangeStore=e.resourceTimeRangeStore)}const r=e.resourceTimeRangeStore;t.exposedOnScheduler||(i.resourceTimeRanges&&(r.add(i.resourceTimeRanges),delete i.resourceTimeRanges),Object.defineProperty(i,"resourceTimeRanges",{get:()=>r.records,set:n=>r.data=n}),t.exposedOnScheduler=!0),r.resourceStore||(r.resourceStore=e.resourceStore),t.detachListeners("store"),r.ion({name:"store",change:t.onStoreChange,thisObj:t})}attachToResourceTimeRangeStore(e){this.attachToProject(this.project),this.client.refresh()}get store(){return this.project.resourceTimeRangeStore}handleRangeMouseEvent(e){const t=this,i=e.target.closest(`.${t.rangeCls}`);if(i){var r;const n=(r=B.eventNameMap[e.type])!==null&&r!==void 0?r:z.capitalize(e.type),s=t.resolveResourceTimeRangeRecord(i);t.client.trigger("resourceTimeRange"+n,{feature:t,resourceTimeRangeRecord:s,resourceRecord:t.client.resourceStore.getById(s.resourceId),domEvent:e})}}matchScheduleCell(e){let t=this.overridden.matchScheduleCell(e);if(!t&&this.enableMouseEvents){const{client:i}=this,r=e.closest(`.${this.rangeCls}`);t=r&&i.getCell({record:i.isHorizontal?r.elementData.resource:i.store.first,column:i.timeAxisColumn})}return t}getEventsToRender(e,t){if(!this.disabled){const{timeRanges:i}=e.$original;if(i!=null&&i.length){const{startDate:r,endDate:n}=this.client;i.forEach(s=>{s.isRecurring?t.push(...s.getOccurrencesForDateRange(r,n)):t.push(s)})}}return t}shouldInclude(e){return e.isResourceTimeRange&&!e.isNonWorking&&!e.isCalendarHighlightModel}doDestroy(){var e;((e=this.store)===null||e===void 0?void 0:e.owner)===this&&this.store.destroy(),super.doDestroy()}}M(vs,"$name","ResourceTimeRanges");M(vs,"configurable",{rangeCls:"b-sch-resourcetimerange",enableMouseEvents:!1,tabIndex:0});vs.featureClass="";vs._$name="ResourceTimeRanges";G.registerFeature(vs,!1,"Scheduler");class vo extends zd{static get $name(){return"ScheduleMenu"}static get defaultConfig(){return{type:"schedule",items:null,processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateScheduleMenu"),e}shouldShowMenu(e){const{client:t}=this,{targetElement:i,resourceRecord:r}=e,n=t.timeAxisSubGridElement.contains(i);return!i.closest(t.eventSelector)&&n&&!(r&&r.isSpecialRow)}getDataFromEvent(e){if(S.isDOMEvent(e)){var t,i;const{client:r}=this,n=(t=r.getCellDataFromEvent)===null||t===void 0?void 0:t.call(r,e),s=(i=r.getDateFromDomEvent)===null||i===void 0?void 0:i.call(r,e,"floor"),a=r.resolveResourceRecord(e)||r.isVertical&&r.resourceStore.last;return T.assign(super.getDataFromEvent(e),n,{date:s,resourceRecord:a})}return e}populateScheduleMenu({items:e,resourceRecord:t,date:i}){const{client:r}=this;!r.readOnly&&r.eventStore&&(e.addEvent={text:"L{SchedulerBase.Add event}",icon:"b-icon b-icon-add",disabled:!t||t.readOnly||!t.isWorkingTime(i),weight:100,onItem(){r.createEvent(i,t,r.getRowFor(t))}})}}vo.featureClass="";vo._$name="ScheduleMenu";G.registerFeature(vo,!0,"Scheduler");class yo extends te{static get $name(){return"ScheduleTooltip"}static get configurable(){return{messageTemplate:e=>`<div class="b-sch-hovertip-msg">${e.message}</div>`,hideForNonWorkingTime:null}}static get pluginConfig(){return{chain:["onPaint"]}}onPaint({firstPaint:e}){if(!e)return;const t=this,{client:i}=t;i.isSchedulerPro&&t.hideForNonWorkingTime===void 0&&(t.hideForNonWorkingTime=!0);let r;const n=t.hoverTip=new ce(F(F({id:`${i.id}-schedule-tip`,cls:"b-sch-scheduletip",allowOver:!0,hoverDelay:0,hideDelay:100,showOnHover:!0,forElement:i.timeAxisSubGridElement,anchorToTarget:!1,trackMouse:!0,updateContentOnMouseMove:!0,monitorResize:!1,textContent:!1,forSelector:".b-schedulerbase:not(.b-dragging-event):not(.b-dragcreating) .b-grid-body-container:not(.b-scrolling) .b-timeline-subgrid:not(.b-scrolling) > :not(.b-sch-foreground-canvas):not(.b-group-footer):not(.b-group-row) *",constrainTo:null,getHtml:t.getHoverTipHtml.bind(t),onDocumentMouseDown(s){n.forElement.contains(s.event.target)&&(r=B.on({thisObj:t,element:i.timeAxisSubGridElement,mousemove:o=>n.internalOnPointerOver(o),capture:!0}));const a=n.hideAnimation;n.hideAnimation=!1,n.constructor.prototype.onDocumentMouseDown.call(n,s),n.hideAnimation=a}},t.config),{},{internalListeners:t.configuredListeners}));n.ion({pointerover({event:s}){const a="buttons"in s?s.buttons>0:s.which>0;return!a&&r&&r(),!t.disabled&&!a},innerhtmlupdate({source:s}){t.clockTemplate.updateDateIndicator(s.element,t.lastTime)}}),i.ion({timeAxisViewModelUpdate:"updateTip",thisObj:t}),t.clockTemplate=new rr({scheduler:i})}processConfiguredListeners(){}updateTip(){this.hoverTip.isVisible&&this.hoverTip.updateContent()}doDestroy(){this.destroyProperties("clockTemplate","hoverTip"),super.doDestroy()}getHoverTipHtml({tip:e,event:t}){const i=this,r=i.client,n=t&&r.getDateFromDomEvent(t,"floor",!0);let s=i.lastHtml;if(n&&t.target){const a=r.resolveResourceRecord(t);if(a&&(n-i.lastTime!==0||a.id!==i.lastResourceId)){if(i.hideForNonWorkingTime){const o=a.isWorkingTime(n);e.element.classList.toggle("b-nonworking-time",!o)}i.lastResourceId=a.id,s=i.lastHtml=i.generateTipContent({date:n,event:t,resourceRecord:a})}}else e.hide(),i.lastTime=null,i.lastResourceId=null;return s}generateTipContent({date:e,event:t,resourceRecord:i}){const r=this,n=r.clockTemplate.generateContent({date:e,text:r.client.getFormattedDate(e)}),s=r.messageTemplate({message:r.getText(e,t,i)||""});return r.lastTime=e,n+s}getText(e,t,i){}}yo.featureClass="b-scheduletip";yo._$name="ScheduleTooltip";G.registerFeature(yo,!0,"Scheduler");G.registerFeature(yo,!1,"ResourceUtilization");class Cp extends te{static get $name(){return"SimpleEventEdit"}static get defaultConfig(){return{triggerEvent:"eventdblclick",eventRecord:null,field:"name",editorConfig:null}}static get pluginConfig(){return{chain:["onEventEnterKey","editEvent"]}}construct(e,t){const i=this;i.scheduler=e,e.eventEdit=i,super.construct(e,t),i.clientListenersDetacher=e.ion({[i.triggerEvent]:({eventRecord:r,eventElement:n})=>i.editEvent(r,r.resource,n),dragcreateend:i.onDragCreateEnd,thisObj:i})}doDestroy(){var e;this.clientListenersDetacher(),(e=this.editor)===null||e===void 0||e.destroy(),super.doDestroy()}get eventStore(){return this.scheduler.eventStore}editEvent(e,t,i){const r=this,{scheduler:n}=r,{eventEdit:s}=r.client.features;if(n.readOnly||r.disabled||e.readOnly||s&&!s.disabled&&!e.isCreating)return;let{editor:a}=r;i=S.down(i,n.eventInnerSelector)||i,e=e.isAssignment?e.event:e,r.resource=t,r.event=e,r.element=i,n.element.classList.add("b-eventeditor-editing"),a?a.render(n.timeAxisSubGridElement):(r.editor=a=Gt.new({owner:n.timeAxisSubGrid,appendTo:n.timeAxisSubGridElement,scrollAction:"realign",maxHeight:40,align:{align:n.isHorizontal?"c-c":"t-t"},cls:"b-simpleeventeditor",internalListeners:{complete:"onEditorComplete",cancel:"onEditorCancel",thisObj:r},onInternalKeyDown:o=>o.stopPropagation()},r.editorConfig),r.relayEvents(r.editor,["beforestart","start","beforecomplete","complete","beforecancel","cancel"])),e.isCreating&&(e.name=""),a.startEdit({target:i,record:e,field:r.field}),n.isVertical&&e.startDate<n.visibleDateRange.startDate&&a.element.scrollIntoView(),n.navigator.disabled=!0}onEditorComplete(){this.event.isCreating=!1,this.reset()}onEditorCancel(){this.event.isCreating&&this.event.remove(),this.reset()}reset(){this.scheduler.element.classList.remove("b-eventeditor-editing"),this.scheduler.navigator.disabled=!1,this.event=null,this.resource=null}onEventEnterKey({assignmentRecord:e,eventRecord:t}){const i=e?this.scheduler.getElementFromAssignmentRecord(e):this.scheduler.getElementFromEventRecord(t),r=(e||t).resource;this.editEvent(t,r,i)}onDragCreateEnd({eventRecord:e,resourceRecord:t,eventElement:i}){this.element=i,this.editEvent(e,t,i)}}Cp._$name="SimpleEventEdit";G.registerFeature(Cp,!1,"Scheduler");const pE={width:0,height:0};class en extends te{construct(e,t){super.construct(e,t),e.isVertical&&(this.toUpdate=new Set,e.ion({scroll:"onSchedulerScroll",horizontalScroll:"onHorizontalScroll",thisObj:this,prio:1e4}))}onEventDataGenerated(e){this.client.isHorizontal?e.wrapperCls["b-disable-sticky"]=e.eventRecord.stickyContents===!1:(this.syncEventContentPosition(e,void 0,!0),this.updateStyles())}onSchedulerScroll(){this.disabled||this.verticalSyncAllEventsContentPosition(this.client)}onHorizontalScroll({subGrid:e}){e===this.client.timeAxisSubGrid&&this.verticalSyncAllEventsContentPosition(this.client)}updateStyles(){for(const{contentEl:e,style:t}of this.toUpdate)S.applyStyle(e,t);this.toUpdate.clear()}verticalSyncAllEventsContentPosition(e){const{resourceMap:t}=e.currentOrientation;for(const i of t.values())for(const{renderData:r,elementConfig:n}of Object.values(i)){const s=[r];n&&r.eventRecord.isResourceTimeRange&&s.push(n.children[0]),this.syncEventContentPosition.apply(this,s)}this.toUpdate.size&&this.updateStyles()}syncEventContentPosition(e,t=e.eventContent,i=!1){if(this.disabled||e.eventRecord.stickyContents===!1)return;const{client:r}=this,{eventRecord:n,resourceRecord:s,useEventBuffer:a,bufferAfterWidth:o,bufferBeforeWidth:l,top:d,height:u}=e,h=r.scrollable.y,f=i?null:r.getElementFromEventRecord(n,s,!0),g=f&&Z.getChild(f,"event.content"),m=n.instanceMeta(r),p=typeof t.style=="string"?t.style=S.parseStyle(t.style):t.style||(t.style={});if(f!=null&&f.classList.contains("b-dragging"))return;let v=d,y=u,C=v+y;if(a&&(v+=l,y=y-l-o,C=v+y),v<h&&C>=h&&!n.isMilestone){const D=g?.offsetWidth,w=g?.parentNode&&S.getStyleValue(g.parentNode,"justifyContent"),E=w==="center"?(e.width-D)/2:0,R=v,x=R+y-1;if((!g||D)&&R<h&&x>=h){const k=this.getEventContentMargins(g),I=g?y-g.offsetHeight-k.height-E:Number.MAX_SAFE_INTEGER,A=Math.min(h-R,I-2);p.transform=A>0?`translateY(${A}px)`:"",m.stuck=!0}else p.transform="",m.stuck=!1;g&&this.toUpdate.add({contentEl:g,style:p})}else g&&m.stuck&&(p.transform="",m.stuck=!1,this.toUpdate.add({contentEl:g,style:p}))}getEventContentMargins(e){return e!=null&&e.classList.contains("b-sch-event-content")?S.getEdgeSize(e,"margin"):pE}doDisable(){super.doDisable(...arguments),this.isConfiguring||this.client.refreshWithTransition()}}M(en,"$name","StickyEvents");M(en,"type","stickyEvents");M(en,"pluginConfig",{chain:["onEventDataGenerated"]});en._$name="StickyEvents";G.registerFeature(en,!0,"Scheduler");G.registerFeature(en,!1,"ResourceHistogram");class wp extends Qa{static get $name(){return"TimelineSummary"}static get configurable(){return{showTooltip:!0}}static get pluginConfig(){return{chain:["renderRows","updateProject"]}}construct(e,t){const i=this;super.construct(e,t),i.summaries||(i.summaries=[{renderer:i.renderer}]),e.isTimelineBase&&(i.updateProject(e.project),e.ion({timeAxisViewModelUpdate:i.renderRows,thisObj:i}))}updateProject(e){this.detachListeners("summaryProject"),e.ion({name:"summaryProject",dataReady:"updateTimelineSummaries",thisObj:this})}renderRows(){this.client.isHorizontal&&this.client.timeAxisSubGrid.footer.element.querySelector(".b-grid-footer").classList.add("b-sch-summarybar"),super.renderRows(),this.disabled||this.render()}get summaryBarElement(){return this.client.element.querySelector(".b-sch-summarybar")}render(){const e=this,{client:t}=e,i=t.isHorizontal?"width":"height",r=t.timeAxisViewModel.columnConfig,n=e.summaryBarElement;n&&(!e._tip&&e.showTooltip&&e.summaries.some(s=>s.label)&&(e._tip=new ce({id:`${t.id}-summary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:100,forElement:n,anchorToTarget:!0,trackMouse:!1,forSelector:".b-timeaxis-tick",getHtml:({activeTarget:s})=>s._tipHtml})),n.innerHTML=r[r.length-1].map(s=>`<div class="b-timeaxis-tick" style="${i}: ${s.width}px"></div>`).join(""),e.updateTimelineSummaries())}refresh(){super.refresh(),this.updateTimelineSummaries()}doDisable(e){var t;const{isConfiguring:i}=this.client;super.doDisable(e),(t=this.summaryColumn)===null||t===void 0||t.toggle(!e),!i&&!e&&this.render()}doDestroy(){var e;(e=this._tip)===null||e===void 0||e.destroy(),super.doDestroy()}}wp._$name="TimelineSummary";class Sp extends wp{static get $name(){return"Summary"}static get configurable(){return{summaries:null,renderer:null,verticalSummaryColumnConfig:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("bindStore","updateEventStore","updateResourceStore"),e}construct(e,t){const i=this;i.scheduler=e,e.isVertical&&(e.timeAxisSubGrid.resizable=!1,t.hideFooters=!0,e.add(e.createSubGrid("right")),i.summaryColumn=e.columns.add(T.assign({filterable:null,region:"right",cellCls:"b-grid-footer b-sch-summarybar",align:"center",sortable:!1,editor:!1,groupable:!1,htmlEncode:!1,cellMenuItems:!1,enableHeaderContextMenu:!1,hidden:i.disabled},i.verticalSummaryColumnConfig))[0]),super.construct(e,t),e.isSchedulerBase&&(i.updateEventStore(e.eventStore),i.updateResourceStore(e.resourceStore))}updateEventStore(e){this.detachListeners("summaryEventStore"),e.ion({name:"summaryEventStore",filter:"updateTimelineSummaries",thisObj:this})}updateResourceStore(e){this.detachListeners("summaryResourceStore"),e.ion({name:"summaryResourceStore",filter:"updateTimelineSummaries",thisObj:this})}updateTimelineSummaries(){const e=this,{client:t}=e,{eventStore:i,timeAxis:r}=t,n=e.summaryBarElement,s=e.selectedOnly&&t.selectedRecords.length?t.selectedRecords:t.resourceStore.records;if(n&&t.isEngineReady){const a=t.getResourcesEventsPerTick(s,({event:o})=>!i.isFiltered||i.records.includes(o));Array.from(n.children).forEach((o,l)=>{const d=r.getAt(l),u=a[l]||[];let h="",f=`<header>${e.L("L{Summary for}",t.getFormattedDate(d.startDate))}</header>`;e.summaries.forEach(g=>{const m=g.renderer({startDate:d.startDate,endDate:d.endDate,resourceStore:t.resourceStore,eventStore:i,events:u,element:o}),p=m?`<div class="b-timeaxis-summary-value">${m}</div>`:"";(e.summaries.length>1||m)&&(h+=p),f+=p?`<label>${g.label||""}</label>`+p:""}),o.innerHTML=h,o._tipHtml=h?f:""})}}}Sp._$name="Summary";G.registerFeature(Sp,!1,"Scheduler");const vE={maintainVisibleStart:!0};class qd extends Ka{static get $name(){return"TimeAxisHeaderMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"timeAxisHeader"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateTimeAxisHeaderMenu"),e}construct(){super.construct(...arguments),this.triggerEvent.includes("click")&&this.client.zoomOnTimeAxisDoubleClick&&(this.client.zoomOnTimeAxisDoubleClick=!1)}shouldShowMenu(e){const{column:t}=e;return t&&t.enableHeaderContextMenu!==!1&&t===this.client.timeAxisColumn}showContextMenu(e){super.showContextMenu(...arguments),this.menu&&(this.menu.scrollAction="realign")}populateTimeAxisHeaderMenu({items:e}){const t=this,{client:i}=t,r={magnitude:i.timeAxis.shiftIncrement,unit:i.timeAxis.shiftUnit};Object.assign(e,{zoomLevel:{text:"L{pickZoomLevel}",localeClass:t,icon:"b-fw-icon b-icon-search-plus",disabled:!i.presets.count||t.disabled,weight:200,menu:{type:"popup",items:{zoomSlider:{weight:210,type:"slider",minWidth:130,showValue:!1}},onBeforeShow({source:n}){const[s]=n.items;s.min=i.minZoomLevel,s.max=i.maxZoomLevel,s.value=i.zoomLevel,t.zoomDetatcher=s.ion({input:"onZoomSliderChange",thisObj:t})},onHide(){t.zoomDetatcher&&(t.zoomDetatcher(),t.zoomDetatcher=null)}}},dateRange:{text:"L{activeDateRange}",localeClass:t,icon:"b-fw-icon b-icon-calendar",weight:300,menu:{type:"popup",cls:"b-sch-timeaxis-menu-daterange-popup",defaults:{localeClass:t},items:{startDateField:{type:"datefield",label:"L{startText}",weight:310,labelWidth:"6em",required:!0,step:r,internalListeners:{change:t.onRangeDateFieldChange,thisObj:t}},endDateField:{type:"datefield",label:"L{endText}",weight:320,labelWidth:"6em",required:!0,step:r,internalListeners:{change:t.onRangeDateFieldChange,thisObj:t}},leftShiftBtn:{type:"button",weight:330,cls:"b-left-nav-btn",icon:"b-icon b-icon-previous",color:"b-blue b-raised",flex:1,margin:0,internalListeners:{click:t.onLeftShiftBtnClick,thisObj:t}},todayBtn:{type:"button",weight:340,cls:"b-today-nav-btn",color:"b-blue b-raised",text:"L{todayText}",flex:4,margin:"0 8",internalListeners:{click:t.onTodayBtnClick,thisObj:t}},rightShiftBtn:{type:"button",weight:350,cls:"b-right-nav-btn",icon:"b-icon b-icon-next",color:"b-blue b-raised",flex:1,internalListeners:{click:t.onRightShiftBtnClick,thisObj:t}}},internalListeners:{paint:t.initDateRangeFields,thisObj:t}}}})}onZoomSliderChange({value:e}){const t=this;t.menu.scrollAction="realign",t.client.zoomLevel=e,t.menu.setTimeout({fn:()=>t.menu.scrollAction="hide",delay:100,cancelOutstanding:!0})}initDateRangeFields({source:e,firstPaint:t}){if(t){const{widgetMap:i}=e;this.startDateField=i.startDateField,this.endDateField=i.endDateField}this.initDates()}initDates(){const e=this;e.startDateField.suspendEvents(),e.endDateField.suspendEvents(),e.startDateField.value=e.startDateFieldInitialValue=e.client.startDate,e.endDateField.value=e.endDateFieldInitialValue=e.client.endDate,e.startDateField.resumeEvents(),e.endDateField.resumeEvents()}onRangeDateFieldChange({source:e}){const t=this,i=e===t.startDateField,{client:r}=t,{timeAxis:n}=r,s=t.startDateFieldInitialValue&&!i?t.startDateFieldInitialValue:t.startDateField.value;let a=t.endDateFieldInitialValue&&i?t.endDateFieldInitialValue:t.endDateField.value;i?t.startDateFieldInitialValue=null:t.endDateFieldInitialValue=null,a-s?a<s&&(a=b.add(s,n.shiftIncrement,n.shiftUnit)):a=b.add(a,n.shiftIncrement,n.shiftUnit),r.setTimeSpan(s,a,vE),t.initDates()}onLeftShiftBtnClick(){this.client.timeAxis.shiftPrevious(),this.initDates()}onTodayBtnClick(){const e=b.clearTime(new Date);this.client.setTimeSpan(e,b.add(e,1,"day")),this.initDates()}onRightShiftBtnClick(){this.client.timeAxis.shiftNext(),this.initDates()}}qd._$name="TimeAxisHeaderMenu";G.registerFeature(qd,!0,["Scheduler","Gantt"]);G.registerFeature(qd,!1,"ResourceHistogram");class Kd extends Xr.mixin(Mi){static get $name(){return"TimeRanges"}static get defaultConfig(){return{store:!0}}doDestroy(){var e;(e=this.storeDetacher)===null||e===void 0||e.call(this),super.doDestroy()}get timeRanges(){const e=this;if(!e._timeRanges){const{store:t}=e;let{records:i}=t;if(t.recurringEvents){const{startDate:r,endDate:n}=e.client.timeAxis;i=i.flatMap(s=>s.isRecurring?s.getOccurrencesForDateRange(r,n):s)}e.currentTimeLine&&(t.recurringEvents||(i=i.slice()),i.push(e.currentTimeLine)),e._timeRanges=i}return e._timeRanges}attachToProject(e){var t;super.attachToProject(e);const i=this;if((t=i.projectTimeZoneChangeDetacher)===null||t===void 0||t.call(i),i.showCurrentTimeLine){var r;i.projectTimeZoneChangeDetacher=(r=i.client.project)===null||r===void 0?void 0:r.ion({timeZoneChange:()=>i.updateCurrentTimeLine()}),i.currentTimeLine&&i.updateCurrentTimeLine()}}initCurrentTimeLine(){const e=this;if(e.currentTimeLine||!e.showCurrentTimeLine)return;const t=typeof e.showCurrentTimeLine=="object"?e.showCurrentTimeLine:{};e.currentTimeLine=e.store.modelClass.new({id:"currentTime",cls:"b-sch-current-time"},t),e.currentTimeInterval=e.setInterval(()=>e.updateCurrentTimeLine(),e.currentTimeLineUpdateInterval),e._timeRanges=null,e.updateCurrentTimeLine()}updateCurrentTimeLine(){var e;const t=this,{currentTimeLine:i}=t;i._inTimeZone=(e=t.project)===null||e===void 0?void 0:e.timeZone,i.setLocalDate("startDate",new Date),i.endDate=i.startDate,i.originalData.name||(i.name=b.format(i.startDate,t.currentDateFormat)),t.renderRanges()}hideCurrentTimeLine(){const e=this;!e.currentTimeLine||(e.clearInterval(e.currentTimeInterval),e.currentTimeLine=null,e.refresh())}updateShowCurrentTimeLine(e){e?this.initCurrentTimeLine():this.hideCurrentTimeLine()}populateTimeAxisHeaderMenu({column:e,items:t}){t.currentTimeLine={weight:400,text:this.L("L{showCurrentTimeLine}"),checked:this.showCurrentTimeLine,onToggle:({checked:i})=>{this.showCurrentTimeLine=i}}}attachToStore(e){const t=this;let i=!1;t.storeDetacher&&(t.storeDetacher(),i=!0),t.storeDetacher=e.ion({change:"onStoreChange",refresh:"onStoreChange",thisObj:t}),t._timeRanges=null,i&&t.renderRanges()}get store(){return this.client.project.timeRangeStore}updateStore(e){const t=this,{client:i}=t,{project:r}=i;e=r.timeRangeStore,t.attachToStore(e),i.timeRanges&&!i._timeRangesExposed&&(e.add(i.timeRanges),delete i.timeRanges)}attachToTimeRangeStore(e){this.store=e}resolveTimeRangeRecord(e){return this.store.getById(e.closest(this.baseSelector).dataset.id)}onStoreChange({type:e,action:t}){const i=this;i._timeRanges=null,!(i.disabled||!i.client.isVisible||i.isConfiguring||e==="refresh"&&t!=="batch")&&i.client.runWithTransition(()=>i.renderRanges(),!i.client.refreshSuspended)}onDragStart(e){const t=this,{context:i}=e,r=t.resolveTimeRangeRecord(i.element.closest(t.baseSelector)),n=t.getBodyElementByRecord(r);i.relatedElements=[n],Object.assign(i,{record:r,rangeBodyEl:n,originRangeX:S.getTranslateX(n),originRangeY:S.getTranslateY(n)}),super.onDragStart(e),t.showTip(i)}onDrop(e){const{context:t}=e;if(!t.valid)return this.onInvalidDrop({context:t});const i=this,{client:r}=i,{record:n}=t,s=$.from(t.rangeBodyEl),a=r.getDateFromCoordinate(s.getStart(r.rtl,r.isHorizontal),"round",!1);n.startDate-a!==0?n.setStartDate(a):i.onInvalidDrop(),i.destroyTip(),super.onDrop(e)}onResizeStart({context:e}){const t=this,i=t.resolveTimeRangeRecord(e.element.closest(t.baseSelector)),r=t.getBodyElementByRecord(i);Object.assign(e,{record:i,rangeBodyEl:r}),t.showTip(e)}onResizeDrag({context:e}){const t=this,{rangeBodyEl:i}=e;t.client.isVertical?(e.edge==="top"&&S.setTranslateY(i,e.newY),i.style.height=e.newHeight+"px"):(e.edge==="left"&&S.setTranslateX(i,e.newX),i.style.width=e.newWidth+"px")}onResize({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const t=this,{client:i}=t,{rtl:r}=i,n=e.record,s=$.from(e.element),a=s.getStart(r,i.isHorizontal),o=s.getEnd(r,i.isHorizontal),l=i.getDateFromCoordinate(a,"round",!1),d=r&&e.edge==="right"||!r&&e.edge==="left"||e.edge==="top",u=i.getDateFromCoordinate(o,"round",!1);(d&&n.startDate-l!==0||u&&n.endDate-u!==0)&&u>l?d?n.setStartDate(l,!1):n.setEndDate(u,!1):t.onInvalidResize({context:e}),t.destroyTip()}onInvalidResize({context:e}){const t=this;t.resize.reset(),e.rangeBodyEl.parentElement.lastDomConfig=e.rangeBodyEl.lastDomConfig=null,t.renderRanges(),t.destroyTip()}}M(Kd,"configurable",{store:{modelClass:Ct},currentTimeLineUpdateInterval:1e4,currentDateFormat:"HH:mm",showCurrentTimeLine:!1});Kd._$name="TimeRanges";G.registerFeature(Kd,!1,["Scheduler","Gantt"]);class Xd extends Xr{static get configurable(){return{enableResizing:!0,showTooltip:!1,dragTipTemplate:null,cls:"b-selected-time-span",dragHelperConfig:{skipUpdatingElement:!0},resizeHelperConfig:{skipUpdatingElement:!0},headerRenderer({timeRange:e}){const{dateFormat:t}=this.client.timeAxisViewModel.bottomHeader;return`<span class="b-selection-start">${b.format(e.startDate,t)}</span>
                        <span class="b-selection-end">${b.format(e.endDate,t)}</span>
                        <i class='b-icon b-icon-close' data-ref="closeButton" data-btip="L{Popup.close}"></i>`},selectedTimeSpan:null}}onUIReady(){super.onUIReady(),this.client.ion({timeAxisHeaderMouseDown:"onTimeAxisHeaderMouseDown",thisObj:this})}onTimeAxisHeaderMouseDown({startDate:e,endDate:t}){this.disabled||(this.selectedTimeSpan={startDate:e,endDate:t})}onTimeRangeClick(e){super.onTimeRangeClick(e);const t=this;!t.disabled&&e.target.closest(".b-selected-time-span")&&(e.target.matches('[data-ref="closeButton"]')?t.selectedTimeSpan=null:t.client.trigger("timeSelectionElementClick",F(F({},t.selectedTimeSpan),{},{domEvent:e})))}updateFromCoords(e,t,i,r){const{client:n}=this,s=n.isHorizontal?i:r;let a=n.isHorizontal?e:t;n.rtl&&n.isHorizontal&&(a=Math.max(n.timeAxisViewModel.totalSize-a-s,0));const o=n.getDateFromCoord({coord:a,roundingMethod:"round",ignoreRTL:!0}),l=n.getDateFromCoord({coord:a+s,roundingMethod:"round",ignoreRTL:!0});this.selectedTimeSpan={startDate:b.max(o,n.startDate),endDate:b.min(l,n.endDate)}}onResizeStart({source:e}){const{timeAxisViewModel:t,timeResolution:i}=this.client,r=b.asMilliseconds(i.increment,i.unit);this.resize.minWidth=t.getDistanceForDuration(r)}onResizeDrag({context:e}){var t,i;this.updateFromCoords(e.newX,e.newY,(t=e.newWidth)!==null&&t!==void 0?t:e.elementWidth,(i=e.newHeight)!==null&&i!==void 0?i:e.elementHeight)}onDragStart(e){super.onDragStart(e);const{context:t}=e;t.elementWidth=t.element.offsetWidth,t.elementHeight=t.element.offsetHeight}onDrag({context:e}){this.updateFromCoords(e.newX,e.newY,e.elementWidth,e.elementHeight)}onDrop(){this.client.element.classList.remove("b-dragging-timerange")}onDragReset(){this.refresh()}get timeRanges(){return this.selectedTimeSpan?[this.selectedTimeSpan]:[]}shouldRenderRange(){return!0}changeSelectedTimeSpan(e){return e&&(e.id="time-selection"),e}updateSelectedTimeSpan(e){this.isConfiguring||this.refresh(),this.client.trigger("timeSelectionChange",F({},e??{}))}}M(Xd,"$name","TimeSelection");Xd._$name="TimeSelection";G.registerFeature(Xd,!1,"Scheduler");const Bi={completeview:"completeview",currentview:"currentview",daterange:"daterange"},yE=Promise.resolve();var Zd=c=>class extends c{async scrollRowIntoView(t,i){const{rowManager:r,scrollable:n}=t,s=n.y;return i<t.store.count&&(n.scrollTo(null,r.calculateTop(i)),n.y!==s)?new Promise(a=>{const o=t.ion({scroll({scrollTop:l}){l!=null&&r.getRow(i)&&(o(),a())}})}):yE}async scrollToDate(t,i){let r=!1;const n=[],s=t.timeAxisSubGrid.scrollable.ion({scrollStart({x:a}){a!=null&&(r=!0)}});n.push(t.scrollToDate(i,{block:"start"})),s(),r&&n.push(t.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(n)}cloneElement(t,i,r){super.cloneElement(t,i,r);const n=this.element.querySelector(".b-schedulerbase");n?.classList.remove(...["fade-in","slide-from-left","slide-from-top","zoom-in"].map(s=>`b-initial-${s}`))}async prepareComponent(t){const i=this,{client:r}=t,{currentOrientation:n}=r,s=r.timeAxisSubGrid.width>0;switch(t.scheduleRange){case Bi.completeview:t.rangeStart=r.startDate,t.rangeEnd=r.endDate;break;case Bi.currentview:{const{startDate:u,endDate:h}=r.visibleDateRange;t.rangeStart=u,t.rangeEnd=h;break}}await r.waitForAnimations(),t.infiniteScroll=r.infiniteScroll,r.infiniteScroll=!1,s&&(r.setTimeSpan(t.rangeStart,t.rangeEnd),r.svgCanvas),i._oldEnableEventAnimations=r.enableEventAnimations,r.enableEventAnimations=!1,n.isHorizontalRendering&&(i._oldScrollBuffer=n.scrollBuffer,i._oldVerticalBuffer=n.verticalBufferSize,n.scrollBuffer=100,n.verticalBufferSize=-1),r.ignoreViewBox=!0,await super.prepareComponent(t);const{exportMeta:a,element:o}=i,l=o.querySelector(".b-sch-foreground-canvas"),d=o.querySelector(".b-horizontaltimeaxis");if(a.includeTimeline=s,s&&t.scheduleRange!==Bi.completeview){a.totalWidth-=a.subGrids.normal.width,a.totalWidth+=a.subGrids.normal.width=r.timeAxisViewModel.getDistanceBetweenDates(t.rangeStart,t.rangeEnd);const u=Math.ceil(a.totalWidth/a.pageWidth),h=u*a.verticalPages;a.horizontalPages=u,a.totalPages=h,a.subGrids.normal.scrollLeft=r.getCoordinateFromDate(t.rangeStart)}if(a.timeAxisHeaders=[],a.timeAxisPlaceholders=[],a.headersColleted=!1,S.forEachSelector(d,".b-sch-header-row",u=>{a.timeAxisPlaceholders.push(i.createPlaceholder(u)),a.timeAxisHeaders.push(new Map)}),a.subGrids.normal.eventsPlaceholder=i.createPlaceholder(l,!1),S.removeEachSelector(l,".b-sch-event-wrap,.b-sch-resourcetimerange"),S.removeEachSelector(i.element,".b-released"),a.eventsBoxes=new Map,a.client=r,r.hasActiveFeature("columnLines")){const u=o.querySelector(".b-column-lines-canvas");a.columnLinesPlaceholder=i.createPlaceholder(u),a.columnLines={lines:new Map,majorLines:new Map}}if(r.hasActiveFeature("timeRanges")){const u=o.querySelector(".b-sch-timeaxiscolumn .b-sch-timeranges-canvas"),h=o.querySelector(".b-sch-foreground-canvas .b-sch-timeranges-canvas");a.timeRanges={},u&&(a.timeRanges.header={},a.timeRangesHeaderPlaceholder=i.createPlaceholder(u)),a.timeRanges.body={},a.timeRangesBodyPlaceholder=i.createPlaceholder(h)}if(r.hasActiveFeature("dependencies")){r.features.dependencies.fillDrawingCache();const u=o.querySelector(`[id="${r.svgCanvas.getAttribute("id")}"]`);u&&(a.dependencyCanvasEl=u,a.dependenciesPlaceholder=i.createPlaceholder(u,!1,{ns:"http://www.w3.org/2000/svg",tag:"path"}),S.removeEachSelector(u,".b-sch-dependency"))}s&&!b.betweenLesser(t.rangeStart,r.startDate,r.endDate)&&await i.scrollToDate(r,t.rangeStart)}async restoreState(t){let i=!1;const{client:r}=t,n=[],s=r.timeAxisSubGrid.scrollable.ion({scrollStart({x:a}){this.element.scrollLeft!==a&&(i=!0)}});n.push(super.restoreState(t)),s(),i&&n.push(r.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(n)}async restoreComponent(t){const{client:i}=t,{currentOrientation:r}=i;i.ignoreViewBox=!1,i.infiniteScroll=t.infiniteScroll,i.enableEventAnimations=this._oldEnableEventAnimations,r.isHorizontalRendering&&(r.scrollBuffer=this._oldScrollBuffer,r.verticalBufferSize=this._oldVerticalBuffer),await super.restoreComponent(t)}async onRowsCollected(t,i){const r=this;if(await super.onRowsCollected(t,i),r.exportMeta.includeTimeline){const{client:n,enableDirectRendering:s}=i,{timeView:a}=n,{pageRangeStart:o,pageRangeEnd:l}=r.getCurrentPageDateRange(i);if(s)o&&l&&(r.renderHeaders(i,o,l),r.renderLines(i,o,l),r.renderRanges(i,o,l),r.renderEvents(i,t,o,l));else{if(o){let d=!1;for(await r.scrollToDate(n,o);!d;)if(r.collectLines(i),r.collectHeaders(i),r.collectRanges(i),r.collectEvents(t,i),b.timeSpanContains(a.startDate,a.endDate,o,l))d=!0;else if(a.endDate.getTime()>=l.getTime())d=!0;else{const u=a.endDate;if(await r.scrollToDate(n,a.endDate),u.getTime()===a.endDate.getTime())throw new Error("Could not scroll to date")}}await r.scrollToDate(n,i.rangeStart)}}}getCurrentPageDateRange({rangeStart:t,rangeEnd:i,enableDirectRendering:r,client:n}){const s=this,{exportMeta:a}=s,{horizontalPages:o,horizontalPosition:l,pageWidth:d,subGrids:u}=a;let h,f;if(o>1){const g=l*d,m=(l+1)*d,p=u.locked.width+u.locked.splitterWidth;if(m<=p)f=h=null;else{const{scrollLeft:v=0}=u.normal;h=n.getDateFromCoordinate(Math.max(g-p+v,0));const y=r?1:1.2;f=n.getDateFromCoordinate((m-p+v)*y)||i}}else h=t,f=i;return{pageRangeStart:h,pageRangeEnd:f}}prepareExportElement(){const{element:t,exportMeta:i}=this,{id:r,headerId:n,footerId:s,scrollLeft:a}=i.subGrids.normal,o=t.querySelector(`[id="${r}"]`);return[".b-sch-background-canvas",".b-sch-foreground-canvas"].forEach(l=>{const d=o.querySelector(l);d&&(i.lastExportedRowBottom?d.style.height=`${i.lastExportedRowBottom}px`:d.style.height="",a&&(d.style.marginLeft=`-${a}px`))}),a&&[n,s].forEach(l=>{const d=t.querySelector(`[id="${l}"] .b-widget-scroller`);d&&(d.style.marginLeft=`-${a}px`)}),super.prepareExportElement()}collectHeaders(t){const i=this,{client:r}=t,{exportMeta:n}=i;if(!n.headersCollected){const s=r.timeView.element,a=n.timeAxisHeaders;S.forEachSelector(s,".b-sch-header-row",(o,l,d)=>{const u=a[l];S.forEachSelector(o,".b-sch-header-timeaxis-cell",h=>{u.has(h.dataset.tickIndex)||u.set(h.dataset.tickIndex,h.outerHTML)}),l===d.length-1&&u.has(String(r.timeAxis.count-1))&&(n.headersCollected=!0)})}}collectRanges(t){const i=this,{client:r}=t,{exportMeta:n}=i,{timeRanges:s}=n;if(!n.headersCollected&&s){const{headerCanvas:a,bodyCanvas:o}=r.features.timeRanges;a&&S.forEachSelector(a,".b-sch-timerange",l=>{s.header[l.dataset.id]=l.outerHTML}),S.forEachSelector(o,".b-sch-timerange",l=>{s.body[l.dataset.id]=l.outerHTML})}}collectLines(t){const i=this,{client:r}=t,{exportMeta:n}=i,{columnLines:s}=n;if(!n.headersCollected&&s){const a=r.backgroundCanvas;S.forEachSelector(a,".b-column-line, .b-column-line-major",o=>{if(o.classList.contains("b-column-line")){const l=Number(o.dataset.line.replace(/line-/,""));s.lines.set(l,o.outerHTML)}else{const l=Number(o.dataset.line.replace(/major-/,""));s.majorLines.set(l,o.outerHTML)}})}}collectEvents(t,i){const r=this,n=t.length,{client:s}=i,a=r.exportMeta.subGrids.normal.rows;t.forEach((o,l)=>{var d,u;const h=a[a.length-n+l],f=s.store.getAt(o.dataIndex),g=h[3];(d=f.events)===null||d===void 0||d.forEach(m=>{if(m.isScheduled){let p=s.getElementFromEventRecord(m,f);p&&(p=p.parentElement)&&!g.has(m.id)&&g.set(m.id,[p.outerHTML,$.from(p,p.offsetParent)])}}),(u=f.timeRanges)===null||u===void 0||u.forEach(m=>{var p;const v=((p=s.features.resourceTimeRanges)===null||p===void 0?void 0:p.generateElementId(m))||"",y=s.foregroundCanvas.syncIdMap[v];y&&!g.has(v)&&g.set(v,[y.outerHTML,$.from(y,y.offsetParent)])})})}renderHeaders(t,i,r){const n=this,{exportMeta:s}=n,{client:a}=t,o=s.timeAxisHeaders,{timeAxisView:l}=a.timeAxisColumn,d=l.buildCells(i,r),u=document.createElement("div");Z.sync({targetElement:u,domConfig:d}),S.forEachSelector(u,".b-sch-header-row",(h,f)=>{const g=o[f];S.forEachSelector(h,".b-sch-header-timeaxis-cell",m=>{g.has(m.dataset.tickIndex)||g.set(m.dataset.tickIndex,m.outerHTML)})})}renderEvents(t,i,r,n){const s=this,{client:a}=t,o=s.exportMeta.subGrids.normal.rows;i.forEach((l,d)=>{const u=o[d],h=u[3],f=a.store.getAt(l.dataIndex),g=a.currentOrientation.getResourceLayout(f),m=a.getCoordinateFromDate(r),p=a.getCoordinateFromDate(n),v=a.currentOrientation.getEventDOMConfigForCurrentView(g,l,m,p),y=document.createElement("div");v.forEach(C=>{const{eventId:D}=C.dataset,{left:w,top:E,width:R,height:x}=C.style;Z.sync({targetElement:y,domConfig:C}),h.set(D,[y.outerHTML,new $(w,E,R,x)])})})}renderLines(t,i,r){const n=this,{client:s}=t,{exportMeta:a}=n,{columnLines:o}=a;if(o){const l=s.features.columnLines.getColumnLinesDOMConfig(i,r),d=document.createElement("div");Z.sync({targetElement:d,domConfig:{children:l},onlyChildren:!0}),o.lines.set(0,d.innerHTML)}}renderRanges(t,i,r){const n=this,{client:s}=t,{exportMeta:a}=n,{timeRanges:o}=a;if(o){const l=s.features.timeRanges.getDOMConfig(i,r),d=document.createElement("div");l.forEach((u,h)=>{Z.sync({targetElement:d,domConfig:{children:u,onlyChildren:!0}}),h===0?o.body=d.innerHTML:o.header=d.innerHTML})}}buildPageHtml(t){const i=this,{subGrids:r,timeAxisHeaders:n,timeAxisPlaceholders:s,columnLines:a,columnLinesPlaceholder:o,timeRanges:l,timeRangesHeaderPlaceholder:d,timeRangesBodyPlaceholder:u}=i.exportMeta,{enableDirectRendering:h}=t;let f=i.prepareExportElement();if(Object.values(r).forEach(({placeHolder:g,eventsPlaceholder:m,rows:p,mergedCellsHtml:v})=>{const y=g.outerHTML,{resources:C,events:D}=i.positionRows(p,t);let w=C.join("");v!=null&&v.length&&(w+=`<div class="b-grid-merged-cells-container">${v.join("")}</div>`),f=f.replace(y,w),m&&(f=f.replace(m.outerHTML,D.join("")))}),n.forEach((g,m)=>{f=f.replace(s[m].outerHTML,Array.from(g.values()).join(""))}),a){const g=Array.from(a.lines.values()).concat(Array.from(a.majorLines.values()));f=f.replace(o.outerHTML,g.join("")),h&&(i.exportMeta.columnLines.lines.clear(),i.exportMeta.columnLines.majorLines.clear())}return l&&(h?(f=f.replace(u.outerHTML,l.body),d&&(f=f.replace(d.outerHTML,l.header)),i.exportMeta.timeRanges={}):(f=f.replace(u.outerHTML,Object.values(l.body).join("")),d&&(f=f.replace(d.outerHTML,Object.values(l.body).join(""))))),f=i.buildDependenciesHtml(f),f}getEventBox(t){const i=this,{eventsBoxes:r,enableDirectRendering:n}=i.exportMeta,s=t&&r.get(String(t.id));return n&&s&&t.isMilestone&&s.translate(-s.width/2,0),s}renderDependencies(){const t=this,{client:i,eventsBoxes:r}=t.exportMeta,{dependencies:n}=i,s=i.features.dependencies,a=S.createElement();let o=!1;return n.forEach(l=>{if(!r.has(String(l.from))&&!r.has(String(l.to))||!s.isDependencyVisible(l))return;const d=t.getEventBox(l.fromEvent),u=t.getEventBox(l.toEvent);s.drawDependency(l,!0,{from:d?.clone(),to:u?.clone()}),o=!0}),o&&s.domSync(a),a.innerHTML}buildDependenciesHtml(t){const{dependenciesPlaceholder:i,includeTimeline:r}=this.exportMeta;if(i&&r){const n=i.outerHTML;t=t.replace(n,this.renderDependencies())}return t}};class Dp extends Zd($n){static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}async stateNextPage(e){await super.stateNextPage(e),this.exportMeta.eventsBoxes.clear()}positionRows(e){const t=[],i=[];return e.forEach(([r,n,s,a])=>{t.push(r),a&&Array.from(a.entries()).forEach(([o,[l,d,u=[]]])=>{i.push(l+u.join("")),this.exportMeta.eventsBoxes.set(String(o),d)})}),{resources:t,events:i}}}Dp._$name="MultiPageExporter";class Ep extends Zd(_n){static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}async stateNextPage(e){await super.stateNextPage(e),this.exportMeta.eventsBoxes.clear()}async prepareComponent(e){await super.prepareComponent(e),e.scheduleRange!==Bi.completeview&&this.estimateTotalPages(e)}positionRows(e){const t=[],i=[];return e.forEach(([r,,,n])=>{t.push(r),n&&Array.from(n.entries()).forEach(([s,[a,o,l=[]]])=>{i.push(a+l.join("")),this.exportMeta.eventsBoxes.set(String(s),o)})}),{resources:t,events:i}}}Ep._$name="MultiPageVerticalExporter";class xp extends Ze{static get $name(){return"ScheduleRangeCombo"}static get type(){return"schedulerangecombo"}static get defaultConfig(){return{editable:!1,localizeDisplayFields:!0,displayField:"text",buildItems(){return Object.entries(Bi).map(([e,t])=>({value:e,text:"L{"+t+"}"}))}}}}xp.initClass();xp._$name="ScheduleRangeCombo";class Rp extends eo{static get $name(){return"SchedulerExportDialog"}static get type(){return"schedulerexportdialog"}static get configurable(){return{defaults:{localeClass:this},items:{scheduleRangeField:{type:"schedulerangecombo",label:"L{Schedule range}",value:"completeview",weight:150,onChange({value:e}){this.parent.widgetMap.rangesContainer.hidden=e!==Bi.daterange}},rangesContainer:{type:"container",flex:"1 0 100%",weight:151,hidden:!0,defaults:{localeClass:this},items:{filler:{weight:0,type:"widget"},rangeStartField:{type:"datefield",label:"L{Export from}",labelWidth:"3em",flex:"1 0 25%",weight:10,onChange({value:e}){this.parent.widgetMap.rangeEndField.min=b.add(e,1,"d")}},filler2:{type:"widget",weight:20,width:"0.5em"},rangeEndField:{type:"datefield",label:"L{Export to}",labelWidth:"1em",flex:"1 0 25%",weight:30,onChange({value:e}){this.parent.widgetMap.rangeStartField.max=b.add(e,-1,"d")}}}}}}}onLocaleChange(){const e=this.L("labelWidth");this.width=this.L("L{width}"),this.items.forEach(t=>{t instanceof Oe?t.labelWidth=e:t.ref==="rangesContainer"&&(t.items[0].width=e)})}applyInitialValues(e){super.applyInitialValues(e);const t=this,{client:i,scheduleRange:r}=e,n=e.items=e.items||{},s=n.scheduleRangeField=n.scheduleRangeField||{},a=n.rangesContainer=n.rangesContainer||{},o=a.items=a.items||{},l=o.filler=o.filler||{},d=o.rangeStartField=o.rangeStartField||{},u=o.rangeEndField=o.rangeEndField||{};l.width=t.L("labelWidth"),s.value=s.value||r,s.value===Bi.daterange&&(a.hidden=!1);const h=d.value=d.value||i.startDate;d.max=b.max(i.startDate,b.add(i.endDate,-1,"d"));let f=u.value||i.endDate;f<=h&&(f=b.add(h,1,"d")),u.value=f,u.min=b.min(i.endDate,b.add(i.startDate,1,"d"))}}Rp._$name="SchedulerExportDialog";class Tp extends Zd(to){static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}collectDependencies(){}positionRows(e,t){const i=[],r=[],n=/translate\((\d+.?\d*)px, (\d+.?\d*)px\)/,s=/top:.+?px/;if(t.enableDirectRendering)e.forEach(([a,,,o])=>{i.push(a),o&&Array.from(o.entries()).forEach(([l,[d,u,h=[]]])=>{this.exportMeta.eventsBoxes.set(String(l),u),r.push(d+h.join(""))})});else{let a=0;e.forEach(([o,l,d,u])=>{i.push(o.replace(n,`translate($1px, ${a}px)`));const h=a-l;u&&Array.from(u.entries()).forEach(([f,[g,m]])=>{m.translate(0,h),this.exportMeta.eventsBoxes.set(String(f),m),r.push(g.replace(s,`top: ${m.y}px`))}),a+=d})}return{resources:i,events:r}}}Tp._$name="SinglePageExporter";class Mp extends vd{static get $name(){return"PdfExport"}static get defaultConfig(){return{exporters:[Tp,Dp,Ep],dialogClass:Rp,scheduleRange:"completeview",rangeStart:null,rangeEnd:null}}get defaultExportDialogConfig(){return T.copyProperties(super.defaultExportDialogConfig,this,["scheduleRange"])}buildExportConfig(e){e=super.buildExportConfig(e);const{scheduleRange:t,rangeStart:i,rangeEnd:r}=this;return e.columns&&!e.columns.find(n=>n.type==="timeAxis")&&e.columns.push(e.client.timeAxisColumn.id),T.assign({scheduleRange:t,rangeStart:i,rangeEnd:r},e)}}Mp._$name="PdfExport";G.registerFeature(Mp,!1,"Scheduler");class kp extends Ie(){static get defaultConfig(){return{timeAxis:null,availableSpace:null,tickSize:100,snap:!1,forceFit:!1,headers:null,mode:"horizontal",suppressFit:!1,columnConfig:[],viewPreset:null,columnLinesFor:null,originalTickSize:null,headersDatesCache:[]}}construct(e){const t=this;t.unitToPixelsCache={},super.construct(e);const i=t.timeAxis.viewPreset||t.viewPreset;if(i)if(i instanceof Ui)t.consumeViewPreset(i);else{const r=zn.getPreset(i);r&&t.consumeViewPreset(r)}t.timeAxis.ion({reconfigure:"onTimeAxisReconfigure",thisObj:t}),t.configured=!0}doDestroy(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this),super.doDestroy()}calculateInfiniteScrollingDateRange(e,t,i=this.viewPreset){const{timeAxis:r,availableSpace:n}=this,{bufferCoef:s}=this.owner,{leafUnit:a,leafIncrement:o,tickSize:l}=i;if(t){const d=Math.ceil((n*s+n/2)/l);return{startDate:r.floorDate(b.add(e,-d*o,a),!1,a,o),endDate:r.ceilDate(b.add(e,d*o,a),!1,a,o)}}else{const d=Math.ceil(n*s/l);return{startDate:r.floorDate(b.add(e,-d*o,a),!1,a,o),endDate:r.ceilDate(b.add(e,Math.ceil((n/l+d)*o),a),!1,a,o)}}}get columnConfig(){return this._columnConfig}set columnConfig(e){this._columnConfig=e}get headers(){return this._headers}set headers(e){if(e&&e.length&&e[e.length-1].cellGenerator)throw new Error("`cellGenerator` cannot be used for the bottom level of your headers. Use TimeAxis#generateTicks() instead.");this._headers=e}get isTimeAxisViewModel(){return!0}get isHorizontal(){return this.mode!=="vertical"}get isVertical(){return this.mode==="vertical"}set forceFit(e){e!==this._forceFit&&(this._forceFit=e,this.update())}reconfigure(e){this.headers=null,this.setConfig(e),this.trigger("reconfigure")}onTimeAxisReconfigure({source:e,suppressRefresh:t}){this.viewPreset!==e.viewPreset&&this.consumeViewPreset(e.viewPreset),t||this.update()}update(e,t=!1,i=!1){const r=this,{timeAxis:n,headers:s}=r;if(r.isConfiguring||r._availableSpace===e){i&&r.trigger("update");return}if(r._availableSpace=Math.max(e||r.availableSpace||0,0),typeof r.availableSpace!="number")throw new Error("Invalid available space provided to TimeAxisModel");r.columnConfig=[];const a=r._tickSize=r.calculateTickSize(r.originalTickSize);if(typeof a!="number"||a<=0)throw new Error("Invalid timeAxis tick size");r.unitToPixelsCache={},r._totalSize=null;for(let o=0,{length:l}=s;o<l;o++){const d=s[o];if(d.cellGenerator){const u=d.cellGenerator.call(r,n.startDate,n.endDate);r.columnConfig[o]=r.createHeaderRow(o,d,u)}else r.columnConfig[o]=r.createHeaderRow(o,d)}t||r.trigger("update")}getDistanceBetweenDates(e,t){return this.getPositionFromDate(t)-this.getPositionFromDate(e)}getDistanceForDuration(e){return this.getSingleUnitInPixels("millisecond")*e}getPositionFromDate(e,t={}){const i=this.getScaledTick(e,t);return i===-1?-1:this.tickSize*(i-this.timeAxis.visibleTickStart)}getScaledTick(e,{respectExclusion:t,snapToNextIncluded:i,isEnd:r,min:n,max:s}){const{timeAxis:a}=this,{include:o,unit:l}=a;let d=a.getTickFromDate(e);if(d!==-1&&t&&o){let u=!1;if(o.hour&&b.compareUnits(l,"hour")>0&&l!=="day"){const{from:h,to:f,lengthFactor:g,center:m}=o.hour,p=e.getHours(),v=Math.min(Math.max(p,h),f);if(!i&&v!==p)return-1;const y=v+e.getMinutes()/60,C=m-y,D=m-C*g;e=b.add(e,D-p,"h"),u=!0}if(o.day&&b.compareUnits(l,"day")>0){const{from:h,to:f,lengthFactor:g,center:m}=o.day;let p=e.getDay();r&&e.getHours()===0&&e.getMinutes()===0&&e.getSeconds()===0&&e.getMilliseconds()===0&&--p<0&&(p=6);let v=0;if(p<h||p>=f)if(i){if(r?v=(f-p-8)%7:v=(h-p+7)%7,e=b.add(e,v,"d"),e=b.startOf(e,"d",!1),s&&e.getTime()>=s||n&&e.getTime()<=n)return-1}else return-1;const{weekStartDay:y}=a,C=e.getDay()===0?0:m,D=e.getDay()+e.getHours()/24,w=C-D,E=C-w*g;e=b.add(e,E-D+y,"d"),u=!0}u&&(e=b.constrain(e,a.startDate,a.endDate),d=a.getTickFromDate(e))}return d}getDateFromPosition(e,t,i=!1){const r=this,{timeAxis:n}=r,s=r.getScaledPosition(e)/r.tickSize+n.visibleTickStart;if(s<0||s>n.count){if(i){let a;return s<0?a=b.add(n.startDate,s,n.unit):a=b.add(n.endDate,s-n.count,n.unit),t&&(a=n[t+"Date"](a)),a}return null}return n.getDateFromTick(s,t)}getScaledPosition(e){const{include:t,unit:i,weekStartDay:r}=this.timeAxis;if(t){const n=this.getSingleUnitInPixels("day");if(t.day&&b.compareUnits(i,"day")>0){const{from:s,lengthFactor:a}=t.day,o=e%(n*7),l=e-o;e=o/a+(s-r)*n+l}if(t.hour&&b.compareUnits(i,"hour")>0&&i!=="day"){const{from:s,lengthFactorExcl:a}=t.hour,o=this.getSingleUnitInPixels("hour"),l=e%n,d=e-l;e=l/a+s*o+d}}return e}getSingleUnitInPixels(e){const t=this;return t.unitToPixelsCache[e]||(t.unitToPixelsCache[e]=b.getUnitToBaseUnitRatio(t.timeAxis.unit,e,!0)*t.tickSize/t.timeAxis.increment)}get snapPixelAmount(){if(this.snap){const{resolution:e}=this.timeAxis;return(e.increment||1)*this.getSingleUnitInPixels(e.unit)}return 1}get tickSize(){return this._tickSize}set tickSize(e){this.setTickSize(e,!1)}setTickSize(e,t){this._tickSize=this.originalTickSize=e,this.update(void 0,t)}get timeResolution(){return this.timeAxis.resolution}calculateTickSize(e){const t=this,{forceFit:i,timeAxis:r,suppressFit:n}=t,s=r.unit;let a=0,o=1;if(t.snap){const l=r.resolution;o=b.getUnitToBaseUnitRatio(s,l.unit)*l.increment}if(n)a=e;else{const l=t.availableSpace/r.visibleTickTimeSpan;a=i||e<l?l:e,o>0&&(!i||o<1)&&(a=Math.max(1,o*a)/o)}return a}get totalSize(){return this._totalSize||(this._totalSize=Math.floor(this.tickSize*this.timeAxis.visibleTickTimeSpan))}get availableSpace(){return this._availableSpace}set availableSpace(e){const t=this;if(t._availableSpace=Math.max(0,e),t._availableSpace>0){const i=t.calculateTickSize(t.originalTickSize);i>0&&i!==t.tickSize&&t.update()}}getDates(e=this.columnLinesFor,t=!1,i=!1){const r=this,n=[],s=t?r.lowestHeader:e,a=r.majorHeaderLevel,o=r.headers&&r.headers[e].unit,l=a!=null&&r.headers&&r.headers[a].unit,d=a!=null&&b.doesUnitsAlign(l,o);if(!!(r.headers&&r.headers[s].cellGenerator)){const h=r.columnConfig[s];for(let f=1,g=h.length;f<g;f++)n.push({date:h[f].startDate})}else r.forEachInterval(s,(h,f)=>{n.push({date:i?f:h,isMajor:a!==e&&d&&r.isMajorTick(i?f:h)})});return n}get forceFit(){return this._forceFit}fitToAvailableSpace(e){const t=Math.floor(this.availableSpace/this.timeAxis.visibleTickTimeSpan);this.setTickSize(t,e)}get snap(){return this._snap}set snap(e){e!==this._snap&&(this._snap=e,this.configured&&this.update())}createHeaderRow(e,t,i){const r=this,n=[],{align:s,headerCellCls:a=""}=t,o=b.clearTime(new Date),{timeAxis:l}=r,d=r.headers.length-1,u=(f,g,m,p,v)=>{let y=b.format(f,t.dateFormat);const C=m>0&&!p,D={align:s,start:f,end:g,value:v?v.header:y,headerCellCls:a,width:d===e&&r.owner&&(l.fullTicks||C)?r.owner.tickSize:r.getDistanceBetweenDates(f,g),index:m};D.width!==0&&(D.coord=h-1,h+=D.width,r.headersDatesCache[e][f.getTime()]=1,t.renderer&&(y=t.renderer.call(t.thisObj||r,f,g,D,m),D.value=y??""),t.unit==="day"&&(!t.increment||t.increment===1)&&(D.headerCellCls+=" b-sch-dayheadercell-"+f.getDay(),b.clearTime(f,!0)-o===0&&(D.headerCellCls+=" b-sch-dayheadercell-today")),n.push(D))};let h=0;return r.headersDatesCache[e]={},i?i.forEach((f,g)=>u(f.start,f.end,g,g===i.length-1,f)):r.forEachInterval(e,u),n}get mainHeader(){return"mainHeaderLevel"in this?this.headers[this.mainHeaderLevel]:this.bottomHeader}get bottomHeader(){return this.headers[this.headers.length-1]}get lowestHeader(){return this.headers.length-1}get majorHeaderLevel(){const{headers:e}=this;return e?Math.max(e.length-2,0):null}isMajorTick(e){const t=this.majorHeaderLevel;return t!=null&&this.headersDatesCache[t]&&this.headersDatesCache[t][e.getTime()]||!1}forEachInterval(e,t,i=this){const{headers:r,timeAxis:n}=this;if(r)if(e===r.length-1)n.forEach((s,a)=>t.call(i,s.startDate,s.endDate,a,a===n.count-1));else{const s=r[e];n.forEachAuxInterval(s.unit,s.increment,t,i)}}forEachMainInterval(e,t){this.forEachInterval(this.mainHeaderLevel,e,t)}consumeViewPreset(e){const t=this;t.headers=null,t.getConfig("tickSize"),t.viewPreset=e,Object.assign(t,{headers:e.headers,columnLinesFor:e.columnLinesFor,mainHeaderLevel:e.mainHeaderLevel,_tickSize:t.isHorizontal?e.tickWidth:e.tickHeight}),t.originalTickSize=t.tickSize}}kp._$name="TimeAxisViewModel";const vf=new Date;var bE=c=>{var e;return e=class extends(c||P){getRtlX(i){return this.rtl&&this.isHorizontal&&(i=this.timeAxisViewModel.totalSize-i),i}getDateFromCoordinate(i,r,n=!0,s=!1,a=!1){return n||(i=this.currentOrientation.translateToScheduleCoordinate(i)),a||(i=this.getRtlX(i)),this.timeAxisViewModel.getDateFromPosition(i,r,s)}getDateFromCoord(i){return this.getDateFromCoordinate(i.coord,i.roundingMethod,i.local,i.allowOutOfRange,i.ignoreRTL)}getDateFromXY(i,r,n=!0,s=!1){return this.currentOrientation.getDateFromXY(i,r,n,s)}getDateFromDomEvent(i,r,n=!1){return this.getDateFromXY([i.pageX,i.pageY],r,!1,n)}getStartEndDatesFromRectangle(i,r,n,s=!1){const a=this,{isHorizontal:o}=a,l=o?i.x:i.top,d=o?i.right:i.bottom;let u,h;return l>=0&&d<a.timeAxisViewModel.totalSize?(u=a.getDateFromCoordinate(l,r,!0),h=a.getDateFromCoordinate(d,r,!0)):l<0?(h=a.getDateFromCoordinate(d,r,!0,s),u=h&&b.add(h,-n,"ms")):(u=a.getDateFromCoordinate(l,r,!0,s),h=u&&b.add(u,n,"ms")),{start:u,end:h}}get displayDateFormat(){return this._displayDateFormat}set displayDateFormat(i){this._displayDateFormat=i,this.trigger("displayDateFormatChange",{format:i})}getFormattedDate(i){return b.format(i,this.displayDateFormat)}getDisplayEndDate(i,r){return i.getHours()===0&&i.getMinutes()===0&&(!r||!(i.getYear()===r.getYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()))&&!b.formatContainsHourInfo(this.displayDateFormat)&&(i=b.add(i,-1,"day")),i}getFormattedEndDate(i,r){return this.getFormattedDate(this.getDisplayEndDate(i,r))}getCoordinateFromDate(i,r=!0){const n=this,{timeAxisViewModel:s}=n,{isContinuous:a,startMS:o,endMS:l,startDate:d,endDate:u,unit:h}=n.timeAxis,f=i.valueOf();r===!0?r={local:!0}:r?"local"in r||(r.local=!0):r={local:!1};let g;if(i instanceof Date||(vf.setTime(i),i=vf),a&&i.getTimezoneOffset()===d.getTimezoneOffset()&&d.getTimezoneOffset()===u.getTimezoneOffset()&&b.getUnitToBaseUnitRatio(h,"day")!==-1){if(f<o||f>l)return-1;g=(f-o)/(l-o)*s.totalSize}else g=s.getPositionFromDate(i,r);return n.rtl&&n.isHorizontal&&(g=s.totalSize-g),r.local||(g=n.currentOrientation.translateToPageCoordinate(g)),g}getTimeSpanDistance(i,r){return this.timeAxisViewModel.getDistanceBetweenDates(i,r)}get viewportCenterDate(){const{timeAxis:i,timelineScroller:r}=this;if(i.isContinuous){const n=(r.position+r.clientSize/2)/r.scrollSize;return new Date(i.startMS+(i.endMS-i.startMS)*n)}return this.getDateFromCoordinate(r.position+r.clientSize/2)}get viewportCenterDateCached(){return this.cachedCenterDate||(this.cachedCenterDate=this.viewportCenterDate)}get timeResolution(){return this.timeAxis.resolution}set timeResolution(i){this.timeAxis.resolution=typeof i=="number"?{increment:i,unit:this.timeAxis.resolution.unit}:i}get snap(){var i,r;return(i=(r=this._timeAxisViewModel)===null||r===void 0?void 0:r.snap)!==null&&i!==void 0?i:this._snap}updateSnap(i){this.isConfiguring||(this.timeAxisViewModel.snap=i,this.timeAxis.forceFullTicks=i&&this.fillTicks)}onSchedulerHorizontalScroll({subGrid:i,scrollLeft:r,scrollX:n}){this.scrollingToCenter||(this.cachedCenterDate=null)}get widgetClass(){}},M(e,"$name","TimelineDateMapper"),M(e,"configurable",{snap:!1}),e};const{eventNameMap:CE}=B;var wE=c=>{var e;return e=class extends(c||P){constructor(...i){super(...i),M(this,"hoveredEvents",new Set)}initDomEvents(){const i=this,{schedulerEvents:r,schedulerEnterLeaveEvents:n}=i;r.element=n.element=i.timeAxisSubGridElement,r.thisObj=n.thisObj=i,B.on(r),B.on(n),K.supportsPointerEventConstructor&&B.on({element:document,scroll:"onScheduleScroll",capture:!0,thisObj:i})}getTimeSpanMouseEventParams(i,r){throw new Error("Implement in subclass")}getScheduleMouseEventParams(i,r){throw new Error("Implement in subclass")}handleScheduleEvent(i){const r=this,n=r.getTimelineEventContext(i);r.lastPointerEvent=i,n&&r.trigger(`${n.eventElement?r.scheduledEventName:"schedule"}${CE[i.type]||z.capitalize(i.type)}`,n),r.timelineContext=n}handleScheduleEnterLeaveEvent(i){i.target.parentElement===this.foregroundCanvas&&this.handleScheduleEvent(i)}onScheduleScroll({target:i}){var r;const n=this;if(i&&n.updateTimelineContextOnScroll&&!((r=n.features.pan)!==null&&r!==void 0&&r.isActive)&&!n.partners.some(s=>{var a;return(a=s.features.pan)===null||a===void 0?void 0:a.isActive})&&(i.contains(n.element)||n.bodyElement.contains(i))){const{timelineContext:s,lastPointerEvent:a}=n;if(s){const o=S.elementFromPoint(s.domEvent.clientX,s.domEvent.clientY),l=new PointerEvent("pointermove",a),d=new MouseEvent("mousemove",a);l.scrollInitiated=d.scrollInitiated=!0,o?.dispatchEvent(l),o?.dispatchEvent(d)}}}updateTimelineContext(i,r){this.trigger("timelineContextChange",{oldContext:r,context:i}),i||this.trigger("scheduleMouseLeave")}getTimelineEventContext(i){const r=this,n=i.target.closest(r.eventInnerSelector),s=r.getCellElementFromDomEvent(i);if(s){const a=r.getDateFromDomEvent(i,"floor");if(!a)return;const o=$e.get(s),l=n?r.getTimeSpanMouseEventParams(n,i):r.getScheduleMouseEventParams(o,i);if(!l)return;const d=r.isVertical?r.resourceStore.indexOf(l.resourceRecord):o.row.dataIndex,u=r.timeAxis.getTickFromDate(a),h=r.timeAxis.getAt(Math.floor(u));if(h)return F({isTimelineContext:!0,domEvent:i,eventElement:n,cellElement:s,index:d,tick:h,tickIndex:u,date:a,tickStartDate:h.startDate,tickEndDate:h.endDate,tickParentIndex:h.parentIndex,row:o.row,event:i},l)}}getCellElementFromDomEvent({target:i,clientY:r,type:n}){const s=this,{isVertical:a,foregroundCanvas:o}=s,l=i.closest(s.eventSelector);if(l)return s.getCell({[a?"row":"record"]:a?0:s.resolveRowRecord(l),column:s.timeAxisColumn});if(o.contains(i)){if(i===o||n==="mousemove"){var d;return(d=s.rowManager.getRowAt(r,!1))===null||d===void 0?void 0:d.getCell(s.timeAxisColumn.id)}}else return i.matches(".b-grid-row")?i.firstElementChild:i.closest(s.timeCellSelector)}matchScheduleCell(i){return i.closest(this.timeCellSelector)}onElementMouseButtonEvent(i){const r=i.target.closest(".b-sch-header-timeaxis-cell");if(r){const n=r.dataset.tickIndex,s=r.parentElement.dataset.headerPosition,a=this.timeAxisViewModel.columnConfig[s][n],o=this.features.contextMenu;(!o||i.type!==o.triggerEvent)&&this.trigger(`timeAxisHeader${z.capitalize(i.type)}`,{startDate:a.start,endDate:a.end,event:i})}}onElementMouseDown(i){this.onElementMouseButtonEvent(i),super.onElementMouseDown(i)}onElementClick(i){this.onElementMouseButtonEvent(i),super.onElementClick(i)}onElementDblClick(i){this.onElementMouseButtonEvent(i),super.onElementDblClick(i)}onElementContextMenu(i){this.onElementMouseButtonEvent(i),super.onElementContextMenu(i)}onElementMouseOver(i){var r;super.onElementMouseOver(i);const n=this,{target:s}=i,{hoveredEvents:a}=n;if(s.closest(n.eventInnerSelector)&&!((r=n.features.eventDrag)!==null&&r!==void 0&&r.isDragging)){const o=s.closest(n.eventSelector);if(!a.has(o)&&!n.preventOverCls){a.add(o),o.classList.add(n.overScheduledEventClass);const l=n.getTimeSpanMouseEventParams(o,i);l&&n.trigger(`${n.scheduledEventName}MouseEnter`,l)}}else a.size&&n.unhoverAll(i)}onElementMouseOut(i){var r;super.onElementMouseOut(i);const n=this,{target:s,relatedTarget:a}=i,o=s.closest(n.eventInnerSelector),l=s.closest(n.eventSelector),d=n.resolveTimeSpanRecord(s);if(o&&d&&n.hoveredEvents.has(l)&&!((r=n.features.eventDrag)!==null&&r!==void 0&&r.isDragging)){if(a&&S.isDescendant(o,a))return;n.unhover(l,i)}}unhover(i,r){const n=this;i.classList.remove(n.overScheduledEventClass),n.trigger(`${n.scheduledEventName}MouseLeave`,n.getTimeSpanMouseEventParams(i,r)),n.hoveredEvents.delete(i)}unhoverAll(i){for(const r of this.hoveredEvents)!r.isReleased&&!r.classList.contains("b-released")&&this.unhover(r,i);this.hoveredEvents.clear()}get widgetClass(){}},M(e,"$name","TimelineDomEvents"),M(e,"configurable",{timelineContext:{$config:{equal(t,i){return t?.index===i?.index&&t?.tickParentIndex===i?.tickParentIndex&&!((t?.tickStartDate||0)-(i?.tickStartDate||0))}}},updateTimelineContextOnScroll:!0}),M(e,"properties",{schedulerEvents:{mouseover:"handleScheduleEvent",mousedown:"handleScheduleEvent",mouseup:"handleScheduleEvent",click:"handleScheduleEvent",dblclick:"handleScheduleEvent",contextmenu:"handleScheduleEvent",mousemove:"handleScheduleEvent",mouseout:"handleScheduleEvent"},schedulerEnterLeaveEvents:{mouseenter:"handleScheduleEnterLeaveEvent",mouseleave:"handleScheduleEnterLeaveEvent",capture:!0}}),M(e,"delayable",{onScheduleScroll:"raf"}),e};const yn=(c=0,e=0)=>e-c;var SE=c=>class extends(c||P){static get $name(){return"TimelineViewPresets"}static get configurable(){return{viewPreset:"weekAndDayLetter",presets:!0,displayDateFormat:null}}changePresets(t){const i={owner:this};let r=[];if(t===!0)r=zn.allRecords;else if(Array.isArray(t))for(const s of t)if(typeof s=="string"){const a=zn.getById(s);a&&r.push(a)}else r.push(s);else T.assign(i,t);const n=new _d(i);return n.add(r),n}changeViewPreset(t,i){const r=this,{presets:n}=r;t?(t=n.createRecord(t),n.add(t)):t=n.first;const s=r.lastViewPresetOptions||{},a=t.options||(t.options={}),o=a.event={startDate:a.startDate,endDate:a.endDate,from:i,to:t,preset:t},l=!r._viewPreset||!r._viewPreset.equals(t),d=yn(a.startDate,s.startDate)||yn(a.endDate,s.endDate)||yn(a.centerDate,s.centerDate)||a.startDate&&yn(a.startDate,r.startDate)||a.endDate&&yn(a.endDate,r.endDate);if((l||d)&&(l||(r._viewPreset=null),r.isConfiguring||r.trigger("beforePresetChange",o)!==!1))return t}get displayDateFormat(){return this._displayDateFormat||this.viewPreset.displayDateFormat}updateViewPreset(t){const i=this,{options:r}=t,{event:n,startDate:s,endDate:a}=r,{isHorizontal:o,_timeAxis:l,_timeAxisViewModel:d}=i;let{centerDate:u,zoomDate:h,zoomPosition:f}=r,g=!1;if(i._viewPresetChanging=!0,l&&!i.isConfiguring){if(i.lastViewPresetOptions=r,l.isConfigured){i.suspendRefresh();const m=T.copyProperties({},i,["weekStartDay","startTime","endTime"]);i.infiniteScroll?Object.assign(m,d.calculateInfiniteScrollingDateRange(u||new Date((s.getTime()+a.getTime())/2),!0,t)):s?(m.startDate=s,m.endDate=a,!u&&a&&(u=new Date((s.getTime()+a.getTime())/2))):(m.startDate=l.startDate,m.endDate=a||l.endDate,u||(u=i.viewportCenterDate)),l.isConfigured=!1,l.viewPreset=t,l.reconfigure(m,!0),d.reconfigure({viewPreset:t,headers:t.headers,columnLinesFor:t.columnLinesFor!=null?t.columnLinesFor:t.headers.length-1,tickSize:o?t.tickWidth:t.tickHeight||t.tickWidth||60}),i.resumeRefresh(!1)}if(i.refresh(),!r.notScroll&&i.isPainted)if(h&&f){const m=kt[l.resolutionUnit],p=m>3?"hour":"minute",v=b.asMilliseconds(p==="minute"?15:1,p),y=new Date(Math.round(h/v)*v);n.zoomDate=h,n.zoomPosition=f,n.zoomLevel=r.zoomLevel,i.timelineScroller.scrollBy(i.getCoordinateFromDate(y)-f)}else if(u){i.cachedCenterDate=u,n.centerDate=u;const m=i.timelineScroller.clientSize,p=Math.max(i.getCoordinateFromDate(u,!0)-m/2,0);i.scrollingToCenter=!0,p===(i.isHorizontal?i.scrollLeft:i.scrollTop)?g=!0:i.isHorizontal?i.scrollHorizontallyTo(p,!1):i.scrollVerticallyTo(p,!1),i.setTimeout(()=>{i.scrollingToCenter=!1},100)}else(i.isHorizontal?i.scrollLeft:i.scrollTop)===0?g=!0:i.timelineScroller.scrollTo(0)}i.dataset.presetId=t.id,i.trigger("presetChange",n),i._viewPresetChanging=!1,g&&(i.isHorizontal?i.currentOrientation.updateFromHorizontalScroll(i.scrollLeft,i.scrollX):i.currentOrientation.updateFromVerticalScroll(i.scrollTop))}doDestroy(){this._presets.owner===this&&this._presets.destroy(),super.doDestroy()}getCurrentConfig(t){const i=super.getCurrentConfig(t);return i.viewPreset&&i.viewPreset.name&&!i.viewPreset.base&&delete i.viewPreset.name,i}get widgetClass(){}},DE=c=>class extends(c||P){constructor(...t){super(...t),M(this,"lastWheelTime",-1),M(this,"lastZoomPosition",-1)}static get $name(){return"TimelineZoomable"}static get defaultConfig(){return{zoomOnMouseWheel:!0,zoomOnTimeAxisDoubleClick:!0,minZoomLevel:0,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:null}}construct(t){const i=this;super.construct(t),i.zoomOnMouseWheel&&B.on({element:i.timeAxisSubGridElement,wheel:"onWheel",throttled:{buffer:100,alt:r=>r.ctrlKey&&r.preventDefault()},thisObj:i,capture:!0,passive:!1}),i.zoomOnTimeAxisDoubleClick&&i.ion({timeaxisheaderdblclick:({startDate:r,endDate:n})=>{i.zoomToSpan({startDate:r,endDate:n})}})}get maxZoomLevel(){return this._maxZoomLevel||this.presets.count-1}set maxZoomLevel(t){if(typeof t!="number"&&(t=this.presets.count-1),t<0||t>=this.presets.count)throw new Error("Invalid range for `maxZoomLevel`");this._maxZoomLevel=t}get minZoomLevel(){return this._minZoomLevel}set minZoomLevel(t){if(typeof t!="number"&&(t=0),t<0||t>=this.presets.count)throw new Error("Invalid range for `minZoomLevel`");this._minZoomLevel=t}get zoomLevel(){return this.presets.indexOf(this.viewPreset)}set zoomLevel(t){this.zoomToLevel(t)}getMilliSecondsPerPixelForZoomLevel(t,i){const{bottomHeader:r}=t,n=this.isHorizontal?t.tickWidth:t.tickHeight;return Math.round((b.add(new Date(1,0,1),r.increment||1,r.unit)-new Date(1,0,1))/(i?n:t.actualWidth||n))}zoomTo(t){const i=this;typeof t=="object"?t.preset?i.zoomToLevel(t.preset,t):t.level!=null?i.zoomToLevel(t.level,t):i.zoomToSpan(t):i.zoomToLevel(t)}zoomToLevel(t,i={}){typeof t=="number"&&(t=Math.min(Math.max(t,this.minZoomLevel),this.maxZoomLevel));const r=this,{presets:n}=r,s=r.isVertical?"tickHeight":"tickWidth",a=n.createRecord(t),o=a[s],l=i.startDate?new Date(i.startDate):null,d=i.endDate?new Date(i.endDate):null;n.add(a);let u=l&&d?{startDate:l,endDate:d}:null;const h=i.centerDate?new Date(i.centerDate):u?new Date((l.getTime()+d.getTime())/2):r.viewportCenterDateCached,f=r.isVertical?r.scrollable.clientHeight:r.timeAxisSubGrid.width;return f===0?null:(u||(u=r.calculateOptimalDateRange(h,f,a)),"width"in i&&a.setData(s,i.width),r.isZooming=!0,a.options=F(F({},i),{},{startDate:u.startDate||r.startDate,endDate:u.endDate||r.endDate,centerDate:h}),r.viewPreset=a,a.actualWidth=r.timeAxisViewModel.tickSize,r.isZooming=!1,a.setData(s,o),r.zoomLevel)}zoomToFit(t){const i=this.eventStore,r=i.getTotalTimeSpan();t=F(F({leftMargin:0,rightMargin:0},t),r),t.startDate&&t.endDate&&(t.endDate>t.startDate?this.zoomToSpan(t):this.scrollToDate(t.startDate))}zoomToSpan(t={}){if((t.leftMargin||t.rightMargin)&&(t.adjustStart=0,t.adjustEnd=0),t.leftMargin||(t.leftMargin=0),t.rightMargin||(t.rightMargin=0),!t.startDate||!t.endDate)throw new Error("zoomToSpan: must provide startDate + endDate dates");const i=this,{timeAxis:r}=i,n=t.adjustStart>=0||t.adjustEnd>=0;let{startDate:s,endDate:a}=t;if(n&&(s=b.add(s,-t.adjustStart,r.mainUnit),a=b.add(a,t.adjustEnd,r.mainUnit)),s<=a){const{availableSpace:o}=i.timeAxisViewModel,l=i.presets.allRecords,d=a-s||1;let u=i.zoomLevel,h,f;u===-1&&(u=0);let g=i.getMilliSecondsPerPixelForZoomLevel(l[u],!0),m=u+(h=d/g+t.leftMargin+t.rightMargin>o?-1:1),p,v=null;for(;m>=0&&m<=l.length-1;){p=l[m],g=i.getMilliSecondsPerPixelForZoomLevel(p,!0);const R=d/g+t.leftMargin+t.rightMargin;if(h===-1){if(R<=o){v=m;break}}else if(R<=o)u!==m-h&&(v=m);else break;m+=h}v=v??m-h,p=l[v];const y=p.bottomHeader.unit;g=i.getMilliSecondsPerPixelForZoomLevel(p,!0),(t.leftMargin||t.rightMargin)&&(s=new Date(s.getTime()-g*t.leftMargin),a=new Date(a.getTime()+g*t.rightMargin));const C=b.getDurationInUnit(s,a,y,!0)/p.bottomHeader.increment;if(C===0)return null;const D=Math.floor(o/C),w=t.centerDate||new Date((s.getTime()+a.getTime())/2);n?f={startDate:s,endDate:a}:f=i.calculateOptimalDateRange(w,o,p);let E=i.zoomLevel;return i.zoomLevel===v?r.reconfigure(f):E=i.zoomToLevel(v,Object.assign(f,{width:D,centerDate:w})),i.infiniteScroll&&i.scrollToDate(s,{block:"start"}),E}return null}zoomIn(t=1,i){const r=this.zoomLevel;return r>=this.maxZoomLevel?null:this.zoomToLevel(r+t,i)}zoomOut(t=1,i){const r=this.zoomLevel;return r<=this.minZoomLevel?null:this.zoomToLevel(r-t,i)}zoomInFull(){return this.zoomToLevel(this.maxZoomLevel)}zoomOutFull(){return this.zoomToLevel(this.minZoomLevel)}calculateOptimalDateRange(t,i,r,n){if(n)return n;const s=this,{timeAxis:a}=s,{bottomHeader:o}=r,l=s.isHorizontal?r.tickWidth:r.tickHeight;if(s.zoomKeepsOriginalTimespan)return{startDate:a.startDate,endDate:a.endDate};const d=o.unit,u=Math.ceil(i/l*o.increment*s.visibleZoomFactor/2),h=b.add(t,-u,d),f=b.add(t,u,d);return s.infiniteScroll?s.timeAxisViewModel.calculateInfiniteScrollingDateRange(t,!0):{startDate:a.floorDate(h,!1,d,o.increment),endDate:a.ceilDate(f,!1,d,o.increment)}}onElementMouseMove(t){const{isHorizontal:i,zoomContext:r}=this;super.onElementMouseMove(t),t.isTrusted&&r&&Math.abs(t[`client${i?"X":"Y"}`]-r.coordinate)>10&&(this.zoomContext=null)}async onWheel(t){if(t.ctrlKey){t.preventDefault();const i=this,{zoomContext:r,isHorizontal:n,timelineScroller:s,zoomLevel:a}=i,o=performance.now(),l=t[`client${n?"X":"Y"}`],d=l-s.viewport[`${n?"x":"y"}`]+s.position;o-i.lastWheelTime>200||!r||Math.abs(l-i.zoomContext.coordinate)>20?i.zoomContext={zoomLevel:a,coordinate:l,zoomPosition:d,zoomDate:i.getDateFromDomEvent(t)}:(a>r.zoomLevel&&(r.zoomDate=i.getDateFromDomEvent(t),r.zoomLevel=a),r.zoomPosition=d),i.lastWheelTime=o,i[`zoom${t.deltaY>0?"Out":"In"}`](void 0,i.zoomContext)}}setTimeSpan(t,i){this.timeAxis.setTimeSpan(t,i)}shift(t,i){this.timeAxis.shift(t,i)}shiftNext(t){this.timeAxis.shiftNext(t)}shiftPrevious(t){this.timeAxis.shiftPrevious(t)}get widgetClass(){}},Ip=c=>{var e;return e=class extends(c||P){construct(i){super.construct(i),this.ion({beforeEventDropFinalize:"onRecurrableBeforeEventDropFinalize",beforeEventResizeFinalize:"onRecurrableBeforeEventResizeFinalize",beforeAssignmentDelete:"onRecurrableAssignmentBeforeDelete"})}changeRecurrenceConfirmationPopup(i,r){const n=this.constructor.reconfigure(r,i,"recurrenceconfirmation");return n.owner=this,n}findRecurringEventToConfirmDelete(i){return i.find(r=>r.supportsRecurring&&(r.isRecurring||r.isOccurrence))}onRecurrableAssignmentBeforeDelete({assignmentRecords:i,context:r}){const n=i.map(a=>a.event),s=this.findRecurringEventToConfirmDelete(n);if(this.enableRecurringEvents&&s)return this.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:s,changerFn(){r.finalize(!0)},cancelFn(){r.finalize(!1)}}),!1}onRecurrableBeforeEventDropFinalize({context:i}){if(this.enableRecurringEvents){const{eventRecords:r}=i,n=r.filter(s=>s.supportsRecurring&&(s.isRecurring||s.isOccurrence));n.length&&(i.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:n[0],changerFn(){i.finalize(!0)},cancelFn(){i.finalize(!1)}}))}}onRecurrableBeforeEventResizeFinalize({context:i}){if(this.enableRecurringEvents){const{eventRecord:r}=i;r.supportsRecurring&&(r.isRecurring||r.isOccurrence)&&(i.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:r,changerFn(){i.finalize(!0)},cancelFn(){i.finalize(!1)}}))}}onAssignmentChange({action:i,records:r}){if(i!=="dataset"&&Array.isArray(r))for(const s of r){var n;(n=s.event)!==null&&n!==void 0&&n.isRecurring&&!s.event.isBatchUpdating&&s.event.removeOccurrences()}}getOccurrencesFor(i){return this.eventStore.getOccurrencesForTimeSpan(i,this.timeAxis.startDate,this.timeAxis.endDate)}async removeEvents(i,r=null,n=this){const s=this;if(!s.readOnly&&i.length){const a={finalize(l=!0){r&&r(l),l!==!1&&(i.some(d=>{var u;return d.isOccurrence||((u=d.event)===null||u===void 0?void 0:u.isOccurrence)})?i.forEach(d=>d.isOccurrenceAssignment?d.event.remove():d.remove()):(i[0].isAssignment?s.assignmentStore:s.eventStore).remove(i))}};let o;if(i[0].isAssignment?o=s.trigger("beforeAssignmentDelete",{assignmentRecords:i,context:a}):o=s.trigger("beforeEventDelete",{eventRecords:i,context:a}),o!==!1){const l=i.find(d=>d.isRecurring||d.isOccurrence);return l?(s.recurrenceConfirmationPopup.owner=n,s.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:l,changerFn(){a.finalize(!0)},cancelFn(){a.finalize(!1)}})):a.finalize(!0),!0}}return!1}get widgetClass(){}},M(e,"$name","RecurringEvents"),M(e,"configurable",{enableRecurringEvents:!1,recurrenceConfirmationPopup:{$config:["lazy"],value:{type:"recurrenceconfirmation"}}}),e},EE=c=>{var e;return e=class extends(c||P){static get $name(){return"TimelineEventRendering"}static get defaultConfig(){return{resourceMargin:null,managedEventSizing:!0,generatedIdCls:"b-sch-dirty-new",dirtyCls:"b-sch-dirty",committingCls:"b-sch-committing",endsOutsideViewCls:"b-sch-event-endsoutside",startsOutsideViewCls:"b-sch-event-startsoutside",fixedEventCls:"b-sch-event-fixed",eventStyle:"plain",eventColor:"green",tickSize:null}}updateFillTicks(i){this.isConfiguring||(this.timeAxis.forceFullTicks=i&&this.snap,this.refreshWithTransition(),this.trigger("stateChange"))}changeBarMargin(i){return T.assertNumber(i,"barMargin"),this.isHorizontal&&this.rowHeight?Math.min(Math.ceil(this.rowHeight/2),i):i}updateBarMargin(){this.rendered&&(this.currentOrientation.onBeforeRowHeightChange(),this.refreshWithTransition(),this.trigger("stateChange"))}get resourceMargin(){return this._resourceMargin==null?this.barMargin:this._resourceMargin}set resourceMargin(i){const r=this;T.assertNumber(i,"resourceMargin"),r.isHorizontal&&r.rowHeight&&(i=Math.min(Math.ceil(r.rowHeight/2),i)),r._resourceMargin!==i&&(r._resourceMargin=i,r.rendered&&(r.currentOrientation.onBeforeRowHeightChange(),r.refreshWithTransition()))}set tickSize(i){T.assertNumber(i,"tickSize"),this.timeAxisViewModel.tickSize=i}get tickSize(){return this.timeAxisViewModel.tickSize}static get eventColors(){return["red","pink","purple","violet","indigo","blue","cyan","teal","green","lime","yellow","orange","deep-orange","gray"]}static get eventStyles(){return["plain","border","hollow","colored","line","dashed","minimal","rounded"]}get widgetClass(){}},M(e,"configurable",{barMargin:10,fillTicks:!1}),e};const xE={maintainVisibleStart:!0},RE={block:"nearest"};var TE=c=>class extends(c||P){static get $name(){return"TimelineScroll"}static get configurable(){return{bufferCoef:5,bufferThreshold:.2,infiniteScroll:!1}}initScroll(){const t=this,{isHorizontal:i}=t;super.initScroll();const{scrollable:r}=i?t.timeAxisSubGrid:t;if(r.ion({scroll:"onTimelineScroll",thisObj:t}),t.infiniteScroll){const{visibleDate:n}=t,s=n?n.date||n:t.viewportCenterDate,a=n&&"block"in n?n.block==="center":!0,{startDate:o,endDate:l}=t.timeAxisViewModel.calculateInfiniteScrollingDateRange(s,a);t.setTimeSpan(o,l,{visibleDate:s})}}get timelineScroller(){const t=this;return t.scrollInitialized||t.initScroll(),t._timelineScroller||(t._timelineScroller=new ME({widget:t,scrollable:t.isHorizontal?t.timeAxisSubGrid.scrollable:t.scrollable,isHorizontal:t.isHorizontal}))}doDestroy(){var t;(t=this._timelineScroller)===null||t===void 0||t.destroy(),super.doDestroy()}onTimelineScroll({source:t}){this.infiniteScroll&&this.checkTimeAxisScroll(t[this.isHorizontal?"x":"y"])}checkTimeAxisScroll(t){const i=this,r=i.timelineScroller,{clientSize:n}=r,s=n*i.bufferCoef,a=s*i.bufferThreshold,o=r.maxPosition,{style:l}=i.timeAxisSubGrid.virtualScrollerElement;(o-t<a||t<a)&&(l.overflow="hidden",l.pointerEvents="none",l.paddingBottom=`${S.scrollBarWidth}px`,i.setTimeout(()=>{l.overflow="",l.paddingBottom="",l.pointerEvents=""},100),i.shiftToDate(i.getDateFromCoordinate(t,null,!0)))}shiftToDate(t,i){const r=this.timeAxisViewModel.calculateInfiniteScrollingDateRange(t,i);this.setTimeSpan(r.startDate,r.endDate,xE)}updateInfiniteScroll(t){!this.isConfiguring&&t&&this.checkTimeAxisScroll(this.timelineScroller.position)}scrollToDate(t,i={}){const r=this,{timeAxis:n,visibleDateRange:s,infiniteScroll:a}=r,{unit:o,increment:l}=n,d=i.edgeOffset||0,u=b.ceil(s.endDate,l+" "+o)-b.floor(s.startDate,l+" "+o),h=t>r.viewportCenterDate?1:-1,f=(a?u*r.bufferCoef*r.bufferThreshold:i.block==="center"?u/2:d?r.getMilliSecondsPerPixelForZoomLevel(r.viewPreset)*d:0)*h,g=new Date(t.getTime()+f);(g>n.endDate?1:g<n.startDate?-1:0)&&r.infiniteScroll&&r.shiftToDate(new Date(t-f),null,!0);const p=r.timelineScroller.viewport,v=r.getCoordinateFromDate(t,!0),y=r.isHorizontal?new $(r.getCoordinateFromDate(t,!1),p.y,Math.min(r.timeAxisViewModel.tickSize,r.timeAxisViewModel.availableSpace),p.height):new $(p.x,r.getCoordinateFromDate(t,!1),p.width,r.timeAxisViewModel.tickSize);return r.scrollToCoordinate(v,y,t,i)}scrollToNow(t={}){return this.scrollToDate(new Date,t)}async scrollToCoordinate(t,i,r,n={}){const s=this;if(t<0){const a=s.endDate-s.startDate,{unit:o,increment:l}=s.timeAxis,d=b.floor(new Date(r.getTime()-a/2),l+" "+o),u=b.add(d,a);return d-s.startDate!==0&&u-s.endDate!==0?(s.setTimeSpan(d,u),s.scrollToDate(r,n)):void 0}return await s.timelineScroller.scrollIntoView(i,n),!s.isDestroyed&&s.nextAnimationFrame()}set scrollLeft(t){this.timeAxisSubGrid.scrollable.element.scrollLeft=t}get scrollLeft(){return this.timeAxisSubGrid.scrollable.element.scrollLeft}set scrollX(t){this.timeAxisSubGrid.scrollable.x=t}get scrollX(){return this.timeAxisSubGrid.scrollable.x}set scrollTop(t){this.scrollable.y=t}get scrollTop(){return this.scrollable.y}scrollHorizontallyTo(t,i=!0){return this.timeAxisSubGrid.scrollable.scrollTo(t,null,i)}scrollVerticallyTo(t,i=!0){return this.scrollable.scrollTo(null,t,i)}scrollTo(t,i=!0){return this.timeAxisSubGrid.scrollable.scrollTo(t,null,i)}get widgetClass(){}};class ME extends Ke{static get configurable(){return{position:null,x:null,y:null}}updateOverflowX(){}updateOverflowY(){}onScroll(e){super.onScroll(e),this._position=null}syncPartners(e){this.scrollable.syncPartners(e)}updatePosition(e){this.scrollable[this.isHorizontal?"x":"y"]=e}get viewport(){return this.scrollable.viewport}get position(){return this._position=this.scrollable[this.isHorizontal?"x":"y"]}get clientSize(){return this.scrollable[`client${this.isHorizontal?"Width":"Height"}`]}get scrollSize(){return this.scrollable[`scroll${this.isHorizontal?"Width":"Height"}`]}get maxPosition(){return this.scrollable[`max${this.isHorizontal?"X":"Y"}`]}scrollTo(e,t){return this.isHorizontal?this.scrollable.scrollTo(e,null,t):this.scrollable.scrollTo(null,e,t)}scrollBy(e=0,t=0,i=RE){return this.isHorizontal?this.scrollable.scrollBy(e||t,0,i):this.scrollable.scrollBy(0,t||e,i)}scrollIntoView(){return this.scrollable.scrollIntoView(...arguments)}changeX(e){this.position=e}changeY(e){this.position=e}get x(){return this.position}set x(e){this.scrollable[this.isHorizontal?"x":"y"]=e}get y(){return this.position}set y(e){this.scroller[this.isHorizontal?"x":"y"]=e}get clientWidth(){return this.clientSize}get clientHeight(){return this.clientSize}get scrollWidth(){return this.scrollSize}get scrollHeight(){return this.scrollSize}get maxX(){return this.maxPosition}get maxY(){return this.maxPosition}}const yf=["barMargin"];var kE=c=>class extends(c||P){static get $name(){return"TimelineState"}getState(){const t=this,i=T.copyProperties(super.getState(),t,yf);return i.zoomLevel=t.zoomLevel,i.zoomLevelOptions={startDate:t.startDate,endDate:t.endDate,centerDate:!t.infiniteScroll||t.timeAxisViewModel.availableSpace?t.viewportCenterDate:void 0,width:t.tickSize},i}applyState(t){const i=this;if(i.suspendRefresh(),T.copyProperties(i,t,yf),super.applyState(t),t.zoomLevel!=null){if(i.infiniteScroll){var r;t!=null&&(r=t.scroll)!==null&&r!==void 0&&r.scrollLeft&&(t.scroll.scrollLeft={})}i.isPainted?i.zoomToLevel(t.zoomLevel,t.zoomLevelOptions):i._zoomAfterPaint={zoomLevel:t.zoomLevel,zoomLevelOptions:t.zoomLevelOptions}}i.resumeRefresh(!0)}onPaint(...t){if(super.onPaint(...t),this._zoomAfterPaint){const{zoomLevel:i,zoomLevelOptions:r}=this._zoomAfterPaint;this.zoomToLevel(i,r),delete this._zoomAfterPaint}}get widgetClass(){}};class Fp extends ro{static get $name(){return"SchedulerHeader"}refreshContent(){var e;(e=this.headersElement)!==null&&e!==void 0&&e.querySelector(".b-sch-timeaxiscolumn")||super.refreshContent()}}Fp._$name="Header";class Ap extends Mr{static get $name(){return"TimeAxisSubGrid"}static get type(){return"timeaxissubgrid"}static get configurable(){return{sealedColumns:!0,headerClass:Fp}}startConfigure(e){const{grid:t}=e;t.timeAxisSubGrid=this,super.startConfigure(e),t.isHorizontal&&(e.header={cls:{"b-sticky-headers":t.stickyHeaders}},delete e.headerClass),"flex"in e||"width"in e||(e.flex=1)}changeScrollable(){const e=this,t=super.changeScrollable(...arguments);return t&&Object.defineProperty(t,"scrollWidth",{get(){var i,r;return(i=(r=this.element)===null||r===void 0?void 0:r.scrollWidth)!==null&&i!==void 0?i:0},set(){e.grid.updateCanvasSize()}}),t}syncScrollingPartners(e=!0){this.grid._viewPresetChanging||super.syncScrollingPartners(e)}onInternalResize(e,t,i,r,n){const s=this;if(s.isPainted&&t!==r){const a=s.grid,o=a._bodyRectangle.height;S.scrollBarWidth&&t<r&&(s.monitorResize=!1),a.onSchedulerViewportResize(t,o,r,o),s.monitorResize||s.requestAnimationFrame(()=>s.monitorResize=!0)}super.onInternalResize(...arguments)}clearWidthCache(){super.clearWidthCache(),this.owner.isHorizontal&&this.owner.updateViewModelAvailableSpace(this.width)}}Ap.initClass();Ap._$name="TimeAxisSubGrid";const bf={fn:"exitTransition",delay:0,cancelOutstanding:!0},Tl={};class ys extends rs.mixin(bE,wE,EE,TE,kE,SE,DE,Ip){static get $name(){return"TimelineBase"}static get type(){return"timelinebase"}static get defaultConfig(){return{workingTime:null,timeAxis:null,timeAxisViewModel:null,autoAdjustTimeAxis:!0,snapRelativeToEventStartDate:!1,suppressFit:!1,timeCellCls:null,scheduledEventName:null,overScheduledEventClass:null,preventOverCls:!1,useBackgroundCanvas:!1,enableEventAnimations:!0,disableGridRowModelWarning:!0,animateRemovingRows:!1,partner:null,schedulerRegion:"normal",transitionDuration:200,animationTimeout:null,defaultRegion:"locked",durationDisplayPrecision:1,asyncEventSuffix:"PreCommit",viewportResizeTimeout:250}}updateTimeZone(e){this.isConfiguring&&(this.project._isConfiguringTimeZone=!0),this.project.timeZone=e}get timeZone(){return this.project.timeZone}populateEventMenu(){}populateScheduleMenu(){}onVisibleDateRangeChange(e){if(!this.handlingVisibleDateRangeChange){const t=this,{_visibleDateRange:i}=t;(!i||i.startDate-e.startDate||i.endDate-e.endDate)&&(t.timeView.range=e,t.handlingVisibleDateRangeChange=!0,t.trigger("visibleDateRangeChange",{old:i,new:e}),t.handlingVisibleDateRangeChange=!1,t._visibleDateRange=e)}}onVisibleResourceRangeChange(){}construct(e={}){const t=this;super.construct(e),t.$firstVerticalOverflow=!0,t.initDomEvents(),t.currentOrientation.init(),t.rowManager.ion({refresh:()=>{t.forceLayout=!1}})}createSubGrid(e,t={}){const i=this,{stickyHeaders:r}=i;return e===(i.schedulerRegion||"normal")?t.type="timeaxissubgrid":e==="locked"&&r&&i.isVertical&&(t.scrollable={overflowX:"visible",overflowY:"visible"},i.bodyContainer.classList.add("b-sticky-headers")),super.createSubGrid(e,t)}doDestroy(){const e=this,{partneredWith:t,currentOrientation:i}=e;i?.destroy(),t?(t.forEach(r=>{e.removePartner(r)}),t.destroy()):(e.timeAxisViewModel.destroy(),e.timeAxis.destroy()),super.doDestroy()}startConfigure(e){super.startConfigure(e),Ne.addResizeListener(this.bodyContainer,this.onBodyResize.bind(this)),this.getConfig("partner")}changeStartDate(e){return typeof e=="string"&&(e=b.parse(e)),e}onPaint({firstPaint:e}){if(e){const r=this,n=r.isHorizontal?r.timeAxisSubGrid.scrollable:r.scrollable,s=n.element.getBoundingClientRect()[r.isHorizontal?"width":"height"];if(r.timeAxisViewModel.update(s,r.infiniteScroll,!0),r.infiniteScroll){var t,i;(t=(i=r.currentOrientation).doUpdateTimeView)===null||t===void 0||t.call(i)}}super.onPaint(...arguments)}onSchedulerHorizontalScroll(e,t,i){this.currentOrientation.updateFromHorizontalScroll(i),super.onSchedulerHorizontalScroll(e,t,i)}initScroll(){const e=this;let t=0;super.initScroll(),e.ion({horizontalScroll:({subGrid:i,scrollLeft:r,scrollX:n})=>{e.isPainted&&i===e.timeAxisSubGrid&&!e.isDestroying&&!e.refreshSuspended&&e.onSchedulerHorizontalScroll(i,r,n),t++}}),e.testPerformance==="horizontal"&&e.setTimeout(()=>{const i=performance.now();let r=5,n=1;const s=e.setInterval(()=>{if(r=r+5,e.scrollX+=(10+Math.floor(r))*n,n===1&&e.scrollX>5500&&(n=-1,r=5),n===-1&&e.scrollX<=0){const l=(performance.now()-i)/t,d=Math.round(1e3/l*10)/10;clearInterval(s),console.log(e.eventPositionMode,e.eventScrollMode,d+"fps")}},0)},500)}preserveViewCenter(e,t=this,...i){const r=this,n=r.viewportCenterDate,s=e.apply(t,i),a=r.timelineScroller,{clientSize:o}=a,l=Math.max(Math.floor(r.getCoordinateFromDate(n,!0)-o/2),0);return r.scrollingToCenter=!0,a.scrollTo(l,!1).then(()=>r.scrollingToCenter=!1),s}setTimeSpan(e,t,{preventThrow:i=!1,maintainVisibleStart:r=!1,visibleDate:n}=Tl){const s=this,{timeAxis:a}=s,{startDate:o,endDate:l}=a.getAdjustedDates(e,t),d=a.startDate-o!==0,u=a.endDate-l!==0;if(d||u){if(r){const{timeAxisViewModel:f}=s,{totalSize:g}=f,m=f.tickSize,p=s.timelineScroller,v=p.position,y=f.getDateFromPosition(v);y>=o&&y<l&&f.ion({update(){const C=f.tickSize!==m;s.updateCanvasSize(),d&&!u&&!C?p.position+=f.totalSize-g:!d&&!C?p.position=v:p.position=f.getPositionFromDate(y),p.syncPartners(!0)},prio:1e4,once:!0})}const h=a.reconfigure({startDate:o,endDate:l},!1,i);return n&&s.scrollToDate(n.date||n,n),h}}get hasVisibleEvents(){return!this.noFeatureElementsInAxis()||this.eventStore.storage.values.some(e=>this.timeAxis.isTimeSpanInAxis(e))}noFeatureElementsInAxis(){}get capitalizedEventName(){return this._capitalizedEventName||(this._capitalizedEventName=z.capitalize(this.scheduledEventName)),this._capitalizedEventName}set partner(e){this._partner=e,this.addPartner(e)}addPartner(e){const t=this;if(!t.isPartneredWith(e)){(t.partneredWith||(t.partneredWith=new rt)).add(e),(e.partneredWith||(e.partneredWith=new rt)).add(t),t.getConfig("viewPreset"),e.ion({presetchange:"onPartnerPresetChange",thisObj:t}),e.scrollable.ion({overflowChange:"onPartnerOverflowChange",thisObj:t});const r=t.partnerSharedConfigs.reduce((n,s)=>(n[s]=e[s],n),{});t.setConfig(r),t.ion({presetchange:"onPartnerPresetChange",thisObj:e}),t.scrollable.ion({overflowChange:"onPartnerOverflowChange",thisObj:e}),t.isPainted?(t.scrollable.addPartner(e.scrollable,t.isHorizontal?"x":"y"),e.syncPartnerSubGrids()):t.initScroll=ve.createSequence(t.initScroll,()=>{t.scrollable.addPartner(e.scrollable,t.isHorizontal?"x":"y"),e.syncPartnerSubGrids()},t)}}removePartner(e){const t=this,{partneredWith:i}=t;t.isPartneredWith(e)&&(i.remove(e),t.scrollable.removePartner(e.scrollable),t.un({presetchange:"onPartnerPresetChange",thisObj:e}),t.scrollable.un({overflowChange:"onPartnerOverflowChange",thisObj:e}),e.removePartner(t))}isPartneredWith(e){var t;return Boolean((t=this.partneredWith)===null||t===void 0?void 0:t.includes(e))}onPartnerOverflowChange({source:e,y:t}){const{scrollable:i}=this,r=i.hasOverflow("y");r!==t?r?e.overflowY="scroll":(e.overflowY=!0,i.overflowY="scroll",this.refreshVirtualScrollbars()):i.overflowY=!0}onPartnerPresetChange({preset:e,startDate:t,endDate:i,centerDate:r,zoomDate:n,zoomPosition:s,zoomLevel:a}){!this._viewPresetChanging&&this.viewPreset!==e&&(e.options={startDate:t,endDate:i,centerDate:r,zoomDate:n,zoomPosition:s,zoomLevel:a},this.viewPreset=e)}get partner(){return this._partner}get partners(){const e=this.partner?[this.partner]:[];return this.partneredWith&&e.push.apply(e,this.partneredWith.allValues),e}get timeAxisColumn(){return this.columns&&this._timeAxisColumn}get columns(){return super.columns}set columns(e){const t=this;let i,r,n;if(e){const s=Array.isArray(e);let a=e;s||(a=e.data),i=a&&a.length,a.some((o,l)=>o.type==="timeAxis"?(i=l,r=T.assign(o,t.timeAxisColumn),!0):!1),t.isVertical?(t._horizontalColumns=e,a=[T.assign({type:"verticalTimeAxis",locked:!0},t.verticalTimeAxisColumn),a[i]],i=1):a=a.slice(),a[i]=F({type:"timeAxis",locked:!1,cellCls:t.timeCellCls,mode:t.mode},r),s?e=a:e.data=a}super.columns=e,e&&(n=t._timeAxisColumn=t.columns.find(s=>s.isTimeAxisColumn),t.isVertical&&(t.verticalTimeAxisColumn=t.columns.find(s=>s.isVerticalTimeAxisColumn),t.verticalTimeAxisColumn.relayAll(t)),n.relayAll(t))}onColumnsChanged({action:e,changes:t,record:i}){const{timeAxisColumn:r,columns:n}=this;e==="dataset"&&!n.includes(r)?n.add(r,!0):i===r&&"width"in t&&this.updateCanvasSize(),super.onColumnsChanged(...arguments)}get timeView(){const e=this;return e.columns&&e.isVertical?e.verticalTimeAxisColumn&&e.verticalTimeAxisColumn.view:e.timeAxisColumn&&e.timeAxisColumn.timeAxisView}updateEventCls(e){const t=this;t.eventSelector||(t.unreleasedEventSelector=t.eventSelector=`.${e}-wrap`),t.eventInnerSelector||(t.eventInnerSelector=`.${e}`)}set timeAxisViewModel(e){var t;const i=this,r=i._timeAxisViewModel,n={name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",prio:100,thisObj:i};i.partner&&!e||r&&r===e||(r?.owner===i&&r.destroy(),i.detachListeners("timeAxisViewModel"),(t=e)!==null&&t!==void 0&&t.isTimeAxisViewModel?e.ion(n):e=kp.new({mode:i._mode,snap:i.snap,forceFit:i.forceFit,timeAxis:i.timeAxis,suppressFit:i.suppressFit,internalListeners:n,owner:i},e),i.isConfiguring||(i.isHorizontal?i.timeAxisColumn.timeAxisViewModel=e:i.verticalTimeAxisColumn.view.model=e),i._timeAxisViewModel=e,i.relayEvents(e,["update"],"timeAxisViewModel"),r&&e&&i.trigger("timeAxisViewModelChange",{timeAxisViewModel:e}))}get timeAxisViewModel(){return this._timeAxisViewModel||(this.timeAxisViewModel=null),this._timeAxisViewModel}get suppressFit(){var e,t;return(e=(t=this._timeAxisViewModel)===null||t===void 0?void 0:t.suppressFit)!==null&&e!==void 0?e:this._suppressFit}set suppressFit(e){this._timeAxisViewModel?this.timeAxisViewModel.suppressFit=e:this._suppressFit=e}set timeAxis(e){var t;const i=this,r=i._timeAxis,n={name:"timeAxis",reconfigure:"onTimeAxisReconfigure",thisObj:i};i.partner&&!e||r&&r===e||(r&&r.owner===i&&r.destroy(),i.detachListeners("timeAxis"),(t=e)!==null&&t!==void 0&&t.isTimeAxis||(e=T.assign({owner:i,viewPreset:i.viewPreset,autoAdjust:i.autoAdjustTimeAxis,weekStartDay:i.weekStartDay,forceFullTicks:i.fillTicks&&i.snap},e),i.startDate&&(e.startDate=i.startDate),i.endDate&&(e.endDate=i.endDate),i.workingTime&&i.applyWorkingTime(e),e=new Jm(e)),e.ion(n),i._timeAxis=e)}onTimeAxisReconfigure({config:e,oldConfig:t}){e&&(!t||t.startDate-e.startDate||t.endDate-e.endDate)&&this.trigger("dateRangeChange",{old:{startDate:t.startDate,endDate:t.endDate},new:{startDate:e.startDate,endDate:e.endDate}}),this.trigger("timeAxisChange",{config:e})}get timeAxis(){return this._timeAxis||(this.timeAxis=null),this._timeAxis}updateForceFit(e){this._timeAxisViewModel&&(this._timeAxisViewModel.forceFit=e)}set workingTime(e){this._workingTime=e,this.isConfiguring||this.applyWorkingTime(this.timeAxis)}get workingTime(){return this._workingTime}applyWorkingTime(e){const t=this,i=t._workingTime;if(i){let n=null;i.fromHour>=0&&i.fromHour<24&&i.toHour>i.fromHour&&i.toHour<=24&&i.toHour-i.fromHour<24&&(n={from:i.fromHour,to:i.toHour});let s=null;i.fromDay>=0&&i.fromDay<7&&i.toDay>i.fromDay&&i.toDay<=7&&i.toDay-i.fromDay<7&&(s={from:i.fromDay,to:i.toDay}),n||s?e.include={hour:n,day:s}:e.include=null}else e.include=null;if(t.isPainted){var r;t.timeAxisColumn.refreshHeader(),(r=t.features.columnLines)===null||r===void 0||r.refresh(),t.refreshWithTransition()}}updateStartDate(e){this.setStartDate(e)}setStartDate(e,t=!0){const i=this,r=i._timeAxis,{startDate:n,endDate:s,mainUnit:a}=r||Tl;if(typeof e=="string"&&(e=b.parse(e)),r&&s){if(e){let o=s;if(t&&n){const l=b.diff(n,s,a,!0);o=b.add(e,l,a)}i.setTimeSpan(e,o)}}else i._tempStartDate=e}get startDate(){const e=this;return e._timeAxis?e._timeAxis.startDate:e._tempStartDate||new Date}changeEndDate(e){typeof e=="string"&&(e=b.parse(e)),this.setEndDate(e)}setEndDate(e,t=!1){const i=this,r=i._timeAxis,{startDate:n,endDate:s,mainUnit:a}=r||Tl;if(typeof e=="string"&&(e=b.parse(e)),r&&n){if(e){let o=n;if(t&&s){const l=b.diff(n,s,a,!0);o=b.add(e,-l,a)}i.setTimeSpan(o,e)}}else i._tempEndDate=e}get endDate(){const e=this;return e._timeAxis?e._timeAxis.endDate:e._tempEndDate||b.add(e.startDate,e.viewPreset.defaultSpan,e.viewPreset.mainHeader.unit)}changeVisibleDate(e){return e instanceof Date?{date:e}:e}updateVisibleDate(e){const t=this;t.isPainted?t.scrollToDate(e.date,e):t.ion({paint:()=>t.scrollToDate(e.date,e),once:!0})}get features(){return super.features}set features(e){e=e===!0?{}:e,"regionResize"in e||(e.regionResize=!0),super.features=e}get eventStyle(){return this._eventStyle}set eventStyle(e){this._eventStyle=e,this.refreshWithTransition(),this.trigger("stateChange")}get eventColor(){return this._eventColor}set eventColor(e){this._eventColor=e,this.refreshWithTransition(),this.trigger("stateChange")}onLocaleChange(){super.onLocaleChange();const e=this.timeAxis.autoAdjust;this.timeAxis.reconfigure({autoAdjust:!1}),this.timeAxis.autoAdjust=e}onBodyResize(e,t,{width:i,height:r}){this.isVertical&&t&&i!==t.width&&delete this.timeAxisSubGrid._width;const n=this.timeAxisSubGrid.element.offsetWidth;this._bodyRectangle&&t&&r!==t.height&&this.onSchedulerViewportResize(n,r,n,t.height)}onSchedulerViewportResize(e,t,i,r){if(this.isPainted){const n=this,{isHorizontal:s,partneredWith:a}=n;n.currentOrientation.onViewportResize(e,t,i,r),n.updateViewModelAvailableSpace(s?e:Math.floor(t)),a&&!n.isSyncingFromPartner&&n.syncPartnerSubGrids(),n.trigger("timelineViewportResize",{width:e,height:t,oldWidth:i,oldHeight:r})}}updateViewModelAvailableSpace(e){this.timeAxisViewModel.availableSpace=e}onTimeAxisViewModelUpdate(){this._viewPresetChanging||(this.updateCanvasSize(),this.currentOrientation.onTimeAxisViewModelUpdate())}syncPartnerSubGrids(){this.partneredWith.forEach(e=>{e.isSyncingFromPartner||(e.isSyncingFromPartner=!0,this.eachSubGrid(t=>{const i=e.subGrids[t.region];i.width!==t.width&&(t.collapsed?i.collapse():(i.collapsed&&i.expand(),t.flex?t.flex!==i.flex&&(i.flex=t.flex):i.width=t.width))}),e.isSyncingFromPartner=!1)})}get currentOrientation(){throw new Error("Implement in subclass")}get isHorizontal(){return!0}get backgroundCanvas(){return this._backgroundCanvas}get foregroundCanvas(){return this._foregroundCanvas}get svgCanvas(){const e=this;if(!e._svgCanvas){const t=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("id",Or.generateId("svg")),t.retainElement=!0,e.foregroundCanvas.appendChild(t),e.trigger("svgCanvasCreated",{svg:t})}return e._svgCanvas}get timeAxisSubGridElement(){if(!this._timeAxisSubGridElement){var e;this.getConfig("regions"),this._timeAxisSubGridElement=(e=this.timeAxisColumn)===null||e===void 0?void 0:e.subGridElement}return this._timeAxisSubGridElement}updateCanvasSize(){const e=this,{totalSize:t}=e.timeAxisViewModel,i=e.isHorizontal?t:e.timeAxisColumn.width;let r=!1;return e.isVertical&&(e.isPainted&&e.refreshTotalHeight(t+e._rowBorderHeight,!0),e.suppressFit&&S.setLength(e.foregroundCanvas,"height",t),r=!0),i!==e.$canvasWidth&&e.foregroundCanvas&&(e.backgroundCanvas&&S.setLength(e.backgroundCanvas,"width",i),S.setLength(e.foregroundCanvas,"width",i),e.$canvasWidth=i,r=!0),r}getHeaderDomConfigs(e){}getForegroundDomConfigs(e){}async onStoreDataChange({action:e}){const t=this;t.isVisible?(e==="dataset"&&t.project.isRepopulatingStores&&await t.project.await("refresh",!1),super.onStoreDataChange(...arguments)):t.whenVisible("refresh",t,[!0])}refresh(e=!0){const t=this;t.isPainted&&!t.refreshSuspended&&(t.hasVisibleEvents||t.timeAxisSubGridElement.querySelector(t.eventSelector)?t.isEngineReady?t.refreshRows(!1,e):(t.refreshAfterProjectRefresh=!0,t.currentOrientation.refreshAllWhenReady=!0):t.rowManager.trigger("refresh"))}render(){const e=this,t=e.timeAxisSubGridElement;e.useBackgroundCanvas&&(e._backgroundCanvas=S.createElement({className:"b-sch-background-canvas",parent:t,nextSibling:t.firstElementChild}));const i=e._foregroundCanvas=S.createElement({className:"b-sch-foreground-canvas",style:`font-size:${e.rowHeight-e.resourceMargin*2}px`,parent:t});e.timeAxisSubGrid.insertRowsBefore=i,e.isVertical&&e.suppressFit&&e.updateCanvasSize(),super.render(...arguments)}refreshRows(e=!1,t=!0){const i=this;i.isConfiguring||(i.currentOrientation.refreshRows(t),super.refreshRows(e))}getCellDataFromEvent(e,t){return t&&(t=!Boolean(e.target.closest(".b-sch-foreground-canvas"))),super.getCellDataFromEvent(e,t)}runWithTransition(e,t){const i=this;i.isVisible&&((t==null||t===!0)&&(t=i.transitionDuration),t&&i.enableEventAnimations&&(i.hasTimeout("exitTransition")||(i.isAnimating=!0),bf.delay=t,i.setTimeout(bf))),e()}exitTransition(){this.isAnimating=!1,this.trigger("transitionend")}async waitForAnimations(){this.isEngineReady||await this.project.await("dataReady",!1),await super.waitForAnimations()}refreshWithTransition(e,t){this.isPainted&&!this.refreshSuspended&&this.runWithTransition(()=>this.refresh(e),t)}get visibleDateRange(){return this.currentOrientation.visibleDateRange}isRowNumberSelecting(...e){return super.isRowNumberSelecting(...e)||e.some(t=>{var i;return t.column?t.column.isTimeAxisColumn:(i=t.cell)===null||i===void 0?void 0:i.closest(".b-timeaxis-cell")})}formatDuration(e,t=this.durationDisplayPrecision){const i=Math.pow(10,t);return Math.round(e*i)/i}beginListeningForBatchedUpdates(){this.listenToBatchedUpdates=(this.listenToBatchedUpdates||0)+1}endListeningForBatchedUpdates(){this.listenToBatchedUpdates&&(this.listenToBatchedUpdates-=1)}}M(ys,"configurable",{partnerSharedConfigs:{value:["timeAxisViewModel","timeAxis","viewPreset"],$config:{merge:"distinct"}},startDate:{$config:{equal:"date"},value:null},endDate:{$config:{equal:"date"},value:null},stickyHeaders:!0,visibleDate:null,eventCls:null,forceFit:!1,timeZone:null});M(ys,"properties",{timeCellSelector:null});ys.initClass();ae.setVersion("scheduler","5.3.0");ys._$name="TimelineBase";const IE=["eventStore","taskStore","assignmentStore","resourceStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"],FE=["events","tasks","resources","assignments","dependencies","timeRanges","resourceTimeRanges"];var Lp=c=>class extends c{static get $name(){return"CurrentConfig"}preProcessCurrentConfigs(t){for(const i of FE)delete t[i];super.preProcessCurrentConfigs(t)}getCurrentConfig(t){const i=this.project.getCurrentConfig(t),r=super.getCurrentConfig(t);if(i){r.project=i;const{crudManager:n}=r;if(n)for(const s of IE)n[s]&&(i[s]=n[s]);Object.keys(i).length===0&&delete r.project}return delete r.data,delete r.crudManager,r}get widgetClass(){}};const Cf=c=>!c||Array.isArray(c)?c:[c],wf=(c,e,t)=>c&&c[e]!==!0?c[e]:t;var Op=c=>{var e;return e=class extends(c||P){get dateBounds(){return[this.date]}get description(){var i;const r=this,{dateBounds:n,dateFormat:s,descriptionRenderer:a}=r,o=(i=r.descriptionFormat)!==null&&i!==void 0?i:Cf(r.defaultDescriptionFormat);let l,d;if(a)d=r.callback(a,r,[r]);else{const u=wf(o,0,s);d=b.format(n[0],u),l=n.length>1&&o?.length>1&&b.format(n[0],u)!==b.format(n[1],u),l&&(d=b.formatRange(n,wf(o,1,`S${s}${r.dateSeparator}E${s}`)))}return d}changeDescriptionFormat(i){return Cf(i)}get widgetClass(){}},M(e,"$name","Describable"),M(e,"configurable",{dateFormat:"MMMM d, YYYY",dateSeparator:" - ",descriptionFormat:null,descriptionRenderer:null}),e},AE=c=>class extends(c||P){static get $name(){return"SchedulerDom"}getElementFromAssignmentRecord(t,i=!1){if(this.isPainted&&t){var r,n,s;let o=(r=this.foregroundCanvas.syncIdMap)===null||r===void 0?void 0:r[t.id];if(!o&&t.resource.hasLinks)for(const l of t.resource.$links){var a;if(o=(a=this.foregroundCanvas.syncIdMap)===null||a===void 0?void 0:a[`${t.id}_${l.id}`],o)break}return i?o:(n=o)===null||n===void 0||(s=n.syncIdMap)===null||s===void 0?void 0:s.event}return null}getElementFromEventRecord(t,i=(()=>{var n;return(n=t.resources)===null||n===void 0?void 0:n[0]})(),r=!1){if(t.isResourceTimeRange){var n;const a=(n=this.foregroundCanvas.syncIdMap)===null||n===void 0?void 0:n[t.domId];return r?a:a?.syncIdMap.event}const s=this.assignmentStore.getAssignmentForEventAndResource(t,i);return this.getElementFromAssignmentRecord(s,r)}getElementsFromEventRecord(t,i,r=!1){return i?[this.getElementFromEventRecord(t,i,r)]:t.resources.reduce((n,s)=>{const a=this.getElementFromEventRecord(t,s,r);return a&&n.push(a),n},[])}resolveResourceRecord(t,i){return this.currentOrientation.resolveRowRecord(t,i)}resolveRowRecord(t){return this.resolveResourceRecord(t)}resolveEventRecord(t){var i;t instanceof Event&&(t=t.target);const r=(i=t)===null||i===void 0?void 0:i.closest(this.eventSelector);if(r){if(r.dataset.eventId)return this.eventStore.getById(r.dataset.eventId);if(r.dataset.assignmentId)return this.assignmentStore.getById(r.dataset.assignmentId).event}return null}resolveTimeSpanRecord(t){return this.resolveEventRecord(t)}resolveAssignmentRecord(t){const i=t.closest(this.eventSelector),r=i&&this.assignmentStore.getById(i.dataset.assignmentId),n=i&&this.eventStore.getById(i.dataset.eventId);return this.assignmentStore.getOccurrence(r,n)}isRowVisible(t){return this.store.indexOf(t)>=0}get widgetClass(){}},LE=c=>class extends(c||P){static get $name(){return"SchedulerDomEvents"}getTimeSpanMouseEventParams(t,i){const r=this.resolveEventRecord(t);return r&&{eventRecord:r,resourceRecord:this.resolveResourceRecord(t),assignmentRecord:this.resolveAssignmentRecord(t),eventElement:t,event:i}}getScheduleMouseEventParams(t,i){return{resourceRecord:this.isVertical?this.resolveResourceRecord(i):this.store.getById(t.id)}}onElementKeyDown(t){const i=super.onElementKeyDown(t),r=this;return r.selectedEvents.length&&r.trigger(r.scheduledEventName+"KeyDown",{eventRecords:r.selectedEvents,assignmentRecords:r.selectedAssignments,event:t,eventRecord:r.selectedEvents,assignmentRecord:r.selectedAssignments}),i}onElementKeyUp(t){super.onElementKeyUp(t);const i=this;i.selectedEvents.length&&i.trigger(i.scheduledEventName+"KeyUp",{eventRecords:i.selectedEvents,assignmentRecords:i.selectedAssignments,event:t,eventRecord:i.selectedEvents,assignmentRecord:i.selectedAssignments})}get widgetClass(){}},OE=c=>class extends(c||P){static get $name(){return"SchedulerEventRendering"}static get configurable(){return{milestoneTextPosition:"outside",milestoneAlign:"center",milestoneCharWidth:10,milestoneLayoutMode:"default",eventLayout:"stack",overlappingEventSorter:null,horizontalEventSorterFn:null,resourceMargin:null,useInitialAnimation:!0,eventRenderer:null,eventRendererThisObj:null,eventBarTextField:"name",eventBodyTemplate:null,horizontalLayoutPackClass:ep,horizontalLayoutStackClass:tp,resourceColumns:null,resourceImagePath:null,defaultResourceImageName:null,resourceImageExtension:".jpg",isFirstRender:!0,initialAnimationDuration:2e3,narrowEventWidth:10,internalEventLayout:null,eventPositionMode:"translate",eventScrollMode:"move"}}changeEventLayout(t){return this.internalEventLayout=t,this.internalEventLayout.type}changeInternalEventLayout(t){return this.getEventLayout(t)}updateInternalEventLayout(t,i){const r=this;i&&r.element.classList.remove(`b-eventlayout-${i.type}`),r.element.classList.add(`b-eventlayout-${t.type}`),r.isConfiguring||(r.refreshWithTransition(),r.trigger("stateChange"))}changeHorizontalEventSorterFn(t){ae.deprecate("Scheduler","6.0.0","Replaced by overlappingEventSorter()"),this.overlappingEventSorter=t}updateOverlappingEventSorter(t){this.isConfiguring||this.refreshWithTransition()}getEventLayout(t){var i;return(i=t)!==null&&i!==void 0&&i.isModel&&(t=t.eventLayout||this.internalEventLayout),typeof t=="string"&&(t={type:t}),t}getEventLayoutHandler(t){const i=this;if(!i.isHorizontal)return null;const{timeAxisViewModel:r,horizontal:n}=i,{type:s}=t;switch(i.layouts||(i.layouts={}),s){case"stack":return i.layouts.horizontalStack||(i.layouts.horizontalStack=new i.horizontalLayoutStackClass(T.assign({scheduler:i,timeAxisViewModel:r,bandIndexToPxConvertFn:n.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:n},t))),i.layouts.horizontalStack;case"pack":return i.layouts.horizontalPack||(i.layouts.horizontalPack=new i.horizontalLayoutPackClass(T.assign({scheduler:i,timeAxisViewModel:r,bandIndexToPxConvertFn:n.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:n},t))),i.layouts.horizontalPack;default:return null}}get resourceColumns(){var t;return((t=this.timeAxisColumn)===null||t===void 0?void 0:t.resourceColumns)||this._resourceColumns}get resourceColumnWidth(){var t;return((t=this.resourceColumns)===null||t===void 0?void 0:t.columnWidth)||null}getEventsToRender(t,i){return i}repaintEventsForResource(t){this.currentOrientation.repaintEventsForResource(t)}repaintEvent(t){this.eventStore.getResourcesForEvent(t).forEach(r=>this.repaintEventsForResource(r))}getResourceMargin(t){var i;return(i=t?.resourceMargin)!==null&&i!==void 0?i:this.resourceMargin}getBarMargin(t){var i;return(i=t?.barMargin)!==null&&i!==void 0?i:this.barMargin}getResourceHeight(t){var i;return(i=t.rowHeight)!==null&&i!==void 0?i:this.isHorizontal?this.rowHeight:this.getResourceWidth(t)}getResourceWidth(t){var i;return(i=t.columnWidth)!==null&&i!==void 0?i:this.resourceColumnWidth}getAppliedResourceHeight(t){var i;const r=this.getRowById(t);return(i=r?.maxRequestedHeight)!==null&&i!==void 0?i:this.getResourceHeight(t)}getResourceLayoutSettings(t,i=null){const r=this.getResourceMargin(t,i),n=this.getAppliedResourceHeight(t,i);return{barMargin:this.getBarMargin(t,i),contentHeight:Math.max(n-r*2,1),rowHeight:n,resourceMargin:r}}getEventStyle(t,i){return t.eventStyle||i.eventStyle||this.eventStyle}getEventColor(t,i){var r,n;return t.eventColor||((r=t.event)===null||r===void 0?void 0:r.eventColor)||((n=t.parent)===null||n===void 0?void 0:n.eventColor)||i.eventColor||this.eventColor}generateRenderData(t,i,r={viewport:!0}){const n=this,s=n.currentOrientation.getTimeSpanRenderData(t,i,r),{isEvent:a}=t,{eventResize:o}=n.features,l=!t.meta.isDragCreating&&t.isMilestone,d=a&&t.assignments.find(g=>g.resourceId===i.$originalId),u={className:"b-sch-event-content",role:"presentation",dataset:{taskBarFeature:"content"}};if(s){var h;s.tabIndex="0";let g=t.isResizable;o&&g&&(s.startsOutsideView&&(g===!0?g="end":g==="start"&&(g=!1)),s.endsOutsideView&&(g===!0?g="start":g==="end"&&(g=!1)),g&&(n.isHorizontal?!n.rtl&&!o.leftHandle||n.rtl&&!o.rightHandle?g=g==="start"?!1:"end":(!n.rtl&&!o.rightHandle||n.rtl&&!o.leftHandle)&&(g=g==="end"?!1:"start"):o.topHandle?o.bottomHandle||(g=g==="end"?!1:"start"):g=g==="start"?!1:"end"));const m=Boolean(t.hasPersistableChanges||d?.hasPersistableChanges),p={[i.cls]:i.cls,[n.generatedIdCls]:!t.isOccurrence&&t.hasGeneratedId,[n.dirtyCls]:m,[n.committingCls]:t.isCommitting,[n.endsOutsideViewCls]:s.endsOutsideView,[n.startsOutsideViewCls]:s.startsOutsideView,"b-clipped-start":s.clippedStart,"b-clipped-end":s.clippedEnd,"b-iscreating":t.isCreating,"b-rtl":n.rtl},v={[`${n.eventCls}-parent`]:i.isParent,"b-readonly":t.readOnly||d?.readOnly,"b-linked-resource":i.isLinked,"b-original-resource":i.hasLinks},y=t.isResourceTimeRange?new Q:t.internalCls.clone(),C=t.isResourceTimeRange?t.internalCls.clone():new Q;if(s.wrapperStyle="",s.isWrap=!0,a){const E=d&&n.isAssignmentSelected(d);T.assign(p,{[n.eventCls]:1,"b-milestone":l,"b-sch-event-narrow":!l&&s.width<n.narrowEventWidth,[n.fixedEventCls]:t.isDraggable===!1,[`b-sch-event-resizable-${g}`]:Boolean(o?.enabled&&!t.readOnly),[n.eventSelectedCls]:E,[n.eventAssignHighlightCls]:n.eventAssignHighlightCls&&!E&&n.isEventSelected(t),"b-recurring":t.isRecurring,"b-occurrence":t.isOccurrence,"b-inactive":t.inactive}),s.eventId=t.id;const R=n.getEventStyle(t,i),x=n.getEventColor(t,i),k=n.isFirstRender&&n.useInitialAnimation&&globalThis.bryntum.noAnimations!==!0;if(T.assign(v,{[`${n.eventCls}-wrap`]:1,"b-milestone-wrap":l}),k){const I=s.row?s.row.index:(s.top-n.scrollTop)/n.tickSize,A=I/20*1e3;s.wrapperStyle=`animation-delay: ${A}ms;`,n.maxDelay=Math.max(n.maxDelay||0,A),n.initialAnimationDetacher||(n.initialAnimationDetacher=B.on({element:n.foregroundCanvas,delegate:n.eventSelector,once:!0,animationend:()=>n.setTimeout({fn:"stopInitialAnimation",delay:n.maxDelay,cancelOutstanding:!0}),expires:{alt:"stopInitialAnimation",delay:n.initialAnimationDuration+n.maxDelay},thisObj:n}))}s.eventColor=x,s.eventStyle=R,s.assignmentRecord=s.assignment=d}if(s.wrapperCls=T.assign(C,v),s.cls=T.assign(y,p),s.iconCls=new Q(t.get(n.eventBarIconClsField)||t.iconCls),t.isResourceTimeRange?(s.style="",s.wrapperStyle+=t.style||""):s.style=t.style||"",s.resource=s.resourceRecord=i,s.resourceId=s.rowId,a){let E=null,R=null,x;if(n.eventRenderer){const k=n.eventRenderer.call(n.eventRendererThisObj||n,{eventRecord:t,resourceRecord:i,assignmentRecord:s.assignmentRecord,renderData:s});typeof s.cls=="string"&&(s.cls=new Q(s.cls)),typeof s.wrapperCls=="string"&&(s.wrapperCls=new Q(s.wrapperCls)),typeof s.iconCls=="string"&&(s.iconCls=new Q(s.iconCls)),n.eventBodyTemplate?x=n.eventBodyTemplate(k):x=k}else n.eventBodyTemplate?x=n.eventBodyTemplate(t):n.eventBarTextField&&(x=z.encodeHtml(t[n.eventBarTextField]||""));if(!n.eventBodyTemplate||Array.isArray(x)){var f;u.children=[],l&&(n.milestoneLayoutMode==="default"||n.milestoneTextPosition==="always-outside")&&x!=null&&x!==""&&u.children.unshift(R={tag:"label",children:[]}),(f=s.iconCls)!==null&&f!==void 0&&f.length&&u.children.unshift({tag:"i",className:s.iconCls}),Array.isArray(x)?(R||u).children.push(...x):z.isHtml(x)?u.children.length?E={tag:"span",class:"b-event-text-wrap",html:x}:(u.children=null,u.html=x):typeof x=="string"||typeof x=="object"?E=x:x!=null&&(E=String(x)),E!=null&&((R||u).children.push(E),s.cls.add("b-has-content")),(u.html!=null||u.children.length)&&s.children.push(u)}else u.html=x,s.children.push(u)}const{eventStyle:D,eventColor:w}=s;if(s.wrapperCls[`b-sch-style-${D||"none"}`]=1,S.isNamedColor(w))s.wrapperCls[`b-sch-color-${w}`]=w;else if(w){const E=D?"color":"background-color";s.style=`${E}:${w};`+s.style,s.wrapperCls["b-sch-custom-color"]=1}else s.wrapperCls["b-sch-color-none"]=1;s.style&&l&&u&&(u.style=s.style,delete s.style),s.cls["b-sch-event-withicon"]=(h=s.iconCls)===null||h===void 0?void 0:h.length,s.eventContent=u,s.wrapperChildren=[],n.onEventDataGenerated(s)}return s}onEventDataGenerated(t){}changeUseInitialAnimation(t){return t===!0?"fade-in":t}updateUseInitialAnimation(t,i){const{classList:r}=this.element;i&&r.remove(`b-initial-${i}`),t&&(r.add(`b-initial-${t}`),K.isFirefox&&r.add("b-prevent-event-transitions"))}restartInitialAnimation(t){var i;const r=this;(i=r.initialAnimationDetacher)===null||i===void 0||i.call(r),r.initialAnimationDetacher=null,r.useInitialAnimation=t,r.isFirstRender=!0,r.refresh()}stopInitialAnimation(){const t=this;t.initialAnimationDetacher(),t.isFirstRender=!1,t.useInitialAnimation=!1,K.isFirefox&&t.setTimeout(()=>t.element.classList.remove("b-prevent-event-transitions"),100)}getMilestoneLabelWidth(t,i){const r=this,n=r.milestoneLayoutMode,s=r.getResourceLayoutSettings(i).contentHeight;if(n==="measure"){const a=z.encodeHtml(t.name),o=r.getEventColor(t,i),l=r.getEventStyle(t,i),d=r.milestoneMeasureElement||(r.milestoneMeasureElement=S.createElement({className:{"b-sch-event-wrap":1,"b-milestone-wrap":1,"b-measure":1,[`b-sch-color-${o}`]:o,[`b-sch-style-${l}`]:l},children:[{className:"b-sch-event b-milestone",children:[{className:"b-sch-event-content",children:[{tag:"label"}]}]}],parent:r.foregroundCanvas}));if(d.retainElement=!0,d.style.fontSize=`${s}px`,r.milestoneTextPosition==="always-outside"){const u=d.firstElementChild.firstElementChild.firstElementChild;u.innerHTML=a;const h=$.from(u,u.parentElement);return h.left+h.width+2}else return d.firstElementChild.firstElementChild.innerHTML=`<label></label>${a}`,d.firstElementChild.offsetWidth}return n==="estimate"?t.name.length*r.milestoneCharWidth+(r.milestoneTextPosition==="always-outside"?s:0):n==="data"?t.milestoneWidth:0}updateMilestoneLayoutMode(t){const i=this,r=i.milestoneTextPosition==="always-outside";i.element.classList.toggle("b-sch-layout-milestones",t!=="default"&&!r),i.element.classList.toggle("b-sch-layout-milestone-labels",t!=="default"&&r),i.isConfiguring||i.refreshWithTransition()}updateMilestoneTextPosition(t){this.element.classList.toggle("b-sch-layout-milestone-text-position-inside",t==="inside"),this.updateMilestoneLayoutMode(this.milestoneLayoutMode)}updateMilestoneAlign(){this.isConfiguring||this.refreshWithTransition()}updateMilestoneCharWidth(){this.isConfiguring||this.refreshWithTransition()}get widgetClass(){}},PE=c=>class extends Qm(c||P){static get $name(){return"SchedulerStores"}static get projectStores(){return{resourceStore:{dataName:"resources"},eventStore:{dataName:"events",listeners:{batchedUpdate:"onEventStoreBatchedUpdate",changePreCommit:"onInternalEventStoreChange",commitStart:"onEventCommitStart",commit:"onEventCommit",exception:"onEventException",idchange:"onEventIdChange",beforeLoad:"applyStartEndParameters"}},assignmentStore:{dataName:"assignments",listeners:{changePreCommit:"onAssignmentChange",commitStart:"onAssignmentCommitStart",commit:"onAssignmentCommit",exception:"onAssignmentException",beforeRemove:{fn:"onAssignmentBeforeRemove",prio:-1e3}}},dependencyStore:{dataName:"dependencies"},calendarManagerStore:{},timeRangeStore:{},resourceTimeRangeStore:{}}}static get configurable(){return{store:null,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:!1,crudManagerClass:null,crudManager:null}}updateProject(t,i){super.updateProject(t,i),this.detachListeners("schedulerStores"),t.ion({name:"schedulerStores",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh({isInitialCommit:t}){const i=this;i.isVisible?(t&&i.isVertical&&(i.refreshAfterProjectRefresh=!1,i.refreshWithTransition()),i.navigateToAfterRefresh&&(i.navigateTo(i.navigateToAfterRefresh),i.navigateToAfterRefresh=null),i.refreshAfterProjectRefresh&&(i.refreshWithTransition(!1,!t),i.refreshAfterProjectRefresh=!1)):i.whenVisible("refresh",i,[!0])}changeCrudManager(t){const i=this;t&&!t.isCrudManager&&(t=i.crudManagerClass.new({scheduler:i},t)),i._crudManager=t,i.bindCrudManager(t)}get store(){return!this._store&&this.isVertical&&(this._store=new se({data:[{id:"verticalTimeAxisRow",cls:"b-verticaltimeaxis-row"}]})),super.store}set store(t){super.store=t}refreshFromRowOnStoreAdd(t,{isExpand:i,records:r}){const n=arguments;this.runWithTransition(()=>{this.currentOrientation.suspended=!i&&!r.some(s=>s.isLinked),super.refreshFromRowOnStoreAdd(t,...n),this.currentOrientation.suspended=!1},!i)}onStoreAdd(t){super.onStoreAdd(t),this.isPainted&&this.calculateRowHeights(t.records)}onStoreUpdateRecord({source:t,record:i,changes:r}){let n=0;"assigned"in r&&n++,"calendar"in r&&n++,n!==Object.keys(r).length&&super.onStoreUpdateRecord(...arguments)}updateResourceStore(t){t&&this.isHorizontal&&(t.metaMapId=this.id,this.store=t)}get usesDisplayStore(){return this.store!==this.resourceStore}onEventIdChange(t){this.currentOrientation.onEventStoreIdChange&&this.currentOrientation.onEventStoreIdChange(t)}onEventStoreBatchedUpdate(t){if(this.listenToBatchedUpdates)return this.onInternalEventStoreChange(t)}onInternalEventStoreChange(t){!this.isPainted||!this._mode||t.isAssign||this.assignmentStore.isRemovingAssignment||this.currentOrientation.onEventStoreChange(t)}onEventCommit({changes:t}){let i=[...t.added,...t.modified].map(r=>this.eventStore.getResourcesForEvent(r));i=Array.prototype.concat.apply([],i),new Set(i).forEach(r=>this.repaintEventsForResource(r))}onEventCommitStart({changes:t}){const{currentOrientation:i,committingCls:r}=this;[...t.added,...t.modified].forEach(n=>n.assignments.forEach(s=>i.toggleCls(s,r,!0)))}onEventException({action:t}){if(t==="commit"){const{changes:i}=this.eventStore;[...i.added,...i.modified,...i.removed].forEach(r=>this.repaintEvent(r))}}onAssignmentCommit({changes:t}){this.repaintEventsForAssignmentChanges(t)}onAssignmentCommitStart({changes:t}){const{currentOrientation:i,committingCls:r}=this;[...t.added,...t.modified].forEach(n=>{i.toggleCls(n,r,!0)})}onAssignmentException({action:t}){t==="commit"&&this.repaintEventsForAssignmentChanges(this.assignmentStore.changes)}repaintEventsForAssignmentChanges(t){const i=[...t.added,...t.modified,...t.removed].map(r=>r.getResource());new Set(i).forEach(r=>this.repaintEventsForResource(r))}onAssignmentBeforeRemove({records:t,removingAll:i}){if(i)return;const r=this;let n;if(!r.isConfiguring&&(r.navigateToAfterRefresh||r.activeAssignment&&t.includes(r.activeAssignment))){if(t.includes(r.navigateToAfterRefresh)&&(r.navigateToAfterRefresh=null),ue.lastInteractionType==="key")for(let s=0,a=t.length;s<a&&!n;s++){const o=t[s];if(o.resource&&o.resource.isModel){let l=r.getNext(o);(!l||t.includes(l))&&(l=r.getPrevious(o)),l&&!t.includes(l)&&(n=l)}}n?(r.navigateTo(n),r.navigateToAfterRefresh=n):S.focusWithoutScrolling(r.focusElement)}}set timeRanges(t){this.project.timeRanges=t}get timeRanges(){return this.project.timeRanges}set resourceTimeRanges(t){this.project.resourceTimeRanges=t}get resourceTimeRanges(){return this.project.resourceTimeRanges}applyStartEndParameters({source:t,params:i}){const r=this,n=t.modelClass.fieldMap.startDate;r.passStartEndParameters&&(i[r.startParamName]=n.print(r.startDate),i[r.endParamName]=n.print(r.endDate))}getResourcesEventsPerTick(t,i){const{timeAxis:r,resourceStore:n}=this,s=[];return t=t||n.records,t.forEach(a=>{a.events.forEach(o=>{if(!r.isTimeSpanInAxis(o)||i&&!i.call(this,{resource:a,event:o}))return;let l=Math.floor(r.getTickFromDate(o.startDate)),d=Math.ceil(r.getTickFromDate(o.endDate));l==-1&&(l=0),d===-1&&(d=r.ticks.length);do s[l]?s[l].push(o):s[l]=[o];while(++l<d)})}),s}get widgetClass(){}};const ea={block:"nearest",edgeOffset:20},$E={highlight:!1,focus:!1};var _E=c=>class extends(c||P){static get $name(){return"SchedulerScroll"}async scrollEventIntoView(t,i=ea){const r=this,n=t.resources||[t];if(n.length>1)throw new Error("scrollEventIntoView() is not applicable for events with multiple assignments, please use scrollResourceEventIntoView() instead.");n.length||console.warn("You have asked to scroll to an event which is not assigned to a resource"),await r.scrollResourceEventIntoView(n[0],t,i)}scrollAssignmentIntoView(t,...i){return this.scrollResourceEventIntoView(t.resource,t.event,...i)}async scrollResourceEventIntoView(t,i,r=ea){const n=this,s=i.startDate,a=i.endDate,o=i.isScheduled&&s<n.timeAxis.startDate|(a>n.timeAxis.endDate)<<1;arguments.length>3&&(r=arguments[3]);let l;if(r.edgeOffset==null&&(r.edgeOffset=20),o&&r.extendTimeAxis!==!1){const u=n.timeAxis.endDate-n.timeAxis.startDate;o===3?n.setTimeSpan(new Date(s.valueOf()-u/2),new Date(a.getTime()+u/2)):o&1?n.setTimeSpan(new Date(s),new Date(s.valueOf()+u)):n.setTimeSpan(new Date(a.valueOf()-u),new Date(a))}if(n.store.tree){var d;await((d=n.expandTo)===null||d===void 0?void 0:d.call(n,t))}if(i.parent&&!i.parent.isRoot&&await this.scrollEventIntoView(i.parent),l=n.getElementFromEventRecord(i,t),l){S.isFocusable(l)||(l=l.parentNode);const u=n.timeAxisSubGrid.scrollable;n.timeAxisSubGrid.forceScrollUpdate=!0,await u.scrollIntoView(l,r)}else o&&r.extendTimeAxis===!1?console.warn("You have asked to scroll to an event which is outside the current view and extending timeaxis is disabled"):!i.isOccurrence&&!n.eventStore.isAvailable(i)?console.warn("You have asked to scroll to an event which is not available"):i.isScheduled?await n.scrollUnrenderedEventIntoView(t,i,r):await n.scrollResourceIntoView(t,r)}scrollUnrenderedEventIntoView(t,i,r=ea){return new Promise(n=>{const s=this,a=Object.assign({edgeOffset:20},r,$E),o=s.timeAxisSubGrid.scrollable,l=s.getResourceEventBox(i,t),d=o.viewport;if(!d||!l){n();return}l.x=Math.ceil(l.x),l.y=Math.ceil(l.y),s.rtl&&l.translate(-s.timeAxisViewModel.totalSize+d.width,0),l.translate(d.x-o.scrollLeft,d.y-o.y);const u=async({eventRecord:g,element:m,targetElement:p})=>{if(g===i){const v=m||p;h(),await f,r.highlight&&S.highlight(v),r.focus&&v.focus(),n()}},h=s.ion({renderEvent:u}),f=o.scrollIntoView(l,a)})}scrollResourceIntoView(t,i=ea){return this.isVertical?this.currentOrientation.scrollResourceIntoView(t,i):this.scrollRowIntoView(t,i)}get widgetClass(){}},HE=c=>class extends(c||P){static get $name(){return"SchedulerRegions"}getScheduleRegion(t,i,r=!0,n){return this.currentOrientation.getScheduleRegion(...arguments)}getResourceRegion(t,i,r){return this.currentOrientation.getRowRegion(...arguments)}getAssignmentEventBox(t,i){return this.getResourceEventBox(t.event,t.resource,i)}getResourceEventBox(t,i,r=!1,n=!1){return this.currentOrientation.getResourceEventBox(...arguments)}getItemBox(t,i=!1){return t.resources.map(r=>this.getResourceEventBox(t,r,i))}get widgetClass(){}};const Sf=["eventLayout","mode","eventColor","eventStyle","tickSize","fillTicks"];var NE=c=>class extends(c||P){static get $name(){return"SchedulerState"}getState(){return T.copyProperties(super.getState(),this,Sf)}applyState(t){var i;this.suspendRefresh();let r=Sf.slice();t?.eventLayout==="layoutFn"&&(delete t.eventLayout,r.splice(r.indexOf("eventLayout"),1)),t!=null&&(i=t.zoomLevelOptions)!==null&&i!==void 0&&i.width&&(r=r.filter(n=>n!=="tickSize")),T.copyProperties(this,t,r),super.applyState(t),this.resumeRefresh(!0)}get widgetClass(){}},Pp=c=>class extends(c||P){static get $name(){return"EventSelection"}static get configurable(){return{highlightPredecessors:!1,highlightSuccessors:!1,deselectOnClick:!1}}static get defaultConfig(){return{multiEventSelect:!1,eventSelectionDisabled:!1,eventSelectedCls:"b-sch-event-selected",triggerSelectionChangeOnRemove:!1,maintainSelectionOnDatasetChange:!0,eventAssignHighlightCls:"b-sch-event-assign-selected",selectedCollection:{}}}afterConstruct(){var t;super.afterConstruct(),(t=this.navigator)===null||t===void 0||t.ion({navigate:"onEventNavigate",thisObj:this})}set selectedCollection(t){t instanceof rt||(t=new rt(t)),this._selectedCollection=t,t.ion({change:(...i)=>this.project.deferUntilRepopulationIfNeeded("onSelectedCollectionChange",(...r)=>!this.isDestroying&&this.onSelectedCollectionChange(...r),i),beforeSplice:"onBeforeSelectedCollectionSplice",thisObj:this})}get selectedCollection(){return this._selectedCollection}getActionType(t,i,r){return t.length>0?i.length>0&&r.length>0?"update":i.length>0?"select":"deselect":"clear"}getEventsFromAssignments(t){return W.unique(t.map(i=>i.event))}get selectedEvents(){return this.getEventsFromAssignments(this.selectedCollection.values)}set selectedEvents(t){var i;const r=[];t=W.asArray(t),(i=t)===null||i===void 0||i.forEach(n=>{this.isEventSelectable(n)!==!1&&r.push(...n.assignments)}),this.selectedCollection.splice(0,this.selectedCollection.count,r)}get selectedAssignments(){return this.selectedCollection.values}set selectedAssignments(t){this.selectedCollection.splice(0,this.selectedCollection.count,t||[])}isEventSelected(t){const{selectedCollection:i}=this;return Boolean(i.count&&i.includes(t.assignments))}isEventSelectable(t){}isAssignmentSelected(t){return this.selectedCollection.includes(t)}select(t,i=!1){t.isAssignment?this.selectAssignment(t,i):this.selectEvent(t,i)}selectEvent(t,i=!1){this.isEventSelected(t)||this.selectEvents([t],i)}selectAssignment(t,i=!1,r){this.isAssignmentSelected(t)||(i?this.selectedCollection.add(t):this.selectedAssignments=t)}deselect(t){t.isAssignment?this.deselectAssignment(t):this.deselectEvent(t)}deselectEvent(t){this.isEventSelected(t)&&this.selectedCollection.remove(...t.assignments)}deselectAssignment(t){this.isAssignmentSelected(t)&&this.selectedCollection.remove(t)}selectEvents(t,i=!1){if(i){const r=t.reduce((n,s)=>(this.isEventSelectable(s)!==!1&&n.push(...s.assignments),n),[]);this.selectedCollection.add(r)}else this.selectedEvents=t}deselectEvents(t){this.selectedCollection.remove(t.reduce((i,r)=>(i.push(...r.assignments),i),[]))}selectAssignments(t){this.selectedCollection.add(t)}deselectAssignments(t){this.selectedCollection.remove(t)}clearEventSelection(){this.selectedAssignments=[]}onBeforeSelectedCollectionSplice({toAdd:t,toRemove:i,index:r}){const n=this,s=n._selectedCollection.values,a=t,o=i>0?a.slice(r,i+r):[],l=n.getActionType(s,a,o);if(n.trigger("beforeEventSelectionChange",{action:l,selection:n.getEventsFromAssignments(s)||[],selected:n.getEventsFromAssignments(a)||[],deselected:n.getEventsFromAssignments(o)||[]})===!1||n.trigger("beforeAssignmentSelectionChange",{action:l,selection:s,selected:a,deselected:o})===!1)return!1}onSelectedCollectionChange({added:t,removed:i}){const r=this,n=r.selectedAssignments,s=t||[],a=i||[];function o(l,d){const u=l.event;if(u){const{eventAssignHighlightCls:h}=r,f=r.getElementFromAssignmentRecord(l);r.currentOrientation.toggleCls(l,r.eventSelectedCls,d),h&&r.getElementsFromEventRecord(u).forEach(g=>{if(g!==f){const m=r.resolveAssignmentRecord(g);r.currentOrientation.toggleCls(m,h,d),d&&(g.style.animation="none",g.offsetHeight,g.style.animation=""),g.classList.toggle(h,d)}})}}if(a.forEach(l=>o(l,!1)),s.forEach(l=>o(l,!0)),(r.highlightSuccessors||r.highlightPredecessors)&&r.highlightLinkedEvents(r.selectedEvents),r.$selectedAssignments=n.map(l=>({eventId:l.eventId,resourceId:l.resourceId})),!r.silent){const l=this.getActionType(n,s,a);r.trigger("assignmentSelectionChange",{action:l,selection:n,selected:s,deselected:a}),r.trigger("eventSelectionChange",{action:l,selection:r.selectedEvents,selected:r.getEventsFromAssignments(s),deselected:r.getEventsFromAssignments(a)})}}onAssignmentChange(t){super.onAssignmentChange(t);const i=this,{action:r,records:n}=t;if(i.silent=!i.triggerSelectionChangeOnRemove,r==="remove")i.deselectAssignments(n);else if(r==="removeall"&&!i.eventStore.isSettingData)i.clearEventSelection();else if(r==="dataset"&&i.$selectedAssignments)if(!i.maintainSelectionOnDatasetChange)i.clearEventSelection();else{const s=i.$selectedAssignments.map(a=>n.find(o=>o.eventId===a.eventId&&o.resourceId===a.resourceId));i.selectedAssignments=W.clean(s)}i.silent=!1}onInternalEventStoreChange({source:t,action:i,records:r}){!t.isResourceTimeRangeStore&&i==="dataset"&&!r.length&&this.clearEventSelection(),super.onInternalEventStoreChange(...arguments)}onAssignmentSelectionClick(t,i){const r=this;r.isAssignmentSelected(i)?(r.deselectOnClick||t.ctrlKey)&&r.deselectAssignment(i,r.multiEventSelect,t):this.isEventSelectable(i.event)!==!1&&r.selectAssignment(i,t.ctrlKey&&r.multiEventSelect,t)}onEventNavigate({event:t,item:i}){if(!this.eventSelectionDisabled){const r=i&&(i.nodeType===Element.ELEMENT_NODE?this.resolveAssignmentRecord(i):i);r?this.onAssignmentSelectionClick(t,r):this.clearEventSelection()}}changeHighlightSuccessors(t){return this.changeLinkedEvents(t)}changeHighlightPredecessors(t){return this.changeLinkedEvents(t)}changeLinkedEvents(t){const i=this;return t?(i.highlighted=i.highlighted||new Set,i.highlightLinkedEvents(i.selectedEvents)):i.highlighted&&i.highlightLinkedEvents(),t}highlightLinkedEvents(t=[]){const i=this,{highlighted:r,eventStore:n}=i,s=i.features.dependencies;r.forEach(a=>{t.includes(a)||(a.meta.highlight=!1,r.delete(a),n.includes(a)&&a.dependencies.forEach(o=>s.unhighlight(o,"b-highlight")))}),t.forEach(a=>{const o=[a];for(;o.length;){const l=o.pop();r.add(l),i.highlightSuccessors&&l.outgoingDeps.forEach(d=>{s.highlight(d,"b-highlight"),!r.has(d.toEvent)&&o.push(d.toEvent)}),i.highlightPredecessors&&l.incomingDeps.forEach(d=>{s.highlight(d,"b-highlight"),!r.has(d.fromEvent)&&o.push(d.fromEvent)})}r.forEach(l=>l.meta.highlight=!0)}),i.element.classList.toggle("b-highlighting",t.length>0),i.refreshWithTransition()}onEventDataGenerated(t){(this.highlightSuccessors||this.highlightPredecessors)&&(t.cls["b-highlight"]=t.eventRecord.meta.highlight),super.onEventDataGenerated(t)}updateProject(t,i){this.clearEventSelection(),super.updateProject(t,i)}doDestroy(){var t;(t=this._selectedCollection)===null||t===void 0||t.destroy(),super.doDestroy()}get widgetClass(){}};const Df=c=>c.preventDefault(),BE={ArrowRight:1,ArrowLeft:1,ArrowUp:1,ArrowDown:1},zE={animate:100},VE=Object.freeze({});var $p=c=>class extends he(c||P){static get $name(){return"EventNavigation"}static get configurable(){return{navigator:{allowCtrlKey:!0,scrollSilently:!0,keys:{Space:"onEventSpaceKey",Enter:"onEventEnterKey",Delete:"onDeleteKey",Backspace:"onDeleteKey",ArrowUp:"onArrowUpKey",ArrowDown:"onArrowDownKey",Escape:"onEscapeKey",Tab:"onTab","SHIFT+Tab":"onShiftTab"}},isNavigationKey:{ArrowDown:1,ArrowUp:1,ArrowLeft:1,ArrowRight:1}}}static get defaultConfig(){return{focusCls:"b-active",enableDeleteKey:!0,onDeleteKeyBuffer:500,navigatePreviousBuffer:200,navigateNextBuffer:200,testConfig:{onDeleteKeyBuffer:1}}}construct(t){const i=this;i.isInTimeAxis=i.isInTimeAxis.bind(i),i.onDeleteKey=i.throttle(i.onDeleteKey,i.onDeleteKeyBuffer,i),super.construct(t)}changeNavigator(t){const i=this;return i.getConfig("subGridConfigs"),new xr(i.constructor.mergeConfigs({ownerCmp:i,target:i.timeAxisSubGridElement,processEvent:i.processEvent,itemSelector:`.${i.eventCls}-wrap`,focusCls:i.focusCls,navigatePrevious:i.throttle(i.navigatePrevious,{delay:i.navigatePreviousBuffer,throttled:Df}),navigateNext:i.throttle(i.navigateNext,{delay:i.navigateNextBuffer,throttled:Df})},t))}doDestroy(){this.navigator.destroy(),super.doDestroy()}isInTimeAxis(t){return!t.instanceMeta(this).excluded&&this.timeAxis.isTimeSpanInAxis(t)}onElementKeyDown(t){var i,r;const n=this,{navigator:s}=n;if(((i=n.focusedCell)===null||i===void 0?void 0:i.rowIndex)!==-1&&((r=n.focusedCell)===null||r===void 0?void 0:r.column)===n.timeAxisColumn&&!t.target.closest(s.itemSelector)&&t.key==="Enter"){const o=n.getFirstVisibleAssignment();if(o)return n.navigateTo(o,{uiEvent:t}),!1}else{var a;(a=super.onElementKeyDown)===null||a===void 0||a.call(this,t)}}getFirstVisibleAssignment(t=this.focusedCell){const i=this,{currentOrientation:r,rowManager:n,eventStore:s}=i;if(i.isHorizontal){var a;let h=r.rowMap.get(n.getRow(t.rowIndex));if((a=h)!==null&&a!==void 0&&a.length){var o;return(o=h[0])===null||o===void 0?void 0:o.elementData.assignmentRecord}else{var l,d;if(h=(l=r.resourceMap.get(t.id))===null||l===void 0?void 0:l.eventsData,(d=h)!==null&&d!==void 0&&d.length){var u;return(u=h.filter(f=>s.isAvailable(f.eventRecord))[0])===null||u===void 0?void 0:u.assignmentRecord}}}else{const h=[...r.resourceMap.values()][0],f=h&&Object.values(h);if(f!=null&&f.length)return f.filter(g=>s.isAvailable(g.renderData.eventRecord))[0].renderData.assignmentRecord}}onGridBodyFocusIn(t){const i=t.target.closest(this.focusableSelector);if(this.timeAxisSubGridElement.contains(t.target)){const n=this,{navigationEvent:s}=n,{target:a}=t,o=a.closest(n.navigator.itemSelector),l=o?n.normalizeCellContext({rowIndex:n.isVertical?0:n.resourceStore.indexOf(n.resolveResourceRecord(a)),column:n.timeAxisColumn,target:a}):new ne(a);if(o){var r;const{_focusedCell:d}=n;n._focusedCell=l,(r=n.onCellNavigate)===null||r===void 0||r.call(n,n,d,l,s,!0);return}if(i&&(!s||BE[s.key])){const d=n.getFirstVisibleAssignment(l);if(d){n.navigateTo(d,{scrollIntoView:Boolean(s&&s.type!=="mousedown"),uiEvent:s||t});return}}}i&&super.onGridBodyFocusIn(t)}accessibleFocusCell(t,i){const r=this;if(t=r.normalizeCellContext(t),t.columnId!==r.timeAxisColumn.id)return super.focusCell(t,i)}normalizeTarget(t){return t.assignmentRecord}getPrevious(t,i){const r=this,{resourceStore:n}=r,{eventSorter:s}=r.currentOrientation,{startDate:a,endDate:o}=r.timeAxis,l=t.event,d=r.eventStore.getEvents({resourceRecord:t.resource,startDate:a,endDate:o}).filter(this.isInTimeAxis).sort(s);let u=t.resource,h=d[d.indexOf(l)-1];if(!h)for(let f=n.indexOf(u)-1;(!h||i&&h===l)&&f>=0;f--){u=n.getAt(f);const g=r.eventStore.getEvents({resourceRecord:u,startDate:a,endDate:o}).filter(r.isInTimeAxis).sort(s);h=g.length&&g[g.length-1]}return r.assignmentStore.getAssignmentForEventAndResource(h,u)}navigatePrevious(t){const i=this,r=i.getPrevious(i.normalizeTarget(t));return t.preventDefault(),r?(t.ctrlKey||i.clearEventSelection(),i.navigateTo(r,{uiEvent:t})):i.doGridNavigation(t)}getNext(t,i){const r=this,{resourceStore:n}=r,{eventSorter:s}=r.currentOrientation,{startDate:a,endDate:o}=r.timeAxis,l=t.event,d=r.eventStore.getEvents({resourceRecord:t.resource,startDate:a,endDate:o}).filter(this.isInTimeAxis).sort(s);let u=t.resource,h=d[d.indexOf(l)+1];if(!h)for(let f=n.indexOf(u)+1;(!h||i&&h===l)&&f<n.count;f++)u=n.getAt(f),h=r.eventStore.getEvents({resourceRecord:u,startDate:a,endDate:o}).filter(r.isInTimeAxis).sort(s)[0];return r.assignmentStore.getAssignmentForEventAndResource(h,u)}navigateNext(t){const i=this,r=i.getNext(i.normalizeTarget(t));return t.preventDefault(),r?(t.ctrlKey||i.clearEventSelection(),i.navigateTo(r,{uiEvent:t})):i.doGridNavigation(t)}doGridNavigation(t){!t.handled&&t.key.indexOf("Arrow")===0&&this[`navigate${t.key.substring(5)}ByKey`](t)}async navigateTo(t,{scrollIntoView:i=!0,uiEvent:r={}}=VE){const n=this,{navigator:s}=n,{skipScrollIntoView:a}=s;t&&(i?(s.disabled=!0,await n.scrollAssignmentIntoView(t,zE),s.disabled=!1):s.skipScrollIntoView=!0,!n.isDestroyed&&this.getElementFromAssignmentRecord(t)&&(n.activeAssignment=t,s.skipScrollIntoView=a,s.trigger("navigate",{event:r,item:n.getElementFromAssignmentRecord(t).closest(s.itemSelector)})))}set activeAssignment(t){const i=this.getElementFromAssignmentRecord(t,!0);i&&(this.navigator.activeItem=i)}get activeAssignment(){const{activeItem:t}=this.navigator;if(t)return this.resolveAssignmentRecord(t)}get previousActiveEvent(){const{previousActiveItem:t}=this.navigator;if(t)return this.resolveEventRecord(t)}processEvent(t){const i=this,r=t.target.closest(i.eventSelector);return!i.navigator.disabled&&r&&(t.assignmentRecord=i.resolveAssignmentRecord(r),t.eventRecord=i.resolveEventRecord(r),t.resourceRecord=i.resolveResourceRecord(r)),t}onDeleteKey(t){const i=this;if(!i.readOnly&&i.enableDeleteKey){const r=i.eventStore.usesSingleAssignment?i.selectedEvents:i.selectedAssignments;i.removeEvents(r.filter(n=>!n.readOnly))}}onArrowUpKey(t){this.focusCell({rowIndex:this.focusedCell.rowIndex-1,column:this.timeAxisColumn}),t.handled=!0}onArrowDownKey(t){this.focusedCell.rowIndex<this.resourceStore.count-1&&(this.focusCell({rowIndex:this.focusedCell.rowIndex+1,column:this.timeAxisColumn}),t.handled=!0)}onEscapeKey(t){t.target.closest(".b-dragging")||(this.focusCell({rowIndex:this.focusedCell.rowIndex,column:this.timeAxisColumn}),t.handled=!0)}onEventSpaceKey(t){}onEventEnterKey(t){}get isActionableLocation(){if(!this.navigator.activeItem)return super.isActionableLocation}get widgetClass(){}};const jE={releaseElement:1,reuseElement:1},WE={newElement:1,reuseOwnElement:1,reuseElement:1},Ml=9999999,UE=({startDateMS:c},{startDateMS:e})=>c-e,YE={startDate:1,endDate:1,duration:1};function Ef(c,e,t,i,r){var n;const{timeAxis:s}=c,a=e.isBatchUpdating&&!r?e.get(i):e[i],o=(n=e.hasBatchedChange)===null||n===void 0?void 0:n.call(e,i);if(c.fillTicks&&(!e.meta.isResizing||!o)){let d=s.getTickFromDate(a);if(d>=0){t&&d===Math.round(d)&&d>0&&d--;const u=Math.floor(d);return s.getAt(u)[i].getTime()}}return a?.getTime()}class Jd extends P.mixin(Mi){static get configurable(){return{scrollBuffer:0,bufferSize:150,verticalBufferSize:150}}static get properties(){return{resourceMap:new Map,rowMap:new Map,eventConfigs:[],isFirstRefresh:!0,toDrawOnProjectRefresh:new Set,toDrawOnDataReady:new Set}}construct(e){const t=this;t.client=t.scheduler=e,t.eventSorter=t.eventSorter.bind(e),e.scrollable.ion({scroll:"onEarlyScroll",prio:1,thisObj:t}),e.rowManager.ion({name:"rowManager",renderDone:"onRenderDone",removeRows:"onRemoveRows",translateRow:"onTranslateRow",offsetRows:"onOffsetRows",beforeRowHeight:"onBeforeRowHeightChange",thisObj:t}),super.construct({})}init(){}updateVerticalBufferSize(){const{rowManager:e}=this.scheduler;this.scheduler.isPainted&&e.renderRows(e.rows)}get visibleDateRange(){return this._visibleDateRange}getDateFromXY(e,t,i,r=!1){const{scheduler:n}=this;let s=e[0];return i||(s=this.translateToScheduleCoordinate(s)),s=n.getRtlX(s),n.timeAxisViewModel.getDateFromPosition(s,t,r)}translateToScheduleCoordinate(e){const{scheduler:t}=this,{scrollable:i}=t.timeAxisSubGrid;let r=e-t.timeAxisSubGridElement.getBoundingClientRect().left-globalThis.scrollX;return t.rtl?r+=i.maxX-Math.abs(t.scrollLeft):r+=t.scrollLeft,r}translateToPageCoordinate(e){const{scheduler:t}=this,{scrollable:i}=t.timeAxisSubGrid;let r=e+t.timeAxisSubGridElement.getBoundingClientRect().left;return t.rtl?r-=i.maxX-Math.abs(t.scrollLeft):r-=t.scrollLeft,r}getScheduleRegion(e,t,i=!0,r,n=!1){var s,a;const o=this,{scheduler:l}=o,{timeAxisSubGridElement:d,timeAxis:u}=l,h=(!n||e)&&l.getResourceMargin(e)||0;let f;if(e){const y=t&&l.getElementsFromEventRecord(t,e)[0];if(f=$.from(l.getRowById(e.id).getElement("normal"),d),y){const C=$.from(y,d);f.y=C.y,f.bottom=C.bottom}else f.y=f.y+h,f.bottom=f.bottom-h}else f=$.from(d).moveTo(null,0),f.width=d.scrollWidth,f.y=f.y+h,f.bottom=f.bottom-h;const g=u.startDate,m=u.endDate;r=((s=r)===null||s===void 0?void 0:s.start)&&r||((a=l.getDateConstraints)===null||a===void 0?void 0:a.call(l,e,t))||{start:g,end:m};let p=l.getCoordinateFromDate(r.start?b.max(g,r.start):g),v=l.getCoordinateFromDate(r.end?b.min(m,r.end):m);return i||(p=o.translateToPageCoordinate(p),v=o.translateToPageCoordinate(v)),f.left=Math.min(p,v),f.right=Math.max(p,v),f}getRowRegion(e,t,i){const{scheduler:r}=this,{timeAxis:n}=r,s=r.getRowById(e.id);if(!s)return null;const a=n.startDate,o=n.endDate,l=t?b.max(a,t):a,d=i?b.min(o,i):o,u=r.getCoordinateFromDate(l),h=r.getCoordinateFromDate(d,!0,!0),f=s.top,g=Math.min(u,h),m=f+s.offsetHeight;return new $(g,f,Math.max(u,h)-g,m-f)}getResourceEventBox(e,t,i,r=!1){const n=this.resourceMap.get(t.id);let s=null,a=!1;if(n&&(s=n.eventsData.find(o=>o.eventRecord===e)),s||(s=this.getTimeSpanRenderData(e,t,{viewport:!0,timeAxis:i}),a=!0),s){const o=this.scheduler.rowManager.getRecordCoords(t,!0,r),l=s.top+o.top,d=new $(s.left,l,s.width,s.height);return d.layout=!a,d.rowTop=o.top,d.rowBottom=o.bottom,d.resourceId=t.id,d}return null}resolveRowRecord(e){const t=this,{scheduler:i}=t,r=e.nodeType?e:e.target,n=r.nodeType===Element.TEXT_NODE?r.parentElement:r,s=n.closest(i.eventSelector);return s?t.resourceStore.getById(s.dataset.resourceId):i.getRecordFromElement(n)}attachToProject(e){super.attachToProject(e),this.refreshAllWhenReady=!0,this.scheduler.isConfiguring||this.clearAll({clearDom:!0}),e?.ion({name:"project",refresh:"onProjectRefresh",commitFinalized:"onProjectCommitFinalized",thisObj:this})}onProjectCommitFinalized(){const{scheduler:e,toDrawOnDataReady:t,project:i}=this;e.isVisible?e.isPainted&&!e.refreshSuspended&&(!t.size&&i.timeZone&&i.ignoreRecordChanges&&t.add(...i.resourceStore.records.flatMap(r=>r.id)),t.size&&(this.clearResources(t),this.refreshResources(t)),t.clear()):e.whenVisible("refreshRows")}onProjectRefresh({isCalculated:e,isInitialCommit:t}){const i=this,{scheduler:r,toDrawOnProjectRefresh:n}=i;if(r.isVisible){if(r.isPainted&&!r.isConfiguring&&!r.refreshSuspended){if(i.refreshAllWhenReady||t&&e){r.calculateAllRowHeights(!0);const{rowManager:s}=r;s.topRow?(i.clearAll(),r.refreshAfterProjectRefresh||(s.topRow.dataIndex>=r.store.count?r.renderRows(!1):r.refreshWithTransition(!1,!i.isFirstRefresh&&e&&!t)),i.isFirstRefresh=!1):s.reinitialize(),i.refreshAllWhenReady=!1}else n.size&&i.refreshResources(n);n.clear()}}else r.whenVisible("refresh",r,[!0])}attachToAssignmentStore(e){this.refreshAllWhenReady=!0,super.attachToAssignmentStore(e),e&&e.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({source:e,action:t,records:i=[],replaced:r,changes:n}){const s=this,{scheduler:a}=s,o=new Set(i.flatMap(l=>{var d,u,h;return[l.resourceId,...(d=(u=l.resource)===null||u===void 0||(h=u.$links)===null||h===void 0?void 0:h.map(f=>f.id))!==null&&d!==void 0?d:[]]}));if(!(s.resourceStore.isRemoving||s.resourceStore.isChangingId))switch(t){case"dataset":{s.eventStore.usesSingleAssignment||(o.size?s.refreshResourcesWhenReady(o):(s.clearAll(),a.refreshWithTransition()));return}case"add":case"remove":case"updateMultiple":s.refreshResourcesWhenReady(o);return;case"removeall":s.refreshAllWhenReady=!0;return;case"replace":r.forEach(([l,d])=>{o.add(l.resourceId),o.add(d.resourceId)}),s.refreshResourcesWhenReady(o);return;case"filter":s.clearAll(),a.calculateAllRowHeights(!0),a.refreshWithTransition();return;case"update":{("eventId"in n||"resourceId"in n||"id"in n)&&("resourceId"in n&&o.add(n.resourceId.oldValue),e===a.project.assignmentStore?s.refreshResourcesOnDataReady(o):s.refreshResources(o));break}case"clearchanges":{const{added:l,modified:d,removed:u}=n;d?a.refreshWithTransition():(l.forEach(h=>o.add(h.resourceId)),u.forEach(h=>o.add(h.resourceId)),s.refreshResourcesOnDataReady(o))}}}onAssignmentStoreRefresh({action:e,records:t}){e==="batch"&&(this.clearAll(),this.scheduler.refreshWithTransition())}attachToEventStore(e){this.refreshAllWhenReady=!0,super.attachToEventStore(e),e&&e.ion({name:"eventStore",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreRefresh({action:e}){if(e==="batch"){const{scheduler:t}=this;t.isEngineReady&&t.isPainted&&(this.clearAll(),t.refreshWithTransition())}}onEventStoreChange({action:e,records:t=[],record:i,replaced:r,changes:n,source:s}){const a=this,{scheduler:o}=a,l=s.isResourceTimeRangeStore,d=new Set;if(!!o.isPainted)if(t.forEach(f=>{var g;const m=(g=f.$linkedResources)===null||g===void 0?void 0:g.filter(p=>a.resourceStore.includes(p));m?.forEach(p=>d.add(p.id))}),l){switch(e){case"removeall":case"dataset":a.clearAll(),o.refreshWithTransition();return}a.refreshResources(d)}else{switch(e){case"batch":case"sort":case"group":case"move":return;case"remove":return;case"clearchanges":a.clearAll(),o.refreshWithTransition();return;case"dataset":{a.clearAll(),o.isEngineReady?o.refreshWithTransition():a.refreshAllWhenReady=!0;return}case"add":case"updateMultiple":break;case"replace":r.forEach(([,f])=>{f.resources.map(g=>d.add(g.id))});break;case"removeall":case"filter":if(!o.isEngineReady){a.refreshAllWhenReady=!0;return}a.clearAll(),o.calculateAllRowHeights(!0),o.refreshWithTransition();return;case"update":{const f=i.$entity?!Object.keys(n).some(m=>!i.$entity.getField(m)):!Object.keys(n).some(m=>!YE[m]);let g=0;if("startDate"in n&&g++,"endDate"in n&&g++,"duration"in n&&g++,"resourceId"in n&&d.add(n.resourceId.oldValue),d.size&&(!f||g&&!("duration"in n&&g===1)||"percentDone"in n||"inactive"in n||"segments"in n)){var u,h;(u=a.project)!==null&&u!==void 0&&u.propagatingLoadChanges||(h=a.project)!==null&&h!==void 0&&h.isWritingData?a.refreshResourcesOnDataReady(d):a.refreshResources(d)}return}}a.refreshResourcesWhenReady(d)}}attachToResourceStore(e){this.refreshAllWhenReady=!0,super.attachToResourceStore(e),e&&(this.clearAll({clearLayoutCache:!0}),e.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",thisObj:this}))}get resourceStore(){return this.client.store}onResourceStoreChange({action:e,isExpand:t,records:i,changes:r}){const n=this,s=i?.flatMap(a=>a.isLinked?[a.id,a.$originalId]:[a.id]);if(!!n.scheduler.isPainted){switch(e){case"add":t||(i.every(a=>a.isLinked)?n.refreshResources(s):n.refreshResourcesWhenReady(s));return;case"update":{!n.project.isBatchingChanges&&!r.isLeaf&&n.refreshResources(s);return}case"filter":return;case"removeall":n.clearAll({clearLayoutCache:!0});return;case"dataset":return}s&&n.clearResources(s)}}onTranslateRow({row:e}){e.id!=null&&this.refreshEventsForResource(e,!1)}onOffsetRows(){this.clearAll(),this.doUpdateTimeView()}calculateRowHeight(e){var t;const{scheduler:i}=this,r=i.getResourceHeight(e),n=i.getEventLayout(e);if(n.type==="stack"&&i.isEngineReady&&!e.isSpecialRow&&((t=e.assigned)===null||t===void 0?void 0:t.size)>1){const{assignmentStore:a,eventStore:o,timeAxis:l}=i,{barMargin:d,resourceMargin:u,contentHeight:h}=i.getResourceLayoutSettings(e),f=(o.isFiltered||a.isFiltered)&&(v=>v.assignments.some(y=>y.resource===e.$original&&a.includes(y))),g=o.getEvents({resourceRecord:e,includeOccurrences:i.enableRecurringEvents,startDate:l.startDate,endDate:l.endDate,filter:f}).sort(UE).map(v=>{const y=v.isBatchUpdating?v.get("startDate"):v.startDate,C=v.isBatchUpdating?v.get("endDate"):v.endDate||y;return{eventRecord:v,resourceRecord:e,startMS:y.getTime(),endMS:C.getTime()}}),m=i.getEventLayoutHandler(n),p=m.layoutEventsInBands(g,!0);return m.type==="layoutFn"?p:p*h+(p-1)*d+u*2}return r}doUpdateTimeView(){const{scrollable:e}=this.scheduler.timeAxisSubGrid;this.updateFromHorizontalScroll(e.x)}onTimeAxisViewModelUpdate(){const e=this,{scheduler:t}=e;e.clearAll(),t.refreshSuspended&&(e.detachListeners("renderingSuspend"),t.ion({name:"renderingSuspend",resumeRefresh({trigger:i}){t.isEngineReady&&i&&e.doUpdateTimeView()},thisObj:e,once:!0})),e.doUpdateTimeView()}getConnectorStartSide(e){return"start"}getConnectorEndSide(e){return"end"}refreshRows(e){e&&this.clearAll()}onLocaleChange(){this.clearAll()}onViewportResize(e,t,i,r){t>r&&this.onRenderDone()}onDragAbort({context:e,dragData:t}){this.resourceStore.indexOf(t.record.resource)<this.scheduler.topRow.dataIndex&&e.element.remove()}toggleCls(e,t,i=!0,r=!1){const n=this.client.getElementFromAssignmentRecord(e,r),s=this.resourceMap.get(e.isModel?e.get("resourceId"):e.resourceId),a=s?.eventsData.find(o=>o.eventId===e.eventId);a&&(a[r?"wrapperCls":"cls"][t]=i),n&&(n.classList[i?"add":"remove"](t),n.lastDomConfig.className[t]=i)}onRemoveRows({rows:e}){e.forEach(t=>this.rowMap.delete(t)),this.onRenderDone()}onEarlyScroll(){this.rendererCalled=!1}updateFromVerticalScroll(){this.fromScroll=!0,this.rendererCalled||this.onRenderDone()}updateFromHorizontalScroll(e){const t=this,{scheduler:i,scrollBuffer:r}=t,{timeAxisSubGrid:n,timeAxis:s,rtl:a}=i,{width:o}=n,{totalSize:l}=i.timeAxisViewModel,d=e,u=n.scrollable.maxX!==0&&Math.abs(n.scrollable.maxX)<=Math.round(d)+5,h=i.getDateFromCoord({coord:Math.max(0,d-r),ignoreRTL:!0}),f=u?s.endDate:i.getDateFromCoord({coord:d+o+r,ignoreRTL:!0})||s.endDate;if(h&&!i._viewPresetChanging){t._visibleDateRange={startDate:h,endDate:f,startMS:h.getTime(),endMS:f.getTime()},t.viewportCoords=a?{left:l-e-o+r,right:l-e-r}:{left:e-r,right:e+o+r};const g=i.timeView.range={startDate:h,endDate:f};if(i.onVisibleDateRangeChange(g),!i.refreshSuspended&&i.rowManager.rows.length){if(i.rowManager.rows[0].id===null)return;t.fromScroll=!0,i.rowManager.rows.forEach(m=>t.refreshEventsForResource(m,!1,!1)),t.onRenderDone()}}}repaintEventsForResource(e){this.refreshResources([e.id])}onBeforeRowHeightChange(){this.clearAll()}refreshResourcesOnDataReady(e){e.forEach(t=>this.toDrawOnDataReady.add(t))}refreshResourcesWhenReady(e){this.clearResources(e),e.forEach(t=>this.toDrawOnProjectRefresh.add(t))}refreshResources(e,t=!0){const i=this,{scheduler:r}=i,n=[],s=[];i.clearResources(e),r.refreshSuspended||(e.forEach(a=>{const o=r.getRowById(a);o?n.push(o):s.push(o)}),r.runWithTransition(()=>{r.calculateRowHeights(s.map(a=>this.resourceStore.getById(a)),!0),r.rowManager.renderRows(n)},t))}layoutEventVerticallyStack(e,t,i){const{barMargin:r,resourceMargin:n,contentHeight:s}=this.scheduler.getResourceLayoutSettings(i,t.parent);return e===0?n:n+e*s+e*r}layoutEventVerticallyPack(e,t,i,r){const{barMargin:n,resourceMargin:s,contentHeight:a}=this.scheduler.getResourceLayoutSettings(r,i.parent),o=1/t,l=e*o,d=(a-(o-1)*n)*t;return{top:s+l*d+l*n,height:d}}addTemporaryDragElement(e,t=e.resource){const{scheduler:i}=this,r=i.generateRenderData(e,t,{timeAxis:!0,viewport:!0});r.absoluteTop=r.row?r.top+r.row.top:i.getResourceEventBox(e,t,!0).top;const n=this.renderEvent(r),{dataset:s}=n;delete n.tabIndex,delete s.eventId,delete s.resourceId,delete s.assignmentId,delete s.syncId,s.transient=!0,n.parent=this.scheduler.foregroundCanvas,n.retainElement=!0;const a=S.createElement(n);return a.innerElement=a.firstChild,e.instanceMeta(i).hasTemporaryDragElement=!0,a}eventSorter(e,t){if(this.overlappingEventSorter)return this.overlappingEventSorter(e.eventRecord||e,t.eventRecord||t);const i=e.isModel?e.startDateMS:e.dataStartMS||e.startMS,r=e.isModel?e.endDateMS:e.dataEndMS||e.endMS,n=t.isModel?t.startDateMS:t.dataStartMS||t.startMS,s=t.isModel?t.endDateMS:t.dataEndMS||t.endMS,a=e.isModel?e.name:e.eventRecord.name,o=t.isModel?t.name:t.eventRecord.name;return i-n||s-r||(a<o?-1:a==o?0:1)}calculateMS(e,t,i,r,n){const s=this,{scheduler:a}=s,{timeAxisViewModel:o}=a;let l=Ef(a,e,!1,t,r),d=Ef(a,e,!0,i,r),u=d-l;if(a.milestoneLayoutMode!=="default"&&u===0){const h=o.getSingleUnitInPixels("minute");if(u=a.getMilestoneLabelWidth(e,n)*(1/h)*60*1e3,a.milestoneTextPosition==="always-outside")l-=a.getResourceLayoutSettings(n,e.parent).contentHeight*(1/h)*60*1e3/2,d=l+u;else switch(a.milestoneAlign){case"start":case"left":d=l+u;break;case"end":case"right":d=l,l=d-u;break;default:d=l+u/2,l=d-u;break}}return{startMS:l,endMS:d,durationMS:u}}setupRenderData(e,t){var i;const r=this,{scheduler:n}=r,{timeAxis:s,timeAxisViewModel:a}=n,{preamble:o,postamble:l}=e,d=r.isProHorizontalRendering&&((i=n.features.eventBuffer)===null||i===void 0?void 0:i.enabled)&&(o||l)&&!e.isMilestone,u=a.getSingleUnitInPixels("minute"),{isBatchUpdating:h}=e,f=d?"wrapStartDate":"startDate",g=d?"wrapEndDate":"endDate",m=h&&!d?e.get(f):e[f],p=h&&!d?e.get(g):e[g]||m,v=s.startMS,y=s.endMS,{startMS:C,endMS:D,durationMS:w}=r.calculateMS(e,f,g,d,t),E=C<v|(C>y)<<1,R=D>y|(D<=v)<<1,x=w/(1e3*60),k=R?u*x:null,I=n.getRowById(t);return{eventRecord:e,taskRecord:e,start:m,end:p,rowId:t.id,children:[],startMS:C,endMS:D,durationMS:w,startsOutsideView:E,endsOutsideView:R,width:k,row:I,useEventBuffer:d}}fillTimeSpanHorizontalPosition(e){const{startMS:t,endMS:i,durationMS:r}=e,n=t!=null&&i!=null&&this.calculateHorizontalPosition(e,t,i,r);return n?(Object.assign(e,n),!0):!1}calculateHorizontalPosition(e,t,i,r){const{scheduler:n}=this,{timeAxis:s,timeAxisViewModel:a}=n,{startsOutsideView:o,endsOutsideView:l,eventRecord:d}=e,u=s.startMS,h=a.getSingleUnitInPixels("minute"),f=r/(1e3*60),g=l?h*f:null;let m=n.getCoordinateFromDate(i,{local:!0,respectExclusion:!0,isEnd:!0}),p,v=!1,y=!1;return o?(p=(t-u)/(1e3*60)*h,n.rtl&&(p=n.timeAxisSubGrid.scrollable.scrollWidth-p)):(p=n.getCoordinateFromDate(t,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:m!==-1}),v=p===-1),l?K.isSafari&&n.features.stickyEvents?m=n.getCoordinateFromDate(s.endMS):m=p+g*(n.rtl?-1:1):y=m===-1,y&&!v&&(m=n.getCoordinateFromDate(i,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0})),g>Ml&&(o===1?l===1?(p=-100,m=n.timeAxisColumn.width+100):p=m-Ml:l===1&&(m=p+Ml)),v&&y&&(p=n.getCoordinateFromDate(t,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:!0,max:i}),m=n.getCoordinateFromDate(i,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0,min:t}),p===m)?(d.instanceMeta(n).excluded=!0,null):{left:Math.min(p,m),width:Math.abs(m-p)||(d.isMilestone&&!d.meta.isDragCreating?0:6),clippedStart:v,clippedEnd:y}}fillTimeSpanVerticalPosition(e,t){const{scheduler:i}=this,{start:r,end:n}=e,{resourceMargin:s,contentHeight:a}=i.getResourceLayoutSettings(t);i.fillTicks&&(e.dataStartMS=r.getTime(),e.dataEndMS=n.getTime()),e.top=Math.max(0,s),i.managedEventSizing&&(e.height=a)}getTimeSpanRenderData(e,t,i=!1){const r=this,{scheduler:n}=r,{timeAxis:s}=n,a=i===!0||i.timeAxis,o=i===!0||i.viewport;if((a||s.isTimeSpanInAxis(e))&&(n.getRowById(t)||o)){const d=r.setupRenderData(e,t);return r.fillTimeSpanHorizontalPosition(d)?(r.fillTimeSpanVerticalPosition(d,t),d):null}}layoutEvents(e,t,i=!1,r,n){const s=this,{scheduler:a}=s,{timeAxis:o}=a,l=t.reduce((g,m)=>{if(i||o.isTimeSpanInAxis(m)){const p=a.generateRenderData(m,e,!1);p&&g.push(p)}return g},[]);l.sort(n??s.eventSorter);let d=a.getAppliedResourceHeight(e,r);const u=l.filter(({eventRecord:g})=>g.isEvent&&!g.meta.excludeFromLayout),h=a.getEventLayout(e,r),f=a.getEventLayoutHandler(h);if(f){const{barMargin:g,resourceMargin:m,contentHeight:p}=a.getResourceLayoutSettings(e,r),v=f.applyLayout(u,e)||1;f.type==="layoutFn"?d=v:d=v*p+(v-1)*g+m*2}else if(u.length>0)for(let g=0;g<u.length;g++){const m=u[g];m.wrapperStyle+=`;z-index:${g+5}`}return{rowHeight:d,eventsData:l}}layoutResourceEvents(e,t=!1){const i=this,{scheduler:r}=i,{eventStore:n,assignmentStore:s,timeAxis:a}=r,o=n.getEvents({includeOccurrences:r.enableRecurringEvents,resourceRecord:e,startDate:a.startDate,endDate:a.endDate,filter:(s.isFiltered||n.isFiltered)&&(d=>d.assignments.some(u=>u.resource===e.$original&&s.includes(u)))}),l=r.getEventsToRender(e,o)||[];return i.layoutEvents(e,l,t)}renderEvent(e,t){const{scheduler:i}=this,{resourceRecord:r,assignmentRecord:n,eventRecord:s}=e,{milestoneLayoutMode:a,milestoneTextPosition:o}=i,l=n?this.assignmentStore.getOccurrence(n,s).id:e.eventId,d={className:e.cls,style:e.style||"",children:e.children,role:"presentation",dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},u={className:e.wrapperCls,tabIndex:"tabIndex"in e?e.tabIndex:-1,children:[d,...e.wrapperChildren],style:{top:e.absoluteTop,left:e.left,height:e.fillSize?t:e.height,width:s.isMilestone&&!s.meta.isDragCreating&&(a==="default"&&(o==="outside"||o==="inside"&&!e.width)||o==="always-outside")?e.height:e.width,style:e.wrapperStyle,fontSize:e.height+"px"},dataset:{resourceId:r.id,eventId:e.eventId,syncId:r.isLinked?`${l}_${r.id}`:l},elementData:e,retainElement:n?.instanceMeta(i).retainElement||s.instanceMeta(i).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return e.fillSize&&(e.height=t),e.zIndex&&(u.zIndex=e.zIndex),n&&(u.dataset.assignmentId=n.id),e.elementConfig=u,u}refreshEventsForResource(e,t=!0,i=!0){const r=this,n=r.scheduler.store.getById(e.isRow?e.id:e),s=r.scheduler.rowManager.getRowFor(n);t&&r.clearResources([n]),s&&n&&(r.renderer({row:s,record:n}),t&&i&&r.onRenderDone())}getResourceLayout(e){const t=this;let i=t.resourceMap.get(e.id);if(!i||i.invalid){if(t.suspended)return;i=t.layoutResourceEvents(e,!1),t.resourceMap.set(e.id,i)}return i}getEventDOMConfigForCurrentView(e,t,i,r){const n=this,{bufferSize:s,scheduler:a}=n,{labels:o,eventBuffer:l}=a.features,d=l?.enabled||o?.enabled&&(o.left||o.right||o.before||o.after),{eventsData:u}=e,h=n.fromScroll?n.rowMap.get(t):null,f=[];let g,m;for(let p=0;p<u.length;p++){const v=u[p];if(g=i,m=r,(d||v.width===0)&&(g-=s,m+=s),v.left+v.width>=g&&v.left<=m){v.absoluteTop=v.top+t.top;const y=h?.find(C=>C.elementData.eventId===v.eventId);f.push(y??n.renderEvent(v,e.rowHeight))}}return f}renderer({row:e,record:t,size:i={}}){const r=this;if(t.isSpecialRow){r.rowMap.delete(e);return}const{left:n,right:s}=r.viewportCoords,a=r.getResourceLayout(t);if(!a)return;i.height=a.rowHeight,i.transient=!0;const o=r.getEventDOMConfigForCurrentView(a,e,n,s);r.rowMap.set(e,o),r.rendererCalled=!0}onRenderDone(){var e;const{scheduler:t,rowMap:i,verticalBufferSize:r}=this,n=[],s=(e=t._scrollTop)!==null&&e!==void 0?e:0,a=s-r,o=s+t._bodyRectangle.height+r,l=r<0,d=!t.managedEventSizing;i.forEach((u,h)=>{if(l||h.bottom>a&&h.top<o)for(let f=0;f<u.length;f++){const g=u[f],m=g.elementData,{absoluteTop:p,eventRecord:v}=m;(l||d||v.meta.isDragCreating||v.meta.isResizing||p+m.height>a&&p<o)&&n.push(g)}for(let f=0;f<u.length;f++)u[f]=F({},u[f])}),this.fromScroll=!1,this.visibleEventDOMConfigs=n,Z.sync({domConfig:{onlyChildren:!0,children:n},targetElement:t.foregroundCanvas,syncIdField:"syncId",callback({action:u,domConfig:h,lastDomConfig:f,targetElement:g,jsx:m}){var p,v;const{reactComponent:y}=t,C=jE[u],D=WE[u];if(!(!C&&(p=t.processEventContent)!==null&&p!==void 0&&p.call(t,{jsx:m,action:u,domConfig:h,targetElement:g,isRelease:C,reactComponent:y}))&&!(u==="none"||!(h!=null&&(v=h.elementData)!==null&&v!==void 0&&v.isWrap))){if(C&&f!==null&&f!==void 0&&f.elementData){var w;const{eventRecord:E,resourceRecord:R,assignmentRecord:x}=f.elementData,k={renderData:f.elementData,element:g,eventRecord:E,resourceRecord:R,assignmentRecord:x};(w=t.processEventContent)===null||w===void 0||w.call(t,{isRelease:C,targetElement:g,reactComponent:y,assignmentRecord:x}),g===S.getActiveElement(g)&&t.focusElement.focus(),t.trigger("releaseEvent",k)}if(D){const{eventRecord:E,resourceRecord:R,assignmentRecord:x}=h.elementData,k={renderData:h.elementData,element:g,isReusingElement:u==="reuseElement",isRepaint:u==="reuseOwnElement",eventRecord:E,resourceRecord:R,assignmentRecord:x};t.trigger("renderEvent",k)}}}})}clearResources(e){e=W.asArray(e),e.map(de.asId).forEach(i=>{const r=this.resourceMap.get(i);r&&(r.invalid=!0);const n=this.scheduler.getRowById(i);n&&this.rowMap.delete(n)})}clearAll({clearDom:e=!1,clearLayoutCache:t=!1}={}){const i=this,{layouts:r,foregroundCanvas:n}=i.scheduler;if(t&&r)for(const s in r)r[s].clearCache();if(n&&e){n.syncIdMap=n.lastDomConfig=null;for(const s of n.children)s.lastDomConfig=s.elementData=null}i.resourceMap.clear(),i.rowMap.clear()}}M(Jd,"$name","HorizontalRendering");Jd._$name="HorizontalRendering";class _p extends Bd(){static get defaultConfig(){return{coordProp:"leftFactor",sizeProp:"widthFactor"}}applyLayout(e,t,i,r,n,s){const a=this,o=s.type;return a.packEventsInBands(e,(l,d,u,h)=>{if(o==="none")l.width=t-i*2,l.left+=i;else{l.widthFactor=h;const f=l.leftFactor=u.start+d*h,g=Math.round(1/h),m=f/h,p=t-i*2-r*(g-1);o==="mixed"&&g===2?(l.left+=f*t/5+r,l.width=t-f*t/5-r*2,l.zIndex=5+m):(l.width=h*p,l.left+=f*p+i+r*m)}l.cls["b-sch-event-narrow"]=l.width<a.scheduler.narrowEventWidth})}}_p._$name="VerticalLayout";const GE={releaseElement:1,reuseElement:1},qE={newElement:1,reuseOwnElement:1,reuseElement:1},KE={startDate:1,endDate:1,duration:1},XE=Object.freeze({});class Hp extends P.mixin(he,Mi){static get properties(){return{eventMap:new Map,resourceMap:new Map,releasedElements:{},toDrawOnProjectRefresh:new Set,resourceBufferSize:1}}construct(e){this.client=this.scheduler=e,this.verticalLayout=new _p({scheduler:e}),super.construct({})}init(){const e=this,{scheduler:t,resourceColumns:i}=e;i.resourceStore=e.resourceStore,i.ion({name:"resourceColumns",columnWidthChange:"onResourceColumnWidthChange",thisObj:e}),e.initialized=!0,t.isPainted&&e.renderer(),i.availableWidth=t.timeAxisSubGridElement.offsetWidth}resolveRowRecord(e,t){const i=this,{scheduler:r}=i,n=e.nodeType?null:e,s=n?n.target:e,a=n?[n.borderOffsetX,n.borderOffsetY]:t,o=s.nodeType===Element.TEXT_NODE?s.parentElement:s,l=o.closest(r.eventSelector);if(l)return r.resourceStore.getById(l.dataset.resourceId);if(!s.closest(".b-sch-timeaxis-cell"))return null;if(!a)throw new Error(`Vertical mode needs coordinates to resolve this element. Can also be called with a browser
                event instead of element to extract element and coordinates from`);if(r.variableColumnWidths||r.resourceStore.isGrouped){let u=0;for(const h of i.resourceStore)if(h.isSpecialRow||(u+=h.columnWidth||i.resourceColumns.columnWidth),u>=a[0])return h;return null}const d=Math.floor(a[0]/i.resourceColumns.columnWidth);return i.allResourceRecords[d]}toggleCls(e,t,i=!0,r=!1){var n;const s=(n=this.eventMap.get(e.eventId))===null||n===void 0?void 0:n[e.resourceId];if(s){s.renderData[r?"wrapperCls":"cls"][t]=i;const a=this.client.getElementFromAssignmentRecord(e,r);a&&a.classList[i?"add":"remove"](t)}}getDateFromXY(e,t,i,r=!1){let n=e[1];return i||(n=this.translateToScheduleCoordinate(n)),this.scheduler.timeAxisViewModel.getDateFromPosition(n,t,r)}translateToScheduleCoordinate(e){return e-this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top-globalThis.scrollY}translateToPageCoordinate(e){return e+this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top+globalThis.scrollY}getResourceEventBox(e,t){var i;const r=e.id,n=t.id;let{renderData:s}=((i=this.eventMap.get(r))===null||i===void 0?void 0:i[n])||XE;if(!s){var a,o;this.layoutResource(this.scheduler.resourceStore.getById(n)),s=(a=this.eventMap.get(r))===null||a===void 0||(o=a[n])===null||o===void 0?void 0:o.renderData}return s?new $(s.left,s.top,s.width,s.bottom-s.top):null}getScheduleRegion(e,t,i){var r;const n=this,{scheduler:s}=n,a=$.from(s.timeAxisSubGridElement,s.timeAxisSubGridElement);e&&(a.left=n.allResourceRecords.indexOf(e)*s.resourceColumnWidth,a.right=a.left+s.resourceColumnWidth);const o=s.timeAxis.startDate,l=s.timeAxis.endDate,d=((r=s.getDateConstraints)===null||r===void 0?void 0:r.call(s,e,t))||{start:o,end:l},u=s.getCoordinateFromDate(b.max(o,d.start)),h=s.getCoordinateFromDate(b.min(l,d.end));return i?(a.top=u,a.bottom=h):(a.top=n.translateToPageCoordinate(u),a.bottom=n.translateToPageCoordinate(h)),a}getRowRegion(e,t,i){const r=this,{scheduler:n}=r,s=r.allResourceRecords.indexOf(e)*n.resourceColumnWidth,a=n.timeAxis.startDate,o=n.timeAxis.endDate,l=t?b.max(a,t):a,d=i?b.min(o,i):o,u=n.getCoordinateFromDate(l),h=n.getCoordinateFromDate(d,!0,!0),f=Math.min(u,h),g=Math.abs(u-h);return new $(s,f,n.resourceColumnWidth,g)}get visibleDateRange(){const e=this.scheduler,t=e.scrollable.y,i=e.scrollable.clientHeight,r=e.getDateFromCoordinate(t)||e.timeAxis.startDate,n=e.getDateFromCoordinate(t+i)||e.timeAxis.endDate;return{startDate:r,endDate:n,startMS:r.getTime(),endMS:n.getTime()}}onResourceColumnWidthChange({width:e,oldWidth:t}){const i=this,{scheduler:r}=i;i.resourceColumns.width=r.timeAxisColumn.width=i.allResourceRecords.length*e,i.clearAll(),i.refresh(Math.abs(e-t)>30)}attachToProject(e){super.attachToProject(e),e&&e.ion({name:"project",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh(){const e=this,{scheduler:t,toDrawOnProjectRefresh:i}=e;t.isVisible?t.rendered&&!t.refreshSuspended&&(e.refreshAllWhenReady?(e.clearAll(),e.refresh(),e.refreshAllWhenReady=!1):i.size&&e.refresh(),i.clear()):t.whenVisible("refresh",t,[!0])}attachToEventStore(e){super.attachToEventStore(e),this.refreshAllWhenReady=!0,e&&e.ion({name:"eventStore",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreRefresh({action:e}){e==="batch"&&(this.refreshAllWhenReady=!0)}onEventStoreChange({action:e,records:t=[],record:i,replaced:r,changes:n,isAssign:s}){const a=this,o=new Set;switch(t.forEach(l=>{var d;const u=(d=l.$linkedResources)===null||d===void 0?void 0:d.filter(h=>a.resourceStore.includes(h));u?.forEach(h=>o.add(h.id))}),e){case"sort":case"group":case"move":case"remove":return;case"dataset":a.refreshAllResourcesWhenReady();return;case"add":case"updateMultiple":break;case"replace":r.forEach(([,l])=>{l.resources.map(d=>o.add(d.id))}),a.clearResources(o);break;case"removeall":case"filter":a.clearAll(),a.refresh();return;case"update":{const l=i.$entity?!Object.keys(n).some(u=>!i.$entity.getField(u)):!Object.keys(n).some(u=>!KE[u]);let d=0;"startDate"in n&&d++,"endDate"in n&&d++,"duration"in n&&d++,(!l||d||"percentDone"in n||"inactive"in n||"segments"in n)&&(a.clearResources(o),a.refresh());return}}a.refreshResourcesWhenReady(o)}attachToResourceStore(e){const t=this;super.attachToResourceStore(e),t.refreshAllWhenReady=!0,t.resourceColumns&&(t.resourceColumns.resourceStore=e),e.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",refreshPreCommit:"onResourceStoreRefresh",load:()=>t.scheduler.unmaskBody(),thisObj:t,prio:1}),t.initialized&&t.scheduler.isPainted&&(t.firstResource=t.lastResource=null,t.clearAll(),t.renderer())}onResourceStoreChange({source:e,action:t,records:i=[],record:r,replaced:n,changes:s}){const a=this,o=n?n.map(u=>u[1]):i,l=new Set(o.map(u=>u.id));a.firstResource=a.lastResource=null,e._allResourceRecords=null;const{allResourceRecords:d}=e;if(a.scheduler.isEngineReady){switch(t){case"update":s!=null&&s.id?a.clearResources([s.id.oldValue,s.id.value]):a.clearResources([r.id]);break;case"filter":a.clearAll();break}s&&"columnWidth"in s&&a.clearAll(),a.refresh(!0)}else{switch(t){case"dataset":case"remove":case"removeall":a.refreshAllResourcesWhenReady();return;case"replace":case"add":{const u=o.reduce((h,f)=>Math.min(h,d.indexOf(f)),d.length);for(let h=u;h<d.length;h++)l.add(d[h].id)}}a.refreshResourcesWhenReady(l)}}onResourceStoreRefresh({action:e}){const t=this;(e==="sort"||e==="group")&&(t.firstResource=t.lastResource=t.resourceStore._allResourceRecords=null,t.clearAll(),t.refresh())}attachToAssignmentStore(e){super.attachToAssignmentStore(e),this.refreshAllWhenReady=!0,e&&e.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({action:e,records:t=[],replaced:i,changes:r}){const n=this,s=new Set(t.map(a=>a.resourceId));if(n.scheduler.isEngineReady){switch(e){case"remove":n.clearResources(s);break;case"filter":n.clearAll();break;case"update":{if("resourceId"in r&&s.add(r.resourceId.oldValue),!Object.keys(r).filter(a=>a!=="resource"&&a!=="event").length)return;n.clearResources(s)}}n.refresh(!0)}else{switch(r&&"resourceId"in r&&s.add(r.resourceId.oldValue),e){case"removeall":n.refreshAllResourcesWhenReady();return;case"replace":i.forEach(([a,o])=>{s.add(a.resourceId),s.add(o.resourceId)})}n.refreshResourcesWhenReady(s)}}onAssignmentStoreRefresh({action:e,records:t}){e==="batch"&&(this.clearAll(),this.refreshAllResourcesWhenReady())}refreshRows(e){e&&(this.clearAll(),this.scheduler.refreshFromRerender=!1)}repaintEventsForResource(e){this.renderResource(e)}updateFromHorizontalScroll(e){e!==this.prevScrollX&&(this.renderer(),this.prevScrollX=e)}updateFromVerticalScroll(){this.renderer()}scrollResourceIntoView(e,t){const{scheduler:i}=this,r=this.allResourceRecords.indexOf(e)*i.resourceColumnWidth;return i.scrollHorizontallyTo(r,t)}get allResourceRecords(){return this.scheduler.resourceStore.allResourceRecords}onViewportResize(e){this.resourceColumns.availableWidth=e,this.renderer()}get resourceColumns(){var e;return(e=this.scheduler.timeAxisColumn)===null||e===void 0?void 0:e.resourceColumns}onLocaleChange(){this.clearAll()}onDragAbort(){}onBeforeRowHeightChange(){}onTimeAxisViewModelUpdate(){}updateElementId(){}releaseTimeSpanDiv(){}getConnectorStartSide(e){return"top"}getConnectorEndSide(e){return"bottom"}refreshResourcesWhenReady(e){this.clearResources(e),e.forEach(t=>this.toDrawOnProjectRefresh.add(t))}refreshAllResourcesWhenReady(){this.clearAll(),this.refreshAllWhenReady=!0}get resourceRange(){return this.getResourceRange(!0)}get visibleResources(){const{first:e,last:t}=this.getResourceRange();return{first:this.allResourceRecords[e],last:this.allResourceRecords[t]}}getResourceRange(e){const{scheduler:t,resourceStore:i}=this,{resourceColumnWidth:r,scrollX:n}=t,{scrollWidth:s}=t.timeAxisSubGrid.scrollable,a=e?this.resourceBufferSize:0,o=n-a,l=n+s+a;if(!(i!=null&&i.count))return{first:-1,last:-1};if(t.variableColumnWidths){let d,u,h,f=0;return this.allResourceRecords.forEach((g,m)=>{if(g.instanceMeta(t).insetStart=h=f,f=h+g.columnWidth,h>l)return!1;f>o&&d==null?d=m:h<l&&(u=m)}),{first:d,last:u}}else return{first:Math.max(Math.floor(n/r)-a,0),last:Math.min(Math.floor((n+t.timeAxisSubGrid.width)/r)+a,this.allResourceRecords.length-1)}}get dateRange(){const{scheduler:e}=this;let t=e.getDateFromCoordinate(Math.min(e.scrollTop+e.bodyHeight+e.tickSize-1,(e.virtualScrollHeight||e.scrollable.scrollHeight)-1));t||(t=e.timeAxis.last.endDate);let i=e.getDateFromCoordinate(Math.max(e.scrollTop-e.tickSize,0));return i||(i=e.timeAxis.first.startDate,t=e.getDateFromCoordinate(e.bodyHeight+e.tickSize-1)),{topDate:i,bottomDate:t}}getTimeSpanRenderData(e,t,i=!1){var r;const n=this,{scheduler:s}=n,{preamble:a,postamble:o}=e,{variableColumnWidths:l}=s,d=((r=s.features.eventBuffer)===null||r===void 0?void 0:r.enabled)&&n.isProVerticalRendering&&(a||o)&&!e.isMilestone,u=d?"wrapStartDate":"startDate",h=d?"wrapEndDate":"endDate",f=e.isBatchUpdating&&e.hasBatchedChange(u)&&!d?e.get(u):e[u],g=e.isBatchUpdating&&e.hasBatchedChange(h)&&!d?e.get(h):e[h],m=s.getResourceMargin(t),p=s.getCoordinateFromDate(f),v=t.instanceMeta(s),y=l?v.insetStart:n.allResourceRecords.indexOf(t)*s.resourceColumnWidth,C=s.getResourceWidth(t),D=C-m*2,w=f.getTime(),E=g.getTime();let R=s.getCoordinateFromDate(g),x=R-p;return R===-1&&(x=Math.round((E-w)*s.timeAxisViewModel.getSingleUnitInPixels("millisecond")),R=p+x),{eventRecord:e,resourceRecord:t,left:y,top:p,bottom:R,resourceWidth:C,width:D,height:x,startDate:f,endDate:g,startDateMS:w,endDateMS:E,useEventBuffer:d,children:[],start:f,end:g,startMS:w,endMS:E}}eventSorter(e,t){const i=e.dataStartMs||e.startDateMS,r=e.dataEndMs||e.endDateMS,n=t.dataStartMs||t.startDateMS,s=t.dataEndMs||t.endDateMS,a=e.isModel?e.name:e.eventRecord.name,o=t.isModel?t.name:t.eventRecord.name;return i-n||s-r||(a<o?-1:a==o?0:1)}layoutResource(e){const t=this,{scheduler:i}=t,{variableColumnWidths:r}=i,{id:n}=e,s=e.instanceMeta(i),{assignmentStore:a,eventStore:o,timeAxis:l}=i,d=t.resourceMap.set(n,{}).get(n),u=t.allResourceRecords.indexOf(e),{barMargin:h,resourceMargin:f}=i.getResourceLayoutSettings(e);let g=o.getEvents({includeOccurrences:i.enableRecurringEvents,resourceRecord:e,startDate:l.startDate,endDate:l.endDate,filter:(a.isFiltered||o.isFiltered)&&(p=>p.assignments.some(v=>v.resource===e&&a.includes(v)))});g=i.getEventsToRender(e,g);const m=g.reduce((p,v)=>{if(v.isScheduled){const y=i.generateRenderData(v,e,!1),C={renderData:y},D=T.getMapPath(t.eventMap,y.eventId,{});D[n]=C,d[y.eventId]=C,y.fillSize?(y.left=r?s.insetStart:u*i.resourceColumnWidth,y.width=i.getResourceWidth(e)):p.push(y)}return p},[]);return m.sort(t.eventSorter),t.verticalLayout.applyLayout(m,i.getResourceWidth(e),f,h,u,i.getEventLayout(e)),d}addTemporaryDragElement(e){const{scheduler:t}=this,i=t.generateRenderData(e,e.resource,{timeAxis:!0,viewport:!0});i.top=i.row?i.top+i.row.top:t.getResourceEventBox(e,e.resource,!0).top;const r=this.renderEvent({renderData:i}),{dataset:n}=r;delete r.tabIndex,delete n.eventId,delete n.resourceId,delete n.assignmentId,delete n.syncId,n.transient=!0,r.parent=this.scheduler.foregroundCanvas,r.retainElement=!0;const s=S.createElement(r);return s.innerElement=s.firstChild,e.instanceMeta(t).hasTemporaryDragElement=!0,s}renderEvent(e){const{scheduler:t}=this,i=e.renderData,{resourceRecord:r,assignmentRecord:n,eventRecord:s}=i,a={className:i.wrapperCls,tabIndex:-1,children:[{role:"presentation",className:i.cls,style:(i.internalStyle||"")+(i.style||""),children:i.children,dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},...i.wrapperChildren],style:{top:i.top,[t.rtl?"right":"left"]:i.left,height:s.isMilestone?"1em":i.height,width:i.width,style:i.wrapperStyle||"",fontSize:s.isMilestone?Math.min(i.width,40):null},dataset:{resourceId:r.id,eventId:i.eventId,syncId:n?this.assignmentStore.getOccurrence(n,s).id:i.eventId},elementData:e,retainElement:(n||s).instanceMeta(this.scheduler).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return a.className["b-sch-vertical"]=1,i.zIndex&&(a.zIndex=i.zIndex),n&&(a.dataset.assignmentId=n.id),e.elementConfig=a,a}renderResource(e){const t=this,{topDateMS:i,bottomDateMS:r}=t,n=[];let s=t.resourceMap.get(e.id);s||(s=t.layoutResource(e));for(const o in s){const l=s[o],{endDateMS:d,startDateMS:u,eventRecord:h}=l.renderData;if(d>=i&&u<=r&&!h.instanceMeta(t.scheduler).hasTemporaryDragElement){var a;const f=((a=l.elementConfig)===null||a===void 0?void 0:a.className)!=="b-released"&&l.elementConfig||t.renderEvent(l);n.push(f)}}return n}isEventElement(e){const t=e&&e.className;return t&&t[this.scheduler.eventCls+"-wrap"]}renderer(){const e=this,{scheduler:t}=e,{first:i,last:r}=e.resourceRange,{topDate:n,bottomDate:s}=e.dateRange,a=[],o=[];if(!(!e.initialized||!t.isEngineReady&&!t.isCreating)){if(!b.isEqual(n,e.topDate)||!b.isEqual(s,e.bottomDate)){e.topDate=n,e.bottomDate=s,e.topDateMS=n.getTime(),e.bottomDateMS=s.getTime();const l=e.timeView.range={startDate:n,endDate:s};t.onVisibleDateRangeChange(l)}if(i!==-1&&r!==-1)for(let l=i;l<=r;l++)a.push.apply(a,e.renderResource(e.allResourceRecords[l]));if(t.getForegroundDomConfigs(o),a.push.apply(a,o),Z.sync({domConfig:{onlyChildren:!0,children:a},targetElement:t.foregroundCanvas,syncIdField:"syncId",callback({action:l,domConfig:d,lastDomConfig:u,targetElement:h,jsx:f}){var g;const{reactComponent:m}=t;if(e.isEventElement(d)||f||d!=null&&(g=d.elementData)!==null&&g!==void 0&&g.jsx){var p;const y=GE[l],C=qE[l];if((p=t.processEventContent)!==null&&p!==void 0&&p.call(t,{action:l,domConfig:d,isRelease:!1,targetElement:h,reactComponent:m,jsx:f}))return;if(y&&e.isEventElement(u)&&!u.isReleased){var v;const D=u.elementData.renderData,w={renderData:D,assignmentRecord:D.assignmentRecord,eventRecord:D.eventRecord,resourceRecord:D.resourceRecord,element:h};(v=t.processEventContent)===null||v===void 0||v.call(t,{isRelease:y,targetElement:h,reactComponent:m,assignmentRecord:D.assignmentRecord}),h===S.getActiveElement(h)&&t.focusElement.focus(),t.trigger("releaseEvent",w)}if(C){const D=d.elementData.renderData,w={renderData:D,assignmentRecord:D.assignmentRecord,eventRecord:D.eventRecord,resourceRecord:D.resourceRecord,element:h,isReusingElement:l==="reuseElement",isRepaint:l==="reuseOwnElement"};w.reusingElement=l==="reuseElement",t.trigger("renderEvent",w)}}}}),e.firstResource!==i||e.lastResource!==r){const l=e.resourceColumns.visibleResources={firstResource:i,lastResource:r};e.firstResource=i,e.lastResource=r,t.onVisibleResourceRangeChange(l),t.trigger("resourceRangeChange",l)}}}refresh(e){this.scheduler.runWithTransition(()=>this.renderer(),e)}refreshResources(e){this.clearResources(e),this.refresh()}refreshEventsForResource(e,t=!0,i=!0){this.refreshResources([e.id])}onRenderDone(){}get timeView(){return this.scheduler.timeView}clearResources(e){const{resourceMap:t,eventMap:i}=this;e.forEach(r=>{t.has(r)&&(Object.values(t.get(r)).forEach(({renderData:{eventId:n}})=>{delete i.get(n)[r]}),t.delete(r))})}clearAll(){this.resourceMap.clear(),this.eventMap.clear()}}Hp._$name="VerticalRendering";const ZE={month:"MMMM, YYYY",week:["MMMM YYYY (Wp)","S{MMM} - E{MMM YYYY} (S{Wp})"],day:"MMMM D, YYYY"};class Ar extends ys.mixin(Gm,Op,AE,LE,PE,_E,NE,OE,HE,Pp,$p,Lp){static get $name(){return"SchedulerBase"}static get type(){return"schedulerbase"}static get configurable(){return{date:{value:null,$config:{equal:"date"}},stepUnit:"week",range:"week",getDateConstraints:null,verticalTimeAxisColumn:{},createEventOnDblClick:!0,schedulableAreaSelector:".b-sch-timeaxis-cell",scheduledEventName:"event",sortFeatureStore:"resourceStore"}}static get defaultConfig(){return{mode:"horizontal",eventCls:"b-sch-event",timeCellCls:"b-sch-timeaxis-cell",overScheduledEventClass:"b-sch-event-hover",allowOverlap:!0,rowHeight:60,preCalculateHeightLimit:1e4,crudManagerClass:Fr,testConfig:{loadMaskError:{autoClose:10,showDelay:0}}}}afterConstruct(){const e=this;super.afterConstruct(),e.ion({scroll:"onVerticalScroll",thisObj:e}),e.createEventOnDblClick&&e.ion({scheduledblclick:e.onTimeAxisCellDblClick})}onPaintOverride(){}get store(){return super.store}set store(e){super.store=e}get visibleResources(){var e,t;const i=this;return i.isVertical?i.currentOrientation.visibleResources:{first:i.store.getById((e=i.firstVisibleRow)===null||e===void 0?void 0:e.id),last:i.store.getById((t=i.lastVisibleRow)===null||t===void 0?void 0:t.id)}}onLocaleChange(){this.currentOrientation.onLocaleChange(),super.onLocaleChange()}onTimeAxisCellDblClick({date:e,resourceRecord:t,row:i}){const r=this;r.readOnly||t.isSpecialRow||t.readOnly||r.createEvent(e,t,i)}onVerticalScroll({scrollTop:e}){this.currentOrientation.updateFromVerticalScroll(e)}onEventCreated(e){}get isHorizontal(){return this.mode==="horizontal"}get isVertical(){return this.mode==="vertical"}get mode(){return this._mode}set mode(e){const t=this;t._mode=e,t[e]||(t.element.classList.add(`b-sch-${e}`),e==="horizontal"?(t.horizontal=new Jd(t),t.isPainted&&t.horizontal.init()):e==="vertical"&&(t.vertical=new Hp(t),t.rendered&&t.vertical.init()))}get currentOrientation(){return this[this.mode]}onElementKeyDown(e){return super.onElementKeyDown(e)}onElementKeyUp(e){return super.onElementKeyUp(e)}onElementMouseOver(e){return super.onElementMouseOver(e)}onElementMouseOut(e){return super.onElementMouseOut(e)}processEventDrop(){}processCrossSchedulerEventDrop(){}beforeEventDragStart(){}afterEventDragStart(){}afterEventDragAbortFinalized(){}checkEventDragValidity(){}afterEventResizeStart(){}get hasEventEditor(){const{eventEdit:e,taskEdit:t,simpleEventEdit:i}=this.features;return Boolean(e?.enabled||t?.enabled||i?.enabled)}editEvent(e,t,i){const r=this,{eventStore:n,assignmentStore:s}=r;if(!r.hasEventEditor)return!1;if(e.eventStore!==n){const{enableEventAnimations:a}=r,o=[];e.isCreating=!0;let l=[];if(t&&(o.push(t),l=s.assignEventToResource(e,t)),r.trigger("beforeEventAdd",{eventRecord:e,resourceRecords:o,assignmentRecords:l})===!1)return s?.remove(l),!1;r.enableEventAnimations=!1,n.add(e),r.project.commitAsync().then(()=>r.enableEventAnimations=a),r.refreshRows()}}async createEvent(e,t){var i,r,n;const s=this,{enableEventAnimations:a,features:o,eventStore:l,assignmentStore:d}=s,u=[t],h=s.createEventOnDblClick.useEventModelDefaults,f=h?l.modelClass.defaultValues.duration:1,g=h?l.modelClass.defaultValues.durationUnit:s.timeAxis.unit,m=l.createRecord({startDate:e,endDate:b.add(e,f,g),duration:f,durationUnit:g,name:s.L("L{Object.newEvent}")}),p=Boolean(((i=o.eventEdit)===null||i===void 0?void 0:i.enabled)||((r=o.taskEdit)===null||r===void 0?void 0:r.enabled)||((n=o.simpleEventEdit)===null||n===void 0?void 0:n.enabled));if(s.readOnly||t.isSpecialRow||!s.allowOverlap&&!s.isDateRangeAvailable(m.startDate,m.endDate,null,t))return;m.isCreating=p,s.onEventCreated(m);const v=d?.assignEventToResource(m,t);if(s.trigger("beforeEventAdd",{eventRecord:m,resourceRecords:u,assignmentRecords:v})===!1){d?.remove(v);return}s.enableEventAnimations=!1,l.add(m),s.project.commitAsync().then(()=>s.enableEventAnimations=a),s.isCreating=!0,s.refreshRows(),s.isCreating=!1,s.trigger("eventAutoCreated",{eventRecord:m,resourceRecord:t}),p&&s.editEvent(m,t,s.getEventElement(m))}isDateRangeAvailable(e,t,i,r){return this.eventStore.isDateRangeAvailable(e,t,i,r)}async resumeRefresh(e){super.resumeRefresh(!1);const t=this;if(!t.refreshSuspended&&e){if(!t.isEngineReady)return t.currentOrientation.refreshAllWhenReady=!0,t.project.commitAsync();t.isDestroyed||t.refreshWithTransition()}}toggleEmptyText(){const e=this;if(e.bodyContainer){var t;S.toggleClasses(e.bodyContainer,"b-grid-empty",!(e.resourceStore.count>0||(t=e.crudManager)!==null&&t!==void 0&&t.isLoading))}}getRowHeight(e){if(this.isHorizontal){const t=this.currentOrientation.calculateRowHeight(e);return this.rowManager.storeKnownHeight(e.id,t),t}}calculateRowHeights(e,t=!1){e.forEach(i=>i&&this.getRowHeight(i)),t||this.rowManager.estimateTotalHeight(!0)}calculateAllRowHeights(e=!1){const{store:t,rowManager:i}=this,r=Math.min(t.count,this.preCalculateHeightLimit);if(r){i.clearKnownHeights();for(let n=0;n<r;n++)this.getRowHeight(t.getAt(n));e||i.estimateTotalHeight(!0)}}get dateBounds(){const e=this,t=[e.startDate];return e.range==="week"&&t.push(e.lastDate),t}get defaultDescriptionFormat(){return ZE[this.range]}get lastDate(){const e=this.endDate;return e&&b.add(e,-1,"day")}getEventRecord(e){return e=S.getEventElement(e),this.resolveEventRecord(e)}getEventElement(e){return this.getElementFromEventRecord(e)}changeRange(e){return b.normalizeUnit(e)}updateRange(e){if(!this.isConfiguring){const t=this.date,i=this.date=b.startOf(t,e);t.getTime()===i.getTime()&&this.updateDate(i)}}changeStepUnit(e){return b.normalizeUnit(e)}updateDate(e){const t=this,i=b.startOf(e,t.range);t.setTimeSpan(i,b.add(i,1,t.range)),t.visibleDate={date:b.max(e,t.timeAxis.startDate),block:"start",animate:!0},t.trigger("descriptionChange")}previous(){this.date=b.add(this.date,-1,this.stepUnit)}next(){this.date=b.add(this.date,1,this.stepUnit)}async scheduleEvent({startDate:e,eventRecord:t,resourceRecord:i,element:r}){const n=this;if(n.eventStore.includes(t)||([t]=n.eventStore.add(t)),t.startDate=e,t.assign(i),r){const s=$.from(r,n.foregroundCanvas);S.setTranslateXY(r,0,0),S.setTopLeft(r,s.y,s.x),Z.addChild(n.foregroundCanvas,r,t.assignments[0].id)}await n.project.commitAsync()}onSelectionDrag(e){e.target.classList.contains("b-timeaxis-cell")||super.onSelectionDrag(e)}}M(Ar,"properties",{timeCellSelector:".b-sch-timeaxis-cell",resourceTimeRangeSelector:".b-sch-resourcetimerange"});Ar.initClass();Ar._$name="SchedulerBase";class Np extends Kt(yd){static get defaultConfig(){return{includeUnassigned:!0,eventColumns:[{text:"Task",field:"name"},{text:"Starts",field:"startDate",width:140},{text:"Ends",field:"endDate",width:140}],eventSortFn:null}}construct(e={},...t){super.construct(e,...t),this.eventSortFn||(this.eventSortFn=(i,r)=>i.internalId-r.internalId)}normalizeColumns(e){super.normalizeColumns(e),e.eventColumns=e.eventColumns.map(t=>typeof t=="string"?{field:t}:t)}generateExportData(e){const t=this,i=this.target instanceof Ar,r=t.generateColumns(e),n=i?t.generateEventColumns(e):[],s=r.concat(n),a=t.generateRows(e);return{columns:s,rows:a}}generateEventColumns(e){return e.eventColumns.map(t=>this.processEventColumn(t,e))}processEventColumn(e,t){const{width:i,minWidth:r}=e,{defaultColumnWidth:n}=t;return{field:e.field,value:e.text,width:Math.max(i||n,r||n),eventColumn:!0,type:this.getColumnType(e,this.target.eventStore)}}generateRows(e){const t=this,{target:i}=t;let r;if(!(i instanceof Ar))r=super.generateRows(e);else{if(r=[],i.resourceStore.map(n=>{const s=n.events||[];s.sort(t.eventSortFn),s.length||s.push(""),s.forEach(a=>r.push(t.getRowData(e,n,a)))}),e.includeUnassigned&&e.eventColumns.length){const n=i.eventStore.query(s=>!s.resources.length);if(n.length){const s=new Array(e.columns.length).fill("");s.push(t.L("L{ExcelExporter.No resource assigned}")),r.push(s),n.forEach(a=>r.push(t.getRowData(e,null,a)))}}r=r.filter(n=>n.length)}return r}getRowData(e,t,i){const{columns:r,eventColumns:n}=e,s=[],a=this.processRecord(t,r,e);if(a&&s.push(...a),!t||!t.isSpecialRow){const o=this.processRecord(i,n,e);o&&s.push(...o)}return s}}Np._$name="ScheduleTableExporter";class Bp extends bd{static get $name(){return"ExcelExporter"}static get defaultConfig(){return{exporterClass:Np,exporterConfig:null}}}Bp._$name="ExcelExporter";G.registerFeature(Bp,!1,"Scheduler");class zp extends Ar{static get $name(){return"Scheduler"}static get type(){return"scheduler"}}zp.initClass();zp._$name="Scheduler";class Vp extends Ze{static get $name(){return"ProjectCombo"}static get type(){return"projectcombo"}static get configurable(){return{project:null,displayField:"title",valueField:"url",highlightExternalChange:!1,editable:!1}}updateProject(e){var t;(t=e.transport.load)!==null&&t!==void 0&&t.url&&(this.value=e.transport.load.url)}onChange({value:e,userAction:t}){t&&this.project&&(this.project.transport.load.url=e,this.project.load())}}Vp.initClass();Vp._$name="ProjectCombo";class jp extends ji{static get $name(){return"ResourceFilter"}static get type(){return"resourcefilter"}static get delayable(){return{applyFilter:"raf"}}static get configurable(){return{eventStore:null,multiSelect:!0,toggleAllIfCtrlPressed:!0,itemTpl:e=>z.encodeHtml(e.name||""),masterFilter:()=>!0}}itemIconTpl(e,t){const{eventColor:i}=e,r=S.isNamedColor(i)?` b-sch-foreground-${i}`:"",n=!r&&i?` style="color:${i}"`:"";return this.multiSelect?`<div class="b-selected-icon b-icon${r}"${n}></div>`:""}updateEventStore(e){var t,i;const r=this,n=(t=r.initialConfig.store)!==null&&t!==void 0&&t.isStore?r.initialConfig.store.initialConfig:(i=r.store)===null||i===void 0?void 0:i.config,{resourceStore:s}=e,a=r.store=s.chain(r.masterFilter,null,F(F({},n),{},{syncOrder:!0})),o={change:"onStoreChange",thisObj:r};a.un(o),s.ion(o),s.count?r.initFilter():s.project.ion({name:"project",refresh:"initFilter",thisObj:r})}changeMasterFilter(e){const t=this;return function(i){return e.call(t,i)}}initFilter(){const{eventStore:e,selected:t}=this;e.count&&e.resourceStore.count&&(this.initialSelection||t.add(this.store.getRange()),this.detachListeners("project"))}onStoreRefresh({source:e,action:t}){if(t==="filter"&&this.resourceFilter){const{resourceFilter:i}=this,{disabled:r}=i,n=!e.isFiltered&&this.allSelected;n!==r&&(i.disabled=n,this.applyFilter())}super.onStoreRefresh(...arguments)}onSelectionChange({source:e,added:t,removed:i}){const r=this,n=!r.store.isFiltered&&r.allSelected;if(super.onSelectionChange(...arguments),!r.resourceFilter){r.resourceFilter=r.eventStore.addFilter({id:`${r.id}-filter-instance`,filterBy:s=>!s.resource||r.selected.includes(s.resources),disabled:n},t.length===r.store.count);return}if(r.resourceFilter.disabled=n,r.applyFilter(),r.eventListeners.change){const s=e.values,a=s.concat(i);W.remove(a,t),r.triggerFieldChange({value:s,oldValue:a})}}get value(){return this.selected.values}applyFilter(){this.eventStore.filter()}}jp.initClass();jp._$name="ResourceFilter";class Yi extends $a{static get $name(){return"SchedulerDatePicker"}static get type(){return"datepicker"}static get configurable(){return{showEvents:null,eventStore:null}}construct(e){"events"in e&&(e=F(F({},e),{},{showEvents:e.events}),delete e.events,ae.deprecate(ae.calendar?"Calendar":"Scheduler","6.0.0","DatePicker#events should be configured as showEvents")),super.construct(e)}doRefresh(){return this.refreshEventsMap(),super.doRefresh(...arguments)}updateShowEvents(e,t){const i=this,{classList:r}=i.contentElement;let{eventStore:n}=i;if(i.requestAnimationFrame(()=>{var s;i.element.classList.toggle("b-datepicker-with-events",Boolean(e)),(s=i.owner)===null||s===void 0||s.element.classList.toggle("b-datepicker-with-events",Boolean(e)),e&&r.add(`b-show-events-${e}`),r.remove(`b-show-events-${t}`)}),e){if(!n){const s=i.up(a=>a.eventStore);if(s)n=s.eventStore;else throw new Error("DatePicker configured with events but no eventStore")}}else i.eventsMap=null;i.isConfiguring||(i.updateEventStore(n),i.doRefresh())}refreshEventsMap(){const e=this;e.showEvents&&(e.eventsMap=e.eventStore.getEventCounts({startDate:e.startDate,endDate:e.endDate,dateMap:e.eventsMap}))}updateEventStore(e){if(e.findListener("change","refresh",this)===-1){var t;e==null||(t=e[this.showEvents?"on":"un"])===null||t===void 0||t.call(e,{change:"refresh",thisObj:this})}}cellRenderer({cell:e,date:t}){var i,r;const{showEvents:n}=this,s=(i=this.eventCounts)===null||i===void 0||(r=i.get)===null||r===void 0?void 0:r.call(i,b.makeKey(t)),a=n==="count";delete e.dataset.btip,s&&(!a&&this.eventCountTip&&(e.dataset.btip=this.L("L{ResourceInfoColumn.eventCountText}",s)),S.createElement({dataset:{count:s},class:{[a?"b-cell-events-badge":"b-icon b-icon-circle"]:1,[Yi.getEventCountClass(s)]:1},parent:e,[a?"text":""]:s}))}static getEventCountClass(e){return e?e<4?"b-datepicker-1-to-3-events":e<7?"b-datepicker-4-to-6-events":"b-calendar-7-or-more-events":""}static setupClass(e){e.replaceType=!0,super.setupClass(e)}}Yi.initClass();Yi._$name="SchedulerDatePicker";const JE=c=>c.isProjectConsumer;class bo extends Kg{static get $name(){return"UndoRedo"}static get type(){return"undoredo"}static get configurable(){return{scheduler:null,project:null}}construct(){super.construct(...arguments),this.stm||(this.scheduler=this.up(JE))}changeScheduler(e){return e.isProjectConsumer?e:bo.getById(e)}updateScheduler(e){const{crudManager:t}=e;e.ion({projectChange:"onProjectChanged",thisObj:this}),t?this.setupLoadListener(t):this.onLoad(),this.stm=e.project.stm}setupLoadListener(e){e.detachListeners("load"),e.ion({name:"load",load:"onLoad",thisObj:this})}async onLoad(){await this.scheduler.project.commitAsync(),this.isDestroyed||(this.stm.enable(),this.fillUndoRedoCombo())}onProjectChanged({project:e}){this.project=e}updateProject(e){var t;super.updateProject(...arguments),e&&!((t=this.scheduler)!==null&&t!==void 0&&t.isConfiguring)&&this.setupLoadListener(e)}}bo.initClass();bo._$name="UndoRedo";class bs extends Ze{construct(){super.construct(...arguments),this.scheduler.ion({presetchange:this.onClientPresetChange,thisObj:this})}get scheduler(){return this.client||this.up(e=>e.isTimelineBase)||N.query(e=>e.isTimelineBase)}changeValue(e,t){return this.getConfig("presets"),super.changeValue(e,t)}updatePresets(e){this.store=this.scheduler.presets.chain(t=>e.includes(t.id)),this.store.sort((t,i)=>e.indexOf(t.id)-e.indexOf(i.id))}onClientPresetChange({preset:e}){const t=this;t._isSelecting||(t.isSettingValue=!0,t.store.includes(e.id)?t.value=e:t.clear(),t.isSettingValue=!1)}onSelect({record:e}){if(!this.isSettingValue){const{scheduler:i}=this,{mainUnit:r,start:n,defaultSpan:s}=e;if(i.suspendRefresh(),this._isSelecting=!0,i.viewPreset=e,this._isSelecting=!1,r&&s){let a=r;if(n&&typeof n=="string"){var t;a=(t=b.parseTimeUnit(n))!==null&&t!==void 0?t:n}let o=b.startOf(i.startDate,a);e.start&&typeof n=="number"&&(o=b.add(o,n,r));const l=b.add(o,s,r);i.setTimeSpan(o,l)}i.scrollLeft=0,i.resumeRefresh(!0)}}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue()}}M(bs,"$name","ViewPresetCombo");M(bs,"type","viewpresetcombo");M(bs,"configurable",{presets:["hourAndDay","weekAndDay","dayAndMonth"],client:null,editable:!1,valueField:"id",displayField:"name",placeholder:"Select view"});bs.initClass();bs._$name="ViewPresetCombo";class Qd extends ge{static get type(){return"agendacolumn"}static get defaults(){return{id:"agenda",text:"Agenda",filterable:!1,sortable:!1,editor:!1,searchable:!1,autoHeight:!1,alwaysClearCell:!1}}construct(){super.construct(...arguments),this.grid.ion({beforeResponsiveStateChange:"onBeforeGridResponsiveStateChange",thisObj:this})}defaultRenderer({cellElement:e,record:t,grid:i,size:r}){var n;const s=this,{events:a,date:o}=t,l=[];for(let d=0;d<a.length;d++){const u=a[d],h=u.endDate||b.add(u.startDate,u.duration,u.durationUnit),f=u.startDate<o,g=h>t.tomorrow,m=i.createEventDomConfig({date:t.date,isAllDay:u.allDay||g||f,eventRecord:u});m.className["b-continues-future"]=g,m.className["b-continues-past"]=f,l.push({className:{"b-cal-agenda-event-row":1},dataset:{rowId:u.id},children:[i.eventListEventTimeRenderer(u,o),m],syncOptions:{syncIdField:"rowId",releaseThreshold:0,strict:!0}})}if((n=i._cellRenderer)===null||n===void 0||n.call(i,...arguments),e.classList[t.isNonWorking?"add":"remove"](i.nonWorkingDayCls),Z.sync({domConfig:{onlyChildren:!0,children:[i.agendaEventDateRenderer(o),{className:{"b-cal-event-bar-container":1},children:l}],syncOptions:{syncIdField:"date",releaseThreshold:0,strict:!0}},targetElement:e}),e.dataset.date=t.id,!s.autoHeight){const d=e.querySelector(".b-cal-agenda-date"),u=s._cellTbPadding!=null?s._cellTbPadding:s._cellTbPadding=S.getEdgeSize(e,"padding","tb").height,h=s._containerPadding!=null?s._containerPadding:s._containerPadding=S.getEdgeSize(e.querySelector(".b-cal-event-bar-container"),"margin","tb").height,f=s._dateBlockHeight!=null?s._dateBlockHeight:s._dateBlockHeight=$.outer(d).height;r.height=Math.max(t.events.length*(i.eventHeightInPixels+i.eventRowSpacing)-i.eventRowSpacing+u+h+(i.responsiveState==="small"?f:0),86)}}onBeforeGridResponsiveStateChange(){this._cellTbPadding=this._containerPadding=this._dateBlockHeight=this._dateBlockHeight=null}getCellClass(e){const t=super.getCellClass(e);return t["b-sticky-cell"]=t[`b-day-of-week-${e.record.day}`]=1,t}headerRenderer({headerElement:e}){e.innerHTML="",Z.sync({domConfig:{className:{"b-cal-agenda-header":1,"b-grid-header":1,"b-last-leaf":1},children:[{className:{"b-cal-agenda-header-date":1},text:"Date"},{className:{"b-cal-agenda-header-time":1},text:"Time"},{className:{"b-cal-agenda-header-event":1},text:"Event"}]},targetElement:e})}}M(Qd,"$name","AgendaColumn");be.registerColumnType(Qd);Qd._$name="AgendaColumn";class ec extends ge{static get type(){return"calendarevents"}static get defaults(){return{id:"calendarevents",text:"Event Details",filterable:!1,sortable:!1,editor:!1,searchable:!1,autoHeight:!0,alwaysClearCell:!1}}renderer({cellElement:e,record:t,grid:i}){var r,n;const s=(r=i.calendar)===null||r===void 0?void 0:r.widgetMap.resourceFilter,a=s?t.resources.filter(o=>s.selected.includes(o)):t.resources;(n=i._cellRenderer)===null||n===void 0||n.call(i,...arguments),i.showResourceAvatars=!0,Z.sync({domConfig:{onlyChildren:!0,children:[{class:"b-cal-event-resource-avatars",children:a.map(o=>({class:"b-cal-event-resource-avatar-row",children:[i.getResourceAvatar(o),{class:"b-cal-event-resource-avatar-desc",children:[{class:"b-event-column-resource-name",text:o.name},{class:"b-event-column-resource-role",text:o.role}]}]}))},{class:"b-cal-event-column-event-desc",children:[{class:"b-cal-event-column-event-name",text:t.name}]},{class:"b-cal-event-column-times",children:[i.eventListEventTimeRenderer(t)]}],syncOptions:{syncIdField:"date",releaseThreshold:0,strict:!0}},targetElement:e})}}be.registerColumnType(ec);ec.exposeProperties();ec._$name="EventColumn";class nr extends Ct{afterConstruct(){this.endDate||(this.endDate=this.startDate)}}M(nr,"fields",[{name:"alignment",defaultValue:"start",internal:!0},{name:"color",internal:!0},{name:"footer",internal:!0},{name:"rotation",internal:!0}]);nr._$name="TimeRangeModel";class Cs extends se{}M(Cs,"$name","TimeRangeStore");M(Cs,"defaultConfig",{modelClass:nr});Cs.initClass();Cs._$name="TimeRangeStore";class oi extends ir{}M(oi,"$name","ProjectModel");M(oi,"configurable",{timeRangeStore:{modelClass:nr}});M(oi,"defaultConfig",{timeRangeModelClass:nr,timeRangeStoreClass:Cs});oi.applyConfigs=!0;oi.initClass();oi._$name="ProjectModel";class ws extends Fr{buildProjectConfig(){const e=super.buildProjectConfig(),{timeRangeStore:t}=this;return t&&(e.timeRangeStore=t),e}get timeRangeStore(){return super.timeRangeStore}set timeRangeStore(e){var t;e&&T.isObject(e)&&(e=T.assign({modelClass:this.timeRangeClass},e)),this.setFeaturedStore("_timeRangeStore",e,(t=this.project)===null||t===void 0?void 0:t.timeRangeStoreClass)}}M(ws,"$name","CrudManager");M(ws,"configurable",{projectClass:oi,timeRangeClass:nr});ws.initClass();ws._$name="CrudManager";class dt extends te.mixin(ai){static get factoryable(){return{}}static get configurable(){return{clientListeners:{paint:"onCalendarPaint"},disableOnReadOnly:null,zoneTypes:null}}getViewZoneType(e){const{zoneTypes:t}=this;let i;return t&&(i=t[e.type])===void 0&&(e.isWeekView&&t.week!==void 0?i=t.week:e.isDayView?i=t.day:e.isMonthView?i=t.month:e.isYearView?i=t.year:e.isResourceView?i=t.resource:e.isAgendaView&&(i=t.agenda)),i}updateDisableOnReadOnly(e){const t=this,{client:i}=t,r="readonlyToggle",n="onClientReadOnlyToggle";e?(t[n]({readOnly:i.readOnly}),i.ion({name:r,readOnly:n,thisObj:t})):t.detachListeners(r)}doDestroy(){this.syncModes(),super.doDestroy()}createZone(e,t){return new e(F({owner:this},t))}onClientReadOnlyToggle({readOnly:e}){this.disabled=e}updateDisabled(e,t){super.updateDisabled(e,t),this.client.isPainted&&this.syncModes()}onCalendarPaint({firstPaint:e}){e&&this.syncModes()}syncModes(){const e=this,{client:t,_modeDetacher:i,zones:r}=e;let n=null,s,a,o,l,d;if(e.disabled||e.isDestroying||!e.zoneTypes)i?.();else{t.isCalendar?(i||(e._modeDetacher=t.ion({addMode:()=>e.syncModes()})),s=t.modes):s={view:t};for(a in s)if(d=r?.[a],o=s[a],l=e.getViewZoneType(o),l){var u;(T.isObject(d)?d.type:(u=d)===null||u===void 0?void 0:u.constructor)===l?delete r[a]:o.isPainted?d=e.createZone(l,{view:o}):d=e.whenPainted(a,o,l),(n||(n={}))[a]=d}}if(e.zones=n,r)for(a in r)r[a].destroy()}whenPainted(e,t,i){const r=this,n={type:i,destroy:t.ion({once:!0,prio:1e4,paint(){r.zones[e]===n&&(r.zones[e]=r.createZone(i,{view:t}))}})};return n}}dt._$name="CalendarFeature";class tn extends P{updateView(e){const t=this,i=e&&t.viewListeners;t.detachListeners("viewListeners"),i&&e?.ion(T.merge({thisObj:t,name:"viewListeners"},i))}}M(tn,"$name","CalendarZone");M(tn,"configurable",{owner:null,view:{$config:"nullify",value:null},viewListeners:null});tn.initClass();tn._$name="CalendarZone";const QE=c=>c.eventStore;class tc extends ce{constructor(...e){super(...e),M(this,"clockTemplate",new rr({}))}static get $name(){return"EventTip"}static get type(){return"eventtip"}static get configurable(){return{align:{monitorResize:!0},dateFormat:"ll",eventRecord:{$config:"nullify",value:null},recurrenceHint:"",timeFormat:"LST",axisLock:"flexible",closable:null,forSelector:".b-cal-event-wrap",maxWidth:"30em",minWidth:"14em",scrollAction:"realign",cls:{"b-sch-event-tooltip":1},tools:{edit:{cls:"b-icon-edit",handler:"up.onEditClick",tooltip:"L{EventEdit.Edit event}",weight:100},delete:{cls:"b-icon-trash",handler:"up.onDeleteClick",tooltip:"L{SchedulerBase.Delete event}",weight:0},maximize:null},titleRenderer:e=>z.encodeHtml(e.name),extendAllDayEndDay:null,activeClient:null}}static get delayable(){return{refreshContent:20}}get owner(){return ce.fromElement(this.activeTarget)||this.ownerFeature.client}onEditClick(){this.trigger("edit")}onDeleteClick(){this.trigger("delete")}getHtml(e){const t=this,{eventRecord:i}=t;if(i)return e.eventRecord=i,t.title=t.titleRenderer?t.callback(t.titleRenderer,t,[i]):"",t.callback(t.renderer||t.internalRenderer,t,[F(F({},e),{},{eventRecord:i})])}internalRenderer({eventRecord:e}){const{clockTemplate:t,dateFormat:i,recurrenceHint:r,timeFormat:n}=this,{allDay:s,endDate:a,startDate:o,recurrence:l}=e,d=s?this.extendAllDayEndDay?b.ceil(a,"1 day"):b.add(a,-1,"day"):a,u=b.clearTime(o),h=b.clearTime(d),f=u<h,g=!s&&u<o||h<d,m=g?f?`${i} ${n}`:n:i,p=l?Hd.getLegend(l):r,v=b.formatDelta(b.diff(o,a),s?{precision:"d"}:null),y=e.isMilestone||s&&!f;return t.mode=f?"day":"hour",t.template({date:o,text:b.format(o,m),cls:"b-sch-tooltip-startdate"})+(y?"":t.template({date:d,text:b.format(d,m),cls:"b-sch-tooltip-enddate"}))+(e.isMilestone?"":`<div class="b-cal-tooltip-duration b-icon b-icon-duration">${v}</div>`)+(p?`<div class="b-cal-tooltip-recurrence b-icon b-icon-recurring">${p}</div>`:"")}showByEvent(e,t=e.target){const i=this;return i.activeTarget=t,i.pointerEvent=e,i.updateContent(),e.type==="contextmenu"?i.showBy({position:{x:e.clientX,y:e.clientY},anchor:!1}):i.showBy(t)}afterShowByTarget(){var e;const{delete:t}=this.tools;this.activeClient=(e=ce.fromElement(this.activeTarget))===null||e===void 0?void 0:e.closest(QE),super.afterShowByTarget(),t&&(t.disabled=this.ownerFeature.client.readOnly)}afterHide(){super.afterHide(...arguments),this.activeClient=null}updateActiveTarget(e,t){super.updateActiveTarget(...arguments),t?.classList.remove("b-cal-event-reveal"),e!=null&&e.classList.contains("b-cal-in-cluster")&&e.classList.add("b-cal-event-reveal")}refreshContent(){this.updateContent()}updateEventRecord(e){var t;const i=this;(t=i._changeHook)===null||t===void 0||t.call(i),i._changeHook=e&&ve.after(e,"afterChange",i.refreshContent,i),e&&(i.tools.delete&&(i.tools.delete.hidden=e.readOnly),i.tools.edit&&(i.tools.edit.hidden=e.readOnly),i.updateContent())}updateContent(){const{clockTemplate:e,element:t,eventRecord:i}=this,r=super.updateContent(),n=t.querySelector(".b-sch-tooltip-startdate"),s=t.querySelector(".b-sch-tooltip-enddate"),{edit:a,delete:o}=this.tools,{client:l}=this.ownerFeature,{eventEdit:d}=l.features,u=l.readOnly||i.readOnly;return n&&e.updateDateIndicator(n,i.startDate),s&&e.updateDateIndicator(s,i.endDate),a&&(a.hidden=u||!(d!=null&&d.enabled)),o&&(o.hidden=u),r}updateActiveClient(e){this.detachListeners("clientOverflowChange"),e&&e.ion({name:"clientOverflowChange",eventsPerCellChange:"onClientOverflowChange",thisObj:this})}onClientOverflowChange(){S.isVisible(this.lastAlignSpec.target)||this.hide()}onDocumentMouseDown({event:e}){if(!(!e.button&&this.ownerFeature.showOn==="click"&&this.activeTarget.contains(e.target)))return super.onDocumentMouseDown(...arguments)}}tc.initClass();tc._$name="EventTip";const ex="b-cal-tentative-event",tx=1e3,xf=60*tx,ix="YYYY-MM-DD",rx=/^b-hover-(top|right|bottom|left)$/,Mt=Symbol("eventDragMode"),Wp=(c,e)=>{let t;return c.className==="b-cal-event-body"?c.children.push(t=e):Array.isArray(c.children)&&c.children.forEach(i=>{!t&&i&&(t=Wp(i,e))}),t},kl=c=>Object.freeze({type:c,create:!1,move:!1,resize:!1,[c]:!0}),fa={create:{finisher:"finishDropCreate",mode:kl("create"),validatorFn:"validateCreateFn"},move:{finisher:"finishDropMove",mode:kl("move"),validatorFn:"validateMoveFn"},resize:{finisher:"finishDropResize",mode:kl("resize"),validatorFn:"validateResizeFn"}},nx={calendarrow:!0,monthview:!0};class Ss extends tn.mixin(Oa,Bg,Jw){static get $name(){return"Zone"}static get configurable(){return{droppableSelector:"*",droppable:!0,hoverable:null,hoverAnimationCls:"b-hover-anim",days:{$config:{equal:"array"},value:null},dragProxy:{type:"tip",tooltip:null},eventRecord:null,hit:null,dragItemSelector:".b-cal-event-wrap",overflow:{$config:"nullify",value:null},rootElement:null}}get dayTime(){var e;return(e=this.view)===null||e===void 0?void 0:e.dayTime}clearTime(e){return this.dayTime.startOfDay(e)}findRootElement(e){return e.contentElement}getDateFromPosition(e,t){return this.view.getDateFromPosition(e,t)}get dragEventer(){return this.owner}beforeDrag(e){const t=this,{owner:i}=t,r=t.hitTest(e),n=r?.eventRecord,s=t.view.rtl?"right":"left";if(!r||n!=null&&n.readOnly||n!=null&&n.isCreating)return!1;r.date&&e.set("date",r.date);let a,o;switch(r.type){case"event":e.set("eventRecord",n),e.set("eventSourceHit",r),e.set("eventInset",r.eventElement.style[s]),e.set("eventWidth",r.eventElement.offsetWidth),a="move",o=!i.draggable||!n.isDraggable,o||t.captureDragOffset(n,r,e);break;case"resize":e.set("eventRecord",n),e.set("eventSourceHit",r),e.set("eventInset",r.eventWrap.style[s]),e.set("eventWidth",r.eventWrap.offsetWidth),a="resize",o=!i.resizable||!n.resizable;break;case"schedule":case"dayNumber":e.set("eventCreate",r),a="create",o=!i.creatable;break;default:return!1}if(o)return!1;e.set("eventDragMode",e[Mt]=fa[a].mode)}dragStart(){var e;const t=this,{dragging:i,owner:r,view:n}=t,{client:s}=r,a=()=>{i.lastMoveEvent&&i.move(i.lastMoveEvent)},o={scrollables:s.scrollManager?[{element:s.viewContainer.element,callback:a}]:[]};if((t.isResizing||t.isMoving)&&(t.refocus=r.client.captureFocus()),t.isResizing){var l;(l=i.itemElement)===null||l===void 0||l.classList.add("b-resizing")}n.scrollable&&o.scrollables.push({element:n.scrollable.element,callback:a}),n.horizontalScroller&&o.scrollables.push({element:n.horizontalScroller.element,callback:a}),(e=s.scrollManager)===null||e===void 0||e.startMonitoring(o)}captureDragOffset(){}cleanupDrag(){var e;const t=this,{dragProxy:i,dragging:r}=t,{tooltip:n}=i,s=t.view.isOverflowPopup?t.view.owner:t.view;r==null||(e=r.itemElement)===null||e===void 0||e.classList.remove("b-resizing"),s.ion({refresh(){var a;(a=t.refocus)===null||a===void 0||a.call(t,!1,!0),t.refocus=null},once:!0}),t.days=null,n&&(n.hide(),i.tooltip=null)}dragEnd(){var e,t;(e=this.owner.client)===null||e===void 0||(t=e.scrollManager)===null||t===void 0||t.stopMonitoring(),this.cleanupDrag()}makeDays(e,t){const{dayTime:i,startDate:r,endDate:n}=this.view,s=[];e=b.constrain(e,r,n),t=b.constrain(t,r,n);let a=i.startOfDay(e);for(const o=i.ceil(t);a<o;a=b.add(a,1,"day"))s.push(i.dateKey(a));return s}onShowOverflowPopup({overflowPopup:e}){this.overflow||(this.overflow=new lx({owner:this.owner,view:e}))}get calendarCellSelector(){const{hideNonWorkingDays:e}=this.view;return`${this.view.visibleCellSelector}${e?":not(.b-nonworking-day)":""}`}get calendarCells(){const e=this.dropRootElement;return e&&S.children(e,this.calendarCellSelector)}get isCreating(){var e,t;return(e=this.dropping)===null||e===void 0||(t=e[Mt])===null||t===void 0?void 0:t.create}get isMoving(){var e,t,i;const r=((e=this.dropping)===null||e===void 0?void 0:e[Mt])||((t=this.dragging)===null||t===void 0?void 0:t[Mt]);return r?r.move:Boolean((i=this.dropping)===null||i===void 0?void 0:i.peek("eventRecord"))}get isResizing(){var e,t;return(e=this.dragging)===null||e===void 0||(t=e[Mt])===null||t===void 0?void 0:t.resize}get recurrable(){return this.isDayZone||this.isMonthZone}cleanupDrop(){this.eventRecord=this.eventDom=this.days=null,this.noTip=!1}createEvent(e){var t;const i=((t=this.dropping)===null||t===void 0?void 0:t[Mt])||fa.create;this.setupEvent(e,i.create)}async dragDrop(e){if(this.isResizing||e.target===this)return e.finalizer=this.finishDrop(e)}dragEnter(e){const t=this,i=e[Mt];if(t.isMoving)t.startMove(e.peek("eventRecord"));else{if(!i||e.source!==t)return!1;if(i.resize)t.startResize(e.peek("eventSourceHit"));else if(i.create)t.startCreate(e.peek("date"),e.peek("eventCreate"));else return!1}}dragLeave(){this.isResizing||this.cleanupDrop()}dragMove(e){this.hit=this.pickDropTarget(e)}dropHitMove(e,t,i){const r=this,{endDate:n,startDate:s}=i.isScheduled?i:r.eventRecord,a=b.diff(s,n,"s");let{date:o}=t;o=r.clearTime(o),i.allDay||(o=b.add(o,b.diff(r.clearTime(s),s,"s"),"s")),o=r.applyDragOffset(o,e),r.setEventData({startDate:o,endDate:b.add(o,a,"s")})}dropHitNowhere(){this.days=null}dropHitResize(e,t,i){const r=this,{eventRecord:n}=r,{startDate:s,endDate:a}=n,o=r.clearTime(t.date);let l,d;i.atEnd?(d=b.add(o,1,"d"),l={startDate:s,endDate:s<d?d:b.add(s,1,"d")}):l={startDate:o<a?o:b.add(a,-1,"d"),endDate:a},l.duration=b.diff(l.startDate,l.endDate,n.durationUnit),r.setEventData(l)}async finishDrop(e){const t=this,{eventRecord:i,owner:r,view:n}=t,{eventStore:s}=n,a=e[Mt],o=fa[a?.type||"move"];if(o&&t.hit){const l=o.validatorFn?await r.callback(r[o.validatorFn],r,[{drag:e,eventRecord:i,event:e.event}]):!0;l!==!1&&await t[o.finisher](e,r,i,s,l,async d=>{let u={drag:e,eventRecord:i,validation:l,event:e.event,feature:r,view:e[t.isResizing?"source":"target"].view};return await r.client.trigger("before"+z.capitalize(d),u)===!1?u=!1:r.client.trigger(d,u),u})}t.cleanupDrop()}async finishDropCreate(e,t,i,r,n,s){const a=n?.add!==!1;await s("dragCreateEnd")===!1?a&&r.remove(i):a&&!r.includes(i)&&r.add(i)}async finishDropMove(e,t,i,r,n,s){let a=await e.get("eventRecord");const o=this,{view:l}=o,d=a.isOccurrence?a.recurringTimeSpan:a,{source:u}=e,h=u!==o,f=h&&u.resource!==o.resource;if(!(!f&&e.source===e.target&&b.isEqual(i.startDate,a.startDate)&&b.isEqual(i.endDate,a.endDate)&&a.eventStore===r||await s("dragMoveEnd")===!1))if(r.getByInternalId(d.internalId)){if(a=await o.finishDropConfirm(a),a&&(await o.moveEventTo(e,a),f&&(a.assign(o.resource),a.unassign(u.resource)),h&&o.owner.client.activeView.eachView)){var v;l.refresh(),(v=l.getEventElement(a,a.startDate))===null||v===void 0||v.focus()}}else{var m,p;const y=await e.get("sourceStore");y?(y.remove(a),await o.moveEventTo(e,a)):a=i;const C=(m=(p=a.resourceId)!==null&&p!==void 0?p:o.resource)!==null&&m!==void 0?m:this.owner.client.defaultCalendarId;delete a.resourceId,r.add(a),a.assign(f?o.resource:C)}}async finishDropResize(e,t,i,r,n,s){if(await s("dragResizeEnd")===!1)return;let{eventRecord:o}=await e.get("eventSourceHit");o=await this.finishDropConfirm(o),o&&o.set({startDate:i.startDate,endDate:i.endDate,duration:b.diff(i.startDate,i.endDate,o.durationUnit)})}async finishDropConfirm(e){return e.isOccurrence||e.isRecurring?new Promise(t=>{new Wd({owner:this.owner}).confirm({actionType:"update",eventRecord:e,cancelFn(){t(null)},changerFn(r){t(r)}})}):e}async moveEventTo(e,t){const i=this;let r=i.view.getDateFromElement(e.targetElement);if(t.startDate&&(r=b.copyTimeValues(i.clearTime(r),t.startDate)),r=i.applyDragOffset(r,e),!i.view.eventStore.getByInternalId(t.internalId)&&!t.startDate){const n=e.target.view.autoCreate||i.owner.client.autoCreate;r.setHours(n?.startHour||8)}await i.setStartDate(t,r)}pickDropTarget(e){var t;const i=this;let r=i.hitTest(e);return!r&&i.isResizing&&(r=i.hit),(t=r)!==null&&t!==void 0&&t.date?r:null}setStartDate(e,t){return e.set({startDate:t,endDate:b.add(t,this.eventRecord.duration,this.eventRecord.durationUnit)})}getHoverHandleCls(e){return e?"":"b-gripper-vert"}hoverEnter(){var e,t;const i=this,r=i.hitTest(i.hoverTarget),{gripper:n}=i.owner,s=i.getHoverHandleCls(),a=i.getHoverHandleCls(!0);a&&n.classList.remove(a),(r==null||(e=r.eventRecord)===null||e===void 0?void 0:e.resizable)!==!1&&!(r!=null&&(t=r.eventRecord)!==null&&t!==void 0&&t.readOnly)&&(s&&n.classList.add(s),i.hoverTarget.appendChild(n))}hoverLeave(e){const t=this,{gripper:i}=t.owner,r=t.getHoverHandleCls();i.parentNode===e&&(r&&i.classList.remove(r),e.removeChild(i))}applyDragOffset(e,t){const i=t.peek("eventOffset");if(e&&i!==null&&i!==void 0&&i[0]){var r;t.source.constructor===((r=t.target)===null||r===void 0?void 0:r.constructor)&&(e=b.add(e,-i[0],i[1]))}return e}hitTest(e){const t=this,i=e?.isDragContext,r=i?e.event:e,n=i&&e.targetElement||S.getEventElement(r);let s=t.view,a=null,o,l;if(n){s.calendarHitTest||(s=t.owner.client);const d=s.rtl?"right":"left";a=s.calendarHitTest(n),a&&(a.eventWrap=l=n.closest(".b-cal-event-wrap"),n.classList.contains("b-gripper")?(a={type:"resize",cell:a.cell,date:a.date,edge:o={},eventRecord:a.eventRecord,eventWrap:l,gripper:n,view:a.view},Q.normalize(l.className,"array").forEach(u=>{u=rx.exec(u),u&&(o[u[1]]=!0)}),a.atEnd=!(o.top||o[d])):a.eventRecord||(l=null),l&&(a.eventTop=l.style.top),n!==r&&(a.date=t.getDateFromPosition(r.clientX,r.clientY)||a.date))}return a}renderEvent(e,t,i){const{view:r}=this;Object.defineProperty(e,"resource",{configurable:!0,get:()=>r.defaultCalendar});const n=r.createEventDomConfig({eventRecord:e,isAllDay:nx[r.type]});if(n.className["b-cal-tentative-event"]=1,n.className["b-cal-tentative-event-first"]=t,n.className["b-cal-tentative-event-last"]=i,delete e.resource,i){const{footer:s}=this.owner;s&&Wp(n,T.assign({html:b.format(e.endDate,r.timeFormat)},s))}return n}setEventData(e,t){const i=this,{eventRecord:r,view:n}=i,{duration:s,startDate:a}=e;if(a&&s!=null&&!e.endDate&&(e=F(F({},e),{},{endDate:b.add(a,s,r.durationUnit)})),r.set(e),i.eventDom)i.eventDom.className[n.shortEventCls]=r.durationMS<=n.shortEventDuration;else{if(t){let{newName:o}=i.owner;typeof o=="function"&&(o=o(r)),r.set("name",o)}i.eventDom=i.renderEvent(r)}}setupEvent(e,t){var i;const r=this,{owner:n}=r,{defaultCalendar:s,eventStore:a}=r.view,{tooltip:o}=n,l=r.eventRecord=n.eventRecord=a.createRecord({}),d=t?new Set([new a.assignmentStore.modelClass({event:l,resource:s})]):e.assigned;Object.defineProperty(l,"assigned",{configurable:!0,get:()=>d}),r.setEventData(e,t),delete l.assigned,r.isCreating&&s&&a.assignmentStore.assignEventToResource(l,s);const{eventDom:u}=r;return u.className[ex]=1,!r.noTip&&!o.disabled&&(i=r.dragging)!==null&&i!==void 0&&i.has("eventCreate")&&(o.eventRecord=l,o.recurrenceHint=t&&r.recurrable?n.recurrenceTip:"",r.dragProxy.tooltip=o),u}startCreate(e){this.createEvent({allDay:!0,startDate:e,endDate:b.add(e,1,"d")})}startMove(e){var t;const i=this,r=T.clone(e.data),n=(t=e.resource)===null||t===void 0?void 0:t.eventColor;if(!r.eventColor&&n&&(r.eventColor=n),r.assigned=e.assigned,!r.startDate){const a=i.pickDropTarget(i.dropping);r.startDate=a?.date||new Date,r.endDate=b.add(r.startDate,e.duration||1,e.durationUnit||"h")}if(!r.resourceId){var s;r.resourceId=i.dropping.peek("resourceId")||((s=i.owner.client)===null||s===void 0?void 0:s.defaultCalendarId)}delete r.id,i.setupEvent(r)}startResize(e){var t;const{eventRecord:i}=e,r=i.data;this.createEvent(F(F({},r),{},{id:`dragResize-event-${r.id}`,eventColor:r.eventColor||((t=i.resource)===null||t===void 0?void 0:t.eventColor),recurrenceRule:null,realEventId:r.id}))}configureListeners(e){const t=super.configureListeners(e);return t.element=this.view.rootElement,t}updateHit(e){const t=this,i=t.dropping,r=e&&i[Mt];e?t.isMoving?t.dropHitMove(i,e,i.peek("eventRecord")):r!=null&&r.create?t.dropHitCreate(i,e,i.peek("eventCreate")):r!=null&&r.resize&&t.dropHitResize(i,e,i.peek("eventSourceHit")):t.dropHitNowhere(i)}updateDays(e){const t=this,{calendarCells:i,eventDom:r,dayValues:n}=t,s=i&&{};let a=!0,o,l,d,u,h;if(t.dayValues=s,i&&r){for(u=0;u<i.length;++u)o=i[u],e!=null&&e.includes(o.dataset.date)&&(h=o);for(u=0;u<i.length;++u)o=i[u],l=o.dataset.date,e!=null&&e.includes(l)&&((d=n?.[l])?delete n[l]:(d=t.includeDay(l,o,a,o===h)||!0,a=!1),s[l]=d);if(n)for(u in n)t.removeDay(u,n[u])}}updateEventRecord(e){this.owner.eventRecord=e}updateOverflow(e,t){return!e&&t&&t.destroy(),e}updateOwner(e){this.hoverIgnoreElement=e?.gripper}updateRootElement(e){const t=this;t.dragRootElement=e,t.dropRootElement=t.droppable?e:null,t.hoverRootElement=t.hoverable?e:null}updateView(e,t){var i;super.updateView(e,t);const r=this;r.rootElement=e?r.findRootElement(e):null,(i=r._overflowDetacher)===null||i===void 0||i.call(r),e!=null&&e.isDayCellRenderer&&(r._overflowDetacher=e.ion({thisObj:r,showOverflowPopup:"onShowOverflowPopup"}))}}Ss.prototype._eventRecord=null;class Up extends Ss{static get $name(){return"BaseDayZone"}static get configurable(){return{hoverSelector:".b-cal-event-wrap",draggingClsSelector:".b-dayview-content"}}getHoverHandleCls(e){let t=this.isAllDayZone;return e&&(t=!t),`b-gripper-${t?"vert":"horz"}`}}class sx extends Up{static get $name(){return"AllDayZone"}static get configurable(){return{hoverEdges:"lr"}}beforeDrag(e){const t=super.beforeDrag(e);return t!==!1&&!this.draggable&&e[Mt].move?!1:t}dragEnter(e){return this.view.eventsPerCell||this.view.expandGutter(),super.dragEnter(e)}dragLeave(e){this.view.collapseGutter(),super.dragLeave(e)}captureDragOffset(e,t,i){i.set("eventOffset",[Math.max(Math.floor(b.diff(e.startDate,t.date,"d")),0),"d"])}dropHitCreate(e,t,i){let r=this.clearTime(t.date),n=this.clearTime(i.date);r<n&&([n,r]=[r,n]),this.setEventData({startDate:n,duration:b.diff(n,r,"d")+1,durationUnit:"d"})}async moveEventTo(e,t){const i=this,r=i.hitTest(e),n=i.applyDragOffset(r?.date,e),s=new Date(t.startDate);n&&(s.setFullYear(n.getFullYear()),s.setMonth(n.getMonth()),s.setDate(n.getDate()),i.view.dayTime.startShift?(s.setHours(n.getHours()),s.setMinutes(n.getMinutes()),s.setSeconds(n.getSeconds()),t.duration=1):i.view.isAllDayEvent(t)||(t.allDay=!0),await i.setStartDate(t,s))}setEventData(e,t){super.setEventData(e,t);const i=this,{eventRecord:r}=i,{startDate:n,endDate:s}=r;t&&!i.view.dayTime.startShift&&(r.allDay=!0),i.days=i.makeDays(n,s)}updateDays(e){const t=this;let{eventEl:i}=t;if(e!=null&&e.length){var r,n;i||(t.eventEl=i=S.createElement(F({},t.eventDom)),i.classList.add("b-allday"));const{dropRootElement:s}=t,{hideNonWorkingDays:a,visibleCellSelector:o,weekLength:l}=t.view,d=(r=t.dragging)===null||r===void 0||(n=r.peek("eventSourceHit"))===null||n===void 0?void 0:n.eventTop,u=S.children(s,`${o}${a?":not(.b-nonworking-day)":""}`),h=S.down(s,`${o}${a?":not(.b-nonworking-day)":""}[data-date='${e[e.length-1]}']`);S.down(h,".b-cal-event-bar-container").appendChild(i),i.style[t.view.rtl?"right":"left"]=S.percentify(100*(u.indexOf(h)-e.length+1)/l),i.style.width=S.percentify(100*e.length/l),d&&(i.style.top=d),t.view.scrollable.scrollIntoView(i,!0)}else i&&(i.classList.contains("b-cal-tentative-event")&&i.remove(),t.eventEl=null)}updateView(e,t){if(e){const i=b.diff(e.startDate,e.endDate,"d")>1;this.hoverable=this.draggable=i}super.updateView(e,t)}}class ax extends Up{static get $name(){return"DayZone"}static get configurable(){return{dragEventId:null,hoverable:!0,hoverEdges:"tb",times:{$config:{equal:"array"},value:null}}}construct(...e){const t=this;super.construct(...e),t.allDayZone=new sx({active:t.active,owner:t.owner,view:t.view.allDayEvents,resource:t.resource})}syncDraggingElements(e,t){const{dragging:i}=this,{draggingItemCls:r}=i.source,n=i.itemElement.closest(".b-dayview-day-container"),s=n.querySelectorAll(`[data-event-id="${e}"]`);for(const a of s)a.classList.toggle(r,t)}updateDragEventId(e,t){t&&this.syncDraggingElements(t,!1),e&&this.syncDraggingElements(e,!0)}get eventRecord(){var e;return super.eventRecord||((e=this.allDayZone)===null||e===void 0?void 0:e.eventRecord)}set eventRecord(e){super.eventRecord=e}get recurring(){var e;return this.isCreating&&((e=this.eventRecord)===null||e===void 0?void 0:e.recurrenceRule)!=null}get droppingAllDay(){var e,t;const i=(e=this.dropping)===null||e===void 0?void 0:e.peek("eventRecord");return i?.startDate&&((t=this.view)===null||t===void 0?void 0:t.isAllDayEvent(i))||!1}get useAllDay(){return this.droppingAllDay&&this.view.showAllDayHeader&&this.dropping.source!==this.allDayZone}get wasAllDay(){return this.droppingAllDay&&this.dropping.source===this.allDayZone}doDestroy(){var e;(e=this.allDayZone)===null||e===void 0||e.destroy(),super.doDestroy()}dragStart(){var e,t;super.dragStart(),this.dragEventId=(e=(t=this.dragging.peek("eventRecord"))===null||t===void 0?void 0:t.id)!==null&&e!==void 0?e:null}findRootElement(e){return e.eventContentElement}captureDragOffset(e,t,i){i.set("eventOffset",[Math.floor(b.diff(e.startDate,t.date,"m")),"m"])}cleanupDrag(){var e;this.dragEventId=null,super.cleanupDrag(),(e=this.allDayZone)===null||e===void 0||e.cleanupDrag()}cleanupDrop(){var e,t,i;super.cleanupDrop(),(e=this.owner.client)===null||e===void 0||(t=e.scrollManager)===null||t===void 0||t.stopMonitoring(),(i=this.allDayZone)===null||i===void 0||i.cleanupDrop()}dropHitCreate(e,t){const i=this,r=e.peek("eventCreate");let n=t.date,s=r.date,a=n,o=s,l,d;const u=!(i.clearTime(s)-i.clearTime(n)),h=e.ctrlKey&&!u;h||u?(a=i.clearTime(n),o=i.clearTime(s),s=s-o,n=n-a,a<o&&([o,a]=[a,o]),n<s&&([s,n]=[n,s]),o.setTime(o.getTime()+s),l=Math.max(i.view.increment,Math.floor(n-s))/xf,h&&(d=b.diff(i.clearTime(o),i.clearTime(a),"d")+1)):(a<o&&([o,a]=[a,o]),l=Math.floor((a-o)/xf)),i.setEventData({startDate:o,duration:l,recurrenceRule:h?`FREQ=DAILY;COUNT=${d}`:null})}dropHitMove(e,t,i){let r=t.date;const n=this,{view:s}=n,a=s.dayTime.startOfDay(r);n.useAllDay?n.allDayZone.dropHitMove(e,t,i):(i=n.eventRecord,r=n.applyDragOffset(r,e),s.showAllDayHeader&&r<a&&(r=a),n.setEventData({startDate:r,endDate:b.add(r,i.duration,i.durationUnit),duration:i.duration}))}dropHitResize(e,t,i){const r=this,{eventRecord:n}=r,s=t.date;i.atEnd?n.startDate<s&&r.setEventData({endDate:s}):s<n.endDate&&r.setEventData({startDate:s})}async moveEventTo(e,t){const i=this,r=i.hitTest(e),n=r?.date;n&&(i.useAllDay?await i.allDayZone.moveEventTo(e,t):(i.wasAllDay&&(t.allDay=!1),await i.setStartDate(t,i.applyDragOffset(n,e))))}startCreate(e){this.createEvent({duration:0,durationUnit:"m",startDate:e})}includeDay(e,t,i,r){return S.createElement(F({parent:t.querySelector(".b-dayview-event-container")},this.renderEvent(this.eventRecord,i,r)))}removeDay(e,t){t.classList.contains("b-cal-tentative-event")&&t.remove()}setEventData(e,t){const i=this;if(i.useAllDay){i.allDayZone.setEventData(e,t);return}super.setEventData(e,t);const{eventRecord:r}=i,{endDate:n,startDate:s}=r,{dayTime:a}=i.view;let o=n;i.recurring&&(o=b.add(o,r.recurrence.count-1,"d")),i.days=i.makeDays(s,o),i.times=[a.delta(s,"s"),a.delta(n,"s")]}setupEvent(e,t){const i=this;i.useAllDay?i.allDayZone.setupEvent(e,t):(this.wasAllDay&&(e.allDay=!1,e.endDate=b.add(e.startDate,e.duration=1,e.durationUnit="hour")),super.setupEvent(e,t))}updateDays(e,t){super.updateDays(e,t),this.updateTimes(this.times,null)}updateTimes(e){if(!e)return;const t=this,{allDayZone:i,dayValues:r,dragging:n,eventRecord:s,recurring:a,view:o}=t,{dayTime:l,eventSpacing:d}=o,u=o.rtl?"right":"left",{endDate:h,startDate:f}=s,[g,m]=e,p=!(n!=null&&n.aborted)&&n?.peek("eventInset"),v=!(n!=null&&n.aborted)&&n?.peek("eventWidth"),y=l.dateKey(f),C=l.dateKey(h),D=l.startOfDay(f)<l.startOfDay(h),w=100/l.duration("s");let{days:E}=t,R,x,k,I,A;if(!!E){for(R in r)x=R===y,I=r[R].style,A=g*w,k=(m-g)*w,Z.sync({targetElement:r[R],domConfig:t.renderEvent(t.eventRecord,x,R===E[E.length-1])}),!a&&D&&(x?k=100-A:R===C?k=A+k:k=100),I.top=a||x?S.percentify(A):0,I.height=S.percentify(k),I.paddingBottom=S.setLength(d),p&&(I[u]=p),v&&(I.width=`${v}px`);!E||E.length<2||a?(i?.cleanupDrop(),E=null):i&&o.showAllDayHeader&&(i.eventRecord||(i.noTip=!0,i.createEvent({startDate:s.startDate,endDate:s.endDate})),i.eventRecord.set({startDate:s.startDate,endDate:b.add(s.startDate,E.length-1,"d")}),i.days=E)}}}class ox extends Ss{static get $name(){return"MonthZone"}static get configurable(){return{coverage:{$config:{equal:T.isEqual},value:null},hoverable:!0,hoverEdges:"lr",hoverSelector:".b-cal-event-wrap.b-allday"}}findRootElement(e){return e.weeksElement}captureDragOffset(e,t,i){i.set("eventOffset",[Math.floor(b.diff(this.clearTime(e.startDate),t.date,"d")),"d"])}cleanupDrag(){super.cleanupDrag(),this.coverage=null}cleanupDrop(){var e,t;super.cleanupDrop(),(e=this.owner.client)===null||e===void 0||(t=e.scrollManager)===null||t===void 0||t.stopMonitoring(),this.coverage=null}dropHitCreate(e,t){const i=this,r=e.ctrlKey,n=e.peek("eventCreate");let s=null,a,o,l,d,u,h,f;d=i.clearTime(t.date),u=i.clearTime(n.date),o=n.dayNumber,l=t.dayNumber,h=n.weekOffset,f=t.weekOffset,f<h&&([h,f]=[f,h]),r?(a=f-h+1,s=a>1?`FREQ=WEEKLY;COUNT=${a}`:null,d<u?(u=d,o<l&&(u=b.add(u,o-l,"d"))):l<o&&(u=b.add(u,l-o,"d")),l<o&&([o,l]=[l,o])):d<u&&([u,d]=[d,u],[o,l]=[l,o]),i.setEventData({startDate:u,duration:(r?l-o:b.diff(u,d,"d"))+1,durationUnit:"d",recurrenceRule:s})}dropHitNowhere(e){super.dropHitNowhere(e),this.coverage=null}setEventData(e,t){super.setEventData(e,t);const{dropping:i,eventRecord:r,view:n}=this,{visibleCellSelector:s,hideNonWorkingDays:a}=n,o=S.children(n.weeksElement,"> .b-calendar-week"),l={},d=u=>{const{startDate:h,endDate:f}=u;for(let g,m,p,v,y=0;y<o.length;++y){for(g=S.children(o[y],`${s}${a?":not(.b-nonworking-day)":""}`),v=g.length,m="",p=0;p<v;++p){const C=n.getDateFromElement(g[p]),D=b.add(C,1,"d");h<D&&C<f&&(!p&&h<C&&(m="<"),m+=p,p===v-1&&D<f&&(m+=">"))}m&&(l[y]||(l[y]=[])).push(m)}};i!=null&&i.has("eventRecord")||!r.recurrence?d(r):r.recurrence.forEachOccurrence(n.startDate,n.endDate,d),this.coverage=l}updateCoverage(e){const t=this,{dragging:i,weekValues:r,view:n}=t,{rtl:s}=n,{visibleCellSelector:a,hideNonWorkingDays:o}=n,l=e&&i?.peek("eventSourceHit"),d=l?.eventTop,u={},h=n.getWeekElementFor(l?.eventElement),{weekElements:f}=n;let g,m,p,v,y,C,D,w,E,R,x;for(t.weekValues=u,E=0;E<f.length;++E)if(!!(v=e?.[E]))for(x=f[E],m=S.children(x,`${a}${o?":not(.b-nonworking-day)":""}`),R=0;R<v.length;++R){var k;(C=r==null||(k=r[E])===null||k===void 0?void 0:k.shift())||(C=S.createElement(t.eventDom)),(u[E]||(u[E]=[])).push(C),p=v[R],D=p.includes("<")?1:0,w=p.includes(">")?1:0,p=p.substr(D,p.length-w-D),C.classList[D?"add":"remove"]("b-continues-past"),C.classList[w?"add":"remove"]("b-continues-future"),C.style[s?"right":"left"]=S.percentify(100*Number(p[0])/m.length),C.style.width=S.percentify(100*p.length/m.length),d&&x===h&&(C.style.top=d),g=m[Number(p[p.length-1])],y=S.down(g,".b-cal-event-bar-container"),y!==C.parentNode&&y.appendChild(C)}if(r)for(E in r)r[E].forEach(I=>{I.classList.contains("b-cal-tentative-event")&&I.remove()})}}class lx extends Ss{static get $name(){return"OverflowZone"}static get configurable(){return{droppable:!1,dragProxy:{type:"default",open(e){const t=this,{owner:i}=e.source.view,r=e.element.closest(".b-cal-event-wrap");i.isYearView&&(t.proxyEl=r.cloneNode(!0),t.proxyEl.classList.add("b-cal-drag-proxy"),t.proxyEl.style.width=`${r.offsetWidth}px`,t.proxyOffset=B.getClientPoint(e.startEvent).getDelta($.from(r)),i.contentElement.appendChild(t.proxyEl))},dragMove(e){this.proxyEl&&S.alignTo(this.proxyEl,B.getClientPoint(e.event).translate(10,10),{align:"t0-t0"})},close(){var e;(e=this.proxyEl)===null||e===void 0||e.remove()}}}}findRootElement(e){return e.contentElement}beforeDrag(e){const t=this.hitTest(e);if(t?.type!=="event"||!this.owner.draggable||!t.eventRecord.isDraggable)return!1;e.set("eventRecord",t.eventRecord),e.set("eventDragMode",e[Mt]=fa.move.mode)}dragStart(){this.view.hide()}}class dx extends Ss{static get $name(){return"YearZone"}startCreate(){var e;(e=this.view._overflowPopup)===null||e===void 0||e.hide(),super.startCreate(...arguments)}dragEnter(e){const t=super.dragEnter(e);return t!==!1&&this.view.contentElement.classList.add(this.draggingCls),t}dragLeave(e){super.dragLeave(e),this.view.contentElement.classList.remove(this.draggingCls)}dropHitCreate(e,t,i){const r=this;let n=r.clearTime(t.date),s=r.clearTime(i.date);n<s&&([s,n]=[n,s]),r.setEventData({startDate:s,endDate:b.add(n,1,"d")}),r.days=r.makeDayRange(s,n)}dropHitMove(e,t,i){super.dropHitMove(e,t,i);const r=this,n=r.eventRecord;let{endDate:s}=n;n.allDay&&(s=b.add(s,-1,"d")),r.days=r.makeDayRange(n.startDate,s)}includeDay(e){const t=S.children(this.view.bodyElement,`[data-date='${e}']`);return t.forEach(i=>i.classList.add(`b-cal-tentative-event${this.view.hideNonWorkingDays?":not(.b-nonworking-day)":""}`)),t}makeDayRange(e,t){const i=[];for(let r=e;r<=t;r=b.add(r,1,"d"))i.push(b.format(r,ix));return i}removeDay(e,t){t.forEach(i=>i.classList.remove("b-cal-tentative-event"))}}class cx extends P{static get configurable(){return{view:null,zones:{$config:["nullify"],value:[]}}}updateView(e){e.eachView(t=>{this.onResourceViewViewCreate({view:t})}),e.ion({viewCreate:"onResourceViewViewCreate",thisObj:this})}onResourceViewViewCreate({view:e}){const t=this,{zones:i,owner:r}=t,n=r.client.constructor.Modes,s=r.getViewZoneType(n.resolveType(e.type));s&&i.push(r.createZone(s,{view:e,resource:e.defaultCalendar}))}changeZones(e,t){if(t!=null&&t.length&&!e)for(let i=0,{length:r}=t;i<r;i++)t[i].destroy();return e}}class Yp extends dt{static get $name(){return"CalendarDrag"}static get type(){return"drag"}static get configurable(){return{disableOnReadOnly:!0,localizableProperties:["newName","recurrenceTip"],creatable:!0,draggable:!0,footer:{className:"b-cal-event-footer"},gripper:{class:"b-gripper"},newName:"L{newEvent}",recurrenceTip:"(L{holdCtrlForRecurrence})",resizable:!0,tooltip:{$config:["lazy","nullify"],value:{type:"eventTip",disabled:!0,forSelector:null,tools:null}},validateCreateFn:()=>{},validateMoveFn:()=>{},validateResizeFn:()=>{},zoneTypes:{day:ax,month:ox,year:dx,resource:cx}}}changeGripper(e,t){return t?.remove(),e&&S.createElement(e)}changeTooltip(e,t){return e&&(e=e===!0?this.constructor.configurable.tooltip.value:e,this.initialConfig.tooltip&&(e.disabled=!1),e.ownerFeature=this),N.reconfigure(t,e,this)}}Yp.initClass();Yp._$name="CalendarDrag";class Gp extends jd{static get $name(){return"EventEditor"}static get type(){return"calendareventeditor"}static get configurable(){return{align:{monitorResize:!0}}}updateRecord(e){this.fixTimeFieldVisibility(e.allDay),super.updateRecord(e)}onAllDayChange({value:e,userAction:t}){this.fixTimeFieldVisibility(e,t)}fixTimeFieldVisibility(e,t){const i=e?"hide":"show",r=e?"remove":"add",{startDateField:n,startTimeField:s,endDateField:a,endTimeField:o}=this.widgetMap;s&&s[i](),o&&o[i](),n?.element.classList[r]("b-inline"),a?.element.classList[r]("b-inline"),!e&&t&&(n&&(n.value=s.value=this.record.getData("startDate")),a&&(a.value=o.value=this.record.getData("endDate")))}onBeforeShow(){const{deleteButton:e}=this.widgetMap;super.onBeforeShow(...arguments),e&&!e.hidden&&this.record.isCreating&&e.hide()}onFocusOut(){super.onFocusOut(...arguments),this.owner=this.initialConfig.owner}}Gp.initClass();Gp._$name="EventEditor";class Ul extends fs{static get $name(){return"EventEdit"}static get type(){return"eventEdit"}static get configurable(){return{editorConfig:{type:"calendareventeditor",items:{resourceField:{label:"L{Calendar}",showEventColor:!0},allDay:{type:"checkbox",cls:"b-match-label",name:"allDay",weight:250,label:"L{All day}",internalListeners:{change:"up.onAllDayChange"}}}}}}construct(e){super.construct(e.client,e)}onDragCreateEnd({eventRecord:e}){this.editNewlyCreatedEvent(e)}onEventAutoCreated({eventRecord:e}){this.editNewlyCreatedEvent(e)}editNewlyCreatedEvent(e){if(!this.disabled)return e.isCreating=!0,this.editEvent(e)}async doEditEvent(e,t,i){var r,n,s;const a=this,{client:o}=a,{eventStore:l}=o;let d=o.eventSource||o.activeSubView,u=!1;if(d.isScheduler){a.client=d,await super.doEditEvent(...arguments),a.client=o;return}if(!d.isCalendarMixin||(r=d.features)!==null&&r!==void 0&&(n=r.cellEdit)!==null&&n!==void 0&&n.isEditing)return;b.intersectSpans(e.startDate,e.endDate,d.startDate,d.endDate)||(o.date=e.startDate),!e.isOccurrence&&!l.includes(e)&&(u=e.isCreating=!0,await l.addAsync(e)),d.isAllDayEvent(e)&&d.allDayEvents&&d.showAllDayHeader&&(d=d.allDayEvents);const{_overflowPopup:h}=d,f=d.getDateFromElement(i);let g=h?.isVisible,m=g?h.getEventElement(e):d.getEventElement(e,f);if(g&&(m?g=!1:m=h.getEventElement(e)),e.isCreating){var p;(p=o.onEventCreated)===null||p===void 0||p.call(o,e)}if(!m&&d.isEventList){var v,y,C;m=(v=d)===null||v===void 0||(y=v.rowManager)===null||y===void 0||(C=y.getRowFor(e))===null||C===void 0?void 0:C.element}const D=m&&!S.isInView(m)||!e.isCreating||!u;if(g)m.focus();else if(m){var w;if(D&&(w=d.scrollable)!==null&&w!==void 0&&w.hasOverflow()){var E;await((E=d.scrollable)===null||E===void 0?void 0:E.scrollIntoView(m,{animate:!0,focus:!0}))}else S.focusWithoutScrolling(m)}else{if(!d.isAllDayEvent(e)&&d.hiddenNonWorkingDays[e.startDate.getDay()]){a.internalShowEditor(e,null,{target:!0});return}D?await d.scrollTo(e):await d.await("refresh",!1),m=d.getEventElement(e)}!m&&!i&&d.isDayCellRenderer&&(m=d.getCell(e.startDate)),a.internalShowEditor(e,null,{target:m||i,allowTargetOut:d.isAnimating}),(s=a.editor)!==null&&s!==void 0&&s.lastAlignSpec&&(a.editor.lastAlignSpec.allowTargetOut=!1)}async onSaveClick(){const e=this,{eventRecord:t}=e,{isCreating:i}=t.meta;e.isValid&&(t.isCreating=!1);const r=await super.onSaveClick(...arguments);if(i&&r){var n;e.eventStore.added.add(t),e.eventStore.usesSingleAssignment||e.assignmentStore.added.add(t.assignments),(n=e.client.crudManager)!==null&&n!==void 0&&n.autoSync&&e.client.crudManager.scheduleAutoSync()}}internalShowEditor(){var e,t,i,r;const{client:n,startTimeField:s,endTimeField:a,editor:o}=this,l=(e=(t=n.activeView)===null||t===void 0?void 0:t.autoCreate)!==null&&e!==void 0?e:n.autoCreate||n.constructor.configurable.autoCreate,d=l?.step,{activeSubView:u}=n,h=u?._overflowPopup;if((i=n.features.eventTooltip)===null||i===void 0||(r=i._tooltip)===null||r===void 0||r.hide(),o.owner=h!=null&&h.isVisible?h:u,super.internalShowEditor(...arguments)===!1){o.owner=o.initialConfig.owner;return}d&&(s&&(s.step=d),a&&(a.step=d))}}dt.register(Ul.type,Ul);Ul._$name="EventEdit";const ux=c=>c.eventStore;class Da extends gs{static get $name(){return"EventMenu"}static get type(){return"eventMenu"}populateEventMenu({items:e,eventRecord:t,assignmentRecord:i}){super.populateEventMenu(...arguments);const{client:r}=this;e.duplicate={disabled:t.readOnly||i?.readOnly,hidden:r.readOnly}}getDataFromEvent(e){const{client:t}=this,{activeView:i}=t;i.isScheduler&&(this.client=i);const r=super.getDataFromEvent(e);return this.client=t,r}changeMenu(){const e=this,t=super.changeMenu(...arguments);return t?.ion({beforeShow({source:i}){const{activeSubView:r}=e.client,{_overflowPopup:n}=r;i.owner=n!=null&&n.containsFocus?n:r}}),t}changeItems(e){return e=super.changeItems(...arguments),e.unassignEvent=null,e}}M(Da,"configurable",{items:{duplicate:{text:"L{EventMenu.duplicateEvent}",icon:"b-icon b-icon-copy",weight:400,onItem({eventRecord:c}){const e=c.copy(null,{skipFieldIdentifiers:!0}),{eventStore:t}=this.up(ux),{resources:i}=c;e.name=`${c.name} (${this.L("copy")})`,e.recurrence=null,i!=null&&i.length&&t.assignmentStore.assignEventToResource(e,i),t.add(e)}}}});dt.register(Da.type,Da);Da._$name="EventMenu";const hx=c=>c.eventStore,fx=["activeElement","client","clientListeners","disabled","showOn","tooltip"];class qp extends dt{static get $name(){return"EventTooltip"}static get type(){return"eventTooltip"}static get configurable(){return{showOn:"click",closable:!0,axisLock:"flexible",tooltip:{$config:["lazy","nullify"],value:{type:"eventTip",align:{monitorResize:!0}}},titleRenderer:e=>z.encodeHtml(e.name),renderer:null,recurrenceConfirmation:{$config:["lazy","nullify"],value:{type:"recurrenceconfirmation"}},extendAllDayEndDay:null,align:null}}static get pluginConfig(){return{chain:["render"]}}get isVisible(){return!0}changeRecurrenceConfirmation(e,t){return e&&(e.rootElement=this.owner.rootElement),N.reconfigure(t,e,{owner:this})}changeTooltip(e,t){return N.reconfigure(t,e,{owner:this,setup:"setupTooltip"})}setupTooltip(e){const t=this,i=t.config;return fx.forEach(r=>delete i[r]),tc.mergeConfigs(i,{ownerFeature:t,id:`${t.client.id}-event-tip`,forSelector:t.showOn==="hover"&&".b-cal-event-wrap:not(.b-editing)",cls:{"b-eventedit":t.client.features.eventEdit},disabled:t.disabled,internalListeners:{thisObj:t,delete:"onDeleteClick",edit:"onEditClick",pointerOver:"onTipPointerOver"}},e)}render(){const e=this,t={eventsPerCellChange:"onClientEventsPerCellChange",navigate:"onClientNavigate",thisObj:e};e.showOn==="hover"?e.getConfig("tooltip"):t[`event${e.showOn}`]="onClientTooltipGesture",e.client.ion(t)}get owner(){var e;return(e=this.client.activeView._overflowPopup)!==null&&e!==void 0&&e.containsFocus?this.client.activeView.overflowPopup:this.client}addListener(...e){var t;(t=this.tooltip)===null||t===void 0||t.addListener(...e)}removeListener(...e){var t;(t=this.tooltip)===null||t===void 0||t.removeListener(...e)}onEditClick(){var e,t;const{client:i,activeClient:r,tooltip:n}=this,{overflowPopup:s}=r,a=(r==null||(e=r.features)===null||e===void 0?void 0:e.eventEdit)||i.features.eventEdit,o=s==null||(t=s.element)===null||t===void 0?void 0:t.contains(n.activeTarget),l=o?s.targetCell:n.activeTarget;a&&!a.disabled&&(a.editEvent(this.eventRecord,null,l),n.hide())}onDeleteClick(){this.activeClient.calendar.removeEvents([this.eventRecord],()=>{var e;return(e=this.tooltip)===null||e===void 0?void 0:e.hide()},this.tooltip)}onClientEventsPerCellChange(){var e,t;(e=this._tooltip)===null||e===void 0||e.requestAnimationFrame((t=this._tooltip)===null||t===void 0?void 0:t.hide)}onClientNavigate(e){var t;const{_tooltip:i}=this;i!=null&&i.activeTarget&&(!this.owner.owns(e.event)||e.item!==i.activeTarget)&&!i.owns((t=e.event)===null||t===void 0?void 0:t.relatedTarget)&&i.hide()}onClientTooltipGesture({domEvent:e,event:t,eventElement:i,eventRecord:r,source:n}){const{tooltip:s}=this;e=e||t,this.onTipPointerOver({event:e,target:i,eventRecord:r,owningCalendarWidget:n})!==!1&&(i.classList.contains("b-cal-in-cluster")&&Zf(s.align.align).edgeAligned===2?s.setTimeout({fn:"showByEvent",args:[e,i],delay:130}):s.showByEvent(e,i))}onTipPointerOver({target:e,owningCalendarWidget:t,eventRecord:i}){var r,n;if(!t){var s;t=(s=N.fromElement(e))===null||s===void 0?void 0:s.closest(hx)}return i||(i=t.getEventRecord(e)),(r=this.client.features)!==null&&r!==void 0&&(n=r.eventEdit)!==null&&n!==void 0&&n.isEditing?!1:(t&&(this.tooltip.activeTarget=e,this.activeClient=t,i=t.getEventRecord(e),this.tooltip.eventRecord=this.eventRecord=i),i!=null)}updateDisabled(e,t){super.updateDisabled(e,t),this._tooltip&&(this._tooltip.disabled=e)}}qp.initClass();qp._$name="EventTooltip";const gx={magnitude:1,unit:"hour"};class mx extends P.mixin(Oa){static get configurable(){return{dragItemSelector:".b-grid-row",droppable:!1,dragProxy:{type:"default",open(e){return this.owner.owner.openProxy(e)},dragMove(e){return this.owner.owner.moveProxy(e)},close(){var e;(e=this.owner.owner.proxyEl)===null||e===void 0||e.remove()}}}}beforeDrag(e){return this.owner.onDragStart(e)}}class Co extends dt.mixin(he){static get $name(){return"ExternalEventSource"}static get delayable(){return{onCalendarPaint:"raf"}}static get type(){return"externalEventSource"}static get configurable(){return{grid:{$config:["lazy"],value:null},dragRootElement:null,dragItemSelector:null,getRecordFromElement:function(e){const t=this.grid||(this.grid=N.fromElement(e,"grid"));return t?t.getRecordFromElement(e):e.innerText},hideExternalProxy:!0,draggable:{$config:["lazy"],value:{}}}}onCalendarPaint({firstPaint:e}){e&&this.getConfig("draggable")}onDragStart(e){var t;const i=this,{client:r}=i,{eventStore:n}=r,{modelClass:s}=n;if(!e.itemElement)return!1;let a=i.callback(i.getRecordFromElement,i,[e.itemElement]);if(a.isModel)a.isEventModel||(a=n.createRecord(a.data));else{if(typeof a=="string"){const o=r.activeView.autoCreate||r.autoCreate,l=b.parseDuration(o?.duration||gx);a={[s.getFieldDataSource("name")]:a,[s.getFieldDataSource("duration")]:l.magnitude,[s.getFieldDataSource("durationUnit")]:l.unit}}a=n.createRecord(a)}e.set("sourceStore",(t=i.grid)===null||t===void 0?void 0:t.store),e.set("eventRecord",a)}openProxy(e){const{grid:t}=this,i=e.element.closest(this.draggable.dragItemSelector),r=i.querySelector('[data-column="name"]'),n=this.proxyEl=S.createElement({className:"b-grid-to-cal-drag-proxy"});n.innerHTML=r?r.innerHTML:e.peek("eventRecord").name,this.proxyOffset=B.getClientPoint(e.startEvent).getDelta($.from(i)),(t?.element||this.dragRootElement).parentNode.appendChild(n)}moveProxy(e){const{proxyEl:t}=this;t&&(this.client.owns(e.targetElement)&&this.hideExternalProxy?t.classList.add("b-hide-display"):(t.classList.remove("b-hide-display"),S.alignTo(t,B.getClientPoint(e.event).translate(10,10),{align:"t0-t0"})))}changeDragRootElement(e){return typeof e=="string"&&(e=document.querySelector(e)||document.getElementById(e)),e}changeDraggable(e){const{grid:t}=this,i=t?.contentElement||this.dragRootElement,{dragItemSelector:r}=this;return e=Co.mergeConfigs({owner:this,grid:t},e),i&&(e.dragRootElement=i),r&&(e.dragItemSelector=r),new mx(e)}changeGrid(e){return typeof e=="string"&&(e=N.getById(e)),e}}Co.initClass();Co._$name="ExternalEventSource";class wo extends dt{static get configurable(){return{startDateParamName:"startDate",endDateParamName:"endDate",dateFormat:"YYYY-MM-DD",beforeRequest:null,alwaysLoadNewRange:null,clearOnNewRange:null}}construct(e){const{client:t}=e;t.ion({dateRangeRequested:"onClientDateRangeRequested",thisObj:this}),t.crudManager.ion({beforeLoadApply:"onCrudManagerBeforeApply",thisObj:this,prio:9999}),super.construct(...arguments)}hasOutstandingLoadFor(e,t){const{load:i}=this.client.crudManager.activeRequests;if(i){var r;const n=(r=i.options)===null||r===void 0?void 0:r.dateRangeRequested;if(n&&b.timeSpanContains(n.startDate,n.endDate,e,t))return!0}}onCrudManagerBeforeApply({response:e,options:t}){this.lastRangeLoaded=e.success&&t?.dateRangeRequested}onClientDateRangeRequested({new:{startDate:e,endDate:t},changed:i}){const r=this,{client:n}=r;if(!i&&r.alwaysLoadNewRange)return;i&&(S.addTemporaryClass(n.element,"b-notransition",100,n),r.clearOnNewRange&&(n.eventStore.clear(!0),r.lastRangeLoaded=null));const{lastRangeLoaded:s}=r;if(s&&!r.alwaysLoadNewRange){const{startDate:a,endDate:o}=r.lastRangeLoaded;if(b.timeSpanContains(a,o,e,t))return}!r.disabled&&!r.hasOutstandingLoadFor(e,t)&&r.loadDateRange(e,t)}refresh(){const{lastRangeLoaded:e}=this;e&&this.loadDateRange(e.startDate,e.endDate)}loadDateRange(e,t){const i=this,{pendingLoad:r}=i;r?(r.startDate=b.min(e,r.startDate),r.endDate=b.max(t,r.endDate)):(i.pendingLoad={startDate:e,endDate:t},i.client.requestAnimationFrame(()=>i.load()))}async load(){const e=this,{client:t,beforeRequest:i,dateFormat:r}=e,{crudManager:n}=t,{load:s}=n.activeRequests,{startDate:a,endDate:o}=e.pendingLoad,l={dateRangeRequested:e.pendingLoad,request:{params:{[e.startDateParamName]:b.format(a,r),[e.endDateParamName]:b.format(o,r)}}};if(e.pendingLoad=null,i&&e.callback(i,t,[l]),s){if(e.hasOutstandingLoadFor(a,o))return;try{await n.cancelRequest(s.desc,s.reject)}catch{}}try{await n.load(l)}catch(d){!t.isDestroyed&&t.trigger("loadOnDemandFail",d)!==!1&&Pi.alert({title:t.L("L{Calendar.loadFail}"),message:d.message})}!t.isDestroyed&&t.trigger("dateRangeLoad",{startDate:a,endDate:o})}}M(wo,"$name","LoadOnDemand");M(wo,"type","loadOnDemand");wo.initClass();wo._$name="LoadOnDemand";class Kp extends qr{restoreState({client:e}){}saveState({client:e}){}cloneElement(e,t=this.element,i=!0){i&&(t.innerHTML=""),t.appendChild(e.cloneNode(!0))}pageTpl(e){const{config:t,title:i,header:r,footer:n,styles:s,htmlClasses:a,bodyStyle:o,bodyClasses:l=[`b-${this.constructor.type}`,...this.owner.bodyClasses,...N.outerCls],paperHeight:d,paperWidth:u,html:h}=e,f=K.isSafari?"":"window.removeElement && window.removeElement();",g=t!=null&&t.debug?"":`<script type="text/javascript">window.addEventListener('load', function() { window.print(); ${f} });<\/script>`;return bt.tpl`
            <!DOCTYPE html>
            <html class="${a}" style="width: ${u}in; height: ${d}in;">
                <head>
                    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
                    <title>${i}</title>
                    ${s.join("")}
                </head>
                <body class="b-print ${l.join(" ")}" style="width: ${u}in; height: ${d}in; ${o}">
                    <div class="b-print-content">
                        ${r&&`<div class="b-print-header" style="width: 100%">${r}</div>`}
                        <div class="b-print-body"><div class="b-print-viewport">${h}</div></div>
                        ${n&&`<div class="b-print-footer" style="width: 100%">${n}</div>`}
                    </div>
                    ${g}
                </body>
            </html>`}}Kp._$name="Printer";const px={configurable:!0,get:()=>Number.MAX_SAFE_INTEGER};class Ea extends Kp{static get $name(){return"CalendarPrinter"}static get type(){return"calendar"}getTotalHeight(e){const{activeView:t}=e;switch(e.mode){case"agenda":return t.virtualScrollHeight;case"day":return t.dayContentElement.scrollHeight+t.alldayRowElement.offsetHeight;case"week":return t.dayContentElement.scrollHeight+t.alldayRowElement.offsetHeight;case"month":if(this.owner.wysiwyg)return t.weeksElement.scrollHeight+t.weekdaysHeader.offsetHeight+10;break;case"year":return this.inchToPx(Hi.A4.width)}}getTotalWidth(e){switch(e.mode){case"year":return this.inchToPx(Hi.A4.height);default:return this.inchToPx(Hi.A4.width)}}async prepareComponent(e){const t=this,{owner:i}=t,{wysiwyg:r}=i,n=!r,{client:s}=e,{activeView:a}=s;if(t.exportMeta={title:i.callback(i.titleRenderer,i,[a]),totalWidth:t.getTotalWidth(s),totalHeight:t.getTotalHeight(s),subGrids:{}},s.mode==="month"&&n&&(Object.defineProperty(a,"eventsPerCell",px),a.doRefresh()),t.cloneElement(a.currentElement),s.mode==="month"){let o;n&&(o=a.shrinkwrapRowHeights,delete a.eventsPerCell,a.doRefresh(),t.exportMeta.totalHeight=a.weekdaysHeader.offsetHeight+o.reduce((l,d)=>l+d,5)),a.weekElements.forEach((l,d)=>{const u=t.element.querySelector(`[data-week="${l.dataset.week}"]`);u.style.minHeight="",n?u.style.flex=`0 0 ${o[d]}px`:r?u.style.flex=`1 0 ${l.offsetHeight}px`:u.style.flex=`1 0 ${250/6}mm`})}}pxToInch(e){return(e/96).toFixed(2)}}Ea.prototype.pagesExtractor=async function*(e){const t=this,{totalHeight:i,totalWidth:r,title:n}=t.exportMeta;yield{html:t.pageTpl({config:e,title:n,html:t.prepareExportElement(),styles:t.stylesheets,paperWidth:t.pxToInch(r),paperHeight:t.pxToInch(i)})}};Ea._$name="CalendarPrinter";const vx=Object.freeze([]);class Xp extends dt{static get $name(){return"Print"}static get type(){return"print"}static get configurable(){return{printer:{$config:["lazy","nullify"],value:{type:"calendar"}},wysiwyg:!1,titleRenderer:e=>e.description,printers:new Map([[Ea.type,Ea]])}}construct(){super.construct(...arguments),this.client.print=this.print.bind(this)}changePrinter(e){const t=this,i=t.printersMap||(t.printersMap=new Map);if(e){let r;const{type:n}=e;if(i.has(n))r=i.get(n),r.setConfig(e);else{const s=t.printers.get(n);if(!s)throw new Error(`Printer type ${n} is not found. Make sure you've configured it`);e=T.clone(e),e.owner=t,r=new s(e),r.relayAll(t),i.set(n,r)}return r}else i.forEach(r=>r.destroy())}get bodyClasses(){return this.shrinkwrapRowHeights?["b-shrinkwrap-row-heights"]:vx}async print(e={}){const t=this,{client:i,printer:r}=t,n=`${i.id}-print-iframe`;if(i.trigger("beforePrint",{config:e,printer:r})!==!1){e.client=i;const a=await t.printer.export(e);if(e.debug)i.trigger("print",a);else{var s;(s=document.getElementById(n))===null||s===void 0||s.remove();const o=S.createElement({id:n,class:"b-calendar-print-iframe",tag:"iframe",parent:document.body});return o.contentWindow.removeElement=()=>{o.remove(),i.trigger("print",a)},o.contentWindow.document.write(a[0].html),o.contentWindow.document.close(),a}}}}Xp.initClass();Xp._$name="Print";class Yl extends vo{static get $name(){return"ScheduleMenu"}static get type(){return"scheduleMenu"}getDataFromEvent(e){const{client:t}=this,{activeView:i}=t,r=t.resolveResourceRecord(e)||t.defaultCalendar;i.isScheduler&&(this.client=i);const n=super.getDataFromEvent(e);return n.resourceRecord||(n.resourceRecord=r),this.client=t,n}shouldShowMenu({date:e,targetElement:t}){const{client:i}=this,{activeView:r}=i;if(r.isScheduler){this.client=r;const n=super.shouldShowMenu(...arguments);return this.client=i,n}return Boolean(e&&!t.closest(i.eventSelector))}}dt.register(Yl.type,Yl);Yl._$name="ScheduleMenu";const yx=/^[+-]?\d+(?:\.\d+)?(?:%|px)?$/;class ke{static from(e){return e==null?null:e instanceof ke?e:(Array.isArray(e)||typeof e=="string"&&isNaN(e)||(e=Number(e),e=e<1?[e,0]:[0,e]),new ke(...e))}static get(e){return ke.from(e)||ke.ZERO}constructor(e,t){this.r=e,this.d=t}add(e){return e=ke.from(e),e?new ke(this.r+e.r,this.d+e.d):this}adjust(e,t){return this.r+=e||0,this.d+=t||0,this}freeze(){return Object.freeze(this)}px(e){return this.r*(e||100)+this.d}sub(e){return e=ke.from(e),e?new ke(this.r-e.r,this.d-e.d):this}*[Symbol.iterator](){yield"r",yield"d"}stringify(){const e=this.toString();return yx.test(e)?e:`calc(${e})`}toString(){const{r:e,d:t}=this;let i;return e?(i=S.percentify(e*100),t&&(i=`${i} + ${t}px`.replace("+ -","- "))):i=t?`${t}px`:"0",i}}ke.ZERO=new ke(0,0).freeze();ke._$name="LayoutDim";const ta=c=>({className:c.cls,style:c.style}),bx={end:"pos",start:"neg"},Cx={end:"start",start:"end"},wx=Object.entries({alignment:"alignment",color:"color",footer:"footer",header:"name",rotation:"rotation"});class xa extends tn{onBeforeLayoutEvents({source:e,context:t}){const i=e.getTimeRanges(t.cellData.date,t.cellData.tomorrow);if(i.length){const{layout:r}=t,n={},s={},a=[],o=[];let l,d;t.timeRangeHeaders=s,t.timeRanges=i;for(const u of i)d=r.createLayoutItem(u,t),d.values=Object.fromEntries(wx.map(([h,f])=>[h,u[f]])),d.values.rotation=d.values.rotation||bx[d.values.alignment],r.clusterize(a,o,d,t),l=t.dayDomConfig.children.inset,l=l.children||(l.children=[]),l.push(this.renderTimeSpan(t,d,s,n));(s.end||n.end)&&(t.dayDomConfig.className["b-dayview-inset-after"]=1),(s.start||n.start)&&(t.dayDomConfig.className["b-dayview-inset-before"]=1)}}renderPart(e,t,i,r,n,s,a){var o,l,d;const u=r==="footer",{record:h}=i,f={timeRange:h};let g=i,m,p,v;if(typeof r=="string"?(i[r]=g=T.merge({part:r,record:h,outer:i,cls:{[`b-cal-timerange-${r}`]:1}},a),v=i.values[r],v!=null&&(f.value=g.value=v)):(p=r,r="outer"),e=(o=e)===null||o===void 0?void 0:o[r],t=(l=t)===null||l===void 0?void 0:l[r],f.renderData=g,f.domConfig=p,t){g.style={};const y=t(f);typeof y=="string"?p=Object.assign({html:y},p):T.isObject(y)&&(m=y)}return m=m||((d=e)===null||d===void 0?void 0:d(f)),p&&(m=T.merge(m||{},p)),n&&m&&(s=u&&Cx[s]||s,n[s]=(n[s]||0)+1),g.domConfig=m,m}renderTimeSpan(e,t,i,r){const n=this,{owner:s}=n,{defaultRenderer:a,renderer:o}=s,l=t.eventRecord,d=Math.abs(t.end-t.start),u=d>1,h=!u,{rtl:f}=e.layout.owner,{values:g}=t,{alignment:m,color:p,rotation:v}=g,y={color:p,values:g,record:l,layoutContext:e,cls:{"b-readonly":l.readOnly,"b-rtl":f,"b-cal-timerange":1,"b-cal-timerange-line":h,"b-cal-timerange-narrow":u&&d<=s.narrowThreshold*60,[`b-cal-timerange-align-${m}`]:m,[`b-cal-timerange-rotate-${v}`]:u&&v}};u&&t.height.adjust(0,-1);const C=t.getStyles(f);return S.normalizeChildren(n.renderPart(a,o,y,{dataset:{"timerange-id":l.id,btip:h&&g.header||null},className:{[l.cls]:l.cls},elementData:{timeRange:l},style:{top:C.top,height:C.height},children:u&&{header:n.renderPart(a,o,y,"header",i,m,{cls:{[l.iconCls]:l.iconCls}}),body:n.renderPart(a,o,y,"body"),footer:n.renderPart(a,o,y,"footer",r,m)}}))}}M(xa,"$name","DayZone");M(xa,"configurable",{viewListeners:{beforeLayoutEvents:"onBeforeLayoutEvents"}});class Lr extends dt.mixin(Mi){attachToProject(e){var t,i;super.attachToProject(e),this.detachListeners("project"),(t=e.timeRangeStore)===null||t===void 0||t.ion({name:"project",change:"refresh",thisObj:this}),(i=e.resourceTimeRangeStore)===null||i===void 0||i.ion({name:"project",change:"refresh",thisObj:this})}changeRenderer(e){return typeof e=="function"&&(e={header:e}),e}updateHeaderWidth(e){var t;const i=(t=this.owner)===null||t===void 0?void 0:t.element;if(i){var r;i.style.setProperty("--timerange-header-width",(r=ke.from(e))===null||r===void 0?void 0:r.toString())}}refresh(){this.client.queryAll(e=>e.isResourceView).forEach(e=>e.eachView("refresh"))}}M(Lr,"$name","TimeRanges");M(Lr,"type","timeRanges");M(Lr,"configurable",{defaultRenderer:{outer({renderData:c}){var e;const t=ta(c),{color:i}=c;return i&&(S.isNamedColor(i)?t.className[`b-cal-color-${i}`]=1:(t.style||(t.style={}))["--timerange-color"]=i),t.className["b-cal-timerange-has-header"]=(e=c.header)===null||e===void 0?void 0:e.domConfig,t},body:({renderData:c})=>ta(c),header:({renderData:c,value:e})=>e?F(F({},ta(c)),{},{children:[{className:{"b-cal-timerange-header-text":1},text:e}]}):null,footer:({renderData:c,value:e})=>e?F(F({},ta(c)),{},{children:[{className:{"b-cal-timerange-footer-text":1},text:e}]}):null},headerWidth:40,narrowThreshold:60,renderer:null,zoneTypes:{day:xa,resource:xa}});dt.register(Lr.type,Lr);Lr._$name="TimeRanges";class Zp extends dt{static get $name(){return"WeekExpander"}static get type(){return"weekExpander"}static get pluginConfig(){return{chain:["render"]}}render(){const{client:e}=this,t=this.monthView=e.isMonthView?e:e.modes.month;if(t){const{weekRenderer:i}=this;t.showWeekColumn=!0,t.weekRenderer=t.weekRenderer?ve.createSequence(t.weekRenderer,i):i,t.ion({weeknumberclick:"onWeekNumberClick",thisObj:this,prio:1e4})}}weekRenderer(e,[t,i]){e.querySelector(".b-week-toggle-tool-wrap")||S.createElement({parent:e,className:"b-week-toggle-tool-wrap",children:[{className:"b-icon b-week-toggle-tool",dataset:{btip:this.L("L{WeekExpander.expandTip}")}}]})}onWeekNumberClick({domEvent:e,date:t}){const i=e.target.closest(".b-week-toggle-tool");if(i&&!this.disabled){const r=e.target.closest(".b-calendar-row");return r.classList.contains("b-shrinkwrapped")?(this.monthView.flexWeekRow(t),i.dataset.btip=this.L("L{expandTip}")):r.classList.contains("b-has-overflow")&&(this.monthView.shrinkwrapWeekRow(t),i.dataset.btip=this.L("L{collapseTip}")),!1}}updateDisabled(e,t){super.updateDisabled(e,t),this.client.element.classList.toggle("b-weekexpander",!e)}}Zp.initClass();Zp._$name="WeekExpander";const Sx=function(c){var e,t;const i=this;return{[c?"right":"left"]:(e=i.left)===null||e===void 0?void 0:e.stringify(),top:i.top.stringify(),width:(t=i.width)===null||t===void 0?void 0:t.stringify(),height:i.height.stringify(),minWidth:i.minWidth}};class Ds extends P.mixin(ai){beforeLayoutEvents(e){return this.owner.trigger("beforeLayoutEvents",{context:e}),e}clusterize(e,t,i,r){const n=e[e.length-1]||null;t.push(i),n&&this.overlaps(n,i)?(i.cluster=n,n.end=Math.max(n.end,i.end),n.items.push(i)):e.push(i.cluster={context:r,start:i.start,end:i.end,items:[i]})}createLayoutContext(e,t){const i=e?.events;return{cellData:e,dayDomConfig:t,events:i?.length>1?e.dayTime.sortEvents(e.date,i.slice()):i||[],clusters:[],items:[],layout:this}}layoutEvents(e,t){const i=this,r=i.beforeLayoutEvents(i.createLayoutContext(e,t)),{clusters:n,events:s,items:a}=r;let o,l,d,u;for(o of s)d=i.createLayoutItem(o,r),i.clusterize(n,a,d,r);for(l=0,u=n.length;l<u;++l)i.layoutCluster(n[l]);return i.owner.trigger("layoutEvents",{context:r}),r}createLayoutItem(e,t){const{date:i,tomorrow:r,dayEnd:n,dayTime:s}=t.cellData,{allDay:a,startDate:o,endingDate:l}=e,d=a||o<i?0:s.delta(o,"s"),u=a||l>=r?n:s.delta(l,"s"),h=Math.max(d,0),f=Math.min(u,n),g=ke.from(h/n);return{eventRecord:e,getStyles:Sx,start:h,end:f,top:g,id:e.id,height:new ke(f/n,0).sub(g),startsBefore:o<i||d<0,endsAfter:r<l||u>n}}overlaps(e,t,i,r){var n;return typeof i=="string"&&(r=i,i=null),r=r||"end",i=(n=i)!==null&&n!==void 0?n:this.overlapTolerance*60||0,e.start<t[r]-i&&t.start<e[r]-i}syncGutter(){this.owner.setStyle("--dayview-cell-gutter",String(ke.get(this.gutter&&this.gutterWidth)))}updateGutter(){this.syncGutter()}updateGutterWidth(){this.syncGutter()}updateInset(e){this.owner.setStyle("--dayview-cell-inset-size",String(ke.get(e)))}}M(Ds,"factoryable",{});M(Ds,"configurable",{gutter:!0,gutterWidth:5,inset:40,overlapTolerance:null,owner:null});Ds._$name="DayLayout";class Dx extends Bd(){static get defaultConfig(){return{coordProp:"left",sizeProp:"width"}}pack(e){const t=e.map(i=>{const{startDate:r}=i.eventRecord,n=new Date(r);return n.setSeconds(n.getSeconds()+i.maxEnd-i.start),{item:i,start:r,end:n,x:0}});this.packEventsInBands(t,(i,r,n,s)=>{i.width=s,i.w=s*Ra,i.x+=(i.left=n.start+r*s)*Ra,i.item.x=i.x,i.item.w=i.w})}}const Ra=1e4,Rf=Object.freeze([]),Ex=new Dx;class So extends Ds{createLayoutContext(e,t){const i=this,r=super.createLayoutContext(e,t),{staggerWidth:n}=i;return Object.assign(r,{indentWidth:ke.get(i.indentWidth),stagger:new ke,staggerMaximum:ke.from(i.staggerMaximum),staggerMinimum:i.staggerMinimum,staggerWidth:ke.from(n===!0?i.gutterWidth:n),stretch:i.stretch})}layoutCluster(e){const t=this,{context:i,items:r}=e,{indentWidth:n,stagger:s,staggerMaximum:a,staggerMinimum:o,staggerWidth:l,stretch:d}=i,u=t.treeify(r);t._assignSizes(r,u);for(const h of r){const f=h.depth,g=new ke,m=new ke,p=h.majorParent||h;for(const v of s)s[v]=l[v]*(f.height+f.overlap),s[v]=a!=null&&a[v]?Math.min(a[v],s[v]):s[v];g.r=p.x+f.minor*n.r*p.w,g.d=f.minor*n.d,m.r=d?1-g.r:p.w-g.r+p.x,m.d=-g.d,o&&(h.minWidth=`calc(${o} * (${m}))`),m.r-=s.r*p.w,m.d-=s.d,h.left=g,h.width=m}}treeify(e){const t=[];for(let i=0;i<e.length;i++)this._addChild(e[i],i,t);return t}_addChild(e,t,i){const r=this,{clearanceMinutes:n,escapeMinutes:s,stretch:a}=r,o=n*60,l=o+s*60,d=(r.overlapTolerance||0)*60,u=(w,E)=>Math.abs(E.start-w.start)>=o,h=w=>w.depth.minor*10+w.depth.major*(a?1:0),f={depth:0,height:0,heightMajor:0,overlap:0,major:0,minor:0};if(e.parent=null,e.maxEnd=e.maxEndMajor=e.end,e.depth=f,e.order=t,!i.length){i[0]=e,e.barriers=Rf;return}let g=0,m,p,v,y,C,D;for(y of i){if(m=y.lastItem||y,!r.overlaps(e,y,d,"maxEnd")){C=y.parent,p=!0;break}if(u(e,m)){for(v=!0,p&&(p=!1,C=null);m!==y&&!r.overlaps(m,e,d);m=m.parent);D=h(m),(!C||D<g)&&(C=m,g=D)}else v||(p=!0,C=y)}if(p)v=0,p=C?C.depth.major+1:0,y=C=i[p-1]||null;else{for(y=C.majorParent||C;l&&C!==y&&!(r.overlaps(C,e,d)&&e.start-C.start<l);C=C.parent);v=C.depth.minor+1,p=C.depth.major}e.parent=C,f.major=p,f.minor=v,f.depth=C?C.depth.depth+1:0,v?(e.majorParent=y,e.previousItem=y.lastItem,y.lastItem=e):r._addMajor(e,i),r._adjustOverlap(e),r._adjustParents(e)}_addMajor(e,t){const i=this,{stretch:r}=i,n=e.depth.major;if(t[n]=e,e.barriers=i._getOverlaps(t,e,1),r||e.barriers.length)for(const s of i._getOverlaps(t,e,-1)){const a=s.barriers.filter(o=>!e.barriers.includes(o));(r||a.length<s.barriers.length)&&(s.barriers=a,a.push(e))}}_adjustOverlap(e){if(e.depth.minor){let t,i;for(i=e;i.depth.minor>1;i=i.parent);for(t=0;i=i.previousItem;)this.overlaps(i,e)&&(t=Math.max(t,i.depth.height+i.depth.overlap+1));e.depth.overlap=t}}_adjustParents(e){const{depth:t,end:i}=e,r=t.minor+t.overlap;for(let n,s=e;s=s.parent;){if(n=s.depth,n.major!==t.major){n.heightMajor=Math.max(n.heightMajor,t.major-n.major);continue}for(s.maxEnd=Math.max(s.maxEnd,i);n.height<r-n.minor;)++n.height,n.overlap&&--n.overlap}}_assignSizes(e,t){const{complexityLimit:i,stretch:r}=this,n=e.filter(s=>!s.depth.minor);if(i)for(const s of n){const a=s.barriers.map(y=>[y]),{parent:o}=s,l=s.depth.heightMajor+1;s.x=o?o.x+o.w:0;let d=(1-s.x)/l,u,h,f,g,m,p,v;if(a.length){for(u=0;u<a.length;){if(g=a[u],f=f||g,u>i){d=1/t.length;break}if(m=g[g.length-1],m.order<s.order)++u,v=m.x,h=0;else if(!m.barriers.length)++u,v=1,h=1;else{a.splice(u,1,...m.barriers.map(y=>g.concat(y))),f===g&&(f=null);continue}p=(v-s.x)/(h+g.length),p<d&&(d=p,f=g)}if(r){for(p=f.reduce((y,C)=>y+C.depth.height+1,0),u=s.lastItem;u;u=u.previousItem)u.depth.overlap+=p;s.depth.overlap+=p}}s.w=d}else{Ex.pack(n);for(const s of n)s.x/=Ra,s.w/=Ra}}_getOverlaps(e,t,i){const{end:r}=t,n=i<0?-1:e.length;let{start:s}=t,a,o,l;for(a=t.depth.major+i;a!==n&&s<r;a+=i)o=e[a],s<o.maxEnd&&o.start<r&&((l||(l=[])).push(o),s=o.maxEnd);return l||Rf}}M(So,"type","fluid");M(So,"configurable",{clearanceMinutes:45,complexityLimit:2e3,escapeMinutes:null,indentWidth:10,staggerMaximum:null,staggerMinimum:.4,staggerWidth:!0,stretch:null});So.initClass();So._$name="FluidDayLayout";var Jp=c=>{var e;return e=class extends Qm(c||P){static get projectStores(){return{resourceStore:{dataName:"resources",listeners:{changePreCommit:"onCalendarStoreChange"}},eventStore:{dataName:"events",listeners:{changePreCommit:"onCalendarStoreChange"}},assignmentStore:{dataName:"assignments"},timeRangeStore:{dataName:"timeRanges",modelClass:nr},resourceTimeRangeStore:{dataName:"resourceTimeRanges",modelClass:Ti}}}changeCrudManager(i){var r;const n=this;i&&!i.isCrudManager&&(i=(i.type||n.crudManagerClass).new({scheduler:n},i)),n._crudManager=i,(r=n.bindCrudManager)===null||r===void 0||r.call(n,i)}updateTimeZone(i){this.project.timeZone=i}onTimeZoneChange({timeZone:i,oldTimeZone:r}){const n=this,s=n.isCalendar?n.activeView:!n.calendar&&n;if(s){const a=r?Xe.fromTimeZone(s.date,r):s.date;(s.calendar||s).date=i?Xe.toTimeZone(a,i):a}}get defaultCalendar(){const{eventStore:i}=this,r=T.hasOwn(this,"_defaultCalendar")?this._defaultCalendar:i.defaultCalendarId;if(r!==null)return r!=null?r.isResourceModel?r:i.resourceStore.getById(r):i.resourceStore.first}get defaultCalendarId(){return this.eventStore.modelClass.asId(this.defaultCalendar)}updateProject(i,r){super.updateProject(i,r),this.getConfig("timeZone"),this.detachListeners("CalendarStores"),i.ion({name:"CalendarStores",dataReady:"onCalendarStoreChange",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh({source:i,isInitialCommit:r}){r&&i.eventStore.invalidateDayIndices()}updateEventStore(i,r){if(r&&delete r.createRecord,i&&!i.isCalendarEventStore){const n=this;Object.defineProperty(i,"defaultCalendar",{get:()=>n.defaultCalendar}),i.isCalendarEventStore=!0}}get widgetClass(){}},M(e,"$name","CalendarStores"),M(e,"configurable",{defaultCalendar:null,crudManagerClass:ws,crudManager:null,timeZone:{$config:"lazy",value:null}}),M(e,"defaultConfig",{projectModelClass:oi}),e};class ic extends Array{constructor(...e){super(...e),M(this,"firstFreeSlot",0)}set(e,t){const i=this;if(e==null)return i.add(t);if(i[e]=t,i.firstFreeSlot===e)for(;i[i.firstFreeSlot];)i.firstFreeSlot++}add(e){const t=this.firstFreeSlot;for(this[t]=e;this[this.firstFreeSlot];)this.firstFreeSlot++;return t}setEvents(e){const t=this.length=this.firstFreeSlot=e.length;for(let i=0;i<t;i++)this[i]=e[i]}}ic._$name="EventSlots";class Es extends P{static defaultSorterFn(e,t){e=e.eventRecord||e,t=t.eventRecord||t;const{startDate:i}=e,{startDate:r}=t;return i?r?i-r||t.durationMS-e.durationMS:1:-1}static interDaySorterFn(e,t){e=e.eventRecord||e,t=t.eventRecord||t;const{startDate:i,isInterDay:r}=e,{startDate:n,isInterDay:s}=t;return i?n?r!==s?Number(s)-Number(r):i-n||t.durationMS-e.durationMS:1:-1}}Es._$name="EventSorter";const Tf=c=>c.isCalendarMixin&&c.eventStore,xx=/(touch|mouse|pointer|key|context|dbl)(.*)/,Rx=(c,e,t)=>`${z.capitalize(e)}${z.capitalize(t)}`,Tx=c=>c.type.replace(xx,Rx);var Qp=c=>class extends(c||P){static get $name(){return"SchedulerInterface"}calendarHitTest(t){const{activeView:i}=this,r=S.getEventElement(t);return i!=null&&i.element.contains(r)?i.calendarHitTest(t):null}get timeAxis(){const t=this;return t._timeAxis||(t._timeAxis={get startDate(){return t.activeView.startDate},get endDateDate(){return t.activeView.endDate},isTimeSpanInAxis(i){return b.intersectSpans(i.startDate,i.endDate,this.startDate,this.endDate)}}),this._timeAxis}get timeAxisViewModel(){const t=this;return t._timeAxisViewModel||(t._timeAxisViewModel={get timeResolution(){return t.activeView.timeResolution||{}}}),this._timeAxisViewModel}resolveEventRecord(t){var i;t instanceof Event&&(t=t.target);const r=(i=this.constructor.fromElement(t))===null||i===void 0?void 0:i.closest(Tf);return r?.getEventRecord(t)}resolveAssignmentRecord(){}resolveResourceRecord(t){var i;const{activeView:r}=this;if(r.isResourceView){const n=t.nodeType===Node.ELEMENT_NODE?t:t.target,s=n.closest(".b-overflowpopup"),a=s?bryntum.fromElement(s,"overflowpopup").owner:bryntum.fromElement(t,r.viewType.type);if(a)return a.resource}return(i=this.resolveEventRecord(t))===null||i===void 0?void 0:i.resource}handleEvent(t){const i=Tx(t);if(super.handleEvent)super.handleEvent(t);else if(!t.handled&&!t.schedulerRedirected){if(this.trigger(`beforeElement${i}`,{event:t})!==!1){var r;(r=this[`onElement${i}`])===null||r===void 0||r.call(this,t)}t.schedulerRedirected=!0}}onInternalKeyDown(t){var i;(i=this.onCalendarPointerInteraction)===null||i===void 0||i.call(this,t)}getCellDataFromEvent(t){var i;return(i=super.getCellDataFromEvent)===null||i===void 0?void 0:i.call(this,t)}getDateFromDomEvent(t){var i;const r=(i=this.constructor.fromElement(t))===null||i===void 0?void 0:i.closest(Tf);if(r)return r.getDateFromDomEvent(t)}createEvent(){this.activeView.createEvent(...arguments)}get enableRecurringEvents(){return!0}getRowFor(){}suspendRefresh(){}resumeRefresh(){}get widgetClass(){}};const Mx=new String("");var ev=c=>{var e;return e=class extends(c||P){createEventDomConfig(i,r=this.eventRenderer){var n,s,a;const o=this,{eventHeight:l,intradayCls:d,alldayCls:u,solidBarCls:h,pastEventCls:f,showTime:g,timeFormat:m,rtl:p}=o,v=o.up("calendar"),{eventRecord:y,minimal:C}=i,D=i.eventEndDate||y.endingDate,w=y.isOccurrence?y.recurringEvent.resource:y.resource,E=y.isRecurring||y.isOccurrence,R="isAllDay"in i?i.isAllDay:(n=o.isAllDayEvent)===null||n===void 0?void 0:n.call(o,y),x={height:l!=="auto"?S.setLength(l):null},k=v?.eventSelectedCls,I=i.dataset={eventId:y.id};let A=o.internalBodyContentRenderer(y),L=typeof A!="string",O=L?"children":"html",_=y.color||y.eventColor||w?.eventColor||Mx;if(i.cls=y.cls.clone(),i.solidBar=R||C,i.iconStyle=o.iconTarget==="header"&&o.showTime&&!S.isNamedColor(_)?{color:_}:{},i.iconCls=new Q(y.iconCls),i.style=Object.assign(S.parseStyle(w?.eventStyle),S.parseStyle(y.style)),i.eventColor=_,i.eventHeight=l,i.cls[o.shortEventCls]=y.durationMS<=o.shortEventDuration,w!=null&&w.cls&&i.cls.add(w.cls),r&&!C){const xe=o.callback(r,o,[{eventRecord:y,resourceRecord:w,renderData:i}]);i.eventHeight!==l&&(x.height=S.setLength(i.eventHeight)),xe!=null&&(L=!0,A=xe,typeof A!="string"&&(A=W.asArray(A),O="children")),typeof i.cls=="string"&&(i.cls=new Q(i.cls)),typeof i.iconCls=="string"&&(i.iconCls=new Q(i.iconCls)),typeof i.style=="string"&&(i.style=S.parseStyle(i.style))}A=[{className:{"b-cal-event-desc":1,"b-cal-event-desc-complex":L},[O]:A}],Object.assign(i.cls,{"b-cal-event-wrap":1,"b-iscreating":y.isCreating,"b-readonly":y.readOnly,"b-minimal":C,[u]:u&&R,[h]:h&&i.solidBar,[d]:d&&!R,[f]:f&&D<new Date,[k]:k&&v?.isEventSelected(y),"b-rtl":p}),_=i.eventColor,(s=_)!==null&&s!==void 0&&s.length&&(S.isNamedColor(_)?i.cls[`b-cal-color-${_}`]=1:i.solidBar?x["background-color"]=_:x[o.eventColourStyleProperty]=_),g&&!(R&&this.showAllDayHeader)&&A.unshift({className:"b-event-header",children:[{className:"b-event-time",html:b.format(y.startDate,m)}]});const V=Boolean((a=i.iconCls)===null||a===void 0?void 0:a.length),Y=!V&&E,J=o.showCircle&&!V&&!E,X={tag:"i",className:Object.assign({"b-cal-event-icon":!Y,"b-cal-recurrence-icon":Y,"b-icon":1,"b-fw-icon":1,"b-icon-circle":J,"b-icon-recurring":Y},i.iconCls),style:i.iconStyle},q=[{className:"b-cal-event-body",children:A}],oe=o.iconTarget==="header"&&o.showTime?A[0].children.length>0?A[0].children:A:q;return(V||Y||J)&&(o.iconTarget==="header"&&o.showTime?oe.push(X):oe.unshift(X)),V&&E&&oe.push({tag:"i",className:{"b-cal-recurrence-icon":1,"b-icon":1,"b-fw-icon":1,"b-icon-recurring":1},style:i.iconStyle}),{tabIndex:C?null:0,dataset:I,className:i.cls,style:i.style,children:[{className:"b-cal-event",style:x,children:C?null:q}]}}internalBodyContentRenderer(i){var r;const n=z.encodeHtmlBR(i.name),{showResourceAvatars:s}=this;if(s&&(r=i.assigned)!==null&&r!==void 0&&r.size){const a=[{class:"b-cal-event-resource-avatars",children:i.resources.map(o=>this.getResourceAvatar(o))},{tag:"span",class:"b-cal-event-name",html:n}];return s==="last"?a.reverse():a}else return n}},M(e,"$name","EventRenderer"),M(e,"configurable",{eventRenderer:null}),e};const kx={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",EventEdit:{Calendar:"Calendar","All day":"All day",day:"Day",week:"Week",month:"Month",year:"Year",decade:"Decade"},EventMenu:{duplicateEvent:"Duplicate event",copy:"copy"},Calendar:{Today:"Today",next:c=>`Next ${c}`,previous:c=>`Previous ${c}`,plusMore:c=>`+${c} more`,allDay:"All day",endsOn:c=>`Ends ${c}`,weekOfYear:([c,e])=>`Week ${e}, ${c}`,loadFail:"Calendar data load failed. Please contact your system administrator"},CalendarDrag:{holdCtrlForRecurrence:"Hold CTRL for a recurring event"},CalendarMixin:{eventCount:c=>`${c||"No"} event${c===1?"":"s"}`},EventTip:{"Edit event":"Edit event",timeFormat:"LST"},ModeSelector:{includeWeekends:"Include weekends",weekends:"Weekends"},AgendaView:{Agenda:"Agenda"},MonthView:{Month:"Month",monthUnit:"month"},WeekView:{weekUnit:"week"},YearView:{Year:"Year",yearUnit:"year"},EventList:{List:"List",Start:"Start",Finish:"End"},DayView:{Day:"Day",dayUnit:"day",daysUnit:"days",expandAllDayRow:"Expand all-day section",collapseAllDayRow:"Collapse all-day section",timeFormat:"LST"},Sidebar:{"Filter events":"Filter events"},WeekExpander:{expandTip:"Click to expand row",collapseTip:"Click to collapse row"}};Be.publishLocale(kx);const Ix=Promise.resolve(),Fx=Object.freeze({}),{eventNameMap:Ax}=B,Lx=c=>c.isCalendarMixin&&c.containsFocus;var rn=c=>{var e;return e=class tv extends(c||P).mixin(Op,Qp,zg,Jp,ev,Zn){static get configurable(){return{localizableProperties:["autoCreate.newName"],eventStore:null,resourceStore:null,eventSorter:Es.defaultSorterFn,responsive:{},hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",weekStartDay:b.weekStartDay,nonWorkingDays:{value:b.nonWorkingDays,$config:{merge:"replace"}},nonWorkingDayCls:"b-nonworking-day",dayCellCls:"b-calendar-cell",weekendCls:"b-weekend",todayCls:"b-today",pastEventCls:"b-past-event",shortEventCls:"b-short-event",shortEventDuration:"30 minutes",eventHeight:25,eventSpacing:2,intradayCls:"b-intraday",alldayCls:"b-allday",solidBarCls:"b-solid-bar",dayNameSelector:".b-day-name",showTime:!1,timeFormat:"LT",showCircle:!0,eventColourStyleProperty:"color",handlePointerInteraction:!0,shortDateFormat:"ll",shortDateTimeFormat:"ll LT",readOnly:null,autoCreate:{gesture:"dblclick",newName:"L{Object.newEvent}",step:"15 minutes",duration:"1 hour",startHour:8},autoRefresh:{$config:{merge:"classList"},value:null},allowOverlap:!0,syncViewDate:!0,focusable:!1,avatarRendering:{$config:"lazy",value:null},showResourceAvatars:null,resourceImagePath:null,minDate:null,maxDate:null,animateTimeShift:!0,includeTimeRanges:null,testConfig:{animateTimeShift:!1}}}static get delayable(){return{refreshSoon:{type:"raf",cancelOutstanding:!0}}}static get featureable(){return{factory:dt}}construct(i){var r;const n=this;super.construct(i),!n.isYearView&&n.element.tabIndex!==-1&&((r=n.contentElement)===null||r===void 0?void 0:r.tabIndex)!==-1&&((n.contentElement||n.element).tabIndex=-1),n.getConfig("avatarRendering"),B.on({element:n.element,keydown:"onCalendarKeyDown",thisObj:n}),n.handlePointerInteraction&&B.on({element:n.element,mouseover:"onEventMouseOverOut",mouseout:"onEventMouseOverOut",mousedown:"onCalendarPointerInteraction",mouseup:"onCalendarPointerInteraction",click:{handler:"onCalendarPointerInteraction",block:300},dblclick:"onCalendarPointerInteraction",contextmenu:"onCalendarPointerInteraction",thisObj:n})}getTimeRanges(i,r){const{resourceId:n,project:s}=this,a=n?this.owner.includeTimeRanges:!0,o=n==null||a?s?.getTimeRanges(i,r):[];if(n!=null){const l=s?.getResourceTimeRanges(i,r).filter(d=>d.resourceId==n);l.forEach(d=>{d.color||(d.color=this.resource.eventColor)}),o.push(...l)}return o}updateIncludeTimeRanges(){this.isConfiguring||this.refresh()}onConfigChange(i){var r;(r=this.autoRefresh)!==null&&r!==void 0&&r[i?.name]&&this.refreshSoon(),super.onConfigChange(i)}changeAvatarRendering(i){return Di.new({element:this.element},i)}updateShowResourceAvatars(i){i&&(this.avatarRendering||(this.avatarRendering=!0))}getResourceAvatar(i){return this.avatarRendering.getResourceAvatar({resourceRecord:i,imageUrl:i.image===!1?null:i.imageUrl||i.image&&this.resourceImagePath+i.image,color:i.eventColor,initials:i.initials,dataset:{btip:z.encodeHtml(i.name),resourceId:i.id}})}updateEventHeight(i){const{style:r}=this.element;this._eventHeightInPixels=null,r.setProperty("--event-height",S.setLength(i)),r.setProperty("--arrow-width","calc(var(--event-height) / 3)"),r.setProperty("--arrow-margin","calc(var(--event-height) / -3)"),this.isConfiguring||this.refreshSoon()}get eventHeightInPixels(){const i=this,{eventHeight:r}=i;let n=i._eventHeightInPixels;return r!=="auto"&&(n||(n=i._eventHeight,typeof n=="string"&&(n=S.measureSize(n,i.contentElement.querySelector(`.${i.eventBarContainerCls}`),!1)),i._eventHeightInPixels=n)),n}get visibleCellSelector(){const i=[];return this.hideOtherMonthCells&&i.push(`.${this.otherMonthCls}`),this.hideNonWorkingDays&&i.push(`.${this.nonWorkingDayCls}`),`.${this.dayCellCls}${i.length?`:not(${i.join(",")})`:""}`}get activeView(){return this}get activeSubView(){var i;const{items:r}=this;return((i=r.filter(Lx))===null||i===void 0?void 0:i[0])||this}eachView(i,r,n=null){this.callback(i,n||this,r||[this])}get focusElement(){const{calendar:i}=this;if(i){const{navigator:r}=i;return r.activeItem||r.previousActiveItem||this.element.querySelector(r.itemSelector)||super.focusElement}}captureFocusItem(i){const r=this.getEventRecord(i),n=super.captureFocusItem(i);return(s=!0)=>{const a=r&&this.getEventElement(r);a?s?a.focus():S.focusWithoutScrolling(a):n?.(s)}}refresh(){this.refreshSoon.cancel(),this.month&&this.element.style.setProperty("--week-length",this.month.weekLength),this.whenVisible("refreshNow")}refreshNow(){const i=this.captureFocus();this.doRefresh(),i()}get displayName(){return z.capitalize(this.title||this.type)}get hiddenNonWorkingDays(){return this.hideNonWorkingDays?this.nonWorkingDays||this.month.nonWorkingDays:Fx}changeAutoCreate(i){const r=tv.$meta.config.autoCreate;return i===!0?r:(typeof i=="string"&&(i={gesture:i}),pe.merge(i,r))}updateDateSeparator(){this.refreshCalendarDescription()}updateDescriptionFormat(){this.refreshCalendarDescription()}refreshCalendarDescription(){const{calendar:i}=this;i!=null&&i.isPainted&&i.activeView===this&&i.updateViewDescription()}changeShortEventDuration(i){return isNaN(i)?b.as("ms",i):Number(i)}updateShortEventDuration(){this.isConfiguring||this.refresh()}updateLocalization(){"weekStartDay"in this.initialConfig||(this.weekStartDay=b.weekStartDay),"nonWorkingDays"in this.initialConfig||(this.nonWorkingDays=b.nonWorkingDays),super.updateLocalization(),this.refreshCalendarDescription()}updateAutoCreate(i){this.updateLocalization()}updateWeekStartDay(i){var r;const{refreshCount:n,month:s}=this;(r=super.updateWeekStartDay)===null||r===void 0||r.call(this,i),s&&(s.weekStartDay=i),this.isPainted&&this.refreshCount===n&&this.refresh()}changeNonWorkingDays(i){const r=this;return new Proxy(T.assign({},i),{set(s){const a=Reflect.set(...arguments);return r.updateNonWorkingDays(s),a},deleteProperty(s){const a=Reflect.deleteProperty(...arguments);return r.updateNonWorkingDays(s),a}})}updateNonWorkingDays(i){var r;const{refreshCount:n,month:s}=this;(r=super.updateNonWorkingDays)===null||r===void 0||r.call(this,i),s&&(s.nonWorkingDays=i),this.isPainted&&this.refreshCount===n&&this.refresh()}dayOfDate(i){return b.clearTime(i)}ingestDate(i){if(i=typeof i=="string"?b.parse(i):new Date(i),isNaN(i))throw new Error("Calendar widget date ingestion must be passed a Date, or a YYYY-MM-DD date string");return this.dayOfDate(i)}changeDate(i,r){if(i=this.ingestDate(i),!(!this.isInIsValidTargetDate&&!this.isValidTargetDate(i))&&(!r||i-r)&&this.trigger("beforeDateChange",{date:i,oldDate:r})!==!1)return i}isValidTargetDate(i,r){var n,s;const a=this,o=a.minDate||((n=a.calendar)===null||n===void 0?void 0:n.minDate),l=a.maxDate||((s=a.calendar)===null||s===void 0?void 0:s.maxDate);if(!isNaN(o)||!isNaN(l)){this.isInIsValidTargetDate=!0;const d=r?a[`change${z.capitalize(r)}Date`](i,null):i;if(a.isInIsValidTargetDate=!1,!isNaN(o)&&d<o)return!1;if(!isNaN(l))return!(r==="end"?d>l:d>=l)}return!0}changeStartDate(i){if(i&&(i=this.ingestDate(i),this.isInIsValidTargetDate||this.isValidTargetDate(i,"start")))return i}changeEndDate(i){if(i&&(i=this.ingestDate(i),this.isInIsValidTargetDate||this.isValidTargetDate(i,"end")))return i}async scrollTo(i,r={animate:!0}){const n=this,{scrollable:s}=n;let a=Ix;if(n.scrollPromise&&await n.scrollPromise,i.isEvent){const o=i;b.intersectSpans(n.startDate,n.endDate,i.startDate,i.endDate)||(n.date=i.startDate),i=n.getEventElement(i),i||(n.refresh(),i=n.getEventElement(o))}else i=n.changeDate(i),(!b.betweenLesser(i,n.startDate,n.endDate)||!n.getDayElement(i,!0))&&(n.date=i),i=n.getDayElement(i);return s?a=s.scrollIntoView(i,r):r.highlight&&(typeof r.highlight=="boolean"?S.highlight($.from(i)):n.callback(r.highlight,n,[i,n])),n.scrollPromise=a}async checkAutoCreateGesture(i,r){var n,s;if(r&&this.isVisible&&!this.readOnly&&i.type===((n=this.autoCreate)===null||n===void 0||(s=n.gesture)===null||s===void 0?void 0:s.toLowerCase()))return this.createEvent(r)}createEvent(i){var r;(this.calendar||((r=this.owner)===null||r===void 0?void 0:r.calendar)||this).doCreateEvent(i,this)}async doCreateEvent(i,r=this){var n;const s=this.autoCreate;s||(this.autoCreate=!0);const a=this,o=a.calendar||((n=a.owner)===null||n===void 0?void 0:n.calendar),{eventStore:l}=o,{autoCreate:d,defaultCalendar:u}=a,{modelClass:h}=l,{newName:f}=d,g=b.startOf(i,void 0,void 0,a.weekStartDay),m=isNaN(d.startHour)?b.getTimeOfDay(b.parse(d.startHour,"HH:mm:ss")):d.startHour*1e3*60*60,p=a.isDayView?b.round(i,d.step):b.add(g,m),v=b.parseDuration(d.duration),y=b.as("ms",v),C=b.add(p,y),D=a.resolveCallback(f,a,!1)?a.callback(f,a,[a,p]):f,w={[h.getFieldDataSource("name")]:D,[h.getFieldDataSource("startDate")]:p,[h.getFieldDataSource("endDate")]:C,[h.getFieldDataSource("duration")]:v.magnitude,[h.getFieldDataSource("durationUnit")]:v.unit,allDay:b.diff(p,C,"day")===1},E=l.createRecord(w);o!=null&&o.features.eventEdit&&!o.features.eventEdit.disabled&&(E.isCreating=!0),u&&l.assignmentStore.assignEventToResource(E,u),await l.addAsync(E),r.editAutoCreatedEvent(E),s||(a.autoCreate=!1)}editAutoCreatedEvent(i){this.trigger("eventAutoCreated",{eventRecord:i})}get duration(){return this.endDate?this.calculateDuration(this.startDate,this.endDate):1}calculateDuration(i,r){return b.diff(i,r,"day")}next(){this.date=b.add(this.date,this.duration,"day")}previous(){this.date=b.add(this.date,-this.duration,"day")}get eventContentElement(){return this.contentElement}get firstVisibleCell(){return this.eventContentElement.querySelector(this.visibleCellSelector)}get lastVisibleCell(){const i=this.contentElement.querySelectorAll(this.visibleCellSelector);return i[i.length-1]}get firstVisibleDate(){const i=new Date(this.startDate),{month:r}=this.month;for(;this.hideOtherMonthCells&&i.getMonth()!==r||this.hiddenNonWorkingDays[i.getDay()];)i.setDate(i.getDate()+1);return i}get lastVisibleDate(){const i=b.add(this.endDate,-1,"d"),{month:r}=this.month;for(;this.hideOtherMonthCells&&i.getMonth()!==r||this.hiddenNonWorkingDays[i.getDay()];)i.setDate(i.getDate()-1);return i}updateHideNonWorkingDays(i){var r,n;const s=this,{month:a,calendar:o}=s;if((r=s.contentElement)===null||r===void 0||r.classList[i?"add":"remove"](s.hideNonWorkingDaysCls),a==null)return;let l,d,u;if(!s.isConfiguring&&i){var h;d=s.date,u=(h=d)===null||h===void 0?void 0:h.getDay(),d&&s.nonWorkingDays[u]&&s.getDayElement(d)&&(l=a.visibleDayColumnIndex[u])}if(a.hideNonWorkingDays=i,(n=super.updateHideNonWorkingDays)===null||n===void 0||n.call(this,i),typeof l=="number"){const f=a.getWeekStart(a.getWeekNumber(d)),g=Math.min(l,a.visibleColumnCount-1);for(let m=-1;!(typeof a.visibleDayColumnIndex[f.getDay()]=="number"&&++m===g);f.setDate(f.getDate()+1));s.date=f,o&&(o.date=d)}}onCalendarStoreChange({source:i,action:r}){const n=this;if(!(r==="dataset"&&!i.isChained)&&n.project.isInitialCommitPerformed&&!n.project.isWritingData){var s;(s=n._cellMap)===null||s===void 0||s.clear(),n.refreshSoon()}}refreshSoon(){this.refresh()}onEventCreated(i){}getEventRecord(i){var r;let n=i instanceof Event?i.target:i;return n=((r=n)===null||r===void 0?void 0:r.closest("[data-event-id]"))||null,n&&this.eventStore.getById(n.dataset.eventId)}resolveEventRecord(i){return this.getEventRecord(i)}getDateFromElement(i){let r=i?.closest("[data-date],[data-header-date],[data-month-date]");if(r)return this.dayTime.parseKey(r.dataset.date||r.dataset.headerDate||r.dataset.monthDate);if(r=i?.closest("[data-week]"),r){var n;return(n=this.month)===null||n===void 0?void 0:n.getWeekStart(r.dataset.week.split(",").map(Number))}}getDateFromDomEvent(i){return this.getDateFromElement(S.getEventElement(i))}getDateFromPosition(){return null}dateKey(i){return b.makeKey(i)}getDayElement(i,r){return typeof i!="string"&&(i=this.dateKey(i)),this.eventContentElement.querySelector(`[data-date="${i}"]`)}getEventElement(i,r=Math.max(i.startDate,this.firstVisibleDate||this.startDate)){var n;const s=this,a=(n=s.calendar)===null||n===void 0?void 0:n.navigator.activeItem,o=s.getDateFromElement(a),l=s.eventStore.modelClass.asId(i);if(document.contains(a)&&a?.dataset.eventId===String(l)&&o&&!(r-o))return a;if(r){const d=s.getDayElement(r);if(d)return S.down(d,`[data-event-id="${l}"]`)}return s.getEventElements(i)[0]}getEventElements(i){const r=this.eventStore.modelClass.asId(i);return this.eventContentElement.querySelectorAll(`[data-event-id="${r}"]`)}onEventMouseOverOut(i){const r=this,{currentOverEventEl:n}=r,s=i.type==="mouseout",a=i[s?"relatedTarget":"target"],o=a?.closest(".b-cal-event-wrap")||null;if(o!==(n||null))return s?(r.currentOverEventEl=null,n&&Object.defineProperty(i,"target",{configurable:!0,get:()=>n}),r.onCalendarPointerInteraction(i)):(r.currentOverEventEl=o,r.onCalendarPointerInteraction(i))}calendarHitTest(i){const r=this,{monthSelector:n}=r,s=r.getDateFromDomEvent(i),a=S.getEventElement(i);let o=null,l;if(l=a.closest(".b-cal-event-wrap"))o={type:"event",eventElement:l,eventRecord:r.eventStore.getById(l.dataset.eventId)};else if(l=a.closest(r.dayNameSelector))o={type:"dayNumber",dayNumberElement:l};else if(l=a.closest(".b-week-num,.b-week-number-cell")){const d=a.closest(".b-calendar-week");d&&d.dataset.week&&(o={type:"weekNumber",week:d.dataset.week.split(",").map(Number),weekNumberElement:l,weekElement:d})}else n&&a.closest(n)&&(o={type:"monthName",month:s.getMonth(),date:s});return o||((l=a.closest(".b-cal-cell-overflow"))?o={type:"cellOverflow",cellOverflowElement:l}:s&&(o={type:"schedule"})),o&&(o.cell=a.closest(".b-calendar-cell"),o.date=s,o.view=r),o}onCalendarPointerInteraction(i){const r=this,{monthSelector:n}=r,{target:s}=i,a=Boolean(s.closest(".b-overflowpopup")),o=Ax[i.type],l=r.getDateFromDomEvent(i),d=s.closest(".b-cal-event-wrap"),u=d?r.eventStore.getById(d.dataset.eventId):r.getEventRecord(s),h=d||u&&r.getEventElement(u,l),f=s.closest("[data-resource-id]"),g=f&&r.resourceStore.getById(f.dataset.resourceId);let m;if(g&&(m=r.trigger(`resource${o}`,{domEvent:i,date:l,eventElement:h,eventRecord:u,resourceRecord:g,fromOverflowPopup:a})),!(!a&&!r.eventContentElement.contains(s))){if(m!==!1&&u){const p=r.trigger(`event${o}`,{domEvent:i,date:l,eventElement:h,eventRecord:u,resourceRecord:g,fromOverflowPopup:a});p&&(m=p)}if(u||g||s.closest(r.dayNameSelector)&&(m=r.trigger(`dayNumber${o}`,{domEvent:i,date:l,cellData:r.cellMap.get(l)||r.createCellData(l),fromOverflowPopup:a}),m===!1))return m;if(s.closest(".b-week-num,.b-week-number-cell")){const p=i.target.closest("[data-week]");if(p)return r.trigger(`weekNumber${o}`,{domEvent:i,week:p.dataset.week.split(",").map(Number),date:r.getDateFromElement(p.querySelector(".b-calendar-cell")),fromOverflowPopup:a})}if(n&&s.closest(n))return r.trigger(`monthName${o}`,{domEvent:i,month:l.getMonth(),date:l,fromOverflowPopup:a});if(!(s.closest(".b-cal-cell-overflow")&&r.trigger(`cellOverflow${o}`,{domEvent:i,date:l,fromOverflowPopup:a})!==!1))return l&&r.dayCellCls&&i.target.closest(`.${r.dayCellCls}`)&&(m=r.trigger(`schedule${o}`,{domEvent:i,date:l,fromOverflowPopup:a}),m===!1)||r.checkAutoCreateGesture(i,l),m}}onCalendarKeyDown(i){var r;if(i.ctrlKey&&i.key.toLowerCase()==="z"&&(r=this.calendar)!==null&&r!==void 0&&r.enableUndoRedoKeys){var n,s;(n=this.project)===null||n===void 0||(s=n.stm)===null||s===void 0||s.onUndoKeyPress(i)}else this.onCalendarPointerInteraction(i)}isAllDayEvent(i){return i.allDay||(i.isScheduled&&this.dayTime?this.dayTime.isInterDay(i):i.isInterDay)}sortEvents(i){i.sort(this.eventSorter)}preProcessCurrentConfigs(i){super.preProcessCurrentConfigs(i),delete i.calendar,delete i.project}getCurrentConfig(i){const r=super.getCurrentConfig(i);return delete r.project,r}},M(e,"$name","CalendarMixin"),e};const Ox=({key:c},{key:e})=>c<e?-1:e<c?1:0,Px=c=>c.endDate||b.add(c.startDate,c.duration,c.durationUnit);var xs=c=>class extends(c||P){static get $name(){return"DayCellCollecter"}static get configurable(){return{eventFilter:null}}get dayTime(){return me.MIDNIGHT}get cellMonth(){return this._cellMonth||(this._cellMonth=new Ot({}))}createCellMap(t={}){const i=this,{filter:r,skipPropagate:n}=t,{eventFilter:s,cellMonth:a,lastVisibleDate:o}=i,l=t.cellMap||i._cellMap||(i._cellMap=new $x);o&&o.setDate(o.getDate()+1);let d=t.startDate||i.firstVisibleDate||i.startDate,u=t.endDate||o||i.endDate;if(a.configure({weekBase:null,weekStartDay:i.weekStartDay,nonWorkingDays:i.nonWorkingDays,hideNonWorkingDays:i.hideNonWorkingDays,sixWeeks:i.sixWeeks,date:d}),i.eventStore){t=T.assign({dayTime:me.MIDNIGHT},t,{filter:r&&s?h=>r(h)&&s(h):r||s,dateMap:l,startDate:d,endDate:u}),i.collectEvents(t),d=t.startDate,u=t.endDate;for(const[h,f]of l){let g=0;i.sortEvents(f);const m=t.dayTime,p=m.dayOfDate(b.parseKey(h)),v=i.createCellData(p);if(t.rawEvents?(g=Math.min(u,Math.max.apply(Math,f.map(Px))),v.events=f):v.events=f.map(y=>{const C=y.endingDate,D=C>v.tomorrow,w={isAllDay:i.isAllDayEvent(y),isOverflow:y.startDate<v.date&&p-d,eventRecord:y,eventEndDate:C,overflows:D,date:p};return n||(g=Math.min(u,Math.max(g,C)),D&&(w.propagateEndDate=i.calculatePropagateEndDate(w,u))),w}),!n)for(;p<g;p.setDate(p.getDate()+1)){const y=m.dateKey(p);l.has(y)||l.set(y,[])}l.set(h,v)}if(l.size){const h=[...l.values()].sort(Ox);let f;l.clear(),h.forEach(g=>{l.set(g.key,g),f&&(f.nextEvents=g,g.previousEvents=f),f=g}),n||i.propagateCellEvents(h[0],l)}}return l.populated=!0,l}calculatePropagateEndDate(t,i=this.endDate){const{eventEndDate:r}=t,n=this.dayTime.startOfDay(r);return t.propagateEndDate=new Date(Math.min(r>n?b.add(n,1,"day"):r,i)),this.trigger("eventPropagate",t),t.propagateEndDate}collectEvents(t){return this.eventStore.getEvents(t)}propagateCellEvents(t,i){const{events:r,renderedEvents:n,previousEvents:s,nextEvents:a,date:o}=t,l=this.getEventsPerCell(o),{length:d}=r;for(let h=0;h<d;h++){const f=r[h],{eventRecord:g,propagateEndDate:m,eventEndDate:p}=f;let v=n.add(f);if(f.overflows){let y=t.visible,C;for(let D=a;D&&D.date<m;D=D.nextEvents)D.columnIndex||(v=D.renderedEvents.firstFreeSlot),D.renderedEvents.set(v,C={eventRecord:g,eventEndDate:p,propagateEndDate:m,isAllDay:f.isAllDay,isOverflow:y,overflows:!0}),y=y||D.visible;C&&(C.overflows=!1)}}t.maxRow=n.length;const u=n[l-1];if(n.length===l)u!=null&&u.isOverflow&&s!==null&&s!==void 0&&s.hasOverflow&&(t.maxRow--,t.hasOverflow=!0);else if(n.length>l&&(t.maxRow=l-1,t.hasOverflow=!0,u!=null&&u.isOverflow)){const h=this.firstVisibleDate,f=b.clearTime(u.eventRecord.startDate).valueOf();let g=i.get(b.makeKey(new Date(Math.max(h,f))));for(;g.key!==t.key;)g.hasOverflow=!0,g.maxRow=l-1,g=g.nextEvents}a&&this.propagateCellEvents(a,i)}createCellData(t){return Object.assign(this.cellMonth.getCellData(t,this.month,this.dayTime),{events:[],renderedEvents:new ic})}};class $x extends Map{constructor(...e){super(...e),M(this,"populated",!1)}get(e,t){return super.get(b.makeKey(e),t)}set(e,t){return e=b.makeKey(e),this.has(e)||(this.generation=(this.generation||0)+1),super.set(e,t)}delete(e,t){return e=b.makeKey(e),this.has(e)&&this.generation++,super.delete(e,t)}has(e){return super.has(b.makeKey(e))}clear(){return this.populated=!1,this.generation=(this.generation||0)+1,super.clear()}}class rc extends We{static get $name(){return"OverflowPopup"}static get type(){return"overflowpopup"}static get configurable(){return{textContent:!1,autoShow:!1,floating:!1,cls:"b-cal-event-list",closable:!0,draggable:{handleSelector:":not(.b-cal-event-wrap)"},anchor:!0,layout:"vbox",eventRenderer:null,eventSorter:Es.interDaySorterFn,eventList:{type:"widget",cls:"b-cal-event-bar-container",weight:500},items:{},tools:{maximize:null},dateFormat:"dddd, MMM DD",activeDate:{$config:{equal:"date"},value:null},scrollAction:"hide",align:{axisLock:"flexible",constrainPadding:20,minHeight:400},scrollable:{overflowY:"auto"},onlyShowOverflow:null}}calendarHitTest(e){const t=S.getEventElement(e),i=t.closest(".b-cal-event-wrap");return i?{type:"event",eventElement:i,eventRecord:this.owner.eventStore.getById(i.dataset.eventId),view:this}:null}onHeaderClick({event:e}){if(e.target.closest(".b-header-title")){var t;(t=this.owner)===null||t===void 0||t.trigger("dayNumberClick",{domEvent:e,date:this.activeDate,cellData:this.cellData,source:this.owner,fromOverflowPopup:!0})}else super.onHeaderClick(...arguments)}get focusElement(){var e,t;const i=S.getActiveElement(this);return this.element.contains(i)?i:((e=this.eventList)===null||e===void 0||(t=e.element)===null||t===void 0?void 0:t.firstElementChild)||super.focusElement}getDateFromPosition(){return this.activeDate}getEventElement(e){return this.contentElement.querySelector(`[data-event-id="${e.id}"]`)}showOverflow(e,t){const i=this.activeDate=t.date;if(this.cellData=t,this.targetCell=e,this.refresh(t),this.showBy(e),this.isVisible){var r;(r=this.owner)===null||r===void 0||r.trigger("showOverflowPopup",{cell:e,cellData:t,date:i,overflowPopup:this})}}onCalendarStoreChange(){const e=this;e.isVisible&&(e.cellData=e.owner.cellMap.get(b.makeKey(e.activeDate)),e.refresh(e.cellData))}refresh(e){var t,i;if(!this.eventList)return;e?this.cellData=e:e=this.cellData;const r=this,{owner:n,eventRenderer:s}=r,{element:a}=r.eventList,o=r.onlyShowOverflow?Math.max(n.eventsPerCell-1,0):0,l=(t=e)===null||t===void 0?void 0:t.renderedEvents.slice(o).sort(r.eventSorter),d=[];if(!(l!=null&&l.length)||!((i=e)!==null&&i!==void 0&&i.hasOverflow)&&!n.isYearView)return r.hide();for(let u=0,h=0,{length:f}=l;u<f;u++,h++){const g=l[u];if(g){const m=n.createEventDomConfig(g,s);Object.assign(m.className,{"b-continues-past":g.eventRecord.startDate<e.date,"b-continues-future":g.eventRecord.endDate>e.tomorrow}),m.style.marginBottom=`${n.eventSpacing}px`,d.push(m)}}Z.sync({domConfig:{children:d},targetElement:a}),a.dataset.date=e.key,a.classList.add(`b-day-of-week-${e.day}`),a.classList.remove(`b-day-of-week-${r.lastRefreshDay}`),r.lastRefreshDay=e.day,r.realign()}changeItems(e){const{eventList:t}=this;t&&(e.eventList=t);const i=super.changeItems(e);return t&&(this.eventList=this.widgetMap.eventList),i}changeActiveDate(e,t){if(e=typeof date=="string"?b.parse(e):new Date(e),isNaN(e))throw new Error("OverflowPopup date ingestion must be passed a Date, or a YYYY-MM-DD date string");return e}updateActiveDate(e){this.element.dataset.date=b.makeKey(e),this.title=b.format(e,this.dateFormat)}onDocumentMouseDown({event:e}){var t;const i=(t=this.lastAlignSpec)===null||t===void 0?void 0:t.target,{target:r}=e;if(i!=null&&i.contains(r)){const n=r.closest(".b-cal-cell-overflow");if(r.closest(".b-cal-event-bar-container")||r.matches(".b-cal-cell-overflow")||n?.children.length===1)return e.preventDefault()}super.onDocumentMouseDown(...arguments)}}rc.initClass();rc._$name="OverflowPopup";const _x=()=>{},{eventNameMap:Hx}=B;var nc=c=>class extends(c||P){static get $name(){return"DayCellRenderer"}static get configurable(){return{monitorResize:!0,dayCellRenderer:null,dynamicHideNonWorkingdayCls:"b-dynamic-nonworking-day",overflowPopup:{$config:["lazy","nullify"],value:{type:"overflowpopup"}},overflowPopupTrigger:"click",eventBarContainerCls:"b-cal-event-bar-container",overflowButtonRenderer:null,dayCellNameFormat:null,eventSpacing:2,emptyCellCls:"b-cal-empty-cell",emptyCellRenderer:null}}onCalendarStoreChange(){var t;super.onCalendarStoreChange(...arguments),(t=this._overflowPopup)!==null&&t!==void 0&&t.isVisible&&this._overflowPopup.onCalendarStoreChange(...arguments)}onCellOverflowGesture({domEvent:t,date:i}){const r=this,n=r.cellMap.get(b.makeKey(i));if(n){const{overflowPopup:s}=r,a=r.getCellFromEvent(t);s&&r.trigger("beforeShowOverflowPopup",{cell:a,cellData:n,date:i,overflowPopup:s})&&s.showOverflow(a,n)}}getCellFromEvent(t){return t.target.closest(".b-calendar-cell[data-date]")}updateOverflowPopupTrigger(t){this.onCellOverflowClick=this.onCellOverflowMouseOver=_x,t=t.toLowerCase(),(t==="mouseover"||t==="hover")&&(t="mouseOver"),this[`onCellOverflow${z.capitalize(t)}`]=this.onCellOverflowGesture}changeOverflowPopup(t,i){const r=this,n=r.up("calendar")||r.owner||r,s=rc.reconfigure(i,t,{owner:r,defaults:{owner:r,align:{constrainTo:globalThis}}});if(s){const{element:a}=s,{eventHeightInPixels:o}=r;s.element.classList.add(`b-${r.type}-overflowpopup`),s.floating||(s.positioned=!0,s.render(n.isCalendar?n.element:n.contentElement)),o&&(a.style.setProperty("--event-height",`${o}px`),a.style.setProperty("--arrow-width",`${o/3}px`)),s!==i&&n!==r&&(B.on({thisObj:r,element:s.bodyElement,delegate:".b-cal-event-wrap",mouseover:"onEventMouseOverOut",mouseout:"onEventMouseOverOut",mousedown:"onCalendarPointerInteraction",mouseup:"onCalendarPointerInteraction",click:"onCalendarPointerInteraction",dblclick:"onCalendarPointerInteraction",contextmenu:"onCalendarPointerInteraction"}),s.headerElement&&B.on({thisObj:r,element:s.headerElement,mousedown:"onCalendarPointerInteraction",mouseup:"onCalendarPointerInteraction",click:"onCalendarPointerInteraction",dblclick:"onCalendarPointerInteraction",contextmenu:"onCalendarPointerInteraction"}))}return s}onInternalResize(t,i,r,n,s){const{_eventsPerCell:a,_eventContainerTop:o}=this;super.onInternalResize(t,i,r,n,s),this.rendered&&r!==s&&this.performResizeRefresh(a,o)}performResizeRefresh(t,i,r){this._eventsPerCell=this._eventContainerTop=this._eventContainerHeight=null;const n=this,{eventsPerCell:s,_overflowPopup:a}=n;s!==t&&n.trigger("eventsPerCellChange",{value:s,oldValue:t}),(n.eventContainerTop!==i||s!==t)&&(r?n.doRefresh():n.refresh(),a!=null&&a.isVisible&&a.refresh(n._cellMap.get(b.makeKey(a.activeDate))))}updateEventHeight(){super.updateEventHeight(...arguments),this._eventsPerCell=null}updateEventSpacing(){this._eventsPerCell=null,this.isConfiguring||this.refreshSoon()}get weeksElement(){return this.contentElement}get eventContainerHeight(){if(this._eventContainerHeight==null&&this.isVisible&&!this.isConfiguring){const{firstVisibleCell:t}=this;this._eventContainerHeight=t?t.offsetHeight-this.eventContainerTop:NaN}return this._eventContainerHeight}get eventContainerTop(){const t=this;if(t._eventContainerTop==null&&t.isVisible&&!t.isConfiguring){const{firstVisibleCell:i}=t,r=i&&i.querySelector(`.${t.eventBarContainerCls}`),n=r?r.getBoundingClientRect().top-r.offsetParent.getBoundingClientRect().top:0;t._eventContainerTop=n===0?null:n}return t._eventContainerTop||0}getEventsPerCell(t){return this.eventsPerCell}get eventsPerCell(){const t=this;return t._eventsPerCell==null&&(t._eventsPerCell=Math.floor((t.eventContainerHeight+t.eventSpacing)/(t.eventHeightInPixels+t.eventSpacing))),t._eventsPerCell}get cellMap(){var t;return(t=this._cellMap)!==null&&t!==void 0&&t.populated?this._cellMap:this.createCellMap()}cellRenderer({cell:t}){const i=this.getCellDomConfig(...arguments);Z.sync({domConfig:i,targetElement:t})}getCellDomConfig({cell:t,columnIndex:i,row:r,date:n,day:s,dayTime:a=me.MIDNIGHT,visibleColumnIndex:o,key:l}){var d;const u=this,{eventHeightInPixels:h,eventSpacing:f,weekLength:g,todayCls:m,emptyCellRenderer:p}=u,v=u.dayTime.startOfDay(((d=u.calendar)===null||d===void 0?void 0:d.dateTimeNow)||new Date),y=n.getTime()===v.getTime(),C=n.getDate(),D={className:u.eventBarContainerCls,role:"presentation",children:[],syncOptions:{syncIdField:"eventId",releaseThreshold:0,strict:!0}},w={style:{},className:new Q({"b-cal-cell-header":!0,[m]:y})},E={dataset:{},style:{},className:new Q(t?.className),children:[w,D]},R=!(n-(u.firstVisibleDate||-1));E.className[m]=y;let x,k=!u.isConfiguring&&u.cellMap.get(b.makeKey(n));u.addCellHeaderContent?x=u.addCellHeaderContent(w,k||(k=u.createCellData(n))):w.children=[x={className:{"b-day-name":!0}}];let I;if(u.dayCellRenderer&&!u.isConfiguring){k||(k=u.createCellData(n)),k.style=E.style,k.cls=E.className,k.headerStyle=w.style,k.headerCls=w.className;const A=k&&k.isNonWorking,L=u.callback(u.dayCellRenderer,u,[k,E]);typeof k.cls=="string"&&(E.className=new Q(k.cls)),typeof k.style=="string"&&(E.style=S.parseStyle(k.style)),typeof k.headerCls=="string"&&(w.className=new Q(k.headerCls)),typeof k.headerStyle=="string"&&(w.style=S.parseStyle(k.headerStyle)),L!=null&&(typeof L=="string"?x.html=L:(x.text=null,x.children=W.asArray(L))),I=!A&&k.isNonWorking}if(x&&(x.text||x.html||(x.text=u.dayCellNameFormat?b.format(n,u.dayCellNameFormat):C),(x.text||x.html)==C&&(x.className["b-day-num"]=!0)),k.visible){const{hasOverflow:A,renderedEvents:L,maxRow:O}=k,_=L,{length:V}=_,Y=D.children;E.className[u.nonWorkingDayCls]=k.isNonWorking,E.className[u.dynamicHideNonWorkingdayCls]=I,E.className[u.weekendCls]=b.weekends[s];for(let X=0,q=0;X<O;X++,q++){const oe=_[X];if(oe){const{eventRecord:xe,isOverflow:re,propagateEndDate:Se}=oe,ie=oe.eventEndDate||xe.endingDate,le=u.getDaySpan(n,Se||ie,a),ct=u.getDaySpan(n,ie,a,!0),nt=g-o,Nt=o&&re,xt=S.percentify(T.round((Nt?1:Math.min(le,nt))/g*100,4)),ar=u.createEventDomConfig(oe);Object.assign(ar.style,{width:xt,top:`${q*h+q*f+u.eventContainerTop}px`}),Object.assign(ar.className,{"b-overflow":Nt,"b-continues-past":!Nt&&(!o||R)&&xe.startDate<n,"b-continues-future":!Nt&&(ct>nt||ct>le)}),Y.push(ar)}}if(A?(r.classList.add("b-has-overflow"),E.children.push(u.getOverflowButtonDomConfig(V-Math.max(0,O)))):i||r.classList.remove("b-has-overflow"),(E.className[u.emptyCellCls]=!_.length)&&p){const X=typeof p,q=X==="function"||X==="string"?u.resolveCallback(p,u,!1):null;(q!=null&&q.handler?q.handler.call(q.thisObj,k):p)&&(D.children[0]={tag:"button",class:"b-cal-cell-no-content",children:[q!=null&&q.handler?q.handler.call(q.thisObj,k):p]})}}return E}onCalendarPointerInteraction(t){const i=this,{target:r}=t;return r.closest(`.${i.emptyCellCls} .${i.eventBarContainerCls}`)&&(!i.emptyCellRenderer||r.closest(".b-cal-cell-no-content"))&&i.trigger(`emptyCell${Hx[t.type]}`,{date:i.getDateFromDomEvent(t),domEvent:t})===!1?!1:super.onCalendarPointerInteraction(t)}getDaySpan(t,i,r,n){if(this.hideNonWorkingDays&&!n){let s=0;for(const a=new Date(t),o=r.ceil(i,"1 day");a<o;a.setDate(a.getDate()+1))this.nonWorkingDays[a.getDay()]||s++;return s}else return Math.max(b.diff(t,r.ceil(i,"1 day"),"day"),1)}getOverflowButtonDomConfig(t){const{overflowButtonRenderer:i}=this,r={tag:"button",className:{"b-cal-cell-overflow":1},text:this.L("L{Calendar.plusMore}",t),style:{lineHeight:`${this.eventHeightInPixels}px`,marginBottom:`${this.eventSpacing}px`},dataset:{eventId:"overflow"}};return i?this.callback(i,this,[r,t]):r}getCell(t){return typeof t!="string"&&(t=this.dayTime.dateKey(t)),this.contentElement.querySelector(`[data-date="${t}"]`)}getCellOverflowButton(t){var i;return(i=this.getCell(t))===null||i===void 0?void 0:i.querySelector(".b-cal-cell-overflow")}};const Nx={day:1,week:1,month:1,year:1,decade:1},Bx=(c,e)=>c?.unit===e?.unit&&c?.magnitude===e?.magnitude;var sc=c=>{var e;return e=class extends(c||P){previous(){const{range:i}=this;this.date=i?b.add(this.date,-i.magnitude,i.unit):b.add(this.date,-this.duration,"day")}next(){const{range:i}=this;this.date=i?b.add(this.date,i.magnitude,i.unit):b.add(this.date,this.duration,"day")}changeDate(i){if(i=super.changeDate(i||this.startDate),this.isConfiguring||this.isValidRange(this.range,i))return i}updateDate(i){var r;const n=this,{startDate:s,endDate:a,_month:o}=n,l=n.changeStartDate(i),d=o?.generation;if(!s||l-s)if(n.hasConfig("endDate")){const u=b.diff(s,a,"d");!s||!a||i<s?n.startDate=i:i>=a&&(n.startDate=b.add(i,-(u-1),"day"))}else n.startDate=b.floor(i,n.range,void 0,n.weekStartDay);o&&o.generation===d&&(n._month.date=i),(r=super.updateDate)===null||r===void 0||r.call(this,...arguments)}changeStartDate(i,r){return super.changeStartDate(this.snapDate(this.ingestDate(i)),r)}updateStartDate(i,r){var n;const s=this,{refreshCount:a,_month:o}=s;if(s.date||(s.date=i),o&&(o.date=i),(n=super.updateStartDate)===null||n===void 0||n.call(this,...arguments),s.hasConfig("endDate")){const d=b.diff(r||i,s.endDate,"day");s.endDate=b.add(i,d,"day")}if(!s.isConfiguring&&s.refreshCount===a){var l;(l=s._cellMap)===null||l===void 0||l.clear(),s.refresh()}}changeEndDate(i,r){return super.changeEndDate(this.snapDate(this.ingestDate(i),!0),r)}get range(){return this.hasConfig("endDate")?null:this._range}get endDate(){return this.hasConfig("endDate")?this._endDate:this.startDate&&b.add(this.startDate,this.range.magnitude,this.range.unit)}snapDate(i,r){const n=this.hasConfig("endDate")?null:this.range;return n&&n.unit!=="day"&&i?b[r?"ceil":"floor"](i,n,void 0,this.weekStartDay):i}changeRange(i){if(i){if(typeof i=="string")b.parseTimeUnit(i)?i={magnitude:1,unit:i}:i=b.parseDuration(i);else if(typeof i=="number")return{magnitude:i,unit:"day"};if(!Nx[i.unit])throw new Error("Range must be in days, weeks, months, years or decades");if(this._date&&!this.isValidRange(i))return}return i}isValidRange(i,r=this.date){var n,s;const a=this.minDate||((n=this.calendar)===null||n===void 0?void 0:n.minDate),o=this.maxDate||((s=this.calendar)===null||s===void 0?void 0:s.maxDate);if(i&&!isNaN(a)||!isNaN(o)){const l=this.calculateDateRange(i,r);if(!isNaN(a)&&l.startDate<a||!isNaN(o)&&l.endDate>o)return!1}return!0}updateRange(i){const r=this,{date:n}=r;i&&n&&!r.hasConfig("endDate")&&(r.startDate=n)}calculateDateRange(i,r){if(r)return i.unit!=="day"?{startDate:b.floor(r,i,void 0,this.weekStartDay),endDate:b.ceil(b.add(r,1,"day"),i,void 0,this.weekStartDay)}:{startDate:r,endDate:b.add(r,i.magnitude,"day")}}changeMonth(i){var r;const n=this,{date:s}=n;return super.changeMonth?super.changeMonth(...arguments):((r=i)!==null&&r!==void 0&&r.isMonth||(i=new Ot({date:s,weekStartDay:n.weekStartDay,hideNonWorkingDays:n.hideNonWorkingDays,nonWorkingDays:n.nonWorkingDays}),n.nonWorkingDays==null&&(n.nonWorkingDays=i.nonWorkingDays),n.weekStartDay==null&&(n.weekStartDay=i.weekStartDay)),i)}get dateBounds(){return[this.startDate,this.lastDate]}get duration(){const{range:i}=this;return i?b.as("d",i.magnitude,i.unit):super.duration}get lastDate(){const i=this.endDate;return i&&b.add(i,-1,"day")}},M(e,"$name","DateRangeOwner"),M(e,"configurable",{month:!0,date:{$config:{equal:"date"},value:null},range:{$config:{lazy:!0,equal:Bx},value:null},startDate:{$config:{equal:"date"}},endDate:{$config:{equal:"date"}}}),e};const Mf=Object.freeze({}),zx={shrinkwrap:1,expand:1},kf=(c,e,t,i,r)=>{const n=b.format(t,c);return i?`${n}${r?e.trim():e}${b.format(i,c).slice(r?-1:0)}`:n};class Rs extends N.mixin(rn,xs,nc,sc){constructor(...e){super(...e),M(this,"heightAnimation",Promise.resolve)}static get $name(){return"CalendarRow"}static get type(){return"calendarrow"}static get configurable(){return{cls:"b-calendar-days",animate:!0,autoHeight:null,autoRefresh:["dayNameFormat","dayNumberCompress","dayNumberFormat","daySeparator"],descriptionFormat:[!0,!0],dayStartShift:null,dayTime:0,defaultEventRowCount:3,fullWeek:null,minDayWidth:null,scrollable:{overflowX:"hidden",overflowY:"hidden"},headerScroller:{$config:["lazy","nullify"],value:{overflowX:"hidden",overflowY:"hidden"}},dayNameFormat:"ddd",dayNumberCompress:null,dayNumberFormat:"D",daySeparator:"-",responsive:{small:{dayNameFormat:"d1",dayNumberCompress:!0,daySeparator:"/"},"*":{dayNameFormat:"ddd",dayNumberCompress:!1,daySeparator:"-"}},dayNameSelector:".b-cal-cell-header",monitorResize:!1,eventRenderer:null,gutterHeight:null,expanded:null,overflowClickAction:"popup",dayHeaderRenderer:null}}compose(){return{children:{headerElement:{className:"b-calendarrow-header",children:{headerCellContainer:{className:"b-calendarrow-header-container"},scrollPadElement:F({},S.scrollBarPadElement)}},bodyElement:{className:"b-calendarrow-body",children:{cellContainer:{reference:"cellContainer",className:"b-calendarrow-cell-container"}}}}}}onPaint({firstPaint:e}){if(e){const t=this,{fonts:i}=document,r=()=>{t._eventContainerTop=t._eventContainerHeight=null,t.eventStore.count&&t.performResizeRefresh(null,null,!0)};i?.status!=="loaded"&&i.ready.then(()=>!t.isDestroyed&&r()),r()}}changeDaySeparator(e){return Array.isArray(e)?e:[e,e]}changeElement(){const e=super.changeElement(...arguments);return this.scrollable.addPartner(this.headerScroller,"x"),e}changeHeaderScroller(e,t){return e?e=Ke.new({element:this.headerCellContainer,widget:this},e):t?.destroy(),e}async scrollTo(e){const t=this,{eventFilter:i}=t;return e.isEvent&&(!i||i(e))&&b.intersectSpans(t.startDate,t.endDate,e.startDate,e.endDate)&&(t.getEventElement(e)||t.expanded||t.autoHeight||t.toggleExpandCollapse()),super.scrollTo(...arguments)}updateDate(e,t){var i,r,n;const s=this;let a=t&&s.getDayHeader(t);(i=a)===null||i===void 0||i.classList.remove("b-selected-date"),(r=super.updateDate)===null||r===void 0||r.call(this,e,t),a=e&&s.getDayHeader(e),(n=a)===null||n===void 0||n.classList.add("b-selected-date")}getDayHeader(e){return typeof e!="string"&&(e=this.dateKey(e)),this.headerCellContainer.querySelector(`.b-cal-cell-header[data-header-date="${e}"]`)}get overflowElement(){return this.bodyElement}createCellMap(e={}){const t=this,i=t.hideNonWorkingDays?t.nonWorkingDays:Mf,{maxEventCount:r}=t,n=T.assign({dayTime:t.dayTime},e),s=super.createCellMap(n);let a=0,o;return s.forEach(l=>{i[l.day]||(o=l),a=Math.max(a,l.renderedEvents.length)}),t.maxEventCount=a,a!==r?(s.clear(),t.createCellMap(n)):(o&&(o.isRowEnd=!0),s)}collectEvents(e){return e=T.assign({dayTime:this.dayTime},e,{getDateIndex:t=>t>(this.firstVisibleDate||this.startDate)?"startDate":"date"}),this.eventStore.getEvents(e)}createCellData(e){const t=this,i=b.diff(t.startDate,e,"day"),r=i;return Object.assign(t.cellMonth.getCellData(e,t.month,t.dayTime),{visibleColumnIndex:r,columnIndex:i,isRowStart:r===0,isRowEnd:!1,renderedEvents:new ic})}get dayStartShift(){var e,t;return(e=(t=this.dayTime)===null||t===void 0?void 0:t.startShift)!==null&&e!==void 0?e:this._dayStartShift}updateDayStartShift(e){this.element.classList.toggle("b-shifted-day",Boolean(e)),this.dayTime=new me(e)}changeDayTime(e){var t;if(e||(e=new me(this.dayStartShift)),e.isDayTime||(e=new me(e)),!((t=this._dayTime)!==null&&t!==void 0&&t.equals(e)))return e}dayOfDate(e){return this.dayTime.dayOfDate(e)}updateMinDayWidth(e){const{scrollable:t,headerScroller:i}=this,{element:r}=t;this.contentElement.style.setProperty("--min-day-width",e?S.setLength(e):0),e&&r.scrollWidth>r.clientWidth?t.overflowX=i.overflowX="hidden-scroll":t.overflowX=i.overflowX=!1}updateEventHeight(){super.updateEventHeight(...arguments),!this.autoHeight&&!this.isConfiguring&&!this.expanded&&this.setEventContentHeight(this.cellContentHeight)}updateGutterHeight(){this.isConfiguring||this.setEventContentHeight(this.cellContentHeight)}get stepUnit(){return this.duration>1?`${this.duration} ${this.L("L{DayView.daysUnit}")}`:this.L("L{DayView.dayUnit}")}updateNonWorkingDays(){this.onVisibleDateRangeChange()}updateHideNonWorkingDays(){super.updateHideNonWorkingDays(...arguments),this.onVisibleDateRangeChange()}onCellOverflowGesture({date:e}){zx[this.overflowClickAction.toLowerCase()]?this.expanded=!0:super.onCellOverflowGesture(...arguments)}onVisibleDateRangeChange(){if(!this.isConfiguring){var e;(e=this._cellMap)===null||e===void 0||e.clear(),this.refresh()}}changeAutoHeight(e){const t=this,{eventsPerCell:i}=t;t._autoHeight=e,t.setEventContentHeight(t.cellContentHeight),t.performResizeRefresh(i,t.eventContainerTop,!0)}async setEventContentHeight(e,t){const i=this,{cellContainer:r,parent:n}=i;if(i._eventContentHeight!==e){var s;if(!t&&n!==null&&n!==void 0&&n.isDayView&&(s=n.parent)!==null&&s!==void 0&&s.isResourceView){const h=n.parent.items.map(f=>f.allDayEvents).filter(f=>f&&f!==i);e=Math.max(e||0,...h.filter(f=>!f.owner.isResourceDayViewTimeAxis).map(f=>f.calculateCellContentHeight()||0)),h?.forEach(f=>{f.setEventContentHeight(e,!0)})}const{height:l}=i;let{animate:d}=i;i.isAnimating=d;const u=S.getPropertyTransitionDuration(r,"height");if(u||(i.isAnimating=d=!1),r.style.height=`${e}px`,i.bodyElement.classList.toggle("b-zero-height",!Boolean(e)),d&&await(i.heightAnimation=B.waitForTransitionEnd({property:"height",element:r,duration:u})),!i.isDestroyed){var a,o;const{height:h}=i;i.isAnimating=!1,i._eventContentHeight=e,(a=i.owner)===null||a===void 0||(o=a.syncScrollbarPadding)===null||o===void 0||o.call(a),h!==l&&i.trigger("heightChange",{height:h,oldHeight:l})}}}get hasOverflow(){return!this.autoHeight&&this.maxEventCount>this.defaultEventRowCount}get eventsPerCell(){const e=this,{maxEventCount:t}=e;return e.expanded||e.autoHeight?t:Math.min(t,e.defaultEventRowCount)}get cellContentHeight(){return this.calculateCellContentHeight()}calculateCellContentHeight(){const e=this,{gutterHeight:t}=e;let i=Math.ceil(e.eventContainerTop+e.eventsPerCell*(e.eventHeightInPixels+e.eventSpacing));return t&&(e.eventsPerCell&&(i-=e.eventSpacing),isNaN(t)?i=`calc(${i}px + ${t})`:i+=Number(t)),i}getDateFromPosition(e,t){const i=this,{hideNonWorkingDays:r,contentElement:n}=i,s=n.querySelectorAll(`${i.visibleCellSelector}${r?":not(.b-nonworking-day":""}`),a=n.getBoundingClientRect(),o=i.rtl?a.right-e:e-a.left,l=s.length,{width:d}=a,u=Math.floor(o*l/d);if(o<0||d<o||t<a.top||a.bottom<t)return null;if(i.hideNonWorkingDays)return Array.from(s).map(f=>i.getDateFromElement(f))[u];{const h=i.getDateFromElement(s[0]);return h.setDate(h.getDate()+u),h}}async toggleExpandCollapse(){const{expanded:e}=this;await this.updateExpanded(!Boolean(e),e)}async updateExpanded(e,t){const i=this;i._expanded=t;const{eventsPerCell:r}=i;i._expanded=e,i.expanded?(i.performResizeRefresh(r,i.eventContainerTop,!0),await i.heightAnimation):(i.scrollable.overflowY="hidden",await i.setEventContentHeight(i.cellContentHeight),t&&!i.isDestroyed&&i.performResizeRefresh(r,i.eventContainerTop,!0))}doRefresh(){var e,t;(e=this._cellMap)===null||e===void 0||e.clear();const i=this,{dayTime:r,fullWeek:n,startDate:s,endDate:a,headerCellContainer:o,cellContainer:l,dayHeaderRenderer:d}=i,u=(s||a)&&i.cellMap,h=(t=i.nonWorkingDays)!==null&&t!==void 0?t:i.month.nonWorkingDays,f=i.hideNonWorkingDays?h:Mf,g=[],m=[],p=[];if(!u)return;let v=0,y=0,C=new Date(s),D=a,w,E,R;n&&(C=i.month.getWeekStart(i.month.getWeekNumber(C)),D=b.add(C,7,"d"));for(const k=C;k<D;k.setDate(k.getDate()+1),v++){const I=u.get(r.dateKey(k))||i.createCellData(k);I.columnIndex=I.cellIndex=v,f[I.day]?I.visibleColumnIndex=void 0:(I.isRowStart=y===0,I.visibleColumnIndex=y,n||y++),g.push(I)}i.weekLength=n?1:y;const x=g.length;for(E=0;E<x;E++){const k=g[E],{day:I,key:A}=k;if(!f[I]){const L=h[I],O=`b-day-of-week-${I}`;w=!(k.date-i.date),k.cell=i.getCell(A),k.row=i.cellContainer;const _=i.getCellDomConfig(k),V=U.merge({dataset:{headerDate:A}},_.children[0]);V.className["b-selected-date"]=w,V.className["b-current-date"]=n&&w,V.className[O]=1,d&&i.callback(d,i,[V,k]),_.dataset.date=A,Object.assign(_.className,{"b-dayview-allday":1,[i.nonWorkingDayCls]:L,[i.weekendCls]:b.weekends[I],[i.dayCellCls]:1,[O]:1}),_.children.shift(),p.push(V),(!n||w)&&(m.push(_),L||(R=_))}}R&&(R.className["b-last-working-day"]=1),Z.sync({targetElement:o,domConfig:{children:p,syncOptions:{releaseThreshold:0,strict:!0}}}),Z.sync({targetElement:l,domConfig:{children:m,syncOptions:{releaseThreshold:0,strict:!0}}}),i.refreshCount=(i.refreshCount||0)+1,i.collapseGutter(),i.setEventContentHeight(i.cellContentHeight),i.trigger("refresh")}get eventContainerTop(){return 0}async expandGutter(){const e=this;e._isTemporarilyExpanded||(e.gutterHeight=(e.gutterHeight||0)+e.eventHeightInPixels+e.eventSpacing,await e.setEventContentHeight(e.cellContentHeight),e._isTemporarilyExpanded=!0)}async collapseGutter(){const e=this;e._isTemporarilyExpanded&&(e.gutterHeight=e.gutterHeight-(e.eventHeightInPixels+e.eventSpacing),await e.setEventContentHeight(e.cellContentHeight),e._isTemporarilyExpanded=!1)}addCellHeaderContent(e,t){var i;const r=this,{date:n,day:s,tomorrow:a}=t,{dayNameFormat:o,dayNumberCompress:l,daySeparator:d}=r,u=r==null||(i=r.dayTime)===null||i===void 0?void 0:i.startShift;e.children=[{className:`b-day-name-part b-day-name-day${l?" b-day-name-short":""}`,html:kf(o,d[0],n,u&&a)},{className:"b-day-name-part b-day-name-date",html:kf(r.dayNumberFormat,d[1],n,u&&a,l)}],e.className[r.nonWorkingDayCls]=t.isNonWorking,e.className[r.weekendCls]=b.weekends[s]}updateLocalization(){this.isConfiguring||this.refresh(),super.updateLocalization()}}Rs.initClass();Rs._$name="CalendarRow";class nn extends Rs{afterConfigure(){var e;const t=this,{owner:i}=t;super.afterConfigure(),(e=i.scrollable)===null||e===void 0||e.ion({overflowChange:"onOwnerOverflowChange",thisObj:t}),i.descriptionRenderer=t.descriptionRenderer.bind(t),i.previous=function(){this.date=b.add(i.date,-i.duration,"d")},i.next=function(){this.date=b.add(i.date,i.duration,"d")},ve.before(i,"updateDate",this.beforeOwnerDateUpdate,this)}beforeOwnerDateUpdate(e){this.date=e}onOwnerOverflowChange({y:e}){this.headerElement.classList.toggle("b-show-yscroll-padding",Boolean(e))}onDayNumberClick({date:e}){return this.owner&&(this.owner.date=e),!1}descriptionRenderer(){const{startDate:e,endDate:t,owner:i}=this,r=e.getMonth(),n=t.getMonth(),s=r===n?b.format(e,"MMMM"):`${b.format(e,"MMM")} - ${b.format(t,"MMM")}`,a=i.month.getWeekNumber(e);return`${this.L("L{Object.Week}")} ${a[1]}, ${s} ${a[0]}`}}M(nn,"$name","DaySelector");M(nn,"type","dayselector");M(nn,"configurable",{readOnly:!0,autoCreate:!1,flex:"0 0 auto",dock:"top"});nn.initClass();nn._$name="DaySelector";var iv=c=>class extends(c||P){static get $name(){return"CalendarMixin"}static get configurable(){return{daySelector:null}}changeDaySelector(t,i){const r=this;if(t){r.range="1 day",r.settings=null,r.hideHeaders=!0;const n=r.dayTime.shiftDate(r.month.getWeekStart(r.month.getWeekNumber(r.startDate))),s=nn.reconfigure(i,t,{owner:r,defaults:{type:"dayselector",calendar:r.calendar,parent:r,cls:{[`b-${r.type}-dayselector`]:1},dayStartShift:r.dayStartShift,dayTime:r.dayTime,month:r.month,date:r.date,startDate:n,range:{magnitude:1,unit:"week"},hideNonWorkingDays:r.hideNonWorkingDays,nonWorkingDays:r.nonWorkingDays,nonWorkingDayCls:r.nonWorkingDayCls,weekendCls:r.weekendCls,weekStartDay:r.weekStartDay}});return r.element.classList.add(`b-${r.type}-with-dayselector`),r.tbar=s,s}else i?.destroy()}getCurrentConfig(t){const i=super.getCurrentConfig(t);return delete i.daySelector,i}};const Vx=(c,e)=>c.startDate.valueOf()-e.startDate.valueOf(),jx=(c,e)=>{if(e)if(c=c.data||c,T.isObject(c)){const t=e.slice();for(const i in c){const r=c[i],n=t.findIndex(s=>s.id===i||s.field===i);if(r){const s=pe.merge(r,t[n]);s.id=i,t[n===-1?t.length:n]=s}else n>-1&&t.splice(n,1)}return t}else{e=new rt({values:e,idProperty:"field"});for(let t=0,{length:i}=c;t<i;t++){const r=c[t],n=e.get(r.field);n&&(c[t]=pe.merge(r,n),e.remove(n))}return c.push(...e.values),c}else return c};class Do extends no.mixin(rn,xs,iv,sc){static get $name(){return"EventList"}static get type(){return"eventlist"}static get configurable(){return{cls:"b-slide-vertical",eventFilter:null,localizableProperties:["title","text"],title:"L{List}",range:"1 month",month:!0,columns:{$config:{merge:jx},value:[{text:"L{EventEdit.Name}",field:"name",flex:1},{text:"L{EventList.Start}",type:"date",editor:{type:"datetime",dateField:{step:null},timeField:{step:null}},field:"startDate",width:"16.5em",format:"L LT",renderer({record:e,value:t}){return e.allDay?b.format(t,"L"):this.defaultRenderer(...arguments)}},{text:"L{EventList.Finish}",type:"date",editor:{type:"datetime",dateField:{step:null},timeField:{step:null}},field:"endDate",width:"16.5em",format:"L LT",renderer({record:e,value:t}){return e.allDay?b.format(t,"L"):this.defaultRenderer(...arguments)}},{type:"widget",text:"Resources",field:"resources",minWidth:250,autoHeight:!0,widgets:[{type:"chipview",valueProperty:"items",displayField:"name",itemsFocusable:!1,navigator:null,closable:!1,style:{flexFlow:"row nowrap",display:"flex",padding:"5px 0 3px 0"},scrollable:{overflowX:"hidden-scroll",overflowY:!1},getItemCls:e=>S.isNamedColor(e.eventColor)?` b-sch-${e.eventColor}`:"",getItemStyle:e=>`color:#fff;${e.eventColor&&!S.isNamedColor(e.eventColor)?`background-color:${e.eventColor}`:""}`}],editor:!1}]},features:{group:!1,rowCopyPaste:!1,columnPicker:{createColumnsFromModel:!0}},internalListeners:{beforeCellEditStart({editorContext:e}){var t,i,r,n;const{editor:s,record:a}=e;if(a.isRecurring||a.isOccurrence)return lt.show({html:"Please use EventEdit to edit recurring events"}),!1;(t=this.calendar)===null||t===void 0||(i=t.features.eventTooltip)===null||i===void 0||(r=i._tooltip)===null||r===void 0||r.hide(),(n=s.timeField)===null||n===void 0||n[a.allDay?"hide":"show"]()}},settings:{$config:"lazy",value:null},eventListTimeFormat:"HH:mm"}}static get delayable(){return{populateStoreSoon:{type:"raf",cancelOutstanding:!0}}}doRefresh(){this.refreshRows()}eventListEventTimeRenderer(e){const t=this,i=b.diff(b.clearTime(e.startDate),b.clearTime(e.endDate),"day"),r=t.eventTimeRenderer?t.callback(t.eventTimeRenderer,t,arguments):i>1?t.L("L{Calendar.endsOn}",b.format(e.endDate,"DD MMM")):e.allDay?t.L("L{Calendar.allDay}"):`${b.format(e.startDate,t.eventListTimeFormat)} - ${b.format(e.endDate,t.eventListTimeFormat)}`;return{className:{"b-cal-eventlist-event-time":1},text:r}}agendaEventDateRenderer(e){return{className:{"b-day-name":1,"b-cal-agenda-date":1,"b-today":!Boolean(b.clearTime(new Date)-b.clearTime(e))},children:[{className:{"b-cal-agenda-date-date-number":1},text:e.getDate()},{className:{"b-cal-agenda-date-date-text":1},children:[{text:b.format(e,"dddd")},{text:b.format(e,"MMM YYYY")}]}]}}destroy(){for(const t of Object.values(this.features)){var e;(e=t.destroy)===null||e===void 0||e.call(t)}super.destroy()}populateHeaderMenu({items:e}){e.listRangeItem={weight:-1e3,icon:"b-icon-calendar-week",text:"List Range",menu:this.listRangeMenu},super.populateHeaderMenu(...arguments)}refreshVirtualScrollbars(){super.refreshVirtualScrollbars(),this.bodyElement.classList[S.scrollBarWidth&&this.hasVerticalOverflow?"add":"remove"]("b-has-scrollbar")}get listRangeMenu(){const e=this,{unit:t}=e.range;if(!e._listRangeMenu){const i=`${e.id}-range-items`;e._listRangeMenu={anchor:!0,onToggle:r=>{r.checked&&(e.range=r.item.range,r.bubbles=!1),S.scrollBarWidth&&r.menu.realign()},items:{listRangeDayItem:{toggleGroup:i,range:"day",text:"L{EventEdit.day}",_unit:"day"},listRangeWeekItem:{toggleGroup:i,range:"week",text:"L{EventEdit.week}",_unit:"week"},listRangeMonthItem:{toggleGroup:i,range:"month",text:"L{EventEdit.month}",_unit:"month"},listRangeYearItem:{toggleGroup:i,range:"year",text:"L{EventEdit.year}",_unit:"year"},listRangeDecadeItem:{toggleGroup:i,range:"decade",text:"L{EventEdit.decade}",_unit:"decade"}}}}for(const i of Object.values(e._listRangeMenu.items))i.checked=i._unit===t;return e._listRangeMenu}updateRowManager(e){var t;(t=super.updateRowManager)===null||t===void 0||t.call(this,...arguments),e.ion({beforeRenderRow:"onBeforeRenderRow",thisObj:this})}onBeforeRenderRow({row:e,record:t}){const{_elementsArray:i}=e,{id:r,startDate:n}=t;if(t.isEventModel){for(let s=0,{length:a}=i;s<a;s++)i[s].dataset.eventId=r,i[s].dataset.date=b.makeKey(n);e.cls[`b-day-of-week-${n.getDay()}`]=1}}onInternalKeyDown(e){}handleEvent(e){this.preventScroll=!0,super.handleEvent(e),this.preventScroll=!1}get displayName(){let e=this.title;return typeof e!="string"&&(e=this.type),z.capitalize(e)}async scrollTo(e,t={animate:!0}){const i=this;if(e instanceof i.store.modelClass)await i.scrollRowIntoView(e,Object.assign({},t,{highlight:!1})),t.highlight&&(e=i.getEventElement(e,e.startDate),typeof t.highlight=="boolean"?S.highlight(e,i):(i.widget||i).callback(t.highlight,null,[e]));else if(T.isDate(e)&&i.store.count){const r=i.dateIndex,n=b.makeKey(e);if(r[n])await i.scrollRowIntoView(r[n],t),i.scrolledToDate=e;else{let s=Number.MAX_SAFE_INTEGER;const a=Object.keys(r);for(let o=0,{length:l}=a;o<l;o++){const d=b.parseKey(a[o]);Math.abs(d-e)<Math.abs(s-e)&&(s=d)}await i.scrollTo(s)}}}updateStartDate(){const{refreshCount:e}=this;this.preventScroll=!0,super.updateStartDate(...arguments),this.preventScroll=!1,!this.isConfiguring&&this.refreshCount===e&&this.populateStoreSoon()}updateEndDate(){var e;const{refreshCount:t}=this;(e=super.updateEndDate)===null||e===void 0||e.call(this,...arguments),!this.isConfiguring&&this.refreshCount===t&&this.populateStoreSoon()}updateRange(){var e;const{refreshCount:t}=this;(e=super.updateRange)===null||e===void 0||e.call(this,...arguments),!this.isConfiguring&&this.refreshCount===t&&this.populateStoreSoon()}descriptionRenderer(){const e=this,{date:t,startDate:i,endDate:r,range:n,count:s}=e;let a;if(n.magnitude===1)switch(n.unit){case"day":a=b.format(t,"L");break;case"week":{const o=i.getMonth(),l=r.getMonth(),d=o===l?b.format(i,"MMMM"):`${b.format(i,"MMM")} - ${b.format(r,"MMM")}`,u=e.month.getWeekNumber(i);a=`${e.L("L{Object.Week}")} ${u[1]}, ${d} ${u[0]}`;break}case"month":a=b.format(t,"MMMM, YYYY");break;case"year":a=b.format(t,"YYYY");break;case"decade":a=`${b.format(i,"YYYY")}s`}else a=`${b.format(e.startDate,"L")} - ${b.format(e.endDate,"L")}`;return`${a}. ${e.L("eventCount",s)}`}get count(){return this.store.count}get stepUnit(){const{range:e}=this;return e.magnitude===1?e.unit:this.range}updateEventStore(e){var t;(t=super.updateEventStore)===null||t===void 0||t.call(this,e),e.ion({refresh:"onCalendarStoreChange",thisObj:this}),this.populateStoreSoon()}changeStore(e){var t;const i=this;return e&&(e=se.mergeConfigs({useRawData:{ignoreDefaults:!0,disableDefaultValue:!0,disableTypeConversion:!0,enabled:!0},modelClass:i.modelClass},e)),e=super.changeStore(e),(t=e)!==null&&t!==void 0&&t.modelClass.isEventModel&&(i.nonWorkingDaysFilter=e.addFilter({id:`${i.id}-nonworkingday-filter`,filterBy:r=>!i.dayTime.isIntraDay(r)||!i.hiddenNonWorkingDays[r.startDate.getDay()],disabled:!i.hideNonWorkingDays},!0)),e}updateHideNonWorkingDays(e){const t=this,{store:i}=t;super.updateHideNonWorkingDays(e),i&&(t.nonWorkingDaysFilter.disabled=!e,i.filter()),t.trigger("refresh")}afterRemove({records:e}){this.eventStore.remove(e),super.afterRemove(...arguments)}get modelClass(){return this.eventStore.modelClass}populateStoreSoon(){const e=this,{project:t}=e;e.isVisible?(t.isInitialCommitPerformed&&!t.isWritingData||!t.eventStore.count)&&e.populateStore():e.whenVisible("populateStore")}populateStore(){var e;const t=this,i=t.eventStore.getEvents({startDate:t.startDate,endDate:t.endDate,filter:t.eventFilter}).sort(Vx);t.dateIndex=i.reduce((r,n)=>{const s=b.makeKey(n.startDate);return r[s]||(r[s]=n),r},{}),t.store.data=i,t.trigger("refresh"),(e=t.calendar)===null||e===void 0||e.syncUIWithActiveView(this)}changeMonth(){const e=super.changeMonth(...arguments);return e.ion({dateChange:"onMonthChange",thisObj:this}),e}onMonthChange({newDate:e}){const t=this,{startDate:i}=t,r=t.changeStartDate(e);(!i||r-i)&&t.updateRange(t.range),!t.preventScroll&&t.isVisible&&t.store.count&&(t.populateStoreSoon.flush(),t.scrollTo(e))}onCalendarStoreChange({source:e}){this.date||(this.date=e.map(t=>t.startDate).sort((t,i)=>t.valueOf()-i.valueOf())[0]),this.populateStoreSoon()}changeSettings(e,t){return e&&Ft.reconfigure(t,Ft.mergeConfigs({type:"button",positioned:!0,icon:"b-icon-cog",menuIcon:null,cls:"b-blue b-cal-widget-settings-button",appendTo:this.bodyElement},e),this)}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.store,delete t.data,t}}Do.initClass();Do._$name="EventList";const Wx={mouseover:1,mouseout:1},Ux={mousedown:1,mouseup:1,click:1,dblclick:1,contextmenu:1};class ac extends Do.mixin(Zn){static get $name(){return"AgendaView"}static get type(){return"agendaview"}static get configurable(){return{features:null,eventSorter:Es.interDaySorterFn,eventRowSpacing:8,title:"L{Agenda}",range:"year",hideEventOverflow:null,offsetStartsBeforeEvents:!0,handlePointerInteraction:!1,dayCellRenderer:null,eventRenderer:null,hideHeaders:!0,columns:{name:null,startDate:null,endDate:null,resources:null,agenda:{type:"agendacolumn"}},eventTimeRenderer:null,enableSticky:!0,preserveScrollOnDatasetChange:!0,positionMode:"position",settings:{},cellTabIndex:null,rowCls:{"b-cal-agenda-grid-row":1},cellCls:{"b-calendar-cell":1},eventBarContainerCls:"b-cal-event-bar-container",keyMap:null}}construct(e){const t=this;Object.defineProperty(t,"features",{get:()=>({}),set:()=>{}}),super.construct(e),t.bodyContainer.removeAttribute("tabIndex")}onResponsiveStateChange({state:e,oldState:t}){var i;(i=super.onResponsiveStateChange)===null||i===void 0||i.call(this,...arguments),t&&(t==="small"||e==="small")&&this.refresh()}changeColumns(){var e;const t=super.changeColumns(...arguments);return t==null||(e=t.forEach)===null||e===void 0||e.call(t,i=>{i.autoHeight=Boolean(!i.isAgendaColumn||i.renderer||this.eventRenderer)}),t}onFocusGesture(){}onGridElementFocus(){}onGridBodyFocusIn(){}focusCell(){}setHoveredRow(){}onElementKeyDown(){}onElementMouseDown(){}editAutoCreatedEvent(e,t){this.populateStoreSoon.now(),super.editAutoCreatedEvent(e,t)}handleEvent(e){const{type:t}=e;super.handleEvent(e),Wx[e.type]?this.onEventMouseOverOut(e):Ux[t]&&this.onCalendarPointerInteraction(e)}getCellDataFromEvent(e){if(e.target.closest(".b-grid-cell")){const t=super.getCellDataFromEvent(e);return t&&(t.record=this.getEventRecord(e.target)),t}}updateOffsetStartsBeforeEvents(e){this.element.classList.toggle("b-offset-continues-past",Boolean(e))}updateEventRowSpacing(e){this.contentElement.style.setProperty("--event-row-spacing",S.setLength(e))}updateSuppressLongEvents(){this.fillFromMaster()}onCalendarStoreChange({action:e,oldCount:t,records:i,removed:r,added:n}){const s=this;if(s.isPainted){if(e==="filter"&&!(r!=null&&r.length)&&!(n!=null&&n.length)||e==="dataset")return;if(e==="remove"&&i.length===1&&i[0].isEventModel){const{store:a}=s,o=i[0],l=b.clearTime(o.startDate),d=b.clearTime(o.endDate);do{const u=b.makeKey(l),h=s.cellMap.get(u);h&&(W.remove(h.events,o),h.events.length?s.onStoreUpdateRecord({source:a,record:s.store.getById(u),changes:{}}):(s.cellMap.delete(u),delete s.dateIndex[u],a.remove(u,!0))),l.setDate(l.getDate()+1)}while(l<d);return}}s.populateStoreSoon()}get cellMap(){var e;return(e=this._cellMap)!==null&&e!==void 0&&e.populated?this._cellMap:this.createCellMap({rawEvents:!0,skipPropagate:!0})}populateStore(){var e,t,i,r,n;(e=this._cellMap)===null||e===void 0||e.clear();const s=this,{store:a,eventStore:o,rowManager:l}=s,{rowHeight:d}=l,u=(t=l.rows)===null||t===void 0?void 0:t.length,h=isNaN(s.eventHeight)?25:s.eventHeight;s.eventCount=0,s.date||(s.isConfiguring=!0,s.date=o.map(p=>p.startDate).sort((p,v)=>p.valueOf()-v.valueOf())[0],s.isConfiguring=!1);const{cellMap:f}=s,g=[...f.values()];s.dateIndex={};for(let p=0,{length:v}=g;p<v;p++){const y=g[p],{events:C,date:D}=y;for(let w=0,{length:E}=C;w<E;w++){const R=C[w];(!s.isAllDayEvent(R)||!p||b.clearTime(R.startDate).valueOf()===D.valueOf())&&s.eventCount++}s.dateIndex[y.id]=g[p]=a.createRecord(y)}const m=s.eventCount?g.map(p=>p.events.length).reduce((p,v)=>p+v,0)/g.length:0;a.suspendEvents(),a.loadData(g),a.resumeEvents(),l._rowHeight=20,a.count&&(l.rowHeight=Math.max(m*(h+s.eventSpacing),70)),(!u||!a.count||l.rowHeight===d)&&(l.calculateRowCount(),l.estimateTotalHeight(!0)),s.refreshCount=(s.refreshCount||0)+1,s.trigger("refresh"),(i=s.calendar)===null||i===void 0||i.syncUIWithActiveView(s),s.columns.forEach(p=>{var v,y;return(v=(y=p.constructor).exposeProperties)===null||v===void 0?void 0:v.call(y)}),(r=s.settings)===null||r===void 0||(n=r._menu)===null||n===void 0||n.realign()}get count(){return this.eventCount}collectEvents(e){return e.getDateIndex=t=>t>this.startDate&&this.hideEventOverflow?"startDate":"date",this.eventStore.getEvents(e)}changeStore(e){return e=super.changeStore(e),e&&(this.nonWorkingDaysFilter=e.addFilter({id:`${this.id}-nonworkingday-filter`,filterBy:t=>!t.isNonWorking,disabled:!this.hideNonWorkingDays},!0),this.detachListeners("agendaStoreFilter"),e.on({name:"agendaStoreFilter",filter:"onAgendaStoreFilter",thisObj:this})),e}get modelClass(){return Rr}onAgendaStoreFilter(){const e=this;e.eventCount=e.store.reduce((t,i,r)=>{const{events:n,date:s}=i;for(let a=0,{length:o}=n;a<o;a++){const l=n[a];(!e.isAllDayEvent(l)||!r||b.clearTime(l.startDate).valueOf()===s.valueOf())&&t++}return t},0)}updateHideEventOverflow(){this.populateStore()}doRefresh(){this.populateStore()}createCellData(e){return Object.assign(this.cellMonth.getCellData(e,this.month),{id:b.makeKey(e),events:[]})}set cellRenderer(e){this._cellRenderer=e}changeSettings(e){return e&&super.changeSettings({menu:F({align:{align:"t100-b100"}},this.listRangeMenu)})}}ac.initClass();ac._$name="AgendaView";class Ts extends Yi.mixin(ev){construct(e){if(!e.eventStore){var t;const i=(t=e.owner||e.parent)===null||t===void 0?void 0:t.up("calendar");i&&(e.eventStore=i.eventStore)}super.construct(...arguments)}updateMaxDots(){this.refresh()}refreshEventsMap(){const e=this;e.showEvents&&(e.eventsMap=e.eventStore[e.showEvents==="dots"?"getEvents":"getEventCounts"]({startDate:e.startDate,endDate:e.endDate,dateMap:e.eventsMap||(e.eventsMap=new Map)}))}cellRenderer({cell:e,date:t}){var i,r;const{showEvents:n}=this,s=n==="count",a=n==="dots",o=(i=this.eventsMap)===null||i===void 0||(r=i.get)===null||r===void 0?void 0:r.call(i,b.makeKey(t)),l=a?o?.length:o,d=s?"b-cell-events-badge":a?"b-cal-minimal-event-container":"b-icon b-icon-circle";if(a&&(e.innerHTML="",S.createElement({class:"b-date-cell-inner",text:t.getDate(),parent:e})),delete e.parentNode.dataset.btip,l){!s&&this.eventCountTip&&(e.parentNode.dataset.btip=this.L("L{ResourceInfoColumn.eventCountText}",l));const u={dataset:{count:l},class:{[d]:1,[Yi.getEventCountClass(l)]:1},parent:e,[s?"text":""]:l};if(a){const h=u.children=[];for(let f=0;f<Math.min(o?.length||0,this.maxDots);f++){const g=this.createEventDomConfig({eventRecord:o[f],minimal:!0});h.push(g)}}S.createElement(u)}}static setupClass(e){e.replaceType=!0,super.setupClass(e)}}M(Ts,"$name","CalendarDatePicker");M(Ts,"type","datepicker");M(Ts,"configurable",{showEvents:null,maxDots:4,eventCountTip:null,alwaysRefreshOnMonthChange:!0});Ts.initClass();Ts._$name="CalendarDatePicker";const{MILLIS_PER_HOUR:ia}=me,Yx=new Date(2020,10,22,22,59,59),Gx={paint:1,refresh:1,resize:1,eventspercellchange:1},qx=c=>{c.stopImmediatePropagation(),c.cancelBubble=!0},Kx=c=>c.ctrlKey&&c.preventDefault(),If={level:0,step:"1 hour"},Xx=new $(0,0,0,0),Zx=["30 minutes","15 minutes","10 minutes","5 minutes"],Jx=["30 minutes","12 minutes","6 minutes"];class Ms extends Ye.mixin(rn,xs,iv,sc){static get $name(){return"DayView"}static get type(){return"dayview"}static get delayable(){return{updateElementLayout:{type:"raf",cancelOutstanding:!0},refreshDayBackground:{type:"raf",cancelOutstanding:!0}}}static get configurable(){return{textContent:!1,scrollable:{overflowY:!0},title:"L{Day}",eventRenderer:null,eventHeight:"auto",hourHeight:42,range:{magnitude:1,unit:"day"},fixedDuration:null,visibleStartTime:7,dayStartShift:null,dayStartTime:null,dayEndTime:null,dayTime:0,increment:"15 min",intradayCls:null,showTime:!0,showCircle:!1,iconTarget:"header",eventLayout:{type:"fluid"},minDayWidth:null,eventColourStyleProperty:"backgroundColor",monitorResize:Boolean(S.scrollBarWidth),eventFilter:void 0,timeFormat:"LST",allDayEvents:{$config:["lazy","nullify"],value:{}},overflowPopup:null,showAllDayHeader:{value:null,$config:null,default:!0},eventSpacing:1,responsive:{small:{descriptionFormat:"MMMM YYYY"},"*":{descriptionFormat:null}},maxAllDayHeight:null,fitHours:null,dayCellRenderer:null,coreHours:null,zoomOnMouseWheel:!K.isTouchDevice,hourHeightBreakpoints:[70,140,300,500],sixMinuteTicks:null,minEventHeight:"1em",shortEventHeight:32,currentTimeIndicatorRenderer:()=>({className:"b-current-time-indicator",retainElement:!0})}}construct(e){var t;const i=this;i.configuredHiddenVerticalScroll=((t=e.scrollable)===null||t===void 0?void 0:t.overflowY)==="hidden-scroll",i.cellMapEventFilter=i.cellMapEventFilter.bind(i),super.construct(...arguments),i.startDate||(i.startDate=i.month.date),ue.ion({theme:"onThemeChange",thisObj:i})}get hasNonWorkingDays(){return!0}updateZoomOnMouseWheel(e){if(e)this.zoomListener=B.on({element:this.dayContentElement,wheel:"onDayContentMousewheel",thisObj:this,throttled:{buffer:100,alt:Kx}});else{var t;(t=this.zoomListener)===null||t===void 0||t.call(this)}}get childItems(){const{allDayEvents:e}=this,t=super.childItems;return e&&t.push(e),t}get dayEndTime(){var e,t;return(e=(t=this.dayTime)===null||t===void 0?void 0:t.timeEnd)!==null&&e!==void 0?e:this._dayEndTime}get dayStartTime(){var e,t;return(e=(t=this.dayTime)===null||t===void 0?void 0:t.timeStart)!==null&&e!==void 0?e:this._dayStartTime}get dayStartShift(){var e,t;return(e=(t=this.dayTime)===null||t===void 0?void 0:t.startShift)!==null&&e!==void 0?e:this._dayStartShift}updateDayEndTime(e){this._dayTime=null,this.dayTime=new me({startShift:this.dayStartShift,timeStart:this.dayStartTime,timeEnd:e})}updateDayStartTime(e){this._dayTime=null,this.dayTime=new me({startShift:this.dayStartShift,timeStart:e,timeEnd:this.dayEndTime})}updateDayStartShift(e){this._dayTime=null,this.dayTime=new me({startShift:e,timeStart:this.dayStartTime,timeEnd:this.dayEndTime})}changeDayTime(e){var t;if(e||(e=new me(this)),!((t=this._dayTime)!==null&&t!==void 0&&t.equals(e)))return e}updateDayTime(e,t){const i=this,{eventStore:r}=i;if(r&&(r.registerDayIndex(e),t&&r.unregisterDayIndex(t)),!i.isConfiguring){var n;const{startDate:s}=i;i.syncHours(),i.setConfig({date:s,startDate:s}),(n=i.allDayEvents)===null||n===void 0||n.setConfig({date:s,dayTime:e,startDate:s})}}dateKey(e){return this.dayTime.dateKey(e)}dayOfDate(e){return e&&this.dayTime.dayOfDate(e)}async scrollTo(e,t={animate:!0}){const i=this,{allDayEvents:r}=i;if(i.scrollPromise&&await i.scrollPromise,await r?.heightAnimation,i.isDestroyed)return;typeof e=="number"&&(e=b.add(i.startDate,e,"hour"));const n=Boolean(e.getHours);if(await super.scrollTo(e,Object.assign({},t,{y:!n})),n)return e=e.getHours()+e.getMinutes()/60,i.scrollable.scrollTo(null,i.getPositionFromTime(e),t)}getEventElement(e,t){var i;return super.getEventElement(e,t)||((i=this.allDayEvents)===null||i===void 0?void 0:i.getEventElement(e,t))}getEventElements(e){var t;return super.getEventElements(e)||((t=this.allDayEvents)===null||t===void 0?void 0:t.getEventElements(e))}getPositionFromTime(e){return me.parse(e)<me.parse(this.dayStartTime)-this.dayStartShift?0:this.dayTime.delta(e,"h")*this.hourHeight}updateShowAllDayHeader(e){var t,i;const r=this,{_allDayEvents:n}=r;(t=r._cellMap)===null||t===void 0||t.clear(),n==null||(i=n._cellMap)===null||i===void 0||i.clear(),n&&(n.element.classList.toggle("b-hide-allday-header",!e),n.refresh()),r.refresh()}changeAllDayEvents(e,t){if(!e)return t?.destroy();this.getConfig("date");const i=this,{autoCreate:r,dayHeaderRenderer:n,overflowButtonRenderer:s,overflowClickAction:a,overflowPopup:o,avatarRendering:l,range:d}=i,u=Rs.reconfigure(t,e,{owner:i,defaults:{type:"calendarrow",calendar:i.calendar,parent:i,rtl:i.rtl,cls:{"b-dayview-schedule-container":1,"b-dayview-initializing":1},[o!==void 0?"overflowPopup":"_"]:o,[s?"overflowButtonRenderer":"_"]:s,[a?"overflowClickAction":"_"]:a,[n?"dayHeaderRenderer":"_"]:n,[l?"avatarRendering":"_"]:l,autoCreate:r?{newName:r.newName,gesture:r.gesture,startHour:0,duration:"1 day"}:null,dayNameSelector:".b-day-name-date",eventFilter:h=>i.showAllDayHeader&&i.isAllDayEvent(h)&&(!i.eventFilter||i.eventFilter(h)),dayStartTime:i.dayStartTime,dayEndTime:i.dayEndTime,dayStartShift:i.dayStartShift,eventRenderer:i.eventRenderer,eventStore:i.eventStore,month:i.month,fullWeek:i.duration===1,startDate:i.startDate,[d?"range":"_"]:d,[d?"_":"endDate"]:i.endDate,nonWorkingDays:i.nonWorkingDays,nonWorkingDayCls:i.nonWorkingDayCls,weekendCls:i.weekendCls,weekStartDay:i.weekStartDay,defaultCalendar:i.defaultCalendar,emptyCellRenderer:i.emptyCellRenderer,internalListeners:{heightChange:"updateElementLayout",refresh:"updateElementLayout",catchall:"relayAllDayEvents",showoverflowpopup:"onAllDayOverflowPopupShown",thisObj:i},editAutoCreatedEvent(h){(i.showAllDayHeader?this:i).trigger("eventAutoCreated",{eventRecord:h})},createCellMap(){return i.showAllDayHeader?this.constructor.prototype.createCellMap.call(this,...arguments):i.emptyMap||(i.emptyMap=new Map)}},setup(h){h.hideNonWorkingDays=i.duration===1&&!h.fullWeek?!1:i._hideNonWorkingDays}});return u&&(u.height=u.flex=null,i.originalAllDayEventsScrollTo=u.scrollTo,u.scrollTo=i.allDayEventsScrollTo.bind(i)),u}onAllDayOverflowPopupShown({overflowPopup:e}){this._overflowPopup=e}allDayEventsScrollTo(e){const t=this,i=e.isEvent?e.startDate:t.changeEndDate(e);return(e.isEvent?b.intersectSpans(t.startDate,t.endDate,e.startDate,e.endDate):b.betweenLesser(i,t.startDate,t.endDate))||(t.date=i),t.originalAllDayEventsScrollTo.call(t.allDayEvents,...arguments)}updateAutoCreate(e){var t;const{_allDayEvents:i}=this;(t=super.updateAutoCreate)===null||t===void 0||t.call(this,e),i&&(i.autoCreate=e?{newName:e.newName,gesture:e.gesture,startHour:0,duration:"1 day"}:!1)}updateWeekStartDay(e,t){var i;(i=super.updateWeekStartDay)===null||i===void 0||i.call(this,e),!this.isConfiguring&&this.allDayEvents&&(this.allDayEvents.weekStartDay=e)}updateEventStore(e,t){super.updateEventStore(e,t);const{dayTime:i}=this;i&&(e?.registerDayIndex(i),t?.unregisterDayIndex(i))}get overflowPopup(){var e;return((e=this._allDayEvents)===null||e===void 0?void 0:e.overflowPopup)||this._overflowPopup}get stepUnit(){return this.duration>1?`${this.duration} ${this.L("L{daysUnit}")}`:this.L("L{dayUnit}")}get eventContentElement(){return this.dayContainerElement}getDateFromDomEvent(e,t=!1){let i=super.getDateFromDomEvent(e);const r=this,n=S.getEventElement(e);return i&&n!==e&&r.dayContainerElement.contains(n)&&(i=b.add(i,r.dayStartHour-r.dayStartShift/36e5+(e.clientY-r.scrollable.element.getBoundingClientRect().y+r.scrollable.y)/r.hourHeight,"hour"),t||(i=b.round(i,r.increment))),i}getDateFromPosition(e,t,i=!1){const r=this,{eventContentElement:n,allDayEvents:s}=r,a=r.dayContainerElement.querySelectorAll(`.${r.dayCellCls}`),o=i?Xx:$.fromScreen(n).roundPx().translate(-n.scrollLeft),l=n.scrollWidth,{height:d}=$.fromScreen(a[0]).roundPx(),u=i?e:e-o.x,h=r.rtl?r.eventContentElement.offsetWidth-u:u,f=t-o.y,g=a.length,m=Math.min(Math.floor(h/l*g),a.length-1);if(s&&(h<0||l<h||f<0||d<f))return s.getDateFromPosition(e,t);let p=r.getDateFromElement(a[0]);return r.hideNonWorkingDays?p=Array.from(a).map(y=>r.getDateFromElement(y))[m]:m&&p.setDate(p.getDate()+m),b.clearTime(p,!1),p.setMilliseconds(p.getMilliseconds()+r.dayStartMs+Math.floor(f/d*r.getDayLength())),b.round(p,r.increment)}doRefresh(){const e=this;if(e.isVisible){var t;S.addTemporaryClass(e.element,"b-no-transitions",200,e);const i=[];e.today=e.dayTime.startOfDay(((t=e.calendar)===null||t===void 0?void 0:t.dateTimeNow)||new Date);for(const r=new Date(e.startDate);r<e.endDate;r.setDate(r.getDate()+1))i.push(e.getDayDomConfig(r));Z.sync({targetElement:e.dayContainerElement,domConfig:{onlyChildren:!0,children:i,syncOptions:{syncIdField:"date",releaseThreshold:0,strict:!0}}}),e.refreshDayBackground(),e.refreshCount=(e.refreshCount||0)+1,e.syncCurrentTimeIndicator(),e.trigger("refresh")}}getBaseDayDomConfig(e){const t=this,i=t.dayTime.dateKey(e),r=t.cellMap.get(i)||t.createCellData(e),n=r.day,s=t.nonWorkingDays||t.month.nonWorkingDays;return(!t.hiddenNonWorkingDays[e.getDay()]||t.duration===1)&&[r,{dataset:{date:i},className:{"b-dayview-day-detail":1,[t.dayCellCls]:1,[t.nonWorkingDayCls]:s[n]||!1,[t.weekendCls]:b.weekends[n],[t.todayCls]:!(e-t.today),"b-last-cell":!(e-t.lastVisibleDate),[`b-day-of-week-${n}`]:1},style:{},children:{inset:{className:{"b-dayview-inset":1}},events:{className:{"b-dayview-event-container":1},children:[]}},syncOptions:{syncIdField:"eventId",releaseThreshold:0,strict:!0}}]}getDayDomConfig(e){const t=this,i=t.getBaseDayDomConfig(e);if(i){const{dayCellRenderer:r}=t,[n,s]=i;return t.coreHours&&(s.style.backgroundImage=t.getCoreHoursGradient(t.getCoreHoursForDate(e))),t.renderEvents(n,s),S.normalizeChildren(r?t.callback(r,t,[s,n]):s)}}getCoreHoursGradient(e){if(!e)return"";const t=this,{dayTime:i}=t,r=i.duration("h"),n=["linear-gradient(to bottom"];e=W.asArray(e);let s=0;for(let a=0,{length:o}=e;a<o;a++){const l=e[a],d=Math.max(i.delta(l.start,"h"),0)/r*100,u=Math.min(i.delta(l.end,"h"),r)/r*100;if(o===1&&d===0&&u===100)return"";s<d&&n.push(`var(--dayview-outside-core-hours-color) ${S.percentify(s)}, var(--dayview-outside-core-hours-color) ${S.percentify(d)}`),n.push(`transparent ${S.percentify(d)}, transparent ${S.percentify(u)}`),s=u}return s<100&&n.push(`var(--dayview-outside-core-hours-color) ${S.percentify(s)}, var(--dayview-outside-core-hours-color) 100%`),n.join(",")+")"}getCoreHoursForDate(e){const{coreHours:t}=this;return t.length===7?t[e.getDay()]:typeof t=="object"?t.overlayDay?t:null:this.callback(t,this,[e])}refreshDayEvents(e){const t=this;e=t.changeEndDate(e),t.today=t.dayTime.startOfDay(new Date);const i=t.getDayDomConfig(e);S.addTemporaryClass(t.element,"b-no-transitions",200,t),i.onlyChildren=!0,Z.sync({targetElement:t.getDayElement(e),domConfig:i})}renderEvents(e,t){const i=this,r=i.eventLayout.layoutEvents(e,t),{items:n}=r,{eventSpacing:s,rtl:a}=i;for(const o of n){const l=i.createEventDomConfig({eventRecord:o.eventRecord});l.className["b-starts-above"]=o.startsBefore,l.className["b-ends-below"]=o.endsAfter,o.cluster.items.length>1&&(l.className["b-cal-in-cluster"]=1),Object.assign(l.style,F({[s?"padding-bottom":""]:`${s}px`},o.getStyles(a))),t.children.events.children.push(l)}i.trigger("renderEvents",{context:r})}get overflowElement(){return this.dayContentElement}get cellMap(){var e;return(e=this._cellMap)!==null&&e!==void 0&&e.populated?this._cellMap:this.createCellMap()}get bodyConfig(){const e=this,{allDayEvents:t,maxAllDayHeight:i}=e;return Object.assign(super.bodyConfig,{children:{alldayRowElement:t?{className:{"b-dayview-allday-row":1},style:{[i?"maxHeight":""]:S.setLength(i)},children:{cornerElement:{className:{"b-dayview-allday-row-start":1,"b-dayview-allday-autoheight":t.autoHeight},children:{allDayTextElement:{className:"b-dayview-allday-text",html:e.L("L{EventEdit.All day}")},allDayToggleIcon:{tag:"button",className:"b-expand-allday-button b-icon b-icon-expand-row",dataset:{btip:"L{DayView.expandAllDayRow}"}}}},allDayEvents:t?.element,$scrollerPad:S.scrollBarPadElement}}:null,dayContentElement:{tabIndex:-1,className:{"b-dayview-day-content":1},children:{timeAxisElement:{children:e.getTimeElementConfigs(),className:{"b-timeaxis-container":1}},dayContainerElement:{className:{"b-dayview-day-container":1}}}},horizontalScrollerElement:{className:"b-virtual-scrollers b-hide-display",children:[{className:"b-virtual-scroller"},S.scrollBarPadElement]}}})}onDayContentMousewheel(e){if(e.ctrlKey){e.preventDefault();const t=e.clientY-this.scrollable.element.getBoundingClientRect().y,i=-Math.min(Math.abs(e.deltaY),10)*Math.sign(e.deltaY);this.zoomBy(i,t)}}zoomBy(e,t=Math.min(this.scrollable.scrollHeight,this.scrollable.clientHeight)/2-1){this.updateElementLayout.cancel();const i=this,{scrollable:r,hourHeight:n}=i,s=b.round(typeof t=="number"?i.getDateFromPosition(i.dayContainerElement.offsetWidth/2,t+r.y,!0):b.parse(t,"HH:mm:ss"),i.increment),a=i.getDayLength("h"),o=Math.max(n+e,i.dayContentClientHeight/a),l=i.getPositionFromTime(s)-r.y;i.ion({layoutUpdate:()=>{r.scrollTo(null,i.getPositionFromTime(s)-l),r.syncPartners(!1,!0)},once:!0,prio:1e3}),i.fitHours=!1,i.hourHeight=o}zoomTo(e,t){this.zoomBy(e-this.hourHeight,t)}createCellMap(){const{showAllDayHeader:e}=this;return super.createCellMap({dayTime:this.dayTime,startOnly:e,allowPartial:!e,skipPropagate:!0,rawEvents:!0,filter:this.cellMapEventFilter})}cellMapEventFilter(e){const{dayTime:t,hiddenNonWorkingDays:i,showAllDayHeader:r}=this;return(!r||t.isIntraDay(e)&&!e.allDay)&&t.intersects(e)&&!i[t.dayOfWeek(e.startDate)]}getDayLength(e="ms"){return this.dayTime.duration(e)}changeIncrement(e){return typeof e=="string"?(e=b.parseDuration(e),b.as("ms",e.magnitude,e.unit)):e}get dayStartHour(){return this.dayStartTime==null?0:Math.floor(this.dayStartTime/ia)}get dayEndHour(){return this.dayEndTime==null?24:Math.ceil(this.dayEndTime/ia)}get dayStartMs(){return this.dayStartTime==null?0:this.dayStartTime}get dayEndMs(){return this.dayEndTime==null?24*ia:this.dayEndTime}get dayStartOffset(){return this.dayTime.startTimeOffsetMs/ia*this.hourHeight}changeEventFilter(e){return e===void 0&&(e=t=>!this.isAllDayEvent(t)),e}changeEventLayout(e,t){return Ds.reconfigure(t,e,{owner:this,defaults:{owner:this}})}updateNonWorkingDays(e){var t;const i=this;if((t=super.updateNonWorkingDays)===null||t===void 0||t.call(this,e),i._allDayEvents&&(i._allDayEvents.nonWorkingDays=e),!i.isConfiguring){var r;(r=i._cellMap)===null||r===void 0||r.clear(),i.refresh()}}updateMaxAllDayHeight(e){S.setLength(this.alldayRowElement,"max-height",e)}get hideNonWorkingDays(){return this._hideNonWorkingDays===!0&&this.duration===1?!1:this._hideNonWorkingDays}set hideNonWorkingDays(e){super.hideNonWorkingDays=e}updateHideNonWorkingDays(e){const t=this,{_allDayEvents:i}=t;if(super.updateHideNonWorkingDays(e),i&&(i.hideNonWorkingDays=t.duration===1&&!i.fullWeek?!1:t._hideNonWorkingDays),!t.isConfiguring){var r;(r=t._cellMap)===null||r===void 0||r.clear(),t.refresh()}}syncHours(){var e;const t=this;(e=t._cellMap)===null||e===void 0||e.clear(),Z.sync({targetElement:t.timeAxisElement,childrenOnly:!0,domConfig:{children:t.getTimeElementConfigs()}}),t.updateElementLayout.now(),t.refresh()}syncCurrentTimeIndicator(){var e;const t=this,i=((e=t.calendar)===null||e===void 0?void 0:e.dateTimeNow)||new Date,r=t.getDayElement(i),{currentTimeIndicator:n,dayTime:s,endDate:a,startDate:o}=t;if(o&&a)if(r&&b.betweenLesser(i,o,a)&&s.contains(i)){const l=t.getDayLength("ms"),d=s.delta(i,"ms");n.parentNode!==r&&r?.appendChild(n),n.style.top=S.percentify(d/l*100)}else n.remove()}get currentTimeIndicator(){return this._currentTimeIndicator||(this._currentTimeIndicator=S.createElement(this.callback(this.currentTimeIndicatorRenderer,this)))}getTimeElementConfigs(){const e=this,t=[],{dayTime:i}=e,{startHour:r}=i,n=new Date(2e3,5,15,r,0,0),s=i.duration("h");for(let a,o=1;o<=s;o++){const l=e.createLeafTicks(n);n.setHours(a=n.getHours()+1),n.setMinutes(0),t.push({className:`b-dayview-timeaxis-time b-dayview-timeaxis-time-${a<10?"0":""}${a}`,children:l.concat([{className:"b-dayview-timeaxis-tick b-dayview-hour-tick",text:b.format(n,e.timeFormat)}])})}return e.coreHours&&e._simpleCoreHours&&t.unshift({className:"b-dayview-timeaxis-background",style:{backgroundImage:e.getCoreHoursGradient(e.coreHours)}}),t}createLeafTicks(e){return this[this.sixMinuteTicks?"createSixMinuteTicks":"createFiveMinuteTicks"](e)}createFiveMinuteTicks(e){const t=[];for(let i=1;i<12;i++)e.setMinutes(i*5),t.push({className:{"b-dayview-timeaxis-tick":1,"b-dayview-tick-level-4":1,"b-dayview-tick-level-3":!(i&1),"b-dayview-tick-level-2":!(i%3),"b-dayview-tick-level-1":i===6},text:b.format(e,this.timeFormat)});return t}createSixMinuteTicks(e){const t=[];for(let i=1;i<10;i++)e.setMinutes(i*6),t.push({className:{"b-dayview-timeaxis-tick":1,"b-dayview-tick-level-3":1,"b-dayview-tick-level-2":!(i&1),"b-dayview-tick-level-1":i===5},text:b.format(e,this.timeFormat)});return t}changeCoreHours(e){const t=this;return t._simpleCoreHours=T.isObject(e)||Array.isArray(e)&&e.length!==7,t._simpleCoreHours&&(e=T.clone(e),e._overlayDay=e.overlayDay,Object.defineProperty(e,"overlayDay",{set(i){this._overlayDay=i,t.updateCoreHours()},get(i){return this._overlayDay}})),e}updateCoreHours(){this.isConfiguring||this.syncHours()}changeStartDate(){return this.dayOfDate(super.changeStartDate(...arguments))}updateStartDate(e){const{_allDayEvents:t}=this;t&&this._allDayEvents.setConfig({date:this.date,startDate:e}),super.updateStartDate(...arguments)}changeEndDate(){return this.dayOfDate(super.changeEndDate(...arguments))}updateEndDate(e){var t;const{_allDayEvents:i}=this;(t=super.updateEndDate)===null||t===void 0||t.call(this,...arguments),i&&!this.updatingRange&&this._allDayEvents.setConfig({date:this.date,endDate:e})}changeMinDayWidth(e){return typeof e=="number"?Math.max(e,50):null}updateMinDayWidth(e){this.contentElement.style.setProperty("--min-day-width",S.setLength(e)),this._allDayEvents&&(this._allDayEvents.minDayWidth=e),this.updateElementLayout()}updateHourHeight(e){this.shortEventDuration=36e5/(e/this.shortEventHeight),this.isConfiguring||(this.updateElementLayout(),this.fitHours&&this.refresh())}updateShortEventHeight(e){this.updateHourHeight(this.hourHeight)}updateMinEventHeight(e){this.contentElement.style.setProperty("--dayview-min-event-height",S.setLength(e))}get hourHeight(){return!this.isConfiguring&&this.fitHours?Math.max(this.dayContentClientHeight/this.getDayLength("hour"),this.minHourHeight):this._hourHeight}changeFitHours(e){return e!=null&&e.minHeight?this.minHourHeight=Math.max(e.minHeight,9):this.minHourHeight=17,e}get dayContentClientHeight(){return S.floorPx($.client(this.dayContentElement).height)}updateFitHours(e){const t=this;t.isConfiguring||e&&(t.hourHeight=Math.max(t.dayContentClientHeight/t.getDayLength("hour"),t.minHourHeight)),t.element.classList.toggle("b-fit-hours",Boolean(e)),t.monitorResize=S.scrollBarWidth||e}updateEventSpacing(){if(!this.isConfiguring){var e;(e=this._cellMap)===null||e===void 0||e.clear(),this.refresh()}}onPaint({firstPaint:e}){const t=this,{dayContainerElement:i,horizontalScrollerElement:r}=t,{scrollBarWidth:n}=S;if(e){const{allDayEvents:s}=t;t.horizontalScroller=new Ke({widget:t,element:i,overflowX:n?"hidden-scroll":!0,overflowY:"clip"}),s&&(s.element.classList.remove("b-dayview-initializing"),t.horizontalScroller.addPartner(s.headerScroller)),Ne.addResizeListener(t.dayContainerElement,t.onDayContainerResize.bind(t)),t.scrollbarScroller=new Ke({widget:t,element:r.firstChild,scrollWidth:i.scrollWidth-n,overflowX:!0,overflowY:!1}),t.horizontalScroller.addPartner(t.scrollbarScroller),t.refresh(),t.updateElementLayout.now(),t.setInterval(t.syncCurrentTimeIndicator.bind(t),30*1e3,"syncCurrentTimeIndicator"),s&&(B.on({click:{element:t.cornerElement,handler:"onCornerClick"},mousemove:{element:t.allDayEvents.element.nextSibling,handler:qx,capture:!0},thisObj:t}),t.scrollable.ion({overflowChange:"syncScrollbarPadding",thisObj:t})),t.scrollToVisibleStartTime()}}scrollToVisibleStartTime(){if(this.visibleStartTime!=null){const e=this,{scrollable:t}=e,i=e.getPositionFromTime(e.visibleStartTime),r=()=>{t.scrollTo(null,i,{animate:!1,block:"start"})};i>t.maxY&&!e.scrollToStartTimer&&e.allDayEvents?e.scrollToStartTimer=e.allDayEvents.ion({heightChange:r,once:!0,expires:{delay:5e3,alt:r},name:"scrollToVisibleStartTime"}):r()}}relayAllDayEvents(e){const{type:t}=e;if(!Gx[t])return this.trigger(t,e)}async onCornerClick(){const{allDayEvents:e}=this;e.isAnimating||(await e.toggleExpandCollapse(),this.isDestroyed||(this.allDayToggleIcon.dataset.btip=e.expanded?this.L("L{collapseAllDayRow}"):this.L("L{expandAllDayRow}")))}syncScrollbarPadding(){if(!this.configuredHiddenVerticalScroll&&this.allDayEvents)if(S.scrollBarWidth){if(!this.allDayEvents.isAnimating){const{allDayEvents:e,alldayRowElement:t,scrollable:i}=this,r=this.fitHours&&i.clientHeight/this.getDayLength("hour")>=this.minHourHeight,n=!r&&i.hasOverflow(),{headerElement:s,scrollable:a}=e,o=e.expanded||e.autoHeight,l=Boolean(o&&a.hasOverflow());n&&l?(s.classList.add("b-show-yscroll-padding"),t.classList.remove("b-show-yscroll-padding"),i.overflowY=a.overflowY="auto"):l!==n?l?(s.classList.add("b-show-yscroll-padding"),a.overflowY="auto",i.overflowY="scroll"):(s.classList.remove("b-show-yscroll-padding"),t.classList.add("b-show-yscroll-padding"),a.overflowY="hidden",i.overflowY=!r&&"auto"):(t.classList.remove("b-show-yscroll-padding"),s.classList.remove("b-show-yscroll-padding"),i.overflowY=!r&&"auto",a.overflowY="hidden")}}else this.scrollable.overflowY=this.allDayEvents.scrollable.overflowY="auto"}onInternalResize(e,t,i,r,n){const{_allDayEvents:s}=this;super.onInternalResize(e,t,i,r,n),n&&(s?.performResizeRefresh(s.eventsPerCell,s.eventContainerTop),i!==n&&(this.updateElementLayout(),this.syncScrollbarPadding()))}onThemeChange(){this.updateElementLayout()}onDayContainerResize(e,{height:t}={},{height:i}){t&&(i!==t||S.scrollBarWidth&&this.minDayWidth)&&(this.updateElementLayout(),this.fitHours&&this.updateFitHours(this.fitHours))}async updateElementLayout(){var e;if(!this.refreshCount||(e=this.owner)!==null&&e!==void 0&&e.isDestroyed)return;const t=this,{dayContainerElement:i,horizontalScrollerElement:r,horizontalScroller:n,allDayEvents:s}=t,a=i.querySelectorAll(`.${t.dayCellCls}`),{scrollBarWidth:o}=S;let l,d;if(s){const u=t.cornerElement.classList;s.hasOverflow?(u.add("b-has-cell-overflow"),u.toggle("b-expanded",Boolean(s.expanded))):u.remove("b-has-cell-overflow")}for(t.refreshDayBackground.now(),l=0,d=a.length-1;l<=d;l++)a[l].classList.toggle("b-last-cell",l===d);if(s&&t.syncScrollbarPadding(),o&&r.classList.toggle("b-show-yscroll-padding",t.scrollable.hasOverflow()),a.length)if(t.minDayWidth&&i.scrollWidth>i.clientWidth){const u=t.minDayWidth||(a.length?a[0].offsetWidth:0),h=u*a.length;r.classList.remove("b-hide-display"),t.scrollbarScroller.scrollWidth=h,n.overflowX="hidden-scroll"}else r.classList.add("b-hide-display"),n.overflowX=!1;t.trigger("layoutUpdate")}refreshDayBackground(){const e=this,{contentElement:t,hourHeight:i,dayStartOffset:r,_hourHeightLevel:n,hourHeightLevel:s}=e,a=e.dayContentElement.classList,o=e.getDayLength("hour"),l=i*o,d=(i-1)/2,u=(i-1)/12,h=(i-1)/10,f=t.style,g=Math.ceil(b.format(Yx,e.timeFormat).length/2);a.remove("b-dayview-hourheight-level-1","b-dayview-hourheight-level-2","b-dayview-hourheight-level-3","b-dayview-hourheight-level-4"),a.add(`b-dayview-hourheight-level-${s.level}`),f.setProperty("--time-axis-width",`${g}em`),f.setProperty("--day-length",o),f.setProperty("--day-height",`${l}px`),f.setProperty("--hour-height",`${i}px`),f.setProperty("--half-hour-height",`${d}px`),f.setProperty("--five-minute-height",`${u}px`),f.setProperty("--leaf-tick-height",`${e.sixMinuteTicks?h:u}px`),f.setProperty("--day-start-offset",`${r}px`),s.level!==n?.level&&e.trigger("tickChange",{old:n||If,new:s})}updateSixMinuteTicks(){this.isConfiguring||this.updateElementLayout()}changeHourHeightBreakpoints(e){return Array.isArray(e)?e:Object.values(e)}updateHourHeightBreakpoints(){this.isConfiguring||this.updateElementLayout()}get hourHeightLevel(){const e=this,{hourHeight:t,hourHeightBreakpoints:i,sixMinuteTicks:r}=e,n=r?Jx:Zx;for(let s=r?2:3;s>=0;s--)if(t>=i[s])return e._hourHeightLevel={level:s+1,step:n[s]};return e._hourHeightLevel=If}updateLocalization(){!this.isConfiguring&&this.allDayTextElement&&Z.sync({targetElement:this.allDayTextElement,domConfig:{html:this.L("L{EventEdit.All day}")}}),super.updateLocalization()}}Ms.initClass();Ms._$name="DayView";class sn extends wt.mixin(Wg,C0,Zn){get hideNonWorkingDays(){var e;return(e=this.calendar)===null||e===void 0?void 0:e.hideNonWorkingDays}set hideNonWorkingDays(e){const{calendar:t}=this;t&&!(!e&&t.hideNonWorkingDays==null)&&(t.hideNonWorkingDays=e)}changeIncludeWeekendsButton(e,t){var i;const r=this,n=e&&((i=r.calendar)===null||i===void 0?void 0:i.includeWeekendsButton);return n&&(e=Ft.mergeConfigs(e,n)),e&&!t?r.add(e):Ft.reconfigure(t,e,r)}updateIncludeWeekendsButton(e){e&&(e.toggleGroup=null),this.syncFullWeek()}changeIncludeWeekendsMenuItem(e,t){var i;const r=this===null||this===void 0||(i=this.button)===null||i===void 0?void 0:i.menu;return e&&!t?r?.add(e):wi.reconfigure(t,e,r)}updateIncludeWeekendsMenuItem(){this.syncFullWeek()}onBeforeFirstShowModeMenu({menu:e}){const t=this,{calendar:i}=t,{activeView:r}=i,n=Object.values(i.modes);let s,a;for(a of n)s=a.$modeMenuItem,e.add(s),s.checked=a===r,s.onToggle="up.onToggleMenuItem";t.getConfig("includeWeekendsMenuItem"),t.syncFullWeek(),t.menuReady=!0}addMode(e,t,i){const r=this,{buttonBar:n}=r,s=t.$modeMenuItem=wi.reconfigure(t.$modeMenuItem,wi.mergeConfigs({type:wi,view:t,ref:`${e}ShowMenuItem`,checked:!1,closeParent:!0,toggleGroup:`${r.id}-modeSelectorMenuItem`,localizable:!1,text:t.displayName,weight:0},i)),a=n.add(Ft.mergeConfigs({view:t,ref:`${e}ShowButton`,toggleGroup:`${r.id}-modeSelectorButton`,text:t.displayName,localizable:!1,onBeforeToggle:"up.onBeforeToggleButton",onToggle:"up.onToggleButton",weight:0},i));r.getConfig("includeWeekendsButton"),t.ion({thisObj:r,localized(){a.text=t.displayName,s.text=t.displayName}})}onBeforeToggleButton({pressed:e}){if(e&&this.calendar.viewContainer.layout.isChangingCard)return!1}onToggleButton({source:e,pressed:t}){t&&(this.calendar.mode=e.view)}updateDisabled(e){this.buttonBar.items.forEach(t=>{(!e||!t.containsFocus)&&(t.disabled=e)})}onToggleMenuItem({source:e,checked:t}){t&&(this.calendar.mode=e.view)}onToggleWorkingDaysButton({pressed:e}){this.hideNonWorkingDays=!e}onToggleWorkingDaysMenu({checked:e}){this.hideNonWorkingDays=!e}syncActiveMode(e){const t=this,i=t.buttonBar.items;let r;t.button.text=e.displayName,t.includeWeekendsButton.hidden=!e.hasNonWorkingDays,t.syncFullWeek();for(r of i)r.view&&(r.pressed=r.view===e);if(t.menuReady)for(r of t.button.menu.items){var n;((n=r.view)===null||n===void 0?void 0:n.$modeMenuItem)===r&&(r.checked=r.view===e)}t[i.length>1?"show":"hide"]()}syncFullWeek(){const{calendar:e,hideNonWorkingDays:t,_includeWeekendsButton:i,_includeWeekendsMenuItem:r}=this,n=!t;e.isConfiguring||(i&&(i.pressed=n),r&&(r.checked=n))}changeButton(e,t){return Ft.reconfigure(t,e)}updateButton(e){e&&this.add(e)}changeButtonBar(e,t){return _t.reconfigure(t,e)}updateButtonBar(e){e&&this.add(e)}changeCalendar(e){return e&&!e.isWidget&&(e=this.up(e)),e}updateCalendar(e){this.detachListeners("cal"),this.syncFullWeek(),e?.ion({name:"cal",changeHideNonWorkingDays:"syncFullWeek",thisObj:this})}}M(sn,"$name","ModeSelector");M(sn,"type","calendarmodeselector");M(sn,"configurable",{minifiable:!0,minified:null,button:{type:"button",icon:"b-icon-calendar-days",cls:"b-calendar-mode-button",menuIcon:null,menu:[],internalListeners:{beforeShowMenu:"up.onBeforeFirstShowModeMenu",once:!0}},buttonBar:{type:"buttongroup",ignoreParentReadOnly:!0},calendar:{value:"calendar",$config:"lazy"},includeWeekendsButton:{$config:"lazy",value:{type:"button",cls:"b-calendar-fullweek-button",toggleGroup:"no",text:"L{ModeSelector.weekends}",tooltip:"L{ModeSelector.includeWeekends}",onToggle:"up.onToggleWorkingDaysButton",weight:-1}},includeWeekendsMenuItem:{$config:"lazy",value:{separator:!0,text:"L{ModeSelector.includeWeekends}",checked:!1,onToggle:"up.onToggleWorkingDaysMenu",weight:10}},layout:{type:"box",wrap:!1},overflowable:"none",responsive:{large:{minifiable:!0,minified:null},"*":{minifiable:!1,minified:!0}},responsiveTarget:"@calendar"});M(sn,"fenced",{onToggleButton:!0,onToggleMenuItem:!0,syncFullWeek:!0,syncActiveMode:{all:"syncActiveMode",lock:["onToggleButton","onToggleMenuItem","syncActiveMode"]}});sn.initClass();sn._$name="ModeSelector";const Ff=/^(\d+)ev$/,Qx={shrinkwrap:1,expand:1};class oc extends _i.mixin(rn,xs,nc){static get $name(){return"MonthView"}static get type(){return"monthview"}static get configurable(){return{eventSorter:Es.interDaySorterFn,localizableProperties:["title","stepUnit"],title:"L{Month}",stepUnit:"L{monthUnit}",localeClass:this,descriptionFormat:"MMMM, YYYY",dayNumberCentered:null,eventHeight:20,minHeight:485,autoRowHeight:{$config:"lazy",value:!1},maxEventsPerCell:100,minRowHeight:null,overflowClickAction:"popup",alwaysRefreshOnMonthChange:!0}}static get delayable(){return{syncCalendarWeekDaysWithScrollable:{type:"raf",cancelOutstanding:!0},onAllWeekElementsCollapsed:{type:"raf",cancelOutstanding:!0}}}onCalendarStoreChange(){super.onCalendarStoreChange(...arguments),this.syncShrinkwrappedRows()}onDateChange({changes:e}){e.m&&this.syncShrinkwrappedRows()}onCellOverflowGesture({date:e}){Qx[this.overflowClickAction.toLowerCase()]?this.shrinkwrapWeekRow(e):super.onCellOverflowGesture(...arguments)}addCellHeaderContent(e,t){const i={className:{"b-day-name":!0}};return e.children=[t.visibleColumnIndex||this.showWeekColumn?null:{className:"b-week-num",text:t.week[1]},i],i}get shrinkwrappedRows(){return this.weeksElement.querySelectorAll(".b-shrinkwrapped")}get shrinkwrapRowHeights(){const e=this,t=[],{cellMap:i}=e;return e.month.eachWeek((r,[n])=>{let s=0;for(let a=0;a<7;a++,n.setDate(n.getDate()+1)){const o=i.get(b.makeKey(n));o&&(s=Math.max(s,o.renderedEvents.length))}t.push(s)}),t.map(r=>e.eventHeightInPixels*r+e.eventSpacing*(r+1)+Math.ceil(e._eventContainerTop))}getEventsPerCell(e){const t=this;if(t.hasShrinkwrappedRows){const i=Math.floor(b.diff(t.startDate,e,"d")/7);if(t.weekElements[i].classList.contains("b-shrinkwrapped"))return t.maxEventsPerCell;{const r=t.weekElements[i].querySelector(t.visibleCellSelector),n=r.offsetHeight-t.eventContainerTop;return Math.floor((n+t.eventSpacing)/(t.eventHeightInPixels+t.eventSpacing))}}else return t.eventsPerCell}getMaxEventsForWeek(e){const{row:t}=this.getWeekContext(e);return Math.max(...Array.from(t.querySelectorAll(this.visibleCellSelector)).map(i=>{const r=this.cellMap.get(i.dataset.date);return r?.renderedEvents.length||0}))}getWeekContext(e){let t,i;if(typeof e=="number")i=e,t=b.parseKey(this.weekElements[e].querySelector(this.visibleCellSelector).dataset.date);else if(e.nodeType===1)t=b.parseKey(e.closest(".b-calendar-row").querySelector("[data-date]").dataset.date),i=Math.floor(b.diff(this.startDate,t,"d")/7);else{const r=(e.getDay(e)-b.weekStartDay+7)%7;t=b.add(b.clearTime(e),-r,"d"),i=Math.floor(b.diff(this.startDate,e,"d")/7)}return{rowIndex:i,weekStart:t,row:this.weekElements[i]}}shrinkwrapWeekRow(e,t=!0){const i=this,{weekStart:r,row:n}=i.getWeekContext(e),{weekElements:s}=i,a=n.classList.contains("b-shrinkwrapped"),o=i.getMaxEventsForWeek(e),l=i.eventHeightInPixels*o+i.eventSpacing*(o+1)+Math.ceil(i._eventContainerTop);for(let u=0,{length:h}=s;u<h;u++){const f=s[u];f.classList.contains("b-shrinkwrapped")||(f.style.flex=`0 0 ${S.percentify(1/i.visibleWeekCount*100)}`)}t&&(i.scrollable={overflowY:"auto"});const d=n.getBoundingClientRect();if(n.classList.add("b-shrinkwrapped"),l>d.height&&n.classList.add("b-expanded"),i.hasShrinkwrappedRows=!0,n.style.flex=`0 0 ${l}px`,t&&i.refresh(),a||i.trigger("weekShrinkwrap",{weekStart:r,element:n}),t)return i.isAnimating||(i.isAnimating=!0),new Promise(u=>{B.onTransitionEnd({element:n,property:"flex-basis",handler:"onAllWeekElementsExpanded",thisObj:i,args:[u]})})}onAllWeekElementsExpanded(e,t,i){this.isAnimating=!1,this.syncCalendarWeekDaysWithScrollable(),i()}flexWeekRow(e,t=!0){const i=this,{weekStart:r,row:n}=i.getWeekContext(e);if(n.classList.contains("b-shrinkwrapped"))return n.style.flex=`0 0 ${S.percentify(1/i.visibleWeekCount*100)}`,n.classList.add("b-flexing"),i._autoRowHeight=!1,i.trigger("weekFlex",{weekStart:r,element:n}),t&&!i.isAnimating&&(i.isAnimating=!0),new Promise(a=>{B.onTransitionEnd({element:n,property:"flex-basis",handler:t?"onAllWeekElementsCollapsed":"onWeekElementCollapsed",thisObj:i,args:[a]})})}onWeekElementCollapsed(e,t,i){e.classList.remove("b-shrinkwrapped","b-flexing","b-expanded"),i()}onAllWeekElementsCollapsed(e,t,i){const r=this,{weekElements:n}=r;if(r.scrollable.overflowY=r.scrollable.hasOverflow("y"),e.classList.remove("b-shrinkwrapped","b-flexing","b-expanded"),!r.contentElement.querySelector(".b-calendar-week.b-shrinkwrapped"))for(let s=0,{length:a}=n;s<a;s++){const o=n[s];o.classList.contains("b-shrinkwrapped")||(o.style.flex="")}r.isAnimating=!1,r.hasShrinkwrappedRows=r.shrinkwrappedRows.length,r.refresh(),r.syncCalendarWeekDaysWithScrollable(),i()}syncCalendarWeekDaysWithScrollable(){var e;this.weekdaysHeader.classList[(e=this.scrollable)!==null&&e!==void 0&&e.hasScrollbar()?"add":"remove"]("b-show-yscroll-padding")}updateHideOtherMonthCells(){super.updateHideOtherMonthCells(...arguments),this.refresh()}updateEventHeight(e,t){const i=this;if(super.updateEventHeight(e,t),!i.isConfiguring){var r;(r=i.minRowHeight)!==null&&r!==void 0&&r.match(Ff)&&i.updateMinRowHeight(i._minRowHeight),i.syncShrinkwrappedRows();const n=S.getEdgeSize(i.element,"padding","tb");i.minHeight=((i.eventHeightInPixels+1)*2+i.eventSpacing*3+Math.ceil(i.eventContainerTop))*6+i.weekdaysHeader.offsetHeight+7+n.height}}updateMinRowHeight(e){var t,i,r;const n=this,s=parseInt((t=e)===null||t===void 0||(i=t.match)===null||i===void 0||(r=i.call(t,Ff))===null||r===void 0?void 0:r[1]);if(!isNaN(s)){if(n.isConfiguring)return n.ion({paint:"updateMinRowHeight",args:[e],once:!0});e=n.eventHeightInPixels*s+n.eventSpacing*(s+1)+Math.ceil(n.eventContainerTop)}n.cssMinRowHeight=S.setLength(e),super.updateMinRowHeight(e),n.isAnimating?n.ion({animationEnd:"performResizeRefresh",thisObj:n,args:[n._eventsPerCell,n._eventContainerTop],once:!0}):n.performResizeRefresh(n._eventsPerCell,n._eventContainerTop)}async updateAutoRowHeight(e,t){var i,r;if(this.initializingAutoRowHeight&&e===Boolean(t))return;const n=this,{weekElements:s}=n,{length:a}=s,o=(i=n.features||((r=n.calendar)===null||r===void 0?void 0:r.features))===null||i===void 0?void 0:i.weekExpander;let l;if(o&&e&&(o.disabled=o.disabledByAutoRowHeight=!0),e)for(let d=0;d<a;d++)l=n.shrinkwrapWeekRow(d,d===a-1);else for(let d=0;d<a;d++)l=n.flexWeekRow(d,d===a-1);await l,o&&!e&&o.disabledByAutoRowHeight&&(o.disabled=o.disabledByAutoRowHeight=!1),e||(n._eventContainerHeight=n._eventsPerCell=null,n.refresh())}syncShrinkwrappedRows(){if(this.isVisible){const{shrinkwrappedRows:e}=this;for(let t=0,{length:i}=e;t<i;t++)this.shrinkwrapWeekRow(e[t],t===i-1)}}changeScrollable(e,t){var i;return e=super.changeScrollable(e,t),(i=e)!==null&&i!==void 0&&i.overflowX&&(this.weekdaysScrollable||(this.weekdaysScrollable=new Ke({widget:this,element:this.weekdaysHeader,overflowX:"hidden-scroll"})),e.addPartner(this.weekdaysScrollable,"x")),e}collectEvents(e){if(this.hideOtherMonthCells){const{year:t,month:i}=this.month;e.startDate=new Date(t,i,1),e.endDate=new Date(t,i+1,1)}return e.getDateIndex=t=>t>(this.firstVisibleDate||this.startDate)?"startDate":"date",this.eventStore.getEvents(e)}getDayElement(e,t){if(typeof e!="string"&&(e=b.makeKey(e)),!(t&&parseInt(e.substr(5,2))!==this.month.month+1))return super.getDayElement(e)}calendarHitTest(e){const t=super.calendarHitTest(e),i=S.getEventElement(e);if(t){var r;if(t.date.getMonth()!==this.month.month&&(this.disableOtherMonthCells||this.hideOtherMonthCells))return;const s=i.closest(".b-calendar-week"),a=s==null||(r=s.dataset.week)===null||r===void 0?void 0:r.split(",").map(Number);if(a){var n;t.cell=t.cell||i.closest(".b-calendar-cell"),t.dayNumber=Number((n=t.cell)===null||n===void 0?void 0:n.dataset.columnIndex),t.week=a,t.weekElement=s,t.weekNumber=a[1],t.weekOffset=a[1]-Number(this.weeksElement.firstElementChild.dataset.week.split(",")[1])}}return t}getDateFromPosition(e,t){const i=this,r=i.weeksElement.childNodes;for(let n,s=0;s<r.length;++s)if(n=r[s].getBoundingClientRect(),n.top<=t&&t<n.bottom&&n.left<=e&&e<n.right){const a=i.rtl?n.right-e:e-n.x,o=Math.floor(a*i.weekLength/n.width);if(i.hideNonWorkingDays)return Array.from(r[s].querySelectorAll(i.visibleCellSelector)).map(d=>i.getDateFromElement(d))[o];{const l=i.getDateFromElement(r[s].querySelector(i.visibleCellSelector));return l.setDate(l.getDate()+o),l}}return null}getWeekElementFor(e){const t=S.getEventElement(e);return t?.closest(".b-calendar-week")||null}updateEventStore(e,t){var i;(i=super.updateEventStore)===null||i===void 0||i.call(this,e,t),_i.prototype.doRefresh.call(this)}updateOverflowClickAction(){this.refresh()}updateSixWeeks(){this._eventsPerCell=this._eventContainerTop=this._eventContainerHeight=null,super.updateSixWeeks(...arguments)}onMonthDateChange({changes:e}){e.r&&!this.sixWeeks&&(this._eventsPerCell=this._eventContainerTop=this._eventContainerHeight=null),super.onMonthDateChange(...arguments)}doRefresh(){if(!this.isConfiguring){var e;this.getConfig("autoRowHeight"),(e=this._cellMap)===null||e===void 0||e.clear()}const t=super.doRefresh();return this.syncCalendarWeekDaysWithScrollable(),t}showEvent(e){this.setDate(e.startDate)}changeDayNumberCentered(e){return Boolean(e)}updateShowWeekColumn(e){!e&&!this.element.querySelector(".b-week-num")&&this.doRefresh(),super.updateShowWeekColumn(e)}updateHideNonWorkingDays(e){var t;(t=super.updateHideNonWorkingDays)===null||t===void 0||t.call(this,e),this.isConfiguring||this.refresh()}updateDayNumberCentered(e){const t=this;!t._dayNumberCentered&&!("nonCenteredDayNumShowWeekColumn"in t)&&(t.nonCenteredDayNumShowWeekColumn=t.showWeekColumn),t._dayNumberCentered=e,t.element.classList[e?"add":"remove"]("day-number-center"),t.showWeekColumn=e?!0:t.nonCenteredDayNumShowWeekColumn}get dayNameSelector(){return this.showWeekColumn?".b-cal-cell-header":super.dayNameSelector}set dayNameSelector(e){this._dayNameSelector=e}isValidTargetDate(e){if(e.getMonth()!==this.month.month){var i,r;const n=this.minDate||((i=this.calendar)===null||i===void 0?void 0:i.minDate),s=this.maxDate||((r=this.calendar)===null||r===void 0?void 0:r.maxDate);if(!isNaN(n)||!isNaN(s)){const{cellMonth:a}=this;if(a.date=e,!isNaN(n)&&a.startDate<n||!isNaN(s)&&b.add(a.endDate,1,"d")>s)return!1}}return!0}set startDate(e){this.date=e}get startDate(){return super.startDate}next(){this.date=b.add(this.date||this.startDate,1,"month")}previous(){this.date=b.add(this.date||this.startDate,-1,"month")}}oc.initClass();oc._$name="MonthView";const Gl=new Date(0),Af=b.add(Gl,1,"day"),rv=Object.freeze(new Map),eR={hourHeight:1,showAllDayHeader:1};class lc extends Ye.mixin(rn){constructor(...e){super(...e),M(this,"sharedConfigs",["allowOverlap","timeFormat","fitHours","hourHeight","visibleStartTime","dateFormat","dayStartTime","dayEndTime","hideNonWorkingDays","readOnly","zoomOnMouseWheel"]),M(this,"timeAxisConfigs",["allDayEvents"].concat(this.sharedConfigs))}static get $name(){return"ResourceView"}static get type(){return"resourceview"}static get configurable(){return{textContent:!1,scrollable:{overflowX:!0},date:{$config:{equal:"date"},value:null},view:{type:"weekview"},stableResourceOrder:!0,resourceWidth:null,hideNonWorkingDays:null,viewCache:{$config:["lazy","nullify"],value:!0},avatarRendering:{},meta:null,showAvatars:!0,includeTimeRanges:null}}construct(){var e,t;super.construct(...arguments),(e=this.calendar.sidebar)===null||e===void 0||(t=e.widgetMap.resourceFilter)===null||t===void 0||t.ion({change:"onResourceFilterSelectionChange",thisObj:this})}get isAnimating(){return super.isAnimating||this.items.some(e=>e.isAnimating)}get hasNonWorkingDays(){return!0}changeView(e){const t=this,i=new Proxy(T.assign({},e),{set(r,n,s){const a=Reflect.set(...arguments);return t.syncViewConfig(n,s),a},deleteProperty(r,n){const s=Reflect.deleteProperty(...arguments);return t.syncViewConfig(n,null),s}});return t.viewType=bryntum.Calendar.Modes.resolveType(e.type),i}eachView(e,t,i=null){const r=t==null,n=[...this.viewCache];for(let s=0,{length:a}=n;s<a;s++){const o=n[s];if(r&&(t=[o,s]),o.callback(e,i||o,t)===!1)return}}get views(){return[...this.viewCache]}updateResourceStore(e){var t;this.detachListeners("resourceViewResourceChange"),(t=super.updateResourceStore)===null||t===void 0||t.call(this,e),e.ion({name:"resourceViewResourceChange",change:"onResourceStoreChange",sort:"onResourceStoreSort",thisObj:this}),this.refreshSoon()}onResourceStoreChange(){this.refreshSoon()}onResourceStoreSort({source:e}){const t=this.items.filter(n=>n.isVisible&&!n.isResourceDayViewTimeAxis),i=e.map(n=>this.createViewId(n)),r=t.map(n=>n.id);T.isEqual(i,r)||(this.remove(...t),this.refreshSoon())}onResourceFilterSelectionChange(){this.refreshSoon()}changeViewCache(e,t){if(e)return new Fn;t&&(t.forEach(i=>i.destroy()),t.clear())}getResourceView(e){return this.viewCache.get(this.createViewId(e))||this.createView(e)}doRefresh(){var e,t;const i=this,{scrollBarWidth:r}=S,{calendar:n,_items:s,resourceStore:a}=i,{resourceFilter:o}=n?.widgetMap,l=o?i.resourceStore.records.filter(v=>o.value.includes(v)):i.resourceStore.records,{length:d}=l,u=[],h=[],f={};if(!a.count){const{weekStartDay:v}=i,y=b.getFirstDateOfMonth(i.date),C=b.add(y,1,"month");i.eventStore.getEvents({startDate:b.add(y,-(y.getDay()-v+7)%7,"d"),endDate:b.add(C,7-(C.getDay()-v+7)%7,"d")})}i.refreshSoon.cancel();let g=0;for(let v=0;v<d;v++){const y=i.getResourceView(l[v]),C=s.includes(y);a.getById(y.resourceId)?(y.title=i.titleTemplate(y.resource),C?g++:u.push(y),f[y.id]=1):C&&h.push(y)}g<s.count&&(i.eachView(v=>{f[v.id]||h.push(v)}),i.remove(h)),i.viewType.isDayView&&(s.includes(i.dayViewTimeAxis)||u.unshift(i.dayViewTimeAxis),r&&!s.includes(i.dayViewScroller)&&u.push(i.dayViewScroller));const m=(e=i.items[0])===null||e===void 0||(t=e.scrollable)===null||t===void 0?void 0:t.y;if(i.add(...u),m!=null&&u.forEach(v=>{v.scrollable.element.scrollTop=m}),u.length||h.length){let v;for(let y=0,{items:C}=i,{length:D}=C;y<D;y++){var p;const w=C[y],{scrollable:E}=w;w.element.classList.remove("b-last-resource-view"),w.isResourceDayViewTimeAxis||(w.element.classList[y>1?"remove":"add"]("b-first-resource-view"),v=w),E&&(E.clearPartners(),y&&w.scrollable.addPartner(C[y-1].scrollable,"y")),(p=w.allDayEvents)===null||p===void 0||p.refresh()}if(v&&v.element.classList.add("b-last-resource-view"),i.viewType.isDayView){const y=i.views.filter(D=>D.allDayEvents&&D.isVisible),C=y.length&&Math.max(...y.map(D=>D.allDayEvents.cellContentHeight));C&&s.forEach(D=>{var w;(w=D.allDayEvents)===null||w===void 0||w.setEventContentHeight(C,!1,!0)})}}i.viewType.isDayView&&i.syncDayViewScrollerVisibility(),i.refreshCount=(i.refreshCount||0)+1,i.trigger("refresh")}onCalendarPointerInteraction(){}onCalendarStoreChange(){}onChildAdd(e){super.onChildAdd(e),ve.before(e,"onConfigChange","onChildViewConfigChange",this,{return:!1})}onChildViewConfigChange({name:e,value:t}){if(!this.syncingChildViewConfigs&&this.timeAxisConfigs.includes(e)){const i=new Set(this.items.concat([...this.viewCache]));this.syncingChildViewConfigs=!0,i.forEach(r=>{e in r&&(r[e]=t)}),this.syncingChildViewConfigs=!1}}createView(e){var t;const i=this,{id:r}=e,{resourceStore:n,viewCache:s}=i,{project:a}=n,o=U.merge({project:a,calendar:i.calendar,id:i.createViewId(e),cls:"b-resourceview-resource",defaultCalendar:r,resource:e,resourceId:r,includeTimeRanges:i.includeTimeRanges,hideNonWorkingDays:i.hideNonWorkingDays,parent:i,date:i.date,dateFormat:i.dateFormat,title:i.titleTemplate(e)},i.view);T.copyProperties(o,[...s][0]||i,i.sharedConfigs),S.scrollBarWidth&&i.viewType.isDayView&&(o.scrollable={overflowX:!1,overflowY:"hidden-scroll"});const l=bryntum.Calendar.Modes.create(o);return l.ion({catchAll:"onChildViewCatchAll",thisObj:i}),l.element.removeAttribute("tabIndex"),l.element.dataset.viewResourceId=e.id,(t=l.contentElement)===null||t===void 0||t.removeAttribute("tabIndex"),Object.defineProperty(l,"weight",{get(){return i.stableResourceOrder?n.allIndexOf(r):0}}),Object.defineProperty(l,"resource",{get(){return n.getById(r)}}),Object.defineProperty(l,"eventFilter",{get(){return d=>d.resources.includes(this.resource)}}),s.add(l),i.trigger("viewCreate",{view:l}),l}onChildViewCatchAll(e){e.resourceRecord=e.source.resource,e.type!=="paint"&&this.trigger(e.type,e),e.type==="heightchange"&&this.syncDayViewScrollerVisibility()}changeAvatarRendering(e){if(e)return Di.new({element:this.element},e)}titleTemplate(e){const t=this,{meta:i}=t,r=typeof i=="string"?e[i]:i?.(e),n=S.isNamedColor(e.eventColor)&&e.eventColor,s=!n&&e.eventColor;return{class:{"b-resourceview-title":1,"b-has-meta":r},children:[t.showAvatars&&{class:{"b-resource-avatar-container":1,[`b-sch-foreground-${n}`]:n},style:{color:s||null},children:[t.getResourceAvatar(e)]},{class:"b-resource-name",text:e.name},r&&{class:"b-resource-meta",text:r}]}}getEventElement(e,t=e.startDate){var i;return(i=this.getResourceView(e.resource))===null||i===void 0?void 0:i.getEventElement(e,t)}get dayViewTimeAxis(){const e=this;if(!e._dayViewTimeAxis){const t=T.copyProperties({},e.view,e.timeAxisConfigs);e._dayViewTimeAxis=ql.create(F(F({},t),{},{weight:-1,project:e.project,type:"resourcedayviewtimeaxis",minWidth:0,cls:"b-resource-dayview-timeaxis",startDate:Gl,endDate:Af,scrollable:{overflowX:!1,overflowY:"hidden-scroll"},onCornerClick(){const{expanded:i}=e.firstChild.allDayEvents,r=[];let n=null;e.eachView(({allDayEvents:a})=>{i?(!n||a.maxEventCount<n.maxEventCount)&&(n=a):(!n||a.maxEventCount>n.maxEventCount)&&(n=a)});const s=n.refreshCount;n.expanded=!i,n.refreshCount===s&&r.push(n),e.items.forEach(a=>{if(a!==n){const{allDayEvents:o}=a,l=o.refreshCount;a.allDayEvents.expanded=!i,o.refreshCount===l&&r.push(o)}});for(let a=0,{length:o}=r;a<o;a++)r[a].doRefresh()}}),e),Ne.addResizeListener(e._dayViewTimeAxis.timeAxisElement,e.syncDayViewScrollerVisibility.bind(e))}return e._dayViewTimeAxis}get dayViewScroller(){const e=this;if(!e._dayViewScroller){const t=T.copyProperties({},e.view,e.timeAxisConfigs);e._dayViewScroller=ql.create(F(F({},t),{},{weight:999,project:e.project,type:"resourcedayviewtimeaxis",flex:`0 0 ${S.scrollBarWidth}px`,minWidth:S.scrollBarWidth,cls:"b-resource-dayview-scroller",startDate:Gl,endDate:Af,scrollable:{overflowX:!1,overflowY:"scroll"}}),e),e._dayViewScroller.scrollable.addPartner(e.dayViewTimeAxis.scrollable,"y"),e.monitorResize=!0}return e._dayViewScroller}onElementResize(){super.onElementResize(),this.syncDayViewScrollerVisibility()}syncDayViewScrollerVisibility(){if(this.dayViewScroller){const e=this.dayViewTimeAxis.scrollable.hasOverflow("y");this.dayViewScroller.isVisible!==e&&this.dayViewScroller[e?"show":"hide"]()}}scrollTo(e){const{items:t}=this;if(e.isEventModel){const i=t.find(r=>r.eventStore.includes(e));return i?.scrollTo(e)}return t[0].scrollTo(e)}createViewId(e){return`${this.id}-resource${this.config.view.type}-${e.id}`}updateDate(e){this.suspendVisibility(),this.viewCache.forEach(t=>{t.isResourceDayViewTimeAxis||(t.date=e)}),this.resumeVisibility(),this.viewType.isDayView&&this.items.forEach(t=>{var i,r;(i=t.allDayEvents)===null||i===void 0||i.setEventContentHeight((r=t.allDayEvents)===null||r===void 0?void 0:r.cellContentHeight)})}updateResourceWidth(e){this.contentElement.style.setProperty("--resource-width",S.setLength(e))}updateHideNonWorkingDays(e){this.isConfiguring||this.syncViewConfig("hideNonWorkingDays",e)}updateNonWorkingDays(e){this.isConfiguring||this.syncViewConfig("nonWorkingDays",e)}updateIncludeTimeRanges(e){this.isConfiguring||this.syncViewConfig("includeTimeRanges",e)}syncViewConfig(e,t){const i=r=>{r[e]=t};eR[e]?this.items.forEach(i):this.eachView(i)}descriptionRenderer(){var e;return((e=[...this.viewCache.items][0])===null||e===void 0?void 0:e.description)||"No resources"}get startDate(){return new Date(Math.min(...this.items.reduce((e,t)=>(t.isResourceDayViewTimeAxis||e.push(t.startDate),e),[])))}get endDate(){return new Date(Math.max(...this.items.reduce((e,t)=>(t.isResourceDayViewTimeAxis||e.push(t.endDate),e),[])))}get stepUnit(){const e=[...this.viewCache][0];return e?.stepUnit}get firstChild(){return this.items.filter(e=>!e.isResourceDayViewTimeAxis)[0]}previous(){const e=[...this.viewCache][0];e&&(this.date=b.add(this.date,-e.duration,"day"))}next(){const e=[...this.viewCache][0];e&&(this.date=b.add(this.date,e.duration,"day"))}}class tR extends Rs{static get $name(){return"ResourceDayViewAllDayEvents"}static get type(){return"resourcedayviewalldayevents"}get hasOverflow(){return this.up("resourceview").views.some(e=>{var t;return(t=e.allDayEvents)===null||t===void 0?void 0:t.hasOverflow})}createCellMap(){return rv}}class ql extends Ms{static get $name(){return"ResourceDayViewTimeAxis"}static get type(){return"resourcedayviewtimeaxis"}static get configurable(){return{allDayEvents:{type:"resourcedayviewalldayevents"}}}compose(){const e=super.compose();return e["aria-hidden"]=!0,e}scrollToVisibleStartTime(){}createCellMap(){return rv}calculateCellContentHeight(){return 0}getDateFromPosition(e,t,i=!1){const r=this,n=r.startDate,s=i?0:r.dayContentElement.getBoundingClientRect().y,a=r.timeAxisElement.offsetHeight,o=t-s;return b.round(b.add(b.clearTime(n),r.dayStartMs+Math.floor(o/a*r.getDayLength()),"ms"),r.increment)}}tR.initClass();ql.initClass();lc.initClass();lc._$name="ResourceView";class ks extends Ye.mixin(Zn){static get $name(){return"Sidebar"}static get type(){return"sidebar"}static get configurable(){return{focusable:!1,bbar:{cls:"b-cal-nav-item",layout:{justify:"center"},items:{todayButtonSidebar:{text:"L{Calendar.Today}",onClick:"up.shiftToNow",weight:200},prevButtonSidebar:{onClick:"up.shiftPrevious",cls:"b-borderless",icon:"b-icon-previous",weight:300},nextButtonSidebar:{onClick:"up.shiftNext",cls:"b-borderless",icon:"b-icon-next",weight:400}}},items:{datePicker:{type:"datepicker",weight:100,internalListeners:{selectionChange:"up.onMonthSelectionChange"}},eventFilter:{type:"filterfield",field:"name",weight:150,placeholder:"L{Filter events}",localeClass:this},resourceFilter:{ignoreParentReadOnly:!0}},date:{$config:{equal:"date"},value:null},eventStore:null,responsive:{},stepUnitText:null,side:"left",collapsible:{tool:null},resourceFilter:{type:"resourcefilter",flex:"1 1 auto",weight:200,minHeight:110,scrollable:{overflowY:"auto"},store:{sorters:[{field:"name",ascending:!0}]},masterFilter(e){return this.eventStore.resourceStore.isAvailable(e)}}}}setupWidgetConfig(e,t){let i=super.setupWidgetConfig(...arguments);return i.ref==="eventFilter"&&(i.store=this.initialConfig.eventStore),i.ref==="resourceFilter"&&(!i.type||i.type===this.resourceFilter.type)&&(i=ks.mergeConfigs(this.resourceFilter,i)),i.type==="datepicker"&&(this.element.classList.add("b-has-datepicker"),this.element.classList.toggle("b-datepicker-with-events",Boolean(i.events))),i}updateSide(e,t){const{classList:i}=this.element;i.remove(`b-sidebar-${t}`),i.add(`b-sidebar-${e}`),this.collapsible&&(this.collapsible.direction=e)}updateStepUnitText(e){const t=this,{prevButtonSidebar:i,nextButtonSidebar:r}=t.widgetMap;i&&(i.tooltip=e?t.L("L{Calendar.previous}",e):"",i.disabled=!e),r&&(r.tooltip=e?t.L("L{Calendar.next}",e):"",r.disabled=!e)}updateEventStore(e){const{resourceFilter:t,datePicker:i}=this.widgetMap;t&&(t.eventStore=e),i&&(i.eventStore=e)}onMonthSelectionChange({selection:e,userAction:t}){this.UIdateChange=t,this.date=e[0],this.UIdateChange=!1}changeDate(e,t){if(e=typeof e=="string"?b.parse(e):new Date(e),isNaN(e))throw new Error("Calendar widget date ingestion must be passed a Date, or a YYYY-MM-DD date string");if(e=b.clearTime(e),!t||e-t)return e}updateDate(e){const{datePicker:t}=this.widgetMap;t&&(t.value=e),this.trigger("dateChange",{date:e,userAction:Boolean(this.UIdateChange)})}}ks.initClass();ks._$name="Sidebar";class dc extends Ms{static get $name(){return"WeekView"}static get type(){return"weekview"}static get configurable(){return{localizableProperties:["title","stepUnit"],title:"L{Week}",stepUnit:"L{weekUnit}",range:{magnitude:1,unit:"week"},responsive:{small:{descriptionFormat:"MMMM YYYY"},large:{descriptionFormat:["MMMM YYYY (Wp)","S{MMM} - E{MMM YYYY} (S{Wp})"]},"*":{descriptionFormat:["MMMM YYYY","S{MMM} - E{MMM YYYY}"]}},week:null,fixedDuration:!0}}calculateDuration(){return 7}updateWeekStartDay(e,t){var i;if((i=super.updateWeekStartDay)===null||i===void 0||i.call(this,e),!this.isConfiguring){const r=new Date(this.startDate);r.setDate(r.getDate()+e-t),this.startDate=r}}changeMonth(){const e=super.changeMonth(...arguments);return e.ion({weekChange:"onMonthWeekChange",thisObj:this}),e}onMonthWeekChange({source:e,newDate:t}){this.week=e.getWeekNumber(t)}changeWeek(e,t){const i=this;if(e=Array.isArray(e)?e:[i.month.year,e],!T.isEqual(e,t)){var r,n;const s=i.minDate||((r=i.calendar)===null||r===void 0?void 0:r.minDate),a=i.maxDate||((n=i.calendar)===null||n===void 0?void 0:n.maxDate);if(!isNaN(s)||!isNaN(a)){const o=i.month.getWeekStart(e),l=b.add(o,i.duration,"d");if(!isNaN(s)&&o<s||!isNaN(a)&&l>a)return}return e}}updateWeek(e){const t=this,{month:i,date:r,dayTime:n}=t,s=n.shiftDate(i.getWeekStart(e));!r||!T.isEqual(i.getWeekNumber(r),e)?t.date=s:t.startDate=s,t.week=i.getWeekNumber(t.date)}}dc.initClass();dc._$name="WeekView";const iR={hover:1,mouseover:1};class cc extends Ye.mixin(rn,xs,nc){static get $name(){return"YearView"}static get type(){return"yearview"}static get configurable(){return{textContent:!1,localizableProperties:["title","stepUnit"],title:"L{Year}",scrollable:{overflowY:!0},stepUnit:"L{yearUnit}",month:!0,date:{$config:{equal:"date"},value:null},descriptionFormat:"YYYY",year:null,monitorResize:!1,showWeekColumn:!0,hideWeekColumnCls:"b-hide-week-numbers",otherMonthCls:"b-other-month",sixWeeks:!0,dayCellRenderer:null,monthSelector:".b-yearview-month-name",focusable:!1,showEvents:"heatmap",maxDots:4,eventCountTip:null}}createCellMap(e){const t=super.createCellMap(e=F({skipPropagate:!0},e));for(const i of t.values())i.renderedEvents.setEvents(i.events);return t}get date(){return this._date||!this.isConfiguring&&this.firstEventDate||this.startDate}next(){this.date=new Date(this.year+1,this.date.getMonth(),this.date.getDate())}previous(){this.date=new Date(this.year-1,this.date.getMonth(),this.date.getDate())}get firstEventDate(){const e=[...this.cellMap.values()];if(e.length)return e[0].date}get lastEventDate(){const e=[...this.cellMap.values()];if(e.length)return e[e.length-1].date}onCalendarPointerInteraction(e){var t,i;const r=this,n=super.onCalendarPointerInteraction,{target:s,type:a}=e;if((a==="mousedown"||a.endsWith("click"))&&r.clearTimeout(r.cellOverflowTimer),a==="mousedown"&&(t=r._overflowPopup)!==null&&t!==void 0&&t.isVisible&&s.closest(".b-cal-cell-overflow")&&e.preventDefault(),r.overflowPopupTrigger==="click"&&((i=r.autoCreate)===null||i===void 0?void 0:i.gesture)==="dblclick"&&a==="click"&&s.closest(`.${r.emptyCellCls}`)&&!r.emptyCellRenderer)r.cellOverflowTimer=r.setTimeout({fn:n,delay:300,args:[e]});else return n.apply(r,arguments)}changeMonth(e,t){const i=this,r={name:"yearChangeListener",yearChange:"onMonthYearChange",thisObj:i};return i.detachListeners("yearChangeListener"),e instanceof Ot?(e.ion(r),i._year=e.year):e=new Ot({date:new Date(i.year||new Date().getFullYear(),0,1),weekStartDay:i.weekStartDay,hideNonWorkingDays:i.hideNonWorkingDays,nonWorkingDays:i.nonWorkingDays,sixWeeks:i.sixWeeks,listeners:r}),i.nonWorkingDays==null&&(i.nonWorkingDays=i._month.nonWorkingDays),i._year=e.year,e}onMonthYearChange({source:e}){const t=this;t._year=e.year,t.isConfiguring||(t._cellMap&&t._cellMap.clear(),t.date=e.date,t.refresh())}get eventsPerCell(){return 0}get startDate(){return this.month.getOtherMonth(new Date(this.year,0,1)).startDate}get endDate(){return b.add(this.month.getOtherMonth(new Date(this.year,11,1)).endDate,1,"day")}set startDate(e){this.date=e}isValidTargetDate(e){const t=e.getFullYear();if(t!==this.year){var i,r;const n=this.minDate||((i=this.calendar)===null||i===void 0?void 0:i.minDate),s=this.maxDate||((r=this.calendar)===null||r===void 0?void 0:r.maxDate);if(!isNaN(n)||!isNaN(s)){const{cellMonth:a}=this;if(!isNaN(n)&&a.getWeekStart(a.getWeekNumber(new Date(t,0,1)))<n||!isNaN(s)&&(a.date=new Date(t,11,31),b.add(a.endDate,1,"d")>s))return!1}}return!0}updateDate(e){this.month.date=e}changeYear(e){return this.isConfiguring?e:(this.month.year=e,this.month.year)}changeShowEvents(e,t){return e===!0?"heatmap":e}updateShowEvents(e,t){const{classList:i}=this.contentElement;e&&i.add(`b-show-events-${e}`),i.remove(`b-show-events-${t}`),this.isConfiguring||this.doRefresh()}updateShowWeekNumber(){this.bodyElement.classList[this.showWeekColumn?"remove":"add"](this.hideWeekColumnCls)}doRefresh(){var e;const t=this,{bodyElement:i,month:r,dayCellCls:n,otherMonthCls:s,weekendCls:a,todayCls:o,nonWorkingDayCls:l,emptyCellCls:d,cellMap:u,showEvents:h}=t,f=[],g=((e=t.calendar)===null||e===void 0?void 0:e.today)||new Date,m=b.makeKey(g);for(let p=0;p<12;p++){r.month=p;const v={tag:"button",className:"b-yearview-month-name",html:b.getMonthName(p),dataset:{monthDate:b.makeKey(new Date(t.year,p,1))}},y=[{className:"b-week-number-cell"}],C={className:"b-calendar-week b-calendar-weekdays",children:y},D={className:"b-yearview-month",children:[v,C]},w=D.children;f.push(D);let E=0;r.eachWeek((R,x)=>{if(y.length===1)for(let L=0;L<7;L++)y.push({className:{"b-yearview-weekday-cell":1,[l]:t.nonWorkingDays[r.canonicalDayNumbers[L]]},text:b.format(x[L],"d1")});const k={className:"b-calendar-week",dataset:{week:`${R[0]},${R[1]}`}},I=k.children=[{tag:"button",ariaLabel:t.L("L{Calendar.weekOfYear}",R),className:"b-week-number-cell",html:R[1]}];w.push(k);for(let L=0;L<7;L++){const O=x[L],_=O.getMonth()!==r.month,V=b.makeKey(O),Y=O.getDay(),J=!t.isConfiguring&&u.get(V),X=J?.events,q=X?.length||0,oe=!_&&q,xe={style:{},className:{"b-day-name":1,[n]:1,[d]:!q},dataset:{date:V,cellIndex:E,columnIndex:L}};let re=String(O.getDate());if(Object.assign(xe.className,{[a]:b.weekends[Y],[o]:V===m&&!_,[l]:t.nonWorkingDays[Y],[s]:_,"b-cal-cell-overflow":oe,[Yi.getEventCountClass(q)]:oe,[`b-day-of-week-${Y}`]:1}),t.dayCellRenderer){var A;const Se=t.callback(t.dayCellRenderer,t,[{cellConfig:xe,date:O,events:(J==null||(A=J.events)===null||A===void 0?void 0:A.map(ie=>ie.eventRecord))||[]}]);Se!=null&&(re=Se)}if(q&&t.eventCountTip&&!iR[t.overflowPopupTrigger]&&(xe.dataset.btip=t.L("L{ResourceInfoColumn.eventCountText}",q)),h==="dots"){const Se=[];for(let ie=0;ie<Math.min(X?.length||0,t.maxDots);ie++){const le=t.createEventDomConfig({eventRecord:X[ie].eventRecord,minimal:!0});Se.push(le)}re=[typeof re=="object"?re:{tag:"span",html:re},{className:"b-cal-minimal-event-container",children:Se}]}xe.children=[{className:"b-calendar-cell-inner",[typeof re=="string"?"html":"children"]:re}],I.push(xe),E++}})}Z.sync({targetElement:i,domConfig:{children:f}}),t.refreshCount=(t.refreshCount||0)+1,t.trigger("refresh")}getDayElement(e,t){if(typeof e!="string"&&(e=b.makeKey(e)),!(t&&parseInt(e.substr(0,4))!==this.year))return this.contentElement.querySelector(`.b-calendar-cell[data-date="${e}"]:not(.b-other-month)`)}getCell(){return this.getDayElement(...arguments)}onPaint({firstPaint:e}){e&&this.refresh()}}cc.initClass();cc._$name="YearView";const Lf=c=>c.isCalendarMixin;var rR=c=>class extends $p(c||P){static get configurable(){return{navigator:{allowCtrlKey:!0,scrollSilently:!0,datasetIdProperty:"eventId",itemsTabbable:!0,keys:{ArrowUp:null,ArrowDown:null,Escape:null,Tab:null,"SHIFT+Tab":null}}}}normalizeTarget(t){return t.eventRecord}changeNavigator(t){const i=this;return i.getConfig("eventCls"),super.changeNavigator(i.constructor.mergeConfigs({target:i.element,itemSelector:`.b-cal-cell-overflow,.b-cal-cell-no-content,${i.eventSelector}`,skipScrollIntoView:!0},t))}onViewRefresh(){var t,i;if((t=super.onViewRefresh)===null||t===void 0||t.call(this,...arguments),this.navigator.activeItem&&!((i=this.activeView.overflowPopup)!==null&&i!==void 0&&i.containsFocus)){const r=this.getEventRecord(this.navigator.activeItem);r&&this.navigator.updateActiveItem(this.getElementFromEventRecord(r))}}onCalendarStoreChange({action:t,records:i}){var r;const n=this,{navigator:s}=n,a=s?.activeItem;if(a&&!n.eventStore.includes(a.dataset.eventId)){const o=n.constructor.fromElement(a,Lf)||n.activeView,{_overflowPopup:l}=o,d=s.next;if(d===a.nextSibling&&!d.parentNode.syncIdMap)s.triggerNavigate({eventPhase:Event.BUBBLING_PHASE,target:d},d);else{let u=d||s.previous;if(l!=null&&l.containsFocus&&!l.contentElement.contains(u)){const{target:h}=l.lastAlignSpec;u=s.getAdjacent(1,h.nextSibling)||s.getAdjacent(-1,h)}if(!u)n.widgetMap.viewContainer.revertFocus(!0);else{const h=o.getDateFromElement(u),f=u.dataset.eventId,g=n.constructor.fromElement(u).closest(Lf);u.focus(),g.ion({refresh:()=>{u=g.getEventElement(f,h),u&&(u===S.getActiveElement(u)?s.triggerNavigate({eventPhase:Event.BUBBLING_PHASE,target:u},u):u.focus()),s.updateActiveItem(u,a)},once:!0})}}}(r=super.onCalendarStoreChange)===null||r===void 0||r.call(this,...arguments)}onElementKeyDown(t){if(t.target.closest(this.navigator.itemSelector)){var i;(i=super.onElementKeyDown)===null||i===void 0||i.call(this,t)}}get activeEvent(){const{activeItem:t}=this.navigator;if(t)return this.resolveEventRecord(t)}get widgetClass(){}},nR=c=>class extends Pp(c||P){normalizeTarget(t){return t.eventRecord}onSelectedCollectionChange({added:t,removed:i}){const r=this,n=r.selectedCollection,s=t||[],a=i||[];if(r.updateSelected(),!r.silent){const o=n.count>0?s.length>0&&a.length>0?"update":s.length>0?"select":"deselect":"clear";r.trigger("selectionChange",{action:o,selection:n.values,selected:s,deselected:a})}}onCalendarStoreChange({action:t,records:i}){var r;t==="remove"&&this.selectedCollection.remove(...i),(r=super.onCalendarStoreChange)===null||r===void 0||r.call(this,...arguments)}clearEventSelection(){this.selectedCollection.clear()}get selectedEvents(){return this.selectedCollection.values}set selectedEvents(t){t=W.asArray(t),this.selectedCollection.splice(0,this.selectedCollection.count,t)}isEventSelected(t){return this.selectedCollection.includes(t)}select(t,i=!1){this.selectEvent(t,i)}selectEvent(t,i=!1){const{selectedCollection:r}=this;!this.isEventSelected(t)&&this.isEventSelectable(t)!==!1&&(i?r.add(t):r.splice(0,r.count,t))}deselect(t){this.deselectEvent(t)}deselectEvent(t){this.isEventSelected(t)&&this.selectedCollection.remove(t)}selectEvents(t){this.selectedCollection.add(t.filter(i=>this.isEventSelectable(i)!==!1))}deselectEvents(t){this.selectedCollection.remove(t)}onEventSelectionClick(t){this.isEventSelected(t)?ue.ctrlKeyDown&&this.deselectEvent(t):this.selectEvent(t,this.multiEventSelect&&ue.ctrlKeyDown)}onEventNavigate({event:t,item:i}){if(i){const r=this.activeView.getEventRecord(i);if(r){if(t.button===2&&this.isEventSelected(r))return;this.onEventSelectionClick(r)}else this.clearEventSelection()}}get widgetClass(){}};const sR=(c,e)=>(c.weight||0)-(e.weight||0),aR=/(?:.)cell|number|name|overflow|mouse|down|up|dbl|click|over|out|context|menu|date|change|element|popup/g,oR=/^.*event.*|.*resource.*|.*cell.*|.*row.*|.*schedule.*|daynumber.*|weeknumber.*|monthname.*|weekname.*$|beforedatechange|tickchange|.*showoverflowpopup/,lR=c=>z.capitalize(c),dR=c=>c.isCalendarMixin&&c.containsFocus;class sr extends Ye.mixin(Qp,Jp,zg,Gm,rR,nR,Lp,Zn,ka,Ip){static get $name(){return"Calendar"}static get type(){return"calendar"}static get configurable(){return{enableRecurringEvents:!0,localizableProperties:["autoCreate.newName"],crudManager:null,features:{drag:{},eventEdit:{},eventTooltip:{},eventMenu:{}},navigatorPlacement:null,responsive:{small:{when:600,once:{mode:"day"}},medium:{when:800},large:{overlaySidebar:!1},"*":{overlaySidebar:!0,once:{mode:"week"}}},responsiveRoot:!0,stateful:["hideNonWorkingDays","mode"],tbar:{cls:"b-calendar-toolbar",items:{toggleSideBar:{icon:"b-icon-menu-vertical",cls:"b-sidebar-toggle b-borderless b-transparent",onClick:"up.onToggleSidebarClick",weight:100},todayButton:{text:"L{Calendar.Today}",cls:"b-cal-nav-item b-calendar-today-button",icon:"b-icon-calendar-day",onClick:"up.shiftToNow",weight:200},prevButton:{onClick:"up.shiftPrevious",cls:"b-cal-nav-item b-borderless b-transparent",icon:"b-icon-previous",weight:300},nextButton:{onClick:"up.shiftNext",cls:"b-cal-nav-item b-borderless b-transparent",icon:"b-icon-next",weight:400},viewDescription:{cls:"b-calendar-view-desc",type:"widget",flex:"",html:"\xA0",overflowable:"none",weight:500},spacer:{type:"widget",cls:"b-toolbar-fill",weight:600},modeSelector:{type:"calendarModeSelector",weight:700}}},items:{viewContainer:{type:"container",cls:"b-calendar-viewcontainer",flex:"1 1 100%",layout:{type:"card"},scrollable:{overflowY:!0,overflowX:!0},suppressChildHeaders:!0,layoutStyle:{padding:0},internalListeners:{beforeActiveItemChange:"up.onBeforeModeChange",activeItemChange:"up.onModeChange"}}},includeWeekendsButton:!1,layoutStyle:{padding:0,flexFlow:"row nowrap"},modes:{day:{fixedDuration:!0},week:{},month:{},year:{},agenda:{}},mode:"week",modeDefaults:{value:null},sidebar:{$config:{merge:"objects"},value:{type:"sidebar",side:"left",scrollable:{overflowY:!0},internalListeners:{dateChange:"up.onCalendarDateChange"}}},datePicker:{$config:{merge:"objects"},value:{weight:100,dayNameFormat:"d1",editMonth:null,focusable:!1,trapFocus:!1}},overlaySidebar:null,date:{$config:{equal:"date"},value:new Date},dateFormat:"MMMM DD, YYYY",scrollManager:{$config:["lazy","nullify"],value:{direction:"vertical"}},viewUpdateDelay:2e3,readOnly:null,allowOverlap:!0,testConfig:{viewUpdateDelay:5,loadMask:{text:"L{GridBase.loadMask}",showDelay:0}},highlightDate:null,autoCreate:{gesture:"dblclick",newName:"L{Object.newEvent}",step:"15 minutes",duration:"1 hour",startHour:8},focusable:!1,eventCls:"b-cal-event",weekStartDay:!1,hideNonWorkingDays:null,nonWorkingDays:!1,coreHours:null,contextMenuTriggerEvent:"contextmenu",enableUndoRedoKeys:!0,resourceImagePath:null,minDate:null,maxDate:null}}static get delayable(){return{refresh:{type:"raf",cancelOutstanding:!0},syncUIWithActiveView:{type:"buffer",delay:1,cancelOutstanding:!0}}}compose(){const{includeWeekendsButton:e,navigatorPlacement:t}=this;return{class:{[`b-calendar-nav-${t||"toolbar"}`]:1,"b-calendar-include-weekends-button":e}}}onPaintOverride(){}onPaint(){this.onPaintOverride()||super.onPaint()}onShowOverflowPopup({overflowPopup:e}){this.element.classList.add("b-overflow-popup-visible"),e.ion({hide:()=>this.element.classList.remove("b-overflow-popup-visible"),once:!0})}static get featureable(){return{factory:dt}}get dateTimeNow(){return this.timeZone!=null?Xe.toTimeZone(new Date,this.timeZone):new Date}get today(){const e=this.dateTimeNow;return e.setHours(0,0,0,0),e}finalizeInit(){var e;super.finalizeInit();const t=this,i=(e=t.activeView)===null||e===void 0?void 0:e.hideNonWorkingDays;i!=null&&t.hideNonWorkingDays==null&&(t.hideNonWorkingDays=i)}toggleEmptyText(){const{crudManager:e}=this,{eventStore:t}=e||this;S.toggleClasses(this.contentElement,"b-calendar-empty",!(t.count||e!=null&&e.isLoading))}refresh(){this.eachView(e=>{var t;return(t=e.refresh)===null||t===void 0?void 0:t.call(e)})}get views(){const{modes:e}=this;return e?Object.values(e):[]}get activeView(){return this.viewContainer.layout.activeItem}get activeSubView(){var e;const{activeView:t}=this,{items:i}=t;return((e=i.filter(dR))===null||e===void 0?void 0:e[0])||t}captureFocus(){return this.activeView.captureFocus()}getEventRecord(e){return this.activeView.getEventRecord(e)}resolveEventRecord(e){return this.getEventRecord(e)}onBeforeModeChange({prevActiveItem:e,activeItem:t}){var i,r;if(this.trigger("beforeActiveItemChange",arguments[0])===!1)return!1;if((i=e._overflowPopup)===null||i===void 0||(r=i.hide)===null||r===void 0||r.call(i),"date"in t&&t.syncViewDate!==!1){const n=this.date||e.date;n&&(t.date=n)}}onModeChange(e){this.trigger("activeItemChange",e)}onToggleSidebarClick(){const{sidebar:e}=this,{collapsible:t}=e;t!=null&&t.isPanelCollapserOverlay?t.toggleReveal(!e.revealed):e.toggleCollapsed()}shiftToNow(){var e;const t=this,i=(e=t.sidebar)===null||e===void 0?void 0:e.widgetMap.datePicker,{dayTime:r}=t.activeView,n=new Date,s=r?r.startOfDay(n):b.clearTime(n);t.date=s,i&&(i.date=s),t.updateViewDescription()}shiftPrevious(){const{activeItem:e}=this.viewContainer.layout;e!=null&&e.previous&&(e.previous(),this.updateViewDescription(e),e.animateTimeShift&&S.slideIn(e.contentElement,-1))}shiftNext(){const{activeItem:e}=this.viewContainer.layout;e!=null&&e.next&&(e.next(),this.updateViewDescription(e),e.animateTimeShift&&S.slideIn(e.contentElement,1))}async onCalendarDateChange({date:e,userAction:t}){const i=this,{activeItem:r}=i.viewContainer.layout,{date:n,highlightDate:s}=i;if(r&&r.syncViewDate!==!1&&"date"in r){const{getDayElement:d}=r;if(!b.betweenLesser(e,r.startDate,r.endDate)){var a,o;(a=r._overflowPopup)===null||a===void 0||(o=a.hide)===null||o===void 0||o.call(a)}if(r.date=e,t&&s&&d){var l;r.scrollTo&&(await r.scrollTo(e),r.scrolledToDate&&(e=r.scrolledToDate));const u=(l=r.getDayElement)===null||l===void 0?void 0:l.call(r,e);u&&(isNaN(s)?i.callback(s,i,[u,i]):S.highlight($.from(u)))}}i.trigger("dateChange",{oldDate:n,date:e})}updateViewDescription(e=this.activeView){const t=this,{tbar:i,widgetMap:r}=t,{viewDescription:n}=r,s=`<span class="b-calendar-view-desc-text">${e?.description||""}</span>`;if(t.element.dataset.mode=t.activeView.modeName,e){i&&n&&n.content!==s&&(n.content=s);const a=e.date||e.startDate;a&&(this.date=a)}}getStepUnitText(e=this.activeView){return e.stepUnit}syncUIWithActiveView(e=this.activeView){const t=this,{tbar:i,sidebar:r,widgetMap:n}=t,{toggleSideBar:s}=n;if(i&&e!==null&&e!==void 0&&e.isVisible){const{prevButton:a,nextButton:o,modeSelector:l}=n,d=t.getStepUnitText(e);l?.syncActiveMode(e),r&&(r.stepUnitText=d),t.updateViewDescription(e),a&&(a.tooltip=d?t.L("L{previous}",d):"",a.disabled=!d),o&&(o.tooltip=d?t.L("L{next}",d):"",o.disabled=!d)}r||s?.hide()}updateEventStore(e){this.detachListeners("eventStoreDateRange"),this.features.loadOnDemand,this.processConfiguredListeners(),e.ion({loadDateRange:"onEventStoreDateRangeRequested",name:"eventStoreDateRange",thisObj:this}),this.sidebar&&(this.sidebar.eventStore=e)}eachView(e,t,i=null){const r=t==null;for(const n of this.views)if(r&&(t=[n]),n.callback(e,i||n,t)===!1)return}onEventStoreDateRangeRequested(e){e.changed&&this.trigger("dateRangeChange",e),this.trigger("dateRangeRequested",e)}async onModeSelectorToggle({source:e,pressed:t}){if(t){const i=this,{layout:r}=i.viewContainer,{view:n}=e;await i.modeSelectionPromise,i.modeSelectionPromise=r.setActiveItem(n).promise}}updateMode(e){const t=this,i=t.initialConfig||{};t.isConfiguring||t._responsiveUpdating&&("mode"in i||"activeIndex"in i)||(e=typeof e=="string"?t.modes[e]:e,e&&e!==t.activeView&&t.viewContainer.layout.setActiveItem(e,void 0,{animation:!t.isResponsiveUpdating}))}onEventStoreRefresh(){this.isConfiguring||this.syncUIWithActiveView(this.viewContainer.layout.activeItem)}handleViewPaint({source:e}){this.syncUIWithActiveView(e),this._mode=e.modeName,this.trigger("viewPaint",F({},arguments[0]))}onViewRefresh({source:e}){var t;(t=super.onViewRefresh)===null||t===void 0||t.call(this,...arguments),e.isVisible&&(e===this.activeView?this.updateViewDescription(e):this.activeView.owns(e)&&this.syncUIWithActiveView(this.activeView))}updateEventCls(e){this.initialConfig.eventInnerSelector||(this.eventInnerSelector=`.${e}`),this.initialConfig.eventSelector||(this.eventSelector=`${this.eventInnerSelector}-wrap`)}changeModes(e,t){const i=this,{mode:r}=i;if(i.getConfig("crudManager"),i.getConfig("defaultCalendar"),r&&r in e){const d=[];let u=null,h=0,f;for(const g in e)if(f=e[g],f){var n;typeof f=="object"&&"weight"in f?u=null:f&&g===r&&(u=h),d.push(T.assign({modeType:g,weight:(n=f.weight)!==null&&n!==void 0?n:0},f)),h++}else d.push(!1);if(u==null){e={},d.sort(sR);for(let g=0,{length:m}=d;g<m;g++)f=d[g],e[f.modeType]=f,d[g].modeType===r&&(u=g)}i.activeModeIndex=u}const{tbar:s,element:a}=i,o={thisObj:i,descriptionChange:"onViewDescriptionChange",weekNumberClick:"onViewWeekNumberClick",monthNameClick:"onViewMonthNameClick",dayNumberClick:"onViewDayNumberClick",beforeEventAdd:"onViewBeforeEventAdd",catchAll:{fn:"onViewCatchAll",prio:1e4},paint:"handleViewPaint",refresh:"onViewRefresh"},l=i.$modes||(i.$modes=new Ki({factory:qt,inferType:!0,owner:i,ownerName:"calendar",created(d,u){var h;if(d.modeName=u,d.isScheduler){const{eventEdit:g}=i.features;g&&(g.applyPluginConfig(d),d.editEvent=i.editEvent.bind(i))}d.autoCreate!==!1&&(d.autoCreate=i.autoCreate),a.classList.add(`b-cal-${u}`),d.ion(o),i.relayEvents(d,["eventPropagate"]),i.isConfiguring||i.trigger("addMode",{mode:d});const f=s==null||(h=s.widgetMap)===null||h===void 0?void 0:h.modeSelector;f&&(f.calendar=i,f.addMode(u,d))},setup(d){const{defaultCalendar:u,hideNonWorkingDays:h,modeDefaults:f}=i,g=qt.resolveType(d.type);if(f&&(d=T.merge({},f,d)),g.isScheduler){const m=d.features||(d.features={});m.eventTooltip=m.eventMenu=m.eventEdit=m.scheduleMenu=!1}else d.eventSelector=i.eventSelector,d.eventInnerSelector=i.eventInnerSelector;return d.rtl=i.rtl,d.project=i.project,d.readOnly=i.readOnly,d.allowOverlap=i.allowOverlap,d.hidden=!0,d.weekStartDay=i.weekStartDay,d.nonWorkingDays=i.nonWorkingDays,d.timeZone=i.timeZone,i.coreHours&&(d.coreHours=i.coreHours),i.resourceImagePath&&(d.resourceImagePath=i.resourceImagePath),T.hasOwn(i,"_defaultCalendar")?d.defaultCalendar=i._defaultCalendar:u!=null&&(d.defaultCalendar=u),h!=null&&(d.hideNonWorkingDays=h),i.date&&!d.date&&(d.date=i.date),d.dateFormat||(d.dateFormat=i.dateFormat),i.visibleStartTime&&(d.visibleStartTime=i.visibleStartTime),d}}));if(l.update(e),!t)return l.target}changeModeDefaults(e){const t=this;return new Proxy(T.assign({},e),{set(r,n,s){const a=Reflect.set(...arguments);return t.updateModeDefaults({[n]:s}),a},deleteProperty(r,n){const s=Reflect.deleteProperty(...arguments);return t.updateModeDefaults({[n]:null}),s}})}updateModeDefaults(e){this.isConfiguring||this.eachView(t=>t.setConfig(e))}get collapsibleConfig(){const e=this.peekConfig("overlaySidebar"),t={type:e?"overlay":"inline",tool:null};return e&&(t.recollapseTool=null),t}updateOverlaySidebar(e){const{sidebar:t,collapsibleConfig:i}=this,r=t?.collapsible;r&&(r.type!==i.type&&(t.collapsible=i),e?t.collapsed||(t.collapsed=!0,t.collapsedDueToOverlay=!0):(t.collapsedDueToOverlay||t.isVisible&&r.isPanelCollapserOverlay)&&(t.collapsed=!1,t.collapsedDueToOverlay=!1))}changeSidebar(e,t){const i=this,{datePicker:r,statefulId:n}=i;if(e){const s=e.items||(e.items={}),a=s.datePicker;r?a!==null&&a!==!1&&(s.datePicker=sr.mergeConfigs(s.datePicker,r)):s.datePicker=null}return ks.reconfigure(t,e,{owner:i,setup:(s,a)=>i.setupWidgetConfig(s,a),defaults:{stateId:n&&`${n}:sidebar`,eventStore:i.eventStore,date:i.date,weight:e?.side==="right"?10:-10,collapsible:i.collapsibleConfig,items:{datePicker:{weekStartDay:i.weekStartDay}}}})}changeDatePicker(e){if(e)return Object.assign(e,{eventStore:this.eventStore,date:this.date})}get datePicker(){return this.isConfiguring?this._datePicker:this.sidebar.widgetMap.datePicker}changeItems(e){const{modes:t,sidebar:i}=this,{viewContainer:r}=e;i&&(e.sidebar=i),r&&(r.items=t),this.activeModeIndex&&(r.layout.activeIndex=this.activeModeIndex);const n=super.changeItems(e);return this.viewContainer=this.widgetMap.viewContainer,n}onViewCatchAll(e){const t=this,{fromOverflowPopup:i,type:r,source:n}=e;if(e.bubbles)return;let s,a,{domEvent:o}=e;if(!o&&S.isDOMEvent(e.event)&&(o=e.event),t.eventSource=n,!o||t.handleEvent(o)!==!1){var l;const d=r.startsWith("emptycell");if(r.endsWith("click")&&t.activeView.isCalendarMixin&&(a=e.date||((l=n.getDateFromDomEvent)===null||l===void 0?void 0:l.call(n,o)))){const u=i||r==="celloverflowclick"||o.target.closest(".b-cal-cell-overflow"),h=n.getDayElement&&!n.getDayElement(a,!0);!(i&&h)&&!d&&(r==="daynumberclick"||!(h&&(u||r.startsWith("event")||r.startsWith("schedule"))))&&(t.date=a)}(d||oR.test(r))&&(s=t.trigger(r.replaceAll(aR,lR),F(F({},e),{},{view:n})))}return t.eventSource=null,s}onViewDescriptionChange(){this.updateViewDescription()}onViewWeekNumberClick({week:e}){const t=this.modes.week||this.viewContainer.query(i=>{var r;return((r=i.view)===null||r===void 0?void 0:r.type.toLowerCase())==="weekview"});t&&(t.week=e,this.viewContainer.layout.activeItem=t)}onViewMonthNameClick({date:e}){const t=this.modes.month||this.viewContainer.query(i=>{var r;return((r=i.view)===null||r===void 0?void 0:r.type.toLowerCase())==="monthview"});t&&(t.date=e,this.viewContainer.layout.activeItem=t)}onViewDayNumberClick({source:e,date:t,cellData:i,fromOverflowPopup:r,domEvent:n}){var s;const a=e.isYearView&&(e.overflowPopupTrigger!=="click"||r||!((s=i.events)!==null&&s!==void 0&&s.length)&&!e.emptyCellRenderer);if(e.isCalendarRow||e.isMonthView||a||e.isAgendaView){const{viewContainer:o}=this,l=this.modes.day||o.query(d=>{var u;return((u=d.view)===null||u===void 0?void 0:u.type.toLowerCase())==="dayview"});if(l&&e!==l.allDayEvents){const{layout:d}=o,{activeItem:u}=d,{syncViewDate:h}=u;return u.syncViewDate=!1,this.date=t,o.layout.activeItem=l,u.syncViewDate=h,!1}}}onViewBeforeEventAdd({eventRecord:e,assignmentRecords:t}){const{eventEdit:i}=this.features,r=i&&!i.disabled;e.isCreating=r,t?.forEach(n=>n.isCreating=r)}createEvent(e=this.date){this.doCreateEvent(e)}doCreateEvent(e,t=this.activeView){const{modes:i}=this,r=t.isYearView&&(i.week||i.month||i.day)||t;if(this.activeView.owns(r))t.doCreateEvent(e);else{const{viewContainer:n}=this.widgetMap,{layout:s}=n;if(r)return n.ion({activeItemChange:"doCreateEvent",thisObj:t,once:!0,args:[e,r]}),r.date=e,s.activeItem=r,!1}}changeDate(e,t){if(e=typeof e=="string"?b.parse(e):new Date(e),isNaN(e))throw new Error("Calendar widget date ingestion must be passed a Date, or a YYYY-MM-DD date string");if(e=b.clearTime(e),!t||e-t)return e}updateAutoCreate(){this.isConfiguring||this.syncCommonConfig("autoCreate")}updateDate(e,t){if(!this.isConfiguring){const{sidebar:i}=this;i?i.date=e:this.onCalendarDateChange({date:e})}}updateDateFormat(){this.isConfiguring||this.syncCommonConfig("dateFormat")}changeIncludeWeekendsButton(e){return e===!0?{}:e}updateIncludeWeekendsButton(e){!this.isConstructing&&e&&T.isObject(e)&&(this.widgetMap.modeSelector.includeWeekendsButton=e)}changeScrollManager(e,t){if(t?.destroy(),!this.isDestroying)return new Pa(Object.assign({element:this.element},e))}updateDefaultCalendar(){this.isConfiguring||this.syncCommonConfig("defaultCalendar")}changeWeekStartDay(e){return e===!1&&(e=b.weekStartDay),e}updateReadOnly(){super.updateReadOnly(...arguments),this.isConfiguring||this.syncCommonConfig("readOnly")}updateWeekStartDay(e){if(!this.isConfiguring){var t;this.syncCommonConfig("weekStartDay"),(t=this.sidebar)!==null&&t!==void 0&&t.widgetMap.datePicker&&(this.sidebar.widgetMap.datePicker.weekStartDay=e)}}updateHideNonWorkingDays(e,t){this.isConfiguring||(this.syncCommonConfig("hideNonWorkingDays"),this.trigger("changeHideNonWorkingDays",{value:e,was:t}))}changeNonWorkingDays(e){return e===!1&&(e=T.assign({},b.nonWorkingDays)),e}updateNonWorkingDays(){this.isConfiguring||this.syncCommonConfig("nonWorkingDays")}updateCoreHours(){this.isConfiguring||this.syncCommonConfig("coreHours")}syncCommonConfig(e){this.eachView(t=>{t[e]=this[e]})}onCalendarStoreChange(){var e;(e=super.onCalendarStoreChange)===null||e===void 0||e.call(this,...arguments)}updateSelected(){const e=this.viewContainer.contentElement.querySelectorAll(".b-cal-event-wrap");for(let t=0,{length:i}=e;t<i;t++)e[t].classList[this.isEventSelected(e[t].dataset.eventId)?"add":"remove"]("b-selected")}getElementFromEventRecord(e){return this.activeView.getEventElement(e)}updateLocalization(){const e=this;if(e.isPainted){let t=!1;!("weekStartDay"in e.initialConfig)&&e.weekStartDay!==b.weekStartDay&&(e.weekStartDay=b.weekStartDay,t=!0),!("nonWorkingDays"in e.initialConfig)&&!T.isEqual(e.nonWorkingDays,b.nonWorkingDays)&&(e.nonWorkingDays=b.nonWorkingDays,t=!0),t||e.refresh(),e.syncUIWithActiveView()}super.updateLocalization()}}sr.initClass();globalThis.bryntum&&(globalThis.bryntum.Calendar=sr);class qt extends P.mixin(ai){static get factoryable(){return{extends:N}}}qt.register("agenda",ac);qt.register("year",cc);qt.register("month",oc);qt.register("week",dc);qt.register("day",Ms);qt.register("list",Do);qt.register("resource",lc);sr.Modes=qt;ae.setVersion("calendar","5.3.0");sr._$name="Calendar";function nv(){function c(l,d){window.bryntum&&window.bryntum.isTestEnv&&console.warn(`Bryntum${l}Component development warning!
${d}
Please check Vue integration guide: https://bryntum.com/products/calendar/docs/guide/Calendar/integration/vue/guide`)}function e(l,d){c(l,`Using "${d}" parameter for configuration is not recommended.
Widget is placed automatically inside it's container element.
Solution: remove "${d}" parameter from configuration.`)}function t(l,d){c(l,`Using "${d}" parameter for configuration is not recommended.
Solution: Use separate parameter for each "${d}" value to enable reactive updates of the API instance`)}function i(l,d){c(l,`"${d}" is a static config option for component constructor only. No runtime changes are supported!`)}function r({me:l,props:d,listeners:u,data:h,emit:f,element:g,processCellContent:m,hasFrameworkRenderer:p}){const{instanceClass:v,instanceName:y}=h,C=A=>A.filter(L=>d[L]!==void 0),D=C(h.configNames||[]),w=C(h.propertyConfigNames||[]),E=C(h.propertyNames||[]),R=C(h.featureNames||[]),x=h.eventNames.filter(A=>u[A]!==void 0||u[A.toLowerCase()]!==void 0),k={vueComponent:v.isModel?void 0:l,listeners:{},features:{},processCellContent:m,hasFrameworkRenderer:p};x.forEach(A=>{const L=`on${z.capitalize(A)}`;d[L]||(k.listeners[A]=O=>f(A.toLowerCase(),O))}),D.concat(w).concat(R).forEach(A=>{a(k,A,d[A]),["features","config"].includes(A)&&t(v.$name,A)}),k.cls=(k.cls||"")+` b-vue-${v.$name.toLowerCase()}-container`,h.configNames=D,h.propertyNames=D.concat(E).concat(w).concat(R),h.eventNames&&delete h.eventNames,h.propertyConfigNames&&delete h.propertyConfigNames,h.featureNames&&delete h.featureNames;const I=["adopt","appendTo","insertAfter","insertBefore"].find(A=>k[A]);return I?e(v.$name,I):y==="Button"?k.appendTo=g:k.adopt=g,k}function n(l,d){const{dataStores:u,projectStores:h}=l;u&&(Object.keys(u).forEach(f=>{const g=h?d.project[f]:d[f];g&&(g.syncDataOnLoad=g.syncDataOnLoad==null?!0:g.syncDataOnLoad,d&&d.relayStoreEvents&&g.relayAll(d,u[f]))}),delete l.dataStores)}function s(l){const{instanceClass:d}=l.data,u=r(l);return d.$name==="Widget"?Zi.createWidget(u):new d(u)}function a(l,d,u,h=!0){if(d==="project")u&&typeof u=="object"&&(l[d]=u.instance?u.instance.value||u.instance:u);else if(d==="features"&&typeof u=="object")Object.keys(u).forEach(f=>a(l,`${f}Feature`,u[f],h));else if(d==="config"&&typeof u=="object")Object.keys(u).forEach(f=>a(l,f,u[f],h));else if(d==="columns"&&!h)l.columns.data=u;else if(d.endsWith("Feature")){const f=l.features,g=d.replace("Feature","");if(h)f[g]=u;else{const m=f[g];m&&m.setConfig(u)}}else l[d]=u}function o(l,d,u,h,f){const{configNames:g,propertyNames:m,instanceClass:p}=h;m.forEach(v=>f(v,y=>{const C=Array.isArray(y)?y.slice():y;a(d,v,C,!1),g.includes(v)&&i(p.$name,v)})),delete h.configNames,delete h.propertyNames}return{createWidget:s,relayStores:n,watchProps:o}}function cR(){function c({rendererData:t,rendererData:{record:i},rendererData:{cellElement:r},rendererData:{column:n},rendererHtml:s}){const{vueComponent:a}=this,{refs:o,refs:{teleportsHolder:l}}=a,{teleports:{value:d}}=a.provides,u=`${n.id}-${i.id}`,h=n.tree?r.querySelector(".b-tree-cell-value"):r;if(n.data.vue){const f=h.querySelector("[data-vue]");f&&l.appendChild(f);let g=o[u];g=Array.isArray(g)?g[0]:g,g&&g.$el.dataset.generation!==String(i.generation)&&(d.delete(u),g=null),g?h.appendChild(g.$el):sv(()=>{const m={...s},{is:p}=m;delete m.is,d.set(u,{bind:m,key:u,is:p,to:h,generation:i.generation})})}}function e({cellContent:t,column:i}){return t&&typeof t=="object"&&i.data.vue}return{processCellContent:c,hasFrameworkRenderer:e}}const uR={name:"BryntumFullscreenButton",setup(){const c=gt(null),e=gt(null);return Ma(()=>{const t=c.value=mt.enabled?Zi.createWidget({type:"button",appendTo:e.value,icon:"b-icon b-icon-fullscreen",tooltip:"Fullscreen",toggleable:!0,onToggle:({pressed:i})=>{i?mt.request(document.documentElement):mt.exit()}}):null;t&&mt.onFullscreenChange(()=>{t.pressed=mt.isFullscreen})}),Kl(()=>{c.value&&(mt.onFullscreenChange(null),c.value.destroy())}),{refElement:e,instance:c}}},hR={ref:"refElement"};function fR(c,e,t,i,r,n){return yi(),Er("div",hR,null,512)}const gR=Ta(uR,[["render",fR]]),mR={name:"BryntumButton",props:{adopt:{type:[HTMLElement,String],default:void 0},align:{type:[Object,String],default:void 0},anchor:{type:Boolean,default:void 0},ariaDescription:{type:String,default:void 0},ariaLabel:{type:String,default:void 0},bubbleEvents:{type:Object,default:void 0},callOnFunctions:{type:Boolean,default:void 0},centered:{type:Boolean,default:void 0},config:{type:Object,default:void 0},constrainTo:{type:[HTMLElement,N,$],default:void 0},contentElementCls:{type:[String,Object],default:void 0},defaultBindProperty:{type:String,default:void 0},dock:{type:[String,Object],default:void 0},draggable:{type:[Boolean,Object],default:void 0},floating:{type:Boolean,default:void 0},hideAnimation:{type:[Boolean,Object],default:void 0},htmlCls:{type:[String,Object],default:void 0},ignoreParentReadOnly:{type:Boolean,default:void 0},listeners:{type:Object,default:void 0},localeClass:{type:Function,default:void 0},localizable:{type:Boolean,default:void 0},localizableProperties:{type:Array,default:void 0},maskDefaults:{type:Object,default:void 0},masked:{type:[Boolean,String,Object],default:void 0},monitorResize:{type:Boolean,default:void 0},owner:{type:N,default:void 0},positioned:{type:Boolean,default:void 0},preventTooltipOnTouch:{type:Boolean,default:void 0},relayStoreEvents:{type:Boolean,default:void 0},ripple:{type:[Boolean,Object],default:void 0},rootElement:{type:ShadowRoot,default:void 0},scrollAction:{type:[String,null],default:void 0},showAnimation:{type:[Boolean,Object],default:void 0},showTooltipWhenDisabled:{type:Boolean,default:void 0},tab:{type:[Boolean,Object],default:void 0},tag:{type:String,default:void 0},textAlign:{type:String,default:void 0},title:{type:String,default:void 0},ui:{type:[String,Object],default:void 0},weight:{type:Number,default:void 0},alignSelf:{type:String,default:void 0},appendTo:{type:[HTMLElement,String],default:void 0},badge:{type:String,default:void 0},cls:{type:[String,Object],default:void 0},color:{type:String,default:void 0},content:{type:String,default:void 0},dataset:{type:Object,default:void 0},disabled:{type:Boolean,default:void 0},extraData:{type:[String,Number,Boolean,Object],default:void 0},flex:{type:[Number,String],default:void 0},height:{type:[Number,String],default:void 0},hidden:{type:Boolean,default:void 0},href:{type:String,default:void 0},html:{type:[String,Function],default:void 0},icon:{type:String,default:void 0},iconAlign:{type:String,default:void 0},id:{type:String,default:void 0},insertBefore:{type:[HTMLElement,String],default:void 0},insertFirst:{type:[HTMLElement,String],default:void 0},margin:{type:[Number,String],default:void 0},maxHeight:{type:[String,Number],default:void 0},maxWidth:{type:[String,Number],default:void 0},menu:{type:[N,Object],default:void 0},menuIcon:{type:String,default:void 0},minHeight:{type:[String,Number],default:void 0},minWidth:{type:[String,Number],default:void 0},pressed:{type:Boolean,default:void 0},pressedIcon:{type:String,default:void 0},readOnly:{type:Boolean,default:void 0},scrollable:{type:[Ke,Boolean,Object],default:void 0},target:{type:String,default:void 0},text:{type:String,default:void 0},toggleable:{type:Boolean,default:void 0},toggleGroup:{type:String,default:void 0},tooltip:{type:[String,Object],default:void 0},width:{type:[Number,String],default:void 0},x:{type:Number,default:void 0},y:{type:Number,default:void 0},anchorSize:{type:Array,default:void 0},type:{type:String,default:void 0},onAction:{type:Function,default:void 0},onBeforeDestroy:{type:Function,default:void 0},onBeforeHide:{type:Function,default:void 0},onBeforeShow:{type:Function,default:void 0},onBeforeShowMenu:{type:Function,default:void 0},onBeforeToggle:{type:Function,default:void 0},onCatchAll:{type:Function,default:void 0},onClick:{type:Function,default:void 0},onDestroy:{type:Function,default:void 0},onFocusIn:{type:Function,default:void 0},onFocusOut:{type:Function,default:void 0},onHide:{type:Function,default:void 0},onPaint:{type:Function,default:void 0},onReadOnly:{type:Function,default:void 0},onRecompose:{type:Function,default:void 0},onResize:{type:Function,default:void 0},onShow:{type:Function,default:void 0},onToggle:{type:Function,default:void 0}},emits:["action","beforedestroy","beforehide","beforeshow","beforeshowmenu","beforetoggle","catchall","click","destroy","focusin","focusout","hide","paint","recompose","resize","show","toggle"],data:()=>({instanceClass:Ft,instanceName:"Button",configNames:["adopt","align","anchor","ariaDescription","ariaLabel","bubbleEvents","callOnFunctions","centered","config","constrainTo","contentElementCls","defaultBindProperty","dock","draggable","floating","hideAnimation","htmlCls","ignoreParentReadOnly","listeners","localeClass","localizable","localizableProperties","maskDefaults","masked","monitorResize","owner","positioned","preventTooltipOnTouch","relayStoreEvents","ripple","rootElement","scrollAction","showAnimation","showTooltipWhenDisabled","tab","tag","textAlign","title","ui","weight"],propertyConfigNames:["alignSelf","appendTo","badge","cls","color","content","dataset","disabled","extraData","flex","height","hidden","href","html","icon","iconAlign","id","insertBefore","insertFirst","margin","maxHeight","maxWidth","menu","menuIcon","minHeight","minWidth","onAction","onBeforeDestroy","onBeforeHide","onBeforeShow","onBeforeShowMenu","onBeforeToggle","onCatchAll","onClick","onDestroy","onFocusIn","onFocusOut","onHide","onPaint","onReadOnly","onRecompose","onResize","onShow","onToggle","pressed","pressedIcon","readOnly","scrollable","target","text","toggleable","toggleGroup","tooltip","width","x","y"],propertyNames:["anchorSize","type"],eventNames:["action","beforeDestroy","beforeHide","beforeShow","beforeShowMenu","beforeToggle","catchAll","click","destroy","focusIn","focusOut","hide","paint","recompose","resize","show","toggle"]}),setup(c,{emit:e}){const t={},i=gt(null),r=gt(new Map),{createWidget:n,relayStores:s,watchProps:a}=nv();return Of("teleports",r),Ma(()=>{const o=Pf(),l=f=>f.charAt(0).toLowerCase()+f.slice(1),d=f=>l(f.slice(2)),u=Object.keys(o.props).filter(f=>typeof o.props[f]=="function"&&f.startsWith("on")&&f.length>2).map(d);t.value=n({me:o,props:o.props,data:o.data,listeners:u,emit:e,element:i.value});const h=(f,g)=>$f(()=>o.props[f],g);a(o,t.value,o.props,o.data,h)}),Kl(()=>{t.value&&t.value.destroy()}),{instance:t,refElement:i,teleports:r}}},pR={ref:"refElement"};function vR(c,e,t,i,r,n){return yi(),Er("div",pR,null,512)}const yR=Ta(mR,[["render",vR]]);document.title.split(" - ")[1]||document.title;const bR={name:"BryntumCalendar",props:{adopt:{type:[HTMLElement,String],default:void 0},align:{type:[Object,String],default:void 0},allowOverlap:{type:Boolean,default:void 0},anchor:{type:Boolean,default:void 0},ariaDescription:{type:String,default:void 0},ariaLabel:{type:String,default:void 0},autoCreate:{type:[Object,String,Boolean],default:void 0},autoUpdateRecord:{type:Boolean,default:void 0},bbar:{type:Object,default:void 0},bodyCls:{type:[String,Object],default:void 0},breakpoints:{type:Object,default:void 0},bubbleEvents:{type:Object,default:void 0},callOnFunctions:{type:Boolean,default:void 0},centered:{type:Boolean,default:void 0},collapsed:{type:Boolean,default:void 0},collapsible:{type:[Boolean,qi],default:void 0},config:{type:Object,default:void 0},constrainTo:{type:[HTMLElement,N,$],default:void 0},contentElementCls:{type:[String,Object],default:void 0},contextMenuTriggerEvent:{type:String,default:void 0},crudManagerClass:{type:Fr,default:void 0},dateFormat:{type:String,default:void 0},datePicker:{type:[Object,Boolean],default:void 0},defaultBindProperty:{type:String,default:void 0},defaultFocus:{type:Function,default:void 0},defaults:{type:Object,default:void 0},deselectOnClick:{type:Boolean,default:void 0},destroyStores:{type:Boolean,default:void 0},dock:{type:[String,Object],default:void 0},draggable:{type:[Boolean,Object],default:void 0},enableDeleteKey:{type:Boolean,default:void 0},enableRecurringEvents:{type:Boolean,default:void 0},enableUndoRedoKeys:{type:Boolean,default:void 0},eventSelectionDisabled:{type:Boolean,default:void 0},floating:{type:Boolean,default:void 0},footer:{type:[Object,String],default:void 0},header:{type:[String,Boolean,Object],default:void 0},hideAnimation:{type:[Boolean,Object],default:void 0},hideWhenEmpty:{type:Boolean,default:void 0},highlightDate:{type:[Boolean,Function],default:void 0},highlightPredecessors:{type:Boolean,default:void 0},highlightSuccessors:{type:Boolean,default:void 0},htmlCls:{type:[String,Object],default:void 0},ignoreParentReadOnly:{type:Boolean,default:void 0},includeWeekendsButton:{type:[Boolean,Object],default:void 0},itemCls:{type:String,default:void 0},lazyItems:{type:[Object,Array],default:void 0},listeners:{type:Object,default:void 0},loadMask:{type:[String,Object,null],default:void 0},loadMaskDefaults:{type:[Object,ze],default:void 0},loadMaskError:{type:[Object,ze,Boolean],default:void 0},localeClass:{type:Function,default:void 0},localizable:{type:Boolean,default:void 0},localizableProperties:{type:Array,default:void 0},maintainSelectionOnDatasetChange:{type:Boolean,default:void 0},maskDefaults:{type:Object,default:void 0},masked:{type:[Boolean,String,Object],default:void 0},monitorResize:{type:Boolean,default:void 0},multiEventSelect:{type:Boolean,default:void 0},namedItems:{type:Object,default:void 0},navigatorPlacement:{type:String,default:void 0},nonWorkingDays:{type:Object,default:void 0},overlaySidebar:{type:Boolean,default:void 0},owner:{type:N,default:void 0},positioned:{type:Boolean,default:void 0},preventTooltipOnTouch:{type:Boolean,default:void 0},relayStoreEvents:{type:Boolean,default:void 0},resourceImagePath:{type:String,default:void 0},responsive:{type:Object,default:void 0},responsiveRoot:{type:Boolean,default:void 0},responsiveState:{type:String,default:void 0},responsiveTarget:{type:[String,N],default:void 0},ripple:{type:[Boolean,Object],default:void 0},rootElement:{type:ShadowRoot,default:void 0},scrollAction:{type:[String,null],default:void 0},showAnimation:{type:[Boolean,Object],default:void 0},showRecurringUI:{type:Boolean,default:void 0},showTooltipWhenDisabled:{type:Boolean,default:void 0},sidebar:{type:[Object,Boolean],default:void 0},stateful:{type:[Boolean,Object,Array],default:void 0},statefulEvents:{type:[Object,Array],default:void 0},stateId:{type:String,default:void 0},stateProvider:{type:Gi,default:void 0},strips:{type:Object,default:void 0},syncMask:{type:[String,Object,null],default:void 0},tab:{type:[Boolean,Object],default:void 0},tag:{type:String,default:void 0},tbar:{type:Object,default:void 0},textAlign:{type:String,default:void 0},textContent:{type:Boolean,default:void 0},timeZone:{type:[String,Number],default:void 0},trapFocus:{type:Boolean,default:void 0},triggerSelectionChangeOnRemove:{type:Boolean,default:void 0},ui:{type:[String,Object],default:void 0},weekStartDay:{type:Number,default:void 0},weight:{type:Number,default:void 0},alignSelf:{type:String,default:void 0},appendTo:{type:[HTMLElement,String],default:void 0},assignments:{type:[Array,Object],default:void 0},assignmentStore:{type:os,default:void 0},cls:{type:[String,Object],default:void 0},content:{type:String,default:void 0},crudManager:{type:[Fr,Object],default:void 0},dataset:{type:Object,default:void 0},date:{type:Date,default:void 0},defaultCalendar:{type:[ls,String],default:void 0},disabled:{type:Boolean,default:void 0},events:{type:[Array,Object],default:void 0},eventStore:{type:ds,default:void 0},extraData:{type:[String,Number,Boolean,Object],default:void 0},features:{type:Object,default:void 0},flex:{type:[Number,String],default:void 0},height:{type:[Number,String],default:void 0},hidden:{type:Boolean,default:void 0},hideNonWorkingDays:{type:Boolean,default:void 0},html:{type:[String,Function],default:void 0},id:{type:String,default:void 0},insertBefore:{type:[HTMLElement,String],default:void 0},insertFirst:{type:[HTMLElement,String],default:void 0},isEventSelectable:{type:Function,default:void 0},items:{type:[Array,Object],default:void 0},layout:{type:[Xt,String,Object],default:void 0},layoutStyle:{type:Object,default:void 0},margin:{type:[Number,String],default:void 0},maxDate:{type:[Date,String],default:void 0},maxHeight:{type:[String,Number],default:void 0},maxWidth:{type:[String,Number],default:void 0},minDate:{type:[Date,String],default:void 0},minHeight:{type:[String,Number],default:void 0},minWidth:{type:[String,Number],default:void 0},mode:{type:String,default:void 0},modeDefaults:{type:Object,default:void 0},modes:{type:Object,default:void 0},project:{type:[oi,ir,Object],default:void 0},readOnly:{type:Boolean,default:void 0},resources:{type:[Array,Object],default:void 0},resourceStore:{type:oo,default:void 0},scrollable:{type:[Ke,Boolean,Object],default:void 0},title:{type:String,default:void 0},tools:{type:Object,default:void 0},tooltip:{type:[String,Object],default:void 0},width:{type:[Number,String],default:void 0},x:{type:Number,default:void 0},y:{type:Number,default:void 0},activeSubView:{type:N,default:void 0},activeView:{type:N,default:void 0},anchorSize:{type:Array,default:void 0},isEngineReady:{type:Boolean,default:void 0},isSettingValues:{type:Boolean,default:void 0},isValid:{type:Boolean,default:void 0},record:{type:de,default:void 0},selectedAssignments:{type:Array,default:void 0},selectedEvents:{type:Array,default:void 0},state:{type:Object,default:void 0},type:{type:String,default:void 0},values:{type:Object,default:void 0},views:{type:Array,default:void 0},onActiveItemChange:{type:Function,default:void 0},onAfterEventEdit:{type:Function,default:void 0},onAfterEventSave:{type:Function,default:void 0},onAssignmentSelectionChange:{type:Function,default:void 0},onBeforeActiveItemChange:{type:Function,default:void 0},onBeforeAssignmentDelete:{type:Function,default:void 0},onBeforeAssignmentSelectionChange:{type:Function,default:void 0},onBeforeDestroy:{type:Function,default:void 0},onBeforeDragCreateEnd:{type:Function,default:void 0},onBeforeDragMoveEnd:{type:Function,default:void 0},onBeforeDragResizeEnd:{type:Function,default:void 0},onBeforeEventDelete:{type:Function,default:void 0},onBeforeEventEdit:{type:Function,default:void 0},onBeforeEventEditShow:{type:Function,default:void 0},onBeforeEventSave:{type:Function,default:void 0},onBeforeEventSelectionChange:{type:Function,default:void 0},onBeforeHide:{type:Function,default:void 0},onBeforePrint:{type:Function,default:void 0},onBeforeResponsiveStateChange:{type:Function,default:void 0},onBeforeSetRecord:{type:Function,default:void 0},onBeforeShow:{type:Function,default:void 0},onCatchAll:{type:Function,default:void 0},onCellOverflowClick:{type:Function,default:void 0},onContextMenuItem:{type:Function,default:void 0},onContextMenuToggleItem:{type:Function,default:void 0},onDataChange:{type:Function,default:void 0},onDateChange:{type:Function,default:void 0},onDateRangeChange:{type:Function,default:void 0},onDateRangeRequested:{type:Function,default:void 0},onDayNumberClick:{type:Function,default:void 0},onDestroy:{type:Function,default:void 0},onDragCreateEnd:{type:Function,default:void 0},onDragMoveEnd:{type:Function,default:void 0},onDragResizeEnd:{type:Function,default:void 0},onEmptyCellClick:{type:Function,default:void 0},onEventAutoCreated:{type:Function,default:void 0},onEventClick:{type:Function,default:void 0},onEventContextMenu:{type:Function,default:void 0},onEventDblClick:{type:Function,default:void 0},onEventEditBeforeSetRecord:{type:Function,default:void 0},onEventMenuBeforeShow:{type:Function,default:void 0},onEventMenuItem:{type:Function,default:void 0},onEventMenuShow:{type:Function,default:void 0},onEventMouseDown:{type:Function,default:void 0},onEventMouseOut:{type:Function,default:void 0},onEventMouseOver:{type:Function,default:void 0},onEventMouseUp:{type:Function,default:void 0},onEventPropagate:{type:Function,default:void 0},onEventSelectionChange:{type:Function,default:void 0},onFocusIn:{type:Function,default:void 0},onFocusOut:{type:Function,default:void 0},onHide:{type:Function,default:void 0},onLoadOnDemandFail:{type:Function,default:void 0},onMonthNameClick:{type:Function,default:void 0},onNavigate:{type:Function,default:void 0},onPaint:{type:Function,default:void 0},onReadOnly:{type:Function,default:void 0},onRecompose:{type:Function,default:void 0},onRefresh:{type:Function,default:void 0},onResize:{type:Function,default:void 0},onResponsiveHeightChange:{type:Function,default:void 0},onResponsiveStateChange:{type:Function,default:void 0},onResponsiveWidthChange:{type:Function,default:void 0},onScheduleClick:{type:Function,default:void 0},onScheduleDblClick:{type:Function,default:void 0},onScheduleMenuBeforeShow:{type:Function,default:void 0},onScheduleMenuItem:{type:Function,default:void 0},onScheduleMenuShow:{type:Function,default:void 0},onScheduleMouseDown:{type:Function,default:void 0},onScheduleMouseOut:{type:Function,default:void 0},onScheduleMouseOver:{type:Function,default:void 0},onScheduleMouseUp:{type:Function,default:void 0},onSelectionChange:{type:Function,default:void 0},onShow:{type:Function,default:void 0},onTimeRangeHeaderClick:{type:Function,default:void 0},onTimeRangeHeaderContextMenu:{type:Function,default:void 0},onTimeRangeHeaderDblClick:{type:Function,default:void 0},onToolClick:{type:Function,default:void 0},onViewPaint:{type:Function,default:void 0},onWeekNumberClick:{type:Function,default:void 0},dragFeature:{type:[Object,Boolean,String],default:void 0},eventEditFeature:{type:[Object,Boolean,String],default:void 0},eventMenuFeature:{type:[Object,Boolean,String],default:void 0},eventTooltipFeature:{type:[Object,Boolean,String],default:void 0},externalEventSourceFeature:{type:[Object,Boolean,String],default:void 0},loadOnDemandFeature:{type:[Object,Boolean,String],default:void 0},printFeature:{type:[Object,Boolean,String],default:void 0},scheduleMenuFeature:{type:[Object,Boolean,String],default:void 0},timeRangesFeature:{type:[Object,Boolean,String],default:void 0},weekExpanderFeature:{type:[Object,Boolean,String],default:void 0}},emits:["activeitemchange","aftereventedit","aftereventsave","assignmentselectionchange","beforeactiveitemchange","beforeassignmentdelete","beforeassignmentselectionchange","beforedestroy","beforedragcreateend","beforedragmoveend","beforedragresizeend","beforeeventdelete","beforeeventedit","beforeeventeditshow","beforeeventsave","beforeeventselectionchange","beforehide","beforeprint","beforeresponsivestatechange","beforesetrecord","beforeshow","catchall","celloverflowclick","contextmenuitem","contextmenutoggleitem","datachange","datechange","daterangechange","daterangerequested","daynumberclick","destroy","dragcreateend","dragmoveend","dragresizeend","emptycellclick","eventautocreated","eventclick","eventcontextmenu","eventdblclick","eventeditbeforesetrecord","eventmenubeforeshow","eventmenuitem","eventmenushow","eventmousedown","eventmouseout","eventmouseover","eventmouseup","eventpropagate","eventselectionchange","focusin","focusout","hide","loadondemandfail","monthnameclick","navigate","paint","recompose","refresh","resize","responsiveheightchange","responsivestatechange","responsivewidthchange","scheduleclick","scheduledblclick","schedulemenubeforeshow","schedulemenuitem","schedulemenushow","schedulemousedown","schedulemouseout","schedulemouseover","schedulemouseup","selectionchange","show","timerangeheaderclick","timerangeheadercontextmenu","timerangeheaderdblclick","toolclick","viewpaint","weeknumberclick"],data:()=>({instanceClass:sr,instanceName:"Calendar",isView:!0,dataStores:{assignmentStore:"assignments",dependencyStore:"dependencies",eventStore:"events",resourceStore:"resources",resourceTimeRangeStore:"resourceTimeRanges",timeRangeStore:"timeRanges"},projectStores:!0,featureNames:["dragFeature","eventEditFeature","eventMenuFeature","eventTooltipFeature","externalEventSourceFeature","loadOnDemandFeature","printFeature","scheduleMenuFeature","timeRangesFeature","weekExpanderFeature"],configNames:["adopt","align","allowOverlap","anchor","ariaDescription","ariaLabel","autoCreate","autoUpdateRecord","bbar","bodyCls","breakpoints","bubbleEvents","callOnFunctions","centered","collapsed","collapsible","config","constrainTo","contentElementCls","contextMenuTriggerEvent","crudManagerClass","dateFormat","datePicker","defaultBindProperty","defaultFocus","defaults","deselectOnClick","destroyStores","dock","draggable","enableDeleteKey","enableRecurringEvents","enableUndoRedoKeys","eventSelectionDisabled","floating","footer","header","hideAnimation","hideWhenEmpty","highlightDate","highlightPredecessors","highlightSuccessors","htmlCls","ignoreParentReadOnly","includeWeekendsButton","itemCls","lazyItems","listeners","loadMask","loadMaskDefaults","loadMaskError","localeClass","localizable","localizableProperties","maintainSelectionOnDatasetChange","maskDefaults","masked","monitorResize","multiEventSelect","namedItems","navigatorPlacement","nonWorkingDays","overlaySidebar","owner","positioned","preventTooltipOnTouch","relayStoreEvents","resourceImagePath","responsive","responsiveRoot","responsiveState","responsiveTarget","ripple","rootElement","scrollAction","showAnimation","showRecurringUI","showTooltipWhenDisabled","sidebar","stateful","statefulEvents","stateId","stateProvider","strips","syncMask","tab","tag","tbar","textAlign","textContent","timeZone","trapFocus","triggerSelectionChangeOnRemove","ui","weekStartDay","weight"],propertyConfigNames:["alignSelf","appendTo","assignments","assignmentStore","cls","content","crudManager","dataset","date","defaultCalendar","disabled","events","eventStore","extraData","features","flex","height","hidden","hideNonWorkingDays","html","id","insertBefore","insertFirst","isEventSelectable","items","layout","layoutStyle","margin","maxDate","maxHeight","maxWidth","minDate","minHeight","minWidth","mode","modeDefaults","modes","onActiveItemChange","onAfterEventEdit","onAfterEventSave","onAssignmentSelectionChange","onBeforeActiveItemChange","onBeforeAssignmentDelete","onBeforeAssignmentSelectionChange","onBeforeDestroy","onBeforeDragCreateEnd","onBeforeDragMoveEnd","onBeforeDragResizeEnd","onBeforeEventDelete","onBeforeEventEdit","onBeforeEventEditShow","onBeforeEventSave","onBeforeEventSelectionChange","onBeforeHide","onBeforePrint","onBeforeResponsiveStateChange","onBeforeSetRecord","onBeforeShow","onCatchAll","onCellOverflowClick","onContextMenuItem","onContextMenuToggleItem","onDataChange","onDateChange","onDateRangeChange","onDateRangeRequested","onDayNumberClick","onDestroy","onDragCreateEnd","onDragMoveEnd","onDragResizeEnd","onEmptyCellClick","onEventAutoCreated","onEventClick","onEventContextMenu","onEventDblClick","onEventEditBeforeSetRecord","onEventMenuBeforeShow","onEventMenuItem","onEventMenuShow","onEventMouseDown","onEventMouseOut","onEventMouseOver","onEventMouseUp","onEventPropagate","onEventSelectionChange","onFocusIn","onFocusOut","onHide","onLoadOnDemandFail","onMonthNameClick","onNavigate","onPaint","onReadOnly","onRecompose","onRefresh","onResize","onResponsiveHeightChange","onResponsiveStateChange","onResponsiveWidthChange","onScheduleClick","onScheduleDblClick","onScheduleMenuBeforeShow","onScheduleMenuItem","onScheduleMenuShow","onScheduleMouseDown","onScheduleMouseOut","onScheduleMouseOver","onScheduleMouseUp","onSelectionChange","onShow","onTimeRangeHeaderClick","onTimeRangeHeaderContextMenu","onTimeRangeHeaderDblClick","onToolClick","onViewPaint","onWeekNumberClick","project","readOnly","resources","resourceStore","scrollable","title","tools","tooltip","width","x","y"],propertyNames:["activeSubView","activeView","anchorSize","isEngineReady","isSettingValues","isValid","record","selectedAssignments","selectedEvents","state","type","values","views"],eventNames:["activeItemChange","afterEventEdit","afterEventSave","assignmentSelectionChange","beforeActiveItemChange","beforeAssignmentDelete","beforeAssignmentSelectionChange","beforeDestroy","beforeDragCreateEnd","beforeDragMoveEnd","beforeDragResizeEnd","beforeEventDelete","beforeEventEdit","beforeEventEditShow","beforeEventSave","beforeEventSelectionChange","beforeHide","beforePrint","beforeResponsiveStateChange","beforeSetRecord","beforeShow","catchAll","cellOverflowClick","contextMenuItem","contextMenuToggleItem","dataChange","dateChange","dateRangeChange","dateRangeRequested","dayNumberClick","destroy","dragCreateEnd","dragMoveEnd","dragResizeEnd","emptyCellClick","eventAutoCreated","eventClick","eventContextMenu","eventDblClick","eventEditBeforeSetRecord","eventMenuBeforeShow","eventMenuItem","eventMenuShow","eventMouseDown","eventMouseOut","eventMouseOver","eventMouseUp","eventPropagate","eventSelectionChange","focusIn","focusOut","hide","loadOnDemandFail","monthNameClick","navigate","paint","recompose","refresh","resize","responsiveHeightChange","responsiveStateChange","responsiveWidthChange","scheduleClick","scheduleDblClick","scheduleMenuBeforeShow","scheduleMenuItem","scheduleMenuShow","scheduleMouseDown","scheduleMouseOut","scheduleMouseOver","scheduleMouseUp","selectionChange","show","timeRangeHeaderClick","timeRangeHeaderContextMenu","timeRangeHeaderDblClick","toolClick","viewPaint","weekNumberClick"]}),setup(c,{emit:e}){const t={},i=gt(null),r=gt(new Map),{createWidget:n,relayStores:s,watchProps:a}=nv(),{processCellContent:o,hasFrameworkRenderer:l}=cR();return Of("teleports",r),Ma(()=>{const d=Pf(),u=m=>m.charAt(0).toLowerCase()+m.slice(1),h=m=>u(m.slice(2)),f=Object.keys(d.props).filter(m=>typeof d.props[m]=="function"&&m.startsWith("on")&&m.length>2).map(h);t.value=n({me:d,props:d.props,data:d.data,listeners:f,emit:e,element:i.value,processCellContent:o,hasFrameworkRenderer:l}),s(d.data,t.value);const g=(m,p)=>$f(()=>d.props[m],p);a(d,t.value,d.props,d.data,g)}),Kl(()=>{t.value&&t.value.destroy()}),{instance:t,refElement:i,teleports:r}}},CR={ref:"refElement"},wR={ref:"teleportsHolder",style:{display:"none"}};function SR(c,e,t,i,r,n){return yi(),Er("div",CR,[br("div",wR,[(yi(!0),Er(_f,null,av(i.teleports.values(),s=>(yi(),hc(lv,{key:s.key,to:s.to},[(yi(),hc(ov(s.is),Hf({ref_for:!0,ref:s.key,"data-key":s.key,"data-generation":s.generation},s.bind,{"data-vue":""}),null,16,["data-key","data-generation"]))],8,["to"]))),128))],512)],512)}const DR=Ta(bR,[["render",SR]]);var ye=(c=>(c.ApprovedTimeOff="1",c.PendingTimeOff="2",c.Event="3",c.Holiday="4",c))(ye||{}),xn=(c=>(c.Daily="DAILY",c.Weekly="WEEKLY",c.Monthly="MONTHLY",c.Yearly="YEARLY",c))(xn||{});const ER=Nf().ClientSide.WorkforceManagement+"/v1",xR=dv(),RR=await xR.fetchAccessToken(),Rn=await cv.get(`${ER+"/Employee"}`,{headers:{Authorization:`Bearer ${RR}`}});Rn.status&&Object.keys(Rn.data).length>0&&(Rn.data=Rn.data.map(c=>({...c,id:c.id,name:`${c.firstName} ${c.middleName?c.middleName:""} ${c.lastName}`})));const TR=new Blob([JSON.stringify(Rn.data)],{type:"application/json"}),MR=URL.createObjectURL(TR);class kR extends Ze{static get type(){return"employeeSelector"}static get configurable(){return{store:new $t({readUrl:MR,autoLoad:!0}),valueField:"id",displayField:"name",emptyText:"No employees!"}}}kR.initClass();const IR=c=>({date:new Date,crudManager:{},mode:"month",modes:{day:null,year:null,agenda:null},sidebar:{cls:"custom-sidebar",items:{datePicker:null,customText:{weight:0,label:"Filters",type:"displayfield",cls:"custom-sidebar-header"},employeeFilter:{weight:10,type:"employeeSelector",cls:"select-item",label:"Choose Employee",name:"employee",clearable:!0,onChange:e=>c(e.source.value)},resourceFilter:{store:{sorters:[]}},eventFilter:null}},eventTooltipFeature:!1,dragFeature:!1,eventMenuFeature:null,eventEditFeature:{items:{resourceField:!1,resourceFieldRadio:{weight:0,label:" ",type:"radiogroup",name:"resourceId",options:{[ye.Event]:" Event",[ye.Holiday]:" Holiday"},onChange:({value:e,source:t})=>{e===ye.Event?(t.parent.title=t.parent.title.replace("Holiday","Event"),t.parent.items[2].value=!1,t.parent.items[2].style="display: inline-flex"):e===ye.Holiday&&(t.parent.title=t.parent.title.replace("Event","Holiday"),t.parent.items[2].value=!0,t.parent.items[2].style="display: none")}},startDateField:{cls:"calendar-start-date-field"},startTimeField:{cls:"calendar-start-time-field"},endDateField:{cls:"calendar-end-date-field"},endTimeField:{cls:"calendar-end-time-field"},planType:{weight:850,readOnly:!0,label:"Plan Type",type:"text",name:"planType"},note:{weight:900,cls:"calendar-request-note-field",readOnly:!0,label:"Note",type:"textarea",name:"note"},sendNotification:{weight:950,label:"Notify",type:"checkbox",name:"sendNotification",onChange:({value:e,source:t})=>{e?(t.parent.items[12].disabled=!1,t.parent.items[12].required=!0):(t.parent.items[12].disabled=!0,t.parent.items[12].required=!1)}},notificationDate:{weight:1e3,cls:"calendar-notification-date-field",label:"Date",type:"date",name:"notificationDate"}},editorConfig:{bbar:{items:{cancelButton:null,cancelRequestButton:{text:"Cancel",style:{color:"white"}}}}}}});class FR extends fv{constructor(e){const t=Nf().ClientSide.WorkforceManagement+"/v1";super(e,t)}async getCalendar(e){try{const t=await this.axiosInstance.get(e===null?"calendars":`calendars/${e}`);if(t.status===200&&t.data)return t.data;throw new Error("Failed to parse calendar")}catch{console.error("An unexpected error occurred attempting to retrieve the Calendar List.")}}}const AR=new FR([uv,hv]),LR=gv("calendar",()=>{async function c(e){return await AR.getCalendar(e)}return{getCalendar:c}}),OR={class:"calendar",id:"fs-calendar-view",style:{display:"flex"}},PR=["onSubmit"],$R=Bf({__name:"calendar",setup(c){const e=mv(),t=async D=>{const w=await h.getCalendar(D);i.value=w.events.rows,r.value=w.resources.rows},i=gt(null),r=gt(null),n=gt(null),s=gt(null),a=pv(IR(t)),o=wv(),l=gt(!1),d=gt({id:null,eventId:null}),u=gt(""),h=LR();Ma(async()=>{const D=n?.value?.instance?.value;s.value=D?.eventStore;const w=await h.getCalendar(null);i.value=w.events.rows,r.value=w.resources.rows});const f=D=>{let w=D.startDate,E=D.endDate;D.allDay&&(w=ut.startOf(w),E=ut.add(ut.endOf(E),-1,"seconds"));const R=s.value.toJSON();for(const x of R)if(x.resourceId===ye.PendingTimeOff&&(ut.isAfter(E,new Date(x.startDate))||ut.isEqual(E,new Date(x.startDate)))&&(ut.isBefore(w,new Date(x.endDate))||ut.isEqual(w,new Date(x.endDate))))return!0;return!1},g=({eventRecord:D,editor:w})=>{const E=D.data||{},R=w.widgetMap.resourceFieldRadio||{},x=w.widgetMap.sendNotification||{},k=w.widgetMap.notificationDate||{};if(w.bbar.items[2].onClick=async()=>{if(await Bt.confirm({title:"Cancel time off request",message:"Do you really want to cancel this request? </br> This process cannot be undone."})===Bt.okButton){const A=await o.cancelRequest(E.eventId);if(A.success){if(Array.isArray(A.data))for(const L of A.data)s.value.getById(`${L}-${E.resourceId}`).remove();e.notifySuccess("Request cancelled.")}else e.notifyError("Unsuccessful cancel request.")}},E.name!=="New event"&&E.resourceId!=ye.Event&&E.resourceId!=ye.Holiday){w.items[0].style="display: none",w.items[1].readOnly=!0,w.items[2].style="display: none",w.items[3].readOnly=!0,w.items[4].readOnly=!0,w.items[5].readOnly=!0,w.items[6].readOnly=!0,w.items[7].readOnly=!0,w.items[8].style="display: none",w.items[9].style="display: inline-flex",w.items[9].value=E.planType||"",w.items[10].style="display: inline-flex",w.items[10].value=E.note||"",w.items[11].style="display: none",w.items[12].style="display: none",w.bbar.items[2].style="display: inline-flex",E.resourceId==ye.ApprovedTimeOff?(w.title="Approved Time Off",w.bbar.items[0].style="display: none",w.bbar.items[1].style="display: none"):(w.title="Pending Time Off",w.bbar.items[0].style="display: inline-flex",w.bbar.items[0].text="Approve",w.bbar.items[0].color="b-green",w.bbar.items[1].style="display: inline-flex",w.bbar.items[1].text="Reject",w.bbar.items[1].color="b-red",w.bbar.items[2].color="b-red");return}E.name==="New event"?(w.title="Add Event",R.value=ye.Event+"",x.value=!1):(R.value=E.resourceId+"",E.resourceId===ye.Event?(w.title="Edit Event",w.items[2].value=E.allDay,w.items[2].style="display: inline-flex"):E.resourceId===ye.Holiday&&(w.title="Edit Holiday",w.items[2].value=!0,w.items[2].style="display: none"),x.value=E.sendNotification),w.items[0].style="display: inline-flex",w.items[1].readOnly=!1,w.items[3].readOnly=!1,w.items[4].readOnly=!1,w.items[5].readOnly=!1,w.items[6].readOnly=!1,w.items[7].readOnly=!1,w.items[8].style="display: inline-flex",w.items[9].style="display: none",w.items[10].style="display: none",w.items[11].style="display: inline-flex",w.items[12].style="display: inline-flex",E.sendNotification?k.disabled=!1:k.disabled=!0,w.bbar.items[0].style="display: inline-flex",w.bbar.items[0].text="Save",w.bbar.items[0].color="",w.bbar.items[1].style="display: inline-flex",w.bbar.items[1].text="Delete",w.bbar.items[1].color="",w.bbar.items[2].style="display: none"},m=({eventRecord:D,values:w})=>{const{data:E}=D;if(w.resourceId===ye.Holiday&&f(w))return Bt.alert({title:"Warning",message:"There's pending time-off request overlapping with this holiday!"}),!1;if((w.resourceId===ye.Event||w.resourceId===ye.Holiday)&&(w.recurrenceCombo!=="none"||E.recurrenceCombo!=="none")){let R=0;switch(w.recurrenceCombo){case xn.Daily:R=ut.diff(w.startDate,w.endDate,"days");break;case xn.Weekly:R=ut.diff(w.startDate,w.endDate,"weeks");break;case xn.Monthly:{const x=ut.add(w.startDate,1,"months");R=1+ut.diff(x,w.endDate,"days");break}case xn.Yearly:{const x=ut.add(w.startDate,1,"years");R=1+ut.diff(x,w.endDate,"days");break}}if(R>1){const x=w.recurrenceCombo.toLowerCase();return Bt.alert({title:"Warning",message:`Cannot select more than 1 ${x.replace("ily","y").replace("ly","")} for event/holiday that repeats ${x}!`}),!1}if(!E?.id?.toString()?.includes("_generated"))return Bt.confirm({title:"Update confirmation",message:`Are you sure you want to update this repeating ${E.resourceId===ye.Event?"event":"holiday"}?`}).then(async x=>{if(x===Bt.okButton){let k=E.id;E.id.startsWith("_generated")&&(k=E.id.split(":")[1]),await o.updateEvent({...E,...w});const I=s.value.getById(k);I.resourceId=w.resourceId,I.name=w.name,I.allDay=w.allDay,I.startDate=w.startDate,I.endDate=w.endDate,I.recurrenceCombo=w.recurrenceCombo,I.recurrenceRule=w.recurrenceRule,e.notifySuccess(E.resourceId===ye.Event?"Event updated.":"Holiday updated.")}}),!1}},p=async({eventRecord:D})=>{const{data:w}=D,E=s.value.getById(D.id);if(w?.id?.toString()?.includes("_generated")){const R=await o.addEvent({...w});E.id=R.id,E.eventId=R.eventId,e.notifySuccess(w.resourceId===ye.Event?"Event added.":"Holiday added.")}else if(w.resourceId===null)try{if(await Bt.confirm({title:"Approve time off request",message:`Are you sure you want to approve this Time Off Request of ${D.name}`})===Bt.okButton){const x=await o.approveRequest({id:w.eventId});if(x.success){if(Array.isArray(x.data))for(const k of x.data)s.value.getById(`${k}-${ye.PendingTimeOff}`).resourceId=ye.ApprovedTimeOff,s.value.getById(`${k}-${ye.PendingTimeOff}`).id=`${k}-${ye.ApprovedTimeOff}`;e.notifySuccess("Request approved.")}else e.notifySuccess("Unsuccessful approve request.")}else E.resourceId=ye.PendingTimeOff}catch{alert("Error when approve request. Please try again later.")}else o.updateEvent({...w}),e.notifySuccess(w.resourceId===ye.Event?"Event updated.":"Holiday updated.")},v=({eventRecords:D})=>{const{data:w}=D[0];return w.resourceId!=ye.Event&&w.resourceId!=ye.Holiday?(l.value=!0,d.value={id:w.id,eventId:w.eventId},!1):(Bt.confirm({title:"Delete confirmation",message:`Are you sure you want to delete this ${w.resourceId===ye.Event?"event":"holiday"}?`}).then(async E=>{if(E===Bt.okButton){let R=w.id;w.id.startsWith("_generated")&&(R=w.id.split(":")[1]),await o.deleteEvent({...w}),s.value.getById(R).remove(),e.notifySuccess(w.resourceId===ye.Event?"Event deleted.":"Holiday deleted.")}}),!1)},y=()=>{u.value=""},C=async()=>{try{const D=await o.rejectRequest({id:+d.value.eventId,rejectReason:u.value});if(D.success){if(Array.isArray(D.data))for(const w of D.data)s.value.getById(`${w}-${ye.PendingTimeOff}`).remove();e.notifySuccess("Request rejected.")}else e.notifyError("Unsuccessful reject request.")}catch(D){console.log(D),alert("Error when reject request. Please try again later.")}};return(D,w)=>{const E=Cr("fs-button"),R=Cr("fs-button-group"),x=Cr("fs-modal");return yi(),Er(_f,null,[br("div",OR,[ni(vv(DR),Hf({ref_key:"calendar",ref:n},a,{onBeforeEventEditShow:g,onBeforeEventSave:m,onAfterEventSave:p,onBeforeEventDelete:v,events:i.value,resources:r.value}),null,16,["events","resources"])]),ni(x,{id:"reject-request-modal",ref:"modal",title:"Reject Reason","content-class":"content-fsModal","body-class":"body-fsModal","header-bg-variant":"blue","header-text-variant":"white",modelValue:l.value,"onUpdate:modelValue":w[1]||(w[1]=k=>l.value=k),onHidden:y,onOk:C},{"modal-footer":pi(({ok:k,cancel:I})=>[ni(R,null,{default:pi(()=>[ni(E,{onClick:I,variant:"light",class:"m-2 text-uppercase"},{default:pi(()=>[fc("cancel ")]),_:2},1032,["onClick"]),ni(E,{onClick:k,variant:"danger",class:"m-2 text-uppercase",disabled:u.value==""},{default:pi(()=>[fc("Reject")]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),default:pi(()=>[br("form",{ref:"form",onSubmit:Cv(C,["stop","prevent"])},[yv(br("textarea",{class:"textarea","onUpdate:modelValue":w[0]||(w[0]=k=>u.value=k),required:"",rows:"4"},null,512),[[bv,u.value]])],40,PR)]),_:1},8,["modelValue"])],64)}}});const _R=Ta($R,[["__scopeId","data-v-0279beb0"]]),HR=br("h2",{class:"fsi-pg__title"},"Calendar View",-1),NR={class:"dashboard-card__content list__table"},GM=Bf({__name:"calendarView",setup(c){return(e,t)=>{const i=Cr("fs-col"),r=Cr("fs-row"),n=Cr("fs-container");return yi(),Er("div",null,[ni(n,{fluid:"",class:"contain fsi-pg__header fsi-pg__header--sub",style:{"z-index":"1000"}},{default:pi(()=>[ni(r,{"align-v":"center"},{default:pi(()=>[ni(i,{cols:"auto"},{default:pi(()=>[HR]),_:1})]),_:1})]),_:1}),br("div",NR,[ni(_R)])])}}});export{GM as default};
