/*!
 *
 * Bryntum Calendar 5.3.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
import{DateHelper as e,TimeZoneHelper as t,Store as n,_objectSpread2 as r,Model as s,ObjectHelper as a,Events as i,Delayable as o,Base as l,ArrayHelper as c,StringHelper as d,Objects as u,_defineProperty as h,AjaxHelper as g,LoadMaskable as m,Mask as v,AjaxStore as p,FunctionHelper as f,DayTime as y,DomClassList as S,Duration as D,VersionHelper as C,BrowserHelper as R}from"./Editor.js";import{StateTrackingManager as E}from"./AvatarRendering.js";import{GridRowModel as I}from"./GridRowModel.js";const T=(e,t)=>new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()+t,e.getMilliseconds()),x=function(){var e={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>1&&((r=Number(arguments[1]))!=r?r=0:0!=r&&r!=1/0&&r!=-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var s=r>=0?r:Math.max(n-Math.abs(r),0);s<n;s++)if(s in t&&t[s]===e)return s;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.array={},e.array.sort=function(e,t){e.sort((function(e,t){return+e-+t})),t&&0===e[0]&&e.push(e.shift())},e.array.next=function(e,t,n){for(var r,s=0!==n[0],a=0,i=t.length-1;i>-1;--i){if((r=t[i])===e)return r;if(!(r>e||0===r&&s&&n[1]>e))break;a=i}return t[a]},e.array.nextInvalid=function(e,t,n){for(var r=n[0],s=n[1],a=t.length,i=0===t[a-1]&&0!==r?s:0,o=e,l=t.indexOf(e),c=o;o===(t[l]||i);)if(++o>s&&(o=r),++l===a&&(l=0),o===c)return;return o},e.array.prev=function(e,t,n){for(var r,s=t.length,a=0!==n[0],i=s-1,o=0;o<s;o++){if((r=t[o])===e)return r;if(!(r<e||0===r&&a&&n[1]<e))break;i=o}return t[i]},e.array.prevInvalid=function(e,t,n){for(var r=n[0],s=n[1],a=t.length,i=0===t[a-1]&&0!==r?s:0,o=e,l=t.indexOf(e),c=o;o===(t[l]||i);)if(--o<r&&(o=s),-1===--l&&(l=a-1),o===c)return;return o},e.day=e.D={name:"day",range:86400,val:function(t){return t.D||(t.D=e.date.getDate.call(t))},isValid:function(t,n){return e.D.val(t)===(n||e.D.extent(t)[1])},extent:function(t){if(t.DExtent)return t.DExtent;var n=e.M.val(t),r=e.DAYS_IN_MONTH[n-1];return 2===n&&366===e.dy.extent(t)[1]&&(r+=1),t.DExtent=[1,r]},start:function(t){return t.DStart||(t.DStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)))},end:function(t){return t.DEnd||(t.DEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)))},next:function(t,n){n=n>e.D.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.D,e.M),s=e.D.extent(r)[1];return n=n>s?1:n||s,e.date.next(e.Y.val(r),e.M.val(r),n)},prev:function(t,n){var r=e.date.prevRollover(t,n,e.D,e.M),s=e.D.extent(r)[1];return e.date.prev(e.Y.val(r),e.M.val(r),n>s?s:n||s)}},e.dayOfWeekCount=e.dc={name:"day of week count",range:604800,val:function(t){return t.dc||(t.dc=Math.floor((e.D.val(t)-1)/7)+1)},isValid:function(t,n){return e.dc.val(t)===n||0===n&&e.D.val(t)>e.D.extent(t)[1]-7},extent:function(t){return t.dcExtent||(t.dcExtent=[1,Math.ceil(e.D.extent(t)[1]/7)])},start:function(t){return t.dcStart||(t.dcStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(1,7*(e.dc.val(t)-1)+1||1)))},end:function(t){return t.dcEnd||(t.dcEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(7*e.dc.val(t),e.D.extent(t)[1])))},next:function(t,n){n=n>e.dc.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.dc,e.M);n=n>e.dc.extent(r)[1]?1:n;var s=e.date.next(e.Y.val(r),e.M.val(r),0===n?e.D.extent(r)[1]-6:1+7*(n-1));return s.getTime()<=t.getTime()?(r=e.M.next(t,e.M.val(t)+1),e.date.next(e.Y.val(r),e.M.val(r),0===n?e.D.extent(r)[1]-6:1+7*(n-1))):s},prev:function(t,n){var r=e.date.prevRollover(t,n,e.dc,e.M),s=e.dc.extent(r)[1];return n=n>s?s:n||s,e.dc.end(e.date.prev(e.Y.val(r),e.M.val(r),1+7*(n-1)))}},e.dayOfWeek=e.dw=e.d={name:"day of week",range:86400,val:function(t){return t.dw||(t.dw=e.date.getDay.call(t)+1)},isValid:function(t,n){return e.dw.val(t)===(n||7)},extent:function(){return[1,7]},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,n){return n=n>7?1:n||7,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n-e.dw.val(t))+(n<=e.dw.val(t)?7:0))},prev:function(t,n){return n=n>7?7:n||7,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(n-e.dw.val(t))+(n>=e.dw.val(t)?-7:0))}},e.dayOfYear=e.dy={name:"day of year",range:86400,val:function(t){return t.dy||(t.dy=Math.ceil(1+(e.D.start(t).getTime()-e.Y.start(t).getTime())/e.DAY))},isValid:function(t,n){return e.dy.val(t)===(n||e.dy.extent(t)[1])},extent:function(t){var n=e.Y.val(t);return t.dyExtent||(t.dyExtent=[1,n%4?365:366])},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,n){n=n>e.dy.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.dy,e.Y),s=e.dy.extent(r)[1];return n=n>s?1:n||s,e.date.next(e.Y.val(r),e.M.val(r),n)},prev:function(t,n){var r=e.date.prevRollover(t,n,e.dy,e.Y),s=e.dy.extent(r)[1];return n=n>s?s:n||s,e.date.prev(e.Y.val(r),e.M.val(r),n)}},e.hour=e.h={name:"hour",range:3600,val:function(t){return t.h||(t.h=e.date.getHour.call(t))},isValid:function(t,n){return e.h.val(t)===n},extent:function(){return[0,23]},start:function(t){return t.hStart||(t.hStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},end:function(t){return t.hEnd||(t.hEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},next:function(t,n){n=n>23?0:n;var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n<=e.h.val(t)?1:0),n);return!e.date.isUTC&&r.getTime()<=t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),n+1)),r},prev:function(t,n){return n=n>23?23:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(n>=e.h.val(t)?-1:0),n)}},e.minute=e.m={name:"minute",range:60,val:function(t){return t.m||(t.m=e.date.getMin.call(t))},isValid:function(t,n){return e.m.val(t)===n},extent:function(e){return[0,59]},start:function(t){return t.mStart||(t.mStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},end:function(t){return t.mEnd||(t.mEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},next:function(t,n){var r=e.m.val(t),s=e.s.val(t),a=n>59?60-r:n<=r?60-r+n:n-r,i=new Date(t.getTime()+a*e.MIN-s*e.SEC);return!e.date.isUTC&&i.getTime()<=t.getTime()&&(i=new Date(t.getTime()+(a+120)*e.MIN-s*e.SEC)),i},prev:function(t,n){return n=n>59?59:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)+(n>=e.m.val(t)?-1:0),n)}},e.month=e.M={name:"month",range:2629740,val:function(t){return t.M||(t.M=e.date.getMonth.call(t)+1)},isValid:function(t,n){return e.M.val(t)===(n||12)},extent:function(){return[1,12]},start:function(t){return t.MStart||(t.MStart=e.date.next(e.Y.val(t),e.M.val(t)))},end:function(t){return t.MEnd||(t.MEnd=e.date.prev(e.Y.val(t),e.M.val(t)))},next:function(t,n){return n=n>12?1:n||12,e.date.next(e.Y.val(t)+(n>e.M.val(t)?0:1),n)},prev:function(t,n){return n=n>12?12:n||12,e.date.prev(e.Y.val(t)-(n>=e.M.val(t)?1:0),n)}},e.second=e.s={name:"second",range:1,val:function(t){return t.s||(t.s=e.date.getSec.call(t))},isValid:function(t,n){return e.s.val(t)===n},extent:function(){return[0,59]},start:function(e){return e},end:function(e){return e},next:function(t,n){var r=e.s.val(t),s=n>59?60-r:n<=r?60-r+n:n-r,a=new Date(t.getTime()+s*e.SEC);return!e.date.isUTC&&a.getTime()<=t.getTime()&&(a=new Date(t.getTime()+(s+7200)*e.SEC)),a},prev:function(t,n,r){return n=n>59?59:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)+(n>=e.s.val(t)?-1:0),n)}},e.time=e.t={name:"time",range:1,val:function(t){return t.t||(t.t=3600*e.h.val(t)+60*e.m.val(t)+e.s.val(t))},isValid:function(t,n){return e.t.val(t)===n},extent:function(){return[0,86399]},start:function(e){return e},end:function(e){return e},next:function(t,n){n=n>86399?0:n;var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n<=e.t.val(t)?1:0),0,0,n);return!e.date.isUTC&&r.getTime()<t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r),e.m.val(r),n+7200)),r},prev:function(t,n){return n=n>86399?86399:n,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n>=e.t.val(t)?-1:0),0,0,n)}},e.weekOfMonth=e.wm={name:"week of month",range:604800,val:function(t){return t.wm||(t.wm=(e.D.val(t)+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(t)))/7)},isValid:function(t,n){return e.wm.val(t)===(n||e.wm.extent(t)[1])},extent:function(t){return t.wmExtent||(t.wmExtent=[1,(e.D.extent(t)[1]+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(e.M.end(t))))/7])},start:function(t){return t.wmStart||(t.wmStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(e.D.val(t)-e.dw.val(t)+1,1)))},end:function(t){return t.wmEnd||(t.wmEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(e.D.val(t)+(7-e.dw.val(t)),e.D.extent(t)[1])))},next:function(t,n){n=n>e.wm.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.wm,e.M),s=e.wm.extent(r)[1];return n=n>s?1:n||s,e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,7*(n-1)-(e.dw.val(r)-2)))},prev:function(t,n){var r=e.date.prevRollover(t,n,e.wm,e.M),s=e.wm.extent(r)[1];return n=n>s?s:n||s,e.wm.end(e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,7*(n-1)-(e.dw.val(r)-2))))}},e.weekOfYear=e.wy={name:"week of year (ISO)",range:604800,val:function(t){if(t.wy)return t.wy;var n=e.dw.next(e.wy.start(t),5),r=e.dw.next(e.Y.prev(n,e.Y.val(n)-1),5);return t.wy=1+Math.ceil((n.getTime()-r.getTime())/e.WEEK)},isValid:function(t,n){return e.wy.val(t)===(n||e.wy.extent(t)[1])},extent:function(t){if(t.wyExtent)return t.wyExtent;var n=e.dw.next(e.wy.start(t),5),r=e.dw.val(e.Y.start(n)),s=e.dw.val(e.Y.end(n));return t.wyExtent=[1,5===r||5===s?53:52]},start:function(t){return t.wyStart||(t.wyStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)-(e.dw.val(t)>1?e.dw.val(t)-2:6)))},end:function(t){return t.wyEnd||(t.wyEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(e.dw.val(t)>1?8-e.dw.val(t):0)))},next:function(t,n){n=n>e.wy.extent(t)[1]?1:n;var r=e.dw.next(e.wy.start(t),5),s=e.date.nextRollover(r,n,e.wy,e.Y);1!==e.wy.val(s)&&(s=e.dw.next(s,2));var a=e.wy.extent(s)[1],i=e.wy.start(s);return n=n>a?1:n||a,e.date.next(e.Y.val(i),e.M.val(i),e.D.val(i)+7*(n-1))},prev:function(t,n){var r=e.dw.next(e.wy.start(t),5),s=e.date.prevRollover(r,n,e.wy,e.Y);1!==e.wy.val(s)&&(s=e.dw.next(s,2));var a=e.wy.extent(s)[1],i=e.wy.end(s);return n=n>a?a:n||a,e.wy.end(e.date.next(e.Y.val(i),e.M.val(i),e.D.val(i)+7*(n-1)))}},e.year=e.Y={name:"year",range:31556900,val:function(t){return t.Y||(t.Y=e.date.getYear.call(t))},isValid:function(t,n){return e.Y.val(t)===n},extent:function(){return[1970,2099]},start:function(t){return t.YStart||(t.YStart=e.date.next(e.Y.val(t)))},end:function(t){return t.YEnd||(t.YEnd=e.date.prev(e.Y.val(t)))},next:function(t,n){return n>e.Y.val(t)&&n<=e.Y.extent()[1]?e.date.next(n):e.NEVER},prev:function(t,n){return n<e.Y.val(t)&&n>=e.Y.extent()[0]?e.date.prev(n):e.NEVER}},e.fullDate=e.fd={name:"full date",range:1,val:function(e){return e.fd||(e.fd=e.getTime())},isValid:function(t,n){return e.fd.val(t)===n},extent:function(){return[0,3250368e7]},start:function(e){return e},end:function(e){return e},next:function(t,n){return e.fd.val(t)<n?new Date(n):e.NEVER},prev:function(t,n){return e.fd.val(t)>n?new Date(n):e.NEVER}},e.modifier={},e.modifier.after=e.modifier.a=function(e,t){var n=t[0];return{name:"after "+e.name,range:(e.extent(new Date)[1]-n)*e.range,val:e.val,isValid:function(e,t){return this.val(e)>=n},extent:e.extent,start:e.start,end:e.end,next:function(t,r){return r!=n&&(r=e.extent(t)[0]),e.next(t,r)},prev:function(t,r){return r=r===n?e.extent(t)[1]:n-1,e.prev(t,r)}}},e.modifier.before=e.modifier.b=function(e,t){var n=t[t.length-1];return{name:"before "+e.name,range:e.range*(n-1),val:e.val,isValid:function(e,t){return this.val(e)<n},extent:e.extent,start:e.start,end:e.end,next:function(t,r){return r=r===n?e.extent(t)[0]:n,e.next(t,r)},prev:function(t,r){return r=r===n?n-1:e.extent(t)[1],e.prev(t,r)}}},e.compile=function(t){var n,r=[],s=0;for(var a in t){var i=a.split("_"),o=i[0],l=i[1],c=t[a],d=l?e.modifier[l](e[o],c):e[o];r.push({constraint:d,vals:c}),s++}return r.sort((function(e,t){var n=e.constraint.range,r=t.constraint.range;return r<n?-1:r>n?1:0})),n=r[s-1].constraint,{start:function(t,a){for(var i,o=a,l=e.array[t],c=1e3;c--&&!i&&o;){i=!0;for(var d=0;d<s;d++){var u=r[d].constraint,h=u.val(o),g=u.extent(o),m=l(h,r[d].vals,g);if(!u.isValid(o,m)){o=u[t](o,m),i=!1;break}}}return o!==e.NEVER&&(o="next"===t?n.start(o):n.end(o)),o},end:function(t,n){for(var a,i=e.array[t+"Invalid"],o=function(e){return"next"===e?function(e,t){return e.getTime()>t.getTime()}:function(e,t){return t.getTime()>e.getTime()}}(t),l=s-1;l>=0;l--){var c,d=r[l].constraint,u=d.val(n),h=d.extent(n),g=i(u,r[l].vals,h);void 0!==g&&(!(c=d[t](n,g))||a&&!o(a,c)||(a=c))}return a},tick:function(t,r){return new Date("next"===t?n.end(r).getTime()+e.SEC:n.start(r).getTime()-e.SEC)},tickSafe:function(e,t){return"next"===e?T(n.end(t),1):T(n.start(t),-1)},tickStart:function(e){return n.start(e)}}},e.schedule=function(t){if(!t)throw new Error("Missing schedule definition.");if(!t.schedules)throw new Error("Definition must include at least one schedule.");for(var n=[],r=t.schedules.length,s=[],a=t.exceptions?t.exceptions.length:0,i=0;i<r;i++)n.push(e.compile(t.schedules[i]));for(var o=0;o<a;o++)s.push(e.compile(t.exceptions[o]));function l(t,r,i,o,l){var S,D,C,R=f(t),E=r,I=1e6,T=[],x=[],b=[],M="next"===t,A=M?0:1,w=M?1:0;if(!(i=i?new Date(i):new Date)||!i.getTime())throw new Error("Invalid start date.");for(!function(e,t,n,r){for(var s=0,a=t.length;s<a;s++)n[s]=t[s].start(e,r)}(t,n,T,i),function(t,n,r,s){for(var a=0,i=n.length;a<i;a++){var o=n[a].start(t,s);r[a]=o?[o,n[a].end(t,o)]:e.NEVER}}(t,s,x,i);I--&&E&&(S=y(T,R))&&(!o||!R(S,o));)if(a&&(u(t,s,x,S),D=m(t,x,S)))d(t,n,T,D);else{if(l){var j=v(x,R);D=p(t,n,T,S,j);var O=M?[new Date(Math.max(i,S)),D?new Date(o?Math.min(D,o):D):void 0]:[D?new Date(o?Math.max(o,D.getTime()+e.SEC):D.getTime()+e.SEC):void 0,new Date(Math.min(i,S.getTime()+e.SEC))];if(C&&O[A].getTime()===C[w].getTime()?(C[w]=O[w],E++):(C=O,b.push(C)),!D)break;d(t,n,T,D)}else b.push(M?new Date(Math.max(i,S)):g(n,T,S,o)),h(t,n,T,S);E--}for(var F=0,P=b.length;F<P;F++){var k=b[F];b[F]="[object Array]"===Object.prototype.toString.call(k)?[c(k[0]),c(k[1])]:c(k)}return 0===b.length?e.NEVER:1===r?b[0]:b}function c(e){if(e instanceof Date&&!isNaN(e.valueOf()))return new Date(e)}function d(e,t,n,r){for(var s=f(e),a=0,i=t.length;a<i;a++)n[a]&&!s(n[a],r)&&(n[a]=t[a].start(e,r))}function u(t,n,r,s){for(var a=f(t),i=0,o=n.length;i<o;i++)if(r[i]&&!a(r[i][0],s)){var l=n[i].start(t,s);r[i]=l?[l,n[i].end(t,l)]:e.NEVER}}function h(t,n,r,s){for(var a=0,i=n.length;a<i;a++)if(r[a]&&r[a].getTime()===s.getTime()){const i=n[a].start(t,n[a].tick(t,s));i!==e.NEVER&&i.getTime()===r[a].getTime()?r[a]=n[a].start(t,n[a].tickSafe(t,s)):r[a]=i}}function g(e,t,n,r){for(var s,a=0,i=t.length;a<i;a++)if(t[a]&&t[a].getTime()===n.getTime()){var o=e[a].tickStart(n);if(r&&o<r)return r;(!s||o>s)&&(s=o)}return s}function m(e,t,n){for(var r,s=f(e),a=0,i=t.length;a<i;a++){var o=t[a];!o||s(o[0],n)||o[1]&&!s(o[1],n)||r&&!s(o[1],r)||(r=o[1])}return r}function v(e,t){for(var n,r=0,s=e.length;r<s;r++)!e[r]||n&&!t(n,e[r][0])||(n=e[r][0]);return n}function p(e,t,n,r,s){for(var a,i=f(e),o=0,l=t.length;o<l;o++){var c=n[o];if(c&&c.getTime()===r.getTime()){var d=t[o].end(e,c);if(s&&(!d||i(d,s)))return s;a&&!i(d,a)||(a=d)}}return a}function f(e){return"next"===e?function(e,t){return!t||e.getTime()>t.getTime()}:function(e,t){return!e||t.getTime()>e.getTime()}}function y(e,t){for(var n=e[0],r=1,s=e.length;r<s;r++)e[r]&&t(n,e[r])&&(n=e[r]);return n}return{isValid:function(t){return l("next",1,t,t)!==e.NEVER},next:function(e,t,n){return l("next",e||1,t,n)},prev:function(e,t,n){return l("prev",e||1,t,n)},nextRange:function(e,t,n){return l("next",e||1,t,n,!0)},prevRange:function(e,t,n){return l("prev",e||1,t,n,!0)}}},e.setTimeout=function(t,n){var r,s=e.schedule(n);return t&&function e(){var n=Date.now(),a=s.next(2,n);if(!a[0])return void(r=void 0);var i=a[0].getTime()-n;i<1e3&&(i=a[1]?a[1].getTime()-n:1e3);r=i<2147483647?setTimeout(t,i):setTimeout(e,2147483647)}(),{isDone:function(){return!r},clear:function(){clearTimeout(r)}}},e.setInterval=function(t,n){if(t){var r=e.setTimeout((function a(){s||(t(),r=e.setTimeout(a,n))}),n),s=r.isDone();return{isDone:function(){return r.isDone()},clear:function(){s=!0,r.clear()}}}},e.date={},e.date.timezone=function(t){e.date.build=t?function(e,t,n,r,s,a){return new Date(e,t,n,r,s,a)}:function(e,t,n,r,s,a){return new Date(Date.UTC(e,t,n,r,s,a))};var n=t?"get":"getUTC",r=Date.prototype;e.date.getYear=r[n+"FullYear"],e.date.getMonth=r[n+"Month"],e.date.getDate=r[n+"Date"],e.date.getDay=r[n+"Day"],e.date.getHour=r[n+"Hours"],e.date.getMin=r[n+"Minutes"],e.date.getSec=r[n+"Seconds"],e.date.isUTC=!t},e.date.UTC=function(){e.date.timezone(!1)},e.date.localTime=function(){e.date.timezone(!0)},e.date.UTC(),e.SEC=1e3,e.MIN=60*e.SEC,e.HOUR=60*e.MIN,e.DAY=24*e.HOUR,e.WEEK=7*e.DAY,e.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],e.NEVER=0,e.date.next=function(t,n,r,s,a,i){return e.date.build(t,void 0!==n?n-1:0,void 0!==r?r:1,s||0,a||0,i||0)},e.date.nextRollover=function(t,n,r,s){var a=r.val(t),i=r.extent(t)[1];return(n||i)<=a||n>i?new Date(s.end(t).getTime()+e.SEC):s.start(t)},e.date.prev=function(t,n,r,s,a,i){var o=arguments.length;return n=o<2?11:n-1,r=o<3?e.D.extent(e.date.next(t,n+1))[1]:r,s=o<4?23:s,a=o<5?59:a,i=o<6?59:i,e.date.build(t,n,r,s,a,i)},e.date.prevRollover=function(e,t,n,r){return t>=n.val(e)||!t?r.start(r.prev(e,r.val(e)-1)):r.start(e)},e.parse={},e.parse.cron=function(e,t){var n={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},r={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},s={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function a(e,t,r){return isNaN(e)?n[e]||null:Math.min(+e+(t||0),r||9999)}function i(e,t,n,r,s){var a=n;for(e[t]||(e[t]=[]);a<=r;)e[t].indexOf(a)<0&&e[t].push(a),a+=s||1;e[t].sort((function(e,t){return e-t}))}function o(e,t,n,r){(t.d&&!t.dc||t.dc&&t.dc.indexOf(r)<0)&&(e.push(function(e){var t,n={};for(t in e)"dc"!==t&&"d"!==t&&(n[t]=e[t].slice(0));return n}(t)),t=e[e.length-1]),i(t,"d",n,n),i(t,"dc",r,r)}function l(e,t,r,s,l,c){var d,u,h=t.schedules,g=h[h.length-1];"L"===e&&(e=s-1),null!==(d=a(e,c,l))?i(g,r,d,d):null!==(d=a(e.replace("W",""),c,l))?function(e,t,r){var s={},a={};1===r?(i(t,"D",1,3),i(t,"d",n.MON,n.FRI),i(s,"D",2,2),i(s,"d",n.TUE,n.FRI),i(a,"D",3,3),i(a,"d",n.TUE,n.FRI)):(i(t,"D",r-1,r+1),i(t,"d",n.MON,n.FRI),i(s,"D",r-1,r-1),i(s,"d",n.MON,n.THU),i(a,"D",r+1,r+1),i(a,"d",n.TUE,n.FRI)),e.exceptions.push(s),e.exceptions.push(a)}(t,g,d):null!==(d=a(e.replace("L",""),c,l))?o(h,g,d,s-1):2===(u=e.split("#")).length?o(h,g,d=a(u[0],c,l),a(u[1])):function(e,t,n,r,s,o){var l=e.split("/"),c=+l[1],d=l[0];if("*"!==d&&"0"!==d){var u=d.split("-");r=a(u[0],o,s),s=a(u[1],o,s)||s}i(t,n,r,s,c)}(e,g,r,s,l,c)}function c(e){return e.indexOf("#")>-1||e.indexOf("L")>0}function d(e,t){return c(e)&&!c(t)?1:e-t}var u=function(e){var t=e.toUpperCase();return r[t]||t}(e);return function(e){var t,n,r,a,i={schedules:[{}],exceptions:[]},o=e.replace(/(\s)+/g," ").split(" ");for(t in s)if((r=o[(n=s[t])[0]])&&"*"!==r&&"?"!==r){var c,u=(a=r.split(",").sort(d)).length;for(c=0;c<u;c++)l(a[c],i,t,n[1],n[2],n[3])}return i}(t?u:"0 "+u)},e.parse.recur=function(){var t,n,r,s,a,i,o,l,c,d=[],u=[],h=d;function g(e,d,u){if(e=a?e+"_"+a:e,t||(h.push({}),t=h[0]),t[e]||(t[e]=[]),n=t[e],s){for(r=[],l=d;l<=u;l+=s)r.push(l);c={n:e,x:s,c:n.length,m:u}}var g=(r=i?[d]:o?[u]:r).length;for(l=0;l<g;l+=1){var m=r[l];n.indexOf(m)<0&&n.push(m)}r=s=a=i=o=0}return{schedules:d,exceptions:u,on:function(){return r=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(e){return s=e||1,this},after:function(e){return a="a",r=[e],this},before:function(e){return a="b",r=[e],this},first:function(){return i=1,this},last:function(){return o=1,this},time:function(){for(var e=0,t=r.length;e<t;e++){var n=r[e].split(":");n.length<3&&n.push(0),r[e]=3600*+n[0]+60*+n[1]+ +n[2]}return g("t"),this},second:function(){return g("s",0,59),this},minute:function(){return g("m",0,59),this},hour:function(){return g("h",0,23),this},dayOfMonth:function(){return g("D",1,o?0:31),this},dayOfWeek:function(){return g("d",1,7),this},onWeekend:function(){return r=[1,7],this.dayOfWeek()},onWeekday:function(){return r=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return g("dc",1,o?0:5),this},dayOfYear:function(){return g("dy",1,o?0:366),this},weekOfMonth:function(){return g("wm",1,o?0:5),this},weekOfYear:function(){return g("wy",1,o?0:53),this},month:function(){return g("M",1,12),this},year:function(){return g("Y",1970,2450),this},fullDate:function(){for(var e=0,t=r.length;e<t;e++)r[e]=r[e].getTime();return g("fd"),this},customModifier:function(t,n){var s=e.modifier[t];if(!s)throw new Error("Custom modifier "+t+" not recognized!");return a=t,r=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(t){var n=e[t];if(!n)throw new Error("Custom time period "+t+" not recognized!");return g(t,n.extent(new Date)[0],n.extent(new Date)[1]),this},startingOn:function(e){return this.between(e,c.m)},between:function(e,n){return t[c.n]=t[c.n].splice(0,c.c),s=c.x,g(c.n,e,n),this},and:function(){return t=h[h.push({})-1],this},except:function(){return h=u,t=null,this}}},e.parse.text=function(t){var n,r=e.parse.recur,s=0,a="",i={eof:/^$/,fullDate:/^(\d\d\d\d-\d\d-\d\dt\d\d:\d\d:\d\d)\b/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},o={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function l(e,t,n,r){return{startPos:e,endPos:t,text:n,type:r}}function c(e){var t,n,r,i,o,c,d=e instanceof Array?e:[e],u=/\s+/;for(d.push(u),o=s;!t||t.type===u;){c=-1,n=a.substring(o),t=l(o,o,a.split(u)[0]);var h,g=d.length;for(h=0;h<g;h++)(r=(i=d[h]).exec(n))&&0===r.index&&r[0].length>c&&(t=l(o,o+(c=r[0].length),n.substring(0,c),i));t.type===u&&(o=t.endPos)}return t}function d(e){var t=c(e);return s=t.endPos,t}function u(e){for(var t=+y(e),n=p(i.through)?+y(e):t,r=[],s=t;s<=n;s++)r.push(s);return r}function h(e){for(var t=u(e);p(i.and);)t=t.concat(u(e));return t}function g(e){var t,n,r,s;p(i.weekend)?e.on(o.sun,o.sat).dayOfWeek():p(i.weekday)?e.on(o.mon,o.tue,o.wed,o.thu,o.fri).dayOfWeek():(t=y(i.rank),e.every(t),n=v(e),p(i.start)?(t=y(i.rank),e.startingOn(t),f(n.type)):p(i.between)&&(r=y(i.rank),p(i.and)&&(s=y(i.rank),e.between(r,s))))}function m(e){p(i.first)?e.first():p(i.last)?e.last():e.on(h(i.rank)),v(e)}function v(e){var t=f([i.second,i.minute,i.hour,i.dayOfYear,i.dayOfWeek,i.dayInstance,i.day,i.month,i.year,i.weekOfMonth,i.weekOfYear]);switch(t.type){case i.second:e.second();break;case i.minute:e.minute();break;case i.hour:e.hour();break;case i.dayOfYear:e.dayOfYear();break;case i.dayOfWeek:e.dayOfWeek();break;case i.dayInstance:e.dayOfWeekCount();break;case i.day:e.dayOfMonth();break;case i.weekOfMonth:e.weekOfMonth();break;case i.weekOfYear:e.weekOfYear();break;case i.month:e.month();break;case i.year:e.year();break;default:n=s}return t}function p(e){var t=c(e).type===e;return t&&d(e),t}function f(e){var t=d(e);return t.type?t.text=function(e,t){var n=e;switch(t){case i.time:var r=e.split(/(:|am|pm)/),s="pm"===r[3]&&r[0]<12?parseInt(r[0],10)+12:r[0],a=r[2].trim();n=(1===s.length?"0":"")+s+":"+a;break;case i.rank:n=parseInt(/^\d+/.exec(e)[0],10);break;case i.monthName:case i.dayName:n=o[e.substring(0,3)];break;case i.fullDate:n=new Date(e.toUpperCase())}return n}(t.text,e):n=s,t}function y(e){return f(e).text}return function(e){s=0,a=e,n=-1;for(var t=r();s<a.length&&n<0;){switch(f([i.every,i.after,i.before,i.onthe,i.on,i.of,i.in,i.at,i.and,i.except,i.also]).type){case i.every:g(t);break;case i.after:void 0!==c(i.time).type?(t.after(y(i.time)),t.time()):void 0!==c(i.fullDate).type?(t.after(y(i.fullDate)),t.fullDate()):(t.after(y(i.rank)),v(t));break;case i.before:void 0!==c(i.time).type?(t.before(y(i.time)),t.time()):void 0!==c(i.fullDate).type?(t.before(y(i.fullDate)),t.fullDate()):(t.before(y(i.rank)),v(t));break;case i.onthe:m(t);break;case i.on:t.on(h(i.dayName)).dayOfWeek();break;case i.of:t.on(h(i.monthName)).month();break;case i.in:t.on(h(i.yearIndex)).year();break;case i.at:for(t.on(y(i.time)).time();p(i.and);)t.on(y(i.time)).time();break;case i.and:break;case i.also:t.and();break;case i.except:t.except();break;default:n=s}}return{schedules:t.schedules,exceptions:t.exceptions,error:n}}(t.toLowerCase())},e}();function b(e){const t=[],n=[];let r;return[function*(){for(r||(r=e[Symbol.iterator]());t.length&&(yield*t,t.length=0),r;){const{value:t,done:s}=r.next();if(s){r=null,e=null;break}n.push(t),yield t}}(),function*(){for(r||(r=e[Symbol.iterator]());n.length&&(yield*n,n.length=0),r;){const{value:n,done:s}=r.next();if(s){r=null,e=null;break}t.push(n),yield n}}()]}function*M(e,t){let n=0;for(const r of e)yield t(r,n++)}function*A(e){const t=new Set;for(const n of e)t.has(n)||(t.add(n),yield n)}function*w(...e){for(let t=0;t<e.length;t++)yield*e[t]}function*j(e){for(const t of e)yield*t}x.date.localTime();class O{constructor(e){if(this.iterable=void 0,!e)throw new Error("Require an iterable instance for chaining");this.iterable=e}derive(e){return this.iterable=void 0,new O(e)}copy(){const[e,t]=b(this.iterable);return this.iterable=t,new O(e)}split(){const[e,t]=b(this.iterable);return[new O(e),this.derive(t)]}inBatchesBySize(e){return this.derive(function*(e,t){if(t<0)throw new Error("Batch size needs to a natural number");t|=0;const n=[];for(const r of e)n.length===t&&(yield n,n.length=0),n.push(r);n.length>0&&(yield n)}(this.iterable,e))}filter(e){return this.derive(function*(e,t){let n=0;for(const r of e)t(r,n++)&&(yield r)}(this.iterable,e))}drop(e){return this.derive(function*(e,t){let n=0;for(const r of e)++n>t&&(yield r)}(this.iterable,e))}map(e){return this.derive(M(this.iterable,e))}reduce(e,t){return function(e,t,n){let r=0,s=n;for(const n of e)s=t(s,n,r++);return s}(this,e,t)}concat(){return this.derive(j(this.iterable))}uniqueOnly(){return this.derive(A(this.iterable))}uniqueOnlyBy(e){return this.derive(function*(e,t){const n=new Set;for(const r of e){const e=t(r);n.has(e)||(n.add(e),yield r)}}(this.iterable,e))}every(e){return function(e,t){let n=0;for(const r of e)if(!t(r,n++))return!1;return!0}(this,e)}some(e){return function(e,t){let n=0;for(const r of e)if(t(r,n++))return!0;return!1}(this,e)}takeWhile(e){return this.derive(function*(e,t){let n=0;for(const r of e){if(!t(r,n++))return;yield r}}(this.iterable,e))}*[Symbol.iterator](){let e=this.iterable;if(!e)throw new Error("Chained iterator already exhausted or used to derive the new one");this.iterable=void 0,yield*e,e=void 0}toArray(){return Array.from(this)}sort(e){return Array.from(this).sort(e)}toSet(){return new Set(this)}toMap(){return new Map(this)}flush(){for(const e of this);}memoize(){return new P(this)}}const F=e=>new O(e);class P extends O{constructor(){super(...arguments),this.elements=[],this.$iterator=void 0}set iterable(e){this.$iterable=e}get iterable(){return this}derive(e){return new O(e)}*[Symbol.iterator](){const e=this.elements;if(this.$iterable){this.$iterator||(this.$iterator=this.$iterable[Symbol.iterator]());let t=this.$iterator,n=e.length;for(n>0&&(yield*e);;){if(e.length>n){for(let t=n;t<e.length;t++)yield e[t];n=e.length}if(!t)break;const{value:r,done:s}=t.next();s?(t=this.$iterator=null,this.$iterable=null):(e.push(r),n++,yield r)}}else yield*e}}const k=e=>new P(e),$=Symbol("MixinIdentity"),N=Symbol("MixinStateProperty");let L=1;const B=e=>class extends e{};class q{}class _{constructor(){this.id=L++,this.requirements=[],this.baseClass=q,this.identitySymbol=void 0,this.mixinLambda=B,this.walkDepthState=void 0,this.$minimalClass=void 0,this.name=""}static new(e){const t=new this;e&&Object.assign(t,e),t.walkDepthState=class{constructor(){this.baseEl=void 0,this.sourceEl=void 0,this.$elementsByTopoLevel=void 0,this.$topoLevels=void 0,this.linearizedByTopoLevelsSource=k(this.linearizedByTopoLevels())}static new(e){const t=new this;return e&&Object.assign(t,e),t}get topoLevels(){return void 0!==this.$topoLevels?this.$topoLevels:this.$topoLevels=this.buildTopoLevels()}buildTopoLevels(){return Array.from(this.elementsByTopoLevel.keys()).sort(((e,t)=>e-t))}get elementsByTopoLevel(){return void 0!==this.$elementsByTopoLevel?this.$elementsByTopoLevel:this.$elementsByTopoLevel=this.buildElementsByTopoLevel()}getOrCreateLevel(e,t){let n=e.get(t);return n||(n=[],e.set(t,n)),n}buildElementsByTopoLevel(){let e=0;const t=this.baseEl?F(this.baseEl.walkDepthState.elementsByTopoLevel.values()).concat().toSet():new Set,n=F(this.sourceEl.requirements).map((e=>e.walkDepthState.elementsByTopoLevel)).concat().reduce(((t,[n,r])=>(n>e&&(e=n),this.getOrCreateLevel(t,n).push(r),t)),new Map);return this.getOrCreateLevel(n,e+1).push([this.sourceEl]),F(n).map((([e,n])=>[e,F(n).concat().uniqueOnly().filter((e=>!t.has(e))).sort(((e,t)=>e.id-t.id))])).toMap()}*linearizedByTopoLevels(){yield*F(this.topoLevels).map((e=>this.elementsByTopoLevel.get(e))).concat()}}.new({sourceEl:t,baseEl:V(t.baseClass)});const n=t.mixinLambda,r=t.identitySymbol=Symbol(n.name),s=Object.assign((function(e){const t=n(e);return t.prototype[r]=!0,t}),{[$]:r,[N]:t});return Object.defineProperty(s,Symbol.hasInstance,{value:U}),t.mixinLambda=s,t}get minimalClass(){return void 0!==this.$minimalClass?this.$minimalClass:this.$minimalClass=this.buildMinimalClass()}getBaseClassMixinId(e){const t=this.constructor,n=t.baseClassesIds.get(e);if(void 0!==n)return n;const r=L++;return t.baseClassesIds.set(e,r),r}buildMinimalClass(){const e=this.constructor;let t=this.baseClass;const n=this.walkDepthState.linearizedByTopoLevelsSource.reduce(((t,n)=>{const{cls:r,hash:s}=t,a=s+String.fromCharCode(n.id);let i=e.minimalClassesByLinearHash.get(a);return i||(i=n.mixinLambda(r),n.name=i.name,e.minimalClassesByLinearHash.set(a,i)),t.cls=i,t.hash=a,t}),{cls:t,hash:String.fromCharCode(this.getBaseClassMixinId(t))}).cls,r=Object.assign(n,{[$]:this.identitySymbol,[N]:this,mix:this.mixinLambda,derive:e=>z([r,e],(e=>class extends e{})),$:this,toString:this.toString.bind(this)});return Object.defineProperty(r,Symbol.hasInstance,{value:U}),r}toString(){return this.walkDepthState.linearizedByTopoLevelsSource.reduce(((e,t)=>`${t.name}(${e})`),this.baseClass.name)}}_.minimalClassesByLinearHash=new Map,_.baseClassesIds=new Map;const V=e=>Object.getPrototypeOf(e.prototype).constructor[N],Y=(e,t)=>{let n;if(e.length>0){const t=e[e.length-1];r=t,Object.getPrototypeOf(r.prototype).constructor.hasOwnProperty(N)||t===q||(n=t)}var r;const s=[];e.forEach(((t,r)=>{const a=t[N];if(void 0!==a){const e=a.baseClass;if(e!==q)if(n){if(n!==e){const t=e.prototype.isPrototypeOf(n.prototype),r=n.prototype.isPrototypeOf(e.prototype);if(!t&&!r)throw new Error("Base class mismatch");n=r?e:n}}else n=e;s.push(a)}else if(r!==e.length-1)throw new Error("Base class should be provided as the last element of the requirements array")}));return _.new({requirements:s,mixinLambda:t,baseClass:n||q}).minimalClass},U=function(e){return Boolean(e&&e[this[$]])},W=(e,t)=>Boolean(e&&e[t[$]]),z=Y,K=Y;var H,Z,J,G,Q,X,ee,te,ne;!function(e){e.Millisecond="millisecond",e.Second="second",e.Minute="minute",e.Hour="hour",e.Day="day",e.Week="week",e.Month="month",e.Quarter="quarter",e.Year="year"}(H||(H={})),function(e){e.MustStartOn="muststarton",e.MustFinishOn="mustfinishon",e.StartNoEarlierThan="startnoearlierthan",e.StartNoLaterThan="startnolaterthan",e.FinishNoEarlierThan="finishnoearlierthan",e.FinishNoLaterThan="finishnolaterthan"}(Z||(Z={})),function(e){e.Normal="Normal",e.FixedDuration="FixedDuration",e.FixedEffort="FixedEffort",e.FixedUnits="FixedUnits"}(J||(J={})),function(e){e[e.NoError=0]="NoError",e[e.CyclicDependency=1]="CyclicDependency",e[e.DuplicatingDependency=2]="DuplicatingDependency"}(G||(G={})),function(e){e[e.StartToStart=0]="StartToStart",e[e.StartToEnd=1]="StartToEnd",e[e.EndToStart=2]="EndToStart",e[e.EndToEnd=3]="EndToEnd"}(Q||(Q={})),function(e){e.Project="Project",e.FromEvent="FromEvent",e.ToEvent="ToEvent"}(X||(X={})),function(e){e[e.SchedulerBasic=1]="SchedulerBasic",e[e.SchedulerPro=2]="SchedulerPro",e[e.Gantt=3]="Gantt"}(ee||(ee={})),function(e){e.Forward="Forward",e.Backward="Backward",e.None="None"}(te||(te={})),function(e){e.Start="Start",e.End="End"}(ne||(ne={}));const re=new Date(-864e13),se=new Date(864e13),ae=e=>{if(!e)return!1;const t=e.getTime();return t!==re.getTime()&&t!==se.getTime()};var ie,oe;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(ie||(ie={})),function(e){e[e.FullRangeIterated=0]="FullRangeIterated",e[e.StoppedByIterator=1]="StoppedByIterator",e[e.MaxCacheExtendCyclesReached=2]="MaxCacheExtendCyclesReached",e[e.MaxRangeReached=3]="MaxRangeReached"}(oe||(oe={}));class le{constructor(e){this.cacheFilledStartDate=se,this.cacheFilledEndDate=re,this.intervalsCachingChunkDuration=30,this.intervalsCachingChunkUnit=H.Day,this.maxCacheExtendCycles=1e3,this.maxRange=15768e7,e&&Object.assign(this,e)}includeWrappingRangeFrom(e,t,n){e.ensureCacheFilledForInterval(t,n),this.intervalCache.includeWrappingRange(e.intervalCache,t,n)}ensureCacheFilledForInterval(e,t){const n=this.cacheFilledStartDate.getTime(),r=this.cacheFilledEndDate.getTime();if(n!==se.getTime()){const s=e.getTime(),a=t.getTime();if(n<=s&&a<=r)return;if(a<=n)t=new Date(n-1);else if(s>=r)e=new Date(r+1);else if(n<=s&&s<=r)e=new Date(r+1);else{if(!(n<=a&&a<=r))return this.ensureCacheFilledForInterval(e,new Date(n-1)),void this.ensureCacheFilledForInterval(new Date(r+1),t);t=new Date(n-1)}}(n===se.getTime()||e.getTime()<r)&&(this.cacheFilledStartDate=e),(r===re.getTime()||r<t.getTime())&&(this.cacheFilledEndDate=t),this.fillCache(e,t)}fillCache(e,t){throw new Error("Abstract method")}clear(){this.cacheFilledStartDate=se,this.cacheFilledEndDate=re,this.intervalCache.clear()}forEachAvailabilityInterval(t,n,r){var s;r=r||this;const a=t.startDate,i=t.endDate,o=a&&a.getTime(),l=i&&i.getTime(),c=null!==(s=t.maxRange)&&void 0!==s?s:this.maxRange,d=!1!==t.isForward;if(d?!a:!i)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");const u=this.intervalCache;let h=d?a:i,g=d?a:i;const m=g.getTime();for(let t=1;t<this.maxCacheExtendCycles;t++){d?this.ensureCacheFilledForInterval(h,i||e.add(h,this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit)):this.ensureCacheFilledForInterval(a||e.add(h,-this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit),h);let t=u.getIntervalOf(g,d?ie.Left:ie.Right);for(;t;){const e=t.startDate,s=t.endDate;if(d&&l&&e.getTime()>=l||!d&&o&&s.getTime()<=o)return oe.FullRangeIterated;if(d&&e.getTime()-m>=c||!d&&m-s.getTime()>=c)return oe.MaxRangeReached;if(d&&e.getTime()>this.cacheFilledEndDate.getTime()||!d&&s.getTime()<this.cacheFilledStartDate.getTime())break;g=d?s:e;const h=o&&e.getTime()<o?a:e,v=l&&s.getTime()>l?i:s;if(!1===n.call(r,h,v,t.cacheInterval))return oe.StoppedByIterator;t=d?u.getNextInterval(t):u.getPrevInterval(t)}if(d&&g.getTime()===se.getTime()||!d&&g.getTime()===re.getTime())return oe.FullRangeIterated;h=d?this.cacheFilledEndDate:this.cacheFilledStartDate}return oe.MaxCacheExtendCyclesReached}}const ce=e=>Array.from(new Set(e));class de{constructor(e){if(this.intervals=[],e&&Object.assign(this,e),!this.calendar)throw new Error("Required attribute `calendar` is missing")}includeInterval(e){if(-1==this.intervals.indexOf(e)){const t=this.intervals.slice();return t.push(e),new de({intervals:t,calendar:this.calendar})}return this}combineWith(e){return new de({intervals:this.intervals.concat(e.intervals),calendar:this.calendar})}getIsWorking(){if(null!=this.isWorking)return this.isWorking;const e=this.intervals=this.normalizeIntervals(this.intervals);return this.isWorking=e[0].isWorking}normalizeIntervals(e){const t=ce(e);return t.sort(((e,t)=>t.getPriorityField()-e.getPriorityField())),t}}const ue=(e,t,n=((e,t)=>e-t))=>{let r=0,s=t.length;for(;r<s;){const a=(r+s)/2|0,i=n(e,t[a]);if(0===i)return{found:!0,index:a};i<0?s=a:r=a+1}return{found:!1,index:s}};var he;!function(e){e[e.Exact=0]="Exact",e[e.Next=1]="Next"}(he||(he={}));class ge{constructor(e){this.keys=[],this.values=[],this.comparator=e||((e,t)=>e-t)}set(e,t){const n=ue(e,this.keys,this.comparator);return n.found?this.values[n.index]=t:(this.keys.splice(n.index,0,e),this.values.splice(n.index,0,t)),n.index}insertAt(e,t,n){this.keys.splice(e,0,t),this.values.splice(e,0,n)}setValueAt(e,t){this.values[e]=t}get(e){const t=ue(e,this.keys,this.comparator);return t.found?this.values[t.index]:void 0}getEntryAt(e){return e<this.keys.length?{key:this.keys[e],value:this.values[e]}:void 0}getKeyAt(e){return this.keys[e]}getValueAt(e){return this.values[e]}delete(e){const t=ue(e,this.keys,this.comparator);t.found&&this.deleteAt(t.index)}size(){return this.keys.length}deleteAt(e){this.keys.splice(e,1),this.values.splice(e,1)}indexOfKey(e){const t=ue(e,this.keys,this.comparator);return{found:t.found?he.Exact:he.Next,index:t.index}}map(e){const t=this.keys,n=this.values,r=[];for(let s=0;s<t.length;s++)r.push(e(n[s],t[s],s));return r}getAllEntries(){return this.map(((e,t)=>({value:e,key:t})))}clear(){this.keys.length=0,this.values.length=0}}class me{constructor(e){if(this.points=new ge(((e,t)=>e.getTime()-t.getTime())),this.leftInfinityKey=re,this.rightInfinityKey=se,Object.assign(this,e),void 0===this.emptyInterval||!this.combineIntervalsFn)throw new Error("All of `emptyPoint`, `combineIntervalsFn` are required");this.points.set(this.leftInfinityKey,this.emptyInterval)}size(){return this.points.size()}indexOf(e){return this.points.indexOfKey(e)}getDateAt(e){return this.points.getKeyAt(e)}getPointAt(e){return this.points.getValueAt(e)}getIntervalOf(e,t=ie.Left){let n,{found:r,index:s}=this.indexOf(e);return n=t===ie.Left&&r===he.Exact?s:s-1,this.getIntervalWithStartDateIndex(n)}getPrevInterval(e){return 0===e.startDateIndex?null:this.getIntervalWithStartDateIndex(e.startDateIndex-1)}getNextInterval(e){return e.startDateIndex>=this.size()-1?null:this.getIntervalWithStartDateIndex(e.startDateIndex+1)}getIntervalWithStartDateIndex(e){return{startDateIndex:e,startDate:this.getDateAt(e),endDate:e+1<this.size()?this.getDateAt(e+1):this.rightInfinityKey,cacheInterval:this.getPointAt(e)}}addInterval(e,t,n){const r=this.points,{found:s,index:a}=r.indexOfKey(e);let i,o;if(s==he.Exact){const e=n(o=r.getValueAt(a));r.setValueAt(a,e),i=a+1}else{const t=n(o=r.getValueAt(a-1));r.insertAt(a,e,t),i=a+1}for(;i<r.size();){if(r.getKeyAt(i).getTime()>=t.getTime())break;const e=n(o=r.getValueAt(i));r.setValueAt(i,e),i++}if(i===r.size())r.insertAt(r.size(),t,this.emptyInterval);else{r.getKeyAt(i).getTime()===t.getTime()||r.insertAt(i,t,o)}}includeWrappingRange(e,t,n){let r=e.getIntervalOf(t);for(;r&&(this.addInterval(r.startDate,r.endDate,(e=>this.combineIntervalsFn(e,r.cacheInterval))),!(r.endDate.getTime()>n.getTime()));)r=e.getNextInterval(r)}getSummary(){return this.points.map(((e,t)=>({label:e,date:t})))}clear(){this.points.clear(),this.points.set(this.leftInfinityKey,this.emptyInterval)}}class ve extends le{constructor(e){if(super(e),this.staticIntervalsCached=!1,!this.unspecifiedTimeInterval)throw new Error("Required attribute `unspecifiedTimeInterval` is missing");this.intervalCache=new me({emptyInterval:new de({intervals:[this.unspecifiedTimeInterval],calendar:this.calendar}),combineIntervalsFn:(e,t)=>e.combineWith(t)})}fillCache(n,r){var s;this.staticIntervalsCached||(this.cacheStaticIntervals(),this.staticIntervalsCached=!0),this.parentCache&&this.includeWrappingRangeFrom(this.parentCache,n,r);const a=n.getTime(),i=r.getTime(),o=null===(s=this.calendar.project)||void 0===s?void 0:s.timeZone;if(a>i)throw new Error("Invalid cache fill interval");this.forEachRecurrentInterval((s=>{const l=s.getStartDateSchedule(),c=s.getEndDateSchedule();let d,u=l.prev(1,n);if("EOD"===c){const t=l.next(1,r);d=t!==x.NEVER?e.getStartOfNextDay(t,!0):x.NEVER}else d=c.next(1,r);if(u!==x.NEVER&&u.getTime()===a){const e=l.prev(2,n);e!==x.NEVER&&2===e.length&&(u=e[1])}if(d!==x.NEVER&&d.getTime()===i){const e=c.next(2,r);e!==x.NEVER&&2===e.length&&(d=e[1])}const h=l.next(1/0,u!==x.NEVER?u:n,d!==x.NEVER?new Date(d.getTime()-1):r);if(h===x.NEVER)return;const g="EOD"===c?h.map((t=>e.getStartOfNextDay(t,!0))):c.next(1/0,new Date(h[0].getTime()+1),d!==x.NEVER?d:r);g!==x.NEVER&&(g.length>h.length?g.length=h.length:g.length<h.length&&(h.length=g.length),h.forEach(((e,n)=>{let r=e,a=g[n];null!=o&&(r=t.toTimeZone(r,o),a=t.toTimeZone(a,o)),this.intervalCache.addInterval(r,a,(e=>e.includeInterval(s)))})))}))}clear(){this.staticIntervalsCached=!1,super.clear()}cacheStaticIntervals(){this.forEachStaticInterval((e=>{var n;const r=null===(n=this.calendar.project)||void 0===n?void 0:n.timeZone;let{startDate:s,endDate:a}=e;null!=r&&(s=t.toTimeZone(s,r),a=t.toTimeZone(a,r)),this.intervalCache.addInterval(s,a,(t=>t.includeInterval(e)))}))}forEachStaticInterval(e){this.intervalStore.forEach((t=>{t.isStatic()&&e(t)}))}forEachRecurrentInterval(e){this.intervalStore.forEach((t=>{t.isRecurrent()&&e(t)}))}}class pe extends(z([],(e=>{e.prototype;return class extends e{async commitAsync(){return this.project.commitAsync()}set project(e){this.$project=e}get project(){return this.$project}calculateProject(){throw new Error("Implement me")}setProject(e){return this.project=e}getProject(){return this.project?this.project:this.setProject(this.calculateProject())}getAssignmentStore(){const e=this.getProject();return null==e?void 0:e.assignmentStore}getDependencyStore(){const e=this.getProject();return null==e?void 0:e.dependencyStore}getEventStore(){const e=this.getProject();return null==e?void 0:e.eventStore}getResourceStore(){const e=this.getProject();return null==e?void 0:e.resourceStore}getCalendarManagerStore(){const e=this.getProject();return null==e?void 0:e.calendarManagerStore}}}))){}class fe extends(z([pe,n],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.isLoadingData=!1,this.disableHasLoadedDataToCommitFlag=!1}construct(e={}){return e.asyncEvents={add:!0,remove:!0,removeAll:!0,change:!0,refresh:!0,replace:!0,move:!0,update:!0},t.construct.call(this,e)}trigger(e,n){const s=this,{asyncEvents:a,project:i}=s,o=null==a?void 0:a[e];return o&&(!0===o||o[n.action])?(t.trigger.call(s,`${e}PreCommit`,r({},n)),!i||i.isEngineReady()&&!i.isWritingData?t.trigger.call(s,e,n):!s.eventsSuspended&&i&&(i.dataReadyDetacher||(i.queuedDataReadyEvents=[],i.dataReadyDetacher=i.ion({dataReady(){this.queuedDataReadyEvents.forEach((([e,t,n,r])=>{e.trigger.call(t,n,r)})),i.queuedDataReadyEvents=null,i.dataReadyDetacher(),i.dataReadyDetacher=null},once:!0})),i.queuedDataReadyEvents.push([t,s,e,n])),!0):t.trigger.call(s,e,n)}calculateProject(){return this.project}setStoreData(e){var n;!this.project||this.syncDataOnLoad||this.disableHasLoadedDataToCommitFlag||(this.project.hasLoadedDataToCommit=!0),this.isLoadingData=!0,t.setStoreData.call(this,e),this.isLoadingData=!1,null===(n=this.project)||void 0===n||n.trigger("storeRefresh",{store:this})}async doAutoCommit(){this.suspendCount<=0&&this.project&&!this.project.isEngineReady()&&await this.project.commitAsync(),t.doAutoCommit.call(this)}async addAsync(e,t){const n=this.add(e,t);return await this.project.commitAsync(),n}async insertAsync(e,t,n){const r=this.insert(e,t,n);return await this.project.commitAsync(),r}async loadDataAsync(e){this.data=e,await this.project.commitAsync()}}}))){}class ye extends(z([pe,s],(e=>{const t=e.prototype;return class extends e{joinStore(e){let n=null;if(W(e,fe)){const t=e.getProject();t&&!this.getProject()&&(this.setProject(t),n=t)}t.joinStore.call(this,e),n&&!n.isRepopulatingStores&&this.joinProject()}unjoinStore(e,n=!1){t.unjoinStore.call(this,e,n);const r=this.getProject(),s=W(e,fe)&&r===e.getProject();r&&!r.isDestroying&&!r.isRepopulatingStores&&s&&(this.leaveProject(n),this.setProject(null)),s&&(this.graph=null)}joinProject(){}leaveProject(e=!1){}calculateProject(){const e=this.stores.find((e=>W(e,fe)&&!!e.getProject()));return null==e?void 0:e.getProject()}async setAsync(e,t,n){var r;const s=this.set(e,t,n);return await(null===(r=this.project)||void 0===r?void 0:r.commitAsync()),s}async getAsync(e){var t;return await(null===(t=this.project)||void 0===t?void 0:t.commitAsync()),this.get(e)}get isStmRestoring(){const e=this.getProject();return(null==e?void 0:e.isRestoringData)||(null==e?void 0:e.stm.isRestoring)||!1}}}))){}class Se extends(z([ye],(e=>{e.prototype;return class extends e{static get fields(){return["name",{name:"startDate",type:"date"},{name:"endDate",type:"date"},"recurrentStartDate","recurrentEndDate","cls","iconCls",{name:"isWorking",type:"boolean",defaultValue:!1},{name:"priority",type:"number"}]}getCalendar(){return this.stores[0].calendar}resetPriority(){this.priorityField=null,this.getCalendar().getDepth()}getPriorityField(){if(null!=this.priorityField)return this.priorityField;let e=1e4+100*this.getCalendar().getDepth(),t=this.priority;return null==t&&(t=this.isRecurrent()?20:30),this.priorityField=e+t}isRecurrent(){return Boolean(this.recurrentStartDate&&this.recurrentEndDate&&this.getStartDateSchedule()&&this.getEndDateSchedule())}isStatic(){return Boolean(this.startDate&&this.endDate)}parseDateSchedule(e){let t=e;if(e&&e!==Object(e)&&(t=x.parse.text(e),t!==Object(t)||t.error>=0))try{t=JSON.parse(e)}catch(e){return null}return t}getStartDateSchedule(){if(this.startDateSchedule)return this.startDateSchedule;const e=this.parseDateSchedule(this.recurrentStartDate);return this.startDateSchedule=x.schedule(e)}getEndDateSchedule(){if(this.endDateSchedule)return this.endDateSchedule;if("EOD"===this.recurrentEndDate)return"EOD";const e=this.parseDateSchedule(this.recurrentEndDate);return this.endDateSchedule=x.schedule(e)}}}))){}class De extends(z([fe],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.disableHasLoadedDataToCommitFlag=!0}static get defaultConfig(){return{modelClass:Se}}}}))){}class Ce extends(z([Se],(e=>{e.prototype;return class extends e{getCalendar(){return this.calendar}getPriorityField(){return null!=this.priorityField?this.priorityField:this.priorityField=this.getCalendar().getDepth()}}}))){}class Re extends(z([pe],(e=>{e.prototype;return class extends e{get eventStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.eventStore}get resourceStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.resourceStore}get assignmentStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.assignmentStore}get dependencyStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.dependencyStore}get calendarManagerStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.calendarManagerStore}getEventById(e){var t;return null===(t=this.eventStore)||void 0===t?void 0:t.getById(e)}getDependencyById(e){var t;return null===(t=this.dependencyStore)||void 0===t?void 0:t.getById(e)}getResourceById(e){var t;return null===(t=this.resourceStore)||void 0===t?void 0:t.getById(e)}getAssignmentById(e){var t;return null===(t=this.assignmentStore)||void 0===t?void 0:t.getById(e)}getCalendarById(e){var t;return null===(t=this.calendarManagerStore)||void 0===t?void 0:t.getById(e)}}}))){}class Ee extends(z([ye],(t=>{const n=t.prototype;return class extends t{constructor(){super(...arguments),this.version=1}static get fields(){return[{name:"version",type:"number"},"name",{name:"unspecifiedTimeIsWorking",type:"boolean",defaultValue:!0},{name:"intervals",type:"store",subStore:!0},"cls","iconCls"]}get intervalStoreClass(){return De}get intervalStore(){return this.meta.intervalsStore}initIntervalsStore(e){e.storeClass=this.intervalStoreClass,e.modelClass=this.getDefaultConfiguration().calendarIntervalModelClass||this.intervalStoreClass.defaultConfig.modelClass,e.calendar=this}processIntervalsStoreData(e){this.bumpVersion()}isDefault(){const e=this.getProject();return!!e&&this===e.defaultCalendar}getDepth(){return this.childLevel+1}forEachAvailabilityInterval(e,t,n){const r=this.getProject().maxCalendarRange;return r&&(e=Object.assign({maxRange:r},e)),this.calendarCache.forEachAvailabilityInterval(e,t,n)}accumulateWorkingTime(e,t,n){if(0===t)return{finalDate:new Date(e),remainingDurationInMs:0};if(isNaN(t))throw new Error("Invalid duration");let r=e;const s=this.getProject().adjustDurationToDST;return this.forEachAvailabilityInterval(n?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},((e,a,i)=>{let o=!0;if(i.getIsWorking()){let i=a.getTime()-e.getTime();if(t<=i){if(s){const r=n?e.getTimezoneOffset()-new Date(e.getTime()+t).getTimezoneOffset():new Date(a.getTime()-t).getTimezoneOffset()-a.getTimezoneOffset();t-=60*r*1e3}r=n?new Date(e.getTime()+t):new Date(a.getTime()-t),t=0,o=!1}else{if(s){i+=60*(e.getTimezoneOffset()-a.getTimezoneOffset())*1e3}r=n?a:e,t-=i}}return o})),{finalDate:new Date(r),remainingDurationInMs:t}}calculateDurationMs(e,t,n=!1){let r=0;const s=e.getTime()<=t.getTime()||!n?1:-1;s<0&&([e,t]=[t,e]);const a=this.getProject().adjustDurationToDST;return this.forEachAvailabilityInterval({startDate:e,endDate:t},((e,t,n)=>{if(n.getIsWorking()&&(r+=t.getTime()-e.getTime(),a)){const n=e.getTimezoneOffset()-t.getTimezoneOffset();r+=60*n*1e3}})),r*s}calculateEndDate(e,t){const n=t>=0,r=this.accumulateWorkingTime(e,Math.abs(t),n);return 0===r.remainingDurationInMs?r.finalDate:null}calculateStartDate(e,t){const n=t<=0,r=this.accumulateWorkingTime(e,Math.abs(t),n);return 0===r.remainingDurationInMs?r.finalDate:null}skipNonWorkingTime(e,t=!0){let n;const r=this.forEachAvailabilityInterval(t?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},((e,r,s)=>{if(s.getIsWorking())return n=t?e:r,!1}));return r===oe.MaxRangeReached||r===oe.FullRangeIterated?"empty_calendar":n?new Date(n):new Date(e)}addInterval(e){return this.addIntervals([e])}addIntervals(e){return this.bumpVersion(),this.intervalStore.add(e)}removeInterval(e){return this.removeIntervals([e])}removeIntervals(e){return this.bumpVersion(),this.intervalStore.remove(e)}clearIntervals(e){return e||this.bumpVersion(),this.intervalStore.removeAll(e)}bumpVersion(){this.clearCache(),this.version++}get calendarCache(){if(void 0!==this.$calendarCache)return this.$calendarCache;const e=new Ce({isWorking:this.unspecifiedTimeIsWorking});return e.calendar=this,this.$calendarCache=new ve({calendar:this,unspecifiedTimeInterval:e,intervalStore:this.intervalStore,parentCache:this.parent&&!this.parent.isRoot?this.parent.calendarCache:null})}clearCache(){this.$calendarCache&&this.$calendarCache.clear(),this.$calendarCache=void 0}resetPriorityOfAllIntervals(){this.traverse((e=>{e.intervalStore.forEach((e=>e.resetPriority()))}))}insertChild(e,t,r){let s=n.insertChild.call(this,...arguments);return Array.isArray(s)||(s=[s]),s.forEach((e=>{e.bumpVersion(),e.resetPriorityOfAllIntervals()})),s}joinProject(){n.joinProject.call(this),this.intervalStore.setProject(this.getProject())}leaveProject(){n.leaveProject.call(this),this.intervalStore.setProject(null),this.clearCache()}doDestroy(){this.leaveProject(),this.intervalStore.destroy(),super.doDestroy()}isDayHoliday(t){const n=e.clearTime(t),r=e.getNext(t,H.Day);let s=!1;return this.forEachAvailabilityInterval({startDate:n,endDate:r,isForward:!0},((e,t,n)=>(s=n.getIsWorking(),!s))),!s}getDailyHolidaysRanges(t,n){const r=[];for(t=e.clearTime(t);t<n;)this.isDayHoliday(t)&&r.push({startDate:t,endDate:e.getStartOfNextDay(t,!0,!0)}),t=e.getNext(t,H.Day);return r}getWorkingTimeRanges(e,t){const n=[];return this.forEachAvailabilityInterval({startDate:e,endDate:t,isForward:!0},((e,t,r)=>{if(r.getIsWorking()){const s=r.intervals[0];n.push({name:s.name,startDate:e,endDate:t})}})),n}getNonWorkingTimeRanges(e,t){const n=[];return this.forEachAvailabilityInterval({startDate:e,endDate:t,isForward:!0},((e,t,r)=>{if(!r.getIsWorking()){const s=r.intervals[0];n.push({name:s.name,iconCls:s.iconCls,cls:s.cls,startDate:e,endDate:t})}})),n}isWorkingTime(e,t,n){if(n){let n;const r=this.forEachAvailabilityInterval({startDate:e,endDate:t,isForward:!0},((r,s,a)=>{if(a.getIsWorking()&&r<=e&&s>=t)return n=!0,!1}));return r!==oe.MaxRangeReached&&r!==oe.FullRangeIterated&&n}{const n=this.skipNonWorkingTime(e);return!(!n||"empty_calendar"===n)&&(t?n<t:n.getTime()===e.getTime())}}}}))){}class Ie extends(z([ye],(e=>{const t=e.prototype;return class extends e{getAssignmentFor(e){for(const n of null!==(t=this.assigned)&&void 0!==t?t:[]){var t;if(n.resource===e)return n}return null}isAssignedTo(e){return Boolean(this.getAssignmentFor(e))}async assign(e){const t=this.project.assignmentStore.modelClass;return this.addAssignment(new t({event:this,resource:e})),this.commitAsync()}async unassign(e){const t=this.getAssignmentFor(e);return this.removeAssignment(t),this.commitAsync()}leaveProject(){if(this.isInActiveTransaction&&this.assigned){const e=this.getEventStore();this.assigned.forEach((t=>e.assignmentsForRemoval.add(t)))}t.leaveProject.call(this,...arguments)}remove(){if(!this.parent)return t.remove.call(this);{const e=this.getEventStore();t.remove.call(this),e&&e.afterEventRemoval()}}addAssignment(e){return this.getProject().assignmentStore.add(e),e}removeAssignment(e){return this.getProject().assignmentStore.remove(e),e}}}))){}class Te extends(z([ye,Re,s],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.$isCalculating=!1,this.$changed={},this.$beforeChange={}}get isInActiveTransaction(){return!0}joinProject(){this.invalidate()}leaveProject(e=!1){var n;t.leaveProject.call(this,e),null===(n=this.project)||void 0===n||n.bufferedCommitAsync()}invalidate(){var e;null===(e=this.project)||void 0===e||e.invalidate(this)}getCurrentOrProposed(e){var t;return e in this.$changed&&!0!==this.$changed[e]?this.$changed[e]:null!==(t=this.get(e))&&void 0!==t?t:null}hasCurrentOrProposed(e){return e in this.$changed&&1!=this.$changed[e]||null!=this.get(e)}propose(e){var t;if(this.project||null!==(t=this.recurringTimeSpan)&&void 0!==t&&t.project){const t=Object.keys(e);for(let n=0;n<t.length;n++){const r=t[n];this.$changed[r]=e[r]}this.invalidate()}else this.set(e)}setChanged(e,t,n=!0,r=!1){const s=this;s.$changed[e]=t,r&&(e in s.$beforeChange||(s.$beforeChange[e]=s.get(e)),s.setData(e,t)),n&&s.invalidate()}calculateInvalidated(){}finalizeInvalidated(e=!1){const t=this;t.$isCalculating=!0,e?t.setData(t.$changed):(t.setData(t.$beforeChange),t.set(t.$changed)),t.$changed={},t.$beforeChange={},t.$isCalculating=!1}}}))){}const xe=e=>Number(e)!==e,be=e=>e instanceof Set||e instanceof Array?F(e):F([e]),Me=e=>new Promise((t=>setTimeout(t,e))),Ae=(e,...t)=>e.replace(/{(\d+)}/g,((e,n)=>void 0!==t[n]?t[n]:e));class we extends(z([fe],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.allAssignmentsForRemoval=!1}remove(e,n){this.assignmentsForRemoval=be(e).toSet();const r=t.remove.call(this,e,n);return this.assignmentsForRemoval.clear(),r}removeAll(e){this.allAssignmentsForRemoval=!0;const n=t.removeAll.call(this,e);return this.allAssignmentsForRemoval=!1,n}}}))){}class je extends(z([fe],(e=>{e.prototype;return class extends e{doDestroy(){var e;const t=[];null!==(e=this.rootNode)&&void 0!==e&&e.isDestroyed||this.traverse((e=>t.push(e))),super.doDestroy(),t.forEach((e=>e.destroy()))}}}))){}class Oe extends(z([fe],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}remove(e,n){this.dependenciesForRemoval=be(e).toSet();const r=t.remove.call(this,e,n);return this.dependenciesForRemoval.clear(),r}removeAll(e){this.allDependenciesForRemoval=!0;const n=t.removeAll.call(this,e);return this.allDependenciesForRemoval=!1,n}}}))){}const Fe={splice:1,clear:1};class Pe extends(z([fe],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.dependenciesForRemoval=new Set}onDataChange(e){var t;const n=Fe[e.action];super.onDataChange(e),n&&null!==(t=e.removed)&&void 0!==t&&t.length&&this.afterEventRemoval()}remove(e,n){const r=t.remove.call(this,e,n);return this.afterEventRemoval(),r}removeAll(e){const n=t.removeAll.call(this,e);return this.afterEventRemoval(),n}onNodeRemoveChild(e,n,r,s){const a=t.onNodeRemoveChild.call(this,...arguments);return this.afterEventRemoval(),a}afterEventRemoval(){const{assignmentsForRemoval:e,dependenciesForRemoval:t}=this;if(!e)return;const n=this.getAssignmentStore();if(n&&!n.allAssignmentsForRemoval&&e.size){const t=[...e].filter((e=>!n.assignmentsForRemoval.has(e)));t.length>0&&n.remove(t)}e.clear();const r=this.getDependencyStore();if(r&&!r.allDependenciesForRemoval&&t.size){const e=[...t].filter((e=>!r.dependenciesForRemoval.has(e)));e.length>0&&r.remove(e)}t.clear()}processRecord(e,t=!1){var n;if(null===(n=this.project)||void 0===n||!n.isRepopulatingStores){const t=this.getById(e.id);if(t&&t!==e&&t.assigned)for(const n of t.assigned)n.event=e}return e}}}))){}const ke={splice:1,clear:1};class $e extends(z([fe],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set}onDataChange(e){var t;const n=ke[e.action];super.onDataChange(e),n&&null!==(t=e.removed)&&void 0!==t&&t.length&&this.afterResourceRemoval()}remove(e,n){const r=t.remove.call(this,e,n);return this.afterResourceRemoval(),r}removeAll(e){const n=t.removeAll.call(this,e);return this.afterResourceRemoval(),n}afterResourceRemoval(){const e=this.getAssignmentStore();if(e&&!e.allAssignmentsForRemoval){const t=[...this.assignmentsForRemoval].filter((t=>!e.assignmentsForRemoval.has(t)));t.length>0&&e.remove(t)}this.assignmentsForRemoval.clear()}processRecord(e,t=!1){const n=this.getById(e.id);if(n&&n!==e)for(const t of n.assigned||[])t.resource=e;return e}}}))){}class Ne extends(z([Te],(t=>{const n=t.prototype;return class extends t{constructor(){super(...arguments),this._startDate=null,this._endDate=null,this._duration=null}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number"},{name:"durationUnit",type:"durationunit",defaultValue:"day"}]}get startDate(){var e,t;return null!==(e=null!==(t=this._startDate)&&void 0!==t?t:this.get("startDate"))&&void 0!==e?e:null}get endDate(){var e,t;return null!==(e=null!==(t=this._endDate)&&void 0!==t?t:this.get("endDate"))&&void 0!==e?e:null}get duration(){var e,t;return null!==(e=null!==(t=this._duration)&&void 0!==t?t:this.get("duration"))&&void 0!==e?e:null}set startDate(e){this.proposeStartDate(e)}set endDate(e){this.proposeEndDate(e)}set duration(e){this.proposeDuration(e)}inSet(e,t,r,s,a){const i=this;return!i.project||i.project.isWritingData||"string"==typeof e||a||("startDate"in e&&!("startDate"in i.$changed)&&(i.$changed.startDate=!0,i.invalidate()),"endDate"in e&&!("endDate"in i.$changed)&&(i.$changed.endDate=!0,i.invalidate())),n.inSet.call(i,e,t,r,s,a)}getStartDate(){return this.startDate}proposeStartDate(e,t=!("endDate"in this.$changed)){var n;(this.inSetting||(null==e?void 0:e.getTime())!==(null===(n=this.startDate)||void 0===n?void 0:n.getTime()))&&(this._startDate=e,this.propose({startDate:e,keepDuration:t}))}async setStartDate(e,t=!0){var n;return this.proposeStartDate(e,t),null===(n=this.project)||void 0===n?void 0:n.commitAsync()}getEndDate(){return this.endDate}proposeEndDate(e,t=!1){var n;(this.inSetting||(null==e?void 0:e.getTime())!==(null===(n=this.endDate)||void 0===n?void 0:n.getTime()))&&(this._endDate=e,this.propose({endDate:e,keepDuration:t}))}async setEndDate(e,t=!1){var n;return this.proposeEndDate(e,t),null===(n=this.project)||void 0===n?void 0:n.commitAsync()}getDuration(){return this.duration}proposeDuration(e,t,n=!0){this._duration=e,this.propose({duration:e,keepStart:n}),t&&this.propose({durationUnit:t})}async setDuration(e,t,n=!0){var r;return this.proposeDuration(e,t,n),null===(r=this.project)||void 0===r?void 0:r.commitAsync()}getDurationUnit(){return this.durationUnit}joinProject(){const e=this,t=e.$changed,r=e.getCurrentOrProposed("startDate"),s=e.getCurrentOrProposed("endDate"),a=e.getCurrentOrProposed("duration");if(null!=r&&(t.startDate=e._startDate=r),null!=s&&(t.endDate=e._endDate=s),null!=a&&(t.duration=e._duration=a),e.eventStore&&!e.eventStore.isLoadingData){var i;const t=null===(i=e.assignmentStore)||void 0===i?void 0:i.storage.findItem("event",null);if(t){var o;const n=null===(o=e.assignmentStore)||void 0===o?void 0:o.storage.findItem("eventId",e.id);if(n)for(const t of n)t.setChanged("event",e);else for(const n of t)n.getCurrentOrProposed("event")===e.id&&n.setChanged("event",e)}}n.joinProject.call(e)}applyValue(e,t,r,s,a){var i;(this.project||null!==(i=this.recurringTimeSpan)&&void 0!==i&&i.project)&&("startDate"!==t&&"duration"!=t&&"endDate"!==t||(e=!0,this["_"+t]=r),s&&(e=!1)),n.applyValue.call(this,e,t,r,s,a)}afterChange(e,t,r,s,a){this.$isCalculating||a||this.setData({startDate:this.getCurrentOrProposed("startDate"),endDate:this.getCurrentOrProposed("endDate"),duration:this.getCurrentOrProposed("duration"),durationUnit:this.getCurrentOrProposed("durationUnit")}),n.afterChange.call(this,e,t,r,s,a)}calculateInvalidated(){const t=this,n=t.$changed,r="startDate"in n,s="endDate"in n,a="duration"in n,{startDate:i,endDate:o,duration:l,keepDuration:c,keepStart:d}=n;let u=null;!r||s||a?r||!s||a?r||s||!a?r&&s&&!a?null===i&&null===o?n.duration=null:u="duration":r&&!s&&a?u="endDate":!r&&s&&a?u="startDate":r&&s&&a&&(u=null==l?"duration":null==i?"startDate":"endDate"):null===l?n.endDate=null:!t.hasCurrentOrProposed("startDate")||!d&&t.hasCurrentOrProposed("endDate")?t.hasCurrentOrProposed("endDate")&&(u="startDate"):(d&&n.duration<0&&(n.duration=0),u="endDate"):null===o?n.startDate=null:t.hasCurrentOrProposed("startDate")&&!c&&!0!==o&&o<t.getCurrentOrProposed("startDate")?(n.startDate=o,n.duration=0):!t.hasCurrentOrProposed("duration")||!c&&t.hasCurrentOrProposed("startDate")?t.hasCurrentOrProposed("startDate")&&(u="duration"):u="startDate":null===i?n.endDate=null:t.hasCurrentOrProposed("endDate")&&i>t.getCurrentOrProposed("endDate")&&!c?(n.endDate=i,n.duration=0):!t.hasCurrentOrProposed("duration")||!c&&t.hasCurrentOrProposed("endDate")?t.hasCurrentOrProposed("endDate")&&(u="duration"):u="endDate";const h=t.getCurrentOrProposed("startDate"),g=t.getCurrentOrProposed("endDate"),m=t.getCurrentOrProposed("duration"),v=t.getCurrentOrProposed("durationUnit");let p,f;switch(u){case"startDate":n.startDate=e.add(g,-m,v);break;case"endDate":p=e.as("hour",m,v),f=e.as(v,p,"h"),n.endDate=e.add(h,f,v);break;case"duration":p=e.diff(h,g,"h"),n.duration=e.as(v,p,"h")}"startDate"in n&&!0!==n.startDate&&(this._startDate=n.startDate),"endDate"in n&&!0!==n.endDate&&(this._endDate=n.endDate),"duration"in n&&!0!==n.duration&&(this._duration=n.duration),delete n.keepDuration,delete n.keepStart}}}))){}class Le extends(z([Te],(e=>{const t=e.prototype;return class extends e{get assigned(){var e;return null===(e=this.project)||void 0===e?void 0:e.assignmentStore.getResourcesAssignments(this)}joinProject(){var e;this.resourceStore&&!this.resourceStore.isLoadingData&&(null===(e=this.assignmentStore)||void 0===e||e.query((e=>e.get("resource")===this.id)).forEach((e=>e.setChanged("resource",this))));t.joinProject.call(this)}leaveProject(e=!1){if(this.assigned&&!e){const e=this.resourceStore;this.assigned.forEach((t=>e.assignmentsForRemoval.add(t)))}t.leaveProject.call(this)}applyValue(e,n,r,s,a){"id"===(null==a?void 0:a.name)&&this.assigned.forEach((e=>{e.set("resourceId",r)})),t.applyValue.call(this,e,n,r,s,a)}}}))){}class Be extends(z([Te],(e=>{const t=e.prototype;return class extends e{static get fields(){return[{name:"resource",isEqual:(e,t)=>e===t,persist:!1},{name:"event",isEqual:(e,t)=>e===t,persist:!1}]}setChanged(e,n,r){const{assignmentStore:s,eventStore:a,resourceStore:i,project:o}=this;let l=!1;if("event"===e){const e=W(n,Ne)?n:null==a?void 0:a.$master.getById(n);e&&(l=!0),n=e||n}if("resource"===e){const e=W(n,Le)?n:null==i?void 0:i.$master.getById(n);e&&(l=!0),n=e||n}t.setChanged.call(this,e,n,r,!0),!s||!l||o.isPerformingCommit||s.isLoadingData||i.isLoadingData||s.skipInvalidateIndices||s.invalidateIndices()}joinProject(){t.joinProject.call(this),this.setChanged("event",this.get("event")),this.setChanged("resource",this.get("resource"))}calculateInvalidated(){let{event:e=this.event,resource:t=this.resource}=this.$changed;if(null!==e&&!W(e,Ne)){var n;const t=null===(n=this.eventStore)||void 0===n?void 0:n.getById(e);t&&this.setChanged("event",t,!1)}if(null!==t&&!W(t,Le)){var r;const e=null===(r=this.resourceStore)||void 0===r?void 0:r.getById(t);e&&this.setChanged("resource",e,!1)}}finalizeInvalidated(e){const n=this.$changed;var r,s;"resource"in n&&(n.resourceId=null!==(r=n.resource)&&void 0!==r&&r.isModel?n.resource.id:n.resource);"event"in n&&(n.eventId=null!==(s=n.event)&&void 0!==s&&s.isModel?n.event.id:n.event);t.finalizeInvalidated.call(this,e)}set event(e){this.setChanged("event",e)}get event(){const e=this.get("event");return null!=(null==e?void 0:e.id)?e:null}set resource(e){this.setChanged("resource",e)}get resource(){const e=this.get("resource");return null!=(null==e?void 0:e.id)?e:null}}}))){}class qe extends(z([fe,Re,n],(e=>{const t=e.prototype;return class extends e{setProject(e){const n=t.setProject.call(this,e);return e&&this.joinProject(e),n}joinProject(e){}onCommitAsync(){}}}))){}const _e=new Set;class Ve extends(z([we,qe],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.skipInvalidateIndices=!1}static get defaultConfig(){return{modelClass:Be,storage:{extraKeys:[{property:"event",unique:!1},{property:"resource",unique:!1},{property:"eventId",unique:!1}]}}}set data(e){this.allAssignmentsForRemoval=!0,super.data=e,this.allAssignmentsForRemoval=!1}getEventsAssignments(e){return this.storage.findItem("event",e,!0)||_e}getResourcesAssignments(e){return this.storage.findItem("resource",e.$original,!0)||_e}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}afterLoadData(){this.eventStore&&this.linkAssignments(this.eventStore,"event"),this.resourceStore&&this.linkAssignments(this.resourceStore,"resource")}linkAssignments(e,t){e=e.masterStore||e;const n=this.count&&this.storage.findItem(t,null,!0);if(n){for(const r of n){const n=e.getById(r.getCurrentOrProposed(t));n&&r.setChanged(t,n)}this.invalidateIndices()}}unlinkAssignments(e){this.forEach((t=>{var n,r,s;return t.setChanged(e,null!==(n=null!==(r=null===(s=t[e])||void 0===s?void 0:s.id)&&void 0!==r?r:null==t?void 0:t.getData(e))&&void 0!==n?n:t[e+"Id"])})),this.invalidateIndices()}onCommitAsync(){this.updateIndices()}}}))){}class Ye extends(z([Ee,Te],(e=>{e.prototype;return class extends e{}}))){}class Ue extends(z([je,qe],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{tree:!0,modelClass:Ye}}}}))){}class We extends(z([Te],(e=>{const t=e.prototype;return class extends e{static get fields(){return[{name:"fromEvent",isEqual:(e,t)=>e===t,persist:!1},{name:"toEvent",isEqual:(e,t)=>e===t,persist:!1}]}setChanged(e,n,r){var s;let a=!1;if("fromEvent"===e||"toEvent"===e){var i;const e=W(n,Ne)?n:null===(i=this.eventStore)||void 0===i?void 0:i.getById(n);e&&(a=!0),n=e||n}var o;(t.setChanged.call(this,e,n,r,!0),!a||this.project.isPerformingCommit||null!==(s=this.dependencyStore)&&void 0!==s&&s.isLoadingData)||(null===(o=this.dependencyStore)||void 0===o||o.invalidateIndices())}joinProject(){t.joinProject.call(this),this.setChanged("fromEvent",this.get("fromEvent")),this.setChanged("toEvent",this.get("toEvent"))}calculateInvalidated(){let{fromEvent:e,toEvent:t}=this.$changed;if(null!==e&&!W(e,Ne)){var n;const t=null===(n=this.eventStore)||void 0===n?void 0:n.getById(e);t&&(this.$changed.fromEvent=t)}if(null!==t&&!W(t,Ne)){var r;const e=null===(r=this.eventStore)||void 0===r?void 0:r.getById(t);e&&(this.$changed.toEvent=e)}}set fromEvent(e){this.setChanged("fromEvent",e)}get fromEvent(){const e=this.get("fromEvent");return null!=(null==e?void 0:e.id)?e:null}set toEvent(e){this.setChanged("toEvent",e)}get toEvent(){const e=this.get("toEvent");return null!=(null==e?void 0:e.id)?e:null}}}))){}const ze=new Set;class Ke extends(z([Oe,qe],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}static get defaultConfig(){return{modelClass:We,storage:{extraKeys:[{property:"fromEvent",unique:!1},{property:"toEvent",unique:!1}]}}}getIncomingDepsForEvent(e){return this.storage.findItem("toEvent",e)||ze}getOutgoingDepsForEvent(e){return this.storage.findItem("fromEvent",e)||ze}set data(e){this.allDependenciesForRemoval=!0,super.data=e,this.allDependenciesForRemoval=!1}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}onCommitAsync(){this.updateIndices()}}}))){}class He extends(z([Ne,Ie],(e=>{const t=e.prototype;return class extends e{get assigned(){var e,t;return null!==(e=null===(t=this.project)||void 0===t?void 0:t.assignmentStore.getEventsAssignments(this))&&void 0!==e?e:this.$cachedAssignments}leaveProject(e=!1){this.$cachedAssignments=this.assigned,super.leaveProject(e)}applyValue(e,n,r,s,a){var i;"id"===n&&(null===(i=this.assigned)||void 0===i||i.forEach((e=>e.set("eventId",r))));t.applyValue.call(this,e,n,r,s,a)}copy(e=null,n=null){const r=t.copy.call(this,e,n);return(a.isObject(n)&&!n.skipFieldIdentifiers||!a.isObject(n))&&(r.$cachedAssignments=this.assigned),r}}}))){}class Ze extends(z([Ne],(e=>{const t=e.prototype;return class extends e{get outgoingDeps(){return this.project.dependencyStore.getOutgoingDepsForEvent(this)}get incomingDeps(){return this.project.dependencyStore.getIncomingDepsForEvent(this)}leaveProject(){const e=this.eventStore;this.outgoingDeps&&this.outgoingDeps.forEach((t=>e.dependenciesForRemoval.add(t))),this.incomingDeps&&this.incomingDeps.forEach((t=>e.dependenciesForRemoval.add(t))),t.leaveProject.call(this)}}}))){}class Je extends(z([Ne,He,Ze],(e=>{e.prototype;return class extends e{}}))){}class Ge extends(z([Pe,qe],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{modelClass:Je}}joinProject(){var e;null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"event")}afterLoadData(){var e;this.afterEventRemoval(),null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"event")}}}))){}class Qe extends(z([$e,qe],(e=>{const t=e.prototype;return class extends e{static get defaultConfig(){return{modelClass:Le}}joinProject(){var e;null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"resource")}afterLoadData(){var e;null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"resource")}clear(e){var n;t.clear.call(this,e),null===(n=this.assignmentStore)||void 0===n||n.unlinkAssignments("resource")}}}))){}class Xe extends(z([],i)){}class et extends(z([],o)){}class tt extends(z([Xe,et,s],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.isRestoringData=!1}get isRepopulatingStores(){return!1}get isInitialCommit(){return!this.isInitialCommitPerformed||this.hasLoadedDataToCommit}construct(e={}){this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!1,this.isWritingData=!1,this.hasLoadedDataToCommit=!1;const n=!("silenceInitialCommit"in e)||e.silenceInitialCommit,r="adjustDurationToDST"in e&&e.adjustDurationToDST;this.maxCalendarRange="maxCalendarRange"in e?e.maxCalendarRange:15768e7,delete e.maxCalendarRange,delete e.silenceInitialCommit,delete e.adjustDurationToDST,t.construct.call(this,e),this.silenceInitialCommit=n,this.adjustDurationToDST=r}repopulateStore(e){}repopulateReplica(){}deferUntilRepopulationIfNeeded(e,t,n){t(...n)}attachStore(e){}detachStore(e){}async commitAsync(){throw new Error("Abstract method called")}isEngineReady(){throw new Error("Abstract method called")}getStm(){throw new Error("Abstract method called")}}}))){}class nt extends(z([],o)){}class rt extends(z([tt,Re,nt,s],(e=>{const t=e.prototype;class r extends e{static get configurable(){return{stm:{},eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},eventModelClass:Je,assignmentModelClass:Be,resourceModelClass:Le,dependencyModelClass:We,calendarModelClass:Ye,eventStoreClass:Ge,assignmentStoreClass:Ve,resourceStoreClass:Qe,dependencyStoreClass:Ke,calendarManagerStoreClass:Ue,assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null}}construct(e={}){const n=this;if(n.$invalidated=new Set,n.isPerformingCommit=!1,n.silenceInitialCommit=!0,n.ongoing=Promise.resolve(),e.eventStore&&!e.assignmentStore){var r;const t=e.eventStore.masterStore||e.eventStore;null!==(r=t.assignmentStore)&&void 0!==r&&r.isAssignmentStore&&(e.assignmentStore=t.assignmentStore,n.isSharingAssignmentStore=!0)}t.construct.call(n,e),n.defaultCalendar=new n.calendarManagerStore.modelClass({unspecifiedTimeIsWorking:n.unspecifiedTimeIsWorking}),n.defaultCalendar.project=n;const{calendarsData:s,eventsData:a,dependenciesData:i,resourcesData:o,assignmentsData:l}=n;Boolean(s||a||i||o||l)?(n.loadInlineData({calendarsData:s,eventsData:a,dependenciesData:i,resourcesData:o,assignmentsData:l}),delete n.calendarsData,delete n.eventsData,delete n.dependenciesData,delete n.resourcesData,delete n.assignmentsData):n.bufferedCommitAsync()}doDestroy(){var e,n,r,s,a,i;const o=this;null===(e=o.eventStore)||void 0===e||e.destroy(),null===(n=o.dependencyStore)||void 0===n||n.destroy(),null===(r=o.assignmentStore)||void 0===r||r.destroy(),null===(s=o.resourceStore)||void 0===s||s.destroy(),null===(a=o.calendarManagerStore)||void 0===a||a.destroy(),o.defaultCalendar.destroy(),null===(i=o.stm)||void 0===i||i.destroy(),t.doDestroy.call(this)}async loadInlineData(e){const t=this;t.isLoadingInlineData=!0,e.calendarsData&&(t.calendarManagerStore.data=e.calendarsData),e.resourcesData&&(t.resourceStore.data=e.resourcesData),e.assignmentsData&&(t.assignmentStore.data=e.assignmentsData),e.eventsData&&(t.eventStore.data=e.eventsData),e.tasksData&&(t.eventStore.data=e.tasksData),e.dependenciesData&&(t.dependencyStore.data=e.dependenciesData),await t.commitLoad(),t.isLoadingInlineData=!1}async commitLoad(){await this.commitAsync(),this.isDestroyed||this.trigger("load")}joinStoreRecords(e){const t=e=>{e.setProject(this),e.joinProject()};e.rootNode?e.rootNode.traverse(t):e.forEach(t)}unJoinStoreRecords(e){const t=e=>{e.leaveProject(),e.setProject(this)};e.rootNode?e.rootNode.traverse((n=>{n!==e.rootNode&&t(n)})):e.forEach(t)}resolveStoreAndModelClass(e,t){const n=(null==t?void 0:t.storeClass)||this[`${e}StoreClass`];let r=null==t?void 0:t.modelClass;return r||(r=this.getDefaultConfiguration()[`${e}ModelClass`]!==n.getDefaultConfiguration().modelClass?n.getDefaultConfiguration().modelClass:this[`${e}ModelClass`]),{storeClass:n,modelClass:r}}setEventStore(e){this.eventStore=e}changeEventStore(e,t){const r=this,{stm:s}=r;if(r.detachStore(t),e instanceof n)e.project=r,s.addStore(e),r.joinStoreRecords(e);else{const{storeClass:t,modelClass:n}=r.resolveStoreAndModelClass("event",e);e=new t(a.assign({modelClass:n,project:r,stm:s},e))}if(t&&s.hasStore(t)){s.removeStore(t),r.unJoinStoreRecords(t);const{assignmentsForRemoval:n}=t;n.forEach((t=>{const r=t.event;if(r){const s=e.getById(r.id);s&&(t.event=s,n.delete(t))}})),t.afterEventRemoval()}return e.setProject(r),e}updateEventStore(e,t){this.attachStore(e),this.trigger("eventStoreChange",{store:e})}setAssignmentStore(e){this.assignmentStore=e}changeAssignmentStore(e,t){const r=this,{stm:s}=r;if(r.detachStore(t),t&&s.hasStore(t)&&(s.removeStore(t),r.unJoinStoreRecords(t)),e instanceof n)e.project=r,s.addStore(e),r.joinStoreRecords(e);else{const{storeClass:t,modelClass:n}=r.resolveStoreAndModelClass("assignment",e);e=new t(a.assign({modelClass:n,project:r,stm:s},e))}return e.setProject(r),e}updateAssignmentStore(e,t){this.attachStore(e),this.trigger("assignmentStoreChange",{store:e})}setResourceStore(e){this.resourceStore=e}changeResourceStore(e,t){const r=this,{stm:s}=r;if(r.detachStore(t),e instanceof n)e.project=r,s.addStore(e),r.joinStoreRecords(e);else{const{storeClass:t,modelClass:n}=r.resolveStoreAndModelClass("resource",e);e=new t(a.assign({modelClass:n,project:r,stm:s},e))}if(t&&s.hasStore(t)){s.removeStore(t),r.unJoinStoreRecords(t);const{assignmentsForRemoval:n}=t;n.forEach((t=>{const r=t.resource;if(r){const s=e.getById(r.id);s&&(t.resource=s,n.delete(t))}})),t.afterResourceRemoval()}return e.setProject(r),e}updateResourceStore(e,t){this.attachStore(e),this.trigger("resourceStoreChange",{store:e})}setDependencyStore(e){this.dependencyStore=e}changeDependencyStore(e,t){const r=this;if(r.detachStore(t),e instanceof n)e.project=r,r.stm.addStore(e),r.joinStoreRecords(e);else{const{storeClass:t,modelClass:n}=r.resolveStoreAndModelClass("dependency",e);e=new t(a.assign({modelClass:n,project:r,stm:r.stm},e))}return e}updateDependencyStore(e,t){this.attachStore(e),this.trigger("dependencyStoreChange",{store:e})}setCalendarManagerStore(e){this.calendarManagerStore=e}changeCalendarManagerStore(e,t){const r=this;if(r.detachStore(t),e instanceof n)r.stm.addStore(e);else{var s,i;const t=(null===(s=e)||void 0===s?void 0:s.storeClass)||r.calendarManagerStoreClass,n=(null===(i=e)||void 0===i?void 0:i.modelClass)||t.getDefaultConfiguration().modelClass||r.calendarModelClass;e=new t(a.assign({modelClass:n,project:r,stm:r.stm},e))}return e.setProject(r),e}updateCalendarManagerStore(e,t){this.attachStore(e),this.trigger("calendarManagerStoreChange",{store:e})}get calendar(){return this.$calendar||this.defaultCalendar}set calendar(e){this.$calendar=e}get effectiveCalendar(){return this.calendar}async addEvent(e){return this.eventStore.add(e),this.commitAsync()}async addAssignment(e){return this.assignmentStore.add(e),this.commitAsync()}async addResource(e){return this.resourceStore.add(e),this.commitAsync()}async addDependency(e){return this.dependencyStore.add(e),this.commitAsync()}bufferedCommitAsync(){this.hasPendingAutoCommit||this.setTimeout({fn:"commitAsync",delay:10})}get hasPendingAutoCommit(){return this.hasTimeout("commitAsync")}unScheduleAutoCommit(){this.clearTimeout("commitAsync")}async commitAsync(){return this.isPerformingCommit?this.ongoing:this.ongoing=this.doCommitAsync()}async doCommitAsync(){const e=this;if(e.isPerformingCommit=!0,e.unScheduleAutoCommit(),await Me(0),!e.isDestroyed){for(const t of e.$invalidated)t.calculateInvalidated();const{isInitialCommit:t,silenceInitialCommit:n}=e,r=t&&n;e.assignmentStore.onCommitAsync(),e.dependencyStore.onCommitAsync(),e.isInitialCommitPerformed=!0,e.hasLoadedDataToCommit=!1,e.isPerformingCommit=!1;const s=[e.assignmentStore,e.dependencyStore,e.eventStore,e.resourceStore,e.calendarManagerStore];if(s.forEach((e=>{var t;return null===(t=e.suspendAutoCommit)||void 0===t?void 0:t.call(e)})),e.isWritingData=!0,e.trigger("refresh",{isInitialCommit:t,isCalculated:!0}),r)for(const t of e.$invalidated)t.finalizeInvalidated(!0);else{for(const t of e.$invalidated)t.beginBatch(!0),t.finalizeInvalidated();for(const t of e.$invalidated)t.endBatch(!1,!0)}return e.isWritingData=!1,e.$invalidated.clear(),e.trigger("dataReady"),s.forEach((e=>{var t;return null===(t=e.resumeAutoCommit)||void 0===t?void 0:t.call(e)})),e.trigger("commitFinalized"),!0}}async propagateAsync(){return this.commitAsync()}invalidate(e){this.$invalidated.add(e),this.bufferedCommitAsync()}async isValidDependency(){return!0}getStm(){return this.stm}set stm(e){(e=this.$stm=new E(a.assign({disabled:!0},e))).ion({restoringStop:async()=>{e.disable(),await this.commitAsync(),this.isDestroyed||(e.enable(),this.trigger("stateRestoringDone"))}})}get stm(){return this.$stm}isEngineReady(){return!this.hasPendingAutoCommit&&!this.isPerformingCommit&&this.isInitialCommitPerformed}}return r.applyConfigs=!0,r}))){}var st=e=>class extends e{static get $name(){return"AbstractCrudManagerValidation"}static get configurable(){return{validateResponse:!0,skipSuccessProperty:!0,crudLoadValidationWarningPrefix:"CrudManager load response error(s):",crudSyncValidationWarningPrefix:"CrudManager sync response error(s):",supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/scheduler/docs/api/Scheduler/crud/AbstractCrudManagerMixin#config-supportShortSyncResponse)',disableValidationNote:'Note: To disable this validation please set the "validateResponse" config to false'}}get crudLoadValidationMandatoryStores(){return[]}getStoreLoadResponseWarnings(e,t,n){const r=[],{storeId:s}=e,a=this.crudLoadValidationMandatoryStores,i={[s]:{}};return t?t.rows||(r.push(`- "${s}" store section should have a "rows" property with an array of the store records.`),i[s].rows=["..."]):null!=a&&a.includes(s)&&(r.push(`- No "${s}" store section found. It should contain the store data.`),i[s].rows=["..."]),r.length&&Object.assign(n,i),r}getLoadResponseWarnings(e){const t=[],n={};return this.skipSuccessProperty||(n.success=!0),this.forEachCrudStore(((r,s,a)=>{t.push(...this.getStoreLoadResponseWarnings(a,null==e?void 0:e[s],n))})),t.length&&(t.push("Please adjust your response to look like this:\n"+JSON.stringify(n,null,4).replace(/"\.\.\."/g,"...")),t.push(this.disableValidationNote)),t}validateLoadResponse(e){const t=this.getLoadResponseWarnings(e);t.length&&console.warn(this.crudLoadValidationWarningPrefix+"\n"+t.join("\n"))}getStoreSyncResponseWarnings(e,t,n,r){const s=[],a=[],i=[],{storeId:o}=e,l={[o]:{}},c=e.phantomIdField||this.phantomIdField,{modelClass:d}=e.store,{idField:u}=d,h=(null==n?void 0:n.rows)||[],g=(null==n?void 0:n.removed)||[];let m=!1;if(null!=t&&t.added&&(a.push(...t.added.filter((e=>!h.find((t=>t[c]==e[c]))&&!g.find((t=>t[c]==e[c]||t[u]==e[c])))).map((e=>({[c]:e[c],[u]:"..."})))),a.length)){const e=a.map((e=>"#"+e[c])).join(", ");s.push(`- "${o}" store "rows" section should mention added record(s) ${e} sent in the request. It should contain the added records identifiers (both phantom and "real" ones assigned by the backend).`)}if(this.supportShortSyncResponse)!a.length&&n&&(("object"!=typeof n||Array.isArray(n))&&(s.push(`- "${o}" store section should be an Object.`),l[o]["..."]="..."),n.rows&&!Array.isArray(n.rows)&&(s.push(`- "${o}" store "rows" section should be an array`),a.push("...")),n.removed&&!Array.isArray(n.removed)&&(s.push(`- "${o}" store "removed" section should be an array:`),i.push("...")));else{if(null!=t&&t.updated){const e=t.updated.filter((e=>!h.find((t=>t[u]==e[u])))).map((e=>({[u]:e[u]})));if(a.push(...e),e.length){const t=e.map((e=>"#"+e[u])).join(", ");s.push(`- "${o}" store "rows" section should mention updated record(s) ${t} sent in the request. It should contain the updated record identifiers.`),m=!0}}if(a.length&&a.push("..."),null!=t&&t.removed&&(i.push(...t.removed.filter((e=>!h.find((t=>t[u]==e[u])))).map((e=>({[u]:e[u]})))),i.length)){const e=i.map((e=>"#"+e[u])).join(", ");s.push(`- "${o}" store "removed" section should mention removed record(s) ${e} sent in the request. It should contain the removed record identifiers.`),l[o].removed=i,i.push("..."),m=!0}}return a.length&&(l[o].rows=a),s.length||delete l[o],Object.assign(r,l),{messages:s,showSupportShortSyncResponseNote:m}}getSyncResponseWarnings(e,t){const n=[],r={},s=t.pack;this.skipSuccessProperty||(r.success=!0);let a=!1;return this.forEachCrudStore(((t,i,o)=>{const l=this.getStoreSyncResponseWarnings(o,null==s?void 0:s[i],e[i],r);a=a||l.showSupportShortSyncResponseNote,n.push(...l.messages)})),n.length&&(n.push("Please adjust your response to look like this:\n"+JSON.stringify(r,null,4).replace(/"\.\.\.":\s*"\.\.\."/g,",,,").replace(/"\.\.\."/g,"...")),a&&n.push(this.supportShortSyncResponseNote),n.push(this.disableValidationNote)),n}validateSyncResponse(e,t){const n=this.getSyncResponseWarnings(e,t);n.length&&console.warn(this.crudSyncValidationWarningPrefix+"\n"+n.join("\n"))}};class at extends Error{}class it extends at{constructor(e={}){var t,n;super(e.message||e.request&&d.capitalize(null===(t=e.request)||void 0===t?void 0:t.type)+" failed"||"Crud Manager request failed"),Object.assign(this,e),this.action=null===(n=this.request)||void 0===n?void 0:n.type}}const ot=function(e,t,n){return e.store&&(e=e.store),t.store&&(t=t.store),(e=e[n]||0)<(t=t[n]||0)?-1:e>t?1:0},lt=function(e,t){return ot(e,t,"loadPriority")},ct=function(e,t){return ot(e,t,"syncPriority")};var dt=e=>{var t;e.$$meta=e.$meta;const s=[];return e.isEvents||s.push(i),e.isDelayable||s.push(o),s.push(st),t=class extends((e||l).mixin(...s)){static get $name(){return"AbstractCrudManagerMixin"}static get defaultConfig(){return{crudRevision:null,crudStores:[],storeIdProperty:"storeId",crudFilterParam:"filter",transport:{},trackResponseType:!1,supportShortSyncResponse:!0,phantomIdField:"$PhantomId",phantomParentIdField:"$PhantomParentId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],orderedCrudStores:[],writeAllFields:!1,crudIgnoreUpdates:0,autoSyncSuspendCounter:0,crudLoaded:!1,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}get isCrudManager(){return!0}construct(e={}){this._requestId=0,this.activeRequests={},this.crudStoresIndex={},super.construct(e)}afterConstruct(){super.afterConstruct(),this.autoLoad&&(this._autoLoadPromise=this.doAutoLoad())}get loadUrl(){var e,t;return null===(e=this.transport)||void 0===e||null===(t=e.load)||void 0===t?void 0:t.url}updateLoadUrl(e){a.setPath(this,"transport.load.url",e)}get syncUrl(){var e,t;return null===(e=this.transport)||void 0===e||null===(t=e.sync)||void 0===t?void 0:t.url}updateSyncUrl(e){a.setPath(this,"transport.sync.url",e)}getStoreDescriptor(e){return e?e instanceof n?this.crudStores.find((t=>t.store===e)):"object"==typeof e?this.crudStoresIndex[e.storeId]:this.crudStoresIndex[e]||this.getStoreDescriptor(n.getStore(e)):null}fillStoreDescriptor(e){const{store:t}=e,{storeIdProperty:n=this.storeIdProperty,modelClass:r}=t;return e.storeId||(e.storeId=t[n]||t.id),e.idField||(e.idField=r.idField),e.phantomIdField||(e.phantomIdField=r.phantomIdField),e.phantomParentIdField||(e.phantomParentIdField=r.phantomParentIdField),"writeAllFields"in e||(e.writeAllFields=t.writeAllFields),e}updateCrudStoreIndex(){const e=this.crudStoresIndex={};this.crudStores.forEach((t=>t.storeId&&(e[t.storeId]=t)))}getCrudStore(e){const t=this.getStoreDescriptor(e);return null==t?void 0:t.store}forEachCrudStore(e,t=this){if(!e)throw new Error("Iterator function must be provided");this.crudStores.every((n=>!1!==e.call(t,n.store,n.storeId,n)))}set crudStores(e){this._crudStores=[],this.addCrudStore(e);for(const e of this._crudStores)e.loadPriority=e.syncPriority=0}get crudStores(){return this._crudStores}get orderedCrudStores(){return this._orderedCrudStores}set orderedCrudStores(e){return this._orderedCrudStores=e}set syncApplySequence(e){this._syncApplySequence=[],this.addStoreToApplySequence(e)}get syncApplySequence(){return this._syncApplySequence}internalAddCrudStore(e){const t=this;let r;return e instanceof n?r={store:e}:"object"==typeof e?(e.store||(e={storeId:e.id,store:new n(e)}),r=e):r={store:n.getStore(e)},t.fillStoreDescriptor(r),(e=r.store).setCrudManager?e.setCrudManager(t):e.crudManager=t,e.pageSize=null,(t.loadUrl||t.syncUrl)&&(e.autoCommit=!1,e.autoLoad=!1,(e.createUrl||e.updateUrl||e.deleteUrl||e.readUrl)&&console.warn("You have configured an URL on a Store that is handled by a CrudManager that is also configured with an URL. The Store URL's should be removed.")),t.bindCrudStoreListeners(e),r}addCrudStore(e,t,r){var s;if(null===(s=e=c.asArray(e))||void 0===s||!s.length)return;const a=this,i=e.map(a.internalAddCrudStore,a);void 0===t?a.crudStores.push(...i):(r&&((r instanceof n||"object"!=typeof r)&&(r=a.getStoreDescriptor(r)),t+=a.crudStores.indexOf(r)),a.crudStores.splice(t,0,...i)),a.orderedCrudStores.push(...i),a.updateCrudStoreIndex()}addPrioritizedStore(e){const t=this;t.hasCrudStore(e)||t.addCrudStore(e,c.findInsertionIndex(e,t.crudStores,lt)),t.hasApplySequenceStore(e)||t.addStoreToApplySequence(e,c.findInsertionIndex(e,t.syncApplySequence,ct))}hasCrudStore(e){var t;return null===(t=this.crudStores)||void 0===t?void 0:t.some((t=>t===e||t.store===e||t.storeId===e))}removeCrudStore(e){const t=this,n=t.crudStores,r=n.find((t=>t===e||t.store===e||t.storeId===e));if(!r)throw new Error("Store not found in stores collection");t.unbindCrudStoreListeners(r.store),delete t.crudStoresIndex[r.storeId],c.remove(n,r),t.syncApplySequence&&t.removeStoreFromApplySequence(e)}bindCrudStoreListeners(e){e.ion({name:e.id,addConfirmed:"onCrudStoreChange",change:"onCrudStoreChange",destroy:"onCrudStoreDestroy",thisObj:this})}unbindCrudStoreListeners(e){this.detachListeners(e.id)}addStoreToApplySequence(e,t,r){if(!e)return;e=c.asArray(e);const s=this,a=e.reduce(((e,t)=>{const n=s.getStoreDescriptor(t);return n&&e.push(n),e}),[]);if(void 0===t)s.syncApplySequence.push(...a);else{let e=t;r&&((r instanceof n||"object"!=typeof r)&&(r=s.getStoreDescriptor(r)),e+=s.syncApplySequence.indexOf(r)),s.syncApplySequence.splice(e,0,...a)}const i=s.syncApplySequence.map((({storeId:e})=>e));s.orderedCrudStores=[...s.syncApplySequence],s.crudStores.forEach((e=>{i.includes(e.storeId)||s.orderedCrudStores.push(e)}))}removeStoreFromApplySequence(e){const t=this.syncApplySequence.findIndex((t=>t===e||t.store===e||t.storeId===e));t>-1&&(this.syncApplySequence.splice(t,1),this.orderedCrudStores.splice(t,1))}hasApplySequenceStore(e){return this.syncApplySequence.some((t=>t===e||t.store===e||t.storeId===e))}onCrudStoreDestroy({source:e}){this.removeCrudStore(e)}onCrudStoreChange(e){const t=this;t.crudIgnoreUpdates||(t.crudStoreHasChanges(null==e?void 0:e.source)?(t.trigger("hasChanges"),t.autoSync&&t.scheduleAutoSync()):t.trigger("noChanges"))}suspendAutoSync(){this.autoSyncSuspendCounter++}resumeAutoSync(e=!0){const t=this;t.autoSyncSuspendCounter--,t.autoSyncSuspendCounter<=0&&(t.autoSyncSuspendCounter=0,e&&t.autoSync&&t.crudStoreHasChanges()&&t.sync())}get isAutoSyncSuspended(){return this.autoSyncSuspendCounter>0}scheduleAutoSync(){const e=this;e.hasTimeout("autoSync")||e.isAutoSyncSuspended||e.setTimeout({name:"autoSync",fn:()=>{e.sync().catch((e=>{}))},delay:e.autoSyncTimeout})}async triggerFailedRequestEvents(e,t,n,r){const{options:s,type:a}=e;this.trigger("requestFail",{requestType:a,response:t,responseText:n,responseOptions:r}),this.trigger(a+"Fail",{response:t,responseOptions:r,responseText:n,options:s})}async internalOnResponse(e,t,n){const r=this,s=t?r.decode(t):null,{options:a,type:i}=e;if(t&&!s&&console.error("Failed to parse response: "+t),s&&(r.skipSuccessProperty?!1!==s.success:s.success)){if(!1!==r.trigger("beforeResponseApply",{requestType:i,response:s})&&!1!==r.trigger(`before${d.capitalize(i)}Apply`,{response:s,options:a})){if(r.crudRevision=s.revision,await r.applyResponse(e,s,a),r.isDestroyed)return;r.trigger("requestDone",{requestType:i,response:s,responseOptions:n}),r.trigger(i,{response:s,responseOptions:n,options:a}),"load"!==i&&r.crudStoreHasChanges()||(r.trigger("noChanges"),"load"===i&&r.emitCrudStoreEvents(e.pack.stores,"afterRequest"))}}else r.triggerFailedRequestEvents(e,s,t,n);return s}suspendChangesTracking(){this.crudIgnoreUpdates++}resumeChangesTracking(e){!this.crudIgnoreUpdates||--this.crudIgnoreUpdates||e||this.onCrudStoreChange()}get isBatchingChanges(){return this.crudIgnoreUpdates>0}crudStoreHasChanges(e){return e?this.isCrudStoreDirty(this.getCrudStore(e)):this.crudStores.some((e=>this.isCrudStoreDirty(e.store)))}isCrudStoreDirty(e){return Boolean(e.changes)}doAutoLoad(){return this.load().catch((e=>{}))}emitCrudStoreEvents(e,t,n){const s=r({action:"read"+t},n);for(const n of this.crudStores)e.includes(n.storeId)&&n.store.trigger(t,s)}getLoadPackage(e){const t={type:"load",requestId:this.requestId},n=this.crudStores,r=Object.assign({},e);return delete r.request,t.stores=n.map((e=>{var t;const n=null==r?void 0:r[e.storeId],s=e.pageSize||(null===(t=e.store)||void 0===t?void 0:t.pageSize);if(n||s){const t=Object.assign({storeId:e.storeId,page:1},n);return s&&(t.pageSize=s),e.currentPage=t.page,n&&delete r[e.storeId],t}return e.storeId})),Object.assign(t,r),t}loadCrudStore(e,t,n){const r=null==t?void 0:t.rows;null!=n&&n.append||null!=t&&t.append?e.add(r):e.data=r,e.trigger("load",{data:r})}loadDataToCrudStore(e,t,n){const r=e.store,s=null==t?void 0:t.rows;r.__loading=!0,s&&this.loadCrudStore(r,t,n,e),r.__loading=!1}loadCrudManagerData(e,t={}){this.suspendChangesTracking(),this.crudStores.forEach((n=>{const r=n.storeId,s=e[r];s&&this.loadDataToCrudStore(n,s,t[r])})),this.resumeChangesTracking(!0)}get isCrudManagerLoading(){return Boolean(this.activeRequests.load||this.applyingLoadResponse)}get isCrudManagerSyncing(){return Boolean(this.activeRequests.sync||this.applyingSyncResponse)}get isLoadingOrSyncing(){return Boolean(this.isCrudManagerLoading||this.isCrudManagerSyncing)}load(e){"string"==typeof e&&(e={request:{url:e}});const t=this,n=t.getLoadPackage(e);return new Promise(((r,s)=>{if(!1!==t.trigger("beforeLoad",{pack:n})){var a;const{load:i}=t.activeRequests;i&&(t.cancelRequest(i.desc,i.reject),t.trigger("loadCanceled",{pack:n}));const o=u.assign({id:n.requestId,data:t.encode(n),type:"load",success:t.onCrudRequestSuccess,failure:t.onCrudRequestFailure,thisObj:t},null===(a=e)||void 0===a?void 0:a.request);t.activeRequests.load={type:"load",options:e,pack:n,resolve:r,reject(...e){o.success=o.failure=null,s(...e)},id:n.requestId,desc:t.sendRequest(o)},t.emitCrudStoreEvents(n.stores,"loadStart"),t.trigger("loadStart",{pack:n})}else t.trigger("loadCanceled",{pack:n}),s({cancelled:!0})}))}getActiveCrudManagerRequest(e){let t=this.activeRequests[e];return!t&&this.trackResponseType&&(t=Object.values(this.activeRequests)[0]),t}prepareAddedRecordData(e,t){const n=this,{store:r}=t,{isTree:s}=r,i=t.phantomIdField||n.phantomIdField,o=t.phantomParentIdField||n.phantomParentIdField,l=r.modelClass.allFields.filter((e=>e.subStore)),c=e.constructor,d=Object.assign(e.persistableData,{[i]:e.id});if(s){const{parent:t}=e;t&&!t.isRoot&&t.isPhantom&&(d[o]=t.id)}return n.resetIdsBeforeSync&&a.deletePath(d,c.idField),l.forEach((t=>{const r=e.get(t.name);r.allCount&&(d[t.dataSource]={added:r.getRange().map((e=>n.prepareAddedRecordData(e,{store:r})))})})),d}prepareAdded(e,t){return e.filter((e=>e.isValid)).map((e=>this.prepareAddedRecordData(e,t)))}prepareUpdated(e,t){const{store:n}=t,{isTree:r}=n,s=t.writeAllFields||!1!==t.writeAllFields&&this.writeAllFields,i=t.phantomParentIdField||this.phantomParentIdField,o=n.modelClass.allFields.filter((e=>e.subStore));if(t.store.tree){const n=t.store.rootNode;e=e.filter((e=>e!==n))}return e.filter((e=>e.isValid)).reduce(((e,t)=>{let n;if(n=s?t.persistableData:t.modificationDataToWrite,r){const{parent:e}=t;e&&!e.isRoot&&e.isPhantom&&(n[i]=e.id)}return o.forEach((e=>{const r=t.get(e.name);n[e.dataSource]=this.getCrudStoreChanges({store:r})})),a.isEmpty(n)||e.push(n),e}),[])}prepareRemoved(e){return e.map((e=>{const t=e.constructor;return a.setPath({},t.idField,e.id)}))}getCrudStoreChanges(e){const{store:t}=e;let n,{added:r=[],modified:s=[],removed:a=[]}=t.changes||{};return r.length&&(r=this.prepareAdded(r,e)),s.length&&(s=this.prepareUpdated(s,e)),a.length&&(a=this.prepareRemoved(a)),(r.length||s.length||a.length)&&(n={},r.length&&(n.added=r),s.length&&(n.updated=s),a.length&&(n.removed=a)),n}getChangesetPackage(){const{changes:e}=this;return e||this.forceSync?r({type:"sync",requestId:this.requestId,revision:this.crudRevision},e):null}get changes(){const e={};return this.crudStores.forEach((t=>{const n=this.getCrudStoreChanges(t);n&&(e[t.storeId]=n)})),Object.keys(e).length>0?e:null}getRowsToApplyChangesTo({store:e,storeId:t},n,r){var s,i;const o=this,{modelClass:l}=e,c=l.idField,{updated:d,removed:u}=r||{};let h,g,m;if(n){var v,p;m=!0;const e={};h=(null===(v=n.rows)||void 0===v?void 0:v.slice())||[],g=(null===(p=n.removed)||void 0===p?void 0:p.slice())||[],[...h,...g].forEach((t=>{const n=a.getPath(t,c);e[n]=!0})),o.supportShortSyncResponse&&(null==d||d.forEach((t=>{const n=a.getPath(t,c);e[n]||h.push({[c]:n})})),null==u||u.forEach((t=>{const n=a.getPath(t,c);e[n]||g.push({[c]:n})})))}else(d||u)&&(m=!1,h=d,g=u);return h=null!==(s=h)&&void 0!==s&&s.length?h:null,g=null!==(i=g)&&void 0!==i&&i.length?g:null,{rows:h,removed:g,remote:m}}applyChangesToStore(e,t,n){const r=this,s=e.phantomIdField||r.phantomIdField,{store:a}=e,i=a.modelClass.getFieldDataSource("id"),o=a.modelClass.allFields.filter((e=>e.subStore)),{rows:l,removed:c,remote:d}=r.getRowsToApplyChangesTo(e,t,n),u=[],h=[];if(l)for(const e of l){var g;a.getById(null!==(g=e[s])&&void 0!==g?g:e[i])?h.push(e):u.push(e)}const m=[];h.length&&o.length&&h.forEach((e=>{var t,l,c;const d=a.getById(null!==(t=e[s])&&void 0!==t?t:e[i]),u=(null===(l=n.added)||void 0===l?void 0:l.find((t=>t[s]==e[s])))||(null===(c=n.updated)||void 0===c?void 0:c.find((t=>t[i]==e[i]))),h={};o.forEach((t=>{const n=d.get(t.name);r.applyChangesToStore({store:n},e[t.dataSource],null==u?void 0:u[t.dataSource]),h[t.dataSource]="foo",delete e[t.dataSource]})),m.push([d,h])}));const v=a.applyChangeset({removed:c,added:u,updated:h},null,s,d,!0);return m.forEach((([e,t])=>Object.assign(v.get(e.id),t))),v}applySyncResponse(e,t){const n=this,r=n.orderedCrudStores;n.applyingChangeset=n.applyingSyncResponse=!0,n.suspendChangesTracking();for(const a of r){var s;n.applyChangesToStore(a,e[a.storeId],null==t||null===(s=t.pack)||void 0===s?void 0:s[a.storeId])}n.resumeChangesTracking(!0),n.applyingChangeset=n.applyingSyncResponse=!1}applyLoadResponse(e,t){this.applyingLoadResponse=!0,this.loadCrudManagerData(e,t),this.applyingLoadResponse=!1}async applyResponse(e,t,n){const r=this;switch(r.trackResponseType&&t.type||e.type){case"load":r.validateResponse&&r.validateLoadResponse(t),r.applyLoadResponse(t,n);break;case"sync":r.validateResponse&&r.validateSyncResponse(t,e),r.applySyncResponse(t,e)}}applyChangeset(e,t=null,n,r=!1){const s=this,a=r?new Map:void 0;s.suspendAutoSync(),s.suspendChangesTracking();for(const{store:n,phantomIdField:i}of s.orderedCrudStores)if(e[n.id]){const o=n.applyChangeset(e[n.id],t,i||s.phantomIdField,!0,r);o&&a.set(n.id,o)}return s.resumeChangesTracking(!0),s.resumeAutoSync(!1),a}get requestId(){return Number.parseInt(`${Date.now()}${this._requestId++}`)}sync(){const e=this;return e.clearTimeout("autoSync"),e.activeRequests.sync?(e.trigger("syncDelayed"),e.activeSyncPromise=e.activeSyncPromise.finally((()=>e.sync()))):e.activeSyncPromise=new Promise(((t,n)=>{const r=e.getChangesetPackage();r?!1!==e.trigger("beforeSync",{pack:r})?(e.trigger("syncStart",{pack:r}),e.activeRequests.sync={type:"sync",pack:r,resolve:t,reject:n,id:r.requestId,desc:e.sendRequest({id:r.requestId,data:e.encode(r),type:"sync",success:e.onCrudRequestSuccess,failure:e.onCrudRequestFailure,thisObj:e})}):(e.trigger("syncCanceled",{pack:r}),n({cancelled:!0})):t(null)})).catch((e=>{if(e&&!e.cancelled)throw e;return e}))}async onCrudRequestSuccess(e,t,n){var r;const s=this,{type:a,id:i}=n;if(s.isDestroyed)return;let o="";n=s.activeRequests[a];try{o=await e.text()}catch(e){}if(s.isDestroyed)return;if((null===(r=n)||void 0===r?void 0:r.id)!==i)throw new Error(`Interleaved ${a} operation detected`);s.activeRequests[a]=null;const l=await s.internalOnResponse(n,o,t);if(!s.isDestroyed){if(!l||(s.skipSuccessProperty?!1===(null==l?void 0:l.success):null==l||!l.success)){const t={rawResponse:e,response:l,request:n};null!=l&&l.message&&(t.message=l.message),n.reject(new it(t))}s["crud"+d.capitalize(n.type)+"ed"]=!0,n.resolve({response:l,rawResponse:e,responseText:o,request:n})}}async onCrudRequestFailure(e,t,n){var r;const s=this;if(s.isDestroyed)return;n=s.activeRequests[n.type];const a=null==t||null===(r=t.abortController)||void 0===r?void 0:r.signal;if(!Boolean(null==a?void 0:a.aborted)){let r,a="";try{a=await e.text(),r=s.decode(a)}catch(e){}if(s.isDestroyed)return;if(s.triggerFailedRequestEvents(n,r,a,t),s.isDestroyed)return;n.reject(new it({rawResponse:e,request:n}))}s.activeRequests[n.type]=null}acceptChanges(){this.crudStores.forEach((e=>e.store.acceptChanges()))}revertChanges(){this.revertCrudStoreChanges()}revertCrudStoreChanges(){this.orderedCrudStores.forEach((e=>e.store.revertChanges()))}doDestroy(){const e=this,{load:t,sync:n}=e.activeRequests;for(t&&e.cancelRequest(t.desc,t.reject),n&&e.cancelRequest(n.desc,n.reject);e.crudStores.length>0;)e.removeCrudStore(e.crudStores[0]);super.doDestroy&&super.doDestroy()}},h(t,"configurable",{loadUrl:null,syncUrl:null,forceSync:null}),t},ut=e=>class t extends(e||l){static get $name(){return"AjaxTransport"}static get defaultMethod(){return{load:"GET",sync:"POST"}}cancelRequest(e,t){var n;null===(n=e.abort)||void 0===n||n.call(e),this.isDestroying||t({cancelled:!0})}shouldUseBodyForRequestData(e,t,n){return!("HEAD"===t||"GET"===t||n)}sendRequest(e){const n=this,{data:r}=e,s=n.transport[e.type]||{},a=u.assign({},s,s.requestConfig);e.url&&(a.url=e.url),a.method=a.method||t.defaultMethod[e.type],a.params=u.assign(a.params||{},e.params);let i,o,{paramName:l}=a;if(n.shouldUseBodyForRequestData(s,a.method,l)?(a.body=r,a.headers=a.headers||{},a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json"):(l=l||"data",a.params[l]=r),!a.url)throw new Error("Trying to request without URL specified");function c(){a.queryParams=a.params,delete a.params;let t=!1;const r=u.assign({},a,a.fetchOptions);return i=g.fetch(a.url,r),i.catch((e=>{var s,a;i.done=!0,null===(s=n.trigger)||void 0===s||s.call(n,"responseReceived",{success:!1});const o=null===(a=r.abortController)||void 0===a?void 0:a.signal;return o&&(t=o.aborted,t||console.warn(e)),{error:e,cancelled:t}})).then((t=>{var s;i.done=!0,null===(s=n.trigger)||void 0===s||s.call(n,"responseReceived",{success:Boolean(null==t?void 0:t.ok)});const a=null!=t&&t.ok?e.success:e.failure;return null==a?void 0:a.call(e.thisObj||n,t,r,e)}))}delete a.requestConfig,delete a.paramName;const d=n.trigger("beforeSend",{params:a.params,type:e.type,requestConfig:a,config:e});return o=u.isPromise(d)?d.then(c):c(),o.abort=()=>{var e,t;i.done||(null===(e=(t=i).abort)||void 0===e||e.call(t))},o}},ht=e=>class extends(e||l){static get $name(){return"JsonEncoder"}static get defaultConfig(){return{encoder:{}}}encode(e){var t;return e=Object.assign({},null===(t=this.encoder)||void 0===t?void 0:t.requestData,e),d.safeJsonStringify(e)}decode(e){return d.safeJsonParse(e)}},gt=e=>{var t;return t=class extends(e.mixin(m)){static get $name(){return"CrudManagerView"}afterConstruct(){super.afterConstruct();const{crudManager:e,project:t}=this;this.loadMask&&(e||t).isCrudManagerLoading&&this.onCrudManagerLoadStart()}applySyncMask(){const{syncMask:e}=this;e&&(this.masked=v.mergeConfigs(this.loadMaskDefaults,e))}bindCrudManager(e){this.detachListeners("crudManager"),null==e||e.ion({name:"crudManager",loadStart:"onCrudManagerLoadStart",load:"onCrudManagerLoad",loadCanceled:"onCrudManagerLoadCanceled",syncStart:"onCrudManagerSyncStart",sync:"onCrudManagerSync",syncCanceled:"onCrudManagerSyncCanceled",requestFail:"onCrudManagerRequestFail",responseReceived:"onAjaxTransportResponseReceived",thisObj:this})}onCrudManagerLoadStart(){var e;this.applyLoadMask(),null===(e=this.toggleEmptyText)||void 0===e||e.call(this)}onCrudManagerSyncStart(){this.applySyncMask()}onCrudManagerRequestFinalize(e=!0,t,n){const r=this;var s;e?null===(s=r.toggleEmptyText)||void 0===s||s.call(r):(r.masked||r.applyLoadMask(),r.applyMaskError(`<div class="b-grid-load-failure">\n                    <div class="b-grid-load-fail">${r.L(`L{GridBase.${t}FailedMessage}`)}</div>\n                    ${n&&n.message?`<div class="b-grid-load-fail">${r.L("L{CrudManagerView.serverResponseLabel}")} ${n.message}</div>`:""}\n                </div>`))}onCrudManagerLoadCanceled(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSyncCanceled(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerLoad(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSync(){this.onCrudManagerRequestFinalize(!0,"sync"),this.refresh()}onCrudManagerRequestFail({requestType:e,response:t}){this.onCrudManagerRequestFinalize(!1,e,t)}onAjaxTransportResponseReceived(){const e=this;null!=e.clearMaskDelay?e.setTimeout((()=>e.masked=null),e.clearMaskDelay):e.masked=null}get widgetClass(){}},h(t,"config",{clearMaskDelay:null,testConfig:{clearMaskDelay:0}}),t},mt=e=>class extends(e||l){static get $name(){return"PartOfProject"}},vt=e=>class extends e{static get $name(){return"AssignmentModelMixin"}static get fields(){return["resourceId","eventId",{name:"drawDependencies",type:"boolean"},"event","resource"]}construct(e,...t){const n=(e=e||{})[this.fieldMap.eventId.dataSource],r=e[this.fieldMap.resourceId.dataSource];null!=n&&(e.event=n),null!=r&&(e.resource=r),super.construct(e,...t)}get eventResourceKey(){return this.buildEventResourceKey(this.event,this.resource)}buildEventResourceKey(e,t){let n,r;return n=e?e.isModel?e.id:e:this.internalId,r=t?t.isModel?t.id:t:this.internalId,`${n}-${r}`}buildIndexKey({event:e,resource:t}){return this.buildEventResourceKey(e,t)}set(e,t,...n){const r=this.fieldToKeys(e,t);var s,a;"resource"in r?null!==(s=r.resource)&&void 0!==s&&s.id&&(r.resourceId=r.resource.id):"resourceId"in r&&this.constructor.isProAssignmentModel&&(r.resource=r.resourceId);"event"in r?null!==(a=r.event)&&void 0!==a&&a.id&&(r.eventId=r.event.id):"eventId"in r&&this.constructor.isProAssignmentModel&&(r.event=r.eventId);return super.set(r,null,...n)}afterChange(e,t,n,r,s){var a,i;const o=this;return!o.constructor.isProAssignmentModel&&null!=t&&t.resourceId&&(null===(a=o.resource)||void 0===a?void 0:a.id)!==t.resourceId.value?o.resource=t.resourceId.value:!(o.constructor.isProAssignmentModel&&null!==(i=o.project)&&void 0!==i&&i.propagatingSyncChanges&&null!=t&&t.eventId)||null!=t&&t.event||e.event.value!==t.eventId.value&&e.event.value.id!==t.eventId.value||(delete t.eventId,delete o.meta.modified.eventId),super.afterChange(...arguments)}set resourceId(e){const{resource:t}=this;null!=t&&t.isModel&&t.id===e?this.set("resourceId",e):this.resource=e}get resourceId(){var e;return this.get("resourceId")||(null===(e=this.resource)||void 0===e?void 0:e.id)}set eventId(e){const{event:t}=this;null!=t&&t.isModel&&t.id===e?this.set("eventId",e):this.event=e}get eventId(){var e;return this.get("eventId")||(null===(e=this.event)||void 0===e?void 0:e.id)}get eventName(){var e;return null===(e=this.event)||void 0===e?void 0:e.name}get resourceName(){var e;return null===(e=this.resource)||void 0===e?void 0:e.name}getResource(){return this.resource}get isAssignment(){return!0}get isPersistable(){var e;const{event:t,resource:n,unjoinedStores:r,assignmentStore:s}=this,a=null==s?void 0:s.crudManager;let i;return i=s?this.isValid&&t.isPersistable&&(a||!t.hasGeneratedId&&!n.hasGeneratedId):!this.isPhantom&&Boolean(r[0]),i&&super.isPersistable&&!(null!==(e=this.event)&&void 0!==e&&e.isCreating)}get isValid(){return null!=this.resource&&null!=this.event}toString(){return this.resourceName?`${this.resourceName} ${Math.round(this.units)}%`:""}shouldRecordFieldChange(e,t,n){if(!super.shouldRecordFieldChange(e,t,n))return!1;if("event"===e||"eventId"===e){var r;const e=null===(r=this.project)||void 0===r?void 0:r.eventStore;if(e&&e.oldIdMap[t]===e.getById(n))return!1}if("resource"===e||"resourceId"===e){var s;const e=null===(s=this.project)||void 0===s?void 0:s.resourceStore;if(e&&e.oldIdMap[t]===e.getById(n))return!1}return!0}};const pt=Be;class ft extends(vt(mt(pt.derive(s)))){static get $name(){return"AssignmentModel"}get resource(){return super.resource}set resource(e){super.resource=e,this.setChanged("resourceId",this.constructor.asId(e))}}ft.exposeProperties(),ft._$name="AssignmentModel";var yt=e=>class extends e{static get $name(){return"AssignmentStoreMixin"}static get defaultConfig(){return{loadPriority:300,syncPriority:300,storeId:"assignments"}}add(e,...t){e=c.asArray(e);for(let t=0;t<e.length;t++){var n;let r=e[t];if(r instanceof s||(e[t]=r=this.createRecord(r)),!this.isSyncingDataOnLoad&&-1!==this.storage.findIndex("eventResourceKey",r.eventResourceKey,!0))throw new Error(`Duplicate assignment Event: ${r.eventId} to resource: ${r.resourceId}`);null!==(n=r.event)&&void 0!==n&&n.isCreating&&(r.isCreating=!0)}return super.add(e,...t)}includesAssignment(e,t){return-1!==this.storage.findIndex("eventResourceKey",`${e}-${t}`,!0)}setStoreData(e){super.setStoreData(e)}set storage(e){super.storage=e,this.storage.addIndex({property:"eventResourceKey",dependentOn:{event:!0,resource:!0}})}get storage(){return this._storage||super.storage}get isAssignmentStore(){return!0}getOccurrence(e,t){if(!e||null==t||!t.isOccurrence)return e;const n=this;return{id:`${t.id}:a${e.id}`,event:t,resource:e.resource,eventId:t.id,resourceId:e.resource.id,isAssignment:!0,isOccurrenceAssignment:!0,instanceMeta(e){return n.occurrenceInstanceMeta(this,e)}}}occurrenceInstanceMeta(e,t){const n=this,r=t.id||t,{id:s}=e;let{occurrenceMeta:a}=n;return a||(a=n.occurrenceMeta={}),a[s]||(a[s]={}),a[s][r]||(a[s][r]={})}mapAssignmentsForEvent(e,t,n){e=this.eventStore.getById(e);const r=Boolean(t),s=Boolean(n);return r||s?e.assignments.reduce(((e,a)=>{const i=r?t(a):a;return s&&!n(i)||e.push(i),e}),[]):e.assignments}mapAssignmentsForResource(e,t,n){e=this.resourceStore.getById(e);const r=Boolean(t),s=Boolean(n);return r||s?e.assignments.reduce(((e,a)=>{const i=r?t(a):a;return s&&!n(i)||e.push(i),e}),[]):e.assignments}getAssignmentsForEvent(e){return e.assignments}removeAssignmentsForEvent(e){return this.remove(e.assignments)}getAssignmentsForResource(e){return(e=this.resourceStore.getById(e)).assignments}removeAssignmentsForResource(e){this.remove(this.getAssignmentsForResource(e))}getResourcesForEvent(e){return e.resources}getEventsForResource(e){var t;return null===(t=e=this.resourceStore.getById(e))||void 0===t?void 0:t.events}assignEventToResource(e,t,n=null,r=!1){var s;const a=this,i=r?new Set(e.assignments):null;if(t=c.asArray(t).map((e=>{var t;return null!==(t=e.$original)&&void 0!==t?t:e})),null!==(s=a.eventStore)&&void 0!==s&&s.usesSingleAssignment){var o;if(null!==(o=e.assignments)&&void 0!==o&&o.length)return a.isEventAssignedToResource(e,t[0])||(e.resource=t[0]),[];e.resourceId=t[0].id}let l=[];return a.suspendAutoCommit(),t.forEach((t=>{const s=a.getAssignmentForEventAndResource(e,t);if(s)r&&i.delete(s);else{var o;const r={event:e,resource:t};l.push(null!==(o=null==n?void 0:n(r))&&void 0!==o?o:r)}})),l=a.add(l),r&&a.remove(Array.from(i)),a.resumeAutoCommit(),l}unassignEventFromResource(e,t){const n=this,r=[];if(!t)return n.removeAssignmentsForEvent(e);t=c.asArray(t);for(let s=0;s<t.length;s++)n.isEventAssignedToResource(e,t[s])&&r.push(n.getAssignmentForEventAndResource(e,t[s]));return n.remove(r)}isEventAssignedToResource(e,t){return Boolean(this.getAssignmentForEventAndResource(e,t))}getAssignmentForEventAndResource(e,t){let n;return(e=this.eventStore.getById(e))&&(n=e.assignments)&&(t=this.resourceStore.$master.getById(t))?this.getOccurrence(n.find((e=>{var n;return(null===(n=e.resource)||void 0===n?void 0:n.$original)===t.$original})),e):null}};const St=mt(Ve.derive(p));class Dt extends(yt(St)){static get defaultConfig(){return{modelClass:ft}}}h(Dt,"$name","AssignmentStore"),Dt._$name="AssignmentStore";var Ct=e=>class extends(e||l){static get $name(){return"ResourceStoreMixin"}get isResourceStore(){return!0}static get defaultConfig(){return{loadPriority:200,syncPriority:100,storeId:"resources",autoTree:!0}}construct(e){if(super.construct(e),!this.modelClass.isResourceModel)throw new Error("Model for ResourceStore must subclass ResourceModel")}removeAll(){const e=super.removeAll(...arguments);return e&&this.assignmentStore.removeAll(),e}onRecordIdChange({record:e,oldValue:t,value:n}){super.onRecordIdChange({record:e,oldValue:t,value:n}),e.isFieldModified("id")&&(this.isChangingId=!0,e.updateAssignmentResourceIds(),this.isChangingId=!1)}get allResourceRecords(){return this._allResourceRecords||(this._allResourceRecords=this.getAllDataRecords())}getAvailableResources({startDate:e,endDate:t}){return this.query((n=>this.eventStore.isDateRangeAvailable(e,t,null,n)))}},Rt=e=>class extends e{static get $name(){return"ResourceModelMixin"}static get isResourceModel(){return!0}static get fields(){return[{name:"name",type:"string",persist:!0},"eventColor","eventStyle","imageUrl","image",{name:"resourceMargin",type:"number"},{name:"barMargin",type:"number"},"eventLayout"]}updateAssignmentResourceIds(){this.assigned.forEach((e=>{e.resourceId=this.id}))}syncId(e){super.syncId(e),this.updateAssignmentResourceIds()}get events(){return this.assignments.reduce(((e,t)=>(t.event&&e.push(t.event),e)),[])}get assignments(){return this.assigned?[...this.assigned]:[]}set assignments(e){e.forEach((e=>{e.resource=this}))}getEvents(){return this.events}get isPersistable(){return super.isPersistable&&(!this.parent||this.parent.isPersistable)}unassignAll(){this.assignments&&this.assignmentStore.remove(this.assignments)}get initials(){const{name:e=""}=this;if(!e)return"";const t=e.split(" ");return t[0][0]+(t.length>1?t[t.length-1][0]:"")}isWorkingTime(e){var t,n;const r=this.effectiveCalendar||(null===(t=this.project)||void 0===t?void 0:t.calendar);return!r||(null===(n=r.isWorkingTime)||void 0===n?void 0:n.call(r,e))}};const Et=Le;class It extends(Rt(mt(Et.derive(I)))){static get $name(){return"ResourceModel"}}It.exposeProperties(),It._$name="ResourceModel";const Tt=mt(Qe.derive(p));class xt extends(Ct(Tt)){static get defaultConfig(){return{modelClass:It}}}xt._$name="ResourceStore";var bt=t=>class extends(t||l){static get $name(){return"EventStoreMixin"}construct(e){super.construct(e),this.autoTree=!0}set filtersFunction(e){super.filtersFunction=e}get filtersFunction(){const e=super.filtersFunction;return e&&e!==f.returnTrue?t=>t.isCreating||e(t):e}getEventCounts(e){const t=this,{filtersFunction:n,added:s}=t,a=t.getEvents(r(r({},e),{},{storeFilterFn:t.isFiltered?t.reapplyFilterOnAdd?n:e=>s.includes(e)?t.indexOf(e)>-1:n(e):null,dateMap:e.dateMap||!0}));return a.forEach(((e,t)=>a.set(t,e.length))),a}forEachScheduledEvent(e,t=this){this.forEach((n=>{const{startDate:r,endDate:s}=n;if(r&&s)return e.call(t,n,r,s)}))}getTotalTimeSpan(){let t=new Date(9999,0,1),n=new Date(0);return this.forEach((r=>{r.startDate&&(t=e.min(r.startDate,t)),r.endDate&&(n=e.max(r.endDate,n))})),t=t<new Date(9999,0,1)?t:null,n=n>new Date(0)?n:null,this.lastTotalTimeSpan={startDate:t||null,endDate:n||t||null}}isEventPersistable(e){return e.isPersistable}isDateRangeAvailable(t,n,r,s){if(s.data.generatedParent)return!1;const a=new Set(this.getEventsForResource(s));if(null!=r&&r.isAssignment){r.event.resources.forEach((e=>{e.id!==r.resourceId&&this.getEventsForResource(e).forEach((e=>a.add(e)))}))}if(r){const e=r.isAssignment?r.event:r;a.delete(e)}return!Array.from(a).some((r=>r.isScheduled&&e.intersectSpans(t,n,r.startDate,r.endDate)))}filterEventsForResource(e,t,n=this){return e.getEvents(this).filter(t.bind(n))}getResourcesForEvent(e){return e.isOccurrence&&(e=e.recurringTimeSpan),this.assignmentStore.getResourcesForEvent(e)}getEventsForResource(e){return this.assignmentStore.getEventsForResource(e)}getAssignmentsForEvent(e){return this.assignmentStore.getAssignmentsForEvent(e)||[]}getAssignmentsForResource(e){return this.assignmentStore.getAssignmentsForResource(e)||[]}assignEventToResource(e,t,n=!1){return this.assignmentStore.assignEventToResource(e,t,void 0,n)}unassignEventFromResource(e,t){this.assignmentStore.unassignEventFromResource(e,t)}reassignEventFromResourceToResource(e,t,n){const r=this,a=s.asId(n),i=r.assignmentStore.getAssignmentForEventAndResource(e,t);i?i.resourceId=a:r.assignmentStore.assignEventToResource(e,n)}isEventAssignedToResource(e,t){return this.assignmentStore.isEventAssignedToResource(e,t)}removeAssignmentsForEvent(e){this.assignmentStore.removeAssignmentsForEvent(e)}removeAssignmentsForResource(e){this.assignmentStore.removeAssignmentsForResource(e)}};const Mt=()=>!0;var At=t=>{var n;return h(n=class extends t{getEvents({filter:t,date:n,startDate:r,endDate:s,startOnly:a,includeOccurrences:i,allowPartial:o,onlyAssigned:l=!1,dateMap:c=!1,dayTime:d=null,getDateIndex:h}){const g=this,m=arguments[0],{lastDateRange:v,added:p,filtersFunction:f}=g,y=t;if(l&&(m.filter=y?e=>y(e)&&e.resources.length:e=>e.resources.length),"startDate"in m||(r=m.startDate=n),"includeOccurrences"in m||(i=m.includeOccurrences=!0),"allowPartial"in m||(o=m.allowPartial=!a),m.storeFilterFn=g.isFiltered&&!m.ignoreFilters?g.reapplyFilterOnAdd?f:e=>p.includes(e)?g.indexOf(e)>-1:f(e):null,!s)if(r)(s=m.endDate=e.clearTime(r)).setDate(s.getDate()+1);else{if(i)throw new Error("getEvents MUST be passed startDate and endDate if recurring occurrences are requested");m.dateFilter=Mt}m.dateFilter||(m.dateFilter=a?t=>{const n=t.hasBatchedChange("startDate")?t.get("startDate"):t.startDate;return n&&!(e.clearTime(n)-r)}:o?t=>{const n=t.hasBatchedChange("startDate")?t.get("startDate"):t.startDate,a=t.hasBatchedChange("endDate")?t.get("endDate"):t.endDate||n;return n&&(!(n-a)?e.betweenLesserEqual(n,r,s):e.intersectSpans(n,a,r,s))}:e=>{const t=e.hasBatchedChange("startDate")?e.get("startDate"):e.startDate,n=e.hasBatchedChange("endDate")?e.get("endDate"):e.endDate||t;return t&&t>=r&&n<=s});const S={startDate:r,endDate:s};return g.processConfiguredListeners(),g.trigger("loadDateRange",{old:v||{},new:u.clone(S),changed:!v||v.startDate-S.startDate||v.endDate-S.endDate}),g.lastDateRange=u.clone(S),c?g.getEventsAsMap(m):g.getEventsAsArray(m)}getEventsAsArray({filter:e,date:t,resourceRecord:n,startDate:r=t,endDate:s,startOnly:a,includeOccurrences:i=!0,dayTime:o=null,dateFilter:l,storeFilterFn:c,getDateIndex:d}){const u=this,h=[];if(c?u.count:u.allCount){let e=n?u.getEventsForResource(n):null;if(!n){const t=u.useDayIndex(o),n=new Set,i=a?"startDate":"date";u.recurringEvents.forEach((e=>{t.dayTime.startOfDay(e.startDate)<=r&&n.add(e)}));for(const e=new Date(r);e<s;e.setDate(e.getDate()+1)){const r=t.get(d?d(e):i,e);null==r||r.forEach((e=>n.add(e)))}e=[...n]}c&&(e=e.filter(c));for(let t=0,{length:n}=e;t<n;t++){const n=e[t];i&&n.isRecurring?h.push.apply(h,n.getOccurrencesForDateRange(r,s).filter(l)):l(n)&&h.push(n)}}return e?h.filter(e):h}getEventsAsMap({filter:t,date:n,resourceRecord:r,startDate:s=n,endDate:a,startOnly:i,includeOccurrences:o=!0,dateMap:l,dayTime:c=null,storeFilterFn:d,getDateIndex:u}){var h;const g=this;if(null!==(h=l)&&void 0!==h&&h.clear?l.clear():l=new Map,g.count){const n=g.useDayIndex(c),h=i?"startDate":"date",p=[],f=e=>(!t||t(e))&&(!d||d(e)),y=e=>!e.isRecurring&&f(e);if(c=n.dayTime,r)throw new Error("Querying for events for a resource and returning a date-keyed Map is not supported");var m;null===(m=g.recurringEvents)||void 0===m||m.forEach((e=>{c.startOfDay(e.startDate)<a&&p.push(e)}));for(const e=new Date(s);e<a;e.setDate(e.getDate()+1)){var v;let[t,r]=n.get(u?u(e):h,e,!0);null!==(v=t)&&void 0!==v&&v.size&&(t=[...t].filter(y),t.length&&(l.get(r)||l.set(r,[]).get(r)).push(...t))}for(let t=0,{length:n}=p;t<n;t++){const n=p[t],r=(o?n.getOccurrencesForDateRange(s,a):[n]).filter(f),d=e.add(a,1,"day");for(let t,n=0,{length:s}=r;n<s;n++){const s=r[n],a=c.startOfDay(s.startDate),o="startDate"===(u?u(a):i?"startDate":"date")||s.allDay?e.add(a,1,"day"):e.min(s.endDate||e.add(s.startDate,s.duration,s.durationUnit),d);for(;a<o;a.setDate(a.getDate()+1)){const e=c.dateKey(a);(t=l.get(e))||l.set(e,t=[]),t.push(s)}}}}return l}},"$name","GetEventsMixin"),n};const wt={date:"_dateIndex",startDate:"_startDateIndex"},jt=Object.values(wt),Ot=Object.freeze([]),{MILLIS_PER_DAY:Ft}=y;class Pt{constructor(e,t){this.dayTime=t||y.MIDNIGHT,this.store=e,this.users=[this.dayTime]}add(e,t,n){const r=this[wt[e]],s=this.dayTime.dateKey(t);(r[s]||(r[s]=new Set)).add(n)}addEvent(e){var t;let n,r=null===(t=this.dayTime.startOfDay(e.startDate))||void 0===t?void 0:t.getTime();if(r){var s,a;n=null!==(s=null===(a=e.endDate)||void 0===a?void 0:a.getTime())&&void 0!==s?s:r,this.add("startDate",r,e);do{this.add("date",r,e),r+=Ft}while(r<n)}}clear(){jt.forEach((e=>this[e]=Object.create(null)))}get(e,t,n){!this.initialized&&this.initialize();let r,s=this[wt[e]];return t&&(r=this.dayTime.dateKey(t),s=n?[s[r],r]:s[r]),s}initialize(){this.initialized=!0,this.clear(),this.sync("splice",this.store.storage.allValues)}invalidate(){this.initialized=!1,jt.forEach((e=>this[e]=null))}matches(e){return this.dayTime.startShift===e.startShift}remove(e,t,n){const r=this[wt[e]][this.dayTime.dateKey(t)];r&&r.delete(n)}removeEvent(e,t,n){var r;let s,a=null===(r=this.dayTime.startOfDay(t))||void 0===r?void 0:r.getTime();if(a){var i;s=null!==(i=null==n?void 0:n.getTime())&&void 0!==i?i:a,this.remove("startDate",a,e);do{this.remove("date",a,e),a+=Ft}while(a<s)}}sync(e,t,n,r,s){var a,i;n=n||Ot;const o=this,l=(t=t||Ot).length,c=n.length,d=null==r?void 0:r.length;let u,h,g;if(o.initialized)switch(e){case"clear":o.clear();break;case"splice":if(d)for(t=t.slice(),n=n.slice(),u=0;u<d;u++)n.push(r[u][0]),t.push(r[u][1]);if(c)for(u=0;u<c;u++)g=n[u],o.removeEvent(g,g.startDate,g.endDate);if(l)for(u=0;u<l;u++)h=t[u],h.isScheduled&&!h.isParent&&o.addEvent(h);break;case"reschedule":g=t[0],o.removeEvent(g,(null===(a=s.startDate)||void 0===a?void 0:a.oldValue)||g.startDate,(null===(i=s.endDate)||void 0===i?void 0:i.oldValue)||g.endDate),o.sync("splice",t)}}register(e){this.users.push(e)}unregister(e){const{users:t}=this,n=t.indexOf(e);return n>-1&&t.splice(n,1),!t.length}}const kt=Pt.prototype;jt.forEach((e=>kt[e]=null)),kt.initialized=!1,Pt._$name="EventDayIndex";const{MIDNIGHT:$t}=y;var Nt=e=>{var t;return h(t=class extends e{construct(e){super.construct(e),this.dayIndices=null}afterLoadData(){var e;this.syncIndices("splice",this.storage.allValues),null===(e=super.afterLoadData)||void 0===e||e.call(this)}onDataChange({action:e,added:t,removed:n,replaced:r}){this.syncIndices(e,t,n,r),super.onDataChange(...arguments)}onDataReplaced(e,t){this.syncIndices("clear"),this.syncIndices("splice",this.storage.values),super.onDataReplaced(e,t)}onModelChange(e,t,n,r,s){("startDate"in n||"endDate"in n)&&this.syncIndices("reschedule",[e],null,null,n),super.onModelChange(...arguments)}invalidateDayIndices(){var e;null===(e=this.dayIndices)||void 0===e||e.forEach((e=>e.invalidate()))}registerDayIndex(e){const t=this,n=t.dayIndices||(t.dayIndices=[]);let r,s;for(s=0;!r&&s<n.length;++s)n[s].matches(e)&&(r=n[s]).register(e);return!r&&n.push(r=new Pt(t,e)),r}syncIndices(...e){var t;null===(t=this.dayIndices)||void 0===t||t.forEach((t=>t.sync(...e)))}unregisterDayIndex(e){const{dayIndices:t}=this;for(let n=null==t?void 0:t.length;n-- >0;)if(t[n].matches(e)){t[n].unregister(e)&&t.splice(n,1);break}}useDayIndex(e){const t=this,{dayIndices:n}=t;e=e||$t;for(let t=0;n&&t<n.length;++t)if(n[t].matches(e))return n[t];if(e.startShift)throw new Error(`No day index registered for ${e} on ${t.id}`);return t.registerDayIndex($t)}},"$name","DayIndexMixin"),t},Lt=e=>class extends e{static get $name(){return"SharedEventStoreMixin"}static get defaultConfig(){return{loadPriority:100,syncPriority:200,storeId:"events",removeUnassignedEvent:!0,singleAssignment:null}}construct(e){if(super.construct(e,!0),this.singleAssignment&&(this.usesSingleAssignment=!0),!this.modelClass.isEventModel)throw new Error("The model for the EventStore must subclass EventModel")}append(e){return this.add(e)}get project(){return super.project}set project(e){var t;(super.project=e,this.detachListeners("project"),e)&&(null!==(t=e.assignmentStore)&&void 0!==t&&t.isAssignmentStore&&this.attachToAssignmentStore(e.assignmentStore),e.ion({name:"project",assignmentStoreChange:"onProjectAssignmentStoreChange",thisObj:this,prio:200}))}get usesSingleAssignment(){return this.isChained?this.masterStore.usesSingleAssignment:this._usesSingleAssignment}set usesSingleAssignment(e){this._usesSingleAssignment=e}processRecords(e){var t;const{assignmentStore:n}=this,r=[];return n&&(n.skipInvalidateIndices=!0),e=super.processRecords(e,n&&!(null!==(t=this.stm)&&void 0!==t&&t.isRestoring)&&(e=>{const t=e.get("resourceId");e.reassignedFromReplace||null==t||n.includesAssignment(e.id,t)||r.push({id:n.modelClass.generateId(""),resourceId:t,eventId:e.id}),e.reassignedFromReplace=!1})||void 0),n&&(n.storage.invalidateIndices(),n.skipInvalidateIndices=!1,n.add(r)),e}joinRecordsToStore(e){const{assignmentStore:t}=this;t?(t.skipInvalidateIndices=!0,super.joinRecordsToStore(e),t.storage.invalidateIndices(),t.skipInvalidateIndices=!1):super.joinRecordsToStore(e)}processRecord(e,t=!1){const n=(e=super.processRecord(e,t)).get("resourceId");if(null!=n&&!e.meta.skipEnforcingSingleAssignment){const r=this,{assignmentStore:s}=r,a=r.getById(e.id);if(a&&a!==e&&!t){const t=s.find((t=>t.eventId===e.id));t&&(t.resource=n,e.reassignedFromReplace=!0)}else r.$processResourceIds=!0;r.usesSingleAssignment=!0}return e}processResourceIds(){const{assignmentStore:e}=this;if(this.$processResourceIds&&null!=e&&e.isAssignmentStore&&!this.project.isSharingAssignmentStore){const t=[];this.forEach((n=>{const{resourceId:r,id:s}=n;null!=r&&t.push({id:e.modelClass.generateId(""),resourceId:r,eventId:s})})),e.useRawData={disableDefaultValue:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0},e.usesSingleAssignment=!1,e.verifyNoGeneratedIds=!1,e.data=t,e.usesSingleAssignment=!0,this.$processResourceIds=!1}}loadData(){super.loadData(...arguments),this.processResourceIds()}onBeforeRemoveAssignment({records:e}){var t;const n=this;if(n.removeUnassignedEvent&&!n.isRemoving&&!n.isSettingData&&(null===(t=n.stm)||void 0===t||!t.isRestoring)&&!n.usesSingleAssignment&&!n.assignmentStore.isSyncingDataOnLoad&&!n.resourceStore.isSyncingDataOnLoad){const t=new Set;e.forEach((n=>{const{event:r}=n;r&&!r.isRemoved&&r.assignments.every((t=>e.includes(t)))&&t.add(r)})),t.size&&n.remove([...t])}}onProjectAssignmentStoreChange({store:e}){this.attachToAssignmentStore(e)}attachToAssignmentStore(e){const t=this;t.detachListeners("assignmentStore"),e&&(t.processResourceIds(),e.ion({name:"assignmentStore",addPreCommit({records:e}){!t.usesSingleAssignment||t.isSettingData||t.isAssigning||e.forEach((e=>{const{event:t}=e;null!=t&&t.isEvent&&t.resourceId!==e.resourceId&&(t.meta.isAssigning=!0,t.set("resourceId",e.resourceId),t.meta.isAssigning=!1)}))},beforeRemove:"onBeforeRemoveAssignment",removePreCommit({records:e}){t.usesSingleAssignment&&e.forEach((e=>{var n;null===(n=t.getById(e.eventId))||void 0===n||n.set("resourceId",null)}))},removeAllPreCommit(){t.usesSingleAssignment&&!t.isSettingData&&t.allRecords.forEach((e=>e.set("resourceId",null)))},update({record:e,changes:n}){if(t.usesSingleAssignment&&"resourceId"in n){const{event:t}=e;t.meta.isAssigning=!0,t.set("resourceId",n.resourceId.value),t.meta.isAssigning=!1}},thisObj:t}))}set data(e){this.isSettingData=!0,!this.usesSingleAssignment||this.syncDataOnLoad||this.isChained||this.assignmentStore.removeAll(!0),super.data=e,this.isSettingData=!1}trigger(e,t){const{changes:n}=t||{};return n&&"resourceId"in n&&1===Object.keys(n).length&&(t.isAssign=!0),super.trigger(...arguments)}};const Bt=Object.freeze([]);var qt=e=>class extends(e||l){static get $name(){return"RecurringTimeSpansMixin"}construct(...e){this.globalOccurrences=new Map,this.recurringEvents=new Set,super.construct(...e)}afterLoadData(){this.globalOccurrences.clear(),this.refreshRecurringEventsCache("clear"),this.refreshRecurringEventsCache("splice",this.storage.allValues),super.afterLoadData&&super.afterLoadData()}onDataChange({action:e,added:t,removed:n,replaced:r}){this.refreshRecurringEventsCache(e,t,n,r),super.onDataChange(...arguments)}refreshRecurringEventsCache(e,t=Bt,n=Bt,r){const{recurringEvents:s}=this,a=null==r?void 0:r.length;switch(e){case"clear":s.clear();break;case"splice":{if(a){t=t.slice(),n=n.slice();for(let e=0;e<a;e++)n.push(r[e][0]),t.push(r[e][1])}const e=t.length,i=n.length;if(i&&s.size)for(let e=0;e<i;e++)s.delete(n[e]);if(e)for(let n=0;n<e;n++){const e=t[n];e.isRecurring&&s.add(e)}break}}}getById(e){let t=super.getById(e);return t||(t=this.globalOccurrences.get(this.modelClass.asId(e))),t}onModelChange(e,t,n,r,s){const a=this.isRecurrenceRelatedFieldChange(e,n);if(a&&!r&&e.removeOccurrences(),super.onModelChange(...arguments),a&&!r){const e={action:"batch",records:this.storage.values};this.trigger("refresh",e),this.trigger("change",e)}}isRecurrenceRelatedFieldChange(e,t){return e.isRecurring||"recurrenceRule"in t}getOccurrencesForTimeSpan(e,t,n){const r=[];return e.isRecurring&&e.recurrence.forEachOccurrence(t,n,(e=>r.push(e))),r}set data(e){this.globalOccurrences.clear(),super.data=e}getRecurringTimeSpans(){return[...this.recurringEvents]}},_t=e=>class extends(qt(e||l)){static get $name(){return"RecurringEventsMixin"}getRecurringEvents(){return this.getRecurringTimeSpans()}isEventPersistable(e){return super.isEventPersistable(e)&&(!e.supportsRecurring||!e.isOccurrence)}};const Vt={startDate:1,endDate:1,constraintDate:1,deadlineDate:1};var Yt=e=>{var n;return h(n=class extends(e||Ut){setLocalDate(e,n){this.set(e,this._inTimeZone?t.toTimeZone(n,this._inTimeZone):n,!0),this.data[e]=this[e]}getLocalDate(e){return this._inTimeZone&&this[e]?t.fromTimeZone(this[e],this._inTimeZone):this[e]}applyChangeset(e){const{_inTimeZone:t}=this;if(null!=t)for(const t in Vt)e[t]&&(this.setLocalDate(t,new Date(e[t])),delete e[t]);return super.applyChangeset(...arguments)}getFieldPersistentValue(e){if(this._inTimeZone){var t,n;const r=null!==(t=null!==(n=null==e?void 0:e.field)&&void 0!==n?n:null==e?void 0:e.name)&&void 0!==t?t:e;if(Vt[r])return this.getLocalDate(r)}return super.getFieldPersistentValue(e)}convertToTimeZone(e){const n=this,s=r({},n.meta.modified),i=r({},Vt);n.isTask&&!n.manuallyScheduled&&(delete i.startDate,delete i.endDate);for(const e in i)null!=n[e]?(i[e]=n[e],n._inTimeZone&&(i[e]=n.getLocalDate(e),s[e]&&(s[e]=t.fromTimeZone(s[e],n._inTimeZone)))):delete i[e];n._inTimeZone=e;for(const e in i)n.setLocalDate(e,i[e],!1),i[e]=1,n._inTimeZone&&s[e]&&(s[e]=t.toTimeZone(s[e],n._inTimeZone));n.clearChanges(!0,!0,i),a.isEmpty(s)||(n.meta.modified=s,n.stores.forEach((e=>e.modified.add(n))))}},"$name","TimeZonedDatesMixin"),n};class Ut extends(s.mixin(Yt)){static get $name(){return"TimeSpan"}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number",allowNull:!0,internal:!0},{type:"durationunit",name:"durationUnit",defaultValue:"d",internal:!0},{name:"fullDuration",persist:!1,column:{type:"duration"}},{name:"cls",defaultValue:"",internal:!0},{name:"iconCls",internal:!0},{name:"style",type:"object",internal:!0},{name:"name",type:"string",defaultValue:""}]}afterConstruct(){super.afterConstruct(),this.normalize()}get eventStore(){const e=this;if(e.isOccurrence)return e.recurringTimeSpan.eventStore;var t;e._eventStore||(e._eventStore=null===(t=e.stores)||void 0===t?void 0:t.find((e=>e.isEventStore)));return e._eventStore}normalize(){const t=this,{startDate:n,endDate:r,duration:s,durationUnit:a}=t,i=null!=s;n&&r&&!i?t.setData("duration",e.diff(n,r,a,!0)):n&&!r&&i?t.setData("endDate",e.add(n,s,a)):!n&&r&&i&&t.setData("startDate",e.add(r,-s,a))}updateInternalCls(e){this._cls?this._cls.value=e:this._cls=new S(e)}set internalCls(e){this.updateInternalCls(e),this.set("cls",this._cls.value)}get internalCls(){const{cls:e}=this;return null!=e&&e.isDomClassList?e:(this.internalCls=e,this._cls)}get cls(){return this._cls||(this._cls=new S(super.get("cls"))),this._cls}set cls(e){this.internalCls=e}get startDate(){return this.get("startDate")}set startDate(e){this.setStartDate(e)}get endDate(){return this.get("endDate")}set endDate(e){this.setEndDate(e)}get endingDate(){const t=this,{endDate:n,startDate:r}=t;return n||e.add(r,t.duration,t.durationUnit)}get duration(){return this.get("duration")}set duration(e){this.setDuration(e,this.durationUnit)}get durationUnit(){return this.get("durationUnit")}setDuration(t,n=this.durationUnit){const r={duration:t=parseFloat(t),durationUnit:n};this.startDate?r.endDate=e.add(this.startDate,t,n):this.endDate&&(r.startDate=e.add(this.endDate,-t,n)),this.set(r)}getDurationInUnit(t,n){return this.starDate&&this.endDate?e.getDurationInUnit(this.startDate,this.endDate,t,n):e.as(t,this.duration,this.durationUnit)}get fullDuration(){return new D({unit:this.durationUnit,magnitude:this.duration})}set fullDuration(t){"string"==typeof t&&(t=e.parseDuration(t,!0,this.durationUnit)),this.setDuration(t.magnitude,t.unit)}setStartDate(t,n=!0){const r=this,s={startDate:t};if(t){let a;if(n)a=null!=r.duration;else if(r.endDate){if(s.duration=e.diff(t,r.endDate,r.durationUnit,!0),s.duration<0)throw new Error("Negative duration")}else a=null!=this.duration;a&&(s.endDate=e.add(t,r.getDurationInUnit("h"),"h"))}else s.duration=null;r.set(s)}setEndDate(t,n=!1){const r=this,s={endDate:t};if(t){let a;if(!0===n)a=null!=r.duration;else if(r.startDate){if(s.duration=e.diff(r.startDate,t,r.durationUnit,!0),s.duration<0)throw new Error("Negative duration")}else a=null!=this.duration;a&&(s.startDate=e.add(t,-r.duration,r.durationUnit))}r.set(s)}setStartEndDate(e,t,n){this.set({startDate:e,endDate:t},null,n)}get dates(){const t=[],n=e.startOf(this.startDate,"day"),r=this.endDate;for(let s=n;s<r;s=e.add(s,1,"day"))t.push(s);return t}get startDateMS(){var e;return null===(e=this.batching&&this.hasBatchedChange("startDate")?this.get("startDate"):this.startDate)||void 0===e?void 0:e.getTime()}get endDateMS(){var e;return null===(e=this.batching&&this.hasBatchedChange("endDate")?this.get("endDate"):this.endDate)||void 0===e?void 0:e.getTime()}get durationMS(){const{endDateMS:t,startDateMS:n}=this;return t&&n?t-n:e.asMilliseconds(this.duration||0,this.durationUnit)}get isMilestone(){return 0===this.duration}inSetNormalize(t){if("string"!=typeof t){let{startDate:n,endDate:r,duration:s,durationUnit:i=this.durationUnit}=t;"string"==typeof n&&(n=this.getFieldDefinition("startDate").convert(n)),"string"==typeof r&&(r=this.getFieldDefinition("endDate").convert(r)),"duration"in t?(n&&!r&&(r=e.add(n,s,i,!0,!0)),!n&&r&&(n=e.add(r,-s,i,!0,!0))):n&&r&&(s=e.as(i,e.diff(n,r,"h",!0),"h"));const o=Object.isFrozen(t)?a.clone(t):t;return n&&(o.startDate=n),r&&(o.endDate=r),null!=s&&(o.duration=s),o}}inSet(e,t,n,r,s,a){return s||(e=this.inSetNormalize(e)||e),super.inSet(e,t,n,r,s,a)}applyValue(e,t,n,r,s){"cls"===t&&this.updateInternalCls(n),"fullDuration"===t&&(this[t]=n),super.applyValue(e,t,n,r,s)}forEachDate(e,t){return this.dates.forEach(e.bind(t))}get isScheduled(){const{startDateMS:e,endDateMS:t}=this;return t-e>=0}get isValid(){const{startDate:e,endDate:t}=this;return!e||!t||t-e>=0}shift(t,n=this.durationUnit){if("string"==typeof t){const e=t;t=n,n=e}return this.setStartDate(e.add(this.startDate,t,n,!0),!0)}get wbsCode(){return this._wbsCode||this.indexPath.join(".")}set wbsCode(e){this._wbsCode=e}fullCopy(){return this.copy.apply(this,arguments)}intersects(e){return this.intersectsRange(e.startDate,e.endDate)}intersectsRange(t,n){const r=this.startDate,s=this.endDate;return r&&s&&e.intersectSpans(r,s,t,n)}split(t=.5){const n=this,r=n.copy(),{fullDuration:s,eventStore:a,assignmentStore:i}=n,o=new D(s),l=new D(s);let c,d;return"string"==typeof t?(c=new D(t),c.unit===o.unit?l.magnitude-=c.magnitude:(l.magnitude=e.as(c.unit,o)-c.magnitude,l.unit=c.unit,d=!0)):(c=new D(t>1?t:n.duration*t,n.durationUnit),l.magnitude-=c.magnitude),r.startDate=e.add(n.startDate,c.magnitude,c.unit),d?(r.fullDuration=l,n.fullDuration=c):(r.duration=l.magnitude,n.duration=c.magnitude),a&&(a.add(r),i&&!a.usesSingleAssignment&&i.add(n.assignments.map((e=>{const t=Object.assign({},e.data,{eventId:r.id,event:null,resource:null});return delete t.id,t})))),r}toICSString(t={}){if(!this.isScheduled)return"";const{startDate:n,endDate:s}=this,a=t.DTSTAMP||e.format(new Date,"uu");delete t.DTSTAMP;let i={};i=this.allDay?{"DTSTART;VALUE=DATE":e.format(n,"u"),"DTEND;VALUE=DATE":e.format(s,"u")}:{DTSTART:e.format(n,"uu"),DTEND:e.format(s,"uu")};const o={BEGIN:"VCALENDAR",VERSION:"2.0",CALSCALE:"GREGORIAN",PRODID:`-//Bryntum AB//Bryntum Scheduler ${C.scheduler&&C.getVersion("scheduler")||C.calendar&&C.getVersion("calendar")||""} //EN`,END:"VCALENDAR"},l=r(r(r(r({BEGIN:"VEVENT",UID:this.id+"@bryntum.com",CLASS:"PUBLIC",SUMMARY:this.name,DTSTAMP:a},i),this.recurrenceRule?{RRULE:this.recurrenceRule}:{}),t),{},{END:"VEVENT"}),c=Object.keys(o).map((e=>`${e}:${o[e]}`)),d=Object.keys(l).map((e=>`${e}:${l[e]}`));return c.splice(c.length-1,0,...d),c.join("\n")}exportToICS(e){if(this.isScheduled){const t=new Blob([this.toICSString(e)],{type:"text/calendar"});R.downloadBlob(t,(this.name||"Event")+".ics")}}isEditable(e){return!!this.getFieldDefinition(e)||void 0}isFieldModified(e){return"fullDuration"===e?super.isFieldModified("duration")||super.isFieldModified("durationUnit"):super.isFieldModified(e)}}Ut._$name="TimeSpan";const Wt=/^([+-]?[0-9])?(SU|MO|TU|WE|TH|FR|SA)$/,zt=["SU","MO","TU","WE","TH","FR","SA"];class Kt extends l{static decodeDay(e){let t,n;return(t=Wt.exec(e))&&(n=[zt.indexOf(t[2])],t[1]&&(t[1]=parseInt(t[1],10),n.push(t[1]))),n}static encodeDay(e){let t;return Array.isArray(e)&&([e,t]=e),(t?t.toString():"")+zt[e]}static decode(e){const t=[];let n;if(e)for(let r=0;r<e.length;r++)(n=this.decodeDay(e[r]))&&t.push(n);return t}static encode(e){const t=[];let n;if(e)for(let r=0;r<e.length;r++)(n=this.encodeDay(e[r]))&&t.push(n);return t}}Kt._$name="RecurrenceDayRuleEncoder";const Ht=/ly$/i,Zt=e=>{const t=e.replace(Ht,"");return"DAI"===t?"DAY":t},Jt=(e,t,n,r)=>r.buildOccurrence(e,n),Gt=e=>Qt=e;let Qt;class Xt extends l{static processIterationConfig(t){var n;const{recurrence:r}=t,{frequency:s,interval:a,timeSpan:i,endDate:o,count:l}=r;if(!t.syncingStartDate&&!i.meta.isSyncedWithRule){const n=e.add(i.startDate,a,Zt(s)),o=e.min(n,t.endDate||n);this.forEachDate({syncingStartDate:!0,startDate:i.startDate,endDate:o,recurrence:r,fn:Jt})}const c=i.startDate;let{startDate:d=c,endDate:u=o}=t;d<c&&(d=c),o?(!u||u>o)&&(u=o):l&&d>c&&(this.forEachDate({recurrence:r,fn:Gt}),(!u||u>Qt)&&(u=new Date(Qt.getTime()+1)));const h=d;return t.startOnly||(d=new Date(e.max(e.add(d,-a,Zt(s)),c))),Object.assign({extraArgs:[],startOnly:!Boolean(i.durationMS)},t,{startDate:d,endDate:u,timeSpan:i,timeSpanStart:c,earliestVisibleDate:h,endDateMS:null===(n=u)||void 0===n?void 0:n.getTime(),timeSpanStartMS:c.getTime(),earliestVisibleDateMS:h.getTime(),durationMS:i.durationMS,spansStart:d<=c&&u>c})}static getOccurrenceIndex(t){if(t.isOccurrence)return e.diff(t.recurringTimeSpan.startDate,t.startDate,Zt(t.recurringTimeSpan.recurrence.frequency))}static getNthDayInPeriod(e,t,n,r){let s,a,i;if(r){r>0?(a=1,i=e):(a=-1,i=t);const o=n-i.getDay();a*o<0&&(r+=a),s=new Date(i),s.setDate(i.getDate()+7*(r-a)+o),(s<e||s>t)&&(s=null)}return s}static buildDate(e,t,n){const r=new Date(e,t,n);if(r.getFullYear()===e&&r.getMonth()===t&&r.getDate()===n)return r}static isValidPosition(e){return Boolean(e)}static forEachDateAtPositions(e,t,n,r){const s=e.length,a={};for(let i=0;i<t.length;i++){const o=t[i];if(this.isValidPosition(o)){const t=o>0?e[o-1]:e[s+o];if(t&&!a[t.getTime()]&&(a[t.getTime()]=!0,!1===n.call(r,t)))return!1}}}static isInView(e,t,n,r,s){return(e?t>=n:t.valueOf()+r>n)&&!s.hasException(t)}static isInViewMS(e,t,n,r,s,a){return(e?n>=r:n+s>r)&&!a.hasException(t)}}h(Xt,"frequency","NONE"),h(Xt,"MAX_OCCURRENCES_COUNT",1e6),Xt._$name="AbstractRecurrenceIterator";class en extends Xt{static forEachDate(t){const{startOnly:n,startDate:r,endDate:s,endDateMS:a,timeSpan:i,timeSpanStart:o,earliestVisibleDateMS:l,durationMS:c,spansStart:d,recurrence:u,fn:h,extraArgs:g,scope:m=this}=this.processIterationConfig(t),{interval:v}=u,p=r-o,f=864e5*v,y=Math.floor(p/f);let{count:S}=u,D=0,C=e.add(o,y*v,"day"),R=C.getTime();for(s||S||(S=this.MAX_OCCURRENCES_COUNT);!a||R<a;){if(D++,this.isInViewMS(n,C,R,l,c,i)&&(a&&R>a||!1===h.apply(m,[C,D,1===D&&d,i,...g])||S&&D>=S))break;C=e.add(C,v,"day"),R=C.getTime()}}}h(en,"frequency","DAILY"),en._$name="DailyRecurrenceIterator";class tn extends Xt{static forEachDate(t){var n;const{startOnly:r,startDate:s,endDateMS:a,timeSpan:i,timeSpanStart:o,timeSpanStartMS:l,earliestVisibleDateMS:c,durationMS:d,spansStart:u,recurrence:h,fn:g,extraArgs:m,scope:v=this}=this.processIterationConfig(t),{interval:p,days:f}=h,{weekStartDay:y}=e,S=o.getHours(),D=o.getMinutes(),C=o.getSeconds(),R=o.getMilliseconds();let E,I,T=0,{count:x}=h,b=Kt.decode(f);if(null!==(n=b)&&void 0!==n&&n.length||(b=[[o.getDay()]]),y>0)for(let e=0;e<b.length;e++)y>b[e][0]?b[e][0]=7-y-b[e][0]:b[e][0]-=y;for(b.sort(((e,t)=>e[0]-t[0])),E=e.getNext(x||p>1?o:s,"week",0),a||x||(x=this.MAX_OCCURRENCES_COUNT);!a||E.getTime()<a;){for(let e=0;e<b.length;e++){I=new Date(E.getFullYear(),E.getMonth(),E.getDate()+b[e][0],S,D,C,R);const t=I.getTime();if(t>=l){if(T++,this.isInViewMS(r,I,t,c,d,i)&&(a&&t>=a||!1===g.apply(v,[I,T,1===T&&u,i,...m])||x&&T>=x))return}}E=e.getNext(E,"week",p)}}}h(tn,"frequency","WEEKLY"),tn._$name="WeeklyRecurrenceIterator";class nn extends Xt{static getNthDayOfMonth(t,n){const r=e.daysInMonth(t);let s=null;return n&&Math.abs(n)<=r&&(s=new Date(t.getFullYear(),t.getMonth(),n<0?r+n+1:n)),s}static isValidPosition(e){return e&&Math.abs(e)>0&&Math.abs(e)<=31}static forEachDate(t){const{startOnly:n,startDate:r,endDate:s,timeSpan:a,timeSpanStart:i,earliestVisibleDate:o,durationMS:l,spansStart:c,recurrence:d,fn:u,extraArgs:h,scope:g=this}=this.processIterationConfig(t),{interval:m,days:v,count:p,positions:f}=d,y=Kt.decode(v),S=f&&f.length,D={};let C,R,E,I,T,x,{monthDays:b}=d,M=0;for(R=e.startOf(p||m>1?i:r,"month"),E=new Date(e.getNext(R,"month",1)-1),b&&b.length||y&&y.length||(b=[i.getDate()]),y&&y.length&&y.forEach((e=>{e[1]&&(C=C||{},C[e[0]]=e[1])}));(!s||s>R)&&(!p||M<p);){if(I=[],y&&y.length){if(y.forEach((t=>{const n=t[0];let r=1,s=53;for(t[1]&&(r=s=t[1]),x=r;x<=s;x++)(T=this.getNthDayInPeriod(R,E,n,x))&&(T=e.copyTimeValues(T,i),D[T.getTime()]||(D[T.getTime()]=!0,I.push(T)))})),I.sort(((e,t)=>e-t)),!S)for(x=0;x<I.length;x++)if(T=I[x],T>=i){const e=this.isInView(n,T,o,l,a);if(M++,e&&(s&&T>=s||!1===u.apply(g,[T,M,1===M&&c,a,...h])||p&&M>=p))return!1}}else{const t=[];for(x=0;x<b.length;x++)(T=this.getNthDayOfMonth(R,b[x]))&&!D[T.getTime()]&&(D[T.getTime()]=!0,t.push(T));for(t.sort(((e,t)=>e-t)),x=0;x<t.length;x++)if(T=e.copyTimeValues(t[x],i),S)I.push(T);else if(T>=i){const e=this.isInView(n,T,o,l,a);if(M++,e&&(s&&T>s||!1===u.apply(g,[T,M,1===M&&c,a,...h])||p&&M>=p))return}}S&&I.length&&this.forEachDateAtPositions(I,f,(e=>{if(e>=i){const t=n?e>=o:e.valueOf()+l>o&&!a.hasException(e);if(M++,t&&(!s||e<=s)&&(!1===u.apply(g,[e,M,1===M&&c,a,...h])||p&&M>=p))return!1}})),R=e.getNext(R,"month",m),E=new Date(e.getNext(R,"month",1)-1)}}}h(nn,"frequency","MONTHLY"),nn._$name="MonthlyRecurrenceIterator";class rn extends Xt{static forEachDate(t){const{startOnly:n,startDate:r,endDate:s,timeSpan:a,timeSpanStart:i,earliestVisibleDate:o,durationMS:l,spansStart:c,recurrence:d,fn:u,extraArgs:h,scope:g=this}=this.processIterationConfig(t),{interval:m,days:v,count:p,positions:f}=d,y=Kt.decode(v),S=f&&f.length,D={};let C,R,E,I,T,x,{months:b}=d,M=0;for(I=e.startOf(p||m>1?i:r,"year"),T=new Date(e.getNext(I,"year",1)-1),b&&b.sort(((e,t)=>e-t)),b&&b.length||y&&y.length||(b=[i.getMonth()+1]),y&&y.length&&y.forEach((e=>{e[1]&&(x=x||{},x[e[0]]=e[1])}));(!s||s>I)&&(!p||M<p);){if(E=[],y&&y.length){if(y.forEach((t=>{const n=t[0];let r=1,s=53;for(t[1]&&(r=s=t[1]),C=r;C<=s;C++)(R=this.getNthDayInPeriod(I,T,n,C))&&(R=e.copyTimeValues(R,i),D[R.getTime()]||(D[R.getTime()]=!0,E.push(R)))})),E.sort(((e,t)=>e-t)),!S)for(C=0;C<E.length;C++)if(R=E[C],R>=i){const e=this.isInView(n,R,o,l,a);if(M++,e&&(s&&R>=s||!1===u.apply(g,[R,M,1===M&&c,a,...h])||p&&M>=p))return}}else for(C=0;C<b.length;C++)if((R=this.buildDate(I.getFullYear(),b[C]-1,i.getDate()))&&(R=e.copyTimeValues(R,i),!D[R.getTime()]))if(D[R.getTime()]=!0,S)E.push(R);else if(R>=i){const e=n?R>=o:R.valueOf()+l>o&&!a.hasException(R);if(M++,e&&(s&&R>=s||!1===u.apply(g,[R,M,1===M&&c,a,...h])||p&&M>=p))return}S&&E.length&&this.forEachDateAtPositions(E,f,(e=>{if(e>=i){const t=n?e>=o:e.valueOf()+l>o&&!a.hasException(e);if(M++,t&&(!s||e<s)&&(!1===u.apply(g,[e,M,1===M&&c,a,...h])||p&&M>=p))return!1}})),I=e.getNext(I,"year",m),T=new Date(e.getNext(I,"year",1)-1)}}}h(rn,"frequency","YEARLY"),rn._$name="YearlyRecurrenceIterator";const sn={};function an(e){return e?"string"==typeof e&&(e=e.split(",").map((e=>parseInt(e,10)))):e=null,e}function on(e){return e?"string"==typeof e&&(e=e.split(",")):e=null,e}function ln(e,t){return String(e)===String(t)}function cn(e){return this.defaultValue&&void 0===e?this.defaultValue:this.allowNull&&null==e?null:(e=parseInt(e),isNaN(e)?void 0:e)}[en,tn,nn,rn].forEach((e=>{sn[e.frequency]=e}));class dn extends s{static get $name(){return"RecurrenceModel"}get isRecurrenceModel(){return!0}static get fields(){return[{name:"frequency",defaultValue:"DAILY"},{name:"interval",defaultValue:1,convert:cn},{name:"endDate",type:"date"},{name:"count",allowNull:!0,convert:cn},{name:"days",convert:on,isEqual:ln},{name:"monthDays",convert:an,isEqual:ln},{name:"months",convert:an,isEqual:ln},{name:"positions",convert:an,isEqual:ln}]}get dateFormat(){return this._dateFormat||"YYYYMMDDTHHmmss"}set dateFormat(e){this._dateFormat=e}get recurrenceIterator(){return sn[this.frequency]}get timeSpan(){return this._timeSpan}set timeSpan(e){this._timeSpan=e}get rule(){const t=this,n=[];return t.frequency&&(n.push(`FREQ=${t.frequency}`),t.interval>1&&n.push(`INTERVAL=${t.interval}`),t.days&&t.days.length&&n.push("BYDAY="+t.days.join(",")),t.monthDays&&t.monthDays.length&&n.push("BYMONTHDAY="+t.monthDays.join(",")),t.months&&t.months.length&&n.push("BYMONTH="+t.months.join(",")),t.count&&n.push(`COUNT=${t.count}`),t.endDate&&n.push("UNTIL="+e.format(t.endDate,t.dateFormat)),t.positions&&t.positions.length&&n.push("BYSETPOS="+t.positions.join(","))),n.join(";")}set rule(t){const n=this,r={frequency:null,interval:null,count:null,endDate:null,days:null,monthDays:null,months:null,positions:null};if(n.beginBatch(),t){const s=t.split(";");for(let t=0,a=s.length;t<a;t++){const a=s[t].split("="),i=a[1];switch(a[0]){case"FREQ":r.frequency=i;break;case"INTERVAL":r.interval=i;break;case"COUNT":r.count=i,r.until=null;break;case"UNTIL":r.endDate=i?e.parse(i,n.dateFormat):null,r.count=null;break;case"BYDAY":r.days=i;break;case"BYMONTHDAY":r.monthDays=i;break;case"BYMONTH":r.months=i;break;case"BYSETPOS":r.positions=i}}}n.set(r),t&&n.sanitize(),n.endBatch()}construct(e={}){const t=this,{rule:n,timeSpan:r}=e;t._suspendedTimeSpanNotifying=0,delete e.timeSpan,delete e.rule,super.construct(...arguments),n&&(t.suspendTimeSpanNotifying(),t.rule=n,t.resumeTimeSpanNotifying()),t.timeSpan=r}forEachOccurrence(e,t,n){this.timeSpan.startDate&&this.recurrenceIterator.forEachDate({recurrence:this,startDate:e,endDate:t,fn:(e,t,r,s)=>n(s.buildOccurrence(e,r),r,t,e)})}sanitize(){var e;const t=this,n=null===(e=t.timeSpan)||void 0===e?void 0:e.startDate,r={};switch(t.isSanitizing=!0,t.frequency){case"DAILY":r.positions=null,r.days=null,r.monthDays=null,r.months=null;break;case"WEEKLY":{r.positions=null,r.monthDays=null,r.months=null;const{days:e}=t;n&&1===(null==e?void 0:e.length)&&e[0]===Kt.encodeDay(n.getDay())&&(r.days=null);break}case"MONTHLY":{var s;null!==(s=t.monthDays)&&void 0!==s&&s.length&&(r.positions=null,r.days=null),r.months=null;const{monthDays:e}=t;n&&1===(null==e?void 0:e.length)&&e[0]===n.getDate()&&(r.monthDays=null);break}case"YEARLY":{r.monthDays=null;const{months:e}=t;n&&1===(null==e?void 0:e.length)&&e[0]===n.getMonth()+1&&(r.months=null);break}}t.set(r),t.isSanitizing=!1}copy(...e){const t=super.copy(...e);return t.dateFormat=this.dateFormat,t.timeSpan=this.timeSpan,t}afterChange(e,t,n){const r=super.afterChange(e,t,n),{timeSpan:s}=this;return this.isSanitizing||this.sanitize(),s&&(s.sanitizeRecurrenceData(this),this.isTimeSpanNotifyingSuspended||s.onRecurrenceChanged()),r}set(e,t,...n){const r="object"==typeof e?e:{[e]:t};r.count?r.endDate=null:r.endDate&&(r.count=null),super.set(r,void 0,...n)}get isTimeSpanNotifyingSuspended(){return Boolean(this._suspendedTimeSpanNotifying)}suspendTimeSpanNotifying(){this._suspendedTimeSpanNotifying++}resumeTimeSpanNotifying(){this._suspendedTimeSpanNotifying&&this._suspendedTimeSpanNotifying--}}function un(t){const n={},{dateFormat:r}=this;return t&&(t="string"==typeof t?t.split(","):c.asArray(t)).forEach((t=>{"string"==typeof t&&(t=e.parse(t,r)),isNaN(t)||(n[e.makeKey(t)]=1)})),n}function hn(t){const n=[],{dateFormat:r}=this;for(const s in t)t[s]&&n.push(e.format(e.parseKey(s),r));return n}dn._$name="RecurrenceModel";const gn=[];var mn=t=>class extends(t||Ut){static get $name(){return"RecurringTimeSpan"}get supportsRecurring(){return!0}static get fields(){return[{name:"recurrenceRule",internal:!0},{name:"exceptionDates",convert:un,serialize:hn,internal:!0}]}remove(){if(!this.isOccurrence)return super.remove(...arguments);{const e=this,{recurringTimeSpan:t}=e;e.cancelBatch(),t.beginBatch(),e.detachFromRecurringEvent(),t.endBatch()}}get eventStore(){var e;let t=this.isOccurrence?this.recurringEvent.eventStore:super.eventStore;return!t&&null!==(e=this.firstStore)&&void 0!==e&&e.isRecurringTimeSpansMixin&&(t=this.firstStore),t}get recurrenceModel(){return this._recurrenceModel||dn}set recurrenceModel(e){this._recurrenceModel=e}setRecurrence(e,t,n){const r=this;let s;e&&(e.isRecurrenceModel||("string"==typeof e&&(e={frequency:e},t&&(e.interval=t),n&&(n instanceof Date?e.endDate=n:e.count=n)),e=new r.recurrenceModel(e)),e.timeSpan=r,s=e.rule),r.recurrence=e,r.recurrenceRule=s}get recurrence(){const e=this,t=e.recurrenceRule;return!e._recurrence&&t&&(e._recurrence=new e.recurrenceModel({rule:t,timeSpan:e,id:`${e.id}-recurrence`})),e._recurrence}set recurrence(e){const t=this;t._recurrence=e,e?(e.timeSpan=t,t.recurrenceRule=e.rule):t.isOccurrence?t.setData("recurrenceRule",null):t.recurrenceRule=null}get isRecurring(){return Boolean(!this.isOccurrence&&this.recurrence)}get isOccurrence(){return Boolean(this.recurringTimeSpan)}get recurringTimeSpan(){return this._recurringTimeSpan}get isPersistable(){return super.isPersistable&&(!this.supportsRecurring||!this.isOccurrence)}set recurringTimeSpan(e){this._recurringTimeSpan=e}getOccurrencesForDateRange(e,t=e){return this.eventStore.getOccurrencesForTimeSpan(this,e,t)}get occurrences(){if(this.isRecurring){const e=[];return this.occurrenceMap.forEach((t=>{t!==this&&e.push(t)})),e}return gn}get occurrenceMap(){return this._occurrencesMap||(this._occurrencesMap=new Map)}removeOccurrence(t){var n;const r=t.isTimeSpan?t.occurrenceDate:t;null===(n=this.eventStore)||void 0===n||n.globalOccurrences.delete(this.createRecurrenceKey(r)),this.occurrenceMap.delete(e.makeKey(r))}removeOccurrencesFrom(t){this.occurrenceMap.forEach(((n,r)=>{e.parseKey(r)>=t&&this.removeOccurrence(n)}))}removeOccurrences(){[this,...this.occurrences].forEach((e=>this.removeOccurrence(e)))}onRecurrenceChanged(){var e;this.recurrenceRule=(null===(e=this.recurrence)||void 0===e?void 0:e.rule)||null}sanitizeRecurrenceData(t=this.recurrence){if(t.endDate){const n=e.clearTime(t.endDate),{exceptionDates:r}=this;if(this.removeOccurrencesFrom(n),r)for(const t in r){e.parseKey(t)>=n&&delete r[t]}}}get occurrenceDate(){var e;return(null===(e=this.meta.modified)||void 0===e?void 0:e.startDate)||this.startDate}get occurrenceIndex(){return Xt.getOccurrenceIndex(this)}buildOccurrence(t,n){var r;const s=this,{occurrenceMap:a,recurrence:i,meta:o}=s,l=null===(r=s.eventStore)||void 0===r?void 0:r.globalOccurrences,c=e.makeKey(t),d=s.createRecurrenceKey(t,c),u=!(t-s.startDate),{fieldMap:h}=s.constructor;let g=null==l?void 0:l.get(d),{duration:m}=s;!s.endDate||!s.allDay&&m||(m=e.as(s.durationUnit,s.endDate.getTime()-s.startDate.getTime()));const v=void 0!==m?e.add(t,m,s.durationUnit):void 0;return g||(n||u?(g=s,u||(s.setStartEndDate(t,v,!0),i.suspendTimeSpanNotifying(),i.sanitize(),i.resumeTimeSpanNotifying()),o.isSyncedWithRule=!0):(g=s.copy({[h.id.dataSource]:d,[h.startDate.dataSource]:t,[h.endDate.dataSource]:v,[h.duration.dataSource]:m,constraintDate:null,constraintType:null},{creatingOccurrence:!0}),g.recurringTimeSpan=s),null==l||l.set(d,g),a.set(c,g)),g}createRecurrenceKey(t=this.startDate,n=null){return`_generated:${this.id}:${n||e.makeKey(t)}`}convertToRealEvent(e,t){var n;if(!this.isOccurrence)return;const r=this,{recurringTimeSpan:s,resource:a,occurrenceIndex:i,recurrence:o}=r,l=o&&s.recurrence.count,c=(null==e||null===(n=e.resourceRecords)||void 0===n?void 0:n.value)||r.data.newResource;s.beginBatch(),r.detachFromRecurringEvent(),r.clearChanges(),r.setData("id",r.generateId(s.eventStore)),c&&delete r.data.resourceId,s.eventStore.add(r,t),l&&(r.recurrence.count=l-i),(c||a)&&r.assign(c||a),c&&delete r.data.resourceRecords,e&&delete e.resourceRecords,s.endBatch()}afterChange(e,t,n,...r){const s=this,{eventStore:a}=s;return"recurrenceRule"in t&&(s._recurrence=null,null==a||a.recurringEvents[t.recurrenceRule.value?"add":"delete"](s)),s.isOccurrence?s.convertToRealEvent(t,n):"newExceptionDate"in t&&(s.meta.modified.exceptionDates=!0,delete s.meta.modified.newExceptionDate,s.removeOccurrence(t.newExceptionDate.value)),super.afterChange(e,t,n,...r)}detachFromRecurringEvent(){const t=this,{recurringTimeSpan:n,occurrenceDate:r,startDate:s}=t;t.recurringTimeSpan=null,n.addExceptionDate(r),t.recurrenceRule&&(n.recurrence.endDate=e.add(s,-1,"minute"))}set newExceptionDate(t){if(t){(this.exceptionDates||(this.exceptionDates={}))[e.makeKey(t)]=1}}addExceptionDate(e){return this.set({newExceptionDate:e})}hasException(t){var n;return null===(n=this.exceptionDates)||void 0===n?void 0:n[e.makeKey(t)]}};var vn=t=>class extends t{static get $name(){return"EventModelMixin"}static get isEventModel(){return!0}static get fields(){return[{name:"resourceId",internal:!0},{name:"resources",column:{type:"resourceassignment"},persist:!1,internal:!0},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0,internal:!0},{name:"resizable",persist:!1,defaultValue:!0,internal:!0},{name:"allDay",type:"boolean",defaultValue:!1},{name:"eventStyle",internal:!0},{name:"eventColor",internal:!0},{name:"milestoneWidth",internal:!0},{name:"stickyContents",internal:!0}]}updateAssignmentEventIds(){this.assigned.forEach((e=>{e.eventId=this.id}))}syncId(e){super.syncId(e),this.updateAssignmentEventIds()}get resources(){return this.assignments.reduce(((e,{resource:t})=>(t&&e.push(t.$original),e)),[])}set resources(e){e=c.asArray(e);const t=this,n=e.map(t.constructor.asId);if(t.usesSingleAssignment)t.set("resourceId",n[0]);else{const e=t.assignments.map((e=>e.resource.id)),{onlyInA:r,onlyInB:s}=c.delta(n,e);t.assignmentStore.add(r.map((e=>({resource:e,event:t})))),t.assignmentStore.remove(s.map((e=>t.assignments.find((t=>t.resource.id===e)))))}}forEachResource(e,t=this){for(const n of this.resources)if(!1===e.call(t,n))return}getResource(e){return null==e?this.resource:this.resourceStore?this.resourceStore.getById(e):null}get startDate(){let e;var t;this.isOccurrence?e=this.get("startDate"):e=null!==(t=this._startDate)&&void 0!==t?t:super.startDate;return this.allDay&&(e=this.constructor.getAllDayStartDate(e)),e}set startDate(e){this.batching?(this._startDate=e,this.set({startDate:e})):super.startDate=e}get endDate(){let e;var t;this.isOccurrence?e=this.get("endDate"):e=null!==(t=this._endDate)&&void 0!==t?t:super.endDate;return this.allDay&&(e=this.constructor.getAllDayEndDate(e)),e}set endDate(e){this.batching?(this._endDate=e,this.set({endDate:e})):super.endDate=e}get wrapStartDate(){return this.startDate}set wrapStartDate(e){}get wrapEndDate(){return this.endDate}set wrapEndDate(e){}get isEvent(){return!0}get isDraggable(){return!this.readOnly&&this.draggable}get isResizable(){return!this.isMilestone&&(!this.isParent||this.manuallyScheduled)&&this.resizable}get isPersistable(){return super.isPersistable&&!this.isCreating}endBatch(){const{isPersistable:e,meta:{batchChanges:t}}=this;t&&("endDate"in t&&(delete this._endDate,this.postamble&&(this.wrapEndDate=null)),"startDate"in t&&(delete this._startDate,this.preamble&&(this.wrapStartDate=null))),super.endBatch(...arguments),this.isPersistable&&!e&&this.assignments.forEach((e=>{e.stores.forEach((t=>{t.updateModifiedBagForRecord(e)}))}))}get isCreating(){return super.isCreating}set isCreating(e){super.isCreating=e,this.assignments.forEach((t=>t.isCreating=e))}get usesSingleAssignment(){return!this.eventStore||this.eventStore.usesSingleAssignment}copy(...e){const t=super.copy(...e);return this.usesSingleAssignment||(t.resourceId=null),t}get persistableData(){const e=super.persistableData;return this.usesSingleAssignment||delete e.resourceId,e}get resource(){const{resources:e}=this;return e.length?e[0]:null}set resource(e){this.resourceId=this.constructor.asId(e)}get resourceId(){var e;return this.usesSingleAssignment?this.get("resourceId"):null===(e=this.resource)||void 0===e?void 0:e.id}set resourceId(e){this.applyResourceId(e)}get $linkedResources(){var e,t;return null!==(e=null===(t=this.resources)||void 0===t?void 0:t.flatMap((e=>[e,...e.$links])))&&void 0!==e?e:[]}applyResourceId(e,t=!1){const n=this,{assignments:r,assignmentStore:s,eventStore:a}=n;if(a)if(null!=e)if(n.meta.skipEnforcingSingleAssignment||(a.usesSingleAssignment=!0),null!=r&&r.length&&e!==r[0].resourceId){const t=Boolean(a.eventsSuspended);t&&s.suspendEvents(),r[0].resource=e,t&&s.resumeEvents()}else s.assignEventToResource(n,e);else s.remove(n.assignments);else t||n.set({resourceId:e})}applyValue(e,t,n,r,s){if(s&&"resourceId"===s.name&&!this.meta.isAssigning){const{eventStore:e}=this;e&&(e.isAssigning=!0),this.applyResourceId(n,!0),e&&(e.isAssigning=!1)}super.applyValue(e,t,n,r,s)}get assignments(){return[...this.assigned||[]]}assign(e,t=!1){const{eventStore:n}=this;n&&!n.usesSingleAssignment?n.assignEventToResource(this,e,t):(this.resourceId=this.constructor.asId(e),n||(this.meta.skipEnforcingSingleAssignment=!0))}unassign(e,t=!1){var n;const r=this;e=r.constructor.asId(e),r.meta.removingResource=t,null===(n=r.eventStore)||void 0===n||n.unassignEventFromResource(r,e),r.meta.removingResource=null}reassign(e,t){this.eventStore&&this.eventStore.reassignEventFromResourceToResource(this,e,t)}isAssignedTo(e){const t=this.constructor.asId(e);return this.assignments.some((e=>e.resourceId===t))}get predecessors(){var e;return[...null!==(e=this.incomingDeps)&&void 0!==e?e:[]]}get successors(){var e;return[...null!==(e=this.outgoingDeps)&&void 0!==e?e:[]]}get dependencies(){var e,t;return[...null!==(e=this.incomingDeps)&&void 0!==e?e:[],...null!==(t=this.outgoingDeps)&&void 0!==t?t:[]]}normalize(){}inSetNormalize(){}get recurringEvent(){return this.recurringTimeSpan}get isInterDay(){const{durationMS:t}=this;if(t>=864e5||!t&&this.allDay)return!0;const{endDate:n,startDate:r}=this,s=e.clearTime(r);return r&&n?(s.setDate(s.getDate()+1),(n||e.add(r,t))>s):void 0}static getAllDayStartDate(t){return t&&t.isEvent&&(t=t.get("startDate")),t&&(t=e.clearTime(t,!0)),t}static getAllDayEndDate(t){return t&&t.isEvent&&(t=t.get("endDate")),t&&(t.getHours()>0||t.getMinutes()>0||t.getSeconds()>0||t.getMilliseconds()>0)&&(t=e.getNext(t,"d",1)),t}static getAllDayDisplayStartDate(t){return t&&t.isEvent&&(t=t.get("startDate")),e.clearTime(t,!0)}static getAllDayDisplayEndDate(t,n){return t&&t.isEvent&&(n=t.get("endDate"),t=t.get("startDate")),n&&(t=this.constructor.getAllDayDisplayStartDate(t),e.clearTime(n,!0).valueOf()===n.valueOf()?n=e.add(n,e.DAY,-1):t.valueOf()!==n.valueOf()&&(n=e.clearTime(n,!0))),n}isEditable(e){switch(e){case"endDate":case"duration":case"fullDuration":return this.isLeaf}return super.isEditable(e)}};const pn=Je;class fn extends(pn.derive(Ut).mixin(mn,mt,vn)){static get $name(){return"EventModel"}}fn.exposeProperties(),fn._$name="EventModel";const yn=mt(Ge.derive(p));class Sn extends(yn.mixin(Lt,_t,bt,Nt,At)){static get defaultConfig(){return{modelClass:fn}}}h(Sn,"$name","EventStore"),Sn._$name="EventStore";const Dn=["SS","SF","FS","FF"];class Cn extends s{static get $name(){return"DependencyBaseModel"}static get Type(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}static get fields(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"},{name:"highlighted",persist:!1,internal:!0}]}construct(e){const t=e[this.fieldMap.from.dataSource],n=e[this.fieldMap.to.dataSource];null!=t&&(e.fromEvent=t),null!=n&&(e.toEvent=n),super.construct(...arguments)}get eventStore(){var e;return this.eventStore||(null===(e=this.unjoinedStores[0])||void 0===e?void 0:e.eventStore)}set from(e){const{fromEvent:t}=this;null!=t&&t.isModel&&t.id===e?this.set("from",e):this.fromEvent=e}get from(){return this.get("from")}set to(e){const{toEvent:t}=this;null!=t&&t.isModel&&t.id===e?this.set("to",e):this.toEvent=e}get to(){return this.get("to")}get hardType(){return this.getHardType()}set hardType(e){this.setHardType(e)}getHardType(){return this.get("type")}setHardType(e){let t;return e!==this.hardType&&(t=this.set({type:e,fromSide:null,toSide:null})),t}get lag(){return this.get("lag")}set lag(e){this.setLag(e)}setLag(t,n=this.lagUnit){1!==arguments.length?(t=parseFloat(t),this.set({lag:t,lagUnit:n})):"number"==typeof t?this.lag=t:(t=e.parseDuration(t),this.set({lag:t.magnitude,lagUnit:t.unit}))}getLag(){return this.lag?`${this.lag<0?"-":"+"}${Math.abs(this.lag)}${e.getShortNameOfUnit(this.lagUnit)}`:""}get fullLag(){return new D({unit:this.lagUnit,magnitude:this.lag})}set fullLag(e){"string"==typeof e?this.setLag(e):this.setLag(e.magnitude,e.unit)}get isPersistable(){const e=this,{stores:t,unjoinedStores:n}=e,r=t[0];let s;if(r){const{fromEvent:t,toEvent:n}=e,a=r.crudManager;s=t&&(a||!t.hasGeneratedId)&&n&&(a||!n.hasGeneratedId)}else s=Boolean(n[0]);return s&&super.isPersistable}getDateRange(){const{fromEvent:e,toEvent:t}=this;if(null!=e&&e.isScheduled&&null!=t&&t.isScheduled){const n=Cn.Type;let r,s;switch(this.type){case n.StartToStart:r=e.startDateMS,s=t.startDateMS;break;case n.StartToEnd:r=e.startDateMS,s=t.endDateMS;break;case n.EndToEnd:r=e.endDateMS,s=t.endDateMS;break;case n.EndToStart:r=e.endDateMS,s=t.startDateMS;break;default:throw new Error("Invalid dependency type: "+this.type)}return{start:Math.min(r,s),end:Math.max(r,s)}}return null}highlight(e){var t,n;const r=null!==(t=null===(n=this.highlighted)||void 0===n?void 0:n.split(" "))&&void 0!==t?t:[];r.includes(e)||(this.highlighted=r.concat(e).join(" "))}unhighlight(e){const{highlighted:t}=this;if(t){const n=t.split(" "),r=n.indexOf(e);r>=0&&(n.splice(r,1),this.highlighted=n.join(" "))}}isHighlightedWith(e){return this.highlighted&&this.highlighted.split(" ").includes(e)}getConnectorString(e){const t=Dn[this.type];return e?t:this.type===Cn.Type.EndToStart?"":t}toString(){return`${this.from}${this.getConnectorString()}${this.getLag()}`}get isValid(){const{fromEvent:e,toEvent:t,type:n}=this;return"number"==typeof n&&e&&t&&e!==t}get fromEventName(){var e;return(null===(e=this.fromEvent)||void 0===e?void 0:e.name)||""}get toEventName(){var e;return(null===(e=this.toEvent)||void 0===e?void 0:e.name)||""}shouldRecordFieldChange(e,t,n){if(!super.shouldRecordFieldChange(e,t,n))return!1;if("from"===e||"to"===e||"fromEvent"===e||"toEvent"===e){var r;const e=null===(r=this.project)||void 0===r?void 0:r.eventStore;if(e&&e.oldIdMap[t]===e.getById(n))return!1}return!0}}Cn.exposeProperties(),Cn._$name="DependencyBaseModel";const Rn=We;class En extends(mt(Rn.derive(Cn))){static get $name(){return"DependencyModel"}getTypeFromSides(e,t,n){const r=Cn.Type,s=n?"right":"left",a=n?"left":"right";return e===s?t===s?r.StartToStart:r.StartToEnd:t===a?r.EndToEnd:r.EndToStart}}En.exposeProperties(),En._$name="DependencyModel";var In=e=>class extends e{static get $name(){return"DependencyStoreMixin"}static get defaultConfig(){return{loadPriority:400,syncPriority:400,storeId:"dependencies"}}reduceEventDependencies(e,t,n,r=!0,s){return s=s||(e=>this.getEventDependencies(e)),(e=c.asArray(e)).reduce(((e,n)=>{n.children&&!r?n.traverse((n=>{e=s(n).reduce(t,e)})):e=s(n).reduce(t,e)}),n),n}mapEventDependencies(e,t,n,r,s){return this.reduceEventDependencies(e,((e,t)=>(n(t)&&e.push(t),e)),[],r,s)}mapEventPredecessors(e,t,n,r){return this.reduceEventPredecessors(e,((e,t)=>(n(t)&&e.push(t),e)),[],r)}mapEventSuccessors(e,t,n,r){return this.reduceEventSuccessors(e,((e,t)=>(n(t)&&e.push(t),e)),[],r)}getEventDependencies(e){return[].concat(e.predecessors||[],e.successors||[])}removeEventDependencies(e){this.remove(this.getEventDependencies(e))}removeEventPredecessors(e){this.remove(e.predecessors)}removeEventSuccessors(e,t){this.remove(e.successors)}getBySourceTargetId(e){return this.records.find((t=>e==this.constructor.makeDependencySourceTargetCompositeKey(t.from,t.to)))}getDependencyForSourceAndTargetEvents(e,t){return e=s.asId(e),t=s.asId(t),this.getBySourceTargetId(this.constructor.makeDependencySourceTargetCompositeKey(e,t))}getEventsLinkingDependency(e,t){return this.getDependencyForSourceAndTargetEvents(e,t)||this.getDependencyForSourceAndTargetEvents(t,e)}async isValidDependency(e,t,n){let r=e,s=t;return null!=e&&(e.isDependencyModel&&({fromEvent:r,toEvent:s}=e),r=this.eventStore.getById(r),s=this.eventStore.getById(s),r&&s?!(!r.project||!s.project)&&this.project.isValidDependency(r,s,n):e!==t)}isValidDependencyToCreate(e,t,n){return this.isValidDependency(e,t,n)}getHighlightedDependencies(e){return this.records.reduce(((t,n)=>(n.isHighlightedWith(e)&&t.push(n),t)),[])}static makeDependencySourceTargetCompositeKey(e,t){return`source(${e})-target(${t})`}getTimeSpanDependencies(e){return this.getEventDependencies(e)}};const Tn=mt(Ke.derive(p));class xn extends(In(Tn.derive(p))){static get defaultConfig(){return{modelClass:En}}}xn._$name="DependencyStore";var bn=e=>class extends((e||l).mixin(dt,ut,ht)){static get defaultConfig(){return{project:null}}startConfigure(e){this.getConfig("project"),super.startConfigure(e),this._changesToClear=new Map}async doAutoLoad(){const{project:e}=this;return e&&await e.commitAsync(),super.doAutoLoad()}applyProjectResponse(e){const t=this,{project:n}=t;t.applyingProjectResponse=!0;const r=n.fieldMap.startDate,s=n.fieldMap.endDate,i=a.getPath(e,r.dataSource),o=a.getPath(e,s.dataSource);"string"==typeof i&&a.setPath(e,r.dataSource,r.convert(i)),"string"==typeof o&&a.setPath(e,s.dataSource,s.convert(o)),Object.assign(n,e),t._changesToClear.set(t,e),t.applyingProjectResponse=!1}loadCrudManagerData(e,t={}){const n=this,{project:r}=n;n.suspendChangesTracking(),super.loadCrudManagerData(...arguments),null!=e&&e.project&&(r.delayEnteringReplica?r.ion({recordsUnlinked:()=>{n.suspendChangesTracking(),n.applyProjectResponse(e.project),n.resumeChangesTracking()},once:!0}):n.applyProjectResponse(e.project)),n.resumeChangesTracking()}async sync(){const{project:e}=this;if(this.suspendAutoSync(),e&&await e.commitAsync(),!this.isDestroying)return this.resumeAutoSync(!1),super.sync()}async applyResponse(e,t,n){var r,s;const a=this;if(!(a.isDestroyed||null!==(r=a.project)&&void 0!==r&&r.isDestroyed)){var i;if(a.trigger("startApplyResponse"),await super.applyResponse(e,t,n),null!=t&&t.project||a.supportShortSyncResponse&&null!=e&&null!==(s=e.pack)&&void 0!==s&&s.project)a.applyProjectResponse(t.project||(null==e||null===(i=e.pack)||void 0===i?void 0:i.project));if(a.project){var o,l;let n=e.type;a.trackResponseType&&(n=t.type||n);const r=`propagating${d.capitalize(n)}Changes`;a.suspendAutoSync(),a[r]=!0;const s=a.project.isInitialCommit&&!a.project.silenceInitialCommit;await a.project.commitAsync(),a[r]=!1,null===(o=a.resumeAutoSync)||void 0===o||o.call(a,s),null===(l=a.commitRespondedChanges)||void 0===l||l.call(a)}}}applySyncResponse(...e){var t;const n=this,r=null===(t=n.project)||void 0===t?void 0:t.stm.disabled;!1===r&&n.ignoreRemoteChangesInSTM&&n.project.stm.disable(),super.applySyncResponse(...e),!1===r&&n.project.stm.enable()}shouldClearRecordFieldChange(e,t,n){var r;const s=e[t];return null!==(r=t=e.getFieldDefinition(t))&&void 0!==r&&r.isEqual?t.isEqual(s,n):a.isEqual(s,n)}commitRespondedChanges(){this._changesToClear.forEach(((e,t)=>{Object.entries(e).forEach((([e,n])=>{this.shouldClearRecordFieldChange(t,e,n)&&delete t.meta.modified[e]}))})),this._changesToClear.clear()}applyChangesToStore(e,t,n,...r){const s=super.applyChangesToStore(e,t,n,...r);if(s.size&&this.project)for(const[t,n]of s){const r=e.store.getById(t);r&&this._changesToClear.set(r,n)}return s}},Mn=e=>{var t;return h(t=class extends(e||s){static get configurable(){return{assignments:null,dependencies:null,resources:null,timeRanges:null}}get assignments(){return this.assignmentStore.records}updateAssignments(e){this.assignmentStore.data=e}get dependencies(){return this.dependencyStore.records}updateDependencies(e){this.dependencyStore.data=e}get resources(){return this.resourceStore.records}updateResources(e){this.resourceStore.data=e}get timeRanges(){return this.timeRangeStore.records}getTimeRanges(e,t){const n=this.timeRangeStore,r=[];for(const s of n)s.isRecurring?r.push(...s.getOccurrencesForDateRange(e,t)):s.startDate<t&&e<s.endDate&&r.push(s);return r}updateTimeRanges(e){this.timeRangeStore.data=e}getResourceTimeRanges(e,t){const n=this.resourceTimeRangeStore,r=[];for(const s of n)s.isRecurring?r.push(...s.getOccurrencesForDateRange(e,t)):s.startDate<t&&e<s.endDate&&r.push(s);return r}},"$name","ProjectModelCommon"),t};class An extends Ut{get domId(){return`${this.constructor.domIdPrefix}-${this.id}`}get isResourceTimeRange(){return!0}get resources(){return this.resource?[this.resource]:[]}get $linkedResources(){return this.resources}}h(An,"$name","ResourceTimeRangeModel"),h(An,"fields",["resourceId","timeRangeColor"]),h(An,"relations",{resource:{foreignKey:"resourceId",foreignStore:"resourceStore",relatedCollectionName:"timeRanges",nullFieldOnRemove:!0}}),h(An,"domIdPrefix","resourcetimerange"),An._$name="ResourceTimeRangeModel";class wn extends p{static get defaultConfig(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:An,storeId:"resourceTimeRanges"}}set resourceStore(e){this._resourceStore=e,this.isConfiguring||this.initRelations(!0)}get resourceStore(){return this._resourceStore}getResourcesForEvent(e){return[e.resource]}getRanges({resourceRecord:e,startDate:t,endDate:n}){return e.timeRanges.flatMap((e=>e.supportsRecurring?e.getOccurrencesForDateRange(t,n):e.intersectsRange(t,n)?e:[])).sort(((e,t)=>e.startDate-t.startDate))}}h(wn,"$name","ResourceTimeRangeStore"),wn._$name="ResourceTimeRangeStore";var jn=e=>{var n;return h(n=class extends(e||s){afterConstruct(){super.afterConstruct(...arguments),this._storesWithDates=[this.taskStore,this.timeRangeStore,this.resourceTimeRangeStore]}relayStoreChange({source:e,action:t,records:n,replaced:r}){const s=this;if(s.timeZone&&s._storesWithDates.includes(e))if("dataset"===t)s.convertStoresToTimeZone([e]),s.ignoreRecordChanges=!0,s.commitAsync();else if(["add","replace"].includes(t)){var a;null!==(a=n)&&void 0!==a&&a.length||null==r||!r.length||(n=r),n.length&&n.forEach((e=>e._inTimeZone=s.timeZone))}}convertStoresToTimeZone(e){var t;const n=this,{timeZone:r}=n,s=null===(t=n.stm)||void 0===t?void 0:t.autoRecord;s&&(n.stm.autoRecord=!1);for(const t of e)t&&t.forEach((e=>{var t;if(e.$ignoreChange=!0,null!==(t=e.baselines)&&void 0!==t&&t.count)for(const t of e.baselines)e._inTimeZone!==t._inTimeZone&&(t._inTimeZone=e._inTimeZone),t.convertToTimeZone(r);e.convertToTimeZone(r),delete e.$ignoreChange}));s&&(n.stmAutoRecord=s)}updateTimeZone(e,n){const r=this,s=r._isConfiguringTimeZone||r.isConfiguring;if(r.calendarManagerStore.forEach((e=>e.bumpVersion())),r.convertStoresToTimeZone(r._storesWithDates),r.startDate){const s=n?t.fromTimeZone(r.startDate,n):r.startDate;r.startDate=e?t.toTimeZone(s,e):s}r.ignoreRecordChanges=!0,r.commitAsync().then((()=>{r.isDestroyed||r.trigger("timeZoneChange",{timeZone:e,oldTimeZone:n,isConfiguring:s}),delete r._isConfiguringTimeZone}))}},"$name","ProjectModelTimeZoneMixin"),h(n,"configurable",{timeZone:{$config:"lazy",value:null}}),n},On=e=>{var t;return t=class extends((e||s).mixin(Mn,jn)){static get $name(){return"ProjectModelMixin"}static get defaultConfig(){return{stm:{},timeRangeModelClass:Ut,resourceTimeRangeModelClass:An,timeRangeStoreClass:n,resourceTimeRangeStoreClass:wn,eventStore:{},assignmentStore:{},dependencyStore:{},resourceStore:{},timeRangesData:null}}get inlineData(){return d.safeJsonParse(super.json)}set inlineData(e){this.json=e}construct(e={}){super.construct(...arguments),e.timeRangesData&&(this.timeRangeStore.data=e.timeRangesData),e.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=e.resourceTimeRangesData)}afterConstruct(){super.afterConstruct();const e=this;!e.timeRangeStore.stm&&e.stm.addStore(e.timeRangeStore),!e.resourceTimeRangeStore.stm&&e.stm.addStore(e.resourceTimeRangeStore)}attachStore(e){null==e||e.ion({name:e.$$name,change:"relayStoreChange",thisObj:this})}detachStore(e){e&&this.detachListeners(e.$$name)}relayStoreChange(e){return super.relayStoreChange(e),this.trigger("change",r(r({store:e.source},e),{},{source:this}))}updateTimeRangeStore(e,t){this.detachStore(t),this.attachStore(e)}setTimeRangeStore(e){this.timeRangeStore=e}changeTimeRangeStore(e){return e&&!e.isStore&&(e=this.timeRangeStoreClass.new({modelClass:this.timeRangeModelClass},e)),e}updateResourceTimeRangeStore(e,t){this.detachStore(t),this.attachStore(e)}changeResourceTimeRangeStore(e){return e&&!e.isStore&&(e=this.resourceTimeRangeStoreClass.new({modelClass:this.resourceTimeRangeModelClass},e)),e}setResourceTimeRangeStore(e){this.resourceTimeRangeStore=e}get events(){return this.eventStore.records}updateEvents(e){this.eventStore.data=e}get resourceTimeRanges(){return this.resourceTimeRangeStore.records}updateResourceTimeRanges(e){this.resourceTimeRangeStore.data=e}async loadInlineData(e){return this.isLoadingInlineData=!0,e.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=e.resourceTimeRangesData),e.timeRangesData&&(this.timeRangeStore.data=e.timeRangesData),super.loadInlineData(e)}toJSON(){const e=this,t={eventsData:e.eventStore.toJSON(),resourcesData:e.resourceStore.toJSON(),dependenciesData:e.dependencyStore.toJSON(),timeRangesData:e.timeRangeStore.toJSON(),resourceTimeRangesData:e.resourceTimeRangeStore.toJSON()};return e.eventStore.usesSingleAssignment||(t.assignmentsData=e.assignmentStore.toJSON()),t}get json(){return super.json}changeJson(e){return"string"==typeof e&&(e=d.safeJsonParse(e)),e}updateJson(e){e&&this.loadInlineData(e)}afterChange(e,t){super.afterChange(...arguments),t.calendar&&this.trigger("calendarChange")}doDestroy(){this.timeRangeStore.destroy(),this.resourceTimeRangeStore.destroy(),super.doDestroy()}},h(t,"configurable",{json:null,timeRangeStore:{value:{id:"timeRanges",modelClass:Ut},$config:"nullify"},resourceTimeRangeStore:{value:{},$config:"nullify"},events:null,resourceTimeRanges:null}),t},Fn=e=>class extends e{getCurrentConfig(e){const t=this,n=super.getCurrentConfig(e);if(n){for(const r of["eventStore","resourceStore","assignmentStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"]){const s=t[r];if(s){s.count&&(n[s.id+"Data"]=s.getInlineData(e));const t=s.getCurrentConfig(e);t&&Object.keys(t).length>0?n[r]=Object.assign(n[r]||{},t):n[r]&&0===Object.keys(n[r]).length&&delete n[r]}}return n.timeRangeStore&&(t.timeRangeStore.originalModelClass!==t.timeRangeModelClass&&"TimeSpan"!==t.timeRangeStore.originalModelClass.$name||delete n.timeRangeStore.modelClass,"timeRanges"===n.timeRangeStore.storeId&&delete n.timeRangeStore.storeId,1===Object.keys(n.timeRangeStore).length&&delete n.timeRangeStore),t.taskStore.isTaskStore&&(delete n.eventModelClass,delete n.eventStoreClass,delete n.children),n}}};class Pn extends l{set eventStore(e){const t=this;t.eventStoreDetacher&&t.eventStoreDetacher(),t._eventStore=e,e&&e.autoCommit&&(t.eventStoreDetacher=e.ion({beforecommit:t.onEventStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get eventStore(){return this._eventStore}set resourceStore(e){const t=this;t.resourceStoreDetacher&&t.resourceStoreDetacher(),t._resourceStore=e,e&&e.autoCommit&&(t.resourceStoreDetacher=e.ion({beforecommit:t.onResourceStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get resourceStore(){return this._resourceStore}set assignmentStore(e){const t=this;t.assignmentStoreDetacher&&t.assignmentStoreDetacher(),t._assignmentStore=e,e&&e.autoSync&&(t.assignmentStoreDetacher=e.ion({beforecommit:t.onAssignmentStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get assignmentStore(){return this._assignmentStore}set dependencyStore(e){const t=this;t.dependencyStoreDetacher&&t.dependencyStoreDetacher(),t._dependencyStore=e,e&&e.autoSync&&(t.dependencyStoreDetacher=e.ion({beforecommit:t.onDependencyStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get dependencyStore(){return this._dependencyStore}onEventStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onResourceStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onAssignmentStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onDependencyStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}removeNonPersistableRecordsToCreate(e){const t=e.added||[];let n,r;for(r=t.length-1;r>=0;--r)n=t[r],n.isPersistable||t.splice(t.indexOf(n),1);0===t.length&&(e.added.length=0)}shallContinueSync(e){return Boolean(e.added&&e.added.length>0||e.modified&&e.modified.length>0||e.removed&&e.removed.length>0)}}Pn._$name="ModelPersistencyManager";const kn=rt;class $n extends(Fn(On(kn))){static get $name(){return"ProjectModel"}static get defaultConfig(){return{eventModelClass:fn,dependencyModelClass:En,resourceModelClass:It,assignmentModelClass:ft,eventStoreClass:Sn,dependencyStoreClass:xn,resourceStoreClass:xt,assignmentStoreClass:Dt}}construct(...e){super.construct(...e),C.isTestEnv&&(globalThis.bryntum.testProject=this),this.modelPersistencyManager=this.createModelPersistencyManager()}createModelPersistencyManager(){return new Pn({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}doDestroy(){this.modelPersistencyManager.destroy(),super.doDestroy()}get taskStore(){return this.eventStore}}$n.applyConfigs=!0,$n.initClass(),$n._$name="ProjectModel";export{we as AbstractAssignmentStoreMixin,je as AbstractCalendarManagerStoreMixin,Ee as AbstractCalendarMixin,dt as AbstractCrudManagerMixin,st as AbstractCrudManagerValidation,Oe as AbstractDependencyStoreMixin,Pe as AbstractEventStoreMixin,Ie as AbstractHasAssignmentsMixin,pe as AbstractPartOfProjectGenericMixin,ye as AbstractPartOfProjectModelMixin,fe as AbstractPartOfProjectStoreMixin,tt as AbstractProjectMixin,Xt as AbstractRecurrenceIterator,$e as AbstractResourceStoreMixin,ut as AjaxTransport,ft as AssignmentModel,vt as AssignmentModelMixin,Dt as AssignmentStore,yt as AssignmentStoreMixin,F as CI,be as CIFromSetOrArrayOrValue,le as CalendarCache,de as CalendarCacheInterval,ve as CalendarCacheSingle,Se as CalendarIntervalMixin,De as CalendarIntervalStore,oe as CalendarIteratorResult,ne as ConstraintIntervalSide,Z as ConstraintType,Be as CoreAssignmentMixin,Ve as CoreAssignmentStoreMixin,Ue as CoreCalendarManagerStoreMixin,Ye as CoreCalendarMixin,We as CoreDependencyMixin,Ke as CoreDependencyStoreMixin,Ne as CoreEventMixin,Ge as CoreEventStoreMixin,He as CoreHasAssignmentsMixin,Ze as CoreHasDependenciesMixin,Re as CorePartOfProjectGenericMixin,Te as CorePartOfProjectModelMixin,qe as CorePartOfProjectStoreMixin,Le as CoreResourceMixin,Qe as CoreResourceStoreMixin,gt as CrudManagerView,en as DailyRecurrenceIterator,Nt as DayIndexMixin,nt as DelayableWrapper,X as DependenciesCalendar,Cn as DependencyBaseModel,En as DependencyModel,xn as DependencyStore,In as DependencyStoreMixin,Q as DependencyType,G as DependencyValidationResult,te as Direction,ie as EdgeInclusion,Pt as EventDayIndex,fn as EventModel,vn as EventModelMixin,Sn as EventStore,bt as EventStoreMixin,At as GetEventsMixin,he as IndexPosition,me as IntervalCache,ht as JsonEncoder,se as MAX_DATE,k as MI,re as MIN_DATE,z as Mixin,K as MixinAny,nn as MonthlyRecurrenceIterator,mt as PartOfProject,bn as ProjectCrudManager,Fn as ProjectCurrentConfig,$n as ProjectModel,Mn as ProjectModelCommon,On as ProjectModelMixin,jn as ProjectModelTimeZoneMixin,ee as ProjectType,Kt as RecurrenceDayRuleEncoder,dn as RecurrenceModel,_t as RecurringEventsMixin,mn as RecurringTimeSpan,qt as RecurringTimeSpansMixin,It as ResourceModel,Rt as ResourceModelMixin,xt as ResourceStore,Ct as ResourceStoreMixin,An as ResourceTimeRangeModel,wn as ResourceTimeRangeStore,Je as SchedulerCoreEvent,rt as SchedulerCoreProjectMixin,J as SchedulingMode,Lt as SharedEventStoreMixin,ge as SortedMap,Ut as TimeSpan,H as TimeUnit,Yt as TimeZonedDatesMixin,Ce as UnspecifiedTimeIntervalModel,tn as WeeklyRecurrenceIterator,rn as YearlyRecurrenceIterator,ue as binarySearch,w as concat,j as concatIterable,Me as delay,Ae as format,ae as isDateFinite,W as isInstanceOf,xe as isNotNumber,x as later,M as map,ce as stripDuplicates,A as uniqueOnly};
//# sourceMappingURL=ProjectModel.js.map
