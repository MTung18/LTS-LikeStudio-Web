/*!
 *
 * Bryntum Calendar 5.3.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
import{stripDuplicates as e,CalendarCache as t,IntervalCache as i,TimeSpan as n,DependencyBaseModel as r,DependencyModel as a}from"./ProjectModel.js";import{_defineProperty as s,ObjectHelper as o,DateHelper as l,Duration as d,Widget as c,_objectSpread2 as u,DomSync as h,EventHelper as g,DomHelper as m,StringHelper as p,DomClassList as v,Events as f,Model as D,IdHelper as b,Localizable as S,Store as w,unitMagnitudes as C,InstancePlugin as y,Objects as x,Tooltip as T,Rectangle as E,BrowserHelper as R,VersionHelper as M,Delayable as k,Base as A,ArrayHelper as z,WalkHelper as P,DomDataStore as F,Scroller as L,ResizeMonitor as H,Collection as O,FunctionHelper as I}from"./Editor.js";import{ColumnStore as V,WidgetColumn as $,GridFeatureManager as W,HeaderMenu as _,Header as j,SubGrid as B,GridBase as U}from"./GridBase.js";import{NumberColumn as N}from"./RegionResize.js";import{DragHelper as G,ResizeHelper as Y}from"./MessageDialog.js";import{AvatarRendering as X,Draggable as Z,Droppable as q}from"./AvatarRendering.js";import{ClockTemplate as K,AttachToProjectMixin as J,RecurringEvents as Q}from"./EventNavigation.js";import"./Slider.js";class ee{initialize(e){e&&Object.assign(this,e)}static new(e){const t=new this;return t.initialize(e),t}}class te{constructor(e){this.intervalGroups=[],e&&Object.assign(this,e)}combineWith(e){const t=this.intervalGroups.slice();return t.push([e.calendar,e]),new te({intervalGroups:t})}getIsWorkingForEvery(){if(null!=this.isWorkingForEvery)return this.isWorkingForEvery;for(let[e,t]of this.getGroups())if(!t[0].isWorking)return this.isWorkingForEvery=!1;return this.isWorkingForEvery=!0}getIsWorkingForSome(){if(null!=this.isWorkingForSome)return this.isWorkingForSome;for(let[e,t]of this.getGroups())if(t[0].isWorking)return this.isWorkingForSome=!0;return this.isWorkingForSome=!1}getCalendars(){return this.getGroups(),this.calendars}isCalendarWorking(e){return this.getCalendarsWorkStatus().get(e)}getCalendarsWorkStatus(){if(this.calendarsWorkStatus)return this.calendarsWorkStatus;const e=new Map;for(let[t,i]of this.getGroups())e.set(t,i[0].isWorking);return this.calendarsWorkStatus=e}getCalendarsWorking(){if(this.calendarsWorking)return this.calendarsWorking;const e=[];for(let[t,i]of this.getGroups())i[0].isWorking&&e.push(t);return this.calendarsWorking=e}getCalendarsNonWorking(){if(this.calendarsNonWorking)return this.calendarsNonWorking;const e=[];for(let[t,i]of this.getGroups())i[0].isWorking||e.push(t);return this.calendarsNonWorking=e}getGroups(){if(this.intervalsByCalendar)return this.intervalsByCalendar;const t=this.calendars=[],i=new Map;return this.intervalGroups.forEach((([e,n])=>{let r=i.get(e);r||(t.push(e),r=[],i.set(e,r)),r.push.apply(r,n.intervals)})),i.forEach(((t,n)=>{const r=e(t);r.sort(((e,t)=>t.getPriorityField()-e.getPriorityField())),i.set(n,r)})),this.intervalsByCalendar=i}}class ie extends t{constructor(t){super(t),this.calendarCaches=e(this.calendarCaches),this.intervalCache=new i({emptyInterval:new te,combineIntervalsFn:(e,t)=>e.combineWith(t)})}fillCache(e,t){this.calendarCaches.forEach((i=>{i.fillCache(e,t),this.includeWrappingRangeFrom(i,e,t)}))}}const ne=new Map,re=t=>{const i=e(t);if(0===i.length)throw new Error("No calendars to combine");i.sort(((e,t)=>e.internalId<t.internalId?-1:1));const n=i.map((e=>e.internalId+"/")).join(""),r=i.map((e=>e.version+"/")).join("");let a,s=ne.get(n);return a=s&&s.versionsHash===r?s.cache:new ie({calendarCaches:i.map((e=>e.calendarCache))}),a};class ae extends N{constructor(...e){super(...e),s(this,"compositeField",!0)}static get $name(){return"DurationColumn"}static get type(){return"duration"}static get isGanttColumn(){return!0}static get fields(){return[{name:"decimalPrecision",defaultValue:1}]}static get defaults(){return{min:null,max:null,step:1,largeStep:0,field:"fullDuration",text:"L{Duration}",instantUpdate:!0,filterType:"duration",sortable(e,t){return e[this.field]-t[this.field]}}}construct(){super.construct(...arguments);const e=this.sortable;this.sortable=(...t)=>e.call(this,...t)}get defaultEditor(){const{max:e,min:t,step:i,largeStep:n}=this;return o.cleanupProperties({type:"duration",name:this.field,max:e,min:t,step:i,largeStep:n})}get durationUnitField(){return`${this.field}Unit`}formatValue(e,t){e instanceof d&&(t=e.unit,e=e.magnitude);const i="number"==typeof this.grid.durationDisplayPrecision?this.grid.durationDisplayPrecision:this.decimalPrecision,n=Math.pow(10,i);return Math.round(e*n)/n+" "+l.getLocalizedNameOfUnit(t,1!==e)}defaultRenderer({record:e,isExport:t}){const i=e[this.field],n=typeof i,r="number"===n?i:null==i?void 0:i.magnitude,a="number"===n?e[this.durationUnitField]:null==i?void 0:i.unit;return"number"!=typeof r?t?"":null:this.formatValue(r,a)}toClipboardString({record:e}){return e[this.field].toString()}fromClipboardString({string:e,record:t}){const i=l.parseDuration(e,!0,this.durationUnit);return i&&"magnitude"in i?i:t.fullDuration}calculateFillValue({value:e,record:t}){return this.fromClipboardString({string:e,record:t})}}function se(e,t){return e===t.length-1}function oe(e,t){return t===e.cells[e.cells.length-1]}V.registerColumnType(ae),ae._$name="DurationColumn";class le extends c{static get $name(){return"TimeAxisBase"}static get configurable(){return{compactCellWidthThreshold:15,model:null,cls:null,sizeProperty:null,positionProperty:null}}static get properties(){return{startDate:null,endDate:null,levels:[],size:null}}set range({startDate:e,endDate:t}){const i=this;(i.startDate-e||i.endDate-t)&&(i.startDate=e,i.endDate=t,i.refresh())}buildCells(e=this.startDate,t=this.endDate){var i;const n=this,{sizeProperty:r}=n,{stickyHeaders:a,isVertical:s}=n.client||{},o=[],{length:l}=n.levels,d=n.levels.map(((i,o)=>{var d;const c=a&&(s||o<l-1);return{className:{"b-sch-header-row":1,[`b-sch-header-row-${i.position}`]:1,"b-sch-header-row-main":o===n.model.viewPreset.mainHeaderLevel,"b-lowest":se(o,n.levels),"b-sticky-header":c},syncOptions:{releaseThreshold:5,syncIdField:"tickIndex"},dataset:{headerFeature:`headerRow${o}`,headerPosition:i.position},children:null===(d=i.cells)||void 0===d?void 0:d.filter((i=>i.start<t&&i.end>e)).map((e=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[e.headerCellCls]:e.headerCellCls,[`b-align-${e.align}`]:e.align,"b-last":oe(i,e)},dataset:u({tickIndex:e.index},globalThis.DEBUG&&{date:e.start.getTime()}),style:{[n.positionProperty]:e.coord,[r]:e.width,[`min-${r}`]:e.width},children:[{tag:"span",role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":c},html:e.value}]})))}}));return null===(i=n.client)||void 0===i||i.getHeaderDomConfigs(o),d.push(...o),{className:n.widgetClassList,syncOptions:{releaseThreshold:0},children:d}}render(e){super.render(e),this.refresh(!0)}refresh(e=!this.levels.length){const t=this,{columnConfig:i}=t.model,{levels:n}=t,r=n.length;if(e){n.length=0,i.forEach(((e,t)=>n[t]={position:t,cells:e})),t.size=n[0].cells.reduce(((e,t)=>e+t.width),0);const a=t.element.parentElement;a&&(n.length!==r||e)&&(a.classList.remove(`b-sch-timeaxiscolumn-levels-${r}`),a.classList.add(`b-sch-timeaxiscolumn-levels-${n.length}`))}t.startDate&&t.endDate&&(h.sync({domConfig:t.buildCells(),targetElement:t.element,syncIdField:"headerFeature"}),t.trigger("refresh"))}get widgetClass(){return"b-timeaxis"}}le._$name="TimeAxisBase";class de extends le{static get $name(){return"HorizontalTimeAxis"}static get type(){return"horizontaltimeaxis"}static get configurable(){return{model:null,sizeProperty:"width"}}get positionProperty(){var e;return null!==(e=this.owner)&&void 0!==e&&e.rtl?"right":"left"}get width(){return this.size}onModelUpdate(){this.model.availableSpace!==this.width&&this.refresh(!0)}updateModel(e){this.detachListeners("tavm"),null==e||e.ion({name:"tavm",update:"onModelUpdate",thisObj:this})}}de._$name="HorizontalTimeAxis";class ce extends c{construct(e){const t=this;e.scheduler._resourceColumns=t,super.construct(e),null!=t.imagePath&&t.element.classList.add("b-has-images"),g.on({element:t.element,delegate:".b-resourceheader-cell",capture:!0,click:"onResourceMouseEvent",dblclick:"onResourceMouseEvent",contextmenu:"onResourceMouseEvent",thisObj:t})}changeShowAvatars(e){var t;return null===(t=this.avatarRendering)||void 0===t||t.destroy(),e&&(this.avatarRendering=new X({element:this.element})),e}updateShowAvatars(){this.isConfiguring||this.refresh()}updateResourceStore(e){const t=this;t.detachListeners("resourceStore"),e&&(e.ion({name:"resourceStore",changePreCommit:"onResourceStoreDataChange",thisObj:t}),e.count&&t.onResourceStoreDataChange({}))}onResourceStoreDataChange({action:e}){const t=this;t.getConfig("fillWidth"),t.getConfig("fitWidth"),t.updateWidthCache();const{element:i}=t,n=t.totalWidth;t.scheduler.variableColumnWidths?t._fillWidth=t._fitWidth=!1:(t._fillWidth=t.configuredFillWidth,t._fitWidth=t.configuredFitWidth),n!==t.width&&(m.setLength(i,"width",n),t.column.set("width",n,t.column.grid.isConfiguring)),"removeall"===e&&(i.innerHTML=""),("remove"===e||"add"===e||"filter"===e||t.fitWidth||t.fillWidth)&&t.refreshWidths(),t.column.grid.toggleEmptyText()}get totalWidth(){return this.updateWidthCache()}updateWidthCache(){let e=0;const{scheduler:t}=this;return t.variableColumnWidths=!1,t.resourceStore.forEach((i=>{i.instanceMeta(t).insetStart=e,i.instanceMeta(t).insetEnd=e+(i.columnWidth||t.resourceColumnWidth),null==i.columnWidth?e+=t.resourceColumnWidth:(e+=i.columnWidth,t.variableColumnWidths=!0)})),e}changeColumnWidth(e){return this.refreshingWidths||(this.configuredColumnWidth=e),e}updateColumnWidth(e,t){const i=this;i.refreshingWidths||i.refreshWidths(),i.isConfiguring||(i.refresh(),i.trigger("columnWidthChange",{width:e,oldWidth:t}))}changeFillWidth(e){return this.configuredFillWidth=e}updateFillWidth(){this.isConfiguring||this.refreshWidths()}changeFitWidth(e){return this.configuredFitWidth=e}updateFitWidth(){this.isConfiguring||this.refreshWidths()}getImageURL(e){return p.joinPaths([this.imagePath||"",e||""])}updateImagePath(){this.isConfiguring||this.refresh()}updateAvailableWidth(e){this.refreshWidths()}refreshWidths(){var e;const t=this,{availableWidth:i,configuredColumnWidth:n}=t,r=null===(e=t.resourceStore)||void 0===e?void 0:e.count;if(!i||!r||t.scheduler.variableColumnWidths)return;t.refreshingWidths=!0;const a=t.fitWidth||t.fillWidth&&n*r<i?Math.floor(i/r):n,s=t.column.grid.enableEventAnimations&&Math.abs(t._columnWidth-a)>30;m.addTemporaryClass(t.element,"b-animating",s?300:0,t),t.columnWidth=a,t.refreshingWidths=!1}set visibleResources({firstResource:e,lastResource:t}){this.firstResource=e,this.lastResource=t,this.updateWidthCache(),this.refresh()}refresh(){const e=this,{firstResource:t,scheduler:i,resourceStore:n,lastResource:r}=e,{variableColumnWidths:a}=i,s=n.isGrouped&&n.groupers[0].field,o=[];if(e.element.classList.toggle("b-grouped",Boolean(s)),!e.column.grid.isConfiguring&&t>-1&&r>-1&&r<n.count){let c;for(let u=t;u<=r;u++){var l;const t=n.allResourceRecords[u],r=t.instanceMeta(n).groupParent,h=null==r?void 0:r.groupChildren;if(s&&r.id!==(null===(l=c)||void 0===l?void 0:l.dataset.resourceId)){const e=h[0].instanceMeta(i).insetStart,t=h[h.length-1].instanceMeta(i).insetEnd-e;c={className:"b-resourceheader-group-cell",dataset:{resourceId:r.id},style:{left:e,width:t},children:[{tag:"span",html:p.encodeHtml(h[0][s])},{className:"b-resourceheader-group-children",children:[]}]},o.push(c)}const g=t.instanceMeta(i),m=t.columnWidth||e.columnWidth,f=s?g.insetStart-c.style.left:a?g.insetStart:u*e.columnWidth,D={className:new v({"b-resourceheader-cell":1}),dataset:{resourceId:t.id},style:{[i.rtl?"right":"left"]:f,width:m},children:[]};if(e.headerRenderer){const i=e.headerRenderer({elementConfig:D,resourceRecord:t});null!=i&&(D.html=i)}else{let i;if(t.imageUrl)i=t.imageUrl;else if(null!=e.imagePath&&!1!==t.image){var d;const n=t.image||(null===(d=t.name)||void 0===d?void 0:d.toLowerCase())+e.imageExtension;i=e.getImageURL(n)}D.children.push(e.showAvatars&&e.avatarRendering.getResourceAvatar({resourceRecord:t,initials:t.initials,color:t.eventColor,iconCls:t.iconCls,defaultImageUrl:e.defaultImageName&&e.getImageURL(e.defaultImageName),imageUrl:i}),{tag:"span",className:"b-resource-name",html:p.encodeHtml(t.name)})}s?c.children[1].children.push(D):o.push(D)}}h.sync({domConfig:{onlyChildren:!0,children:o},targetElement:e.element,syncIdField:"resourceId"})}onResourceMouseEvent(e){const t=e.target.closest(".b-resourceheader-cell"),i=this.resourceStore.getById(t.dataset.resourceId);this.trigger("resourceHeader"+p.capitalize(e.type),{resourceRecord:i,event:e})}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.resourceStore,delete t.column,delete t.type,t}}s(ce,"$name","ResourceHeader"),s(ce,"type","resourceheader"),s(ce,"configurable",{resourceStore:null,headerRenderer:null,showAvatars:{value:!0,$config:"nullify"},fillWidth:!0,fitWidth:!1,columnWidth:150,imagePath:null,imageExtension:null,defaultImageName:null,availableWidth:null}),s(ce,"properties",{firstResource:-1,lastResource:-1}),ce._$name="ResourceHeader";class ue extends(f($)){static get fields(){return[{name:"locked",persist:!1},{name:"flex",persist:!1},{name:"width",persist:!1},{name:"cellCls",persist:!1},{name:"field",persist:!1},"mode"]}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,resizable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cls:"b-sch-timeaxiscolumn",needWidth:!0,mode:null,region:"normal",exportable:!1,htmlEncode:!1}}static get type(){return"timeAxis"}construct(e){const t=this;super.construct(...arguments),t.thisObj=t,t.timeAxisViewModel=t.grid.timeAxisViewModel,t.mode=t.mode,t.grid.ion({paint:"onTimelinePaint",thisObj:t,once:!0})}static get autoExposeFields(){return!0}doDestroy(){var e,t;null===(e=this.resourceColumns)||void 0===e||e.destroy(),null===(t=this.timeAxisView)||void 0===t||t.destroy(),super.doDestroy()}set mode(e){const t=this,{grid:i}=t;t.set("mode",e),"horizontal"===e?t.timeAxisView=new de({model:t.timeAxisViewModel,compactCellWidthThreshold:t.compactCellWidthThreshold,owner:i,client:i}):"vertical"===e&&(t.resourceColumns=ce.new({column:t,scheduler:i,resourceStore:i.resourceStore,imagePath:i.resourceImagePath,imageExtension:i.resourceImageExtension,defaultImageName:i.defaultResourceImageName},i.resourceColumns||{}),t.relayEvents(t.resourceColumns,["resourceheaderclick","resourceheaderdblclick","resourceheadercontextmenu"]))}get mode(){return this.get("mode")}onViewModelUpdate({source:e}){const t=this;"horizontal"===t.mode?(t.refreshHeader(!0),t.width=e.totalSize,t.grid.refresh(),t.subGrid.refreshFakeScroll()):"vertical"===t.mode&&t.grid.refreshRows()}onTimelinePaint({firstPaint:e}){const t=this;var i;t.subGrid.insertRowsBefore&&(e&&(t.subGridElement.classList.add("b-timeline-subgrid"),"vertical"===t.mode&&(t.refreshHeader(),null===(i=t.grid)||void 0===i||i.onHeightChange())))}refreshHeader(e){const t=this,{element:i}=t;i&&("horizontal"===t.mode?(!e&&t.timeAxisViewModel.update(void 0,void 0,!0),t.timeAxisView.rendered?t.timeAxisView.refresh(!0):(i.innerHTML="",t.timeAxisView.render(i))):"vertical"===t.mode&&(t.resourceColumns.currentElement||(i.innerHTML="",t.resourceColumns.render(i))))}internalRenderer(e){const{grid:t}=this;if(t.project.isInitialCommitPerformed||t.project.isDelayingCalculation)return t.currentOrientation.renderer(e),super.internalRenderer(e)}get timeAxisViewModel(){return this._timeAxisViewModel}set timeAxisViewModel(e){const t=this;t.detachListeners("tavm"),null==e||e.ion({name:"tavm",update:"onViewModelUpdate",prio:-1e4,thisObj:t}),t._timeAxisViewModel=e,t.timeAxisView&&(t.timeAxisView.model=e)}getState(){const e=super.getState();return delete e.width,delete e.flex,e}}s(ue,"$name","TimeAxisColumn"),V.registerColumnType(ue),ue._$name="TimeAxisColumn";class he extends D{static get fields(){return[{name:"base",type:"string"},{name:"name",type:"string"},{name:"rowHeight",defaultValue:24},{name:"tickWidth",defaultValue:50},{name:"tickHeight",defaultValue:50},{name:"displayDateFormat",defaultValue:"HH:mm"},{name:"shiftUnit",defaultValue:"hour"},{name:"shiftIncrement",defaultValue:1},{name:"defaultSpan",defaultValue:12},{name:"mainUnit"},{name:"start"},"timeResolution","headers","mainHeaderLevel","columnLinesFor"]}construct(){super.construct(...arguments),this.normalizeUnits()}generateId(e){const t=this,{headers:i}=t,n=[];let r=Object.getPrototypeOf(t.data).id;if(!r){for(let{length:e}=i,t=e-1;t>=0;t--){const{unit:e,increment:r}=i[t],a=r>1;n.push(`${a?r:""}${t?e:p.capitalize(e)}${a?"s":""}`)}r=n.join("And")}return e.count&&e.includes(r)&&(r+=`-${t.tickWidth}by${t.tickHeight||t.tickWidth}`,e.includes(r)&&(r+=`-${t.bottomHeader.increment}`,e.includes(r)&&(r=b.generateId(`${r}-`)))),r}normalizeUnits(){const e=this,{timeResolution:t,headers:i,shiftUnit:n}=e;if(i)for(let e=0,{length:t}=i;e<t;e++){const t=i[e];t.unit=l.normalizeUnit(t.unit),t.splitUnit&&(t.splitUnit=l.normalizeUnit(t.splitUnit)),"increment"in t||(i[e]=Object.assign({increment:1},t))}t&&(t.unit=l.normalizeUnit(t.unit)),n&&(e.shiftUnit=l.normalizeUnit(n))}static normalizeHeaderConfig(e){const{headerConfig:t,columnLinesFor:i,mainHeaderLevel:n}=e,r=e.headers=[];if(t.top&&("top"===i&&(e.columnLinesFor=0),"top"===n&&(e.mainHeaderLevel=0),r[0]=t.top),!t.middle)throw new Error("ViewPreset.headerConfig must be configured with a middle");"middle"===i&&(e.columnLinesFor=r.length),"middle"===n&&(e.mainHeaderLevel=r.length),r.push(t.middle),t.bottom&&(e.mainHeaderLevel=r.length-1,null==i?e.columnLinesFor=r.length-1:"bottom"===i&&(e.columnLinesFor=r.length),null==n&&(e.mainHeaderLevel=r.length-1),"bottom"===n&&(e.mainHeaderLevel=r.length),r.push(t.bottom))}set(){}inSet(){}get columnLinesFor(){return"columnLinesFor"in this.data?this.data.columnLinesFor:this.headers.length-1}get tickSize(){return this._tickSize||this.tickWidth}get tickWidth(){return"tickWidth"in this.data?this.data.tickWidth:50}get tickHeight(){return"tickHeight"in this.data?this.data.tickHeight:50}get headerConfig(){if(this.data.headerConfig)return this.data.headerConfig;const e={},{headers:t}=this,{length:i}=t;switch(i){case 1:e.middle=t[0];break;case 2:0===this.mainHeaderLevel?(e.middle=t[0],e.bottom=t[1]):(e.top=t[0],e.middle=t[1]);break;case 3:e.top=t[0],e.middle=t[1],e.bottom=t[2];break;default:throw new Error("headerConfig object not supported for >3 header levels")}return e}set mainHeaderLevel(e){this.data.mainHeaderLevel=e}get mainHeaderLevel(){return"mainHeaderLevel"in this.data?this.data.mainHeaderLevel:3===this.data.headers.length?1:this.headers.length-1}get mainHeader(){return this.headers[this.mainHeaderLevel]}get bottomHeader(){return this.headers[this.headers.length-1]}get leafUnit(){return this.bottomHeader.unit}get leafIncrement(){return this.bottomHeader.increment}get mainUnit(){return"mainUnit"in this.data?this.data.mainUnit:this.mainHeader.unit}get msPerPixel(){const{bottomHeader:e}=this;return Math.round(l.asMilliseconds(e.increment||1,e.unit)/this.tickWidth)}get isValid(){const e=this;let t=!0;for(const i of e.headers)t=t&&Boolean(l.normalizeUnit(i.unit));return e.timeResolution&&(t=t&&l.normalizeUnit(e.timeResolution.unit)),e.shiftUnit&&(t=t&&l.normalizeUnit(e.shiftUnit)),t}}s(he,"$name","ViewPreset"),he._$name="ViewPreset";class ge extends(S(w)){static get $name(){return"PresetStore"}static get defaultConfig(){return{useRawData:!0,modelClass:he,zoomOrder:1}}set storage(e){super.storage=e,this.storage.addSorter(((e,t)=>{const i=e.bottomHeader,n=t.bottomHeader;return(t.msPerPixel-e.msPerPixel||C[i.unit]-C[n.unit]||i.increment-n.increment)*this.zoomOrder}))}get storage(){return super.storage}getById(e){return super.getById(e)||!this.isPresetManager&&me.getById(e)}createRecord(e,...t){let i;if(e.isViewPreset)return e;if("string"==typeof e)i=this.getById(e);else{if("number"!=typeof e)return e.base&&(e=this.copyBaseValues(e)),super.createRecord(e,...t);i=this.getAt(e)}if(!i)throw new Error(`ViewPreset ${e} does not exist`);return i}updateLocalization(){super.updateLocalization();const e=this;let t=e.allRecords;e.isPresetManager&&(t=new Set(t.concat(Object.values(e.basePresets)))),t.forEach((t=>{let i=e.optionalL(`L{PresetManager.${t.id}}`,null,!0);"string"==typeof i&&t.baseId&&(i=e.optionalL(`L{PresetManager.${t.baseId}}`,null,!0)),i&&"object"==typeof i&&(t.originalDisplayDateFormat||(t.originalDisplayDateFormat=t.displayDateFormat),0===t.mainHeaderLevel&&i.topDateFormat&&(i.middleDateFormat=i.middleDateFormat||i.topDateFormat),t.setData("displayDateFormat",i.displayDateFormat||t.originalDisplayDateFormat),["top","middle","bottom"].forEach((e=>{const n=t.headerConfig[e],r=i[e+"DateFormat"];n&&(n.originalDateFormat||(n.originalDateFormat=n.dateFormat),r&&n.renderer&&(n.renderer=null),n.dateFormat=r||n.originalDateFormat)})),i.name?(t.unlocalizedName||(t.unlocalizedName=t.name),t.setData("name",i.name)):t.unlocalizedName&&t.unlocalizedName!==t.name&&(t.name=t.unlocalizedName,t.unlocalizedName=null))}))}getCurrentConfig(e){return super.getCurrentConfig(e).data}copyBaseValues(e){let t=this.getById(e.base);if(!t)throw new Error(`ViewPreset base '${e.base}' does not exist.`);return t=o.clone(t.data),delete t.id,delete t.name,o.merge(t,e)}add(e){return(e=Array.isArray(e)?e:[e]).forEach((e=>{e.isViewPreset&&e.base&&(e.data=this.copyBaseValues(e.originalData))})),super.add(...arguments)}}ge._$name="PresetStore";const me=new class extends ge{static get $name(){return"PresetManager"}static get defaultConfig(){return{preventSubClassingModel:!0,basePresets:{secondAndMinute:{name:"Seconds",tickWidth:30,tickHeight:40,displayDateFormat:"ll LTS",shiftIncrement:10,shiftUnit:"minute",defaultSpan:24,timeResolution:{unit:"second",increment:5},headers:[{unit:"minute",dateFormat:"llll"},{unit:"second",increment:10,dateFormat:"ss"}]},minuteAndHour:{name:"Minutes",tickWidth:60,tickHeight:60,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"hour",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"hour",dateFormat:"ddd MM/DD, hA"},{unit:"minute",increment:30,dateFormat:"mm"}]},hourAndDay:{name:"Day",tickWidth:70,tickHeight:40,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"day",dateFormat:"ddd DD/MM"},{unit:"hour",dateFormat:"LT"}]},day:{name:"Day/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:1,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"day",dateFormat:"ddd DD/MM",splitUnit:"day"},{unit:"hour",renderer:e=>`\n                                    <div class="b-sch-calendarcolumn-ct"><span class="b-sch-calendarcolumn-hours">${l.format(e,"HH")}</span>\n                                    <span class="b-sch-calendarcolumn-minutes">${l.format(e,"mm")}</span></div>\n                                `}]},week:{name:"Week/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"week",defaultSpan:24,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"D d",splitUnit:"day"},{unit:"hour",dateFormat:"LT",renderer:e=>`\n                                    <div class="sch-calendarcolumn-ct">\n                                    <span class="sch-calendarcolumn-hours">${l.format(e,"HH")}</span>\n                                    <span class="sch-calendarcolumn-minutes">${l.format(e,"mm")}</span>\n                                    </div>\n                                `}]},dayAndWeek:{name:"Days & Weeks",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"day",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"hour",increment:1},headers:[{unit:"week",renderer:e=>l.getShortNameOfUnit("week")+"."+l.format(e,"WW MMM YYYY")},{unit:"day",dateFormat:"dd DD"}]},dayAndMonth:{name:"Month",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"month",shiftIncrement:1,defaultSpan:1,mainUnit:"month",timeResolution:{unit:"hour",increment:1},headers:[{unit:"month",dateFormat:"MMMM YYYY"},{unit:"day",dateFormat:"DD"}]},weekAndDay:{name:"Week",tickWidth:100,tickHeight:80,displayDateFormat:"ll hh:mm A",shiftUnit:"week",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"YYYY MMMM DD"},{unit:"day",increment:1,dateFormat:"DD MMM"}]},weekAndMonth:{name:"Weeks",tickWidth:100,tickHeight:105,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"MMM YYYY"},{unit:"week",dateFormat:"DD MMM"}]},weekAndDayLetter:{name:"Weeks/weekdays",tickWidth:20,tickHeight:50,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"ddd DD MMM YYYY",verticalColumnWidth:115},{unit:"day",dateFormat:"d1",verticalColumnWidth:25}]},weekDateAndMonth:{name:"Months/weeks",tickWidth:30,tickHeight:40,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"YYYY MMMM"},{unit:"week",dateFormat:"DD"}]},monthAndYear:{name:"Months",tickWidth:110,tickHeight:110,displayDateFormat:"ll",shiftIncrement:3,shiftUnit:"month",defaultSpan:12,timeResolution:{unit:"day",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"month",dateFormat:"MMM YYYY"}]},year:{name:"Years",tickWidth:100,tickHeight:100,resourceColumnWidth:100,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"month",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"quarter",renderer:(e,t,i)=>l.getShortNameOfUnit("quarter").toUpperCase()+(Math.floor(e.getMonth()/3)+1)}]},manyYears:{name:"Multiple years",tickWidth:40,tickHeight:50,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"year",increment:1},mainHeaderLevel:0,headers:[{unit:"year",increment:5,renderer:(e,t)=>e.getFullYear()+" - "+t.getFullYear()},{unit:"year",dateFormat:"YY",increment:1}]}},defaultPresets:["manyYears",{width:80,increment:1,resolution:1,base:"manyYears",resolutionUnit:"YEAR"},"year",{width:30,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},"monthAndYear","weekDateAndMonth","weekAndMonth","weekAndDayLetter","dayAndMonth","weekAndDay",{width:54,increment:1,resolution:1,base:"weekAndDay",resolutionUnit:"HOUR"},"hourAndDay",{width:64,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:2,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},"minuteAndHour",{width:30,increment:15,resolution:5,base:"minuteAndHour"},{width:130,increment:15,resolution:5,base:"minuteAndHour"},{width:60,increment:5,resolution:5,base:"minuteAndHour"},{width:100,increment:5,resolution:5,base:"minuteAndHour"},"secondAndMinute",{width:60,increment:10,resolution:5,base:"secondAndMinute"},{width:130,increment:5,resolution:5,base:"secondAndMinute"}],internalListeners:{locale:"updateLocalization"}}}set basePresets(e){const t=this._basePresets={};for(const i in e)e[i].id=i,t[i]=this.createRecord(e[i])}get basePresets(){return this._basePresets}set defaultPresets(e){for(let t=0,{length:i}=e;t<i;t++){const i=e[t],n="string"==typeof i,r=n?i:i.base;let a;if(n)a=this.basePresets[r];else{const e=Object.setPrototypeOf(o.clone(this.basePresets[r].data),{id:r}),{timeResolution:t}=e,n=e.headers[e.headers.length-1];e.id=void 0,"width"in i&&(e.tickWidth=i.width),"height"in i&&(e.tickHeight=i.height),"increment"in i&&(n.increment=i.increment),"resolution"in i&&(t.increment=i.resolution),"resolutionUnit"in i&&(t.unit=l.getUnitByName(i.resolutionUnit)),a=this.createRecord(e),a.baseId=r}this.add(a)}}getById(e){return super.getById(e)||this.basePresets[e]}registerPreset(e,t){const i=this.createRecord(Object.assign({id:e},t)),n=this.find((e=>e.equals(i)));if(n)return n;if(!i.isValid)throw new Error("Invalid preset, please check your configuration");return this.add(i),i}getPreset(e){return"number"==typeof e&&(e=this.getAt(e)),"string"==typeof e?e=this.getById(e):e instanceof he||(e=this.createRecord(e)),e}normalizePreset(e){const t=this;if(!(e instanceof he))if("string"==typeof e){if(!(e=t.getPreset(e)))throw new Error("You must define a valid view preset. See PresetManager for reference")}else if("object"==typeof e){if(e.base){const t=this.getById(e.base);if(!t)throw new Error(`ViewPreset base '${e.base}' does not exist`);e=o.merge(o.clone(t.data),e)}e.id?e=t.createRecord(e):(e=t.createRecord(o.assign({},e))).id=e.generateId(e)}return e}deletePreset(e){"string"==typeof e?e=this.getById(e):"number"==typeof e&&(e=this.getAt(e)),e&&(this.remove(e),delete this.basePresets[e.id])}};class pe extends n{get startDate(){return this.data.startDate}get endDate(){return this.data.endDate}}class ve extends w{static get defaultConfig(){return{modelClass:pe,continuous:!0,originalContinuous:null,include:null,autoAdjust:!0,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,tickCache:{},viewPreset:null,useRawData:{disableDuplicateIdCheck:!0,disableDefaultValue:!0,disableTypeConversion:!0}}}static get configurable(){return{generateTicks:null,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,defaultSpan:1,weekStartDay:null,forceFullTicks:null}}construct(e){const t=this;if(super.construct(e),t.originalContinuous=t.continuous,t.ion({change:({action:e})=>{"filter"!==e&&t.trigger("reconfigure",{supressRefresh:!1})},refresh:()=>t.trigger("reconfigure",{supressRefresh:!1}),endreconfigure:e=>t.trigger("reconfigure",e)}),t.startDate)t.internalOnReconfigure(),t.trigger("reconfigure");else if(t.viewPreset){const e=t.getAdjustedDates(new Date);t.startDate=e.startDate,t.endDate=e.endDate}}get isTimeAxis(){return!0}reconfigure(e,t=!1,i=!1){const n=this,r=n.getAdjustedDates(e.startDate,e.endDate),a={};if(!1!==n.trigger("beforeReconfigure",{startDate:r.startDate,endDate:r.endDate,config:e})){n.trigger("beginReconfigure"),n._configuredStartDate=e.startDate,n._configuredEndDate=e.endDate;for(const t in e)a[t]=n[t];if(Object.assign(n,e),!1===n.internalOnReconfigure(i))return!1;n.trigger("endReconfigure",{suppressRefresh:t,config:e,oldConfig:a})}}internalOnReconfigure(e=!1){const t=this;t.isConfigured=!0;const i=t.getAdjustedDates(t.startDate,t.endDate,!0),n=t.getAdjustedDates(t.startDate,t.endDate),r=n.startDate,a=n.endDate;if(r>=a)throw new Error(`Invalid start/end dates. Start date must less than end date. Start date: ${r}. End date: ${a}.`);const{unit:s,increment:o=1}=t,d=t.generateTicks(r,a,s,o);t.suspendEvents(),t.data=d;const{count:c}=t;if(0===c){if(e)return t.resumeEvents(),!1;throw new Error("Invalid time axis configuration or filter, please check your input data.")}t.startDate=t.first.startDate,t.endDate=t.last.endDate,t.resumeEvents(),t.isContinuous?(t.adjustedStart=i.startDate,t.adjustedEnd=l.getNext(c>1?d[c-1].startDate:i.startDate,s,o,t.weekStartDay)):(t.adjustedStart=t.startDate,t.adjustedEnd=t.endDate),t.updateVisibleTickBoundaries(),t.updateTickCache(!0)}updateVisibleTickBoundaries(){const e=this,{count:t,unit:i,startDate:n,endDate:r,weekStartDay:a,increment:s=1}=e,o=l.getNormalizedUnitDuration(n,i)*s,d=l.getNormalizedUnitDuration(r,i)*s;do{e.visibleTickStart=(n-e.adjustedStart)/o,e.autoAdjust&&(e.visibleTickStart=Math.floor(e.visibleTickStart)),e.visibleTickStart>=1&&(e.adjustedStart=l.getNext(e.adjustedStart,i,s,a))}while(e.visibleTickStart>=1);do{e.visibleTickEnd=t-(e.adjustedEnd-r)/d,t-e.visibleTickEnd>=1&&(e.adjustedEnd=l.getNext(e.adjustedEnd,i,-1,a))}while(t-e.visibleTickEnd>=1);e.fullTicks=!e.visibleTickStart&&e.visibleTickEnd===t}get viewPreset(){return this._viewPreset}set viewPreset(e){if(!((e=me.getPreset(e))instanceof he))throw new Error("TimeAxis must be configured with the ViewPreset instance that the Scheduler is using");this._viewPreset=e,Object.assign(this,{unit:e.bottomHeader.unit,increment:e.bottomHeader.increment||1,resolutionUnit:e.timeResolution.unit,resolutionIncrement:e.timeResolution.increment,mainUnit:e.mainHeader.unit,shiftUnit:e.shiftUnit||e.mainHeader.unit,shiftIncrement:e.shiftIncrement||1,defaultSpan:e.defaultSpan||1,presetName:e.id,headers:e.headers})}get weekStartDay(){var e;return null!==(e=this._weekStartDay)&&void 0!==e?e:l.weekStartDay}get resolution(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}}set resolution(e){this.resolutionUnit=e.unit,this.resolutionIncrement=e.increment}get resolutionUnit(){return this.forceFullTicks?this.unit:this._resolutionUnit}get resolutionIncrement(){return this.forceFullTicks?this.increment:this._resolutionIncrement}setTimeSpan(e,t,i=!1){t&&e-t==0&&(t=null);const n=this,{startDate:r,endDate:a}=n.getAdjustedDates(e,t);if(n.startDate-r!=0||n.endDate-a!=0)return n.reconfigure({startDate:r,endDate:a},!1,i)}shift(e,t=this.shiftUnit){const i=this;let{startDate:n,endDate:r}=i;i.isFiltered&&(n=i.allRecords[0].startDate,r=i.allRecords[i.allCount-1].endDate);let a=0;do{n=l.add(n,e,t),r=l.add(r,e,t)}while(a++<100&&!1===i.setTimeSpan(n,r,{preventThrow:!0}))}shiftNext(e=this.shiftIncrement){this.shift(e)}shiftPrevious(e=this.shiftIncrement){this.shift(-e)}filterBy(e,t=this){const i=this;i.filters.clear(),super.filterBy(((i,n)=>e.call(t,i.data,n))),0===i.count&&(i.trigger("invalidFilter"),i.clearFilters())}triggerFilterEvent(e){const t=this;e.filters.count?t.continuous=!1:t.continuous=t.originalContinuous,t.updateTickCache(),super.triggerFilterEvent(e)}get isContinuous(){return!1!==this.continuous&&!this.isFiltered}getAdjustedDates(e,t,i=!1){const n=this;return t&&e-t==0&&(t=null),e=e||n.startDate,t=t||l.add(e,n.defaultSpan,n.mainUnit),n.autoAdjust||i?{startDate:n.floorDate(e,!1,n.autoAdjust?n.mainUnit:n.unit,1),endDate:n.ceilDate(t,!1,n.autoAdjust?n.mainUnit:n.unit,1)}:{startDate:e,endDate:t}}get startDate(){return this._start||(this.first?new Date(this.first.startDate):null)}set startDate(e){this._start=l.parse(e)}get endDate(){return this._end||(this.last?new Date(this.last.endDate):null)}set endDate(e){e&&(this._end=l.parse(e))}get startMS(){return this._startMS}get endMS(){return this._endMS}floorDate(e,t,i,n){const r=this,a=(t=!1!==t)?l.clone(r.startDate):null,s=n||r.resolutionIncrement,o=i||(t?r.resolutionUnit:r.mainUnit),d=(e,t)=>Math.floor(e/t)*t;if(t){const t=d(l.diff(a,e,o),s);return l.add(a,t,o,!1)}const c=l.clone(e);if("week"===o){const e=c.getDay()||7,t=r.weekStartDay||7;l.add(l.startOf(c,"day",!1),e>=t?t-e:-(7-t+e),"day",!1),c.getDay()!==t&&23===c.getHours()&&l.add(c,1,"hour",!1)}else{l.startOf(c,o,!1);const e=["day","year"].includes(o)?1:0,t="day"===o?"date":o,i=d(l.get(c,t)-e,s)+e;l.set(c,t,i)}return c}roundDate(e,t,i=this.resolutionUnit,n=this.resolutionIncrement||1){const r=this,a=l.clone(e);switch(t=l.clone(t||r.startDate),i){case"week":{l.startOf(a,"day",!1);let e,t=a.getDay()-r.weekStartDay;return t<0&&(t=7+t),e=1===Math.round(t/7)?7-t:-t,l.add(a,e,"day",!1)}case"month":{const e=l.diff(t,a,"month")+l.as("month",a.getDay()/l.daysInMonth(a)),i=Math.round(e/n)*n;return l.add(t,i,"month",!1)}case"quarter":return l.startOf(a,"month",!1),l.add(a,3-a.getMonth()%3,"month",!1);default:{const e=l.as(i,l.diff(t,a)),r=l.as(i,t.getTimezoneOffset()-a.getTimezoneOffset(),"minute"),s=Math.round((e+r)/n)*n;return l.add(t,s-r,i,!1)}}}ceilDate(e,t,i,n){const r=this;t=!1!==t,n=n||(t?r.resolutionIncrement:1);const a=i||(t?r.resolutionUnit:r.mainUnit),s=l.clone(e);let o=!1;switch(a){case"minute":o=!l.isStartOf(s,"minute");break;case"hour":o=!l.isStartOf(s,"hour");break;case"day":case"date":o=!l.isStartOf(s,"day");break;case"week":l.startOf(s,"day",!1),o=s.getDay()!==r.weekStartDay||!l.isEqual(s,e);break;case"month":l.startOf(s,"day",!1),o=1!==s.getDate()||!l.isEqual(s,e);break;case"quarter":l.startOf(s,"day",!1),o=s.getMonth()%3!=0||1!==s.getDate()||!l.isEqual(s,e);break;case"year":l.startOf(s,"day",!1),o=0!==s.getMonth()||1!==s.getDate()||!l.isEqual(s,e)}return o?l.getNext(s,a,n,r.weekStartDay):s}get include(){return this._include}set include(e){const t=this;t._include=e,t.continuous=!e,t.isConfiguring||(t.startDate=t._configuredStartDate,t.endDate=t._configuredEndDate,t.internalOnReconfigure(),t.trigger("includeChange"))}processExclusion(e,t,i){const{include:n}=this;return!!n&&Object.entries(n).some((([n,r])=>{if(!r)return!1;const{from:a,to:s}=r;if(l.compareUnits("day",i)>=0&&l.getLargerUnit(n)===i&&(a&&l.set(e,n,a),s)){let e=i;"day"===i&&(e="date"),l.set(t,{[e]:l.get(t,e)-1,[n]:s})}if(l.compareUnits(n,i)>=0){const t="day"===n?e.getDay():l.get(e,n);if(a&&t<a||s&&t>=s)return!0}}))}initExclusion(){Object.entries(this.include).forEach((([e,t])=>{if(t){const{from:i,to:n}=t;t.lengthFactor=l.getUnitToBaseUnitRatio(e,l.getLargerUnit(e))/(n-i),t.lengthFactorExcl=l.getUnitToBaseUnitRatio(e,l.getLargerUnit(e))/(n-i-1),t.center=i+i/(t.lengthFactor-1)}}))}updateGenerateTicks(){this.isConfiguring||this.reconfigure(this)}_generateTicks(e,t,i=this.unit,n=this.increment){const r=this,a=[],s=Boolean(r.include);let o,d,c,u=0,{startDate:h,endDate:g}=r.getAdjustedDates(e,t);for(r.tickCache={},s&&r.initExclusion();h<g;){if(o=l.getNext(h,i,n,r.weekStartDay),!r.autoAdjust&&o>g&&(o=g),"hour"===i&&n>1&&a.length>0&&0===u){const e=a[a.length-1];u=(e.startDate.getHours()+n)%24-e.endDate.getHours(),0!==u&&(o=l.add(o,u,"hour"))}c=!1,s?(d=new Date(o.getTime()),c=r.processExclusion(h,o,i)):d=o,c||(a.push({id:a.length+1,startDate:h,endDate:o}),r.tickCache[h.getTime()]=a.length-1),h=d}return a}get visibleTickTimeSpan(){const e=this;return e.isContinuous?e.visibleTickEnd-e.visibleTickStart:e.count}getTickFromDate(e){var t,i;const n=this,r=n.records,a=null!==(t=null===(i=e.getTime)||void 0===i?void 0:i.call(e))&&void 0!==t?t:e;let s,o,l,d,c=0,u=r.length-1;if(!r.length||a<r[0].startDateMS||a>r[u].endDateMS)return-1;if(n.isContinuous){for(;c<u;)s=c+u+1>>1,a>r[s].endDateMS?c=s+1:a<r[s].startDateMS?u=s-1:c=s;return o=r[c],l=o.startDateMS,a>l&&(d=o.endDateMS,c+=(a-l)/(d-l)),Math.min(Math.max(c,n.visibleTickStart),n.visibleTickEnd)}for(let e=0;e<=u;e++)if(d=r[e].endDateMS,a<=d)return l=r[e].startDateMS,o=e+(a>l?(a-l)/(d-l):0),o}getDateFromTick(e,t){const i=this;if(e===i.visibleTickEnd)return i.endDate;const n=Math.floor(e),r=e-n,a=i.getAt(n);if(!a)return null;const s=0===n?i.adjustedStart:a.startDate,o=n===i.count-1&&i.isContinuous?i.adjustedEnd:a.endDate;let d=l.add(s,r*(o-s),"millisecond");return t&&(d=i[t+"Date"](d)),d}get ticks(){return this.records}updateTickCache(e=!1){const t=this;t.count?(t._start=t.first.startDate,t._end=t.last.endDate,t._startMS=t.startDate.getTime(),t._endMS=t.endDate.getTime()):t._start=t._end=t._startMs=t._endMS=null,e||(t.tickCache={},t.forEach(((e,i)=>t.tickCache[e.startDate.getTime()]=i)))}dateInAxis(e,t=!1){const i=this,n=i.startDate,r=i.endDate;if(i.isContinuous)return t?l.betweenLesserEqual(e,n,r):l.betweenLesser(e,n,r);{const n=i.getCount();let r,a,s;for(let o=0;o<n;o++)if(s=i.getAt(o),r=s.startDate,a=s.endDate,t&&e<=a||!t&&e<a)return e>=r}return!1}timeSpanInAxis(e,t){const i=this;return t&&t.getTime()!==e.getTime()?i.isContinuous?l.intersectSpans(e,t,i.startDate,i.endDate):e<i.startDate&&t>i.endDate||i.getTickFromDate(e)!==i.getTickFromDate(t):this.dateInAxis(e,!0)}isTimeSpanInAxis(e){const t=this,{startMS:i,endMS:n}=t,{startDateMS:r,endDateMS:a}=e;if(!r||!a)return!1;if(a===r)return t.dateInAxis(e.startDate,!0);if(t.isContinuous)return a>i&&r<n;const s=t.getTickFromDate(e.startDate),o=t.getTickFromDate(e.endDate);return!(s===t.count&&l.isEqual(e.startDate,t.last.endDate)||0===o&&l.isEqual(e.endDate,t.first.startDate))&&(r<i&&a>n||s!==o)}forEachAuxInterval(e,t=1,i,n=this){const r=this.endDate;let a,s=this.startDate,o=0;if(s>r)throw new Error("Invalid time axis configuration");for(;s<r;)a=l.min(l.getNext(s,e,t,this.weekStartDay),r),i.call(n,s,a,o,a>=r),s=a,o++}}ve._$name="TimeAxis";class fe extends y{static get defaultConfig(){return{tooltipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `,showTooltip:!0,showExactDropPosition:!1,store:null,dragHelperConfig:null,tooltipCls:"b-eventdrag-tooltip"}}static get configurable(){return{constrainDragToTimeline:!0,constrainDragToResource:!0,constrainDragToTimeSlot:!1,tip:{$config:["lazy","nullify"],value:{align:{align:"b-t",allowTargetOut:!0},autoShow:!0,updateContentOnMouseMove:!0}},throttleDragEvent:!0}}static get pluginConfig(){return{chain:["onPaint"]}}internalSnapToPosition(e){var t;const{dragData:i}=this;null===(t=this.snapToPosition)||void 0===t||t.call(this,{assignmentRecord:i.assignmentRecord,eventRecord:i.eventRecord,resourceRecord:i.newResource||i.resourceRecord,startDate:i.startDate,endDate:i.endDate,snapTo:e})}buildDragHelperConfig(){const e=this,{client:t,constrainDragToTimeline:i,constrainDragToResource:n,constrainDragToTimeSlot:r,dragHelperConfig:a={}}=e,{timeAxisViewModel:s,isHorizontal:o}=t,d=o?n:r,c=o?r:n;return e.externalDropTargetSelector&&(a.dropTargetSelector=`.b-timeaxissubgrid,${e.externalDropTargetSelector}`),x.merge({name:e.constructor.name,positioning:"absolute",lockX:c,lockY:d,minX:!0,maxX:!0,constrain:!1,cloneTarget:!i,removeProxyAfterDrop:!1,dragWithin:i?null:document.body,hideOriginalElement:!0,dropTargetSelector:".b-timelinebase",dropTargetCls:e.externalDropTargetSelector?"b-drop-target":"",outerElement:t.timeAxisSubGridElement,targetSelector:t.eventSelector,scrollManager:i?t.scrollManager:null,createProxy:t=>e.createProxy(t),snapCoordinates:({element:i,newX:n,newY:r})=>{const{dragData:a}=e;if(e.constrainDragToTimeline&&!e.constrainDragToTimeSlot&&(e.showExactDropPosition||s.snap)){const d=a.draggedEntities[0],c=e.getCoordinate(d,i,[n,r]),u=s.getDateFromPosition(c,"round"),{calendar:h}=d;if(!h||u&&h.isWorkingTime(u,l.add(u,d.fullDuration))){const e=u&&s.getPositionFromDate(u);u&&u>=t.startDate&&null!=e&&(o?n=e:r=e)}}const d={x:n,y:r};return e.internalSnapToPosition(d),d},internalListeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",afterdragstart:"onAfterDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",abortFinalized:"onDragAbortFinalized",reset:"onDragReset",thisObj:e}},a,{isElementDraggable:(t,i)=>(!a||!a.isElementDraggable||a.isElementDraggable(t,i))&&e.isElementDraggable(t,i)})}onPaint({firstPaint:e}){var t;const i=this,{client:n}=i;null===(t=i.drag)||void 0===t||t.destroy(),i.drag=G.new(i.buildDragHelperConfig()),e&&n.rowManager.ion({changeTotalHeight:()=>{var e;return i.updateYConstraint(null===(e=i.dragData)||void 0===e?void 0:e[`${n.scheduledEventName}Record`])},thisObj:i}),i.showTooltip&&(i.clockTemplate=new K({scheduler:n}))}doDestroy(){var e,t,i;null===(e=this.drag)||void 0===e||e.destroy(),null===(t=this.clockTemplate)||void 0===t||t.destroy(),null===(i=this.tip)||void 0===i||i.destroy(),super.doDestroy()}get tipId(){return`${this.client.id}-event-drag-tip`}changeTip(e,t){const i=this;if(e){const n=T.reconfigure(t,T.mergeConfigs({forElement:i.element,id:i.tipId,getHtml:i.getTipHtml.bind(i),cls:i.tooltipCls,owner:i.client},e),{owner:i.client,defaults:{type:"tooltip"}});return n.ion({innerHtmlUpdate:"updateDateIndicator",thisObj:i}),n}null==t||t.destroy()}createProxy(e){const t=e.cloneNode(!0);return delete t.id,t.classList.add(`b-sch-${this.client.mode}`),t}onBeforeDragStart({context:e,event:t}){const i=this,{client:n}=i,r=i.getMinimalDragData(e,t),a=null==r?void 0:r[`${n.scheduledEventName}Record`],s=r.resourceRecord;if(n.readOnly||i.disabled||!a||!1===a.isDraggable||a.readOnly||null!=s&&s.readOnly)return!1;e.pointerStartDate=n.getDateFromXY([e.startClientX,e.startPageY],null,!1);const o=!1!==i.triggerBeforeEventDrag(`before${n.capitalizedEventName}Drag`,u(u({},r),{},{event:t,context:u(u({},e),r)}));var l;o&&(i.updateYConstraint(a,s),null===(l=n[`before${n.capitalizedEventName}DragStart`])||void 0===l||l.call(n,e,r));return o}onAfterDragStart({context:e,event:t}){}get isDragging(){var e;return null===(e=this.drag)||void 0===e?void 0:e.isDragging}get isActivelyDragging(){return this.isDragging&&!this.finalizing}onDragStart({context:e,event:t}){var i,n,r;const a=this,s=null!==(i=a.findClientFromTarget(t,e))&&void 0!==i?i:a.client;a.currentOverClient=s,a.drag.unifiedProxy=a.unifiedDrag,a.onMouseOverNewTimeline(s,!0);const o=a.dragData=a.getDragData(e);if(a.suspendElementRedrawing(e.element),a.showTooltip&&a.tip){const t=o.context.dragProxy?o.context.dragProxy.firstChild:e.element;a.tip.showBy(t)}a.triggerDragStart(o),null===(n=s[`after${s.capitalizedEventName}DragStart`])||void 0===n||n.call(s,e,o);const{eventMenu:l,taskMenu:d}=s.features,c=l||d;null==c||null===(r=c.hideContextMenu)||void 0===r||r.call(c,!1)}updateDateIndicator(){const{startDate:e,endDate:t}=this.dragData,{tip:i,clockTemplate:n}=this,r=i.element.querySelector(".b-sch-tooltip-enddate");n.updateDateIndicator(i.element,e),r&&n.updateDateIndicator(r,t)}findClientFromTarget(e,t){let{target:i}=e;if(/^touch/.test(e.type)){const e=E.from(t.element,null,!0).center;i=m.elementFromPoint(e.x,e.y)}const n=c.fromElement(i,"timelinebase");return null!=n&&n.isResourceHistogram?null:n}onDrag({context:e,event:t}){const i=this,n=i.dragData,r=n.startDate;let a;if(a=i.constrainDragToTimeline?i.client:i.findClientFromTarget(t,n.context),i.updateDragContext(e,t),a){if(a!==i.currentOverClient&&i.onMouseOverNewTimeline(a),n.dirty||!i.throttleDragEvent){const e=n.valid;i.triggerEventDrag(n,r),e!==n.valid&&(n.context.valid=n.externalDragValidity=n.valid)}i.showTooltip&&i.tip&&(i.tip.lastAlignSpec.allowTargetOut=!n.valid,i.tip.realign())}}onMouseOverNewTimeline(e,t){const i=this,{drag:{lockX:n,lockY:r}}=i,a=[];i.currentOverClient.element.classList.remove("b-dragging-"+i.currentOverClient.scheduledEventName),e.element.classList.add("b-dragging-"+e.scheduledEventName),t||i.currentOverClient.scrollManager.stopMonitoring(),n||a.push({element:e.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),r||a.push({element:e.scrollable.element,direction:"vertical"}),e.scrollManager.startMonitoring({scrollables:a,callback:i.drag.onScrollManagerScrollCallback}),i.currentOverClient=e}triggerBeforeEventDropFinalize(e,t,i){i.trigger(e,t)}onDrop({context:e,event:t}){var i;const n=this,{currentOverClient:r,dragData:a}=n;let s=!1;if(null===(i=n.tip)||void 0===i||i.hide(),e.valid=e.valid&&n.isValidDrop(a),n.drag.removeProxyAfterDrop=Boolean(a.externalDropTarget),e.valid&&a.startDate&&a.endDate){let i=!1;a.finalize=async t=>{i||a.async?await n.finalize(t):e.valid=e.valid&&t},n.triggerBeforeEventDropFinalize(`before${r.capitalizedEventName}DropFinalize`,{context:a,domEvent:t},r),i=!0,e.async=a.async,e.async||a.externalDropTarget||(s=a.startDate-a.origStart!=0||a.newResource!==a.resourceRecord)}e.async||n.finalize(a.valid&&e.valid&&s)}onDragAbort({context:e}){var t;const i=this;i.client.currentOrientation.onDragAbort({context:e,dragData:i.dragData}),i.resetDraggedElements(),null===(t=i.tip)||void 0===t||t.hide(),i.triggerDragAbort(i.dragData)}onDragAbortFinalized({context:e}){var t,i;const n=this;n.triggerDragAbortFinalized(n.dragData),null===(t=(i=n.client)[`after${n.client.capitalizedEventName}DragAbortFinalized`])||void 0===t||t.call(i,e,n.dragData)}onDragReset({source:e}){var t;const i=this,n=i.currentOverClient;null==n||n.scrollManager.stopMonitoring(),null!==(t=e.context)&&void 0!==t&&t.started&&(i.resetDraggedElements(),n.trigger(`${n.scheduledEventName}DragReset`)),null==n||n.element.classList.remove("b-dragging-"+i.currentOverClient.scheduledEventName),i.dragData=null}resetDraggedElements(){const{dragData:e}=this,{eventBarEls:t,draggedEntities:i}=e;this.resumeRecordElementRedrawing(e.record),i.forEach(((e,i)=>{this.resumeRecordElementRedrawing(e),t[i].classList.remove(this.drag.draggingCls),t[i].retainElement=!1})),e.context.element.retainElement=!1}onInternalInvalidDrop(e){var t;const i=this,{context:n}=i.drag;null===(t=i.tip)||void 0===t||t.hide(),i.triggerAfterDrop(i.dragData,!1),n.valid=!1,e&&i.drag.abort()}async finalize(e){const t=this,{dragData:i}=t;if(!i||t.finalizing)return;const{context:n,draggedEntities:r,externalDropTarget:a}=i;let s;return t.finalizing=!0,r.forEach(((e,n)=>{t.resumeRecordElementRedrawing(e),i.eventBarEls[n].classList.remove(t.drag.draggingCls),i.eventBarEls[n].retainElement=!1})),n.element.retainElement=!1,a&&i.valid||e?(s=t.updateRecords(i),!a&&x.isPromise(s)&&(n.async=!0,await s),i.valid?(n.async&&n.finalize(),a&&t.client.refreshRows(!1),t.triggerAfterDrop(i,!0)):t.onInternalInvalidDrop(!0)):t.onInternalInvalidDrop(n.async||i.async),t.finalizing=!1,s}updateDragContext(e,t){const i=this,{drag:n}=i,r=i.dragData,a=i.currentOverClient,{isHorizontal:s}=a,[o]=r.draggedEntities,d=o.isAssignment?o.event:o,c=r.startDate,u=i.constrainDragToTimeSlot||(s?n.lockX:n.lockY);if(r.browserEvent=t,Object.assign(r,i.getProductDragContext(r)),u)r.timeDiff=0;else{const{dateConstraints:t}=r;let n;if(a.timeAxis.isContinuous){var h,g;const t=a.isHorizontal?null!==(h=e.pageX)&&void 0!==h?h:e.startPageX:null!==(g=e.pageY)&&void 0!==g?g:e.startPageY,i=a.getDateFromCoordinate(t,null,!1,!0);n=r.timeDiff=i-e.pointerStartDate}else{const t=i.resolveStartEndDates(e.element);r.valid=Boolean(t.startDate&&t.endDate),r.valid&&(n=t.startDate-r.origStart)}null!==n&&(r.startDate=i.adjustStartDate(r.origStart,n),t&&(r.startDate=l.constrain(r.startDate,t.start,t.end?new Date(t.end-d.durationMS):null)),r.endDate=l.add(r.startDate,d.fullDuration),r.valid&&(r.timeDiff=r.startDate-r.origStart))}const m=r.dirty=r.dirty||c-r.startDate!=0;if(r.valid)if(i.constrainDragToTimeline&&(r.endDate<=a.timeAxis.startDate||r.startDate>=a.timeAxis.endDate))r.valid=!1,r.context.message=i.L("L{EventDrag.noDropOutsideTimeline}");else if(m||r.externalDropTarget){const n=r.externalDragValidity=!t||e.pageX&&i.checkDragValidity(r,t);n&&"boolean"!=typeof n?(r.valid=!1!==n.valid,r.context.message=n.message):(r.valid=!1!==n,r.context.message="")}else{var p;r.valid=!1!==r.externalDragValidity&&!1!==(null===(p=r.externalDragValidity)||void 0===p?void 0:p.valid)}else r.valid=!1;r.context.valid=r.valid}suspendRecordElementRedrawing(e,t=!0){this.suspendElementRedrawing(this.getRecordElement(e),t),e.instanceMeta(this.client).retainElement=t}resumeRecordElementRedrawing(e){this.suspendRecordElementRedrawing(e,!1)}suspendElementRedrawing(e,t=!0){e&&(e.retainElement=t)}resumeElementRedrawing(e){this.suspendElementRedrawing(e,!1)}getDragData(e){const t=this,{client:i,drag:n}=t,r=t.setupProductDragData(e),{record:a,eventBarEls:s,draggedEntities:o}=r,{startEvent:l}=n,d=a.isAssignment?a.event:a,c=d.startDate,h=d.endDate,g=i.timeAxis,m=c<g.startDate,p=h>g.endDate,v=i.isSchedulerBase?i.multiEventSelect:i.selectionMode.multiSelect,f=t.getCoordinate(d,e.element,[e.elementStartX,e.elementStartY]),D=t.getCoordinate(d,e.element,[e.startClientX,e.startClientY]);t.suspendRecordElementRedrawing(a),o.forEach((e=>t.suspendRecordElementRedrawing(e))),a.isAssignment?i.selectAssignment(a,l.ctrlKey&&v):i.selectEvent(a,l.ctrlKey&&v);const b=u(u({context:e},r),{},{sourceDate:m?c:i.getDateFromCoordinate(f),screenSourceDate:i.getDateFromCoordinate(D,null,!1),startDate:c,endDate:h,timeDiff:0,origStart:c,origEnd:h,startsOutsideView:m,endsOutsideView:p,duration:h-c,browserEvent:l});return s.forEach((e=>e.classList.remove("b-sch-event-hover","b-active"))),s.length>1&&(e.relatedElements=s.slice(1)),b}setupConstraints(e,t,i,n){const r=this,a=!r.showExactDropPosition&&i>1?i:0;n?r.setXConstraint(e.left,e.right-t.width,a):r.setXConstraint(!0,!0,a),r.setYConstraint(e.top,e.bottom-t.height,0)}updateYConstraint(e,t){const i=this,{client:n}=i,{context:r}=i.drag,a=n.timeAxisViewModel.snapPixelAmount;if(r&&!i.drag.lockY){let s;if(!i.constrainDragToTimeline)return void i.setYConstraint(null,null,a);s=n.getScheduleRegion(t,e),i.setYConstraint(s.top,s.bottom-r.element.offsetHeight,a)}else i.setYConstraint(null,null,a)}setXConstraint(e,t,i){const{drag:n}=this;n.minX=e,n.maxX=t}setYConstraint(e,t,i){const{drag:n}=this;n.minY=e,n.maxY=t}adjustStartDate(e,t){return this.client.timeAxis.roundDate(new Date(e-0+t),!!this.client.snapRelativeToEventStartDate&&e)}resolveStartEndDates(e){const t=this.currentOverClient,{timeAxis:i}=t,n=E.from(e.querySelector(t.eventInnerSelector),t.timeAxisSubGridElement),r=this.dragData,[a]=r.draggedEntities,{fullDuration:s}=a.isAssignment?a.event:a;let{start:o,end:d}=t.getStartEndDatesFromRectangle(n,"round",s,!i.isContinuous);if(o&&d)if(o=this.adjustStartDate(o,0),r.startsOutsideView)r.endsOutsideView||(o=d&&l.add(d,-s));else{if(!i.dateInAxis(o,!1)){const e=i.getTickFromDate(o);e>=0&&(o=i.getDateFromTick(e))}d=o&&l.add(o,s)}return{startDate:o,endDate:d}}getTipHtml(){const e=this,{dragData:t,client:i,tooltipTemplate:n}=e,{startDate:r,endDate:a,draggedEntities:s}=t,o=i.getFormattedDate(r),l=i.getFormattedEndDate(a,r),{valid:d,message:c,element:u,dragProxy:h}=t.context,g=h?h.firstChild:u,m=s[0],p=m.isTask?m:m.event;return e.tip.lastAlignSpec.target=g,n({valid:d,startDate:r,endDate:a,startText:o,endText:l,dragData:t,message:c||"",[i.scheduledEventName+"Record"]:p,startClockHtml:e.clockTemplate.template({date:r,text:o,cls:"b-sch-tooltip-startdate"}),endClockHtml:p.isMilestone?"":e.clockTemplate.template({date:a,text:l,cls:"b-sch-tooltip-enddate"})})}updateConstrainDragToTimeSlot(e){const t=this.client.isHorizontal?"lockX":"lockY";this.drag&&(this.drag[t]=e)}updateConstrainDragToResource(e){const t=this;if(t.drag){const{constrainDragToTimeSlot:i}=t,{isHorizontal:n}=t.client;e&&(t.constrainDragToTimeline=!0),t.drag.lockY=n?e:i,t.drag.lockX=n?i:e}}updateConstrainDragToTimeline(e){this.isConfiguring||Object.assign(this.drag,{cloneTarget:!e,dragWithin:e?null:document.body,scrollManager:e?this.client.scrollManager:null})}getElementFromContext(e){return e.grabbed||e.dragProxy||e.element}getRelatedRecords(e){return[]}getMinimalDragData(e,t){return{}}isValidDrop(e){throw new Error("Implement in subclass")}checkDragValidity(e){throw new Error("Implement in subclass")}updateRecords(e){throw new Error("Implement in subclass")}isElementDraggable(e,t){throw new Error("Implement in subclass")}getCoordinate(e,t,i){throw new Error("Implement in subclass")}setupProductDragData(e){throw new Error("Implement in subclass")}getProductDragContext(e){throw new Error("Implement in subclass")}getRecordElement(e){throw new Error("Implement in subclass")}}fe._$name="DragBase";const De={top:"b-t",right:"b100-t100",bottom:"t-b",left:"b0-t0"};class be extends(y.mixin(Z,q)){static get $name(){return"EventResize"}static get configurable(){return{draggingItemCls:"b-sch-event-wrap-resizing",resizingItemInnerCls:"b-sch-event-resizing",leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSize:null,dynamicHandleSize:!0,allowResizeToZero:null,reservedSpace:5,touchHandleSize:null,dragThreshold:0,dragTouchStartDelay:0,draggingClsSelector:".b-timeline-base",showTooltip:!0,showExactResizePosition:!1,validatorFn:()=>!0,validatorFnThisObj:null,tip:{$config:["lazy","nullify"],value:{autoShow:!1,axisLock:!0,trackMouse:!1,updateContentOnMouseMove:!0,hideDelay:0}},tooltipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `,ignoreSelector:".b-sch-terminal",dragActiveCls:"b-resizing-event"}}static get pluginConfig(){return{chain:["render","onEventDataGenerated","isEventElementDraggable"]}}doDestroy(){var e;super.doDestroy(),null===(e=this.dragging)||void 0===e||e.destroy()}render(){const e=this,{client:t}=e;e.dragSelector=e.dragItemSelector=t.eventSelector,e.dragRootElement=e.dropRootElement=t.timeAxisSubGridElement,e.dragLock=t.isVertical?"y":"x"}isEventElementDraggable(e,t,i,n){const r=this,a=null==t?void 0:t.resizable;return!(!r.disabled&&a&&!t.isMilestone)||(!0!==a&&"start"!==a||!r.isOverStartHandle(n,e))&&(!0!==a&&"end"!==a||!r.isOverEndHandle(n,e))}onEventDataGenerated({eventRecord:e,wrapperCls:t,cls:i}){var n,r;e===(null===(n=this.dragging)||void 0===n||null===(r=n.context)||void 0===r?void 0:r.eventRecord)&&(t["b-active"]=t[this.draggingItemCls]=t["b-over-resize-handle"]=i["b-resize-handle"]=i[this.resizingItemInnerCls]=1)}onDragPointerMove(e){var t;const{client:i,dragging:n}=this,{visibleDateRange:r,isHorizontal:a}=i,s=a&&i.rtl,o=a?"X":"Y",l=globalThis[`page${o}Offset`],d=e[`page${o}`]+((null===(t=n.context)||void 0===t?void 0:t.offset)||0),c=E.from(i.timeAxisSubGridElement,null,!0),u=c.getStart(s,a),h=c.getEnd(s,a);let g=i.getDateFromCoord({coord:d,local:!1});s?d-l>u?g=r.startDate:d<h&&(g=r.endDate):d-l<u?g=r.startDate:d-l>h&&(g=r.endDate),n.clientStartCoord=u,n.clientEndCoord=h,n.date=g,super.onDragPointerMove(e)}get isResizing(){return Boolean(this.dragging)}beforeDrag(e){const{client:t}=this,i=t.resolveTimeSpanRecord(e.itemElement),n=!t.isGanttBase&&t.resolveResourceRecord(t.isVertical?e.startEvent:e.itemElement);return!(this.disabled||t.readOnly||null!=n&&n.readOnly||i&&(i.readOnly||!i.project&&!i.isOccurrence)||!1===super.beforeDrag(e))&&(e.mousedownDate=e.date=t.getDateFromCoordinate(e.event["page"+(t.isHorizontal?"X":"Y")],null,!1),this.triggerBeforeResize(e))}dragStart(e){var t,i;const n=this,{client:r,tip:a}=n,{startEvent:s,itemElement:o}=e,l=r.scheduledEventName,d=r.resolveEventRecord(o),{isBatchUpdating:c,wrapStartDate:h,wrapEndDate:g}=d,m=null===(t=r.features.eventBuffer)||void 0===t?void 0:t.enabled,p=c?d.get("startDate"):d.startDate,v=c?d.get("endDate"):d.endDate,f="x"===n.dragLock,D=f&&r.rtl,b=n.isOverEndHandle(s,o),S=b?"endDate":"startDate",w=m?b?"wrapEndDate":"wrapStartDate":null,C=b?"startDate":"endDate",y=b?"setEndDate":"setStartDate",x=b?"setStartDate":"setEndDate",T=E.from(o),R=f?s.clientX:s.clientY,M=b?T.getEnd(D,f):T.getStart(D,f),k=e.context={eventRecord:d,element:o,timespanRecord:d,taskRecord:d,owner:n,valid:!0,oldValue:b?v:p,startDate:p,endDate:v,offset:m?0:M-R,edge:f?b?"right":"left":b?"bottom":"top",finalize:n.finalize,event:e.event,originalStartDate:p,originalEndDate:v,wrapStartDate:h,wrapEndDate:g,draggingEnd:b,toSet:S,wrapToSet:w,otherEnd:C,setMethod:y,setOtherMethod:x};d.meta.isResizing=!0,r.element.classList.add(...n.dragActiveCls.split(" ")),r.listenToBatchedUpdates||r.beginListeningForBatchedUpdates(),c||n.beginEventRecordBatch(d),n.setupProductResizeContext(k,s),n.triggerEventResizeStart(`${l}ResizeStart`,u({[`${l}Record`]:d,event:s},n.getResizeStartParams(k)),k),k.resizedRecord=(null===(i=r.resolveAssignmentRecord)||void 0===i?void 0:i.call(r,k.element))||d,a&&(a.show(),a.align=De[k.edge],a.showBy(n.getTooltipTarget(e)))}triggerBeforeResize(e){const{client:t}=this,i=t.resolveTimeSpanRecord(e.itemElement);return t.trigger(`before${t.capitalizedEventName}Resize`,u({[`${t.scheduledEventName}Record`]:i,event:e.event},this.getBeforeResizeParams({event:e.startEvent,element:e.itemElement})))}triggerEventResizeStart(e,t,i){var n,r;this.client.trigger(e,t),null===(n=(r=this.client)[`after${p.capitalize(e)}`])||void 0===n||n.call(r,i,t)}triggerEventResizeEnd(e,t){this.client.trigger(e,t)}triggerEventPartialResize(e,t){this.client.trigger(e,t)}triggerBeforeEventResizeFinalize(e,t){this.client.trigger(e,t)}dragEnter(e){var t;return(null===(t=e.context)||void 0===t?void 0:t.owner)===this}resizeEventPartiallyInternal(e,t){var i;const{client:n}=this,{toSet:r}=t;if(null!==(i=n.features.eventBuffer)&&void 0!==i&&i.enabled)if("startDate"===r){const i=t.startDate.getTime()-t.originalStartDate.getTime();e.wrapStartDate=new Date(t.wrapStartDate.getTime()+i)}else if("endDate"===r){const i=t.endDate.getTime()-t.originalEndDate.getTime();e.wrapEndDate=new Date(t.wrapEndDate.getTime()+i)}e.set(r,t[r])}applyDateConstraints(e,t,i){var n,r;const a=null===(n=i.dateConstraints)||void 0===n?void 0:n.start,s=null===(r=i.dateConstraints)||void 0===r?void 0:r.end;return(a||s)&&(e=l.constrain(e,a,s),i.snappedDate=l.constrain(i.snappedDate,a,s)),e}moveDrag(e){const t=this,{client:i,tip:n}=t,r="x"===t.dragLock,a=r?"X":"Y",s=i.scheduledEventName,{visibleDateRange:o,enableEventAnimations:d,timeAxis:c,weekStartDay:u}=i,h=r&&i.rtl,{resolutionUnit:g,resolutionIncrement:m}=c,{event:p,context:v}=e,{eventRecord:f}=v,D=v.offset*(h?-1:1),{isOccurrence:b}=f,S=f.get("startDate"),w=f.get("endDate"),C=p[`client${a}`]+D,y=E.from(i.timeAxisSubGridElement,null,!0),x=y.getStart(h,r),T=y.getEnd(h,r);v.event=p,p.isScroll&&(e.date=i.getDateFromCoordinate(p[`page${a}`]+D,null,!1));let R,M,{date:k}=e,{toSet:A,otherEnd:z,draggingEnd:P}=v;h?C>x?k=e.date=o.startDate:C<T&&(k=e.date=o.endDate):C<x?k=e.date=o.startDate:C>T&&(k=e.date=o.endDate),"endDate"===A?k<S&&(R=-1):k>w&&(R=1),R&&t.onDragEndSwitch&&(t.onDragEndSwitch(v,k,R),z=v.otherEnd,A=v.toSet),i.snapRelativeToEventStartDate&&(k=c.roundDate(k,v.oldValue)),v.snappedDate=l.round(k,c.resolution,null,u);const F=l.diff(k,v[z],g)*(P?-1:1);if(t.isEventDragCreate)v.tooNarrow=F<m/2;else if(F<m)if(t.allowResizeToZero)v.snappedDate=k=v[z];else{const e="startDate"===z?1:-1;v.snappedDate=k=c.roundDate(l.add(f.get(z),m*e,g)),M=!0}if(k=t.applyDateConstraints(k,f,v),!v.date||k-v.date||M){if(v.date=k,v[A]=t.showExactResizePosition||i.timeAxisViewModel.snap?v.snappedDate:k,!(v[A]-v["startDate"===A?"endDate":"startDate"]||t.allowResizeToZero))return void(v.valid=!1);if(f.get(A)-v[A]){if(v.valid=t.checkValidity(v,p),v.message="",v.valid&&"boolean"!=typeof v.valid&&(v.message=v.valid.message,v.valid=v.valid.valid),v.valid=!1!==v.valid,v.valid){const n={[`${s}Record`]:f,startDate:S,endDate:w,element:e.itemElement,context:v};n[A]=v[A],t.triggerEventPartialResize(`${s}PartialResize`,n),b&&f.stores.push(i.eventStore),i.enableEventAnimations=!1,this.resizeEventPartiallyInternal(f,v),i.enableEventAnimations=d,b&&(f.stores.length=0)}v.tooNarrow&&(v.valid=!1)}}n&&(n.align=De[v.edge],n.alignTo(t.getTooltipTarget(e))),super.moveDrag(e)}dragEnd(e){const{context:t}=e;t&&(t.event=e.event),e.aborted?null==t||t.finalize(!1):this.isEventDragCreate||e.started||g.getPagePoint(e.event).equals(g.getPagePoint(e.startEvent))||(this.dragStart(e),this.cleanup(e.context,!1))}async dragDrop({context:e,event:t}){var i;e[e.toSet]=e.snappedDate;const{client:n}=this,{startDate:r,endDate:a}=e;let s;null===(i=this.tip)||void 0===i||i.hide(),e.valid=r&&a&&(this.allowResizeToZero||a-r>0)&&e[e.toSet]-e.oldValue&&!1!==e.valid,e.valid&&(this.triggerBeforeEventResizeFinalize(`before${n.capitalizedEventName}ResizeFinalize`,{context:e,event:t,[`${n.scheduledEventName}Record`]:e.eventRecord}),s=!0),e.async||await e.finalize(s)}async finalize(e){const t=this.owner,i=this,{eventRecord:n,oldValue:r,toSet:a}=i,{snapRelativeToEventStartDate:s,timeAxis:o}=t.client;let l=!1;e?(s&&(i[a]=i.snappedDate=o.roundDate(i.date,r)),l=await t.internalUpdateRecord(i,n)):(t.cancelEventRecordBatch(n),n.isOccurrence&&n.resources.forEach((e=>t.client.repaintEventsForResource(e)))),t.cleanup(i,l)}cleanup(e,t){var i;const n=this,{client:r}=n,{element:a,eventRecord:s}=e,o=r.scheduledEventName;s.meta.isResizing=!1,r.endListeningForBatchedUpdates(),null===(i=n.tip)||void 0===i||i.hide(),n.unHighlightHandle(a),r.element.classList.remove(...n.dragActiveCls.split(" ")),n.triggerEventResizeEnd(`${o}ResizeEnd`,u({changed:t,[`${o}Record`]:s},n.getResizeEndParams(e)))}async internalUpdateRecord(e,t){const{client:i}=this,{generation:r}=t;if(t.isOccurrence)i.endListeningForBatchedUpdates(),t[t.batching>1?"endBatch":"cancelBatch"](),t.set(n.prototype.inSetNormalize.call(t,{startDate:e.startDate,endDate:e.endDate}));else{const n={[e.toSet]:e[e.toSet]};if(t.isEntity){var a;const{startDate:r,endDate:s,draggingEnd:o}=e;e.duration=n.duration=t.run("calculateProjectedDuration",r,s),n[e.toSet]=t.run("calculateProjectedXDateWithDuration",o?r:s,o,e.duration);const l=!t[e.otherEnd];l&&(n[e.otherEnd]=e[e.otherEnd]),t.set(n),i.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(t),null!==(a=i.features.eventBuffer)&&void 0!==a&&a.enabled&&(t[e.wrapToSet]=null);const d=[];l&&d.push(t[e.setOtherMethod](n[e.otherEnd],!1)),d.push(t[e.setMethod](n[e.toSet],!1)),await Promise.all(d),t.endBatch()}else{const r=Object.assign({},t.meta.batchChanges);delete r[e.toSet],i.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(t),t.set(r),t[e.setMethod](n[e.toSet],!1)}}return await i.project.commitAsync(),t.generation!==r}onDragItemMouseMove(e){"touch"===e.pointerType||this.handleSelector||this.checkResizeHandles(e)}checkResizeHandles(e){const t=this,{overItem:i}=t;if(i&&!t.client.readOnly&&(!t.allowResize||t.allowResize(i,e))){const n=t.client.resolveTimeSpanRecord(i);if(null!=n&&n.readOnly)return;t.isOverAnyHandle(e,i)?t.highlightHandle():t.unHighlightHandle()}}onDragItemMouseLeave(e,t){this.unHighlightHandle(t)}highlightHandle(){var e,t;const{overItem:i,client:n}=this;(null!==(e=null===(t=i.syncIdMap)||void 0===t?void 0:t[n.scheduledEventName])&&void 0!==e?e:i.querySelector(n.eventInnerSelector)).classList.add("b-resize-handle"),i.classList.add("b-over-resize-handle")}unHighlightHandle(e=this.overItem){if(e){var t,i;const n=this,r=null!==(t=null===(i=e.syncIdMap)||void 0===i?void 0:i[n.client.scheduledEventName])&&void 0!==t?t:e.querySelector(n.client.eventInnerSelector);r&&r.classList.remove("b-resize-handle",n.resizingItemInnerCls),e.classList.remove("b-over-resize-handle",n.draggingItemCls)}}isOverAnyHandle(e,t){return this.isOverStartHandle(e,t)||this.isOverEndHandle(e,t)}isOverStartHandle(e,t){var i;return null===(i=this.getHandleRect("start",e,t))||void 0===i?void 0:i.contains(g.getPagePoint(e))}isOverEndHandle(e,t){var i;return null===(i=this.getHandleRect("end",e,t))||void 0===i?void 0:i.contains(g.getPagePoint(e))}getHandleRect(e,t,i){if(this.overItem){if(!(i=t.target.closest(`.${this.client.eventCls}`)||i.querySelector(`.${this.client.eventCls}`)))return;const n=this,r="start"===e,{client:a}=n,s=Boolean(a.rtl),o=n.dragLock,l="x"===o,d=l?"width":"height",c=(l?r&&!s?"left":"right":r?"top":"bottom")+"Handle",{offsetWidth:u}=i,h=a.resolveTimeSpanRecord(i),g=null==h?void 0:h.isResizable,m=E.from(i),p=m.clone(),v=window.getComputedStyle(i,":before"),f=(n.handleSelector||R.isHoverableDevice?void 0:n.touchHandleSize)||n.handleSize||parseFloat(v[d]),D=n.handleVisibilityThreshold||2*n.handleSize,b=n.dynamicHandleSize?n.reservedSpace/2:0,S=[0,0,0,0];if(!n.disabled&&n[c]&&(u>=D||n.dynamicHandleSize)&&(!0===g||g===e)){if(!l&&!r||l&&s===r?(p[o]+=m[d]-f,S[l?3:0]=m[d]/2+b):S[l?1:2]=m[d]/2+b,m.deflate(...S),p[d]=f,p.constrainTo(m),p[d])return p}}}setupDragContext(e){const t=this;if(t.overItem&&t.isOverAnyHandle(e,t.overItem)&&t.isElementResizable(t.overItem,e)){const i=super.setupDragContext(e);return i.scrollManager=t.client.scrollManager,i}}changeHandleSize(){M.deprecate("Scheduler","6.0.0","Handle size is from CSS")}changeTouchHandleSize(){M.deprecate("Scheduler","6.0.0","Handle size is from CSS")}changeTip(e,t){const i=this;if(!i.showTooltip)return null;if(e)e.isTooltip?e.owner=i:e=T.reconfigure(t,T.mergeConfigs({id:i.tipId},e,{getHtml:i.getTipHtml.bind(i),owner:i.client},i.tip),{owner:i,defaults:{type:"tooltip"}}),e.ion({innerhtmlupdate:"updateDateIndicator",thisObj:i}),i.clockTemplate=new K({scheduler:i.client});else if(t){var n;t.destroy(),null===(n=i.clockTemplate)||void 0===n||n.destroy()}return e}isElementResizable(e,t){var i,n;const r=this,{client:a}=r,s=a.resolveTimeSpanRecord(e);if(a.readOnly)return!1;let o=null==s?void 0:s.isResizable;const l=null!==(i=null===(n=e)||void 0===n?void 0:n.syncIdMap[a.scheduledEventName])&&void 0!==i?i:e,d=t.target.closest('[class$="-handle"]');if(!o||d&&d!==l)return!1;if(!(e=t.target.closest(r.dragSelector)))return!1;const c=e.classList.contains("b-sch-event-startsoutside"),u=e.classList.contains("b-sch-event-endsoutside");if(!0===o){if(c&&u)return!1;if(c)o="end";else{if(!u)return r.isOverStartHandle(t,e)||r.isOverEndHandle(t,e);o="start"}}return!(c&&"start"===o||u&&"end"===o)&&!!(r.isOverStartHandle(t,e)&&"start"===o||r.isOverEndHandle(t,e)&&"end"===o)}updateDateIndicator(){const{clockTemplate:e}=this,{eventRecord:t,draggingEnd:i,snappedDate:n}=this.dragging.context,r=i?t.get("startDate"):n,a=i?n:t.get("endDate"),{element:s}=this.tip;e.updateDateIndicator(s.querySelector(".b-sch-tooltip-startdate"),r),e.updateDateIndicator(s.querySelector(".b-sch-tooltip-enddate"),a)}getTooltipTarget({itemElement:e,context:t}){const i=this,{rtl:n}=i.client,r=E.from(e,null,!0);return"x"===i.dragLock?(!n&&"right"===t.edge||n&&"left"===t.edge?r.x=r.right-1:r.x-=i.tip.anchorSize[0]/2,r.width=i.tip.anchorSize[0]/2):("bottom"===t.edge&&(r.y=r.bottom-1),r.height=i.tip.anchorSize[1]/2),{target:r}}basicValidityCheck(e,t){return e.startDate&&(e.endDate>e.startDate||this.allowResizeToZero)&&this.validatorFn.call(this.validatorFnThisObj||this,e,t)}getTipHtml({tip:e}){const t=this,{startDate:i,endDate:n,toSet:r,snappedDate:a,valid:s,message:o="",timespanRecord:l}=t.dragging.context;if(!i||!n)return e.html;const d={record:l,valid:s,message:o,startDate:i,endDate:n,[r]:a};return d.startText=t.client.getFormattedDate(d.startDate),d.endText=t.client.getFormattedDate(d.endDate),d.startClockHtml=t.clockTemplate.template({date:d.startDate,text:d.startText,cls:"b-sch-tooltip-startdate"}),d.endClockHtml=t.clockTemplate.template({date:d.endDate,text:d.endText,cls:"b-sch-tooltip-enddate"}),t.tooltipTemplate(d)}beginEventRecordBatch(e){e.beginBatch()}cancelEventRecordBatch(e){e.cancelBatch()}getBeforeResizeParams(e){const{client:t}=this;return{resourceRecord:t.resolveResourceRecord(t.isVertical?e.event:e.element)}}getResizeStartParams(e){return{resourceRecord:e.resourceRecord}}getResizeEndParams(e){return{resourceRecord:e.resourceRecord,event:e.event}}setupProductResizeContext(e,t){var i,n,r;const{client:a}=this,{element:s}=e,o=a.resolveEventRecord(s),l=null===(i=a.resolveResourceRecord)||void 0===i?void 0:i.call(a,s),d=null===(n=a.resolveAssignmentRecord)||void 0===n?void 0:n.call(a,s);Object.assign(e,{eventRecord:o,taskRecord:o,resourceRecord:l,assignmentRecord:d,dateConstraints:null===(r=a.getDateConstraints)||void 0===r?void 0:r.call(a,l,o)})}checkValidity(e,t){return(this.client.allowOverlap||this.client.isDateRangeAvailable(e.startDate,e.endDate,e.eventRecord,e.resourceRecord))&&this.basicValidityCheck(e,t)}get tipId(){return`${this.client.id}-event-resize-tip`}}be._$name="EventResize",W.registerFeature(be,!0,"Scheduler"),W.registerFeature(be,!1,"ResourceHistogram");const Se=function(e){var t,i;return(null===(t=this.source)||void 0===t||null===(i=t.client.features.taskEdit)||void 0===i||!i._canceling)&&g.getDistanceBetween(this.startEvent,e)};class we extends be{construct(e,t){!1===(null==t?void 0:t.showTooltip)&&(t.tip=null),super.construct(...arguments)}changeValidatorFn(e){this.createValidatorFn=e}render(){const e=this,{client:t}=e;e.dragRootElement=e.dropRootElement=t.timeAxisSubGridElement,e.dragLock=t.isVertical?"y":"x"}onDragEndSwitch(e){const{client:t}=this,{enableEventAnimations:i}=t,{eventRecord:n,draggingEnd:r}=e,a="x"===this.dragLock,{initialDate:s}=this.dragging;t.enableEventAnimations=!1,n.set({startDate:s,endDate:s}),r?Object.assign(e,{endDate:s,toSet:"startDate",otherEnd:"endDate",setMethod:"setStartDate",setOtherMethod:"setEndDate",edge:a?"left":"top"}):Object.assign(e,{startDate:s,toSet:"endDate",otherEnd:"startDate",setMethod:"setEndDate",setOtherMethod:"setStartDate",edge:a?"right":"bottom"}),e.draggingEnd=this.draggingEnd=!r,t.enableEventAnimations=i}beforeDrag(e){const t=this,i=super.beforeDrag(e),{pan:n,eventDragSelect:r}=t.client.features;return(!1===i||!(t.preventMultiple&&!t.isRowEmpty(e.rowRecord)||t.disabled||n&&!n.disabled||r&&!r.disabled))&&i}startDrag(e){const t=super.startDrag(e);if(!1!==t){const{context:t}=e;e.initialDate=t.eventRecord.get(this.draggingEnd?"startDate":"endDate"),this.client.trigger("dragCreateStart",{proxyElement:e.element,eventElement:e.element,eventRecord:t.eventRecord,resourceRecord:t.resourceRecord}),e.context.offset=0,e.context.oldValue=e.mousedownDate}return t}isOverEndHandle(){return this.draggingEnd}setupDragContext(e){const{client:t}=this;if(t.matchScheduleCell(e.target)){var i;const n=null===(i=t.resolveResourceRecord(e))||void 0===i?void 0:i.$original;if(n&&!n.isSpecialRow){const i=Z().prototype.setupDragContext.call(this,e),r=[];return t.isVertical?r.push({element:t.scrollable.element,direction:"vertical"}):r.push({element:t.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),i.scrollManager=t.scrollManager,i.monitoringConfig={scrollables:r},i.resourceRecord=i.rowRecord=n,i.getDistance=Se,i}}}async dragDrop({context:e,event:t}){var i;e[e.toSet]=e.snappedDate;const{client:n}=this,{startDate:r,endDate:a,eventRecord:s}=e,{generation:o}=s;let l;null===(i=this.tip)||void 0===i||i.hide(),await n.project.commitAsync(),s.generation!==o&&(e.eventRecord[e.toSet]=e.oldValue,e.eventRecord[e.toSet]=e[e.toSet]),e.valid=r&&a&&a-r>0&&e[e.toSet]-e.oldValue&&!1!==e.valid,e.valid&&(n.trigger("beforeDragCreateFinalize",{context:e,event:t,proxyElement:e.element,eventElement:e.element,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord}),l=!0),e.async||await e.finalize(l)}updateDragTolerance(e){this.dragThreshold=e}changeTip(e,t){return super.changeTip(!e||e.isTooltip?e:o.assign({id:`${this.client.id}-drag-create-tip`},e),t)}async finalize(e){const t=this.owner,i=this,n=()=>{t.isDestroyed||(t.client.trigger("afterDragCreate",{proxyElement:i.element,eventElement:i.element,eventRecord:i.eventRecord,resourceRecord:i.resourceRecord}),t.cleanup(i))};var r;e?(await t.finalizeDragCreate(i),n()):(null===(r=t.onAborted)||void 0===r||r.call(t,i),n())}async finalizeDragCreate(e){var t;await this.internalUpdateRecord(e,e.eventRecord),this.client.trigger("dragCreateEnd",{eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,event:e.event,eventElement:e.element}),null===(t=this.client)||void 0===t||t.trigger("eventAutoCreated",{eventRecord:e.eventRecord,resourceRecord:e.resourceRecord})}cleanup(e){var t;const{client:i}=this,{eventRecord:n}=e;n.meta.isResizing=!1,i.endListeningForBatchedUpdates(),null===(t=this.tip)||void 0===t||t.hide(),i.element.classList.remove(...this.dragActiveCls.split(" ")),e.element.parentElement.classList.remove("b-sch-dragcreating")}onElementContextMenu(){if(this.proxy)return!1}prepareCreateContextForFinalization(e,t,i,n=!1){return u(u({},e),{},{async:n,event:t,finalize:i})}onEventDataGenerated(e){var t,i;(null===(t=this.dragging)||void 0===t||null===(i=t.context)||void 0===i?void 0:i.eventRecord)===e.eventRecord&&(e.wrapperCls["b-sch-dragcreating"]=!0,e.wrapperCls["b-too-narrow"]=this.dragging.context.tooNarrow)}triggerBeforeResize(){}triggerEventResizeStart(){}checkValidity(e,t){throw new Error("Implement in subclass")}triggerDragCreateEnd(e,t){throw new Error("Implement in subclass")}handleBeforeDragCreate(e,t){throw new Error("Implement in subclass")}isRowEmpty(e){throw new Error("Implement in subclass")}}s(we,"configurable",{showTooltip:!0,dragTolerance:2,preventMultiple:!1,dragTouchStartDelay:300,validatorFnThisObj:null,tipTemplate:e=>`\n            <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                ${e.startClockHtml}\n                ${e.endClockHtml}\n                <div class="b-sch-tip-message">${e.message}</div>\n            </div>\n        `,dragActiveCls:"b-dragcreating"}),s(we,"pluginConfig",{chain:["render","onEventDataGenerated"],before:["onElementContextMenu"]}),we._$name="DragCreateBase";class Ce extends y{static get defaultConfig(){return{autoUpdate:!1,hoverDelay:250,hideDelay:100,template:null,cls:null,align:{align:"b-t"},clockTemplate:null,monitorRecordUpdate:null,testConfig:{hoverDelay:0}}}static get pluginConfig(){return{chain:["onPaint"]}}construct(e,t){const i=this;t=i.processConfig(t),super.construct(e,t),i.forSelector||(i.forSelector=`${e.eventInnerSelector}:not(.b-dragproxy)`),i.clockTemplate=new K({scheduler:e}),e.ion({[`before${e.scheduledEventName}drag`]:()=>{var e;null===(e=i.tooltip)||void 0===e||e.hide()}})}processConfig(e){return"function"==typeof e?{template:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.destroyProperties("clockTemplate","tooltip"),super.doDestroy()}doDisable(e){this.tooltip&&(this.tooltip.disabled=e),super.doDisable(e)}onPaint({firstPaint:e}){if(e){var t;const e=this,{client:i}=e,n=[".b-dragselecting",".b-eventeditor-editing",".b-taskeditor-editing",".b-resizing-event",".b-task-percent-bar-resizing-task",".b-dragcreating",`.b-dragging-${i.scheduledEventName}`,".b-creating-dependency",".b-dragproxy"].map((e=>`:not(${e})`)).join("");null===(t=e.tooltip)||void 0===t||t.destroy(),e.tooltip=new T(u(u({axisLock:"flexible",id:e.tipId||`${e.client.id}-event-tip`,cls:e.tipCls,forSelector:`.b-timelinebase${n} .b-grid-body-container:not(.b-scrolling) ${e.forSelector}`,scrollAction:"realign",forElement:i.timeAxisSubGridElement,showOnHover:!0,anchorToTarget:!0,getHtml:e.getTipHtml.bind(e),disabled:e.disabled},e.config),{},{internalListeners:e.configuredListeners})),e.tooltip.ion({innerhtmlupdate:"updateDateIndicator",overtarget:"onOverNewTarget",show:"onTipShow",hide:"onTipHide",thisObj:e})}}processConfiguredListeners(){}addListener(...e){var t;const i=super.addListener(...e),n=null===(t=this.tooltip)||void 0===t?void 0:t.addListener(...e);if(i||n)return()=>{null==i||i(),null==n||n()}}removeListener(...e){var t;super.removeListener(...e),null===(t=this.tooltip)||void 0===t||t.removeListener(...e)}updateDateIndicator(){const e=this,t=e.tooltip,i=t.element.querySelector(".b-sch-tooltip-enddate");e.record&&(e.clockTemplate.updateDateIndicator(t.element,e.record.startDate),i&&e.clockTemplate.updateDateIndicator(i,e.record.endDate))}resolveTimeSpanRecord(e){return this.client.resolveTimeSpanRecord(e)}getTipHtml({tip:e,activeTarget:t}){const i=this,{client:n}=i,r=i.recordType||`${n.scheduledEventName}Record`,a=i.resolveTimeSpanRecord(t);if((null==a?void 0:a.startDate)instanceof Date){const{startDate:t,endDate:s}=a,o=n.getFormattedDate(t),l=n.getDisplayEndDate(s,t),d=n.getFormattedDate(l);return e.eventRecord=a,i.template({tip:e,[`${r}`]:a,startDate:t,endDate:s,startText:o,endText:d,startClockHtml:i.clockTemplate.template({date:t,text:o,cls:"b-sch-tooltip-startdate"}),endClockHtml:a.isMilestone?"":i.clockTemplate.template({date:l,text:d,cls:"b-sch-tooltip-enddate"})})}return e.hide(),""}get record(){return this.tooltip.eventRecord}onTipShow(){const e=this;e.monitorRecordUpdate&&!e.updateListener&&(e.updateListener=e.client.eventStore.ion({update:e.onRecordUpdate,thisObj:e}))}onTipHide(){var e;this.tooltip.eventRecord=null,null===(e=this.updateListener)||void 0===e||e.call(this),this.updateListener=null}onOverNewTarget({newTarget:e}){this.tooltip.eventRecord=this.resolveTimeSpanRecord(e)}onRecordUpdate({record:e}){e===this.record&&(this.tooltip.alignTo(),this.tooltip.updateContent())}}Ce._$name="TooltipBase";class ye extends(y.mixin(k)){static get defaultConfig(){return{rangeCls:"b-sch-range",lineCls:"b-sch-line",enableResizing:!1,showTooltip:!0,tooltipTemplate:null,dragTipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    <div class="b-sch-tip-name">${p.encodeHtml(e.name)||""}</div>\n                    ${e.startClockHtml}\n                    ${e.endClockHtml||""}\n                </div>\n            `,baseCls:"b-sch-timerange",headerRenderer:null,bodyRenderer:null,cls:null,narrowThreshold:80}}construct(e,t){const i=this;super.construct(e,t),e.isVertical&&e.ion({renderRows:i.onUIReady,thisObj:i,once:!0}),i.cls=i.cls||`b-sch-${i.constructor.$$name.toLowerCase()}`,i.baseSelector=`.${i.baseCls}.${i.cls}`,i.enableResizing&&(i.showHeaderElements=!0)}doDestroy(){var e,t,i,n;const r=this;r.detachListeners("timeAxisViewModel"),r.detachListeners("timeAxis"),null===(e=r.clockTemplate)||void 0===e||e.destroy(),null===(t=r.tip)||void 0===t||t.destroy(),null===(i=r.drag)||void 0===i||i.destroy(),null===(n=r.resize)||void 0===n||n.destroy(),super.doDestroy()}doDisable(e){this.renderRanges(),super.doDisable(e)}setupTimeAxisViewModelListeners(){const e=this;e.detachListeners("timeAxisViewModel"),e.detachListeners("timeAxis"),e.client.timeAxisViewModel.ion({name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",thisObj:e}),e.client.timeAxis.ion({name:"timeAxis",includeChange:"renderRanges",thisObj:e})}onUIReady(){const e=this,{client:t}=e;t.ion({timeAxisViewModelChange:e.setupTimeAxisViewModelListeners,thisObj:e}),e.setupTimeAxisViewModelListeners(),t.hideHeaders||(e.headerContainerElement&&g.on({click:e.onTimeRangeClick,dblclick:e.onTimeRangeClick,contextmenu:e.onTimeRangeClick,delegate:e.baseSelector,element:e.headerContainerElement,thisObj:e}),e.enableResizing&&(e.drag=G.new({name:"rangeDrag",lockX:t.isVertical,lockY:t.isHorizontal,constrain:!0,outerElement:e.headerContainerElement,targetSelector:`${e.baseSelector}`,isElementDraggable:(i,n)=>!t.readOnly&&e.isElementDraggable(i,n),rtlSource:t,internalListeners:{dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",reset:"onDragReset",abort:"onInvalidDrop",thisObj:e}},e.dragHelperConfig),e.resize=Y.new({direction:t.mode,targetSelector:`${e.baseSelector}.b-sch-range`,outerElement:e.headerContainerElement,isElementResizable:e=>!e.matches(".b-dragging,.b-readonly"),internalListeners:{resizestart:"onResizeStart",resizing:"onResizeDrag",resize:"onResize",cancel:"onInvalidResize",reset:"onResizeReset",thisObj:e}},e.resizeHelperConfig))),e.renderRanges(),e.tooltipTemplate&&(e.hoverTooltip=new T({forElement:e.headerContainerElement,getHtml({activeTarget:t}){const i=e.resolveTimeRangeRecord(t);return e.tooltipTemplate({timeRange:i})},forSelector:"."+e.baseCls+(e.cls?"."+e.cls:"")}))}refresh(){this._timeRanges=null,this.renderRanges()}getDOMConfig(e,t){const i=this,n=[],r=[];if(!i.disabled){i._labelRotationMap={};for(const a of i.timeRanges){const s=i.renderRange(a,e,t);s&&(n.push(s.bodyConfig),r.push(s.headerConfig))}}return[n,r]}renderRanges(){const e=this,{foregroundCanvas:t}=e.client;if(t&&e.client.isPainted){const{headerContainerElement:i}=e,n=[],[r,a]=e.getDOMConfig();e.bodyCanvas||(e.bodyCanvas=m.createElement({className:`b-timeranges-canvas ${e.cls}-canvas`,parent:t,retainElement:!0})),h.sync({targetElement:e.bodyCanvas,childrenOnly:!0,domConfig:{children:r,syncOptions:{releaseThreshold:0,syncIdField:"id"}},callback:e.showHeaderElements?null:({targetElement:e,action:t})=>{"reuseElement"!==t&&"newElement"!==t&&"reuseOwnElement"!==t||n.push(e)}}),e.showHeaderElements&&!e.headerCanvas&&(e.headerCanvas=m.createElement({className:`${e.cls}-canvas`,parent:i,retainElement:!0})),e.headerCanvas&&h.sync({targetElement:e.headerCanvas,childrenOnly:!0,domConfig:{children:a,syncOptions:{releaseThreshold:0,syncIdField:"id"}}});for(const t of n)e.cacheRotation(t.elementData.timeRange,t);for(const t of n)e.applyRotation(t.elementData.timeRange,t)}}get timeRanges(){return[]}shouldRenderRange(e,t=this.client.visibleDateRange.startDate,i=this.client.visibleDateRange.endDate){const{timeAxis:n}=this.client,{startDate:r,endDate:a,duration:s}=e;return Boolean(r&&(!n.isFiltered||n.isTimeSpanInAxis(e))&&l.intersectSpans(t,i,r,s?a:l.add(r,this._lineBufferDurationMS)))}getRangeDomConfig(e,t,i,n=0){const r=this,{client:a}=r,{rtl:s}=a,o=a.getCoordinateFromDate(l.max(e.startDate,t),{respectExclusion:!0})-n,d=e.endDate?a.getCoordinateFromDate(l.min(e.endDate,i),{respectExclusion:!0,isEnd:!0})-n:o,c=Math.abs(d-o),u=c>0,h=s?`calc(${o}px - 100%)`:`${o}px`;return{className:{[r.baseCls]:1,[r.cls]:r.cls,[r.rangeCls]:u,[r.lineCls]:!u,[e.cls]:e.cls,"b-narrow-range":u&&c<r.narrowThreshold,"b-readonly":e.readOnly,"b-rtl":s},dataset:{id:e.id},elementData:{timeRange:e},style:a.isVertical?`transform: translateY(${h}); ${u?`height:${c}px`:""};`:`transform: translateX(${h}); ${u?`width:${c}px`:""};`}}renderRange(e,t,i){const n=this,{client:r}=n,{timeAxis:a}=r;if(n.shouldRenderRange(e,t,i)&&a.startDate){const t=n.getRangeDomConfig(e,a.startDate,a.endDate),i=e.iconCls&&p.xss`<i class="${e.iconCls}"></i>`,r=e.name&&p.encodeHtml(e.name),s=r||i?`<label>${i||""}${r||"&nbsp;"}</label>`:"",o=u(u({},t),{},{style:t.style+(e.style||""),html:n.bodyRenderer?n.bodyRenderer({timeRange:e}):n.showHeaderElements&&!n.showLabelInBody?"":s});let l;return n.showHeaderElements&&(l=u(u({},t),{},{html:n.headerRenderer?n.headerRenderer({timeRange:e}):n.showLabelInBody?"":s})),{bodyConfig:o,headerConfig:l}}}cacheRotation(e,t){if(!e.iconCls&&!e.name||!e.duration)return;const i=t.firstElementChild;i&&!e.recurringTimeSpan&&(this._labelRotationMap[e.id]=this.client.isVertical?i.offsetHeight<t.offsetHeight:i.offsetWidth>t.offsetWidth)}applyRotation(e,t){var i,n,r;const a=this._labelRotationMap[null!==(i=null===(n=e.recurringTimeSpan)||void 0===n?void 0:n.id)&&void 0!==i?i:e.id];null===(r=t.firstElementChild)||void 0===r||r.classList.toggle("b-vertical",Boolean(a))}getBodyElementByRecord(e){const t="string"==typeof e?e:null==e?void 0:e.id;return null!=t&&h.getChild(this.bodyCanvas,t)}resolveTimeRangeRecord(e){}get headerContainerElement(){const e=this,{isVertical:t,timeView:i,timeAxisColumn:n}=e.client;return e._headerContainerElement||(t&&i.element?e._headerContainerElement=i.element.parentElement:t||(e._headerContainerElement=n.element)),e._headerContainerElement}get showHeaderElements(){return!this.client.hideHeaders&&this._showHeaderElements}updateShowHeaderElements(e){const{client:t}=this;this.isConfiguring||(t.element.classList.toggle("b-sch-timeranges-with-headerelements",Boolean(e)),this.renderRanges())}populateTimeAxisHeaderMenu({column:e,items:t}){}onPaint({firstPaint:e}){e&&this.client.isHorizontal&&this.onUIReady()}onSchedulerHorizontalScroll(){this.client.isHorizontal&&this.renderRanges()}afterScroll(){this.client.isVertical&&this.renderRanges()}onInternalResize(e,t,i,n,r){this.client.isVertical&&r!==i&&this.renderRanges()}onTimeAxisViewModelUpdate({source:e}){this._lineBufferDurationMS=e.getDateFromPosition(50)-e.getDateFromPosition(0),this.refresh()}onTimeRangeClick(e){const t=this.resolveTimeRangeRecord(e.target);this.client.trigger(`timeRangeHeader${p.capitalize(e.type)}`,{event:e,timeRangeRecord:t})}showTip(e){const t=this;t.showTooltip&&(t.clockTemplate=new K({scheduler:t.client}),t.tip=new T(o.assign({id:`${t.client.id}-time-range-tip`,cls:"b-interaction-tooltip",align:"b-t",autoShow:!0,updateContentOnMouseMove:!0,forElement:e.element,getHtml:()=>t.getTipHtml(e.record,e.element)},t.showTooltip)))}destroyTip(){this.tip&&(this.tip.destroy(),this.tip=null)}isElementDraggable(e){return(e=e.closest(this.baseSelector+":not(.b-resizing):not(.b-readonly)"))&&!e.classList.contains("b-over-resize-handle")}onDragStart({context:e}){const{client:t,drag:i}=this;t.isVertical?(i.minY=0,i.maxY=t.timeAxisViewModel.totalSize-e.element.offsetHeight,i.minX=0,i.maxX=Number.MAX_SAFE_INTEGER):(i.minX=0,i.maxX=t.timeAxisViewModel.totalSize-e.element.offsetWidth,i.minY=0,i.maxY=Number.MAX_SAFE_INTEGER),t.element.classList.add("b-dragging-timerange")}onDrop({context:e}){this.client.element.classList.remove("b-dragging-timerange")}onInvalidDrop(){this.drag.reset(),this.client.element.classList.remove("b-dragging-timerange"),this.destroyTip()}onDrag(){}onDragReset(){}onResizeStart(){}onResizeDrag(){}onResize(){}onInvalidResize(){}onResizeReset(){}getTipHtml(e,t){const i=this,{client:n}=i,r=E.from(t),a=r.getStart(n.rtl,n.isHorizontal),s=r.getEnd(n.rtl,n.isHorizontal),o=n.getDateFromCoordinate(a,"round",!1),l=e.endDate&&n.getDateFromCoordinate(s,"round",!1),d=n.getFormattedDate(o),c=l&&n.getFormattedEndDate(l,o);return i.dragTipTemplate({name:e.name||"",startDate:o,endDate:l,startText:d,endText:c,startClockHtml:i.clockTemplate.template({date:o,text:d,cls:"b-sch-tooltip-startdate"}),endClockHtml:c&&i.clockTemplate.template({date:l,text:c,cls:"b-sch-tooltip-enddate"})})}}s(ye,"configurable",{showHeaderElements:!0}),s(ye,"pluginConfig",{chain:["onPaint","populateTimeAxisHeaderMenu","onSchedulerHorizontalScroll","afterScroll","onInternalResize"]}),ye._$name="AbstractTimeRanges";const xe=Object.freeze({});class Te extends(k(y)){static get $name(){return"ColumnLines"}static get delayable(){return{refresh:{type:"raf",cancelOutstanding:!0}}}static get pluginConfig(){return{after:["render","updateCanvasSize","onVisibleDateRangeChange","onVisibleResourceRangeChange"]}}construct(e,t){e.useBackgroundCanvas=!0,super.construct(e,t)}doDisable(e){super.doDisable(e),this.isConfiguring||this.refresh()}render(){this.refresh()}getColumnLinesDOMConfig(e,t){const{client:i}=this,{rtl:n}=i,r=n?-1:1,{timeAxisViewModel:a,isHorizontal:s,resourceStore:o,variableColumnWidths:l}=i,{columnConfig:d}=a,c=a.columnLinesFor,u=Math.max(c-1,0),h=e.getTime(),g=t.getTime(),m=[],p=new Set,v=s?"X":"Y";if(!this.disabled){const e=(e,t)=>{const i=e.start.getTime();i>h&&i<g&&!p.has(i)&&(p.add(i),m.push({role:"presentation",className:t?"b-column-line-major":"b-column-line",style:{transform:`translate${v}(${e.coord*r}px)`},dataset:{line:t?`major-${e.index}`:`line-${e.index}`}}))};if(c!==u)for(let t=1;t<=d[u].length-1;t++)e(d[u][t],!0);for(let t=1;t<=d[c].length-1;t++)e(d[c][t],!1);if(!s&&i.columnLines){const{columnWidth:e}=i.resourceColumns,{first:t,last:n}=i.currentOrientation.getResourceRange(!0);if(t>-1)for(let a=t;a<n+1;a++){const t=o.getAt(a),n=t.instanceMeta(i),s=l?n.insetStart+t.columnWidth-1:(a+1)*e-1;m.push({className:"b-column-line b-resource-column-line",style:{transform:`translateX(${s*r}px)`},dataset:{line:`resource-${a}`}})}}}return m}refresh(){const e=this,{client:t}=e,{timeAxis:i}=t,{startDate:n,endDate:r}=t.visibleDateRange||xe;if(!i.startDate||!n)return;e.element||(e.element=m.createElement({parent:t.backgroundCanvas,className:"b-column-lines-canvas"}));const a=e.getColumnLinesDOMConfig(n,r);h.sync({targetElement:e.element,onlyChildren:!0,domConfig:{children:a,syncOptions:{releaseThreshold:4}},syncIdField:"line"})}onVisibleDateRangeChange(){this.refresh()}onVisibleResourceRangeChange({firstResource:e,lastResource:t}){this.refresh()}updateCanvasSize(){this.refresh()}}Te._$name="ColumnLines",W.registerFeature(Te,!0,["Scheduler","Gantt"]);var Ee=e=>class extends(e||A){static get $name(){return"DependencyCreation"}static get defaultConfig(){return{allowDropOnEventBar:!0,showCreationTooltip:!0,creationTooltip:null,terminalCls:"b-sch-terminal",terminalSides:["start","top","end","bottom"],allowCreate:!0}}construct(e,t){super.construct(e,t);const i=this;i.view=e,i.eventName=e.scheduledEventName,e.ion({readOnly:()=>i.updateCreateListeners()}),i.updateCreateListeners(),i.chain(e,"onElementTouchMove","onElementTouchMove")}doDestroy(){var e,t;const i=this;i.detachListeners("view"),i.creationData=null,null===(e=i.pointerUpMoveDetacher)||void 0===e||e.call(i),null===(t=i.creationTooltip)||void 0===t||t.destroy(),super.doDestroy()}updateCreateListeners(){const e=this;e.view&&(e.detachListeners("view"),e.isCreateAllowed&&e.view.ion({name:"view",[`${e.eventName}mouseenter`]:"onTimeSpanMouseEnter",[`${e.eventName}mouseleave`]:"onTimeSpanMouseLeave",thisObj:e}))}set allowCreate(e){this._allowCreate=e,this.updateCreateListeners()}get allowCreate(){return this._allowCreate}get isCreateAllowed(){return this.allowCreate&&!this.view.readOnly&&!this.disabled}onTimeSpanMouseEnter({event:e,source:t,[`${this.eventName}Record`]:i,[`${this.eventName}Element`]:n}){if(!i.isCreating&&!i.readOnly&&(!this.client.features.nestedEvents||i.parent.isRoot)){const r=this,{creationData:a}=r,s=m.down(n,t.eventInnerSelector);i!==(null==a?void 0:a.source)&&(r.showTerminals(i,s),a&&e.target.closest(r.client.eventSelector)&&(a.timeSpanElement=s,r.onOverTargetEventBar(e)))}}onTimeSpanMouseLeave(e){var t;const i=this,{creationData:n}=i,r=e[`${i.eventName}Element`],a=m.down(r,i.view.eventInnerSelector),s=null===(t=e.event)||void 0===t?void 0:t.relatedTarget,o=null==n?void 0:n.timeSpanElement;s&&(n&&o&&s&&m.isDescendant(o,s)||(e.event.isTrusted||a!==(null==n?void 0:n.sourceElement))&&i.hideTerminals(r),n&&!n.finalizing&&(n.timeSpanElement=null,i.onOverNewTargetWhileCreating(void 0,void 0,e)))}onTerminalMouseOver(e){this.creationData&&this.onOverTargetEventBar(e)}onTerminalMouseOut(e){const t=this,{creationData:i}=t,n=e.target.closest(t.view.eventSelector);!n||t.showingTerminalsFor&&m.isDescendant(n,t.showingTerminalsFor)||i&&n===i.timeSpanElement||(t.hideTerminals(n),t.view.unhover(n,e)),i&&t.onOverNewTargetWhileCreating(e.relatedTarget,i.target,e)}onTerminalPointerDown(e){const t=this;if(0===e.button&&!t.creationData){var i;const n=t.view,r=n.timeAxisSubGridElement,a=e.target,s=a.closest(n.eventInnerSelector),o=E.from(n.element,document.body);e.stopPropagation(),t.creationData={sourceElement:s,source:n.resolveTimeSpanRecord(s).$original,fromSide:a.dataset.side,startPoint:E.from(a,r).center,startX:e.pageX-o.x+n.scrollLeft,startY:e.pageY-o.y+n.scrollTop,valid:!1,sourceResource:null===(i=n.resolveResourceRecord)||void 0===i?void 0:i.call(n,e),tooltip:t.creationTooltip},t.pointerUpMoveDetacher=g.on({pointerup:{element:n.element.getRootNode(),handler:"onMouseUp",passive:!1},pointermove:{element:r,handler:"onMouseMove",passive:!1},thisObj:t}),t.documentPointerUpDetacher=g.on({pointerup:{element:document,handler:"onDocumentMouseUp"},keydown:{element:document,handler:({key:e})=>{"Escape"===e&&t.abort()}},thisObj:t})}}onElementTouchMove(e){var t;null===(t=super.onElementTouchMove)||void 0===t||t.call(this,e),this.connector&&e.preventDefault()}onMouseMove(e){const t=this,{view:i,creationData:n}=t,r=E.from(i.element,document.body),a=e.pageX-r.x+i.scrollLeft-n.startX,s=e.pageY-r.y+i.scrollTop-n.startY,o=Math.round(Math.sqrt(a*a+s*s))-3,l=Math.atan2(s,a);let{connector:d}=t;if(!d){if(!1===t.onRequestDragCreate(e))return;d=t.connector}d.style.width=`${o}px`,d.style.transform=`rotate(${l}rad)`,t.lastMouseMoveEvent=e}onRequestDragCreate(e){const t=this,{view:i,creationData:n}=t;if(!1===i.trigger("beforeDependencyCreateDrag",{data:n,source:n.source}))return t.abort(),!1;if(i.element.classList.add("b-creating-dependency"),t.createConnector(n.startPoint.x,n.startPoint.y),i.trigger("dependencyCreateDragStart",{data:n,source:n.source}),t.showCreationTooltip){const i=t.creationTooltip||(t.creationTooltip=t.createDragTooltip());t.creationData.tooltip=i,i.disabled=!1,i.show(),i.onMouseMove(e)}i.scrollManager.startMonitoring({scrollables:[{element:i.timeAxisSubGrid.scrollable.element,direction:"horizontal"},{element:i.scrollable.element,direction:"vertical"}],callback:()=>t.lastMouseMoveEvent&&t.onMouseMove(t.lastMouseMoveEvent)})}onOverTargetEventBar(e){var t;const i=this,{view:n,creationData:r,allowDropOnEventBar:a}=i,{target:s}=e;let o=n.resolveTimeSpanRecord(s).$original;null!==(t=o)&&void 0!==t&&t.isEventSegment&&(o=o.event),x.isPromise(r.valid)||!a&&!s.classList.contains(i.terminalCls)||o!==r.source&&i.onOverNewTargetWhileCreating(s,o,e)}async onOverNewTargetWhileCreating(e,t,i){const n=this,{view:a,creationData:s,allowDropOnEventBar:o,connector:l}=n;if(!x.isPromise(s.valid)&&!s.finalizing&&l){if(l.classList.remove("b-valid","b-invalid"),s.timeSpanElement&&m.removeClsGlobally(s.timeSpanElement,"b-sch-terminal-active"),t&&t!==s.source&&(o||e.classList.contains(n.terminalCls))){var d,c;const u=s.target=t,{source:h}=s;let g,m=e.dataset.side;o&&!e.classList.contains(n.terminalCls)&&(m=n.getTargetSideFromType(n.dependencyStore.modelClass.fieldMap.type.defaultValue||r.Type.EndToStart)),a.resolveResourceRecord&&(s.targetResource=a.resolveResourceRecord(i)),s.toSide=m;const p=s.fromSide,v=t=>{n.isDestroyed||(s.valid=t,e.classList.add(t?"b-valid":"b-invalid"),l.classList.add(t?"b-valid":"b-invalid"),a.trigger("dependencyValidationComplete",{data:s,source:h,target:u,dependencyType:g}))};switch(!0){case"start"===p&&"start"===m:g=r.Type.StartToStart;break;case"start"===p&&"end"===m:g=r.Type.StartToEnd;break;case"end"===p&&"start"===m:g=r.Type.EndToStart;break;case"end"===p&&"end"===m:g=r.Type.EndToEnd}a.trigger("dependencyValidationStart",{data:s,source:h,target:u,dependencyType:g});let f=s.valid=n.dependencyStore.isValidDependency(h,u,g);x.isPromise(f)?(f=await f,v(f)):v(f);const D=f?"b-valid":"b-invalid";l.classList.add(D),null===(d=s.timeSpanElement)||void 0===d||null===(c=d.querySelector(`.b-sch-terminal[data-side=${m}]`))||void 0===c||c.classList.add("b-sch-terminal-active",D)}else s.target=s.toSide=null,s.valid=!1,l.classList.add("b-invalid");n.updateCreationTooltip()}}async onMouseUp(){var e;const t=this,i=t.creationData;if(i.finalizing=!0,null===(e=t.pointerUpMoveDetacher)||void 0===e||e.call(t),i.valid){if(!1===await t.view.trigger("beforeDependencyCreateFinalize",i)?i.valid=!1:x.isPromise(i.valid)&&(i.valid=await i.valid),i.valid){let e=t.createDependency(i);null!==e&&(x.isPromise(e)&&(e=await e),i.dependency=e,t.view.trigger("dependencyCreateDrop",{data:i,source:i.source,target:i.target,dependency:e}),t.doAfterDependencyDrop(i))}else t.doAfterDependencyDrop(i)}else i.valid=!1,t.doAfterDependencyDrop(i);t.abort()}doAfterDependencyDrop(e){this.view.trigger("afterDependencyCreateDrop",u({data:e},e))}onDocumentMouseUp({target:e}){this.view.timeAxisSubGridElement.contains(e)||this.abort()}abort(){var e,t;const i=this,{view:n,creationData:r}=i;if(r){const{source:e,sourceResource:t,target:a,targetResource:s}=r;if(e){const r=n.getElementFromEventRecord(e,t);r&&i.hideTerminals(r)}if(a){const e=n.getElementFromEventRecord(a,s);e&&i.hideTerminals(e)}}i.creationTooltip&&(i.creationTooltip.disabled=!0),i.creationData=i.lastMouseMoveEvent=null,null===(e=i.pointerUpMoveDetacher)||void 0===e||e.call(i),null===(t=i.documentPointerUpDetacher)||void 0===t||t.call(i),i.removeConnector()}createConnector(e,t){const i=this,{view:n}=i;i.clearTimeout(i.removeConnectorTimeout),i.connector=m.createElement({parent:n.timeAxisSubGridElement,className:`${i.baseCls}-connector`,style:`left:${e}px;top:${t}px`}),n.element.classList.add("b-creating-dependency")}createDragTooltip(){const e=this,{view:t}=e;return e.creationTooltip=T.new({id:`${t.id}-dependency-drag-tip`,cls:"b-sch-dependency-creation-tooltip",loadingMsg:"",anchorToTarget:!1,forElement:t.timeAxisSubGridElement,trackMouse:!0,constrainTo:null,header:{dock:"right"},internalListeners:{beforeShow:"updateCreationTooltip",thisObj:e}},e.creationTooltip)}removeConnector(){const e=this,{connector:t,view:i}=e;t&&(t.classList.add("b-removing"),t.style.width="0",e.removeConnectorTimeout=e.setTimeout((()=>{t.remove(),e.connector=null}),200)),i.element.classList.remove("b-creating-dependency"),e.creationTooltip&&e.creationTooltip.hide(),i.scrollManager.stopMonitoring()}showTerminals(e,t){const i=this;if(!i.isCreateAllowed||!e.project)return;const n=i.terminalCls,r=`${n}s-visible`;(t=m.down(t,i.view.eventInnerSelector)).classList.contains(r)||i.view.element.classList.contains("b-resizing-event")||i.view.readOnly||(i.terminalSides.forEach((e=>{e=i.fixSide(e);const r=m.createElement({parent:t,className:`${n} ${n}-${e}`,dataset:{side:e,feature:!0}});r.detacher=g.on({element:r,mouseover:"onTerminalMouseOver",mouseout:"onTerminalMouseOut",pointerdown:{handler:"onTerminalPointerDown",capture:!0},thisObj:i})})),t.classList.add(r),e.internalCls.add(r),i.showingTerminalsFor=t)}fixSide(e){return"left"===e?"start":"right"===e?"end":e}hideTerminals(e){const t=this,i=t.client.getTimeSpanMouseEventParams(e),n=null==i?void 0:i[`${t.eventName}Record`],r=`${t.terminalCls}s-visible`;m.forEachSelector(e,`.${t.terminalCls}`,(e=>{e.detacher&&e.detacher(),e.remove()})),m.down(e,t.view.eventInnerSelector).classList.remove(r),n.internalCls.remove(r),t.showingTerminalsFor=null}createDependency(e){const{source:t,target:i,fromSide:n,toSide:r}=e,a=("start"===n?0:2)+("end"===r?1:0),s=this.dependencyStore.add({from:t.id,to:i.id,type:a,fromSide:n,toSide:r});return null!==s?s[0]:null}getTargetSideFromType(e){return e===r.Type.StartToStart||e===r.Type.EndToStart?"start":"end"}updateCreationTooltip(){const e=this,t=e.creationData,{valid:i}=t,n=e.creationTooltip,{classList:r}=n.element;if(x.isPromise(i))return r.remove("b-invalid"),r.add("b-checking"),new Promise((r=>i.then((i=>{t.valid=i,n.isDestroyed||r(e.updateCreationTooltip())}))));n.html=e.creationTooltipTemplate(t)}creationTooltipTemplate(e){var t,i;const n=this,{tooltip:r,valid:a}=e,{classList:s}=r.element;let o,l;return Object.assign(e,{fromText:p.encodeHtml(e.source.name),toText:p.encodeHtml(null!==(t=null===(i=e.target)||void 0===i?void 0:i.name)&&void 0!==t?t:""),fromSide:e.fromSide,toSide:e.toSide||""}),s.toggle("b-invalid",!a),s.remove("b-checking"),!0===a?(o="valid",l=n.L("L{Dependencies.valid}")):(o="invalid",l=n.L("L{Dependencies.invalid}")),r.title=`<i class="b-icon b-icon-${o}"></i>${l}`,{children:[{className:"b-sch-dependency-tooltip",children:[{dataset:{ref:"fromLabel"},tag:"label",text:n.L("L{Dependencies.from}")},{dataset:{ref:"fromText"},text:e.fromText},{dataset:{ref:"fromBox"},className:`b-sch-box b-${e.fromSide}`},{dataset:{ref:"toLabel"},tag:"label",text:n.L("L{Dependencies.to}")},{dataset:{ref:"toText"},text:e.toText},{dataset:{ref:"toBox"},className:`b-sch-box b-${e.toSide}`}]}]}}doDisable(e){this.isConfiguring||this.updateCreateListeners(),super.doDisable(e)}};var Re=e=>{var t;return t=class extends e{constructor(...e){super(...e),s(this,"gridCache",null)}getDependenciesToConsider(e,t,i,n){const r=this,{gridCache:a}=r,{timeAxis:s}=r.client;if(a){const o=new Set,l=Math.floor((e-s.startMS)/r.MS_PER_CELL),d=Math.floor((t-s.startMS)/r.MS_PER_CELL),c=Math.floor(i/25),u=Math.floor(n/25);for(let e=l;e<=d;e++){const t=a[e];if(t)for(let e=c;e<=u;e++){const i=t[e];if(i)for(let e=0;e<i.length;e++)o.add(i[e])}}return o}}afterDrawDependency(e,t,i,n,r){const a=this;if(a.constructGridCache){const{MS_PER_CELL:l}=a,{startMS:d,endMS:c}=a.client.timeAxis,u=Math.ceil((c-d)/l),h=Math.floor((n-d)/l),g=Math.floor((r-d)/l),m=Math.floor(t/25),p=Math.floor(i/25),v=Math.min(h,g),f=Math.max(h,g),D=Math.min(m,p),b=Math.max(m,p);if(v<0&&f<0||v>u&&f>u)return;const S=Math.max(v,0),w=Math.min(f,u);for(let t=S;t<=w;t++){var s;const i=null!==(s=a.gridCache[t])&&void 0!==s?s:a.gridCache[t]={};for(let t=D;t<=b;t++){var o;(null!==(o=i[t])&&void 0!==o?o:i[t]=[]).push(e)}}}}beforeDraw(){const e=this;if(!e.gridCache){const{visibleDateRange:t}=e.client;e.constructGridCache=!0,e.MS_PER_CELL=Math.max(t.endMS-t.startMS,1e3),e.gridCache={}}}afterDraw(){this.constructGridCache=!1}reset(){this.gridCache=null}},s(t,"$name","DependencyGridCache"),t};const Me=Math.min(1/globalThis.devicePixelRatio,.75),ke=["start","end","top","bottom"],Ae=(e,t)=>Math.abs(e-t)<.1;class ze extends A{static get configurable(){return{startSide:"right",startArrowMargin:12,startShift:0,endSide:"left",endArrowMargin:12,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null,client:{}}}findPath(e,t){const i=this,n=e;let r,a,s,o,l,d,c,u,h,g,m,p,v,f,D,b,S,w,C,y,x,T,E,R,M,k,A,P,F;for(t=z.asArray(t),F=0;e&&!P;){var L;if(r=Object.assign(i.config,e),a=r.startBox,s=r.endBox,o=r.startShift,l=r.endShift,d=r.startSide,c=r.endSide,u=r.startArrowMargin,h=r.endArrowMargin,g=r.horizontalMargin,m=r.verticalMargin,p=r.hasOwnProperty("startHorizontalMargin")?r.startHorizontalMargin:g,v=r.hasOwnProperty("startVerticalMargin")?r.startVerticalMargin:m,f=r.hasOwnProperty("endHorizontalMargin")?r.endHorizontalMargin:g,D=r.hasOwnProperty("endVerticalMargin")?r.endVerticalMargin:m,b=r.hasOwnProperty("otherHorizontalMargin")?r.otherHorizontalMargin:g,S=r.hasOwnProperty("otherVerticalMargin")?r.otherVerticalMargin:m,w=r.otherBoxes,d=i.normalizeSide(d),c=i.normalizeSide(c),C=i.getConnectionCoordinatesFromBoxSideShift(a,d,o),y=i.getConnectionCoordinatesFromBoxSideShift(s,c,l),M=i.calcGridBaseBoxFromBoxAndDrawParams(a,d,u,p,v),k=i.calcGridBaseBoxFromBoxAndDrawParams(s,c,h,f,D),ke.forEach((e=>{Math.abs(M[e]-k[e])<=Me&&(k[e]=M[e])})),i.shouldLookForPath(a,s,M,k))w=null===(L=w)||void 0===L?void 0:L.map((e=>i.calcGridBaseBoxFromBoxAndDrawParams(e,!1,0,b,S))),x=i.getConnectionCoordinatesFromBoxSideShift(M,d,o),T=i.getConnectionCoordinatesFromBoxSideShift(k,c,l),A=i.buildPathGrid(M,k,x,T,d,c,w),E=i.convertDecartPointToGridPoint(A,x),R=i.convertDecartPointToGridPoint(A,T),P=i.findPathOnGrid(A,E,R,d,c);for(e=!1;!P&&!e&&t&&F<t.length;F++)e=t[F](r,n)}return P&&(P=i.prependPathWithArrowStaffSegment(P,C,d),P=i.appendPathWithArrowStaffSegment(P,y,c),P=i.optimizePath(P)),P}static calculateRelativePosition(e,t,i=!1){const n=i?"top":"start",r=i?"bottom":"end";let a;return a=e[r]<t[n]?0:e[r]<=t[r]&&e[r]>=t[n]&&e[n]<t[n]?1:e[n]>=t[n]&&e[r]<=t[r]?2:e[n]<t[n]&&e[r]>t[r]?-2:e[n]<=t[r]&&e[r]>t[r]?3:4,a}static boxOverlapChanged(e,t,i,n,r=!1){const a=ze.calculateRelativePosition;return a(e,t,r)!==a(i,n,r)}shouldLookForPath(e,t,i,n){let r=!0;return(e.end-e.start<=this.startArrowMargin||t.end-t.start<=this.endArrowMargin)&&2===Math.abs(ze.calculateRelativePosition(e,t,!0))&&(r=!ze.boxOverlapChanged(e,t,i,n)),r}getConnectionCoordinatesFromBoxSideShift(e,t,i){let n;switch(t){case"left":n={x:e.start,y:(e.top+e.bottom)/2+i};break;case"right":n={x:e.end,y:(e.top+e.bottom)/2+i};break;case"top":n={x:(e.start+e.end)/2+i,y:e.top};break;case"bottom":n={x:(e.start+e.end)/2+i,y:e.bottom}}return n}calcGridBaseBoxFromBoxAndDrawParams(e,t,i,n,r){let a;switch(this.normalizeSide(t)){case"left":a={start:e.start-Math.max(i,n),end:e.end+n,top:e.top-r,bottom:e.bottom+r};break;case"right":a={start:e.start-n,end:e.end+Math.max(i,n),top:e.top-r,bottom:e.bottom+r};break;case"top":a={start:e.start-n,end:e.end+n,top:e.top-Math.max(i,r),bottom:e.bottom+r};break;case"bottom":a={start:e.start-n,end:e.end+n,top:e.top-r,bottom:e.bottom+Math.max(i,r)};break;default:a={start:e.start-n,end:e.end+n,top:e.top-r,bottom:e.bottom+r}}return a}normalizeSide(e){const{rtl:t}=this.client;return"start"===e?t?"right":"left":"end"===e?t?"left":"right":e}buildPathGrid(e,t,i,n,r,a,s){let o,l,d,c,u,h,g,m,p,v,f,D,b;const S={},w=[];for(o=[e.start,"left"===r||"right"===r?(e.start+e.end)/2:i.x,e.end,t.start,"left"===a||"right"===a?(t.start+t.end)/2:n.x,t.end],l=[e.top,"top"===r||"bottom"===r?(e.top+e.bottom)/2:i.y,e.bottom,t.top,"top"===a||"bottom"===a?(t.top+t.bottom)/2:n.y,t.bottom],s&&s.forEach((e=>{o.push(e.start,(e.start+e.end)/2,e.end),l.push(e.top,(e.top+e.bottom)/2,e.bottom)})),o=[...new Set(o.sort(((e,t)=>e-t)))],l=[...new Set(l.sort(((e,t)=>e-t)))],h=0,m=l.length;h<m;++h)for(S[h]=S[h]||{},d=l[h],u=0,g=o.length;u<g;++u){if(c=o[u],D=(c<=e.start||c>=e.end||d<=e.top||d>=e.bottom)&&(c<=t.start||c>=t.end||d<=t.top||d>=t.bottom),s)for(p=0,v=s.length;D&&p<v;++p)f=s[p],D=c<=f.start||c>=f.end||d<=f.top||d>=f.bottom||c===i.x&&d===i.y||c===n.x&&d===n.y;b={distance:Number.MAX_SAFE_INTEGER,permitted:D,x:c,y:d,ix:u,iy:h},S[h][u]=b,w.push(b)}return{width:o.length,height:l.length,xs:o,ys:l,points:S,linearPoints:w}}convertDecartPointToGridPoint(e,t){const i=e.xs.indexOf(t.x),n=e.ys.indexOf(t.y);return e.points[n][i]}findPathOnGrid(e,t,i,n,r){const a=this;let s=!1;return t.permitted&&i.permitted&&(e=a.waveForward(e,t,0),s=a.collectPath(e,i,r)),s}getGridPointNeighbors(e,t,i){const n=t.ix,r=t.iy,a=[];let s;return r<e.height-1&&(s=e.points[r+1][n],(!i||i(s))&&a.push(s)),r>0&&(s=e.points[r-1][n],(!i||i(s))&&a.push(s)),n<e.width-1&&(s=e.points[r][n+1],(!i||i(s))&&a.push(s)),n>0&&(s=e.points[r][n-1],(!i||i(s))&&a.push(s)),a}waveForward(e,t,i){const n=this;return P.preWalkUnordered([t,i],(([t,i])=>n.getGridPointNeighbors(e,t,(e=>e.permitted&&e.distance>i+1)).map((e=>[e,i+1]))),(([e,t])=>e.distance=t)),e}collectPath(e,t,i){const n=this,r=[];let a,s,o,l,d=!0;for(;d&&t.distance;)if(a=n.getGridPointNeighbors(e,t,(e=>e.permitted&&e.distance===t.distance-1)),d=a.length>0,d){switch(a=a.sort(((e,n)=>{let r,a;r=e.ix-t.ix,a=e.iy-t.iy;const s=("left"===i||"right"===i)&&0===a||("top"===i||"bottom"===i)&&0===r?-1:1;r=n.ix-t.ix,a=n.iy-t.iy;const o=("left"===i||"right"===i)&&0===a||("top"===i||"bottom"===i)&&0===r?-1:1;return s>o?1:s<o?-1:s===o?e.y>n.y?-1:1:void 0})),s=a[0],r.push({x1:s.x,y1:s.y,x2:t.x,y2:t.y}),o=s.ix-t.ix,l=s.iy-t.iy,!0){case!l&&o>0:i="left";break;case!l&&o<0:i="right";break;case!o&&l>0:i="top";break;case!o&&l<0:i="bottom"}t=s}return d&&r.reverse()||!1}prependPathWithArrowStaffSegment(e,t,i){if(e.length>0){const n=e[0],r={x2:n.x1,y2:n.y1};switch(i){case"left":case"right":r.x1=t.x,r.y1=n.y1;break;case"top":case"bottom":r.x1=n.x1,r.y1=t.y}e.unshift(r)}return e}appendPathWithArrowStaffSegment(e,t,i){if(e.length>0){const n=e[e.length-1],r={x1:n.x2,y1:n.y2};switch(i){case"left":case"right":r.x2=t.x,r.y2=n.y2;break;case"top":case"bottom":r.x2=n.x2,r.y2=t.y}e.push(r)}return e}optimizePath(e){const t=[];let i,n;if(e.length>0)for(i=e.shift(),t.push(i);e.length>0;)n=e.shift(),Ae(i.x1,n.x1)&&Ae(i.y1,n.y1)&&Ae(i.x2,n.x2)&&Ae(i.y2,n.y2)?i=n:Ae(i.y1,i.y2)&&Ae(n.y1,n.y2)?i.x2=n.x2:Ae(i.x1,i.x2)&&Ae(n.x1,n.x2)?i.y2=n.y2:(t.push(n),i=n);return t}}function Pe(e){return e.x1===e.x2?e.y2>e.y1?"d":"u":e.x2>e.x1?"r":"l"}function Fe(e){return e.x1===e.x2?e.y2-e.y1:e.x2-e.x1}function Le(e,t,i,n,r){let a=e.x1===e.x2?"v":"h",s=n;if(n){const o=Fe(e),l=t?Math.abs(Fe(t)):Number.MAX_SAFE_INTEGER,d=Math.sign(o);null==r&&(r=n),(Math.abs(o)<2*n||l<2*n)&&(s=Math.min(Math.abs(o),l)/2);const c=o-("single"===i?0:"first"===i?s:"between"===i?r+s:r)*d;a+=Math.sign(c)!==d?0:c,"last"!==i&&"single"!==i&&s>0&&(a+=` ${function(e,t,i){const n=Pe(e)+Pe(t),r=i*(n.includes("l")?-1:1),a=i*(n.includes("u")?-1:1);return`a${r},${a} 0 0 ${"ur"===n||"lu"===n||"dl"===n||"rd"===n?1:0} ${r},${a}`}(e,t,s)}`)}else a+=Fe(e);return{line:a,currentRadius:n!==s?s:null}}function He(e,t){const{length:i}=t;if(!i)return"";let n=null;return`M${t[0].x1},${t[0].y1} ${t.map(((r,a)=>{const s=1===i?"single":a===i-1?"last":0===a?"first":"between",o=Le(r,t[a+1],s,e,n);return({currentRadius:n}=o),o.line})).join(" ")}`}ze._$name="RectangularPathFinder";var Oe=e=>{var t;return t=class extends e{constructor(...e){super(...e),s(this,"lineCache",{})}onSVGReady(){const e=this;e.pathFinder=new ze(u(u({},e.pathFinderConfig),{},{client:e.client})),e.lineDefAdjusters=e.createLineDefAdjusters(),e.createMarker()}changeRadius(e){return null!==e&&o.assertNumber(e,"radius"),e}updateRadius(){this.isConfiguring||this.reset()}updateRenderer(){this.isConfiguring||this.reset()}changeClickWidth(e){return null!==e&&o.assertNumber(e,"clickWidth"),e}updateClickWidth(){this.isConfiguring||this.reset()}createMarker(){var e,t;const i=this,{markerDef:n}=i,r=this.client.svgCanvas,a=n?`${i.client.id}-arrowEnd`:"arrowEnd";null===(e=i.marker)||void 0===e||e.remove(),r.style.setProperty("--scheduler-dependency-marker",`url(#${a})`),i.marker=m.createElement({parent:r,id:a,tag:"marker",className:"b-sch-dependency-arrow",ns:"http://www.w3.org/2000/svg",markerHeight:11,markerWidth:11,refX:8.5,refY:3,viewBox:"0 0 9 6",orient:"auto-start-reverse",markerUnits:"userSpaceOnUse",retainElement:!0,children:[{tag:"path",ns:"http://www.w3.org/2000/svg",d:null!==(t=i.markerDef)&&void 0!==t?t:"M3,0 L3,6 L9,3 z"}]})}updateMarkerDef(){this.isConfiguring||this.createMarker()}getAssignmentElement(e){var t;return(null===(t=this.client.features.eventDrag)||void 0===t?void 0:t.getProxyElement(e))||this.client.getElementFromAssignmentRecord(e)}getDomConfigs(e,t,i,n){const r=this,a=r.getDependencyKey(e,t,i),s=r.lineCache[a];if(r.constructLineCache||!s||n||r.drawingLive&&(r.getAssignmentElement(t)||r.getAssignmentElement(i))){const s=r.prepareLineDef(e,t,i,n),d=s&&r.pathFinder.findPath(s,r.lineDefAdjusters),{client:c,clickWidth:h}=r,{toEvent:g}=e;if(d){var o,l;const n=r.highlighted.get(e),m={tag:"path",ns:"http://www.w3.org/2000/svg",d:He(null!==(o=r.radius)&&void 0!==o?o:0,d),role:"presentation",dataset:{syncId:a,depId:e.id,fromId:t.id,toId:i.id},elementData:{dependency:e,points:d},class:{[r.baseCls]:1,[e.cls]:e.cls,[e.highlighted]:e.highlighted,[n&&[...n].join(" ")]:n,[r.noMarkerCls]:s.hideMarker,"b-inactive":!1===e.active,"b-sch-bidirectional-line":e.bidirectional,"b-readonly":e.readOnly,"b-sch-dependency-ends-outside":!g.milestone&&(g.endDate<=c.startDate||c.endDate<=g.startDate)||g.milestone&&(g.endDate<c.startDate||c.endDate<g.startDate)}};null===(l=r.renderer)||void 0===l||l.call(r,{domConfig:m,points:d,dependencyRecord:e,fromAssignmentRecord:t,toAssignmentRecord:i,fromBox:s.startBox,toBox:s.endBox,fromSide:s.startSide,toSide:s.endSide});const p=[m];return h>1&&p.push(u(u({},m),{},{class:u(u({},m.class),{},{"b-click-area":1}),dataset:u(u({},m.dataset),{},{syncId:`${m.dataset.syncId}-click-area`}),style:{strokeWidth:h}})),r.lineCache[a]=p}return r.lineCache[a]=null}return s}generateBoundaryBoxes(e,t){return"bottom"===t?[{start:e.left,end:e.left+e.width/2,top:e.rowTop,bottom:e.rowBottom},{start:e.left+e.width/2,end:e.right,top:e.rowTop,bottom:e.rowBottom}]:[{start:e.left-this.pathFinder.startArrowMargin,end:e.right+this.pathFinder.startArrowMargin,top:e.rowTop,bottom:e.rowBottom}]}getAssignmentBounds(e){const{client:t}=this,i=this.getAssignmentElement(e);if(i&&!t.isExporting){const n=E.from(i,this.relativeTo);if(t.isHorizontal){let i=t.getRowById(e.resource.id);if(n.y<i.top||n.bottom>i.bottom){const e=t.rowManager.getRowAt(n.center.y,!0);e&&(i=e)}n.rowTop=i.top,n.rowBottom=i.bottom}return n}return t.isEngineReady&&t.getAssignmentEventBox(e,!0)}getConnectorStartSide(e){return this.client.currentOrientation.getConnectorStartSide(e)}getConnectorEndSide(e){return this.client.currentOrientation.getConnectorEndSide(e)}getDependencyStartSide(e){const{fromEvent:t,type:i,fromSide:n}=e;if(n)return n;switch(!0){case i===a.Type.StartToEnd:case i===a.Type.StartToStart:return this.getConnectorStartSide(t);case i===a.Type.EndToStart:case i===a.Type.EndToEnd:default:return this.getConnectorEndSide(t)}}getDependencyEndSide(e){const{toEvent:t,type:i,toSide:n}=e;if(n)return n;switch(!0){case i===a.Type.EndToEnd:case i===a.Type.StartToEnd:return this.getConnectorEndSide(t);case i===a.Type.EndToStart:case i===a.Type.StartToStart:default:return this.getConnectorStartSide(t)}}createLineDefAdjusters(){const{client:e}=this;return[function(t){const{barMargin:i}=e;let n=!1;return(t.startArrowMargin>i||t.endArrowMargin>i)&&(t.startArrowMargin=t.endArrowMargin=i,n=!0),n?t:n},function(e){let t=!1;return(e.startArrowMargin>0||e.endArrowMargin>0)&&(e.startArrowMargin=e.endArrowMargin=0,t=!0),t?e:t},function(e,t){let i=!1;return e.horizontalMargin>2&&(e.horizontalMargin=1,i=!0,t.hideMarker=!0),i?e:i}]}adjustLineDef(e,t){return t}prepareLineDef(e,t,i,n){var r,a;const s=this,o=s.getDependencyStartSide(e),l=s.getDependencyEndSide(e),d=null!==(r=null==n?void 0:n.from)&&void 0!==r?r:s.getAssignmentBounds(t),c=null!==(a=null==n?void 0:n.to)&&void 0!==a?a:s.getAssignmentBounds(i),u=[];if(!d||!c)return null;let{startArrowMargin:h,verticalMargin:g}=s.pathFinder;return s.client.isHorizontal&&(null!=d.rowTop&&d.rowTop!==c.rowTop&&u.push(...s.generateBoundaryBoxes(d,o)),e.bidirectional||(/(top|bottom)/.test(o)&&(h=s.client.barMargin/2),g=s.client.barMargin/2)),s.adjustLineDef(e,{startBox:d,endBox:c,otherBoxes:u,startArrowMargin:h,verticalMargin:g,otherVerticalMargin:0,otherHorizontalMargin:0,startSide:o,endSide:l})}beforeDraw(){super.beforeDraw(),Object.keys(this.lineCache).length||(this.constructLineCache=!0)}afterDraw(){super.afterDraw(),this.constructLineCache=!1}reset(){super.reset(),this.lineCache={}}},s(t,"$name","DependencyLineGenerator"),t};const Ie=["start","start","end","end"],Ve=["start","end","start","end"];var $e=e=>{var t;return s(t=class extends e{changeTooltip(e,t){const i=this;return null==t||t.destroy(),i.showTooltip&&e?T.new({align:"b-t",id:`${i.client.id}-dependency-tip`,forSelector:`.b-timelinebase:not(.b-eventeditor-editing):not(.b-resizing-event):not(.b-dragcreating):not(.b-dragging-event):not(.b-creating-dependency) .${i.baseCls}`,forElement:i.client.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:0,anchorToTarget:!1,textContent:!1,trackMouse:!1,getHtml:i.getHoverTipHtml.bind(i)},e):null}getHoverTipHtml({activeTarget:e}){return this.tooltipTemplate(this.resolveDependencyRecord(e))}},"$name","DependencyTooltip"),s(t,"configurable",{showTooltip:!0,tooltipTemplate(e){return{children:[{className:"b-sch-dependency-tooltip",children:[{tag:"label",text:this.L("L{Dependencies.from}")},{text:e.fromEvent.name},{className:`b-sch-box b-${e.fromSide||Ie[e.type]}`},{tag:"label",text:this.L("L{Dependencies.to}")},{text:e.toEvent.name},{className:`b-sch-box b-${e.toSide||Ve[e.type]}`}]}]}},tooltip:{$config:"nullify",value:{}}}),t};const We={click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu"},_e=e=>{var t;const i=[e];return null!==(t=e.resource)&&void 0!==t&&t.hasLinks&&i.push(...e.resource.$links.map((t=>({id:`${t.id}_${e.id}`,resource:t,event:e.event,drawDependencies:e.drawDependencies})))),i};class je extends(y.mixin(J,k,Ee,Re,Oe,$e)){constructor(...e){super(...e),s(this,"domConfigs",new Map),s(this,"drawingLive",!1),s(this,"lastScrollX",null),s(this,"highlighted",new Map),s(this,"visibleResources",null),s(this,"usingLinks",null),s(this,"visibleDateRange",null),s(this,"relativeTo",null)}static get pluginConfig(){return{chain:["render","onPaint","onElementClick","onElementDblClick","onElementContextMenu","onElementMouseOver","onElementMouseOut","bindStore"],assign:["getElementForDependency","getElementsForDependency","resolveDependencyRecord"]}}construct(e,t){super.construct(e,t);const{scheduledEventName:i}=e;e.ion({svgCanvasCreated:"onSVGReady",animationStart:"refresh",[i+"DragStart"]:"refresh",[i+"ResizeStart"]:"refresh",[i+"SegmentDragStart"]:"refresh",[i+"SegmentResizeStart"]:"refresh",timelineViewportResize:"reset",timeAxisViewModelUpdate:"reset",toggleNode:"reset",thisObj:this}),e.rowManager.ion({refresh:"reset",changeTotalHeight:"reset",thisObj:this}),this.bindStore(e.store)}doDisable(e){this.isConfiguring||(this._isDisabling=e,this.draw(),this._isDisabling=!1),super.doDisable(e)}get rowStore(){return this.client.isVertical?this.client.resourceStore:this.client.store}bindStore(e){const t=this;t.client.isVertical||(t.detachListeners("store"),t.client.usesDisplayStore&&(null==e||e.ion({name:"store",refresh:"onStoreRefresh",thisObj:t}),t.reset()))}onStoreRefresh(){this.reset()}attachToProject(e){super.attachToProject(e),null==e||e.ion({name:"project",commitFinalized:"reset",thisObj:this})}attachToResourceStore(e){super.attachToResourceStore(e),null==e||e.ion({name:"resourceStore",change:"onResourceStoreChange",refresh:"onResourceStoreChange",thisObj:this})}onResourceStoreChange(){this.usingLinks=null,this.reset()}attachToEventStore(e){super.attachToEventStore(e),null==e||e.ion({name:"eventStore",refresh:"reset",thisObj:this})}attachToAssignmentStore(e){super.attachToAssignmentStore(e),null==e||e.ion({name:"assignmentStore",refresh:"reset",thisObj:this})}attachToDependencyStore(e){super.attachToDependencyStore(e),null==e||e.ion({name:"dependencyStore",change:"reset",refresh:"reset",thisObj:this})}updateDrawOnScroll(e){const t=this;t.detachListeners("scroll"),e?t.client.ion({name:"scroll",scroll:"doRefresh",horizontalScroll:"onHorizontalScroll",prio:-100,thisObj:t}):(t.client.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:t}),t.client.timeAxisSubGrid.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:t}))}onHorizontalScroll({subGrid:e,scrollX:t}){t!==this.lastScrollX&&e===this.client.timeAxisSubGrid&&(this.lastScrollX=t,this.draw())}onPaint(){this.refresh()}static getLocalizedDependencyType(e){return e?this.L(`L{DependencyType.${e}}`):""}getElementForDependency(e,t,i){return this.getElementsForDependency(e,t,i)[0]}getElementsForDependency(e,t,i){let n=`[data-dep-id="${e.id}"]`;return t&&(n+=`[data-from-id="${t.id}"]`),i&&(n+=`[data-to-id="${i.id}"]`),Array.from(this.client.svgCanvas.querySelectorAll(n))}resolveDependencyRecord(e){var t;return null===(t=e.elementData)||void 0===t?void 0:t.dependency}isDependencyElement(e){return e.matches(`.${this.baseCls}`)}onElementClick(e){const t=this.resolveDependencyRecord(e.target);if(t){const i=We[e.type];this.client.trigger(`dependency${i}`,{dependency:t,event:e})}}onElementDblClick(e){return this.onElementClick(e)}onElementContextMenu(e){return this.onElementClick(e)}onElementMouseOver(e){const t=this,i=t.resolveDependencyRecord(e.target);i&&(t.client.trigger("dependencyMouseOver",{dependency:i,event:e}),t.overCls&&t.highlight(i))}onElementMouseOut(e){const t=this,i=t.resolveDependencyRecord(e.target);i&&(t.client.trigger("dependencyMouseOut",{dependency:i,event:e}),t.overCls&&t.unhighlight(i))}isDependencyVisible(e){const{rowStore:t}=this,{fromEvent:i,toEvent:n}=e;if(!i||!n)return!1;const r=i.resource,a=n.resource;return!(!t.isAvailable(r)||!t.isAvailable(a))&&(i.isModel&&!r.instanceMeta(t).hidden&&!a.instanceMeta(t).hidden)}updateHighlightDependenciesOnEventHover(e){const t=this;if(e){const{client:e}=t;e.ion({name:"highlightOnHover",[`${e.scheduledEventName}MouseEnter`]:e=>t.highlightEventDependencies(e.eventRecord||e.taskRecord),[`${e.scheduledEventName}MouseLeave`]:e=>t.unhighlightEventDependencies(e.eventRecord||e.taskRecord),thisObj:t})}else t.detachListeners("highlightOnHover")}highlight(e,t=this.overCls){let i=this.highlighted.get(e);i||this.highlighted.set(e,i=new Set),i.add(t),this.lineCache={},this.refresh()}unhighlight(e,t=this.overCls){const i=this.highlighted.get(e);i&&(i.delete(t),i.size||this.highlighted.delete(e)),this.lineCache={},this.refresh()}highlightEventDependencies(e,t){e.dependencies.forEach((e=>this.highlight(e,t)))}unhighlightEventDependencies(e,t){e.dependencies.forEach((e=>this.unhighlight(e,t)))}getDependenciesToConsider(e,t,i,n){var r,a;return null!==(r=null===(a=super.getDependenciesToConsider)||void 0===a?void 0:a.call(this,e,t,i,n))&&void 0!==r?r:this.project.dependencyStore.records.filter((e=>e.isValid))}getDependencyKey(e,t,i){return`dep:${e.id};from:${t.id};to:${i.id}`}drawDependency(e,t=!1,i=null){var n,r;const a=this,{domConfigs:s,client:o,rowStore:l,topIndex:d,bottomIndex:c}=a,{eventStore:u,useInitialAnimation:h}=o,{idMap:g}=l,{startMS:m,endMS:p}=a.visibleDateRange,{fromEvent:v,toEvent:f}=e;let D=v.assigned,b=f.assigned;if(v.isScheduled&&f.isScheduled&&u.includes(v)&&u.includes(f)&&null!==(n=D)&&void 0!==n&&n.size&&null!==(r=b)&&void 0!==r&&r.size){a.usingLinks&&(D=[...D].flatMap(_e),b=[...b].flatMap(_e));for(const t of D)for(const n of b){var S,w,C,y;const r=null===(S=g[null===(w=t.resource)||void 0===w?void 0:w.id])||void 0===S?void 0:S.index,u=null===(C=g[null===(y=n.resource)||void 0===y?void 0:y.id])||void 0===C?void 0:C.index,D=Math.min(v.startDateMS,f.startDateMS),b=Math.max(v.endDateMS,f.endDateMS);if(o.isExporting||null!=r&&null!=u&&!1!==t.drawDependencies&&!1!==n.drawDependencies&&l.isAvailable(t.resource)&&l.isAvailable(n.resource)&&!(r<d&&u<d||r>c&&u>c||D<m&&b<m||D>p&&b>p)){const o=a.getDependencyKey(e,t,n),l=a.getDomConfigs(e,t,n,i);l?(h&&(l[0].style={animationDelay:Math.max(r,u)/20*1e3+"ms"}),s.set(o,l)):s.delete(o)}a.afterDrawDependency(e,r,u,D,b)}}t||a.domSync()}afterDrawDependency(e,t,i,n,r){var a;null===(a=super.afterDrawDependency)||void 0===a||a.call(this,e,t,i,n,r)}beforeDraw(){var e;null===(e=super.beforeDraw)||void 0===e||e.call(this)}afterDraw(){var e;null===(e=super.afterDraw)||void 0===e||e.call(this)}domSync(e=this.client.svgCanvas){h.sync({targetElement:e,domConfig:{onlyChildren:!0,children:Array.from(this.domConfigs.values()).flat()},syncIdField:"syncId",releaseThreshold:0,strict:!0,callback(){}})}fillDrawingCache(){const e=this,{client:t}=e;e.relativeTo=E.from(t.foregroundCanvas),e.visibleResources=t.visibleResources,e.visibleDateRange=t.visibleDateRange,e.topIndex=e.rowStore.indexOf(e.visibleResources.first),e.bottomIndex=e.rowStore.indexOf(e.visibleResources.last),null==e.usingLinks&&(e.usingLinks=t.resourceStore.some((e=>e.hasLinks)))}draw(){const e=this,{client:t}=e;if(!t.refreshSuspended&&t.foregroundCanvas&&t.isEngineReady&&(!e.disabled||e._isDisabling)&&!t.isExporting){if(e.fillDrawingCache(),e.domConfigs.clear(),t.firstVisibleRow&&t.lastVisibleRow&&t.timeAxis.count&&!e.disabled&&e.visibleDateRange.endMS-e.visibleDateRange.startMS>0){const{visibleDateRange:i}=t,{topIndex:n,bottomIndex:r}=e,a=e.getDependenciesToConsider(i.startMS,i.endMS,n,r);e.beforeDraw();for(const t of a)e.drawDependency(t,!0);e.afterDraw()}e.domSync(),t.trigger("dependenciesDrawn")}}doRefresh(){var e,t,i,n;const r=this,{client:a}=r,{scheduledEventName:s}=a;r.draw(),r.drawingLive=a.isAnimating||a.useInitialAnimation||(null===(e=a.features[`${s}Drag`])||void 0===e?void 0:e.isActivelyDragging)||(null===(t=a.features[`${s}Resize`])||void 0===t?void 0:t.isResizing)||(null===(i=a.features[`${s}SegmentDrag`])||void 0===i?void 0:i.isActivelyDragging)||(null===(n=a.features[`${s}SegmentResize`])||void 0===n?void 0:n.isResizing),r.drawingLive&&r.refresh()}refresh(){this.client.refreshSuspended||this.disabled||!this.client.isPainted||this.doRefresh()}reset(){var e;null===(e=super.reset)||void 0===e||e.call(this),this.refresh()}drawForEvent(){M.deprecate("Scheduler","6.0.0","Dependencies.drawForEvent() is no longer needed"),this.refresh()}render(){this.client.getConfig("svgCanvas")}}s(je,"$name","Dependencies"),s(je,"configurable",{overCls:"b-sch-dependency-over",baseCls:"b-sch-dependency",noMarkerCls:"b-sch-dependency-markerless",markerDef:null,radius:null,renderer:null,highlightDependenciesOnEventHover:null,drawOnScroll:!0,clickWidth:null}),s(je,"delayable",{doRefresh:10}),je._$name="Dependencies",W.registerFeature(je,!1,["Scheduler","ResourceHistogram"]),W.registerFeature(je,!0,"SchedulerPro");class Be extends y{static get $name(){return"EventFilter"}static get pluginConfig(){return{chain:["populateTimeAxisHeaderMenu"]}}populateTimeAxisHeaderMenu({items:e}){const t=this;e.eventsFilter={text:"L{filterEvents}",icon:"b-fw-icon b-icon-filter",disabled:t.disabled,localeClass:t,weight:100,menu:{type:"popup",localeClass:t,items:{nameFilter:{weight:110,type:"textfield",cls:"b-eventfilter b-last-row",clearable:!0,keyStrokeChangeDelay:300,label:"L{byName}",localeClass:t,width:200,internalListeners:{change:t.onEventFilterChange,thisObj:t}}},onBeforeShow({source:e}){const[i]=e.items,n=t.store.filters.getBy("property","name");i.value=(null==n?void 0:n.value)||""}}}}onEventFilterChange({value:e}){""!==e?this.store.filter("name",e):this.store.removeFilter("name")}get store(){const{client:e}=this;return e.isGanttBase?e.store:e.eventStore}}Be.featureClass="b-event-filter",Be._$name="EventFilter",W.registerFeature(Be,!0,["Scheduler","Gantt"]),W.registerFeature(Be,!1,"ResourceHistogram");var Ue=e=>{var t;return s(t=class extends e{getNonWorkingTimeRanges(e,t,i){if(!e.getNonWorkingTimeRanges){const n=[];return e.forEachAvailabilityInterval({startDate:t,endDate:i,isForward:!0},((e,t,i)=>{for(const[r,a]of i.intervalGroups)a.getIsWorking()||n.push({name:r.name,iconCls:r.iconCls,cls:r.cls,startDate:e,endDate:t})})),n}return e.getNonWorkingTimeRanges(t,i)}getCalendarTimeRanges(e,t=!1){const i=this,{timeAxis:r,fillTicks:a}=i.client,{unit:s,increment:o}=r,d=!i.maxTimeAxisUnit||l.compareUnits(s,i.maxTimeAxisUnit)<=0;if(e&&d&&r.count){const d=i.getNonWorkingTimeRanges(e,r.startDate,r.endDate).map((e=>new n({name:e.name,cls:`b-nonworkingtime ${e.cls||""}`,startDate:e.startDate,endDate:e.endDate}))),c=[];let u=null;for(const e of d)u&&e.startDate<=u.endDate&&(t||e.name===u.name)&&e.duration>0?u.endDate=e.endDate:(c.push(e),e.id=`nonworking-${c.length}`,u=e);return a&&c.forEach((e=>{e.setStartEndDate(l.ceil(e.startDate,{magnitude:o,unit:s}),l.floor(e.endDate,{magnitude:o,unit:s}))})),c}return[]}setupDefaultCalendar(){const{client:e,project:t}=this;this.autoGeneratedWeekends||e.isSchedulerPro||e.isGantt||t.effectiveCalendar!==t.defaultCalendar||t.defaultCalendar.intervalStore.count||(this.autoGeneratedWeekends=!0,this.updateDefaultCalendar())}updateDefaultCalendar(){if(this.autoGeneratedWeekends){const e=this.client.project.effectiveCalendar,t=this.defaultNonWorkingIntervals,i=Boolean(t.length);e.clearIntervals(i),i&&e.addIntervals(t)}}updateLocalization(){var e;null===(e=super.updateLocalization)||void 0===e||e.call(this),this.autoGeneratedWeekends&&this.updateDefaultCalendar()}get defaultNonWorkingIntervals(){const e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return l.nonWorkingDaysAsArray.map((t=>({recurrentStartDate:`on ${e[t]} at 0:00`,recurrentEndDate:`on ${e[(t+1)%7]} at 0:00`,isWorking:!1})))}},"$name","NonWorkingTimeMixin"),s(t,"configurable",{maxTimeAxisUnit:"week"}),t};class Ne extends(ye.mixin(J,Ue)){static get defaultConfig(){return{highlightWeekends:null,hideRangesOnZooming:!0,showHeaderElements:!0,showLabelInBody:!0,autoGeneratedWeekends:!1}}doDestroy(){this.attachToCalendar(null),super.doDestroy()}set highlightWeekends(e){M.deprecate("Scheduler","6.0.0","Deprecated in favour of disabling the feature"),this.disabled=!e}get highlightWeekends(){return!this.disabled}onConfigChange({name:e}){this.isConfiguring||"fillTicks"!==e||this.refresh()}attachToProject(e){super.attachToProject(e),this.attachToCalendar(e.effectiveCalendar),e.graph||this.client.isScheduler||e.ion({name:"project",dataReady:{fn:()=>this.attachToCalendar(e.effectiveCalendar),once:!0},thisObj:this}),e.ion({name:"project",calendarChange:()=>this.attachToCalendar(e.effectiveCalendar),thisObj:this})}onTimeAxisViewModelUpdate(...e){return this._timeAxisUnitDurationMs=null,super.onTimeAxisViewModelUpdate(...e)}attachToCalendar(e){const t=this,{project:i,client:n}=t;t.detachListeners("calendar"),t.autoGeneratedWeekends=!1,e&&(t.setupDefaultCalendar(),e.intervalStore.ion({name:"calendar",change:()=>t.setTimeout((()=>t.refresh()),1)})),!n.isEngineReady||n.project.isDelayingCalculation||n.isDestroying?i.isDestroyed||(t.detachListeners("initialProjectListener"),i.ion({name:"initialProjectListener",refresh({isCalculated:e}){!1!==e&&(t.refresh(),t.detachListeners("initialProjectListener"))},thisObj:t})):t.refresh()}get calendar(){var e;return null===(e=this.project)||void 0===e?void 0:e.effectiveCalendar}get timeAxisUnitDurationMs(){return this._timeAxisUnitDurationMs||(this._timeAxisUnitDurationMs=l.as("ms",1,this.client.timeAxis.unit)),this._timeAxisUnitDurationMs}shouldRenderRange(e){return super.shouldRenderRange(e)&&(!this.hideRangesOnZooming||e.durationMS>=this.timeAxisUnitDurationMs)}get timeRanges(){const e=this;return e._timeRanges||(e._timeRanges=e.getCalendarTimeRanges(e.calendar)),e._timeRanges}}s(Ne,"$name","NonWorkingTime"),s(Ne,"pluginConfig",{chain:["onPaint","attachToProject","updateLocalization","onConfigChange","onSchedulerHorizontalScroll"]}),Ne._$name="NonWorkingTime",W.registerFeature(Ne,!1,"Scheduler"),W.registerFeature(Ne,!0,["SchedulerPro","Gantt","ResourceHistogram"]);class Ge extends y{static get $name(){return"ScheduleTooltip"}static get configurable(){return{messageTemplate:e=>`<div class="b-sch-hovertip-msg">${e.message}</div>`,hideForNonWorkingTime:null}}static get pluginConfig(){return{chain:["onPaint"]}}onPaint({firstPaint:e}){if(!e)return;const t=this,{client:i}=t;let n;i.isSchedulerPro&&void 0===t.hideForNonWorkingTime&&(t.hideForNonWorkingTime=!0);const r=t.hoverTip=new T(u(u({id:`${i.id}-schedule-tip`,cls:"b-sch-scheduletip",allowOver:!0,hoverDelay:0,hideDelay:100,showOnHover:!0,forElement:i.timeAxisSubGridElement,anchorToTarget:!1,trackMouse:!0,updateContentOnMouseMove:!0,monitorResize:!1,textContent:!1,forSelector:".b-schedulerbase:not(.b-dragging-event):not(.b-dragcreating) .b-grid-body-container:not(.b-scrolling) .b-timeline-subgrid:not(.b-scrolling) > :not(.b-sch-foreground-canvas):not(.b-group-footer):not(.b-group-row) *",constrainTo:null,getHtml:t.getHoverTipHtml.bind(t),onDocumentMouseDown(e){r.forElement.contains(e.event.target)&&(n=g.on({thisObj:t,element:i.timeAxisSubGridElement,mousemove:e=>r.internalOnPointerOver(e),capture:!0}));const a=r.hideAnimation;r.hideAnimation=!1,r.constructor.prototype.onDocumentMouseDown.call(r,e),r.hideAnimation=a}},t.config),{},{internalListeners:t.configuredListeners}));r.ion({pointerover({event:e}){const i="buttons"in e?e.buttons>0:e.which>0;return!i&&n&&n(),!t.disabled&&!i},innerhtmlupdate({source:e}){t.clockTemplate.updateDateIndicator(e.element,t.lastTime)}}),i.ion({timeAxisViewModelUpdate:"updateTip",thisObj:t}),t.clockTemplate=new K({scheduler:i})}processConfiguredListeners(){}updateTip(){this.hoverTip.isVisible&&this.hoverTip.updateContent()}doDestroy(){this.destroyProperties("clockTemplate","hoverTip"),super.doDestroy()}getHoverTipHtml({tip:e,event:t}){const i=this,n=i.client,r=t&&n.getDateFromDomEvent(t,"floor",!0);let a=i.lastHtml;if(r&&t.target){const s=n.resolveResourceRecord(t);if(s&&(r-i.lastTime!=0||s.id!==i.lastResourceId)){if(i.hideForNonWorkingTime){const t=s.isWorkingTime(r);e.element.classList.toggle("b-nonworking-time",!t)}i.lastResourceId=s.id,a=i.lastHtml=i.generateTipContent({date:r,event:t,resourceRecord:s})}}else e.hide(),i.lastTime=null,i.lastResourceId=null;return a}generateTipContent({date:e,event:t,resourceRecord:i}){const n=this,r=n.clockTemplate.generateContent({date:e,text:n.client.getFormattedDate(e)}),a=n.messageTemplate({message:n.getText(e,t,i)||""});return n.lastTime=e,r+a}getText(e,t,i){}}Ge.featureClass="b-scheduletip",Ge._$name="ScheduleTooltip",W.registerFeature(Ge,!0,"Scheduler"),W.registerFeature(Ge,!1,"ResourceUtilization");const Ye={maintainVisibleStart:!0};class Xe extends _{static get $name(){return"TimeAxisHeaderMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"timeAxisHeader"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateTimeAxisHeaderMenu"),e}construct(){super.construct(...arguments),this.triggerEvent.includes("click")&&this.client.zoomOnTimeAxisDoubleClick&&(this.client.zoomOnTimeAxisDoubleClick=!1)}shouldShowMenu(e){const{column:t}=e;return t&&!1!==t.enableHeaderContextMenu&&t===this.client.timeAxisColumn}showContextMenu(e){super.showContextMenu(...arguments),this.menu&&(this.menu.scrollAction="realign")}populateTimeAxisHeaderMenu({items:e}){const t=this,{client:i}=t,n={magnitude:i.timeAxis.shiftIncrement,unit:i.timeAxis.shiftUnit};Object.assign(e,{zoomLevel:{text:"L{pickZoomLevel}",localeClass:t,icon:"b-fw-icon b-icon-search-plus",disabled:!i.presets.count||t.disabled,weight:200,menu:{type:"popup",items:{zoomSlider:{weight:210,type:"slider",minWidth:130,showValue:!1}},onBeforeShow({source:e}){const[n]=e.items;n.min=i.minZoomLevel,n.max=i.maxZoomLevel,n.value=i.zoomLevel,t.zoomDetatcher=n.ion({input:"onZoomSliderChange",thisObj:t})},onHide(){t.zoomDetatcher&&(t.zoomDetatcher(),t.zoomDetatcher=null)}}},dateRange:{text:"L{activeDateRange}",localeClass:t,icon:"b-fw-icon b-icon-calendar",weight:300,menu:{type:"popup",cls:"b-sch-timeaxis-menu-daterange-popup",defaults:{localeClass:t},items:{startDateField:{type:"datefield",label:"L{startText}",weight:310,labelWidth:"6em",required:!0,step:n,internalListeners:{change:t.onRangeDateFieldChange,thisObj:t}},endDateField:{type:"datefield",label:"L{endText}",weight:320,labelWidth:"6em",required:!0,step:n,internalListeners:{change:t.onRangeDateFieldChange,thisObj:t}},leftShiftBtn:{type:"button",weight:330,cls:"b-left-nav-btn",icon:"b-icon b-icon-previous",color:"b-blue b-raised",flex:1,margin:0,internalListeners:{click:t.onLeftShiftBtnClick,thisObj:t}},todayBtn:{type:"button",weight:340,cls:"b-today-nav-btn",color:"b-blue b-raised",text:"L{todayText}",flex:4,margin:"0 8",internalListeners:{click:t.onTodayBtnClick,thisObj:t}},rightShiftBtn:{type:"button",weight:350,cls:"b-right-nav-btn",icon:"b-icon b-icon-next",color:"b-blue b-raised",flex:1,internalListeners:{click:t.onRightShiftBtnClick,thisObj:t}}},internalListeners:{paint:t.initDateRangeFields,thisObj:t}}}})}onZoomSliderChange({value:e}){const t=this;t.menu.scrollAction="realign",t.client.zoomLevel=e,t.menu.setTimeout({fn:()=>t.menu.scrollAction="hide",delay:100,cancelOutstanding:!0})}initDateRangeFields({source:e,firstPaint:t}){if(t){const{widgetMap:t}=e;this.startDateField=t.startDateField,this.endDateField=t.endDateField}this.initDates()}initDates(){const e=this;e.startDateField.suspendEvents(),e.endDateField.suspendEvents(),e.startDateField.value=e.startDateFieldInitialValue=e.client.startDate,e.endDateField.value=e.endDateFieldInitialValue=e.client.endDate,e.startDateField.resumeEvents(),e.endDateField.resumeEvents()}onRangeDateFieldChange({source:e}){const t=this,i=e===t.startDateField,{client:n}=t,{timeAxis:r}=n,a=t.startDateFieldInitialValue&&!i?t.startDateFieldInitialValue:t.startDateField.value;let s=t.endDateFieldInitialValue&&i?t.endDateFieldInitialValue:t.endDateField.value;i?t.startDateFieldInitialValue=null:t.endDateFieldInitialValue=null,s-a?s<a&&(s=l.add(a,r.shiftIncrement,r.shiftUnit)):s=l.add(s,r.shiftIncrement,r.shiftUnit),n.setTimeSpan(a,s,Ye),t.initDates()}onLeftShiftBtnClick(){this.client.timeAxis.shiftPrevious(),this.initDates()}onTodayBtnClick(){const e=l.clearTime(new Date);this.client.setTimeSpan(e,l.add(e,1,"day")),this.initDates()}onRightShiftBtnClick(){this.client.timeAxis.shiftNext(),this.initDates()}}Xe._$name="TimeAxisHeaderMenu",W.registerFeature(Xe,!0,["Scheduler","Gantt"]),W.registerFeature(Xe,!1,"ResourceHistogram");class Ze extends(f()){static get defaultConfig(){return{timeAxis:null,availableSpace:null,tickSize:100,snap:!1,forceFit:!1,headers:null,mode:"horizontal",suppressFit:!1,columnConfig:[],viewPreset:null,columnLinesFor:null,originalTickSize:null,headersDatesCache:[]}}construct(e){const t=this;t.unitToPixelsCache={},super.construct(e);const i=t.timeAxis.viewPreset||t.viewPreset;if(i)if(i instanceof he)t.consumeViewPreset(i);else{const e=me.getPreset(i);e&&t.consumeViewPreset(e)}t.timeAxis.ion({reconfigure:"onTimeAxisReconfigure",thisObj:t}),t.configured=!0}doDestroy(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this),super.doDestroy()}calculateInfiniteScrollingDateRange(e,t,i=this.viewPreset){const{timeAxis:n,availableSpace:r}=this,{bufferCoef:a}=this.owner,{leafUnit:s,leafIncrement:o,tickSize:d}=i;if(t){const t=Math.ceil((r*a+r/2)/d);return{startDate:n.floorDate(l.add(e,-t*o,s),!1,s,o),endDate:n.ceilDate(l.add(e,t*o,s),!1,s,o)}}{const t=Math.ceil(r*a/d);return{startDate:n.floorDate(l.add(e,-t*o,s),!1,s,o),endDate:n.ceilDate(l.add(e,Math.ceil((r/d+t)*o),s),!1,s,o)}}}get columnConfig(){return this._columnConfig}set columnConfig(e){this._columnConfig=e}get headers(){return this._headers}set headers(e){if(e&&e.length&&e[e.length-1].cellGenerator)throw new Error("`cellGenerator` cannot be used for the bottom level of your headers. Use TimeAxis#generateTicks() instead.");this._headers=e}get isTimeAxisViewModel(){return!0}get isHorizontal(){return"vertical"!==this.mode}get isVertical(){return"vertical"===this.mode}set forceFit(e){e!==this._forceFit&&(this._forceFit=e,this.update())}reconfigure(e){this.headers=null,this.setConfig(e),this.trigger("reconfigure")}onTimeAxisReconfigure({source:e,suppressRefresh:t}){this.viewPreset!==e.viewPreset&&this.consumeViewPreset(e.viewPreset),t||this.update()}update(e,t=!1,i=!1){const n=this,{timeAxis:r,headers:a}=n;if(n.isConfiguring||n._availableSpace===e)return void(i&&n.trigger("update"));if(n._availableSpace=Math.max(e||n.availableSpace||0,0),"number"!=typeof n.availableSpace)throw new Error("Invalid available space provided to TimeAxisModel");n.columnConfig=[];const s=n._tickSize=n.calculateTickSize(n.originalTickSize);if("number"!=typeof s||s<=0)throw new Error("Invalid timeAxis tick size");n.unitToPixelsCache={},n._totalSize=null;for(let e=0,{length:t}=a;e<t;e++){const t=a[e];if(t.cellGenerator){const i=t.cellGenerator.call(n,r.startDate,r.endDate);n.columnConfig[e]=n.createHeaderRow(e,t,i)}else n.columnConfig[e]=n.createHeaderRow(e,t)}t||n.trigger("update")}getDistanceBetweenDates(e,t){return this.getPositionFromDate(t)-this.getPositionFromDate(e)}getDistanceForDuration(e){return this.getSingleUnitInPixels("millisecond")*e}getPositionFromDate(e,t={}){const i=this.getScaledTick(e,t);return-1===i?-1:this.tickSize*(i-this.timeAxis.visibleTickStart)}getScaledTick(e,{respectExclusion:t,snapToNextIncluded:i,isEnd:n,min:r,max:a}){const{timeAxis:s}=this,{include:o,unit:d}=s;let c=s.getTickFromDate(e);if(-1!==c&&t&&o){let t=!1;if(o.hour&&l.compareUnits(d,"hour")>0&&"day"!==d){const{from:n,to:r,lengthFactor:a,center:s}=o.hour,d=e.getHours(),c=Math.min(Math.max(d,n),r);if(!i&&c!==d)return-1;const u=s-(s-(c+e.getMinutes()/60))*a;e=l.add(e,u-d,"h"),t=!0}if(o.day&&l.compareUnits(d,"day")>0){const{from:d,to:c,lengthFactor:u,center:h}=o.day;let g=e.getDay();n&&0===e.getHours()&&0===e.getMinutes()&&0===e.getSeconds()&&0===e.getMilliseconds()&&--g<0&&(g=6);let m=0;if(g<d||g>=c){if(!i)return-1;if(m=n?(c-g-8)%7:(d-g+7)%7,e=l.add(e,m,"d"),e=l.startOf(e,"d",!1),a&&e.getTime()>=a||r&&e.getTime()<=r)return-1}const{weekStartDay:p}=s,v=0===e.getDay()?0:h,f=e.getDay()+e.getHours()/24,D=v-(v-f)*u;e=l.add(e,D-f+p,"d"),t=!0}t&&(e=l.constrain(e,s.startDate,s.endDate),c=s.getTickFromDate(e))}return c}getDateFromPosition(e,t,i=!1){const n=this,{timeAxis:r}=n,a=n.getScaledPosition(e)/n.tickSize+r.visibleTickStart;if(a<0||a>r.count){if(i){let e;return e=a<0?l.add(r.startDate,a,r.unit):l.add(r.endDate,a-r.count,r.unit),t&&(e=r[t+"Date"](e)),e}return null}return r.getDateFromTick(a,t)}getScaledPosition(e){const{include:t,unit:i,weekStartDay:n}=this.timeAxis;if(t){const r=this.getSingleUnitInPixels("day");if(t.day&&l.compareUnits(i,"day")>0){const{from:i,lengthFactor:a}=t.day,s=e%(7*r);e=s/a+(i-n)*r+(e-s)}if(t.hour&&l.compareUnits(i,"hour")>0&&"day"!==i){const{from:i,lengthFactorExcl:n}=t.hour,a=e%r;e=a/n+i*this.getSingleUnitInPixels("hour")+(e-a)}}return e}getSingleUnitInPixels(e){const t=this;return t.unitToPixelsCache[e]||(t.unitToPixelsCache[e]=l.getUnitToBaseUnitRatio(t.timeAxis.unit,e,!0)*t.tickSize/t.timeAxis.increment)}get snapPixelAmount(){if(this.snap){const{resolution:e}=this.timeAxis;return(e.increment||1)*this.getSingleUnitInPixels(e.unit)}return 1}get tickSize(){return this._tickSize}set tickSize(e){this.setTickSize(e,!1)}setTickSize(e,t){this._tickSize=this.originalTickSize=e,this.update(void 0,t)}get timeResolution(){return this.timeAxis.resolution}calculateTickSize(e){const t=this,{forceFit:i,timeAxis:n,suppressFit:r}=t,a=n.unit;let s=0,o=1;if(t.snap){const e=n.resolution;o=l.getUnitToBaseUnitRatio(a,e.unit)*e.increment}if(r)s=e;else{const r=t.availableSpace/n.visibleTickTimeSpan;s=i||e<r?r:e,o>0&&(!i||o<1)&&(s=Math.max(1,o*s)/o)}return s}get totalSize(){return this._totalSize||(this._totalSize=Math.floor(this.tickSize*this.timeAxis.visibleTickTimeSpan))}get availableSpace(){return this._availableSpace}set availableSpace(e){const t=this;if(t._availableSpace=Math.max(0,e),t._availableSpace>0){const e=t.calculateTickSize(t.originalTickSize);e>0&&e!==t.tickSize&&t.update()}}getDates(e=this.columnLinesFor,t=!1,i=!1){const n=this,r=[],a=t?n.lowestHeader:e,s=n.majorHeaderLevel,o=n.headers&&n.headers[e].unit,d=null!=s&&n.headers&&n.headers[s].unit,c=null!=s&&l.doesUnitsAlign(d,o);if(!(!n.headers||!n.headers[a].cellGenerator)){const e=n.columnConfig[a];for(let t=1,i=e.length;t<i;t++)r.push({date:e[t].startDate})}else n.forEachInterval(a,((t,a)=>{r.push({date:i?a:t,isMajor:s!==e&&c&&n.isMajorTick(i?a:t)})}));return r}get forceFit(){return this._forceFit}fitToAvailableSpace(e){const t=Math.floor(this.availableSpace/this.timeAxis.visibleTickTimeSpan);this.setTickSize(t,e)}get snap(){return this._snap}set snap(e){e!==this._snap&&(this._snap=e,this.configured&&this.update())}createHeaderRow(e,t,i){const n=this,r=[],{align:a,headerCellCls:s=""}=t,o=l.clearTime(new Date),{timeAxis:d}=n,c=n.headers.length-1,u=(i,u,g,m,p)=>{let v=l.format(i,t.dateFormat);const f=g>0&&!m,D={align:a,start:i,end:u,value:p?p.header:v,headerCellCls:s,width:c===e&&n.owner&&(d.fullTicks||f)?n.owner.tickSize:n.getDistanceBetweenDates(i,u),index:g};0!==D.width&&(D.coord=h-1,h+=D.width,n.headersDatesCache[e][i.getTime()]=1,t.renderer&&(v=t.renderer.call(t.thisObj||n,i,u,D,g),D.value=null==v?"":v),"day"!==t.unit||t.increment&&1!==t.increment||(D.headerCellCls+=" b-sch-dayheadercell-"+i.getDay(),l.clearTime(i,!0)-o==0&&(D.headerCellCls+=" b-sch-dayheadercell-today")),r.push(D))};let h=0;return n.headersDatesCache[e]={},i?i.forEach(((e,t)=>u(e.start,e.end,t,t===i.length-1,e))):n.forEachInterval(e,u),r}get mainHeader(){return"mainHeaderLevel"in this?this.headers[this.mainHeaderLevel]:this.bottomHeader}get bottomHeader(){return this.headers[this.headers.length-1]}get lowestHeader(){return this.headers.length-1}get majorHeaderLevel(){const{headers:e}=this;return e?Math.max(e.length-2,0):null}isMajorTick(e){const t=this.majorHeaderLevel;return null!=t&&this.headersDatesCache[t]&&this.headersDatesCache[t][e.getTime()]||!1}forEachInterval(e,t,i=this){const{headers:n,timeAxis:r}=this;if(n)if(e===n.length-1)r.forEach(((e,n)=>t.call(i,e.startDate,e.endDate,n,n===r.count-1)));else{const a=n[e];r.forEachAuxInterval(a.unit,a.increment,t,i)}}forEachMainInterval(e,t){this.forEachInterval(this.mainHeaderLevel,e,t)}consumeViewPreset(e){const t=this;t.headers=null,t.getConfig("tickSize"),t.viewPreset=e,Object.assign(t,{headers:e.headers,columnLinesFor:e.columnLinesFor,mainHeaderLevel:e.mainHeaderLevel,_tickSize:t.isHorizontal?e.tickWidth:e.tickHeight}),t.originalTickSize=t.tickSize}}Ze._$name="TimeAxisViewModel";const qe=new Date;var Ke=e=>{var t;return s(t=class extends(e||A){getRtlX(e){return this.rtl&&this.isHorizontal&&(e=this.timeAxisViewModel.totalSize-e),e}getDateFromCoordinate(e,t,i=!0,n=!1,r=!1){return i||(e=this.currentOrientation.translateToScheduleCoordinate(e)),r||(e=this.getRtlX(e)),this.timeAxisViewModel.getDateFromPosition(e,t,n)}getDateFromCoord(e){return this.getDateFromCoordinate(e.coord,e.roundingMethod,e.local,e.allowOutOfRange,e.ignoreRTL)}getDateFromXY(e,t,i=!0,n=!1){return this.currentOrientation.getDateFromXY(e,t,i,n)}getDateFromDomEvent(e,t,i=!1){return this.getDateFromXY([e.pageX,e.pageY],t,!1,i)}getStartEndDatesFromRectangle(e,t,i,n=!1){const r=this,{isHorizontal:a}=r,s=a?e.x:e.top,o=a?e.right:e.bottom;let d,c;return s>=0&&o<r.timeAxisViewModel.totalSize?(d=r.getDateFromCoordinate(s,t,!0),c=r.getDateFromCoordinate(o,t,!0)):s<0?(c=r.getDateFromCoordinate(o,t,!0,n),d=c&&l.add(c,-i,"ms")):(d=r.getDateFromCoordinate(s,t,!0,n),c=d&&l.add(d,i,"ms")),{start:d,end:c}}get displayDateFormat(){return this._displayDateFormat}set displayDateFormat(e){this._displayDateFormat=e,this.trigger("displayDateFormatChange",{format:e})}getFormattedDate(e){return l.format(e,this.displayDateFormat)}getDisplayEndDate(e,t){return 0!==e.getHours()||0!==e.getMinutes()||t&&e.getYear()===t.getYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()||l.formatContainsHourInfo(this.displayDateFormat)||(e=l.add(e,-1,"day")),e}getFormattedEndDate(e,t){return this.getFormattedDate(this.getDisplayEndDate(e,t))}getCoordinateFromDate(e,t=!0){const i=this,{timeAxisViewModel:n}=i,{isContinuous:r,startMS:a,endMS:s,startDate:o,endDate:d,unit:c}=i.timeAxis,u=e.valueOf();let h;if(!0===t?t={local:!0}:t?"local"in t||(t.local=!0):t={local:!1},e instanceof Date||(qe.setTime(e),e=qe),r&&e.getTimezoneOffset()===o.getTimezoneOffset()&&o.getTimezoneOffset()===d.getTimezoneOffset()&&-1!==l.getUnitToBaseUnitRatio(c,"day")){if(u<a||u>s)return-1;h=(u-a)/(s-a)*n.totalSize}else h=n.getPositionFromDate(e,t);return i.rtl&&i.isHorizontal&&(h=n.totalSize-h),t.local||(h=i.currentOrientation.translateToPageCoordinate(h)),h}getTimeSpanDistance(e,t){return this.timeAxisViewModel.getDistanceBetweenDates(e,t)}get viewportCenterDate(){const{timeAxis:e,timelineScroller:t}=this;if(e.isContinuous){const i=(t.position+t.clientSize/2)/t.scrollSize;return new Date(e.startMS+(e.endMS-e.startMS)*i)}return this.getDateFromCoordinate(t.position+t.clientSize/2)}get viewportCenterDateCached(){return this.cachedCenterDate||(this.cachedCenterDate=this.viewportCenterDate)}get timeResolution(){return this.timeAxis.resolution}set timeResolution(e){this.timeAxis.resolution="number"==typeof e?{increment:e,unit:this.timeAxis.resolution.unit}:e}get snap(){var e,t;return null!==(e=null===(t=this._timeAxisViewModel)||void 0===t?void 0:t.snap)&&void 0!==e?e:this._snap}updateSnap(e){this.isConfiguring||(this.timeAxisViewModel.snap=e,this.timeAxis.forceFullTicks=e&&this.fillTicks)}onSchedulerHorizontalScroll({subGrid:e,scrollLeft:t,scrollX:i}){this.scrollingToCenter||(this.cachedCenterDate=null)}get widgetClass(){}},"$name","TimelineDateMapper"),s(t,"configurable",{snap:!1}),t};const{eventNameMap:Je}=g;var Qe=e=>{var t;return t=class extends(e||A){constructor(...e){super(...e),s(this,"hoveredEvents",new Set)}initDomEvents(){const e=this,{schedulerEvents:t,schedulerEnterLeaveEvents:i}=e;t.element=i.element=e.timeAxisSubGridElement,t.thisObj=i.thisObj=e,g.on(t),g.on(i),R.supportsPointerEventConstructor&&g.on({element:document,scroll:"onScheduleScroll",capture:!0,thisObj:e})}getTimeSpanMouseEventParams(e,t){throw new Error("Implement in subclass")}getScheduleMouseEventParams(e,t){throw new Error("Implement in subclass")}handleScheduleEvent(e){const t=this,i=t.getTimelineEventContext(e);t.lastPointerEvent=e,i&&t.trigger(`${i.eventElement?t.scheduledEventName:"schedule"}${Je[e.type]||p.capitalize(e.type)}`,i),t.timelineContext=i}handleScheduleEnterLeaveEvent(e){e.target.parentElement===this.foregroundCanvas&&this.handleScheduleEvent(e)}onScheduleScroll({target:e}){var t;const i=this;if(e&&i.updateTimelineContextOnScroll&&(null===(t=i.features.pan)||void 0===t||!t.isActive)&&!i.partners.some((e=>{var t;return null===(t=e.features.pan)||void 0===t?void 0:t.isActive}))&&(e.contains(i.element)||i.bodyElement.contains(e))){const{timelineContext:e,lastPointerEvent:t}=i;if(e){const i=m.elementFromPoint(e.domEvent.clientX,e.domEvent.clientY),n=new PointerEvent("pointermove",t),r=new MouseEvent("mousemove",t);n.scrollInitiated=r.scrollInitiated=!0,null==i||i.dispatchEvent(n),null==i||i.dispatchEvent(r)}}}updateTimelineContext(e,t){this.trigger("timelineContextChange",{oldContext:t,context:e}),e||this.trigger("scheduleMouseLeave")}getTimelineEventContext(e){const t=this,i=e.target.closest(t.eventInnerSelector),n=t.getCellElementFromDomEvent(e);if(n){const r=t.getDateFromDomEvent(e,"floor");if(!r)return;const a=F.get(n),s=i?t.getTimeSpanMouseEventParams(i,e):t.getScheduleMouseEventParams(a,e);if(!s)return;const o=t.isVertical?t.resourceStore.indexOf(s.resourceRecord):a.row.dataIndex,l=t.timeAxis.getTickFromDate(r),d=t.timeAxis.getAt(Math.floor(l));if(d)return u({isTimelineContext:!0,domEvent:e,eventElement:i,cellElement:n,index:o,tick:d,tickIndex:l,date:r,tickStartDate:d.startDate,tickEndDate:d.endDate,tickParentIndex:d.parentIndex,row:a.row,event:e},s)}}getCellElementFromDomEvent({target:e,clientY:t,type:i}){const n=this,{isVertical:r,foregroundCanvas:a}=n,s=e.closest(n.eventSelector);return s?n.getCell({[r?"row":"record"]:r?0:n.resolveRowRecord(s),column:n.timeAxisColumn}):a.contains(e)?e===a||"mousemove"===i?null===(o=n.rowManager.getRowAt(t,!1))||void 0===o?void 0:o.getCell(n.timeAxisColumn.id):void 0:e.matches(".b-grid-row")?e.firstElementChild:e.closest(n.timeCellSelector);var o}matchScheduleCell(e){return e.closest(this.timeCellSelector)}onElementMouseButtonEvent(e){const t=e.target.closest(".b-sch-header-timeaxis-cell");if(t){const i=t.dataset.tickIndex,n=t.parentElement.dataset.headerPosition,r=this.timeAxisViewModel.columnConfig[n][i],a=this.features.contextMenu;a&&e.type===a.triggerEvent||this.trigger(`timeAxisHeader${p.capitalize(e.type)}`,{startDate:r.start,endDate:r.end,event:e})}}onElementMouseDown(e){this.onElementMouseButtonEvent(e),super.onElementMouseDown(e)}onElementClick(e){this.onElementMouseButtonEvent(e),super.onElementClick(e)}onElementDblClick(e){this.onElementMouseButtonEvent(e),super.onElementDblClick(e)}onElementContextMenu(e){this.onElementMouseButtonEvent(e),super.onElementContextMenu(e)}onElementMouseOver(e){var t;super.onElementMouseOver(e);const i=this,{target:n}=e,{hoveredEvents:r}=i;if(!n.closest(i.eventInnerSelector)||null!==(t=i.features.eventDrag)&&void 0!==t&&t.isDragging)r.size&&i.unhoverAll(e);else{const t=n.closest(i.eventSelector);if(!r.has(t)&&!i.preventOverCls){r.add(t),t.classList.add(i.overScheduledEventClass);const n=i.getTimeSpanMouseEventParams(t,e);n&&i.trigger(`${i.scheduledEventName}MouseEnter`,n)}}}onElementMouseOut(e){var t;super.onElementMouseOut(e);const i=this,{target:n,relatedTarget:r}=e,a=n.closest(i.eventInnerSelector),s=n.closest(i.eventSelector),o=i.resolveTimeSpanRecord(n);if(a&&o&&i.hoveredEvents.has(s)&&(null===(t=i.features.eventDrag)||void 0===t||!t.isDragging)){if(r&&m.isDescendant(a,r))return;i.unhover(s,e)}}unhover(e,t){const i=this;e.classList.remove(i.overScheduledEventClass),i.trigger(`${i.scheduledEventName}MouseLeave`,i.getTimeSpanMouseEventParams(e,t)),i.hoveredEvents.delete(e)}unhoverAll(e){for(const t of this.hoveredEvents)!t.isReleased&&!t.classList.contains("b-released")&&this.unhover(t,e);this.hoveredEvents.clear()}get widgetClass(){}},s(t,"$name","TimelineDomEvents"),s(t,"configurable",{timelineContext:{$config:{equal:(e,t)=>(null==e?void 0:e.index)===(null==t?void 0:t.index)&&(null==e?void 0:e.tickParentIndex)===(null==t?void 0:t.tickParentIndex)&&!(((null==e?void 0:e.tickStartDate)||0)-((null==t?void 0:t.tickStartDate)||0))}},updateTimelineContextOnScroll:!0}),s(t,"properties",{schedulerEvents:{mouseover:"handleScheduleEvent",mousedown:"handleScheduleEvent",mouseup:"handleScheduleEvent",click:"handleScheduleEvent",dblclick:"handleScheduleEvent",contextmenu:"handleScheduleEvent",mousemove:"handleScheduleEvent",mouseout:"handleScheduleEvent"},schedulerEnterLeaveEvents:{mouseenter:"handleScheduleEnterLeaveEvent",mouseleave:"handleScheduleEnterLeaveEvent",capture:!0}}),s(t,"delayable",{onScheduleScroll:"raf"}),t};const et=(e=0,t=0)=>t-e;var tt=e=>class extends(e||A){static get $name(){return"TimelineViewPresets"}static get configurable(){return{viewPreset:"weekAndDayLetter",presets:!0,displayDateFormat:null}}changePresets(e){const t={owner:this};let i=[];if(!0===e)i=me.allRecords;else if(Array.isArray(e))for(const t of e)if("string"==typeof t){const e=me.getById(t);e&&i.push(e)}else i.push(t);else o.assign(t,e);const n=new ge(t);return n.add(i),n}changeViewPreset(e,t){const i=this,{presets:n}=i;e?(e=n.createRecord(e),n.add(e)):e=n.first;const r=i.lastViewPresetOptions||{},a=e.options||(e.options={}),s=a.event={startDate:a.startDate,endDate:a.endDate,from:t,to:e,preset:e},o=!i._viewPreset||!i._viewPreset.equals(e),l=et(a.startDate,r.startDate)||et(a.endDate,r.endDate)||et(a.centerDate,r.centerDate)||a.startDate&&et(a.startDate,i.startDate)||a.endDate&&et(a.endDate,i.endDate);if((o||l)&&(o||(i._viewPreset=null),i.isConfiguring||!1!==i.trigger("beforePresetChange",s)))return e}get displayDateFormat(){return this._displayDateFormat||this.viewPreset.displayDateFormat}updateViewPreset(e){const t=this,{options:i}=e,{event:n,startDate:r,endDate:a}=i,{isHorizontal:s,_timeAxis:d,_timeAxisViewModel:c}=t;let{centerDate:u,zoomDate:h,zoomPosition:g}=i,m=!1;if(t._viewPresetChanging=!0,d&&!t.isConfiguring){if(t.lastViewPresetOptions=i,d.isConfigured){t.suspendRefresh();const i=o.copyProperties({},t,["weekStartDay","startTime","endTime"]);t.infiniteScroll?Object.assign(i,c.calculateInfiniteScrollingDateRange(u||new Date((r.getTime()+a.getTime())/2),!0,e)):r?(i.startDate=r,i.endDate=a,!u&&a&&(u=new Date((r.getTime()+a.getTime())/2))):(i.startDate=d.startDate,i.endDate=a||d.endDate,u||(u=t.viewportCenterDate)),d.isConfigured=!1,d.viewPreset=e,d.reconfigure(i,!0),c.reconfigure({viewPreset:e,headers:e.headers,columnLinesFor:null!=e.columnLinesFor?e.columnLinesFor:e.headers.length-1,tickSize:s?e.tickWidth:e.tickHeight||e.tickWidth||60}),t.resumeRefresh(!1)}if(t.refresh(),!i.notScroll&&t.isPainted)if(h&&g){const e=C[d.resolutionUnit]>3?"hour":"minute",r=l.asMilliseconds("minute"===e?15:1,e),a=new Date(Math.round(h/r)*r);n.zoomDate=h,n.zoomPosition=g,n.zoomLevel=i.zoomLevel,t.timelineScroller.scrollBy(t.getCoordinateFromDate(a)-g)}else if(u){t.cachedCenterDate=u,n.centerDate=u;const e=t.timelineScroller.clientSize,i=Math.max(t.getCoordinateFromDate(u,!0)-e/2,0);t.scrollingToCenter=!0,i===(t.isHorizontal?t.scrollLeft:t.scrollTop)?m=!0:t.isHorizontal?t.scrollHorizontallyTo(i,!1):t.scrollVerticallyTo(i,!1),t.setTimeout((()=>{t.scrollingToCenter=!1}),100)}else 0===(t.isHorizontal?t.scrollLeft:t.scrollTop)?m=!0:t.timelineScroller.scrollTo(0)}t.dataset.presetId=e.id,t.trigger("presetChange",n),t._viewPresetChanging=!1,m&&(t.isHorizontal?t.currentOrientation.updateFromHorizontalScroll(t.scrollLeft,t.scrollX):t.currentOrientation.updateFromVerticalScroll(t.scrollTop))}doDestroy(){this._presets.owner===this&&this._presets.destroy(),super.doDestroy()}getCurrentConfig(e){const t=super.getCurrentConfig(e);return t.viewPreset&&t.viewPreset.name&&!t.viewPreset.base&&delete t.viewPreset.name,t}get widgetClass(){}},it=e=>class extends(e||A){constructor(...e){super(...e),s(this,"lastWheelTime",-1),s(this,"lastZoomPosition",-1)}static get $name(){return"TimelineZoomable"}static get defaultConfig(){return{zoomOnMouseWheel:!0,zoomOnTimeAxisDoubleClick:!0,minZoomLevel:0,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:null}}construct(e){const t=this;super.construct(e),t.zoomOnMouseWheel&&g.on({element:t.timeAxisSubGridElement,wheel:"onWheel",throttled:{buffer:100,alt:e=>e.ctrlKey&&e.preventDefault()},thisObj:t,capture:!0,passive:!1}),t.zoomOnTimeAxisDoubleClick&&t.ion({timeaxisheaderdblclick:({startDate:e,endDate:i})=>{t.zoomToSpan({startDate:e,endDate:i})}})}get maxZoomLevel(){return this._maxZoomLevel||this.presets.count-1}set maxZoomLevel(e){if("number"!=typeof e&&(e=this.presets.count-1),e<0||e>=this.presets.count)throw new Error("Invalid range for `maxZoomLevel`");this._maxZoomLevel=e}get minZoomLevel(){return this._minZoomLevel}set minZoomLevel(e){if("number"!=typeof e&&(e=0),e<0||e>=this.presets.count)throw new Error("Invalid range for `minZoomLevel`");this._minZoomLevel=e}get zoomLevel(){return this.presets.indexOf(this.viewPreset)}set zoomLevel(e){this.zoomToLevel(e)}getMilliSecondsPerPixelForZoomLevel(e,t){const{bottomHeader:i}=e,n=this.isHorizontal?e.tickWidth:e.tickHeight;return Math.round((l.add(new Date(1,0,1),i.increment||1,i.unit)-new Date(1,0,1))/(t?n:e.actualWidth||n))}zoomTo(e){const t=this;"object"==typeof e?e.preset?t.zoomToLevel(e.preset,e):null!=e.level?t.zoomToLevel(e.level,e):t.zoomToSpan(e):t.zoomToLevel(e)}zoomToLevel(e,t={}){"number"==typeof e&&(e=Math.min(Math.max(e,this.minZoomLevel),this.maxZoomLevel));const i=this,{presets:n}=i,r=i.isVertical?"tickHeight":"tickWidth",a=n.createRecord(e),s=a[r],o=t.startDate?new Date(t.startDate):null,l=t.endDate?new Date(t.endDate):null;n.add(a);let d=o&&l?{startDate:o,endDate:l}:null;const c=t.centerDate?new Date(t.centerDate):d?new Date((o.getTime()+l.getTime())/2):i.viewportCenterDateCached,h=i.isVertical?i.scrollable.clientHeight:i.timeAxisSubGrid.width;return 0===h?null:(d||(d=i.calculateOptimalDateRange(c,h,a)),"width"in t&&a.setData(r,t.width),i.isZooming=!0,a.options=u(u({},t),{},{startDate:d.startDate||i.startDate,endDate:d.endDate||i.endDate,centerDate:c}),i.viewPreset=a,a.actualWidth=i.timeAxisViewModel.tickSize,i.isZooming=!1,a.setData(r,s),i.zoomLevel)}zoomToFit(e){const t=this.eventStore.getTotalTimeSpan();(e=u(u({leftMargin:0,rightMargin:0},e),t)).startDate&&e.endDate&&(e.endDate>e.startDate?this.zoomToSpan(e):this.scrollToDate(e.startDate))}zoomToSpan(e={}){if((e.leftMargin||e.rightMargin)&&(e.adjustStart=0,e.adjustEnd=0),e.leftMargin||(e.leftMargin=0),e.rightMargin||(e.rightMargin=0),!e.startDate||!e.endDate)throw new Error("zoomToSpan: must provide startDate + endDate dates");const t=this,{timeAxis:i}=t,n=e.adjustStart>=0||e.adjustEnd>=0;let{startDate:r,endDate:a}=e;if(n&&(r=l.add(r,-e.adjustStart,i.mainUnit),a=l.add(a,e.adjustEnd,i.mainUnit)),r<=a){const{availableSpace:s}=t.timeAxisViewModel,o=t.presets.allRecords,d=a-r||1;let c,u,h=t.zoomLevel;-1===h&&(h=0);let g,m=t.getMilliSecondsPerPixelForZoomLevel(o[h],!0),p=h+(c=d/m+e.leftMargin+e.rightMargin>s?-1:1),v=null;for(;p>=0&&p<=o.length-1;){g=o[p],m=t.getMilliSecondsPerPixelForZoomLevel(g,!0);const i=d/m+e.leftMargin+e.rightMargin;if(-1===c){if(i<=s){v=p;break}}else{if(!(i<=s))break;h!==p-c&&(v=p)}p+=c}v=null!=v?v:p-c,g=o[v];const f=g.bottomHeader.unit;m=t.getMilliSecondsPerPixelForZoomLevel(g,!0),(e.leftMargin||e.rightMargin)&&(r=new Date(r.getTime()-m*e.leftMargin),a=new Date(a.getTime()+m*e.rightMargin));const D=l.getDurationInUnit(r,a,f,!0)/g.bottomHeader.increment;if(0===D)return null;const b=Math.floor(s/D),S=e.centerDate||new Date((r.getTime()+a.getTime())/2);u=n?{startDate:r,endDate:a}:t.calculateOptimalDateRange(S,s,g);let w=t.zoomLevel;return t.zoomLevel===v?i.reconfigure(u):w=t.zoomToLevel(v,Object.assign(u,{width:b,centerDate:S})),t.infiniteScroll&&t.scrollToDate(r,{block:"start"}),w}return null}zoomIn(e=1,t){const i=this.zoomLevel;return i>=this.maxZoomLevel?null:this.zoomToLevel(i+e,t)}zoomOut(e=1,t){const i=this.zoomLevel;return i<=this.minZoomLevel?null:this.zoomToLevel(i-e,t)}zoomInFull(){return this.zoomToLevel(this.maxZoomLevel)}zoomOutFull(){return this.zoomToLevel(this.minZoomLevel)}calculateOptimalDateRange(e,t,i,n){if(n)return n;const r=this,{timeAxis:a}=r,{bottomHeader:s}=i,o=r.isHorizontal?i.tickWidth:i.tickHeight;if(r.zoomKeepsOriginalTimespan)return{startDate:a.startDate,endDate:a.endDate};const d=s.unit,c=Math.ceil(t/o*s.increment*r.visibleZoomFactor/2),u=l.add(e,-c,d),h=l.add(e,c,d);return r.infiniteScroll?r.timeAxisViewModel.calculateInfiniteScrollingDateRange(e,!0):{startDate:a.floorDate(u,!1,d,s.increment),endDate:a.ceilDate(h,!1,d,s.increment)}}onElementMouseMove(e){const{isHorizontal:t,zoomContext:i}=this;super.onElementMouseMove(e),e.isTrusted&&i&&Math.abs(e["client"+(t?"X":"Y")]-i.coordinate)>10&&(this.zoomContext=null)}async onWheel(e){if(e.ctrlKey){e.preventDefault();const t=this,{zoomContext:i,isHorizontal:n,timelineScroller:r,zoomLevel:a}=t,s=performance.now(),o=e["client"+(n?"X":"Y")],l=o-r.viewport[""+(n?"x":"y")]+r.position;s-t.lastWheelTime>200||!i||Math.abs(o-t.zoomContext.coordinate)>20?t.zoomContext={zoomLevel:a,coordinate:o,zoomPosition:l,zoomDate:t.getDateFromDomEvent(e)}:(a>i.zoomLevel&&(i.zoomDate=t.getDateFromDomEvent(e),i.zoomLevel=a),i.zoomPosition=l),t.lastWheelTime=s,t["zoom"+(e.deltaY>0?"Out":"In")](void 0,t.zoomContext)}}setTimeSpan(e,t){this.timeAxis.setTimeSpan(e,t)}shift(e,t){this.timeAxis.shift(e,t)}shiftNext(e){this.timeAxis.shiftNext(e)}shiftPrevious(e){this.timeAxis.shiftPrevious(e)}get widgetClass(){}},nt=e=>{var t;return s(t=class extends(e||A){static get $name(){return"TimelineEventRendering"}static get defaultConfig(){return{resourceMargin:null,managedEventSizing:!0,generatedIdCls:"b-sch-dirty-new",dirtyCls:"b-sch-dirty",committingCls:"b-sch-committing",endsOutsideViewCls:"b-sch-event-endsoutside",startsOutsideViewCls:"b-sch-event-startsoutside",fixedEventCls:"b-sch-event-fixed",eventStyle:"plain",eventColor:"green",tickSize:null}}updateFillTicks(e){this.isConfiguring||(this.timeAxis.forceFullTicks=e&&this.snap,this.refreshWithTransition(),this.trigger("stateChange"))}changeBarMargin(e){return o.assertNumber(e,"barMargin"),this.isHorizontal&&this.rowHeight?Math.min(Math.ceil(this.rowHeight/2),e):e}updateBarMargin(){this.rendered&&(this.currentOrientation.onBeforeRowHeightChange(),this.refreshWithTransition(),this.trigger("stateChange"))}get resourceMargin(){return null==this._resourceMargin?this.barMargin:this._resourceMargin}set resourceMargin(e){const t=this;o.assertNumber(e,"resourceMargin"),t.isHorizontal&&t.rowHeight&&(e=Math.min(Math.ceil(t.rowHeight/2),e)),t._resourceMargin!==e&&(t._resourceMargin=e,t.rendered&&(t.currentOrientation.onBeforeRowHeightChange(),t.refreshWithTransition()))}set tickSize(e){o.assertNumber(e,"tickSize"),this.timeAxisViewModel.tickSize=e}get tickSize(){return this.timeAxisViewModel.tickSize}static get eventColors(){return["red","pink","purple","violet","indigo","blue","cyan","teal","green","lime","yellow","orange","deep-orange","gray"]}static get eventStyles(){return["plain","border","hollow","colored","line","dashed","minimal","rounded"]}get widgetClass(){}},"configurable",{barMargin:10,fillTicks:!1}),t};const rt={maintainVisibleStart:!0},at={block:"nearest"};var st=e=>class extends(e||A){static get $name(){return"TimelineScroll"}static get configurable(){return{bufferCoef:5,bufferThreshold:.2,infiniteScroll:!1}}initScroll(){const e=this,{isHorizontal:t}=e;super.initScroll();const{scrollable:i}=t?e.timeAxisSubGrid:e;if(i.ion({scroll:"onTimelineScroll",thisObj:e}),e.infiniteScroll){const{visibleDate:t}=e,i=t?t.date||t:e.viewportCenterDate,n=!t||!("block"in t)||"center"===t.block,{startDate:r,endDate:a}=e.timeAxisViewModel.calculateInfiniteScrollingDateRange(i,n);e.setTimeSpan(r,a,{visibleDate:i})}}get timelineScroller(){const e=this;return e.scrollInitialized||e.initScroll(),e._timelineScroller||(e._timelineScroller=new ot({widget:e,scrollable:e.isHorizontal?e.timeAxisSubGrid.scrollable:e.scrollable,isHorizontal:e.isHorizontal}))}doDestroy(){var e;null===(e=this._timelineScroller)||void 0===e||e.destroy(),super.doDestroy()}onTimelineScroll({source:e}){this.infiniteScroll&&this.checkTimeAxisScroll(e[this.isHorizontal?"x":"y"])}checkTimeAxisScroll(e){const t=this,i=t.timelineScroller,{clientSize:n}=i,r=n*t.bufferCoef*t.bufferThreshold,a=i.maxPosition,{style:s}=t.timeAxisSubGrid.virtualScrollerElement;(a-e<r||e<r)&&(s.overflow="hidden",s.pointerEvents="none",s.paddingBottom=`${m.scrollBarWidth}px`,t.setTimeout((()=>{s.overflow="",s.paddingBottom="",s.pointerEvents=""}),100),t.shiftToDate(t.getDateFromCoordinate(e,null,!0)))}shiftToDate(e,t){const i=this.timeAxisViewModel.calculateInfiniteScrollingDateRange(e,t);this.setTimeSpan(i.startDate,i.endDate,rt)}updateInfiniteScroll(e){!this.isConfiguring&&e&&this.checkTimeAxisScroll(this.timelineScroller.position)}scrollToDate(e,t={}){const i=this,{timeAxis:n,visibleDateRange:r,infiniteScroll:a}=i,{unit:s,increment:o}=n,d=t.edgeOffset||0,c=l.ceil(r.endDate,o+" "+s)-l.floor(r.startDate,o+" "+s),u=e>i.viewportCenterDate?1:-1,h=(a?c*i.bufferCoef*i.bufferThreshold:"center"===t.block?c/2:d?i.getMilliSecondsPerPixelForZoomLevel(i.viewPreset)*d:0)*u,g=new Date(e.getTime()+h);(g>n.endDate?1:g<n.startDate?-1:0)&&i.infiniteScroll&&i.shiftToDate(new Date(e-h),null,!0);const m=i.timelineScroller.viewport,p=i.getCoordinateFromDate(e,!0),v=i.isHorizontal?new E(i.getCoordinateFromDate(e,!1),m.y,Math.min(i.timeAxisViewModel.tickSize,i.timeAxisViewModel.availableSpace),m.height):new E(m.x,i.getCoordinateFromDate(e,!1),m.width,i.timeAxisViewModel.tickSize);return i.scrollToCoordinate(p,v,e,t)}scrollToNow(e={}){return this.scrollToDate(new Date,e)}async scrollToCoordinate(e,t,i,n={}){const r=this;if(e<0){const e=r.endDate-r.startDate,{unit:t,increment:a}=r.timeAxis,s=l.floor(new Date(i.getTime()-e/2),a+" "+t),o=l.add(s,e);return s-r.startDate!=0&&o-r.endDate!=0?(r.setTimeSpan(s,o),r.scrollToDate(i,n)):void 0}return await r.timelineScroller.scrollIntoView(t,n),!r.isDestroyed&&r.nextAnimationFrame()}set scrollLeft(e){this.timeAxisSubGrid.scrollable.element.scrollLeft=e}get scrollLeft(){return this.timeAxisSubGrid.scrollable.element.scrollLeft}set scrollX(e){this.timeAxisSubGrid.scrollable.x=e}get scrollX(){return this.timeAxisSubGrid.scrollable.x}set scrollTop(e){this.scrollable.y=e}get scrollTop(){return this.scrollable.y}scrollHorizontallyTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}scrollVerticallyTo(e,t=!0){return this.scrollable.scrollTo(null,e,t)}scrollTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}get widgetClass(){}};class ot extends L{static get configurable(){return{position:null,x:null,y:null}}updateOverflowX(){}updateOverflowY(){}onScroll(e){super.onScroll(e),this._position=null}syncPartners(e){this.scrollable.syncPartners(e)}updatePosition(e){this.scrollable[this.isHorizontal?"x":"y"]=e}get viewport(){return this.scrollable.viewport}get position(){return this._position=this.scrollable[this.isHorizontal?"x":"y"]}get clientSize(){return this.scrollable["client"+(this.isHorizontal?"Width":"Height")]}get scrollSize(){return this.scrollable["scroll"+(this.isHorizontal?"Width":"Height")]}get maxPosition(){return this.scrollable["max"+(this.isHorizontal?"X":"Y")]}scrollTo(e,t){return this.isHorizontal?this.scrollable.scrollTo(e,null,t):this.scrollable.scrollTo(null,e,t)}scrollBy(e=0,t=0,i=at){return this.isHorizontal?this.scrollable.scrollBy(e||t,0,i):this.scrollable.scrollBy(0,t||e,i)}scrollIntoView(){return this.scrollable.scrollIntoView(...arguments)}changeX(e){this.position=e}changeY(e){this.position=e}get x(){return this.position}set x(e){this.scrollable[this.isHorizontal?"x":"y"]=e}get y(){return this.position}set y(e){this.scroller[this.isHorizontal?"x":"y"]=e}get clientWidth(){return this.clientSize}get clientHeight(){return this.clientSize}get scrollWidth(){return this.scrollSize}get scrollHeight(){return this.scrollSize}get maxX(){return this.maxPosition}get maxY(){return this.maxPosition}}const lt=["barMargin"];var dt=e=>class extends(e||A){static get $name(){return"TimelineState"}getState(){const e=this,t=o.copyProperties(super.getState(),e,lt);return t.zoomLevel=e.zoomLevel,t.zoomLevelOptions={startDate:e.startDate,endDate:e.endDate,centerDate:!e.infiniteScroll||e.timeAxisViewModel.availableSpace?e.viewportCenterDate:void 0,width:e.tickSize},t}applyState(e){const t=this;if(t.suspendRefresh(),o.copyProperties(t,e,lt),super.applyState(e),null!=e.zoomLevel){var i;if(t.infiniteScroll)null!=e&&null!==(i=e.scroll)&&void 0!==i&&i.scrollLeft&&(e.scroll.scrollLeft={});t.isPainted?t.zoomToLevel(e.zoomLevel,e.zoomLevelOptions):t._zoomAfterPaint={zoomLevel:e.zoomLevel,zoomLevelOptions:e.zoomLevelOptions}}t.resumeRefresh(!0)}onPaint(...e){if(super.onPaint(...e),this._zoomAfterPaint){const{zoomLevel:e,zoomLevelOptions:t}=this._zoomAfterPaint;this.zoomToLevel(e,t),delete this._zoomAfterPaint}}get widgetClass(){}};class ct extends j{static get $name(){return"SchedulerHeader"}refreshContent(){var e;null!==(e=this.headersElement)&&void 0!==e&&e.querySelector(".b-sch-timeaxiscolumn")||super.refreshContent()}}ct._$name="Header";class ut extends B{static get $name(){return"TimeAxisSubGrid"}static get type(){return"timeaxissubgrid"}static get configurable(){return{sealedColumns:!0,headerClass:ct}}startConfigure(e){const{grid:t}=e;t.timeAxisSubGrid=this,super.startConfigure(e),t.isHorizontal&&(e.header={cls:{"b-sticky-headers":t.stickyHeaders}},delete e.headerClass),"flex"in e||"width"in e||(e.flex=1)}changeScrollable(){const e=this,t=super.changeScrollable(...arguments);return t&&Object.defineProperty(t,"scrollWidth",{get(){var e,t;return null!==(e=null===(t=this.element)||void 0===t?void 0:t.scrollWidth)&&void 0!==e?e:0},set(){e.grid.updateCanvasSize()}}),t}syncScrollingPartners(e=!0){this.grid._viewPresetChanging||super.syncScrollingPartners(e)}onInternalResize(e,t,i,n,r){const a=this;if(a.isPainted&&t!==n){const e=a.grid,i=e._bodyRectangle.height;m.scrollBarWidth&&t<n&&(a.monitorResize=!1),e.onSchedulerViewportResize(t,i,n,i),a.monitorResize||a.requestAnimationFrame((()=>a.monitorResize=!0))}super.onInternalResize(...arguments)}clearWidthCache(){super.clearWidthCache(),this.owner.isHorizontal&&this.owner.updateViewModelAvailableSpace(this.width)}}ut.initClass(),ut._$name="TimeAxisSubGrid";const ht={fn:"exitTransition",delay:0,cancelOutstanding:!0},gt={};class mt extends(U.mixin(Ke,Qe,nt,st,dt,tt,it,Q)){static get $name(){return"TimelineBase"}static get type(){return"timelinebase"}static get defaultConfig(){return{workingTime:null,timeAxis:null,timeAxisViewModel:null,autoAdjustTimeAxis:!0,snapRelativeToEventStartDate:!1,suppressFit:!1,timeCellCls:null,scheduledEventName:null,overScheduledEventClass:null,preventOverCls:!1,useBackgroundCanvas:!1,enableEventAnimations:!0,disableGridRowModelWarning:!0,animateRemovingRows:!1,partner:null,schedulerRegion:"normal",transitionDuration:200,animationTimeout:null,defaultRegion:"locked",durationDisplayPrecision:1,asyncEventSuffix:"PreCommit",viewportResizeTimeout:250}}updateTimeZone(e){this.isConfiguring&&(this.project._isConfiguringTimeZone=!0),this.project.timeZone=e}get timeZone(){return this.project.timeZone}populateEventMenu(){}populateScheduleMenu(){}onVisibleDateRangeChange(e){if(!this.handlingVisibleDateRangeChange){const t=this,{_visibleDateRange:i}=t;(!i||i.startDate-e.startDate||i.endDate-e.endDate)&&(t.timeView.range=e,t.handlingVisibleDateRangeChange=!0,t.trigger("visibleDateRangeChange",{old:i,new:e}),t.handlingVisibleDateRangeChange=!1,t._visibleDateRange=e)}}onVisibleResourceRangeChange(){}construct(e={}){const t=this;super.construct(e),t.$firstVerticalOverflow=!0,t.initDomEvents(),t.currentOrientation.init(),t.rowManager.ion({refresh:()=>{t.forceLayout=!1}})}createSubGrid(e,t={}){const i=this,{stickyHeaders:n}=i;return e===(i.schedulerRegion||"normal")?t.type="timeaxissubgrid":"locked"===e&&n&&i.isVertical&&(t.scrollable={overflowX:"visible",overflowY:"visible"},i.bodyContainer.classList.add("b-sticky-headers")),super.createSubGrid(e,t)}doDestroy(){const e=this,{partneredWith:t,currentOrientation:i}=e;null==i||i.destroy(),t?(t.forEach((t=>{e.removePartner(t)})),t.destroy()):(e.timeAxisViewModel.destroy(),e.timeAxis.destroy()),super.doDestroy()}startConfigure(e){super.startConfigure(e),H.addResizeListener(this.bodyContainer,this.onBodyResize.bind(this)),this.getConfig("partner")}changeStartDate(e){return"string"==typeof e&&(e=l.parse(e)),e}onPaint({firstPaint:e}){if(e){const e=this,n=(e.isHorizontal?e.timeAxisSubGrid.scrollable:e.scrollable).element.getBoundingClientRect()[e.isHorizontal?"width":"height"];var t,i;if(e.timeAxisViewModel.update(n,e.infiniteScroll,!0),e.infiniteScroll)null===(t=(i=e.currentOrientation).doUpdateTimeView)||void 0===t||t.call(i)}super.onPaint(...arguments)}onSchedulerHorizontalScroll(e,t,i){this.currentOrientation.updateFromHorizontalScroll(i),super.onSchedulerHorizontalScroll(e,t,i)}initScroll(){const e=this;let t=0;super.initScroll(),e.ion({horizontalScroll:({subGrid:i,scrollLeft:n,scrollX:r})=>{!e.isPainted||i!==e.timeAxisSubGrid||e.isDestroying||e.refreshSuspended||e.onSchedulerHorizontalScroll(i,n,r),t++}}),"horizontal"===e.testPerformance&&e.setTimeout((()=>{const i=performance.now();let n=5,r=1;const a=e.setInterval((()=>{if(n+=5,e.scrollX+=(10+Math.floor(n))*r,1===r&&e.scrollX>5500&&(r=-1,n=5),-1===r&&e.scrollX<=0){const n=(performance.now()-i)/t,r=Math.round(1e3/n*10)/10;clearInterval(a),console.log(e.eventPositionMode,e.eventScrollMode,r+"fps")}}),0)}),500)}preserveViewCenter(e,t=this,...i){const n=this,r=n.viewportCenterDate,a=e.apply(t,i),s=n.timelineScroller,{clientSize:o}=s,l=Math.max(Math.floor(n.getCoordinateFromDate(r,!0)-o/2),0);return n.scrollingToCenter=!0,s.scrollTo(l,!1).then((()=>n.scrollingToCenter=!1)),a}setTimeSpan(e,t,{preventThrow:i=!1,maintainVisibleStart:n=!1,visibleDate:r}=gt){const a=this,{timeAxis:s}=a,{startDate:o,endDate:l}=s.getAdjustedDates(e,t),d=s.startDate-o!=0,c=s.endDate-l!=0;if(d||c){if(n){const{timeAxisViewModel:e}=a,{totalSize:t}=e,i=e.tickSize,n=a.timelineScroller,r=n.position,s=e.getDateFromPosition(r);s>=o&&s<l&&e.ion({update(){const o=e.tickSize!==i;a.updateCanvasSize(),!d||c||o?n.position=d||o?e.getPositionFromDate(s):r:n.position+=e.totalSize-t,n.syncPartners(!0)},prio:1e4,once:!0})}const e=s.reconfigure({startDate:o,endDate:l},!1,i);return r&&a.scrollToDate(r.date||r,r),e}}get hasVisibleEvents(){return!this.noFeatureElementsInAxis()||this.eventStore.storage.values.some((e=>this.timeAxis.isTimeSpanInAxis(e)))}noFeatureElementsInAxis(){}get capitalizedEventName(){return this._capitalizedEventName||(this._capitalizedEventName=p.capitalize(this.scheduledEventName)),this._capitalizedEventName}set partner(e){this._partner=e,this.addPartner(e)}addPartner(e){const t=this;if(!t.isPartneredWith(e)){(t.partneredWith||(t.partneredWith=new O)).add(e),(e.partneredWith||(e.partneredWith=new O)).add(t),t.getConfig("viewPreset"),e.ion({presetchange:"onPartnerPresetChange",thisObj:t}),e.scrollable.ion({overflowChange:"onPartnerOverflowChange",thisObj:t});const i=t.partnerSharedConfigs.reduce(((t,i)=>(t[i]=e[i],t)),{});t.setConfig(i),t.ion({presetchange:"onPartnerPresetChange",thisObj:e}),t.scrollable.ion({overflowChange:"onPartnerOverflowChange",thisObj:e}),t.isPainted?(t.scrollable.addPartner(e.scrollable,t.isHorizontal?"x":"y"),e.syncPartnerSubGrids()):t.initScroll=I.createSequence(t.initScroll,(()=>{t.scrollable.addPartner(e.scrollable,t.isHorizontal?"x":"y"),e.syncPartnerSubGrids()}),t)}}removePartner(e){const t=this,{partneredWith:i}=t;t.isPartneredWith(e)&&(i.remove(e),t.scrollable.removePartner(e.scrollable),t.un({presetchange:"onPartnerPresetChange",thisObj:e}),t.scrollable.un({overflowChange:"onPartnerOverflowChange",thisObj:e}),e.removePartner(t))}isPartneredWith(e){var t;return Boolean(null===(t=this.partneredWith)||void 0===t?void 0:t.includes(e))}onPartnerOverflowChange({source:e,y:t}){const{scrollable:i}=this,n=i.hasOverflow("y");n!==t?n?e.overflowY="scroll":(e.overflowY=!0,i.overflowY="scroll",this.refreshVirtualScrollbars()):i.overflowY=!0}onPartnerPresetChange({preset:e,startDate:t,endDate:i,centerDate:n,zoomDate:r,zoomPosition:a,zoomLevel:s}){this._viewPresetChanging||this.viewPreset===e||(e.options={startDate:t,endDate:i,centerDate:n,zoomDate:r,zoomPosition:a,zoomLevel:s},this.viewPreset=e)}get partner(){return this._partner}get partners(){const e=this.partner?[this.partner]:[];return this.partneredWith&&e.push.apply(e,this.partneredWith.allValues),e}get timeAxisColumn(){return this.columns&&this._timeAxisColumn}get columns(){return super.columns}set columns(e){const t=this;let i,n,r;if(e){const r=Array.isArray(e);let a=e;r||(a=e.data),i=a&&a.length,a.some(((e,r)=>"timeAxis"===e.type&&(i=r,n=o.assign(e,t.timeAxisColumn),!0))),t.isVertical?(t._horizontalColumns=e,a=[o.assign({type:"verticalTimeAxis",locked:!0},t.verticalTimeAxisColumn),a[i]],i=1):a=a.slice(),a[i]=u({type:"timeAxis",locked:!1,cellCls:t.timeCellCls,mode:t.mode},n),r?e=a:e.data=a}super.columns=e,e&&(r=t._timeAxisColumn=t.columns.find((e=>e.isTimeAxisColumn)),t.isVertical&&(t.verticalTimeAxisColumn=t.columns.find((e=>e.isVerticalTimeAxisColumn)),t.verticalTimeAxisColumn.relayAll(t)),r.relayAll(t))}onColumnsChanged({action:e,changes:t,record:i}){const{timeAxisColumn:n,columns:r}=this;"dataset"!==e||r.includes(n)?i===n&&"width"in t&&this.updateCanvasSize():r.add(n,!0),super.onColumnsChanged(...arguments)}get timeView(){const e=this;return e.columns&&e.isVertical?e.verticalTimeAxisColumn&&e.verticalTimeAxisColumn.view:e.timeAxisColumn&&e.timeAxisColumn.timeAxisView}updateEventCls(e){const t=this;t.eventSelector||(t.unreleasedEventSelector=t.eventSelector=`.${e}-wrap`),t.eventInnerSelector||(t.eventInnerSelector=`.${e}`)}set timeAxisViewModel(e){var t;const i=this,n=i._timeAxisViewModel,r={name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",prio:100,thisObj:i};i.partner&&!e||n&&n===e||((null==n?void 0:n.owner)===i&&n.destroy(),i.detachListeners("timeAxisViewModel"),null!==(t=e)&&void 0!==t&&t.isTimeAxisViewModel?e.ion(r):e=Ze.new({mode:i._mode,snap:i.snap,forceFit:i.forceFit,timeAxis:i.timeAxis,suppressFit:i.suppressFit,internalListeners:r,owner:i},e),i.isConfiguring||(i.isHorizontal?i.timeAxisColumn.timeAxisViewModel=e:i.verticalTimeAxisColumn.view.model=e),i._timeAxisViewModel=e,i.relayEvents(e,["update"],"timeAxisViewModel"),n&&e&&i.trigger("timeAxisViewModelChange",{timeAxisViewModel:e}))}get timeAxisViewModel(){return this._timeAxisViewModel||(this.timeAxisViewModel=null),this._timeAxisViewModel}get suppressFit(){var e,t;return null!==(e=null===(t=this._timeAxisViewModel)||void 0===t?void 0:t.suppressFit)&&void 0!==e?e:this._suppressFit}set suppressFit(e){this._timeAxisViewModel?this.timeAxisViewModel.suppressFit=e:this._suppressFit=e}set timeAxis(e){var t;const i=this,n=i._timeAxis,r={name:"timeAxis",reconfigure:"onTimeAxisReconfigure",thisObj:i};i.partner&&!e||n&&n===e||(n&&n.owner===i&&n.destroy(),i.detachListeners("timeAxis"),null!==(t=e)&&void 0!==t&&t.isTimeAxis||(e=o.assign({owner:i,viewPreset:i.viewPreset,autoAdjust:i.autoAdjustTimeAxis,weekStartDay:i.weekStartDay,forceFullTicks:i.fillTicks&&i.snap},e),i.startDate&&(e.startDate=i.startDate),i.endDate&&(e.endDate=i.endDate),i.workingTime&&i.applyWorkingTime(e),e=new ve(e)),e.ion(r),i._timeAxis=e)}onTimeAxisReconfigure({config:e,oldConfig:t}){if(e){(!t||t.startDate-e.startDate||t.endDate-e.endDate)&&this.trigger("dateRangeChange",{old:{startDate:t.startDate,endDate:t.endDate},new:{startDate:e.startDate,endDate:e.endDate}})}this.trigger("timeAxisChange",{config:e})}get timeAxis(){return this._timeAxis||(this.timeAxis=null),this._timeAxis}updateForceFit(e){this._timeAxisViewModel&&(this._timeAxisViewModel.forceFit=e)}set workingTime(e){this._workingTime=e,this.isConfiguring||this.applyWorkingTime(this.timeAxis)}get workingTime(){return this._workingTime}applyWorkingTime(e){const t=this,i=t._workingTime;if(i){let t=null;i.fromHour>=0&&i.fromHour<24&&i.toHour>i.fromHour&&i.toHour<=24&&i.toHour-i.fromHour<24&&(t={from:i.fromHour,to:i.toHour});let n=null;i.fromDay>=0&&i.fromDay<7&&i.toDay>i.fromDay&&i.toDay<=7&&i.toDay-i.fromDay<7&&(n={from:i.fromDay,to:i.toDay}),e.include=t||n?{hour:t,day:n}:null}else e.include=null;var n;t.isPainted&&(t.timeAxisColumn.refreshHeader(),null===(n=t.features.columnLines)||void 0===n||n.refresh(),t.refreshWithTransition())}updateStartDate(e){this.setStartDate(e)}setStartDate(e,t=!0){const i=this,n=i._timeAxis,{startDate:r,endDate:a,mainUnit:s}=n||gt;if("string"==typeof e&&(e=l.parse(e)),n&&a){if(e){let n=a;if(t&&r){const t=l.diff(r,a,s,!0);n=l.add(e,t,s)}i.setTimeSpan(e,n)}}else i._tempStartDate=e}get startDate(){const e=this;return e._timeAxis?e._timeAxis.startDate:e._tempStartDate||new Date}changeEndDate(e){"string"==typeof e&&(e=l.parse(e)),this.setEndDate(e)}setEndDate(e,t=!1){const i=this,n=i._timeAxis,{startDate:r,endDate:a,mainUnit:s}=n||gt;if("string"==typeof e&&(e=l.parse(e)),n&&r){if(e){let n=r;if(t&&a){const t=l.diff(r,a,s,!0);n=l.add(e,-t,s)}i.setTimeSpan(n,e)}}else i._tempEndDate=e}get endDate(){const e=this;return e._timeAxis?e._timeAxis.endDate:e._tempEndDate||l.add(e.startDate,e.viewPreset.defaultSpan,e.viewPreset.mainHeader.unit)}changeVisibleDate(e){return e instanceof Date?{date:e}:e}updateVisibleDate(e){const t=this;t.isPainted?t.scrollToDate(e.date,e):t.ion({paint:()=>t.scrollToDate(e.date,e),once:!0})}get features(){return super.features}set features(e){"regionResize"in(e=!0===e?{}:e)||(e.regionResize=!0),super.features=e}get eventStyle(){return this._eventStyle}set eventStyle(e){this._eventStyle=e,this.refreshWithTransition(),this.trigger("stateChange")}get eventColor(){return this._eventColor}set eventColor(e){this._eventColor=e,this.refreshWithTransition(),this.trigger("stateChange")}onLocaleChange(){super.onLocaleChange();const e=this.timeAxis.autoAdjust;this.timeAxis.reconfigure({autoAdjust:!1}),this.timeAxis.autoAdjust=e}onBodyResize(e,t,{width:i,height:n}){this.isVertical&&t&&i!==t.width&&delete this.timeAxisSubGrid._width;const r=this.timeAxisSubGrid.element.offsetWidth;this._bodyRectangle&&t&&n!==t.height&&this.onSchedulerViewportResize(r,n,r,t.height)}onSchedulerViewportResize(e,t,i,n){if(this.isPainted){const r=this,{isHorizontal:a,partneredWith:s}=r;r.currentOrientation.onViewportResize(e,t,i,n),r.updateViewModelAvailableSpace(a?e:Math.floor(t)),s&&!r.isSyncingFromPartner&&r.syncPartnerSubGrids(),r.trigger("timelineViewportResize",{width:e,height:t,oldWidth:i,oldHeight:n})}}updateViewModelAvailableSpace(e){this.timeAxisViewModel.availableSpace=e}onTimeAxisViewModelUpdate(){this._viewPresetChanging||(this.updateCanvasSize(),this.currentOrientation.onTimeAxisViewModelUpdate())}syncPartnerSubGrids(){this.partneredWith.forEach((e=>{e.isSyncingFromPartner||(e.isSyncingFromPartner=!0,this.eachSubGrid((t=>{const i=e.subGrids[t.region];i.width!==t.width&&(t.collapsed?i.collapse():(i.collapsed&&i.expand(),t.flex?t.flex!==i.flex&&(i.flex=t.flex):i.width=t.width))})),e.isSyncingFromPartner=!1)}))}get currentOrientation(){throw new Error("Implement in subclass")}get isHorizontal(){return!0}get backgroundCanvas(){return this._backgroundCanvas}get foregroundCanvas(){return this._foregroundCanvas}get svgCanvas(){const e=this;if(!e._svgCanvas){const t=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("id",b.generateId("svg")),t.retainElement=!0,e.foregroundCanvas.appendChild(t),e.trigger("svgCanvasCreated",{svg:t})}return e._svgCanvas}get timeAxisSubGridElement(){var e;this._timeAxisSubGridElement||(this.getConfig("regions"),this._timeAxisSubGridElement=null===(e=this.timeAxisColumn)||void 0===e?void 0:e.subGridElement);return this._timeAxisSubGridElement}updateCanvasSize(){const e=this,{totalSize:t}=e.timeAxisViewModel,i=e.isHorizontal?t:e.timeAxisColumn.width;let n=!1;return e.isVertical&&(e.isPainted&&e.refreshTotalHeight(t+e._rowBorderHeight,!0),e.suppressFit&&m.setLength(e.foregroundCanvas,"height",t),n=!0),i!==e.$canvasWidth&&e.foregroundCanvas&&(e.backgroundCanvas&&m.setLength(e.backgroundCanvas,"width",i),m.setLength(e.foregroundCanvas,"width",i),e.$canvasWidth=i,n=!0),n}getHeaderDomConfigs(e){}getForegroundDomConfigs(e){}async onStoreDataChange({action:e}){const t=this;t.isVisible?("dataset"===e&&t.project.isRepopulatingStores&&await t.project.await("refresh",!1),super.onStoreDataChange(...arguments)):t.whenVisible("refresh",t,[!0])}refresh(e=!0){const t=this;t.isPainted&&!t.refreshSuspended&&(t.hasVisibleEvents||t.timeAxisSubGridElement.querySelector(t.eventSelector)?t.isEngineReady?t.refreshRows(!1,e):(t.refreshAfterProjectRefresh=!0,t.currentOrientation.refreshAllWhenReady=!0):t.rowManager.trigger("refresh"))}render(){const e=this,t=e.timeAxisSubGridElement;e.useBackgroundCanvas&&(e._backgroundCanvas=m.createElement({className:"b-sch-background-canvas",parent:t,nextSibling:t.firstElementChild}));const i=e._foregroundCanvas=m.createElement({className:"b-sch-foreground-canvas",style:`font-size:${e.rowHeight-2*e.resourceMargin}px`,parent:t});e.timeAxisSubGrid.insertRowsBefore=i,e.isVertical&&e.suppressFit&&e.updateCanvasSize(),super.render(...arguments)}refreshRows(e=!1,t=!0){this.isConfiguring||(this.currentOrientation.refreshRows(t),super.refreshRows(e))}getCellDataFromEvent(e,t){return t&&(t=!Boolean(e.target.closest(".b-sch-foreground-canvas"))),super.getCellDataFromEvent(e,t)}runWithTransition(e,t){const i=this;i.isVisible&&(null!=t&&!0!==t||(t=i.transitionDuration),t&&i.enableEventAnimations&&(i.hasTimeout("exitTransition")||(i.isAnimating=!0),ht.delay=t,i.setTimeout(ht))),e()}exitTransition(){this.isAnimating=!1,this.trigger("transitionend")}async waitForAnimations(){this.isEngineReady||await this.project.await("dataReady",!1),await super.waitForAnimations()}refreshWithTransition(e,t){this.isPainted&&!this.refreshSuspended&&this.runWithTransition((()=>this.refresh(e)),t)}get visibleDateRange(){return this.currentOrientation.visibleDateRange}isRowNumberSelecting(...e){return super.isRowNumberSelecting(...e)||e.some((e=>{var t;return e.column?e.column.isTimeAxisColumn:null===(t=e.cell)||void 0===t?void 0:t.closest(".b-timeaxis-cell")}))}formatDuration(e,t=this.durationDisplayPrecision){const i=Math.pow(10,t);return Math.round(e*i)/i}beginListeningForBatchedUpdates(){this.listenToBatchedUpdates=(this.listenToBatchedUpdates||0)+1}endListeningForBatchedUpdates(){this.listenToBatchedUpdates&&(this.listenToBatchedUpdates-=1)}}s(mt,"configurable",{partnerSharedConfigs:{value:["timeAxisViewModel","timeAxis","viewPreset"],$config:{merge:"distinct"}},startDate:{$config:{equal:"date"},value:null},endDate:{$config:{equal:"date"},value:null},stickyHeaders:!0,visibleDate:null,eventCls:null,forceFit:!1,timeZone:null}),s(mt,"properties",{timeCellSelector:null}),mt.initClass(),M.setVersion("scheduler","5.3.0"),mt._$name="TimelineBase";export{ye as AbstractTimeRanges,ee as Base,te as CalendarCacheIntervalMultiple,ie as CalendarCacheMultiple,Te as ColumnLines,je as Dependencies,Ee as DependencyCreation,$e as DependencyTooltip,fe as DragBase,we as DragCreateBase,ae as DurationColumn,Be as EventFilter,be as EventResize,de as HorizontalTimeAxis,Ne as NonWorkingTime,Ue as NonWorkingTimeMixin,ge as PresetStore,ze as RectangularPathFinder,ce as ResourceHeader,Ge as ScheduleTooltip,ve as TimeAxis,le as TimeAxisBase,ue as TimeAxisColumn,Xe as TimeAxisHeaderMenu,ut as TimeAxisSubGrid,Ze as TimeAxisViewModel,mt as TimelineBase,Ke as TimelineDateMapper,Qe as TimelineDomEvents,nt as TimelineEventRendering,st as TimelineScroll,dt as TimelineState,tt as TimelineViewPresets,it as TimelineZoomable,Ce as TooltipBase,he as ViewPreset,re as combineCalendars,me as pm};
//# sourceMappingURL=TimelineBase.js.map
