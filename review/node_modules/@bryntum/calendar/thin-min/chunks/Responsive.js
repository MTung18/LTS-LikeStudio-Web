/*!
 *
 * Bryntum Calendar 5.3.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
import{Base as e,_objectSpread2 as t,DynamicObject as n,_defineProperty as s,ObjectHelper as r,StringHelper as i,TextField as o,Delayable as a,BrowserHelper as l,FunctionHelper as c}from"./Editor.js";var p=s=>class extends(s||e){static get $name(){return"Featureable"}static get configurable(){return{features:null}}static get declarable(){return["featureable"]}static setupFeatureable(e){const n=t({ownerName:"client"},e.featureable);n.factory.initClass(),Reflect.defineProperty(e,"featureable",{get:()=>n})}doDestroy(){const e=this.features;super.doDestroy();for(const n in e){var t;const s=e[n];null===(t=s.destroy)||void 0===t||t.call(s)}}hasFeature(e){var t;return Boolean(null===(t=this.features)||void 0===t?void 0:t[e])}changeFeatures(e,t){if(this.isDestroying)return;const s=this,{featureable:r}=s.constructor,i=s.$features||(s.$features=new n({configName:"features",factory:r.factory,owner:s,ownerName:r.ownerName}));return i.update(e),t?void 0:i.target}get widgetClass(){}getCurrentConfig(e){const t=super.getCurrentConfig(e),{features:n}=t;if(n)for(const e in n)0===Object.keys(n[e]).length&&(n[e]=!0);return t}};const{defineProperty:u}=Object,{hasOwn:v}=r,g=Symbol("fencible"),d=[],f=e=>Array.from(new Set(e)),h=e=>e?f(i.split(e)):d,b=(e,t,n)=>{!0===n&&(n=t),r.isObject(n)||(n={all:n});let s=h(n.any);const i=h(n.all),o=n.lock?h(n.lock):f(i.concat(s)),a=t+"Impl";s=s.length?s:null,!e[a]&&u(e,a,{configurable:!0,value:e[t]}),u(e,t,{configurable:!0,value:function(...e){const t=this,n=v(t,g)?t[g]:t[g]={},r=e=>!n[e];if(i.every(r)&&(!s||s.some(r)))try{return o.forEach((e=>n[e]=(n[e]||0)+1)),t[a](...e)}finally{o.forEach((e=>--n[e]))}}})};var y=n=>{var r;return s(r=class extends(n||e){static setupFenced(e){let{fenced:n}=e;const s=n.static,r=[];s&&(n=t({},n),delete n.static,r.push([s,e])),r.push([n,e.prototype]);for(const[e,t]of r)for(const n in e)b(t,n,e[n])}get widgetClass(){}},"$name","Fencible"),s(r,"declarable",["fenced"]),r};class m extends o{static get $name(){return"FilterField"}static get type(){return"filterfield"}static get configurable(){return{field:null,store:null,filterFunction:null,clearable:!0,keyStrokeChangeDelay:100,onChange({value:e}){const{store:t,field:n,filterFunction:s}=this;if(t){const r=`${n||this.id}-Filter`;if(0===e.length)t.removeFilter(r);else{let i;s?i=t=>s(t,e):(e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=t=>t.get(n).match(new RegExp(e,"i"))),t.filter({id:r,filterBy:i})}}}}}updateValue(e,t){super.updateValue(e,t),e&&this.isConfiguring&&this.onChange({value:e})}}m.initClass(),m._$name="FilterField";const k=[],w=e=>"*"!==e[0],C=(e,t)=>{const n=e[t]||null;return delete e[t],n},$=e=>e.responsiveRoot,R={number:e=>({width:t})=>t<=e&&e},S=e=>(delete e.once,{callback:C(e,"callback"),configs:e,when:C(e,"when")}),W=(e,...t)=>{const n=t.flatMap((e=>(null==e?void 0:e.once)||k)),s=e.mergeConfigs(...t),r=S(s);return r.once=n.length?S(e.mergeConfigs(...n)):null,r};var B=t=>{var n;return n=class extends((t||e).mixin(a,y)){get isResponsivePending(){return 0===this.responsiveUpdateCount&&this.hasConfig("responsive")}get isResponsiveUpdating(){var e;return this._responsiveUpdating||(null===(e=this.responsiveWidget)||void 0===e?void 0:e._responsiveUpdating)}updateResponsive(e){const t=this,n=t.constructor,{responsiveDefaults:s}=t,i=Array.from(new Set(r.keys(e).concat(r.keys(s)))).filter(w);let o,a,l,c,p=null;if(e)for(a of(p={"*":W(n,s["*"],e["*"])},i)){var u;if(l=e[a],null!==l&&!1!==l)o=o||l&&"when"in l,p[a]=W(n,s["*"],s[a],e["*"],l),c=p[a].when,p[a].when=(null===(u=R[typeof c])||void 0===u?void 0:u.call(R,c))||c}t.$responsiveStates=p,t.$responsiveWhen=o,t.syncResponsiveWidget()}updateResponsiveState(e,t){var n;const s=this,{$responsiveStates:r}=s,i=1==++s.responsiveStateChanges,o=null===(n=s.element)||void 0===n?void 0:n.classList,a=r["*"],l=r[e]||a,c=i&&(l.once||a.once),p=i&&s.isStateful,u=s.responsiveWidget;let v=l.configs,g=null==c?void 0:c.configs;g&&(v=v?s.constructor.mergeConfigs(v,g):g),t&&(null==o||o.remove(`b-responsive-${t.toLowerCase()}`)),e&&(null==o||o.add(`b-responsive-${e.toLowerCase()}`)),p&&(g=s.loadStatefulData(),g&&(v=v?s.constructor.mergeConfigs(v,g):g),s.suspendStateful()),s._responsiveUpdating=!0;try{var d,f,h,b;null===(d=s.trigger)||void 0===d||d.call(s,"beforeResponsiveStateChange",{state:e,oldState:t,target:u}),v&&s.setConfig(v),null===(f=l.callback)||void 0===f||f.call(l,{source:s,state:e,oldState:t,target:u,initial:i}),null==c||null===(h=c.callback)||void 0===h||h.call(c,{source:s,state:e,oldState:t,target:u,initial:i}),null===(b=s.trigger)||void 0===b||b.call(s,"responsiveStateChange",{state:e,oldState:t,target:u})}finally{s._responsiveUpdating=!1,p&&s.resumeStateful()}}get responsiveTarget(){return this.responsiveWidget||this._responsiveTarget}updateResponsiveTarget(){this.syncResponsiveWidget()}updateResponsiveWidget(e){var t;const n=this,s=e&&n.responsiveUpdate;null===(t=n.$responsiveWrapper)||void 0===t||t.destroy(),n.$responsiveWrapper=e&&((e,t)=>{let n,s=Proxy.revocable(e,{get:(t,s)=>(n&&(n[s]=!0),e[s])}),r=c.after(e,"onConfigChange",((e,{name:s})=>{var r;null!==(r=n)&&void 0!==r&&r[s]&&t()})),i=e.ion({resize:()=>{t()}});return e.monitorResize=!0,{widget:e,get object(){var e;return null===(e=s)||void 0===e?void 0:e.proxy},destroy(){s&&(s.revoke(),r(),i(),s=r=i=null)},reset(){n=Object.create(null)}}})(e,s),null==s||s.now()}responsiveUpdate(){const e=this,{$responsiveStates:t,$responsiveWrapper:n}=e,s=null==n?void 0:n.widget;if(t&&n){let r,i,o=null,a=0,c=t;for(i in s&&s!==e&&!e.$responsiveWhen&&(s.getConfig("responsive"),c=s.$responsiveStates||c),n.reset(),t)"*"!==i&&(r=c[i].when(n.object,l),null!=r&&!1!==r&&(!o||r<a)&&(o=i,a=r));++e.responsiveUpdateCount,e.responsiveState=o}}syncResponsiveWidget(){const e=this;let t,n=null;if(!e.isDestroying&&e.responsive){var s;if(t=e.responsiveTarget,n=t){if("string"==typeof t&&(n="@"===t?e:"@"===t[0]?e[t.substring(1)]:e.up(t),!n))throw new Error(`No match for responsiveTarget="${t}"`)}else n=!e.responsiveRoot&&(null===(s=e.up)||void 0===s?void 0:s.call(e,$))||e;if(!n.isWidget)throw new Error(`${n.constructor.$$name} is not a widget and cannot be a responsiveTarget`)}return e.responsiveWidget=n,n}changeBreakpoints(e){return r.assertObject(e,"breakpoints"),null!=e&&e.width&&Object.keys(e.width).forEach((t=>{e.width[t].maxWidth=t})),null!=e&&e.height&&Object.keys(e.height).forEach((t=>{e.height[t].maxHeight=t})),e}updateBreakpoints(e){e&&(this.monitorResize=!0)}getBreakpoint(e,t){const n=Object.keys(e).map((e=>parseInt(e))).sort().find((e=>t<=e));return e[null!=n?n:e["*"]&&"*"]}activateBreakpoint(e,t){const n=this,s=n[`current${e}Breakpoint`];var r,i;t!==s&&(n[`current${e}Breakpoint`]=t,n.setConfig(t.configs),s&&n.element.classList.remove(`b-breakpoint-${s.name.toLowerCase()}`),n.element.classList.add(`b-breakpoint-${t.name.toLowerCase()}`),n.trigger(`responsive${e}Change`,{breakpoint:t,prevBreakpoint:s}),null===(r=t.callback)||void 0===r||r.call(t,{source:n,breakpoint:t,prevBreakpoint:s}),null===(i=n.recompose)||void 0===i||i.call(n))}applyResponsiveBreakpoints(e,t){var n;const s=this,{width:r,height:i}=null!==(n=s.breakpoints)&&void 0!==n?n:{};if(r){const t=s.getBreakpoint(r,e);s.activateBreakpoint("Width",t)}if(i){const e=s.getBreakpoint(i,t);s.activateBreakpoint("Height",e)}}onInternalResize(e,t,n,s,r){super.onInternalResize(e,t,n,s,r),this.applyResponsiveBreakpoints(t,n)}},s(n,"$name","Responsive"),s(n,"configurable",{responsive:{$config:{lazy:"paint"},value:null},responsiveDefaults:{small:{when:400},medium:{when:800},large:{when:()=>1/0},"*":{}},responsiveRoot:null,responsiveState:null,responsiveTarget:{value:null,$config:{lazy:"paint"}},responsiveWidget:{value:null,$config:{nullify:!0}},breakpoints:null}),s(n,"delayable",{responsiveUpdate:"raf"}),s(n,"fenced",{syncResponsiveWidget:!0}),s(n,"prototypeProperties",{responsiveStateChanges:0,responsiveUpdateCount:0}),n};export{p as Featureable,y as Fencible,m as FilterField,B as Responsive};
//# sourceMappingURL=Responsive.js.map
