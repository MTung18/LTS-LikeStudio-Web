/*!
 *
 * Bryntum Calendar 5.3.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
import{_defineProperty as e,Field as i,EventHelper as t,DateHelper as n,Widget as a,ObjectHelper as s,Layout as l}from"./Editor.js";import{TimeField as d}from"./MessageDialog.js";class r extends i{doDestroy(){this.dateField.destroy(),this.timeField.destroy(),super.doDestroy()}get focusElement(){return this.dateField.input}get innerElements(){return[this.dateField.element,this.timeField.element]}internalOnKeyEvent(){}updateRevertOnEscape(e){this.timeField.revertOnEscape=e,this.dateField.revertOnEscape=e}changeTimeField(e){const i=this,n=d.new({revertOnEscape:i.revertOnEscape,syncInvalid(...e){const t=i.updatingInvalid;d.prototype.syncInvalid.apply(this,e),i.timeField&&!t&&i.syncInvalid()}},e);return t.on({element:n.element,keydown:"onTimeFieldKeyDown",thisObj:i}),i.readOnly&&(n.readOnly=!0),n}updateTimeField(e){const i=this;e.ion({change({userAction:e,value:t}){if(e&&!i.$settingValue){const e=i.dateField.value;i._isUserAction=!0,i.value=e?n.copyTimeValues(e,t):null,i._isUserAction=!1}},thisObj:i})}changeDateField(e){const i=this,n=(null==e?void 0:e.type)||"datefield",l=a.resolveType(e.type||"datefield"),d=a.create(s.assign({type:n,revertOnEscape:i.revertOnEscape,syncInvalid(...e){const t=i.updatingInvalid;l.prototype.syncInvalid.apply(this,e),i.dateField&&!t&&i.syncInvalid()}},e));return t.on({element:d.element,keydown:"onDateFieldKeyDown",thisObj:i}),i.readOnly&&(d.readOnly=!0),d.ion({keydown:({event:e})=>{var i;"Tab"===e.key&&!e.shiftKey&&null!==(i=this.timeField)&&void 0!==i&&i.isVisible&&(e.stopPropagation(),e.cancelBubble=!0)}}),d}get childItems(){return[this.dateField,this.timeField]}updateDateField(e){const i=this;e.ion({change({userAction:e,value:t}){e&&!i.$isInternalChange&&(i._isUserAction=!0,i.timeField.value?t&&n.copyTimeValues(t,i.timeField.value):i.timeField.value=t,i.value=t,i._isUserAction=!1)},thisObj:i})}updateWeekStartDay(e){this.dateField&&(this.dateField.weekStartDay=e)}changeWeekStartDay(e){var i,t;return"number"==typeof e?e:null!==(i=null===(t=this.dateField)||void 0===t?void 0:t.weekStartDay)&&void 0!==i?i:n.weekStartDay}syncInputFieldValue(e=this.isConfiguring){super.syncInputFieldValue(!0);const i=this,{dateField:t,timeField:n}=i,a=t.highlightExternalChange,s=n.highlightExternalChange;e||i.highlightExternalChange||(e=!0),i.$isInternalChange=!0,t.highlightExternalChange=!1,t.value=null,t.highlightExternalChange=a,e&&(n.highlightExternalChange=t.highlightExternalChange=!1),n.value=t.value=i.inputValue,t.highlightExternalChange=a,n.highlightExternalChange=s,i.$isInternalChange=!1,i.syncInvalid()}onTimeFieldKeyDown(e){const i=this;if("Enter"===e.key||"Tab"===e.key){const e=i.dateField.value;i._isUserAction=!0,i.value=e?n.copyTimeValues(e,i.timeField.value):null,i._isUserAction=!1}}onDateFieldKeyDown(e){const i=this;"Tab"!==e.key||e.shiftKey?"Enter"===e.key&&(i.value=i.dateField.value):(e.stopPropagation(),e.preventDefault(),i.timeField.focus())}updateRequired(e,i){this.timeField.required=this.dateField.required=e}updateReadOnly(e,i){super.updateReadOnly(e,i),this.isConfiguring||(this.timeField.readOnly=this.dateField.readOnly=e)}onDisabled(e){this.timeField.disabled=this.dateField.disabled=e}focus(){this.dateField.focus()}hasChanged(e,i){return!n.isEqual(e,i)}get isValid(){return this.timeField.isValid&&this.dateField.isValid}setError(e,i){[this.dateField,this.timeField].forEach((t=>t.setError(e,i)))}getErrors(){const e=[...this.dateField.getErrors()||[],...this.timeField.getErrors()||[]];return e.length?e:null}clearError(e,i){[this.dateField,this.timeField].forEach((t=>t.clearError(e,i)))}updateInvalid(){this.updatingInvalid=!0,[this.dateField,this.timeField].forEach((e=>e.updateInvalid())),this.updatingInvalid=!1}}e(r,"configurable",{timeField:{},dateField:{keepTime:!0,step:"1 d"},weekStartDay:null,inputTemplate:()=>"",ariaElement:"element"}),e(r,"$name","DateTimeField"),e(r,"type","datetimefield"),e(r,"alias","datetime"),r.initClass(),r._$name="DateTimeField";const o=["b-slide-out-left","b-slide-out-right","b-slide-in-left","b-slide-in-right"];class h extends l{onChildAdd(e){super.onChildAdd(e);const i=this,{activeItem:t,owner:n}=i,a=null!=n.activeIndex?n.activeIndex:i.activeIndex||0,s=n.items.indexOf(e),l=null!=t?e===t:s===a;e.ion({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:i}),l?(i._activeIndex=s,i._activeItem=e,e.show()):(e.$isDeactivating=!0,e.hide(),e.$isDeactivating=!1)}onChildRemove(e){super.onChildRemove(e);const i=this;i._activeItem===e&&i.activateSiblingOf(e),i._activeIndex=i.owner.items.indexOf(i._activeItem),e.un({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:i})}onBeforeChildShow({source:e}){if(!this.owner.isConfiguring&&!e.$isActivating)return this.activeItem=e,!1}onBeforeChildHide({source:e}){if(!this.owner.isConfiguring&&!e.$isDeactivating)return this.activateSiblingOf(e),!1}activateSiblingOf(e){const{owner:i}=this,t=i.items.slice(),n=t.indexOf(e);t.splice(n,1),this.activeIndex=Math.min(n,t.length-1)}setActiveItem(e,i=this.activeIndex,n){const s=this,{owner:l}=s,{items:d}=l,r=e instanceof a,h=d[i],c=l.items[e=r?d.indexOf(e):parseInt(e,10)],m=!1!==(null==n?void 0:n.animation),v=!(null!=n&&n.silent),u={prevActiveIndex:i,prevActiveItem:h};if(c&&!c.$isActivating&&c!==h){var g;const a=h&&h.element,d=c&&c.element;if(s.animateDetacher){const e=s.animateDetacher.event;if(e.activeItem===c)return e.promise;s.animateDetacher(),e.prevActiveItem.element.classList.remove(...o),e.activeItem.element.classList.remove(...o),s.animateDetacher=null}if(u.activeIndex=e,u.activeItem=c,v&&!1===l.trigger("beforeActiveItemChange",u))return null;const r=s._activeIndex!==u.activeIndex;r&&(s._activeIndex=u.activeIndex),v&&(null===(g=l.onBeginActiveItemChange)||void 0===g||g.call(l,u)),r&&(s._activeIndex=u.prevActiveIndex),m&&a&&l.isVisible&&s.animateCardChange?u.promise=s.cardChangeAnimation=new Promise(((r,m)=>{const g=h.monitorResize;h.monitorResize=!1,s.contentElement.style.overflowX="hidden",h._hidden=!0,c.$isActivating=!0,c.show(),c.$isActivating=!1,a.classList.add(e>i?"b-slide-out-left":"b-slide-out-right"),d.classList.add(e<i?"b-slide-in-left":"b-slide-in-right"),l.isAnimating=!0,s.animateDetacher=t.onTransitionEnd({mode:"animation",element:d,thisObj:h,handler(){l.isAnimating=s.cardChangeAnimation=!1,s.animateDetacher?(s.animateDetacher=null,d.classList.remove(...o),a&&(a.classList.remove(...o),h.$isDeactivating=!0,h._hidden=!1,h.hide(),h.monitorResize=g,h.$isDeactivating=!1),s.contentElement.style.overflowX="",s.onActiveItemChange(u,r,!v)):s.setActiveItem(e,i,n)}}),s.animateDetacher.reject=m,s.animateDetacher.event=u})):(c.$isActivating=!0,c.show(),c.focus(),c.$isActivating=!1,h&&(h.$isDeactivating=!0,h.hide(),h.$isDeactivating=!1),s.onActiveItemChange(u,null,!v))}return u}onActiveItemChange(e,i,t){const n=this;n._activeItem=e.activeItem,n._activeIndex=e.activeIndex,!t&&n.owner.trigger("activeItemChange",e),e.activeItem.focus(),null==i||i(e)}renderChildren(){const{owner:e}=this;e.contentElement.classList.toggle(this.hideChildHeaderCls,e.suppressChildHeaders),super.renderChildren()}changeActiveIndex(e){const{owner:i}=this;return i.isConfiguring&&!i._items?e:Math.min(e,i.items.length-1)}updateActiveIndex(e,i){this.owner.isConfiguring||this.setActiveItem(e,i)}updateActiveItem(e){this.owner.isConfiguring||this.setActiveItem(e,this.activeIndex)}get isChangingCard(){return Boolean(this.animateDetacher)}}e(h,"$name","Card"),e(h,"type","card"),e(h,"configurable",{containerCls:"b-card-container",itemCls:"b-card-item",hideChildHeaderCls:"b-hide-child-headers",animateCardChange:!0,activeItem:null,activeIndex:null}),h.initClass(),h._$name="Card";export{r as DateTimeField};
//# sourceMappingURL=Card.js.map
