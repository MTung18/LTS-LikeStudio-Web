/*!
 *
 * Bryntum Calendar 5.3.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
import{Widget as e,Tooltip as t,StringHelper as s,DomSync as r}from"./Editor.js";const a="http://www.w3.org/2000/svg",n={bar:1,outline:2,text:3},l=(e,t)=>parseInt(e.dataset.order,10)-parseInt(t.dataset.order,10),i=e=>e.field,o=()=>!1;class c extends e{static get type(){return"histogram"}static get $name(){return"Histogram"}static get defaultConfig(){return{data:null,values:null,series:null,topValue:null,element:{children:[{ns:a,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:a,tag:"g",reference:"scaledSvgGroup"},{ns:a,tag:"g",reference:"unscaledSvgGroup"}]}]},omitZeroHeightBars:null,monitorResize:!0,getRectClass:null,getBarTip:null,getBarText:null,getBarTextRenderData:null,getBarTextTip:null}}construct(e){super.construct(e),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}set tip(e){var s;const r=this;null===(s=r.tip)||void 0===s||s.destroy(),r._tip=e?t.new({owner:r,forElement:r.svgElement,forSelector:"rect",internalListeners:{beforeShow:"up.onBeforeTipShow"}},e):null}onElementResize(){super.onElementResize(...arguments);const e=this.svgElement.getBoundingClientRect();this.scaledSvgGroup.setAttribute("transform",`scale(${e.width} ${e.height})`)}onBeforeTipShow({source:e}){const t=parseInt(e.activeTarget.dataset.index);e.html=e.contentTemplate({histogram:this,index:t})}set series(e){const t=this._series={};for(const s in e)if(!1!==e[s]){const r=t[s]=Object.assign({},e[s]);!r.type&&e[s].type&&(r.type=e[s].type),!r.field&&e[s].field&&(r.field=e[s].field),"order"in t||(r.order=n[r.type]),r.id=s}this.scheduleRefresh()}get series(){return this._series}set data(e){const t=this;if(t._data=e,!t.topValue){const s=Object.values(t.series).map(i);for(let r=0,{length:a}=e;r<a;r++)for(let a=0,{length:n}=s;a<n;a++)t.topValue=Math.max(t.topValue||0,e[r][s[a]])}t.scheduleRefresh()}get data(){return this._data}set topValue(e){this._topValue=e,this.scheduleRefresh()}get topValue(){return this._topValue}scheduleRefresh(){}refresh(){const e=this,{series:t,_tip:a}=e,n=[];for(const r in t){const a=t[r],l=e[`draw${s.capitalize(a.type)}`](a);Array.isArray(l)?n.push.apply(n,l):n.push(l)}n.sort(l),r.syncChildren({domConfig:{children:n},configEquality:o},e.scaledSvgGroup),r.syncChildren({domConfig:{children:e.drawText()}},e.unscaledSvgGroup),a&&a.isVisible&&e.onBeforeTipShow({source:a})}drawBar(e){const t=this,{topValue:s,data:r,omitZeroHeightBars:n,barStyle:l}=t,{field:i,order:o}=e,c=1/r.length,h=[];let d;for(let g=0,u=0,{length:p}=r;g<p;g++,u+=d){const p=r[g],f=p[i],m=p.height||(f>s?s:f)/s,v=1-m,$=p.rectConfig={ns:a,tag:"rect",dataset:{}},b=t.callback("getBarTip",t,[e,$,p,g]);d=p.width||c,l?$.style=l:delete $.style,Object.assign($.dataset,{index:g,order:o}),Object.assign($,{x:u,y:v,width:d,height:m,class:t.callback("getRectClass",t,[e,$,p,g])}),b?$.dataset.btip=b:delete $.dataset.btip,!m&&n||h.push($)}return h}drawOutline(e){const{topValue:t,data:s}=this,{field:r,order:n}=e,l=1/s.length,i=["M 0,1"],o=e.outlineElement||(e.outlineElement={ns:a,tag:"path",dataset:{order:n}});let c,h="M",d="L";for(let e=0,a=0,{length:n}=s;e<n;e++){const n=1-s[e][r]/t;c=s[e].width||l,i.push(`${h} ${a},${n} ${d} ${a+=c},${n}`),h=d=""}return o.d=i.join(" "),o}drawText(){const e=this,{data:t}=e,s=1/t.length,r=[];for(let n,l=0,i=0,{length:o}=t;l<o;l++,i+=n){n=t[l].width||s;const o=e.callback("getBarText",e,[t[l],l]);if(o){const s=e.callback("getBarTextRenderData",e,[{ns:a,tag:"text",className:"b-bar-legend",html:o,x:100*(i+n/2)+"%",y:void 0!==t[l].y?t[l].y:"100%",dataset:{index:l}},t[l],l]),c=e.callback("getBarTextTip",e,[s,t[l],l]);c?s.dataset.btip=c:delete s.dataset.btip,r.push(s)}}return r}getBarText(e,t){return""}getBarTextRenderData(e,t,s){return e}getBarTip(e,t,s,r){}getBarTextTip(e,t,s){}getRectClass(e,t,s,r){return""}}c.initClass(),c._$name="Histogram";const h="http://www.w3.org/2000/svg";class d extends e{static get type(){return"scale"}static get $name(){return"Scale"}static get configurable(){return{scalePoints:null,scaleMaxPadding:.1,horizontal:!1,align:{value:!1,$config:{merge:"replace"}},element:{children:[{ns:h,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:h,tag:"g",reference:"scaledSvgGroup",children:[{ns:h,tag:"path",reference:"pathElement"}]},{ns:h,tag:"g",reference:"unscaledSvgGroup"}]}]},monitorResize:!0}}construct(e){super.construct(e),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}changeAlign(e){return e||(e=this.horizontal?"bottom":"right"),e}updateAlign(e,t){this.element.classList.remove(`b-align-${t}`),this.element.classList.add(`b-align-${e}`)}updateHorizontal(e,t){this.element.classList.remove("b-scale-"+(t?"horizontal":"vertical")),this.element.classList.add("b-scale-"+(e?"horizontal":"vertical"))}onElementResize(){super.onElementResize(...arguments),this.scheduleRefresh()}scheduleRefresh(){}refresh(){const e=this,{horizontal:t,width:s,height:a,align:n,scalePoints:l,scaleMaxPadding:i}=e,o=l[l.length-1].value,c=[],d=[],g=1/(o+i*o);e.scaledSvgGroup.setAttribute("transform",`scale(${t?s:1} ${t?1:a})`);for(const e of l){const r=Boolean(e.text),l=g*e.value;if(r){const r={ns:h,tag:"text",className:"b-scale-tick-label",html:e.text,dataset:{tick:e.value}};t?(r.x=100*l+"%",r.y="top"===n?"1.6em":a-12):(r.x="left"===n?"12":""+(s-12),r.y=100*(1-l)+"%"),d.push(r)}t?"top"===n?c.push(`M${l},0 L${l},${r?10:5}`):c.push(`M${l},${a} L${l},${a-(r?10:5)}`):"left"===n?c.push(`M0,${1-l} L${r?10:5},${1-l}`):c.push(`M${s},${1-l} L${s-(r?10:5)},${1-l}`)}e.pathElement.setAttribute("d",c.join("")),r.syncChildren({domConfig:{children:d}},e.unscaledSvgGroup)}}d.initClass(),d._$name="Scale";export{c as Histogram,d as Scale};
//# sourceMappingURL=Scale.js.map
