/*!
 *
 * Bryntum Calendar 5.3.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
import{Widget as e,DomHelper as t,Model as r,Events as l,Localizable as o,Config as i,_objectSpread2 as n,ObjectHelper as s,StringHelper as a,Store as d,Objects as c,_defineProperty as u,Delayable as h,InstancePlugin as g,Editor as m,GlobalEvents as f,ContextMenuBase as p,BrowserHelper as b,EventHelper as C,TemplateHelper as v,ScrollManager as w,ArrayHelper as S,VersionHelper as y,Tooltip as x,CollectionFilter as R,DomSync as E,DomDataStore as F,DomClassList as I,Base as M,Rectangle as H,Scroller as _,Collection as L,LocaleHelper as T,Panel as D,Pluggable as A,State as k,LoadMaskable as B,LocaleManagerSingleton as O,AjaxStore as P,Mask as G}from"./Editor.js";import{WidgetHelper as N,Checkbox as $,MessageDialog as W,DragHelper as z,ResizeHelper as V,FieldFilterPicker as j,SUPPORTED_FIELD_DATA_TYPES as K,isSupportedDurationField as q,FieldFilterPickerGroup as U}from"./MessageDialog.js";import{GridRowModel as X}from"./GridRowModel.js";class Y{constructor(t){if(t){if(t.isLocation)return t;if(t.nodeType===Node.ELEMENT_NODE){const r=e.fromElement(t,"gridbase"),l=r&&t.closest(r.focusableSelector);if(l){const{dataset:e}=l.parentNode;this.init({grid:r,rowIndex:r.store.includes(e.id)?r.store.indexOf(e.id):e.index||-1,columnId:l.dataset.columnId}),this.initialTarget=t}}else this.init(t)}}init(e){var t;const r=this,l=r.grid=e.grid,{store:o,columns:i}=l,{visibleColumns:n}=i;if(e.target&&(r.actionTargets=[r._target=e.target]),e.record)r._id=e.record.id;else if("id"in e)r._id=e.id,null==e.id&&(r._rowIndex=-1);else{var s;const t=isNaN(e.row)?isNaN(e.rowIndex)?NaN:e.rowIndex:e.row;r._rowIndex=Math.max(Math.min(Number(t),o.count-1),l.hideHeaders?0:-1),r._id=null===(s=o.getAt(r._rowIndex))||void 0===s?void 0:s.id}if("_rowIndex"in r||(r._rowIndex=o.indexOf(r.id)),r.isSpecialRow=null===(t=r.record)||void 0===t?void 0:t.isSpecialRow,"columnId"in e)r._column=i.getById(e.columnId);else if("field"in e)r._column=i.get(e.field);else{const t=isNaN(e.column)?isNaN(e.columnIndex)?NaN:e.columnIndex:e.column;isNaN(t)?r._column="column"in e?isNaN(e.column)?e.column:n[e.column]:n[0]:(r._columnIndex=Math.min(Number(t),n.length-1),r._column=n[r._columnIndex])}"_columnIndex"in r||(r._columnIndex=n.indexOf(r._column))}get isLocation(){return!0}equals(e,t=!1){const r=this;return(null==e?void 0:e.isLocation)&&e.grid===r.grid&&(t?r.id===e.id&&r._column===e._column:e.record===r.record&&e.column===r.column&&e.target===r.target)}get rowIndex(){const{_id:e}=this,{store:t}=this.grid;return t.includes(e)?t.indexOf(e):Math.min(this._rowIndex,t.count-1)}get visibleRowIndex(){const{rowManager:e}=this.grid,{rowIndex:t}=this;return-1===t?t:Math.max(Math.min(t,e.lastFullyVisibleTow.dataIndex),e.firstFullyVisibleTow.dataIndex)}get isSelectable(){return this.grid.store.includes(this._id)&&!this.isSpecialRow}get record(){if(this._rowIndex>-1){const{store:e}=this.grid;return e.includes(this._id)?e.getById(this._id):e.getAt(this._rowIndex)}}get id(){return this._id}get column(){const{visibleColumns:e}=this.grid.columns;return null!=e&&e.includes(this._column)?this._column:null==e?void 0:e[this.columnIndex]}get columnId(){var e;return null===(e=this.column)||void 0===e?void 0:e.id}get columnIndex(){var e;return Math.min(this._columnIndex,(null===(e=this.grid.columns.visibleColumns)||void 0===e?void 0:e.length)-1)}move(e){const t=this,{record:r,column:l,grid:o}=t,{store:i}=o,n=o.columns.visibleColumns,s=new Y;let a=i.includes(r)?i.indexOf(r):t.rowIndex,d=n.includes(l)?n.indexOf(l):t.columnIndex;const c=o.hideHeaders?0:-1,u=i.count-1,h=n.length-1,g=a===c,m=a===u,f=0===d,p=d===h;switch(e){case Y.PREV_CELL:f?g||(d=h,a--):d--;break;case Y.NEXT_CELL:p?m||(d=0,a++):d++;break;case Y.UP:g||a--;break;case Y.DOWN:m||(-1===a?a=o.rowManager.firstFullyVisibleRow.dataIndex:a++);break;case Y.FIRST_COLUMN:d=0;break;case Y.LAST_COLUMN:d=h;break;case Y.FIRST_CELL:a=c,d=0;break;case Y.LAST_CELL:a=u,d=h;break;case Y.PREV_PAGE:a=Math.max(c,a-Math.floor(o.scrollable.clientHeight/o.rowHeight));break;case Y.NEXT_PAGE:a=Math.min(u,a+Math.floor(o.scrollable.clientHeight/o.rowHeight))}return s.init({grid:o,rowIndex:a,columnIndex:d}),s}get cell(){const e=this,{grid:t,id:r,_cell:l}=e;if(l)return l;var o;if(null==r)return null===(o=t.columns.getById(e.columnId))||void 0===o?void 0:o.element;{const{row:r}=e;var i;if(r)return r.getCell(e.columnId)||r.getCell(null===(i=t.columns.getAt(e.columnIndex))||void 0===i?void 0:i.id)}}get row(){return this.grid.getRowById(this.id)||this.grid.getRow(this.rowIndex)}get target(){const{cell:e,_target:t}=this,{focusableFinder:r}=this.grid;if(e)return t||(r.currentNode=this.grid.focusableFinderCell=e,r.nextNode()||e)}get isActionable(){const{cell:e,_target:r}=this,l=(null==e?void 0:e.compareDocumentPosition(t.getActiveElement(e)))&Node.DOCUMENT_POSITION_CONTAINED_BY;return Boolean(l||r&&r!==this.cell)}get isColumnHeader(){return this.cell&&-1===this.rowIndex}get isCell(){return this.cell&&this.record}}Y.UP=1,Y.NEXT_CELL=2,Y.DOWN=3,Y.PREV_CELL=4,Y.FIRST_COLUMN=5,Y.LAST_COLUMN=6,Y.FIRST_CELL=7,Y.LAST_CELL=8,Y.PREV_PAGE=9,Y.NEXT_PAGE=10,Y._$name="Location";const J=e=>"number"==typeof e||(null==e?void 0:e.endsWith("px"));class Q extends(r.mixin(l,o)){static get $name(){return"Column"}static get type(){return"column"}static get fields(){return["type","text","field","renderer","width","flex","autoWidth","autoHeight",{name:"fitMode",defaultValue:"exact"},{name:"editor",defaultValue:{}},"cellEditor","finalizeCellEdit",{name:"revertOnEscape",defaultValue:!0},{name:"invalidAction",defaultValue:"block"},{name:"sortable",defaultValue:!0,convert(e,t){if(!e)return!1;if(!0===e)return!0;const r={};return"function"==typeof e?(r.originalSortFn=e,r.sortFn=e.bind(t)):"object"==typeof e&&(Object.assign(r,e),r.fn&&(r.sortFn=r.fn,delete r.fn)),r}},{name:"searchable",defaultValue:!0},{name:"collapsible",defaultValue:!1},{name:"collapsed",defaultValue:!1},{name:"collapseMode"},{name:"filterable",defaultValue:!0,convert(e){if(!e)return!1;if(!0===e)return!0;const t={columnOwned:!0};return"function"==typeof e?t.filterFn=e:"object"==typeof e&&Object.assign(t,e),t}},{name:"sealed"},{name:"hideable",defaultValue:!0},{name:"draggable",defaultValue:!0},{name:"groupable",defaultValue:!0},{name:"resizable",defaultValue:!0},"groupRenderer","headerRenderer","tooltip","tooltipRenderer","cellCls","cls","icon","align",{name:"minWidth",defaultValue:60},"maxWidth",{name:"hidden",defaultValue:!1},{name:"locked"},{name:"region"},{name:"mergeCells",type:"boolean"},{name:"mergeable",type:"boolean",defaultValue:!0},"mergedRenderer",{name:"showColumnPicker",defaultValue:!0},{name:"enableHeaderContextMenu",defaultValue:!0},{name:"enableCellContextMenu",defaultValue:!0},"headerMenuItems","cellMenuItems","sum","summaries","summaryRenderer","responsiveLevels","tags","touchConfig","tree","filterType",{name:"htmlEncode",defaultValue:!0},{name:"htmlEncodeHeaderText",defaultValue:!0},{name:"autoSyncHtml",defaultValue:!1},{name:"alwaysClearCell",defaultValue:!1},{name:"headerWidgets"},{name:"instantUpdate",defaultValue:!1},{name:"repaintOnResize",defaultValue:!1},"editTargetSelector",{name:"exportable",defaultValue:!0},{name:"exportedType"},{name:"ariaLabel",defaultValue:"L{Column.columnLabel}"},{name:"cellAriaLabel",defaultValue:"L{cellLabel}"}]}static get autoExposeFields(){return!1}construct(e,t){var r;const l=this;l.masterStore=t,t&&(l._grid=Array.isArray(t)?t[0].grid:t.grid),l.localizableProperties=i.mergeMethods.distinct(e.localizableProperties,["text","ariaLabel","cellAriaLabel"]),e.localeClass&&(l.localeClass=e.localeClass),super.construct(...arguments),l.isLeaf&&!("field"in l.data)&&(l.field="_"+(l.type||"")+ ++Q.emptyCount,l.noFieldSpecified=!0),l.hasComplexMapping=null===(r=l.field)||void 0===r?void 0:r.includes("."),l.width||l.flex||l.children||l.set({width:Q.defaultWidth,flex:null},null,!0),l.headerWidgets&&l.initHeaderWidgets(l.headerWidgets),l.isParent&&(l.meta.visibleChildren=new Set,l.collapsible&&(l.collapsible=!0))}get isCollapsible(){var e;return(null===(e=this.children)||void 0===e?void 0:e.length)>1&&this.collapsible}get collapsed(){return this.get("collapsed")}set collapsed(e){this.set("collapsed",e,!0),this.onCollapseChange(!e),this.trigger("toggleCollapse",{collapsed:e})}onCellFocus(e){this.location=e,this.updateHeaderAriaLabel(this.localizeProperty("ariaLabel")),-1!==e.rowIndex&&this.updateCellAriaLabel(this.localizeProperty("cellAriaLabel"))}updateHeaderAriaLabel(e){t.setAttributes(this.element,{"aria-label":e})}updateCellAriaLabel(e){var r,l,o;null!==(r=this.location)&&void 0!==r&&r.isSpecialRow||null===(l=this.location)||void 0===l||!l.cell||(null!==(o=e)&&void 0!==o&&o.length||(e=this.location.column.text),t.setAttributes(this.location.cell,{"aria-label":e}))}doDestroy(){var e,t,r;null===(e=this.data)||void 0===e||null===(t=e.editor)||void 0===t||null===(r=t.destroy)||void 0===r||r.call(t),this.destroyHeaderWidgets(),super.doDestroy()}set headerWidgets(e){this.initHeaderWidgets(e),this.set("headerWidgets",e)}get headerWidgets(){return this.get("headerWidgets")}initHeaderWidgets(t){this.destroyHeaderWidgets();const r=this.headerWidgetMap={};for(const l of t){const t=e.create(n({owner:this},l));r[t.ref||t.id]=t}}destroyHeaderWidgets(){for(const t of Object.values(this.headerWidgetMap||{})){var e;null===(e=t.destroy)||void 0===e||e.call(t)}}static generateAutoCls(){let e="";for(let t=this;t!==Q;t=t.superclass)t.type&&(e+=`b-${t.type.toLowerCase()}-cell `);return(Q.autoClsMap||(Q.autoClsMap=new Map)).set(this,e),e}getCellClass(e){var t,r;const{record:l,column:o}=e,{cellCls:i,internalCellCls:n,grid:s,constructor:a,align:d}=o,c=(null===(t=Q.autoClsMap)||void 0===t?void 0:t.get(a))||a.generateAutoCls(),u=e.cell.classList.contains("b-editing"),h={[s.cellCls]:s.cellCls,[c]:c,[i]:i,[n]:n,"b-cell-dirty":l.isFieldModified(o.field)&&(o.compositeField||!1!==(null===(r=l.fieldMap[o.field])||void 0===r?void 0:r.persist)),[`b-grid-cell-align-${d}`]:d,"b-selected":s.selectionMode.cell&&s.isCellSelected(e),"b-focused":s.isFocused(e),"b-auto-height":o.autoHeight,"b-editing":u};return l.isSpecialRow&&h["b-checkbox-selection"]&&(h["b-checkbox-selection"]=!1),h}get locked(){return"locked"===this.data.region}set locked(e){this.region=e?"locked":"normal"}get region(){return this.parent.isRoot?this.get("region"):this.parent.region}set region(e){this.set("region",e)}get sortable(){return this.isLeaf&&this.data.sortable}set sortable(e){this.set("sortable",e)}get groupable(){return this.isLeaf&&this.data.groupable}set groupable(e){this.set("groupable",e)}get editor(){const t=this;let{editor:r}=t.data;if(r&&!r.isWidget){const l=t.grid.processCellEditor({editor:r,field:t.field});l?r=t.data.editor=l.editor:("string"==typeof r&&(r={type:r}),r=t.data.editor=e.create(s.merge(t.defaultEditor,{owner:t.grid,label:a.encodeHtml(t.text)},r)))}return r}set editor(e){this.data.editor=e}get defaultEditor(){return{type:"textfield",name:this.field}}getFilterableValue(e){return this.getRawValue(e)}get owner(){return this._owner||this.subGrid}set owner(e){this._owner=e}get grid(){var e;return this._grid||(null===(e=this.parent)||void 0===e?void 0:e.grid)}set subGrid(e){this._subGrid=e}get subGrid(){var e;return this._subGrid||(null===(e=this.grid)||void 0===e?void 0:e.getSubGridFromColumn(this))}get subGridElement(){return this.subGrid.element}get element(){return this.grid.getHeaderElement(this)}get nextVisibleSibling(){const e=this.region;let t=this.nextSibling;for(;t&&(t.hidden||t.region!==e);)t=t.nextSibling;return t}get isLastInSubGrid(){return!this.nextVisibleSibling&&(this.parent.isRoot||this.parent.isLastInSubGrid)}get textWrapper(){return t.getChild(this.element,".b-grid-header-text")}get textElement(){return t.down(this.element,".b-grid-header-text-content")}get contentElement(){return t.down(this.element,".b-grid-header-children")}get isSorted(){return this.grid.store.sorters.some((e=>e.field===this.field))}get isFocusable(){return this.isLeaf}static get text(){return this.$meta.fields.defaults.text}get headerText(){return this.htmlEncodeHeaderText?a.encodeHtml(this.text):this.text}get isVisible(){return!this.hidden&&(!this.parent||this.parent.isVisible)}hide(e=!1,t=!1){const r=this,{parent:l}=r;if(!r.hidden){if(r.hidden=!0,l&&!l.isRoot&&!l.isTogglingAll){l.children.some((e=>!0!==e.hidden))||l.hidden||(e=!0,l.hide())}r.isParent?r.children.forEach((e=>e.hide(!0,!0))):l.isRoot||l.meta.visibleChildren[t?"add":"delete"](r),e||r.stores.forEach((e=>e.trigger("columnHide",{column:r})))}}show(e=!1){const t=this,{parent:r}=t;if(t.hidden){var l;if(t.hidden=!1,null!=r&&r.hidden&&r.show(),t.isParent)null===(l=t.meta.visibleChildren)||void 0===l||l.forEach((e=>e.show(!0)));e||t.stores.forEach((e=>e.trigger("columnShow",{column:t})))}}toggle(e){return this.hidden&&void 0===e||!0===e?this.show():!this.hidden&&void 0===e||!1===e?this.hide():void 0}toggleChildren(e=this.children,t){var r,l;const o=this;null===(r=o.grid.columns)||void 0===r||r.beginBatch(),o.isTogglingAll=!0,e.forEach((e=>e.toggle(t))),o.isTogglingAll=!1,null===(l=o.grid.columns)||void 0===l||l.endBatch()}onCollapseChange(e){const t=this;if("toggleAll"===t.collapseMode)t.toggleChildren();else{var r,l;const{firstChild:o}=t;null!=o.flex&&t.collapsed?(o.oldFlex=o.flex,o.width=o.element.offsetWidth):!t.collapsed&&o.oldFlex&&(o.flex=o.oldFlex,o.oldFlex=null),null===(r=t.grid.columns)||void 0===r||r.beginBatch(),t.isTogglingAll=!0,t.children.slice(1).forEach((t=>t.toggle(e))),t.isTogglingAll=!1,null===(l=t.grid.columns)||void 0===l||l.endBatch()}}set collapsible(e){const t=this;if(t.set("collapsible",e),t.isParent){const{headerWidgets:r=[]}=t;if(e)r.push({type:"button",ref:"collapseExpand",toggleable:!0,pressed:t.collapsed,icon:"b-icon-collapse-"+(t.grid.rtl?"right":"left"),pressedIcon:"b-icon-collapse-"+(t.grid.rtl?"left":"right"),cls:"b-grid-header-collapse-button b-transparent",onToggle:({pressed:e})=>t.collapsed=e});else{const e=r.findIndex((e=>"collapseExpand"===e.ref));e>-1&&r.splice(e,1)}t.headerWidgets=r,t.collapsed&&t.onCollapseChange(!1)}}get collapsible(){return this.get("collapsible")}generateId(){return Q.generatedIdIndex||(Q.generatedIdIndex=0),(this.field?this.field.replace(/\./g,"-"):"col")+ ++Q.generatedIdIndex}get allIndex(){return this.masterStore.indexOf(this)}measureSize(e){var r;return t.measureSize(e,null===(r=this.subGrid)||void 0===r?void 0:r.element)}get calcMinWidth(){const{width:e,minWidth:t}=this.data;return J(e)&&J(t)?Math.max(parseInt(e)||0,parseInt(t)||0):e}get width(){return this.data.width}set width(e){const t={width:e};e&&"flex"in this.data&&(t.flex=null),this.set(t)}set flex(e){const t={flex:e};e&&"width"in this.data&&(t.width=null),this.set(t)}get flex(){return this.data.flex}calculateMinWidth(){const e=this,t=e.measureSize(e.width),r=e.measureSize(e.minWidth);let l=0;return e.children&&(l=e.children.reduce(((e,t)=>e+t.calculateMinWidth()),0)),Math.max(t,r,l)}resizeToFitContent(e,t,r=!1){const l=this,{grid:o,element:i,fitMode:n}=l,{rowManager:s,store:a}=o,{count:d}=a;if(d<=0||"none"===l.fitMode||!l.fitMode)return;const[c]=s.rows,{rowElement:u,cellElement:h}=o.beginGridMeasuring(),g=new Y({grid:o,column:l,id:null});let m,f,p,b,C,v,w=0,S={length:0,record:null};if(h._domData={columnId:l.id,row:c,rowElement:u},g._cell=h,g.updatingSingleRow=!0,g.isMeasuring=!0,h.innerHTML="",o.resizeToFitIncludesHeader){if(!o.$headerPadding){const e=globalThis.getComputedStyle(i);o.$headerPadding=parseInt(e.paddingLeft)}const e=i.querySelector(".b-grid-header-text-content");e.style.cssText="flex: none; width: auto",w=e.offsetWidth+2*o.$headerPadding+2,e.style.cssText=""}for(d>1e3?(m=Math.max(Math.min(s.topIndex+Math.round(s.rowCount/2)-500,d-1e3),0),f=m+1e3):(m=0,f=d),p=m;p<f;p++){if(b=a.getAt(p),C=l.getRawValue(b),"value"===n)v=String(C).length;else if(g._record=S.record,g._id=b.id,g._rowIndex=p,c.renderCell(g),"textContent"===n)v=h.textContent.length;else{const e=h.offsetWidth;e>w&&(w=e)}v>S.length&&(S={record:b,length:v,rowIndex:p})}return S.length>0&&("value"===n||"textContent"===n)&&(g._record=S.record,g._id=S.record.id,g._rowIndex=S.rowIndex,c.renderCell(g),w=Math.max(w,h.offsetWidth)),Array.isArray(e)&&([e,t]=e),w=Math.max(w,e||0),w=Math.min(w,t||1e6),r||o.endGridMeasuring(),l.width=l.maxWidth?w=Math.min(w,l.maxWidth):w,w}getState(){const e=this,t={id:e.id,hidden:e.hidden,region:e.region,locked:e.locked};return e.children||(t[e.flex?"flex":"width"]=e.flex||e.width),e.isCollapsible&&(t.collapsed=e.collapsed),t}applyState(e){const t=this;t.beginBatch(),"locked"in e&&(t.locked=e.locked),"width"in e&&(t.width=e.width),"flex"in e&&(t.flex=e.flex),"width"in e&&t.flex?t.flex=void 0:"flex"in e&&t.width&&(t.width=void 0),"region"in e&&(t.region=e.region),t.endBatch(),"hidden"in e&&t.toggle(!0!==e.hidden),"collapsed"in e&&(t.collapsed=e.collapsed)}remove(){const{subGrid:e,grid:r}=this,l=e&&(null==r?void 0:r.focusedCell);(null==l?void 0:l.columnId)===this.id&&(r.owns(t.getActiveElement(r))?r.navigateRight():r._focusedCell=new Y({grid:r,rowIndex:l.rowIndex,column:e.columns.getAdjacentVisibleLeafColumn(this.id,!0,!0)})),super.remove()}getRawValue(e){return this.hasComplexMapping?s.getPath(e,this.field):e[this.field]}refreshCell(e){this.grid.rowManager.refreshCell(e,this.id)}clearCell(e){e.innerHTML="",delete e._content}canEdit(e){if(e.isEditable){const t=e.isEditable(this.field);if(void 0!==t)return t}return!0}insertChild(e,t=null,r=!1){return(e=Array.isArray(e)?e:[e]).forEach((e=>{const{parent:t}=e;null!=t&&t.collapsed&&e===t.firstChild&&t.children.length>1&&1===t.children.filter((e=>!e.hidden)).length&&(e.nextSibling.hidden=!1)})),this.sealed&&!this.inProcessChildren?null:super.insertChild(...arguments)}canFillValue(){return!0}getCurrentConfig(e){var t;const r=super.getCurrentConfig(e);return null!==(t=this.sortable)&&void 0!==t&&t.originalSortFn&&(r.sortable=this.sortable.originalSortFn),r.renderer===this.internalRenderer&&delete r.renderer,r.headerRenderer===this.internalHeaderRenderer&&delete r.headerRenderer,delete r.ariaLabel,delete r.cellAriaLabel,r}}Q.emptyCount=0,Q.defaultWidth=100,Q.exposeProperties(),Q._$name="Column";const Z={boolean:{type:"check"},date:{type:"date"},integer:{type:"number",format:{maximumFractionDigits:0}},number:{type:"number"}},ee=[{field:"region"}];class te extends(o(d)){static get defaultConfig(){return{modelClass:Q,tree:!0,autoAddField:!1,sorters:ee}}construct(e){const t=this;e.grid&&(e.grid._columnStore=t,t.id=`${e.grid.id}-columns`,e.grid.ion({subGridCollapse:"clearSubGridCaches",subGridExpand:"clearSubGridCaches",thisObj:t})),super.construct(e),t.ion({change:t.onStoreChange,sort:()=>t.updateChainedStores(),thisObj:t,prio:1})}get modelClass(){return this._modelClass}set modelClass(e){this._modelClass=e}doDestroy(){const e=[];this.isChained||this.traverse((t=>e.push(t))),super.doDestroy(),this.isChained||e.forEach((e=>e.destroy()))}getById(e){return super.getById(e)||this.idRegister[e]}forEach(e,t=this){this.traverseWhile(((r,l)=>e.call(t,r,l)),!0)}get totalFixedWidth(){let e=0;for(const t of this)t.hidden||(t.children?t.children.forEach((t=>e+=this.calculateFixedWidth(t))):e+=this.calculateFixedWidth(t));return e}get hasFlex(){return this.visibleColumns.some((e=>e.flex))}calculateFixedWidth(e){return e.flex?e.measureSize(Q.defaultWidth):Math.max(e.measureSize(e.width),e.measureSize(e.minWidth))}get topColumns(){return this.isChained?this.masterStore.rootNode.children.filter(this.chainedFilterFn):this.rootNode.children}get visibleColumns(){const e=this;return e._visibleColumns||(e._visibleColumns=e.leaves.filter((e=>e.isVisible&&(!e.subGrid||!e.subGrid.collapsed)))),e._visibleColumns}onStoreChange({action:e,changes:t}){("update"!==e||"hidden"in t)&&this.clearCaches()}clearSubGridCaches({subGrid:e}){e.columns.clearCaches(),this.clearCaches()}clearCaches(){var e;this._visibleColumns=null,null===(e=this.masterStore)||void 0===e||e.clearCaches()}onMasterDataChanged(e){super.onMasterDataChanged(e),("update"!==e.action||"hidden"in e.changes)&&this.clearCaches()}getAdjacentVisibleLeafColumn(e,t=!0,r=!1){const l=this.visibleColumns,o=e instanceof Q?e:this.getById(e);let i=l.indexOf(o)+(t?1:-1);if(!l[i]){if(!r)return null;i=t?0:l.length-1}return l[i]}get bottomColumns(){return this.leaves}get(e){return this.findRecord("field",e,!0)}createRecord(e){var t,r;const{grid:l={}}=this,{store:o}=l,i=null==o||null===(t=o.modelClass)||void 0===t||null===(r=t.fieldMap)||void 0===r?void 0:r[e.field];let n=this.modelClass;if(null!=i&&i.column&&(e=c.merge({},i.column,e)),e.type&&(n=te.getColumnClass(e.type),!n))throw new Error(`Column type '${e.type}' not registered`);e.locked&&(e.region="locked",delete e.locked);const s=new n(e,this);if(s.data.region||(s.data.region=l.defaultRegion||"normal"),this.autoAddField&&!s.noFieldSpecified&&o&&!i){let e=s.field;s.constructor.fieldType&&(e={name:s.field,type:s.constructor.fieldType}),o.modelClass.addField(e)}return s}indexOf(e){if(null==e)return-1;const t=super.indexOf(e);return t>-1?t:this.records.findIndex((t=>t.field===e))}get usesAutoHeight(){return this.find((e=>e.autoHeight))}get usesFlexAutoHeight(){return this.find((e=>e.autoHeight&&null!=e.flex))}static registerColumnType(e,t=!1){e.simpleRenderer=t,(te.columnTypes||(te.columnTypes={}))[e.type]=e}static getColumnClass(e){return te.columnTypes&&te.columnTypes[e]}generateColumnForField(e,t){var r;"string"==typeof e&&this.grid&&(e=null===(r=this.grid.store)||void 0===r?void 0:r.modelClass.fieldMap[e]);let l=e.column||Z[e.type]||{};return"string"==typeof l&&(l={type:l}),l=Object.assign({text:e.text||a.separate(e.name),field:e.name},t,l),null!=e.precision&&(l.format.maximumFractionDigits=e.precision),e.columnType&&(l.type=e.columnType),this.createRecord(l)}}te.registerColumnType(Q,!0),te._$name="ColumnStore";class re extends Q{static get defaults(){return{filterable:!1,sortable:!1,editor:!1,searchable:!1,fitMode:!1,alwaysClearCell:!1}}construct(e,t){const r=this;r.widgetMap={},super.construct(...arguments),r.externalRenderer=r.renderer,r.renderer=r.internalRenderer}doDestroy(){for(const e of Object.values(this.widgetMap))e.destroy&&e.destroy();super.doDestroy()}updateReadOnly(e){for(const t of Object.values(this.widgetMap))t.cellInfo.record.readOnly||(t.readOnly=e)}internalRenderer(e){var t;const r=this,{cellElement:l,column:o,record:i,isExport:n}=e,{widgets:s}=o;return!n&&s&&(l.widgets||r.clearCell(l),l.widgets=e.widgets=s.map(((t,n)=>{var s,a;let d,c;if(l.widgets&&(d=l.widgets[n],c=d.element.nextElementSibling,t.recreate&&d&&(delete r.widgetMap[d.id],d.destroy(),l.widgets[n]=null)),d||(r.onBeforeWidgetCreate(t,e),t.recomposeAsync=!1,d=N.append(t,c?{insertBefore:c}:l)[0],r.widgetMap[d.id]=d,r.onAfterWidgetCreate(d,e),d.name&&d.ion({change:({value:e})=>{d.cellInfo.record[d.name]=e}})),d.cellInfo={record:i,column:o},r.grid&&!r.meta.isSelectionColumn&&(d.readOnly=r.grid.readOnly||i.readOnly),!1!==(null===(s=r.onBeforeWidgetSetValue)||void 0===s?void 0:s.call(r,d,e))){const r=t.valueProperty||"value"in d&&"value"||d.defaultBindProperty;if(r){const t=d.name?i[d.name]:e.value;d[r]=t}}return null===(a=r.onAfterWidgetSetValue)||void 0===a||a.call(r,d,e),d}))),n?null:null===(t=this.externalRenderer)||void 0===t?void 0:t.call(this,e)}onBeforeWidgetCreate(e,t){}onAfterWidgetCreate(e,t){}clearCell(e){e.widgets&&(e.widgets.forEach((e=>{delete this.widgetMap[e.id],e.destroy()})),e.widgets=null),super.clearCell(e)}resizeToFitContent(){}}u(re,"type","widget"),u(re,"fields",["widgets"]),te.registerColumnType(re),re.exposeProperties(),re._$name="WidgetColumn";class le extends re{construct(e,t){super.construct(...arguments);const r=this;if(Object.assign(r,{externalHeaderRenderer:r.headerRenderer,externalOnBeforeWidgetSetValue:r.onBeforeWidgetSetValue,externalOnAfterWidgetSetValue:r.onAfterWidgetSetValue,onBeforeWidgetSetValue:r.internalOnBeforeWidgetSetValue,onAfterWidgetSetValue:r.internalOnAfterWidgetSetValue,headerRenderer:r.internalHeaderRenderer}),!r.meta.isSelectionColumn){var l;const e=null===(l=r.grid)||void 0===l?void 0:l.store.modelClass;r.field?!e||e.fieldMap[r.field]||r.constructor.suppressNoModelFieldWarning||(console.warn(r.$$name+" is configured with a field, but this is not part of your Model `fields` collection."),e.addField({name:r.field,type:"boolean"})):console.warn("CheckColumn MUST be configured with a field, otherwise the checked state will not be persistent. Widgets are recycled and reused")}}doDestroy(){var e;null===(e=this.headerCheckbox)||void 0===e||e.destroy(),super.doDestroy()}internalHeaderRenderer({headerElement:e,column:t}){let r;return e.classList.add("b-check-header"),t.showCheckAll?(e.classList.add("b-check-header-with-checkbox"),t.headerCheckbox?e.appendChild(t.headerCheckbox.element):t.headerCheckbox=new $({appendTo:e,owner:this.grid,ariaLabel:"L{Checkbox.toggleSelection}",internalListeners:{change:"onCheckAllChange",thisObj:t}})):r=t.headerText,r=t.externalHeaderRenderer?t.externalHeaderRenderer.call(this,...arguments):r,t.showCheckAll?void 0:r}updateCheckAllState(e){this.headerCheckbox&&(this.suspendEvents(),this.headerCheckbox.checked=e,this.resumeEvents())}onCheckAllChange({checked:e}){const t=this;if(t.field){const{store:r}=t.grid;r.beginBatch(),r.forEach((r=>t.updateRecord(r,t.field,e))),r.endBatch()}t.trigger("toggleAll",{checked:e})}internalRenderer({value:e,isExport:t,record:r,cellElement:l}){if(t)return null==e?"":e;const o=super.internalRenderer(...arguments);return r.readOnly&&!this.meta.isSelectionColumn&&(l.widgets[0].readOnly=!0),o}onBeforeWidgetCreate(e,t){e.cls=this.checkCls}onAfterWidgetCreate(e,t){t.cellElement.widget=e,e.ion({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}internalOnBeforeWidgetSetValue(e){var t;e.record=e.cellInfo.record,this.isInitialSet=!0,null===(t=this.externalOnBeforeWidgetSetValue)||void 0===t||t.call(this,...arguments)}internalOnAfterWidgetSetValue(e){var t;this.isInitialSet=!1,null===(t=this.externalOnAfterWidgetSetValue)||void 0===t||t.call(this,...arguments)}onBeforeCheckboxChange({source:e,checked:t,userAction:r}){const l=this,{grid:o}=l,{record:i}=e.cellInfo;return!(r&&l.field&&(!o.features.cellEdit||o.features.cellEdit.disabled)||l.meta.isSelectionColumn&&!o.isSelectable(i)&&t)&&(l.isInitialSet?void 0:l.trigger("beforeToggle",{record:i,checked:t}))}onCheckboxChange({source:e,checked:t}){if(!this.isInitialSet){const r=this,{record:l}=e.cellInfo,{field:o}=r;o&&(r.updateRecord(l,o,t),t?r.updateCheckAllState(r.grid.store.every((e=>e[o]),null,!0)):r.updateCheckAllState(!1)),r.trigger("toggle",{record:l,checked:t})}}updateRecord(e,t,r){const l=`set${a.capitalize(t)}`;e[l]?e[l](r):e.set(t,r)}onCellKeyDown({event:e,cellElement:t}){if(" "===e.key){const r=t.widget;null==r||r.toggle(),e.preventDefault(),e.handled=!0}}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.onBeforeWidgetSetValue,delete t.onAfterWidgetSetValue,this.externalOnBeforeWidgetSetValue&&(t.onBeforeWidgetSetValue=this.externalOnBeforeWidgetSetValue),this.externalOnAfterWidgetSetValue&&(t.onAfterWidgetSetValue=this.externalOnAfterWidgetSetValue),t}}u(le,"$name","CheckColumn"),u(le,"type","check"),u(le,"fields",["checkCls","showCheckAll","onAfterWidgetSetValue","onBeforeWidgetSetValue","callOnFunctions","onBeforeToggle","onToggle","onToggleAll"]),u(le,"defaults",{align:"center",checkCls:null,showCheckAll:!1,sortable:!0,filterable:!0,widgets:[{type:"checkbox",valueProperty:"checked"}]}),te.registerColumnType(le,!0),le._$name="CheckColumn";class oe extends Q{static get defaults(){return{groupable:!1,sortable:!1,filterable:!1,searchable:!1,resizable:!1,draggable:!1,minWidth:50,width:50,align:"center",text:"#",editor:!1}}construct(e){super.construct(...arguments);const t=this,{grid:r}=t;t.internalCellCls="b-row-number-cell",t.externalHeaderRenderer=t.headerRenderer,t.headerRenderer=t.internalHeaderRenderer,r&&(r.ion({bindStore:"bindStore",thisObj:t}),t.bindStore({store:r.store,initial:!0}),r.store.count&&!r.rendered&&r.ion({paint:"resizeToFitContent",thisObj:t,once:!0}))}get groupHeaderReserved(){return!0}bindStore({store:e,initial:t}){const r=this;r.detachListeners("grid"),e.ion({name:"grid",[`change${r.grid.asyncEventSuffix}`]:"onStoreChange",thisObj:r}),t||r.resizeToFitContent()}onStoreChange({action:e}){"dataset"!==e&&"add"!==e&&"remove"!==e&&"removeall"!==e||this.resizeToFitContent()}renderer({record:e,grid:t}){return e.isSpecialRow?"":t.store.indexOf(e,!0)+1}resizeToFitContent(){const{grid:e}=this,{store:r}=e,{count:l}=r;if(l&&!this.hidden){const r=e.element.querySelector(`.b-grid-cell[data-column-id="${this.id}"]`);if(r){const e=parseInt(t.getStyleValue(r,"padding-left")),o=t.measureText(l,r);this.width=Math.max(this.minWidth,o+2*e)}}}set flex(e){}internalHeaderRenderer({headerElement:e,column:t}){var r;return e.classList.add("b-rownumber-header"),(null===(r=t.externalHeaderRenderer)||void 0===r?void 0:r.call(this,...arguments))||t.headerText}}u(oe,"$name","RowNumberColumn"),u(oe,"type","rownumber"),te.registerColumnType(oe,!0),oe._$name="RowNumberColumn";const ie=new Map,ne=new Map,se={Grid:"GridBase",Scheduler:"SchedulerBase",SchedulerPro:"SchedulerProBase",Gantt:"GanttBase"},ae=/\$\d+$/;class de{static registerFeature(e,t=!1,r=null,l=null){l=(l=a.uncapitalize(l||Object.prototype.hasOwnProperty.call(e,"$name")&&e.$$name||e.name)).replace(ae,""),Array.isArray(r)||(r=[r||"Grid"]),r.forEach((r=>{const o=se[r]||r,i=ie.get(o)||new Map,n=ne.get(o)||new Map;i.set(l,e),n.set(e,t),ie.set(o,i),ne.set(o,n)}))}static getTypeNameFeatures(e="Grid"){const t=se[e]||e,r=ie.get(t),l={};return r&&r.forEach(((e,t)=>l[t]=e)),l}static getTypeNameDefaultFeatures(e="Grid"){const t=se[e]||e,r=ie.get(t),l=ne.get(t),o={};return r&&l&&r.forEach(((e,t)=>{l.get(e)&&(o[t]=e)})),o}static getInstanceFeatures(e){return e.$meta.names.reduce(((e,t)=>Object.assign(e,this.getTypeNameFeatures(t))),{})}static getInstanceDefaultFeatures(e){return e.$meta.names.reduce(((e,t)=>Object.entries(this.getTypeNameFeatures(t)).reduce(((e,[r,l])=>(this.isDefaultFeatureForTypeName(l,t)?e[r]=l:delete e[r],e)),e)),{})}static isDefaultFeatureForTypeName(e,t="Grid"){const r=se[t]||t,l=ne.get(r);return l&&l.get(e)||!1}static isDefaultFeatureForInstance(e,t){const r=t.$meta.names.slice().reverse();let l=null;for(let t=0,o=r.length;t<o&&null===l;++t){const o=ne.get(r[t]);o&&o.has(e)&&(l=o.get(e))}return l||!1}static reset(){ie.clear(),ne.clear()}}const ce={finishAndEditNextRow:1,finishAndEditPrevRow:1,finishEditing:1,cancelEditing:1,finishAndEditNextCell:1,finishAndEditPrevCell:1};class ue extends(h(g)){static get defaultConfig(){return{autoSelect:!0,blurAction:"complete",continueEditingOnCellClick:!0,addNewAtEnd:null,autoEdit:null,editNextOnEnterPress:!0,editorClass:m,triggerEvent:"celldblclick",touchEditDelay:300,focusCellAnimationDuration:!1,multiEdit:!0,keyMap:{Enter:["startEditing","finishAndEditNextRow"],"Ctrl+Enter":["finishAllSelected","finishEditing"],"Shift+Enter":"finishAndEditPrevRow","Alt+Enter":"finishEditing",F2:["startEditing","finishEditing"],Escape:"cancelEditing",Tab:"finishAndEditNextCell","Shift+Tab":"finishAndEditPrevCell"}}}static get pluginConfig(){return{assign:["startEditing","finishEditing","cancelEditing"],before:["onElementKeyDown","onElementPointerUp"],chain:["onElementClick","bindStore"]}}construct(e,t){super.construct(e,t);const r=this,l={renderRows:"onGridRefreshed",cellClick:"onCellClick",thisObj:r};r.grid=e,"cellclick"!==r.triggerEvent&&(l[r.triggerEvent]="onTriggerEditEvent"),r.autoEdit&&!("editNextOnEnterPress"in t)&&(r.editNextOnEnterPress=!1),e.ion(l),e.rowManager.ion({changeTotalHeight:"onGridRefreshed",thisObj:r}),r.bindStore(e.store)}bindStore(e){this.detachListeners("store"),e.ion({name:"store",update:"onStoreUpdate",beforeSort:"onStoreBeforeSort",thisObj:this})}async confirm(e){let t=!0;return this.editorContext&&(W.owner=this.editorContext.editor.inputField,e.rootElement=this.grid.rootElement,t=await W.confirm(e),W.owner=null),t===W.yesButton}doDestroy(){this.grid.columns.allRecords.forEach((e=>{var t;null===(t=e._cellEditor)||void 0===t||t.destroy()})),super.doDestroy()}doDisable(e){e&&!this.isConfiguring&&this.cancelEditing(!0),super.doDisable(e)}set disabled(e){super.disabled=e}get disabled(){const{grid:e}=this;return Boolean(super.disabled||e.disabled||e.readOnly)}get isEditing(){return Boolean(this.editorContext)}get activeRecord(){var e;return(null===(e=this.editorContext)||void 0===e?void 0:e.record)||null}getEditorForCell({id:e,cell:t,column:r,columnId:l,editor:o}){var i;const n=this,{grid:a,editorClass:d}=n;let c=r.cellEditor,u=0;if(r.editTargetSelector){u=t.querySelector(r.editTargetSelector).offsetLeft}return o.autoSelect=n.autoSelect,null!==(i=c)&&void 0!==i&&i.isEditor||(c=r.data.cellEditor=d.create(d.mergeConfigs({type:d.type,constrainTo:null,cls:"b-cell-editor",inputField:o,blurAction:"none",invalidAction:r.invalidAction,completeKey:!1,cancelKey:!1,owner:a,align:{align:"t0-t0",offset:[u,0]},internalListeners:n.getEditorListeners(),onInternalKeyDown:n.onEditorKeydown.bind(n),allowMouseEvents:o.allowMouseEvents},c))),c.minHeight=a.rowHeight,c.inputField!==o&&(c.remove(c.items[0]),c.add(o)),c.align.offset[0]=u,r.instantUpdate&&!o.cellEditValueSetter&&(s.wrapProperty(o,"value",null,(e=>{const{editorContext:t}=n,r=null==t?void 0:t.editor.inputField;null==t||!t.editor.isValid||s.isEqual(t.record[t.column.field],e)||null!=r&&r.isDateField&&!r._isPickerInput||(t.record[t.column.field]=e)})),o.cellEditValueSetter=!0),Object.assign(c.element.dataset,{rowId:e,columnId:l,field:r.field}),c.inputField.revertOnEscape=r.revertOnEscape,n.editor=c}getEditorListeners(){return{focusOut:"onEditorFocusOut",focusIn:"onEditorFocusIn",start:"onEditorStart",beforeComplete:"onEditorBeforeComplete",complete:"onEditorComplete",beforeCancel:"onEditorBeforeCancel",cancel:"onEditorCancel",beforeHide:"onBeforeEditorHide",finishEdit:"onEditorFinishEdit",thisObj:this}}onEditorStart({source:e}){const t=this,r=t.editorContext=e.cellEditorContext;if(r){var l;const{grid:e}=t;"cellclick"!==t.triggerEvent&&(t.detachListeners("cellClickWhileEditing"),e.ion({name:"cellClickWhileEditing",cellclick:"onCellClickWhileEditing",thisObj:t})),null===(l=t.removeEditingListeners)||void 0===l||l.call(t),t.removeEditingListeners=f.addListener({globaltap:"onTapOut",thisObj:t}),e.trigger("startCellEdit",{grid:e,editorContext:r})}}onEditorBeforeComplete(e){const{grid:t}=this,r=e.source.cellEditorContext;return e.grid=t,e.editorContext=r,t.trigger("beforeFinishCellEdit",e)}onEditorComplete({source:e}){const{grid:t}=this,r=e.cellEditorContext;r.value=e.inputField.value,t.trigger("finishCellEdit",{grid:t,editorContext:r})}onEditorBeforeCancel(){const{editorContext:e}=this;return this.grid.trigger("beforeCancelCellEdit",{editorContext:e})}onEditorCancel({event:e}){const{editorContext:t,muteEvents:r,grid:l}=this;r||l.trigger("cancelCellEdit",{grid:l,editorContext:t,event:e})}onBeforeEditorHide({source:e}){const{row:t,cell:r}=e.cellEditorContext;null==r||r.classList.remove("b-editing"),null==t||t.removeCls("b-editing"),this.detachListeners("cellClickWhileEditing"),this.removeEditingListeners()}onEditorFinishEdit({source:e}){e.cellEditorContext=this.editorContext=null}getAdjacentEditableCell(e,t){const{grid:r}=this,{store:l,columns:o}=r,{visibleColumns:i}=o;let n=e.id,s=o.getAdjacentVisibleLeafColumn(e.columnId,t);for(;n;)if(s){if(s.editor&&s.canEdit(l.getById(n)))return{id:n,columnId:s.id};s=o.getAdjacentVisibleLeafColumn(s,t)}else{const r=l.getAdjacent(e.id,t,!1,!0);n=null==r?void 0:r.id,r&&(s=t?i[0]:i[i.length-1])}return null}doAddNewAtEnd(){const e="object"==typeof this.addNewAtEnd?s.clone(this.addNewAtEnd):{},{grid:t}=this,r=t.store.add(e)[0];return t.rowManager.getRowFor(r)||t.rowManager.displayRecordAtBottom(),r}getEditingContext(e){e=this.grid.normalizeCellContext(e);const{column:t,record:r}=e;if(null!=t&&t.isVisible&&t.editor&&r&&!r.isSpecialRow&&!r.readOnly&&t.canEdit(r)){const l=r?t.getRawValue(r):r;return Object.assign(e,{value:void 0===l?null:l,editor:t.editor}),e}return!1}async startEditing(e={}){const t=this;if(!t.disabled){var r,l,o;const{grid:n}=t;if(null!==(r=e)&&void 0!==r&&r.fromKeyMap&&(e=t.grid.focusedCell),s.isEmpty(e)&&(e.id=n.firstVisibleRow.id),n.store.isTree&&n.features.tree){var i;const t=e.id?n.store.getById(e.id):null!==(i=e.record)&&void 0!==i?i:n.store.getAt(e.row);if(!t)return!1;await n.expandTo(t)}const a=t.getEditingContext(e);if(!a)return!1;if(t.editorContext&&t.cancelEditing(),null!==(l=n.focusedCell)&&void 0!==l&&l.equals(a)||n.focusCell(a),!1===n.trigger("beforeCellEditStart",{grid:n,editorContext:a}))return!1;const d=a.editor=t.getEditorForCell(a),{row:c,cell:u,record:h}=a;return d.inputField.highlightExternalChange=!1,d.cellEditorContext=a,d.render(u),u.classList.add("b-editing"),c.addCls("b-editing"),await d.startEdit({target:u,field:d.inputField.name||a.column.field,value:a.value,record:h})||(u.classList.remove("b-editing"),c.removeCls("b-editing")),null===(o=t.onCellEditStart)||void 0===o||o.call(t),!0}return!1}cancelEditing(e=!1,t){var r;const l=this,{editorContext:o,editor:i}=l;e.fromKeyMap&&(t=e,e=!1),o&&(l.muteEvents=e,i.cancelEdit(t),l.muteEvents=!1),l.finishEditingPromise=!1,null===(r=l.afterCellEdit)||void 0===r||r.call(l)}async finishEditing(){const e=this,{editorContext:t,grid:r}=e;let l=!1;if(e.finishEditingPromise)return e.finishEditingPromise;if(t){var o;const{column:i}=t;e.finishEditingPromise=t.editor.completeEdit(i.bindCallback(i.finalizeCellEdit)),l=await e.finishEditingPromise,await r.waitForAnimations(),e.finishEditingPromise=null,null===(o=e.afterCellEdit)||void 0===o||o.call(e)}return l}async onCellClickWhileEditing({event:e,cellSelector:r}){const l=this;t.isTouchEvent?await l.finishEditing():l.finishEditingPromise||l.editorContext&&!l.editorContext.editor.owns(e.target)&&(l.getEditingContext(r)?await l.finishEditing()?l.continueEditingOnCellClick&&await l.startEditing(r):(l.grid.focusCell(l.editorContext),l.editor.inputField.focus()):await l.finishEditing())}async onCellClick({source:e,cellSelector:r,target:l,event:o,column:i}){if(i.onCellClick)return;const n=this,{focusedCell:s}=n.client;if(l.closest(".b-tree-expander"))return!1;t.isTouchEvent&&n._lastCellClicked===(null==s?void 0:s.cell)&&o.timeStamp-n.touchEditDelay>n._lastCellClickedTime?await n.startEditing(r):"cellclick"===this.triggerEvent&&await n.onTriggerEditEvent({cellSelector:r,target:l}),n._lastCellClicked=null==s?void 0:s.cell,n._lastCellClickedTime=o.timeStamp}onElementPointerUp(e){e.target.closest(".b-tree-expander")&&this.cancelEditing(void 0,e)}async onTriggerEditEvent({cellSelector:e,target:r,event:l}){var o;const{editorContext:i,client:n}=this;r.closest(".b-tree-expander")||t.isTouchEvent&&"dblclick"===l.type||l&&(null===(o=n.features.cellMenu)||void 0===o?void 0:o.triggerEvent)===l.type||(!i||!i.equals(this.grid.normalizeCellContext(e))&&await this.finishEditing())&&await this.startEditing(e)}onStoreUpdate({changes:e,record:t}){const{editorContext:r}=this;null!=r&&r.editor.isVisible&&t===r.record&&r.editor.dataField in e&&r.editor.refreshEdit()}onStoreBeforeSort(){var e;const t=null===(e=this.editorContext)||void 0===e?void 0:e.editor;!this.isEditing||null!=t&&t.isFinishing||t.isValid||this.cancelEditing()}onGridRefreshed(){const e=this,{grid:r,editorContext:l}=e;if(l&&r.isVisible&&r.focusedCell){const o=r.getCell(r.focusedCell),{editor:i}=l;o&&t.isInView(o)&&!i.isFinishing?(l._cell=o,f.suspendFocusEvents(),i.render(o),i.showBy(o),i.focus(),f.resumeFocusEvents()):e.cancelEditing()}}get gridSelection(){return[...this.grid.selectedRecords,...this.grid.selectedCells]}isActionAvailable(e,t,r){const l=this;if(t=t.replace("cellEdit.",""),!l.disabled&&!r.target.closest(".b-grid-header"))if(l.isEditing){if("finishAllSelected"===t)return l.multiEdit&&l.gridSelection.length>1;if(ce[t])return!0}else if("startEditing"===t)return l.grid.focusedCell.cell===r.target;return!1}async finishAllSelected(){const e=this,{dataField:t,record:r}=e.editor;if(await e.finishEditing()&&!e.isDestroyed)for(const l of e.gridSelection)l.isModel?l!==r&&(l[t]=r[t]):l.record.set(l.column.field,r[t])}async finishAndEditNextRow(e,t=!1){const r=this,{grid:l}=r,{record:o}=r.editorContext;let i;if(await r.finishEditing()){if(r.isDestroyed)return;r.isEditing||(t?i=l.internalNextPrevRow(!1,!0,e,!1):(r.addNewAtEnd&&o===l.store.last&&await r.doAddNewAtEnd(),r.isDestroyed||(i=l.internalNextPrevRow(!0,!0,e))),i&&r.editNextOnEnterPress&&!l.touch&&r.startEditing(i))}}finishAndEditPrevRow(e){this.finishAndEditNextRow(e,!0)}async finishAndEditNextCell(e,t=!1){const r=this,{focusedCell:l}=r.grid;if(l){let o=r.getAdjacentEditableCell(l,!t);if(!o&&!t&&r.addNewAtEnd){!0===await r.finishEditing()&&(await this.doAddNewAtEnd(),o=!r.isDestroyed&&r.getAdjacentEditableCell(l,!t))}if(o){let l=!0;r.isEditing&&(l=await r.finishEditing()),!r.isDestroyed&&l&&(r.grid.focusCell(o,{animate:r.focusCellAnimationDuration}),await r.startEditing(o)||await r.finishAndEditNextCell(e,t))}}}finishAndEditPrevCell(e){this.finishAndEditNextCell(e,!0)}async onElementKeyDown(e){const t=this,{grid:r}=t,{focusedCell:l}=r,{key:o}=e;if(!e.handled&&t.autoEdit&&!t.isEditing&&l&&!l.isActionable&&!e.ctrlKey)if(o.length<=1&&await t.startEditing(l)){const{inputField:r}=t.editor,{input:l}=r;l&&(r.internalOnKeyEvent(e),e.defaultPrevented||(l.value=o,r.internalOnInput(e))),e.preventDefault()}else if("Delete"===e.key||"Backspace"===e.key){const{gridSelection:e}=t;if(t.multiEdit&&e.length>1)for(const t of e)t.isModel?r.visibleColumns.forEach((e=>{t.set(e.field,null)})):t.record.set(t.column.field,null);else l.record.set(l.column.field,null)}}onEditorKeydown(e){if(e.key.startsWith("Arrow"))return e.handled=!0,e.stopPropagation(),!1}async onEditorFocusOut(e){const t=this,{grid:r,editor:l,editorContext:o}=t,i=new Y(e.relatedTarget),n=i.grid===r&&t.getEditingContext(i);o&&!l.isFinishing&&l.owns(e._target)&&("cancel"===t.blurAction?t.cancelEditing(void 0,e):t.finishEditingPromise||"cellclick"!==t.triggerEvent&&("cellclick"===t.triggerEvent||n)||await t.finishEditing())}onEditorFocusIn(e){const t=e.toWidget;t===this.editor.inputField&&this.autoSelect&&t.selectAll&&!t.readOnly&&!t.disabled&&t.selectAll()}async onTapOut({event:e}){const t=this;t.grid.bodyContainer.contains(e.target)&&!e.button||t.editor.owns(e.target)||(t.editingStoppedByTapOutside=!0,"cancel"===t.blurAction?t.cancelEditing(void 0,e):await t.finishEditing(),delete t.editingStoppedByTapOutside)}async onElementClick(e){e.target.classList.contains("b-grid-body-container")&&this.editorContext&&await this.finishEditing()}}u(ue,"$name","CellEdit"),ue._$name="CellEdit",de.registerFeature(ue,!0);class he extends p{static get $name(){return"CellMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"cell"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateCellMenu"),e}showContextMenu(e){const{cellSelector:t,event:r}=e;this.client.focusCell(t,{doSelect:!this.client.isSelected(t),event:r}),super.showContextMenu(e)}shouldShowMenu({column:e}){return e&&!1!==e.enableCellContextMenu}getDataFromEvent(e){const t=this.client.getCellDataFromEvent(e);if(t)return s.assign(super.getDataFromEvent(e),t)}beforeContextMenuShow({record:e,items:t,column:r}){if(!1===r.cellMenuItems)return!1;e&&!e.isSpecialRow||(t.removeRow=!1)}populateCellMenu({items:e,column:t,record:r}){const{client:l}=this;null!=t&&t.cellMenuItems&&s.merge(e,t.cellMenuItems),l.readOnly||(e.removeRow={text:"L{removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",cls:"b-separator",weight:100,disabled:r.readOnly,onItem:()=>l.store.remove(l.selectedRecords.filter((e=>!e.readOnly)))})}get showMenu(){return!0}}he.featureClass="",he._$name="CellMenu",de.registerFeature(he,!0,["Grid","Scheduler"]),de.registerFeature(he,!1,["Gantt"]);class ge extends(h(g)){static get $name(){return"ColumnDragToolbar"}static get pluginConfig(){return{after:["render"]}}construct(e,t){var r;null===(r=e.features.columnReorder)||void 0===r||r.ion({beforeDestroy:"onColumnReorderBeforeDestroy",thisObj:this}),this.grid=e,super.construct(e,t)}doDestroy(){const e=this;e.grid.features.columnReorder&&!e.grid.features.columnReorder.isDestroyed&&e.detachFromColumnReorder(),e.element&&e.element.remove(),e.element=null,super.doDestroy()}doDisable(e){this.initialized&&(e?this.detachFromColumnReorder():this.init()),super.doDisable(e)}init(){const e=this,t=e.grid;t.features.columnReorder&&(e.reorderDetacher=t.features.columnReorder.ion({gridheaderdragstart({context:r}){const l=t.columns.getById(r.element.dataset.columnId);e.showToolbar(l)},gridheaderdrag:({context:t})=>e.onDrag(t),gridheaderabort:()=>{e.hideToolbar()},gridheaderdrop:({context:t})=>{t.valid?e.hideToolbar():e.onDrop(t)},thisObj:e}),e.initialized=!0)}onColumnReorderBeforeDestroy(){this.detachFromColumnReorder()}detachFromColumnReorder(){const e=this;e.grid.features.columnReorder.un("beforedestroy",e.onColumnReorderBeforeDestroy,e),e.reorderDetacher&&e.reorderDetacher(),e.reorderDetacher=null}render(){this.initialized||this.init()}showToolbar(e){const r=this,l=r.grid.getColumnDragToolbarItems(e,[]),o=[];r.clearTimeout(r.buttonHideTimer),l.forEach((e=>{e.text=e.localeClass.L(e.text);let t=o.find((t=>t.text===e.group));t||(t={text:e.localeClass.L(e.group),buttons:[]},o.push(t)),t.buttons.push(e)})),r.element=t.append(r.grid.element,r.template(o)),r.groups=o,r.buttons=l,r.column=e}async hideToolbar(){const e=this,t=e.element;t&&(t.classList.add("b-remove"),await C.waitForTransitionEnd({element:t,mode:"animation",thisObj:e.client}),t.remove(),e.element=null)}onDrag(e){var t;const r=this;if(e.dragProxy.getBoundingClientRect().top-r.grid.element.getBoundingClientRect().top>100?r.element.classList.add("b-closer"):r.element.classList.remove("b-closer"),r.hoveringButton&&(r.hoveringButton.classList.remove("b-hover"),r.hoveringButton=null),null!==(t=e.targetElement)&&void 0!==t&&t.closest(".b-columndragtoolbar")){r.element.classList.add("b-hover");const t=e.targetElement.closest(".b-columndragtoolbar  .b-target-button:not([data-disabled=true])");t&&(t.classList.add("b-hover"),r.hoveringButton=t)}else r.element.classList.remove("b-hover")}onDrop(e){const t=this;if(e.targetElement&&e.targetElement.matches(".b-columndragtoolbar .b-target-button:not([data-disabled=true])")){const r=e.targetElement,l=t.buttons.find((e=>e.ref===r.dataset.ref));l&&(r.classList.add("b-activate"),t.buttonHideTimer=t.setTimeout((()=>{t.hideToolbar(),l.onDrop({column:t.column})}),100))}else t.hideToolbar()}template(e){return v.tpl`
            <div class="b-columndragtoolbar">     
            <div class="b-title"></div>          
            ${e.map((e=>v.tpl`
                <div class="b-group">
                    <div class="b-buttons">
                    ${e.buttons.map((e=>v.tpl`
                        <div class="b-target-button" data-ref="${e.ref}" data-disabled="${e.disabled}">
                            <i class="${e.icon}"></i>
                            ${e.text}
                        </div>
                    `))}
                    </div>
                    <div class="b-title">${e.text}</div>
                </div>
            `))}
            </div>`}}ge.featureClass="b-hascolumndragtoolbar",ge._$name="ColumnDragToolbar",de.registerFeature(ge,b.isTouchDevice);class me extends g{static get pluginConfig(){return{chain:["populateHeaderMenu","getColumnDragToolbarItems"]}}get grid(){return this.client}getColumnPickerItems(e){const t=this,{createColumnsFromModel:r}=t;let l;if(t.groupByRegion)l=t.grid.regions.map((e=>{const r=t.grid.getSubGrid(e).columns.topColumns;return{text:a.capitalize(e),menu:t.buildColumnMenu(r),disabled:0===r.length,region:e}})),r&&l.push({text:t.L("L{newColumns}"),menu:t.createAutoColumnItems()});else if(t.groupByTag){const o={};e.topColumns.forEach((e=>{e.tags&&Array.isArray(e.tags)&&!1!==e.hideable&&e.tags.forEach((e=>{o[e]||(o[e]=1)}))})),l=Object.keys(o).sort().map((e=>({text:a.capitalize(e),menu:t.buildColumnMenu(t.getColumnsForTag(e)),tag:e,onBeforeSubMenu:({item:e,itemEl:r})=>{t.refreshTagMenu(e,r)}}))),r&&l.push({text:t.L("L{newColumns}"),menu:t.createAutoColumnItems()})}else l=t.buildColumnMenu(e.topColumns),r&&l.items.push(...s.transformNamedObjectToArray(t.createAutoColumnItems()));return l}createAutoColumnItems(){const e=this,{grid:t}=e,{columns:r,store:l}=t,{modelClass:o}=l,{allFields:i}=o,n={};for(let t=0,{length:l}=i;t<l;t++){const l=i[t],o=l.name;r.get(o)||l.internal||(n[o]={text:l.text||a.separate(l.name),checked:!1,onToggle:t=>{const i=r.get(o);i?i[t.checked?"show":"hide"]():r.add(r.generateColumnForField(l,{region:e.forColumn.region})),t.bubbles=!1}})}return n}getColumnsForTag(e){return this.grid.columns.records.filter((t=>t.tags&&Array.isArray(t.tags)&&t.tags.includes(e)&&!1!==t.hideable))}refreshTagMenu(e,t){this.getColumnsForTag(e.tag).forEach((t=>{const r=e.items.find((e=>e.column===t));r&&(r.checked=!0!==t.hidden)}))}buildColumnMenu(e){let t=e.length>0&&e[0].region;const{grid:r}=this,l=e.reduce(((e,l)=>{const o=r.columns.visibleColumns.filter((e=>e.region===l.region));if(!1!==l.hideable){const i={grid:r,column:l,text:l.headerText,checked:!0!==l.hidden,disabled:!0!==l.hidden&&1===o.length,cls:l.region!==t?"b-separator":""};t=l.region,l.children&&!l.isCollapsible&&(i.menu=this.buildColumnMenu(l.children)),e.push(i)}return e}),[]);return{cls:this.menuCls,items:l}}populateHeaderMenu({column:e,items:t}){const r=this,{columns:l}=r.grid;if(r.forColumn=e,!1!==e.showColumnPicker&&l.some((e=>e.hideable))&&(t.columnPicker={text:"L{columnsMenu}",localeClass:r,icon:"b-fw-icon b-icon-columns",cls:"b-separator",weight:200,menu:r.getColumnPickerItems(l),onToggle:r.onColumnToggle,disabled:r.disabled}),!1!==e.hideable&&!e.parent.isCollapsible){const o=l.visibleColumns.filter((t=>t.region===e.region));t.hideColumn={text:"L{hideColumn}",localeClass:r,icon:"b-fw-icon b-icon-hide-column",weight:210,disabled:1===o.length||r.disabled,onItem:()=>e.hide()}}}onColumnToggle({menu:e,item:t,checked:r}){if(Boolean(t.column.hidden)!==!r){var l,o;t.column[r?"show":"hide"]();const{grid:i,column:n}=t,{columns:s,features:a}=i,d=e.items,c=s.visibleColumns.filter((e=>e.region===t.column.region)),u=(null===(l=a.headerMenu)||void 0===l?void 0:l.enabled)&&a.headerMenu.menu.widgetMap.hideColumn;if(1===c.length){const e=d.find((e=>e.column===c[0]));e&&(e.disabled=!0),u&&n.region===t.column.region&&(u.disabled=!0)}else c.forEach((e=>{const t=d.find((t=>t.column===e));t&&(t.disabled=!1)})),u&&n.region===t.column.region&&(u.disabled=!1);null===(o=t.menu)||void 0===o||o.eachWidget((e=>{e.checked=r}));const h=e.owner;h&&h.column===n.parent&&(h.checked=d.some((e=>!0===e.checked)))}}getColumnDragToolbarItems(e,t){const r=this.grid.columns.visibleColumns.filter((t=>t.region===e.region));return!1!==e.hideable&&r.length>1&&t.push({text:"L{hideColumnShort}",ref:"hideColumn",group:"L{column}",localeClass:this,icon:"b-fw-icon b-icon-hide-column",weight:101,onDrop:({column:e})=>e.hide()}),t}}u(me,"$name","ColumnPicker"),u(me,"configurable",{groupByRegion:!1,groupByTag:!1,createColumnsFromModel:!1,menuCls:"b-column-picker-menu b-sub-menu"}),me._$name="ColumnPicker",de.registerFeature(me,!0);class fe extends(h(g)){constructor(...e){super(...e),u(this,"ignoreSelectors",[".b-grid-header-resize-handle",".b-field"])}doDestroy(){var e,t;null===(e=this.dragHelper)||void 0===e||e.scrollManager.destroy(),null===(t=this.dragHelper)||void 0===t||t.destroy(),super.doDestroy()}get grid(){return this.client}init(){const e=this,{grid:r}=e,l=r.element,o=t.children(l,".b-grid-headers");o.push(...t.children(l,".b-grid-header-children")),e.dragHelper?e.dragHelper.containers=o:(e.dragHelper=new z({name:"columnReorder",mode:"container",dragThreshold:10,targetSelector:".b-grid-header",floatRootOwner:r,rtlSource:r,outerElement:r.headerContainer,monitoringConfig:{scrollables:[{element:".b-grid-headers"}]},scrollManager:w.new({direction:"horizontal",element:r.headerContainer}),containers:o,isElementDraggable(t){if(Boolean(t.closest(e.ignoreSelectors.join(",")))||e.disabled)return!1;const l=t.closest(this.targetSelector),o=l&&r.columns.getById(l.dataset.columnId),i=0===(null==o?void 0:o.childLevel)&&1===r.subGrids[o.region].columns.count;return Boolean(o)&&!1!==o.draggable&&!i},ignoreSelector:".b-filter-icon,.b-grid-header-resize-handle",internalListeners:{beforeDragStart:e.onBeforeDragStart,dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,thisObj:e}}),e.relayEvents(e.dragHelper,["dragStart","drag","drop","abort"],"gridHeader"))}static get pluginConfig(){return{after:["onPaint","renderContents"]}}onDrag({context:t,event:r}){const l=e.fromElement(r.target,"gridheader");null!=l&&l.subGrid.sealedColumns?t.valid=!1:this.grid.features.columnDragToolbar||(t.valid=Boolean(r.target.closest(".b-grid-headers")))}onBeforeDragStart({context:e,event:t}){const{element:r}=e,l=e.column=this.client.columns.getById(r.dataset.columnId);return this.client.trigger("beforeColumnDragStart",{column:l,event:t})}onDragStart({context:e,event:r}){const l=this,{grid:o}=l,{column:i}=e;if(!o.features.columnDragToolbar){const e=o.element.querySelector(".b-grid-header-container").getBoundingClientRect();l.dragHelper.minY=e.top,l.dragHelper.maxY=e.bottom}o.headerContainer.classList.add("b-dragging-header"),e.dragProxy.style.fontSize=t.getStyleValue(e.element,"fontSize"),o.trigger("columnDragStart",{column:i,event:r})}onDrop({context:e,event:t}){if(!e.valid)return this.onInvalidDrop({context:e});const{grid:r}=this,l=e.dragging,o=e.target.closest(".b-grid-header"),i=e.draggedTo.dataset.region,n=o?r.columns.get(o.dataset.column):r.subGrids[i].columns.last,s=i||n.region,a=e.insertBefore,d=r.columns.getById(l.dataset.columnId),c=d.parent,u=a?r.columns.getById(a.dataset.columnId):r.subGrids[s].columns.last.nextSibling;let h;if(u)h=u.parent;else{const e=null==o?void 0:o.parentElement.closest(".b-grid-header");h=e?r.columns.getById(e.dataset.columnId):r.columns.rootNode}r.headerContainer.classList.remove("b-dragging-header"),l.remove();let g=s===d.region&&c===h&&(n===d.previousSibling||u===d.nextSibling);g=g||!1===r.trigger("beforeColumnDropFinalize",{column:d,newParent:h,insertBefore:u,event:t}),g||(g=!h.insertChild(d,u)),e.valid=!g,g||(d.region=s,0===c.children.length&&c.parent.removeChild(c)),r.trigger("columnDrop",{column:d,newParent:h,insertBefore:u,valid:e.valid,event:t})}onInvalidDrop(){this.grid.headerContainer.classList.remove("b-dragging-header")}renderContents(){this.init()}onPaint(){this.init()}}u(fe,"$name","ColumnReorder"),fe.featureClass="b-column-reorder",fe._$name="ColumnReorder",de.registerFeature(fe,!0);class pe extends g{static get $name(){return"ColumnResize"}static get configurable(){return{liveResize:"auto"}}construct(e,t){const r=this;r.grid=e,super.construct(e,t),r.resizer=new V({name:"columnResize",targetSelector:".b-grid-header",handleSelector:".b-grid-header-resize-handle",outerElement:e.element,rtlSource:e,internalListeners:{beforeresizestart:r.onBeforeResizeStart,resizestart:r.onResizeStart,resizing:r.onResizing,resize:r.onResize,cancel:r.onCancel,thisObj:r}})}doDestroy(){var e;null===(e=this.resizer)||void 0===e||e.destroy(),super.doDestroy()}changeLiveResize(e){return"auto"===e?!b.isMobileSafari:e}onBeforeResizeStart(){return!this.disabled}onResizeStart({context:e}){const{grid:t,resizer:r}=this,l=e.column=t.columns.getById(e.element.dataset.columnId);r.minWidth=l.minWidth,t.element.classList.add("b-column-resizing")}onResizing({context:e}){e.valid&&this.liveResize&&(this.grid.resizingColumns=!0,e.column.width=e.newWidth)}onResize({context:e}){const{grid:t}=this,{column:r}=e;t.element.classList.remove("b-column-resizing"),e.valid&&(this.liveResize?(t.resizingColumns=!1,t.afterColumnsResized(r)):r.width=e.newWidth)}onCancel({context:e}){const{grid:t}=this;t.element.classList.remove("b-column-resizing"),e.column.width=e.elementWidth,t.resizingColumns=!1}}pe._$name="ColumnResize",de.registerFeature(pe,!0);class be extends j{static get $name(){return"GridFieldFilterPicker"}static get type(){return"gridfieldfilterpicker"}afterConstruct(){var e;const t=this;if(!t.grid)throw new Error(`${t.constructor.$name} requires 'grid' to be configured.`);t.fields=null!==(e=t.fields)&&void 0!==e?e:{},super.afterConstruct()}updateGrid(e){var t;if(null===(t=e.store)||void 0===t||!t.modelClass)throw new Error("Grid does not have a store with a modelClass defined.");if(!e.columns)throw new Error("Grid does not have a column store.")}static getModelClassFields(e){const t=new Set(e.fields.map((({name:e})=>e)));return(null==e?void 0:e.allFields.filter((e=>!e.internal&&(K.includes(e.type)||q(e))&&(e.definedBy!==r||t.has(e.name)))))||[]}static getColumnFields(e,t,r){var l;const o=S.keyBy(be.getModelClassFields(t),"name"),i=r&&new Set(r);return Object.fromEntries(null!==(l=null==e?void 0:e.records.filter((({field:e})=>e&&o[e]&&(!i||i.has(e)))).map((({field:e,text:t})=>[e,{title:t||e,type:q(o[e])?"duration":o[e].type}])))&&void 0!==l?l:[])}changeFields(e){var t;let r=e;return Array.isArray(e)&&(y.deprecate("Core","6.0.0","FieldOption[] deprecated, use Object<String, FieldOption[]> keyed by field name instead"),r=S.keyBy(r,"name")),s.merge({},be.getColumnFields(this.grid.columns,null===(t=this.grid.store)||void 0===t?void 0:t.modelClass,this.allowedFieldNames),r)}}u(be,"configurable",{grid:null,allowedFieldNames:null}),be.initClass(),be._$name="GridFieldFilterPicker";class Ce extends U{static get $name(){return"GridFieldFilterPickerGroup"}static get type(){return"gridfieldfilterpickergroup"}validateConfig(){if(!this.grid)throw new Error(`${this.constructor.$name} requires the 'grid' config property.`)}getFilterPickerConfig(e){const{grid:t,allowedFieldNames:r}=this;return n(n({},super.getFilterPickerConfig(e)),{},{grid:t,allowedFieldNames:r})}updateGrid(e){this.store=this.grid.store}canManage(e){return super.canManage(e)&&(!this.allowedFieldNames||this.allowedFieldNames.includes(e.property))}}u(Ce,"configurable",{grid:null,allowedFieldNames:null}),u(Ce,"childPickerType","gridfieldfilterpicker"),Ce.initClass(),Ce._$name="GridFieldFilterPickerGroup";const ve={date:"date",int:"number",integer:"number",number:"number",string:"text",duration:"duration"};class we extends g{static get $name(){return"Filter"}static get configurable(){return{prioritizeColumns:!1,keyMap:{f:"showFilterEditorByKey"},isMulti:!1}}construct(e,t){if(e.features.filterBar)throw new Error("Grid.feature.Filter feature may not be used together with Grid.feature.FilterBar. These features are mutually exclusive.");const r=this;if(r.grid=e,r.closeFilterEditor=r.closeFilterEditor.bind(r),super.construct(e,t),r.bindStore(e.store),t&&"object"==typeof t){const r=s.clone(t);delete r.prioritizeColumns,delete r.isMulti,delete r.dateFormat,s.isEmpty(r)||e.store.filter(r,null,e.isConfiguring)}}doDestroy(){var e,t;null===(e=this.filterTip)||void 0===e||e.destroy(),null===(t=this.filterEditorPopup)||void 0===t||t.destroy(),super.doDestroy()}get store(){return this.grid.store}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}static get pluginConfig(){return{chain:["renderHeader","populateCellMenu","populateHeaderMenu","onElementClick","bindStore"]}}refreshHeaders(e){const r=this,l=r.grid,o=l.headerContainer;o&&(t.children(o,".b-filter-icon.b-latest").forEach((e=>e.classList.remove("b-latest"))),r.filterTip||(r.filterTip=new x({forElement:o,forSelector:".b-filter-icon",getHtml:({activeTarget:e})=>e.dataset.filterText})),l.store.isFiltered||r.filterTip.hide(),l.columns.visibleColumns.forEach((e=>{if(!1!==e.filterable){const l=r.store.filters.allValues.filter((({property:t,disabled:r,internal:l})=>t===e.field&&!r&&!l)),o=l.length>0,i=e.element;if(i){const n=e.textWrapper;let s,a=null==n?void 0:n.querySelector(".b-filter-icon");if(o){const t="&#x2022 ";s=`${r.L("L{filter}")}: `+(l.length>1?"<br/><br/>":"")+l.map((o=>{var i,n,s;let a=null!==(i=o.value)&&void 0!==i?i:"";const d=Array.isArray(a),c=null===(n=r.store)||void 0===n||null===(s=n.modelRelations)||void 0===s?void 0:s.find((({foreignKey:e})=>e===o.property));if(o.displayValue)a=o.displayValue;else{if(r.isMulti&&c){var u;const{relatedDisplayField:e}=null===(u=r.isMulti.fields)||void 0===u?void 0:u[o.property];if(e){const t=t=>{var r;return null===(r=c.foreignStore.getById(t))||void 0===r?void 0:r[e]};a=d?a[e].sort(((e,t)=>(null!=e?e:"").localeCompare(null!=t?t:""))):t(a)}}else e.formatValue&&a&&(a=d?a.map((t=>e.formatValue(t))):e.formatValue(a));d&&(a=`[ ${a.join(", ")} ]`)}return(l.length>1?t:"")+("string"==typeof o?o:`${o.operator} ${a}`)})).join("<br/><br/>")}else s=r.L("L{applyFilter}");a?a.dataset.filterText=s:a=t.createElement({parent:n,tag:"div",className:"b-filter-icon",dataset:{filterText:s}}),e.field===r.store.latestFilterField&&a.classList.add("b-latest"),i.classList.add("b-filterable"),i.classList.toggle("b-filter",o)}e.meta.isFiltered=o}})),e&&l.refreshRows())}applyFilter(e,t){const{store:r}=this,{filterFn:l}=e.filterable;e.$filter=r.addFilter(n(n(n({},e.filterable),t),{},{property:e.field,[l?"filterBy":"_"]:function(t){return l({value:this.value,record:t,operator:this.operator,property:this.property,column:e})}}),!0),r.filter()}removeFilter(e){if(this.isMulti)for(const t of this.getCurrentMultiFilters(e))this.store.removeFilter(t);else this.store.removeFilter(e.field)}disableFilter(e){for(const t of this.getCurrentMultiFilters(e))t.disabled=!0,this.store.filter(t);this.store.filter()}getCurrentMultiFilters(e){return this.store.filters.values.filter((t=>t.property===e.field))}getPopupDateItems(e,t,r,l,o,i,n,a){const d=this,c=i;function u(){d.removeFilter(e)}function h({event:e}){"Enter"===e.key&&i()}function g({source:t,value:r}){null==r?u():(d.clearSiblingsFields(t),d.applyFilter(e,{operator:t.operator,value:r,displayValue:t._value,type:"date"}))}return[s.assign({type:"date",ref:"on",placeholder:"L{on}",localeClass:d,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"sameDay"===(null==r?void 0:r.operator)?r.value:l,operator:"sameDay",onKeydown:h,onChange:g,onClose:c,onClear:u},a),s.assign({type:"date",ref:"before",placeholder:"L{before}",localeClass:d,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-before"></i>',value:"<"===(null==r?void 0:r.operator)?r.value:null,operator:"<",onKeydown:h,onChange:g,onClose:c,onClear:u},a),s.assign({type:"date",ref:"after",cls:"b-last-row",placeholder:"L{after}",localeClass:d,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-after"></i>',value:">"===(null==r?void 0:r.operator)?r.value:null,operator:">",onKeydown:h,onChange:g,onClose:c,onClear:u},a)]}getPopupNumberItems(e,t,r,l,o,i,n,a){const d=this,c=i;function u(){d.removeFilter(e)}function h({event:e}){"Enter"===e.key&&i()}function g({source:t,value:r}){null==r?u():(d.clearSiblingsFields(t),d.applyFilter(e,{operator:t.operator,value:r}))}return[s.assign({type:"number",placeholder:"L{Filter.equals}",localeClass:d,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"="===(null==r?void 0:r.operator)?r.value:l,operator:"=",onKeydown:h,onChange:g,onEsc:c,onClear:u},a),s.assign({type:"number",placeholder:"L{lessThan}",localeClass:d,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:"<"===(null==r?void 0:r.operator)?r.value:null,operator:"<",onKeydown:h,onChange:g,onEsc:c,onClear:u},a),s.assign({type:"number",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:d,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:">"===(null==r?void 0:r.operator)?r.value:null,operator:">",onKeydown:h,onChange:g,onEsc:c,onClear:u},a)]}clearSiblingsFields(e){var t;null===(t=this.filterEditorPopup)||void 0===t||t.items.forEach((t=>{t!==e&&(null==t||t.clear())}))}getPopupDurationItems(e,t,r,l,o,i,n,a){const d=this,c=i,u=()=>d.removeFilter(e);function h({source:t,value:r}){d.clearSiblingsFields(t),d.applyFilter(e,{operator:t.operator,value:r})}return d.removeFilter(e),[s.assign({type:"duration",placeholder:"L{Filter.equals}",localeClass:d,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"="===(null==r?void 0:r.operator)?r.value:l,operator:"=",onChange:h,onEsc:c,onClear:u},a),s.assign({type:"duration",placeholder:"L{lessThan}",localeClass:d,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:"<"===(null==r?void 0:r.operator)?r.value:null,operator:"<",onChange:h,onEsc:c,onClear:u},a),s.assign({type:"duration",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:d,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:">"===(null==r?void 0:r.operator)?r.value:null,operator:">",onChange:h,onEsc:c,onClear:u},a)]}getPopupStringItems(e,t,r,l,o,i,n,a){const d=this;return[s.assign({type:t,cls:"b-last-row",placeholder:"L{filter}",localeClass:d,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:r?r.value||r:l,operator:"*",onChange({source:t,value:r}){""===r?n():(d.applyFilter(e,{operator:t.operator,value:r,displayValue:t.displayField&&t.records?t.records.map((e=>e[t.displayField])).join(", "):void 0}),t.multiSelect||i())},onClose:i,onClear:n},a)]}getPopupItems(e,t,r,l,o,i,n,s){const a=this;if(a.isMulti)return a.getMultiFilterPopupItems(...arguments);switch(t){case"date":return a.getPopupDateItems(...arguments);case"number":return a.getPopupNumberItems(...arguments);case"duration":return a.getPopupDurationItems(...arguments);default:return a.getPopupStringItems(...arguments)}}getMultiFilterPopupItems(e){var t;const{grid:r,isMulti:l}=this,o=null===(t=r.store)||void 0===t?void 0:t.filters.find((t=>t.property===e.field));return[n(n({},"object"==typeof l?l:void 0),{},{type:"gridfieldfilterpickergroup",ref:"pickerGroup",limitToProperty:e.field,grid:r,filters:o?[]:[{property:e.field}],propertyFieldCls:"b-transparent property-field",operatorFieldCls:"b-transparent operator-field",valueFieldCls:"b-transparent value-field",width:"400px"})]}showFilterEditor(e,t){e=this.grid.columns.getById(e);const r=this,{store:l,isMulti:o}=r,i=e.element,n=l.filters.getBy("property",e.field),s=r.getFilterType(e);if(!1===e.filterable)return;r.closeFilterEditor();const a=r.getPopupItems(e,s,null!=n&&n.internal?null:n,t,l,r.closeFilterEditor,(()=>{r.removeFilter(e),r.closeFilterEditor()}),e.filterable.filterField,o);a.forEach((e=>e.placeholder=e.placeholder?this.L(e.placeholder):e.placeholder)),r.filterEditorPopup=N.openPopup(i,{owner:r.grid,cls:"b-filter-popup",scrollAction:"realign",layout:{type:"vbox",align:"stretch"},items:a})}closeFilterEditor(){var e;null===(e=this.filterEditorPopup)||void 0===e||e.setTimeout(this.filterEditorPopup.destroy),this.filterEditorPopup=null}getFilterType(e){const t=e.field,r=this.client.store.modelClass.getFieldDefinition(t),l=e.filterType;return l?ve[l]:ve[e.type]||r&&ve[r.type]||"text"}populateCellMenuWithDateItems({column:e,record:t,items:r}){const l=e.field;if("date"===this.getFilterType(e)){const o=this,i=t[l],n=t=>{o.applyFilter(e,{operator:t,value:i,displayValue:e.formatValue?e.formatValue(i):i,type:"date"})};r.filterDateEquals={text:"L{on}",localeClass:o,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:o.disabled,onItem:()=>n("=")},r.filterDateBefore={text:"L{before}",localeClass:o,icon:"b-fw-icon b-icon-filter-before",weight:310,disabled:o.disabled,onItem:()=>n("<")},r.filterDateAfter={text:"L{after}",localeClass:o,icon:"b-fw-icon b-icon-filter-after",weight:320,disabled:o.disabled,onItem:()=>n(">")}}}populateCellMenuWithNumberItems({column:e,record:t,items:r}){const l=e.field;if("number"===this.getFilterType(e)){const o=this,i=t[l],n=t=>{o.applyFilter(e,{operator:t,value:i})};r.filterNumberEquals={text:"L{equals}",localeClass:o,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:o.disabled,onItem:()=>n("=")},r.filterNumberLess={text:"L{lessThan}",localeClass:o,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:o.disabled,onItem:()=>n("<")},r.filterNumberMore={text:"L{moreThan}",localeClass:o,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:o.disabled,onItem:()=>n(">")}}}populateCellMenuWithDurationItems({column:e,record:t,items:r}){const l=e.field;if("duration"===this.getFilterType(e)){const o=this,i=t[l],n=t=>{o.applyFilter(e,{operator:t,value:i})};r.filterDurationEquals={text:"L{equals}",localeClass:o,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:o.disabled,onItem:()=>n("=")},r.filterDurationLess={text:"L{lessThan}",localeClass:o,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:o.disabled,onItem:()=>n("<")},r.filterDurationMore={text:"L{moreThan}",localeClass:o,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:o.disabled,onItem:()=>n(">")}}}populateCellMenuWithStringItems({column:e,record:t,items:r}){const l=this.getFilterType(e);if(!/(date|number|duration)/.test(l)){var o,i;const l=this,n=e.getFilterableValue(t),s=null!==(o=null===(i=e.filterable.filterField)||void 0===i?void 0:i.operator)&&void 0!==o?o:"*";r.filterStringEquals={text:"L{equals}",localeClass:l,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:l.disabled,onItem:()=>l.applyFilter(e,{value:n,operator:s})}}}populateCellMenu({column:e,record:t,items:r}){const l=this;!1===e.filterable||t.isSpecialRow||(l.populateCellMenuWithDateItems(...arguments),l.populateCellMenuWithNumberItems(...arguments),l.populateCellMenuWithDurationItems(...arguments),l.populateCellMenuWithStringItems(...arguments),e.meta.isFiltered&&(r.filterRemove={text:"L{removeFilter}",localeClass:l,icon:"b-fw-icon b-icon-remove",cls:"b-separator",weight:400,disabled:l.disabled||l.isMulti&&!l.columnHasRemovableFilters(e),onItem:()=>l.removeFilter(e)}),l.isMulti&&(r.filterDisable={text:"L{disableFilter}",localeClass:l,icon:"b-fw-icon b-icon-filter-disable",cls:"b-separator",weight:400,disabled:l.disabled||!l.columnHasEnabledFilters(e),onItem:()=>l.disableFilter(e)}))}columnHasRemovableFilters(e){const t=this;return Boolean(t.getCurrentMultiFilters(e).find((e=>!t.canDeleteFilter||!1!==t.callback(t.canDeleteFilter,t,[e]))))}columnHasEnabledFilters(e){return Boolean(this.getCurrentMultiFilters(e).find((e=>!e.disabled)))}populateHeaderMenu({column:e,items:t}){const r=this;e.meta.isFiltered?(t.editFilter={text:"L{editFilter}",localeClass:r,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:r.disabled,onItem:()=>r.showFilterEditor(e)},t.removeFilter={text:"L{removeFilter}",localeClass:r,weight:110,icon:"b-fw-icon b-icon-remove",disabled:r.disabled||r.isMulti&&!r.columnHasRemovableFilters(e),onItem:()=>r.removeFilter(e)},r.isMulti&&(t.disableFilter={text:"L{disableFilter}",localeClass:r,icon:"b-fw-icon b-icon-filter-disable",weight:115,disabled:r.disabled||!r.columnHasEnabledFilters(e),onItem:()=>r.disableFilter(e)})):!1!==e.filterable&&(t.filter={text:"L{filter}",localeClass:r,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:r.disabled,onItem:()=>r.showFilterEditor(e)})}onStoreBeforeFilter({filters:e}){const{columns:t}=this.client;for(let l=0;l<e.count;l++){const o=e.getAt(l);if(!o.internal){var r;const i=(o.columnOwned||this.prioritizeColumns)&&t.find((e=>!1!==e.filterable&&e.field===o.property));null!=i&&null!==(r=i.filterable)&&void 0!==r&&r.filterFn&&(i.$filter||(i.$filter=new R({columnOwned:!0,property:o.property,operator:o.operator,value:o.value,filterBy(e){return i.filterable.filterFn({value:this.value,record:e,operator:this.operator,property:this.property,column:i})}})),i.$filter.value=o.value,i.$filter.displayValue=o.displayValue,i.$filter.operator=o.operator,e.splice(l,1,i.$filter))}}}onStoreFilter(){this.refreshHeaders(!1)}renderHeader(){this.refreshHeaders(!1)}onElementClick({target:e}){if(this.filterEditorPopup&&this.closeFilterEditor(),e.classList.contains("b-filter-icon")){const t=e.closest(".b-grid-header");return this.showFilterEditor(t.dataset.columnId),!1}}showFilterEditorByKey({target:e}){const t=e.matches(".b-grid-header")&&e;return t&&this.showFilterEditor(t.dataset.columnId),Boolean(t)}isActionAvailable(e,t,r){const l=r.target.closest(".b-grid-header"),o=l&&this.client.columns.find((e=>e.id===l.dataset.columnId));return Boolean(null==o?void 0:o.filterable)}}we._$name="Filter",de.registerFeature(we);const Se={"*":null,isIncludedIn:null,startsWith:null,endsWidth:null};class ye extends g{static get $name(){return"FilterBar"}static get configurable(){return{prioritizeColumns:!1,keyStrokeFilterDelay:300,compactMode:!1,clearStoreFiltersOnHide:!0,keyMap:{ArrowUp:{handler:"disableGridNavigation",preventDefault:!1},ArrowRight:{handler:"disableGridNavigation",preventDefault:!1},ArrowDown:{handler:"disableGridNavigation",preventDefault:!1},ArrowLeft:{handler:"disableGridNavigation",preventDefault:!1},Enter:{handler:"disableGridNavigation",preventDefault:!1}}}}static get pluginConfig(){return{before:["renderContents"],chain:["afterColumnsChange","renderHeader","populateHeaderMenu","bindStore"]}}static get properties(){return{filterFieldCls:"b-filter-bar-field",filterFieldInputCls:"b-filter-bar-field-input",filterableColumnCls:"b-filter-bar-enabled",filterFieldInputSelector:".b-filter-bar-field-input",filterableColumnSelector:".b-filter-bar-enabled",filterParseRegExp:/^\s*([<>=*])?(.*)$/,storeTrackingSuspended:0}}construct(e,t){if(e.features.filter)throw new Error("Grid.feature.FilterBar feature may not be used together with Grid.feature.Filter, These features are mutually exclusive.");const r=this;r.grid=e,r.onColumnFilterFieldChange=r.onColumnFilterFieldChange.bind(r),super.construct(e,Array.isArray(t)?{filter:t}:t),r.bindStore(e.store),r.filter&&e.store.filter(r.filter),r.gridDetacher=e.ion({beforeElementClick:"onBeforeElementClick",thisObj:r})}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}doDestroy(){var e;this.destroyFilterBar(),null===(e=this.gridDetacher)||void 0===e||e.call(this),super.doDestroy()}doDisable(e){const{columns:t}=this.grid;null==t||t.forEach((t=>{const r=this.getColumnFilterField(t);r&&(r.disabled=e)})),super.doDisable(e)}updateCompactMode(e){this.client.headerContainer.classList[e?"add":"remove"]("b-filter-bar-compact");for(const t in this._columnFilters){const r=this._columnFilters[t];r.placeholder=e?r.column.headerText:null}}destroyFilterBar(){var e;null===(e=this.grid.columns)||void 0===e||e.forEach(this.destroyColumnFilterField,this)}hideFilterBar(){var e;const t=this;t.clearStoreFiltersOnHide&&t.suspendStoreTracking(),null===(e=t.grid.columns)||void 0===e||e.forEach((e=>t.hideColumnFilterField(e,!0))),t.grid.store.filter(),t.clearStoreFiltersOnHide&&t.resumeStoreTracking(),t.hidden=!0}showFilterBar(){this.suspendStoreTracking(),this.renderFilterBar(),this.resumeStoreTracking(),this.hidden=!1}toggleFilterBar(){this.hidden?this.showFilterBar():this.hideFilterBar()}renderFilterBar(){this.grid.hideHeaders||(this.grid.columns.visibleColumns.forEach((e=>this.renderColumnFilterField(e))),this.rendered=!0)}renderColumnFilterField(e){const t=this,{grid:r}=t,l=t.getColumnFilterable(e);if(l&&e.isVisible){const o=e.element,i=r.store.filters.get(e.id)||r.store.filters.getBy("property",e.field);let n=t.getColumnFilterField(e);if(n)t.onColumnFilterFieldChange({source:n,value:n.value}),n.render(o),n.show();else{const a=`${e.filterType||"text"}field`,{filterField:d}=l,c=null==d?void 0:d.cls;c&&delete l.filterField.cls,n=N.append(s.assign({type:a,cls:{[t.filterFieldCls]:1,[c]:c},dataset:{column:e.field},column:e,owner:r,clearable:!0,name:e.field,value:!i||i._filterBy||i.internal?"":t.buildFilterValue(i),inputCls:t.filterFieldInputCls,keyStrokeChangeDelay:t.keyStrokeFilterDelay,onChange:t.onColumnFilterFieldChange,onClear:t.onColumnFilterFieldChange,disabled:t.disabled,placeholder:t.compactMode?e.headerText:null,format:e.format},d),o)[0],null!=d&&d.hasOwnProperty("min")||Object.defineProperty(n,"min",{get:()=>{var t;return null===(t=e.editor)||void 0===t?void 0:t.min},set:()=>null}),null!=d&&d.hasOwnProperty("max")||Object.defineProperty(n,"max",{get:()=>{var t;return null===(t=e.editor)||void 0===t?void 0:t.max},set:()=>null}),null!=d&&d.hasOwnProperty("strictParsing")||Object.defineProperty(n,"strictParsing",{get:()=>{var t;return null===(t=e.editor)||void 0===t?void 0:t.strictParsing},set:()=>null}),n.element.retainElement=!0,t.setColumnFilterField(e,n);const u=(null==d?void 0:d.store)&&(d.store.readUrl||d.store.data||d.store.isChained);if(n.isCombo&&!u&&0===n.store.count){const t=n.value,l=()=>{n.store.readUrl||n.store.isChained||(n.store.data=r.store.getDistinctValues(e.field,!0).map((t=>r.store.modelClass.new({id:t,[e.field]:t}))))};n.value=null,n.store.isSorted||n.store.sort({field:e.field,ascending:!0}),n.picker.ion({beforeShow:l}),l(),n.value=t}!t.filter&&n.value&&!1!==r.store.autoLoad&&t.onColumnFilterFieldChange({source:n,value:n.value})}o.classList.add(t.filterableColumnCls)}}updateColumnFilterFields(){const e=this,{columns:t,store:r}=e.grid;let l,o;e._updatingFields=!0;for(const i of t.visibleColumns)l=e.getColumnFilterField(i),l&&(o=r.filters.get(i.id)||r.filters.getBy("property",i.field),o&&!o.internal?o._filterBy?l.value=o.value:l.value=e.buildFilterValue(o):l.value="");e._updatingFields=!1}getColumnFilterable(e){if(!e.isRoot&&!1!==e.filterable&&e.field&&e.isLeaf)return"function"==typeof e.filterable&&(e.filterable={filterFn:e.filterable}),e.filterable}destroyColumnFilterField(e){const t=this.getColumnFilterField(e);t&&(this.hideColumnFilterField(e,!0),t.destroy(),this.setColumnFilterField(e,void 0))}hideColumnFilterField(e,t){const r=this,{store:l}=r.grid,o=e.element,i=r.getColumnFilterField(e);if(i){r.isDestroying||i.hide();const{$filter:n}=e;!l.isDestroyed&&r.clearStoreFiltersOnHide&&n&&l.removeFilter(n,t),null==o||o.classList.remove(r.filterableColumnCls)}}getColumnFilterField(e){var t;return null===(t=this._columnFilters)||void 0===t?void 0:t[e.id]}setColumnFilterField(e,t){this._columnFilters=this._columnFilters||{},this._columnFilters[e.data.id]=t}parseFilterValue(e,t,r){var l;if(Array.isArray(t))return{value:t};if(s.isDate(t))return{operator:r.isDateField?"sameDay":r.isTimeField?"sameTime":"=",value:t};const o=String(t).match(this.filterParseRegExp);return{operator:o[1]||(null===(l=e.filterable)||void 0===l?void 0:l.operator)||"*",value:o[2]}}buildFilterValue({operator:e,value:t}){return t instanceof Date||Array.isArray(t)?t:(e in Se?"":e)+t}onStoreBeforeFilter({filters:e}){const{columns:t}=this.client;for(let l=0;l<e.count;l++){var r;const o=e.getAt(l),i=(o.columnOwned||this.prioritizeColumns)&&t.find((e=>!1!==e.filterable&&e.field===o.property));null!=i&&null!==(r=i.filterable)&&void 0!==r&&r.filterFn&&(i.$filter||(i.$filter=new R({columnOwned:!0,property:o.property,id:i.id,filterBy(e){return i.filterable.filterFn({value:this.value,record:e,property:this.property,column:i})}})),i.$filter.value=o.value,e.splice(l,1,i.$filter))}}onStoreFilter(){!this.storeTrackingSuspended&&this.rendered&&this.updateColumnFilterFields()}afterColumnsChange({changes:e,column:t}){if(!this.hidden&&null!=e&&e.hidden){e.hidden.value?this.destroyColumnFilterField(t):this.renderColumnFilterField(t)}}suspendStoreTracking(){this.storeTrackingSuspended++}resumeStoreTracking(){this.storeTrackingSuspended--}renderHeader(){this.hidden||this.renderFilterBar()}renderContents(){if(this._columnFilters)for(const e of Object.values(this._columnFilters))null==e||e.element.remove()}disableGridNavigation(e){return!!e.target.matches(this.filterFieldInputSelector)}onBeforeElementClick({event:e}){if(e.target.closest(`.${this.filterFieldCls}`))return!1}onColumnFilterFieldChange({source:e,value:t}){const r=this,{column:l}=e,{filterFn:o}=l.filterable,{store:i}=r.grid,s=l.$filter||i.filters.find((e=>(e.id===l.id||e.property===l.field)&&!e.internal));if(r._updatingFields)return;const a=null==t||""===t||Array.isArray(t)&&0===t.length;var d,c;if(i.removeFilter(s,!0),l.$filter=null,a){if(!s)return}else l.$filter=i.addFilter(n(n({property:e.name},r.parseFilterValue(l,t,e)),{},{["boolean"==typeof(null===(d=l.filterable)||void 0===d?void 0:d.caseSensitive)?"caseSensitive":void 0]:null===(c=l.filterable)||void 0===c?void 0:c.caseSensitive,[o?"filterBy":"_"]:function(e){return o({value:this.value,record:e,operator:this.operator,property:this.property,column:l})}}),!0);i.filter()}populateHeaderMenu({items:e}){e.toggleFilterBar={text:this.hidden?"L{enableFilterBar}":"L{disableFilterBar}",localeClass:this,weight:120,icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem:()=>this.toggleFilterBar()}}}ye.featureClass="b-filter-bar",ye._$name="FilterBar",de.registerFeature(ye);class xe extends g{static get $name(){return"Group"}static get configurable(){return{field:null,groupSortFn:null,renderer:null,keyMap:{" ":"toggleGroup"}}}construct(e,t){const r=this;e.features.tree||(r._thisIsAUsedExpression(e.features.groupSummary),t=r.processConfig(t),r.grid=e,super.construct(e,t),r.bindStore(e.store),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1100,thisObj:r}))}processConfig(e){return"string"==typeof e?{field:e,ascending:null}:e}setConfig(e){null===e?this.store.clearGroupers():super.setConfig(this.processConfig(e))}bindStore(e){this.detachListeners("store"),e.ion({name:"store",group:"onStoreGroup",change:"onStoreChange",thisObj:this})}updateRenderer(e){this.groupRenderer=e}updateField(e){this.store.group({field:e,ascending:this.ascending,fn:this.groupSortFn})}updateGroupSortFn(e){this.isConfiguring||this.store.group({field:this.field,ascending:this.ascending,fn:e})}doDestroy(){super.doDestroy()}doDisable(e){const{store:t}=this;if(e&&t.isGrouped){const{sorters:e}=t;e.unshift(...t.groupers),t.clearGroupers(),t.sort(e)}super.doDisable(e)}get store(){return this.grid.store}static get pluginConfig(){return{assign:["collapseAll","expandAll"],chain:["renderHeader","populateHeaderMenu","getColumnDragToolbarItems","onElementTouchStart","onElementClick","bindStore"]}}toggleCollapse(e,t){this.internalToggleCollapse(e,t)}internalToggleCollapse(e,t,r=!1){const{store:l,grid:o}=this,i=l.getById(e);i.isGroupHeader&&(t=void 0===t?!i.meta.collapsed:t,!1!==o.trigger("beforeToggleGroup",{groupRecord:i,collapse:t})&&(t?l.collapse(i):l.expand(i),r||(o.rowManager.rowCount>o.store.count?o.rowManager.renderFromRow():o.rowManager.renderFromRecord(i)),o.trigger("toggleGroup",{groupRecord:i,collapse:t}),o.afterToggleGroup()))}collapseAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach((t=>e.internalToggleCollapse(t,!0,!0))),e.grid.refreshRows(!0))}expandAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach((t=>e.internalToggleCollapse(t,!1,!0))),e.grid.refreshRows())}onBeforeRenderRow({row:e}){const t=e.grid.store.getById(e.id);e.forceInnerHTML=e.forceInnerHTML||(null==t?void 0:t.isGroupHeader)}renderCell(e){const t=this,{cellElement:r,row:l,column:o}=e,{meta:i}=e.record,n={"b-group-row":0,"b-grid-group-collapsed":0};if(!t.disabled&&t.store.isGrouped&&"groupRowFor"in i){if("action"===o.type)return;o.clearCell(r),n["b-grid-group-collapsed"]=i.collapsed,n["b-group-row"]=1,o===t.groupHeaderColumn&&(r.classList.add("b-group-title"),r.$groupHeader=!0),t.buildGroupHeader(e)}else r.$groupHeader&&(r.classList.remove("b-group-title"),r.$groupHeader=!1);l.assignCls(n)}buildGroupHeader(e){const r=this,{record:l,cellElement:o,column:i,persist:s}=e,{grid:d}=r,c=l.meta,{groupRowFor:u}=c,{groupSummary:h}=d.features,g=c.childCount-(h&&"header"!==h.target?1:0);let m=null,f=!0;if(s||i){const s=d.columns.get(c.groupField),h=e.isFirstColumn=i===r.groupHeaderColumn;null!=s&&s.groupRenderer?h&&(m=s.groupRenderer(n(n({},e),{},{groupRowFor:u,groupRecords:l.groupChildren,groupColumn:s,count:g})),f=!1):r.groupRenderer&&(m=r.groupRenderer(n(n({},e),{},{groupRowFor:u,groupRecords:l.groupChildren,groupColumn:s,count:g,isFirstColumn:h}))),h&&null==m&&f&&0===t.getChildElementCount(o)&&(m=a.encodeHtml(`${"__novalue__"===u?"":u} (${g})`))}else r.groupRenderer&&(m=r.groupRenderer(e));return"string"==typeof m?o.innerHTML=m:"object"==typeof m&&E.sync({targetElement:o,domConfig:{onlyChildren:!0,children:S.asArray(m)}}),t.getChildElementCount(o)>0&&(o._hasHtml=!0),o.innerHTML}get groupHeaderColumn(){return this.grid.columns.visibleColumns.find((e=>!e.groupHeaderReserved))}renderHeader(e){const{store:t,grid:r}=this;if(t.isGrouped)for(const e of t.groupers){const t=r.columns.get(e.field),l=t&&r.getHeaderElement(t.id);null==l||l.classList.add("b-group",e.ascending?"b-asc":"b-desc")}}populateHeaderMenu({column:e,items:t}){const r=this;!1!==e.groupable&&(t.groupAsc={text:"L{groupAscending}",localeClass:r,icon:"b-fw-icon b-icon-group-asc",cls:"b-separator",weight:400,disabled:r.disabled,onItem:()=>r.store.group(e.field,!0)},t.groupDesc={text:"L{groupDescending}",localeClass:r,icon:"b-fw-icon b-icon-group-desc",weight:410,disabled:r.disabled,onItem:()=>r.store.group(e.field,!1)}),r.store.isGrouped&&(t.groupRemove={text:"L{stopGrouping}",localeClass:r,icon:"b-fw-icon b-icon-clear",cls:e.groupable?"":"b-separator",weight:420,disabled:r.disabled,onItem:()=>r.store.clearGroupers()})}getColumnDragToolbarItems(e,t){var r;const l=this,{store:o,disabled:i}=l;t.push({text:"L{groupAscendingShort}",group:"L{group}",localeClass:l,icon:"b-icon b-icon-group-asc",ref:"groupAsc",cls:"b-separator",weight:110,disabled:i,onDrop:({column:e})=>o.group(e.field,!0)}),t.push({text:"L{groupDescendingShort}",group:"L{group}",localeClass:l,icon:"b-icon b-icon-group-desc",ref:"groupDesc",weight:110,disabled:i,onDrop:({column:e})=>o.group(e.field,!1)});const n=(null===(r=o.groupers)||void 0===r?void 0:r.some((t=>t.field===e.field)))&&!i;return t.push({text:"L{stopGroupingShort}",group:"L{group}",localeClass:l,icon:"b-icon b-icon-clear",ref:"groupRemove",disabled:!n,weight:110,onDrop:({column:e})=>o.removeGrouper(e.field)}),t}onStoreGroup({groupers:e}){const{grid:r}=this,{element:l}=r,o=l&&t.children(l,".b-grid-header.b-group");if(l){for(const e of o)e.classList.remove("b-group","b-asc","b-desc");if(e)for(const t of e){const e=r.getHeaderElementByField(t.field);e&&e.classList.add("b-group",t.ascending?"b-asc":"b-desc")}}}onStoreChange({action:e,records:t}){const{client:r}=this,{rowManager:l,store:o}=r;if(o.isGrouped&&"move"===e){const{field:e}=o.groupers[0],r=Math.min(...t.reduce(((t,r)=>{if(t.push(o.indexOf(r.instanceMeta(o).groupParent)),e in r.meta.modified){const l=o.groupRecords.find((t=>t.meta.groupRowFor===r.meta.modified[e]));l&&t.push(o.indexOf(l))}return t}),[]));l.renderFromRow(l.getRow(r))}}onElementTouchStart(e){const t=this,{target:r}=e,l=r.closest(".b-grid-header"),o=l&&t.grid.getColumnFromElement(l);e.touches.length>1&&o&&!1!==o.groupable&&!t.disabled&&t.store.group(o.field)}onElementClick(e){const t=this,{store:r}=t,{target:l}=e,o=l.closest(".b-group-row"),i=l.closest(".b-grid-header"),n=null==i?void 0:i.dataset.column;if(!(l.classList.contains("b-resizer")||t.disabled||l.classList.contains("b-action-item")||e.handled)){if(i&&n){var s;const l=null===(s=r.groupers)||void 0===s?void 0:s.find((e=>e.field===n));if(l&&!e.shiftKey)return r.group(n,!l.ascending),!1;if(e.shiftKey){!1!==t.grid.columns.get(n).groupable&&(e.altKey?r.removeGrouper(n):r.group(n))}}return o?(t.internalToggleCollapse(F.get(o).id),!1):void 0}}toggleGroup(e){var t;const{grid:r}=this,{focusedCell:l}=r;return!(this.disabled||l.isActionable||null===(t=l.record)||void 0===t||!t.isGroupHeader)&&(this.internalToggleCollapse(l.id),!0)}}xe._$name="Group",de.registerFeature(xe,!0,["Grid","Scheduler"]),de.registerFeature(xe,!1,["TreeGrid"]);class Re extends p{static get $name(){return"HeaderMenu"}static get configurable(){return{type:"header",items:null,moveColumns:null}}static get defaultConfig(){return{processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateHeaderMenu"),e}shouldShowMenu(e){const{column:t}=e;return t&&!1!==t.enableHeaderContextMenu&&t!==this.client.timeAxisColumn}getDataFromEvent(e){return s.assign(super.getDataFromEvent(e),this.client.getHeaderDataFromEvent(e))}populateHeaderMenu({items:e,column:t}){const r=this;if(t){if(t.headerMenuItems&&s.merge(e,t.headerMenuItems),t.isCollapsible){const{collapsed:l}=t,o=l?r.client.rtl?"left":"right":r.client.rtl?"right":"left";e.toggleCollapse={weight:215,icon:`b-fw-icon b-icon-collapse-${o}`,text:r.L(l?"L{expandColumn}":"L{collapseColumn}"),onItem:()=>t.collapsed=!l}}if(r.moveColumns){const l=r.getColumnToMoveBefore(t),o=r.getColumnToMoveAfter(t);l&&(e.movePrev={weight:220,icon:"b-fw-icon b-icon-column-move-left",text:r.L("L{moveBefore}",a.encodeHtml(l.text)),onItem:()=>{const{parent:e}=t;var r;l.parent.insertChild(t,l)&&(t.region=l.region,null!==(r=e.children)&&void 0!==r&&r.length||e.remove())}}),o&&(e.moveNext={weight:230,icon:"b-fw-icon b-icon-column-move-right",text:r.L("L{moveAfter}",a.encodeHtml(o.text)),onItem:()=>{const{parent:e}=t;var r;o.parent.insertChild(t,o.nextSibling)&&(t.region=o.region,null!==(r=e.children)&&void 0!==r&&r.length||e.remove())}})}}return e}getColumnToMoveBefore(e){const{previousSibling:t,parent:r}=e;return t?t.children&&!e.children?t.children[t.children.length-1]:t:r.isRoot?void 0:r}getColumnToMoveAfter(e){const{nextSibling:t,parent:r}=e;return t||(r.isRoot?void 0:r)}}Re.featureClass="",Re._$name="HeaderMenu",de.registerFeature(Re,!0);class Ee extends g{static get $name(){return"Sort"}static get configurable(){return{multiSort:!0,prioritizeColumns:!1}}static get properties(){return{ignoreRe:new RegExp(["b-grid-header-resize-handle","b-filter-icon"].join("|")),sortableCls:"b-sortable",sortedCls:"b-sort",sortedAscCls:"b-asc",sortedDescCls:"b-desc"}}construct(e,t){t=this.processConfig(t),this.grid=e,this.bindStore(this.store),super.construct(e,t)}processConfig(e){return"string"==typeof e||Array.isArray(e)?{field:e,ascending:null}:e}setConfig(e){super.setConfig(this.processConfig(e))}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeSort:"onStoreBeforeSort",sort:"syncHeaderSortState",thisObj:this})}set field(e){const t=this.grid.columns.get(e);t&&"object"==typeof t.sortable&&(t.sortable.field=t.sortable.property||e,e=t.sortable),this.store.sort(e,this.ascending)}get store(){return this.grid[this.grid.sortFeatureStore]}static get pluginConfig(){return{chain:["onElementClick","populateHeaderMenu","getColumnDragToolbarItems","renderHeader","onPaint","bindStore"]}}syncHeaderSortState(){const e=this,{grid:r}=e;if(!r.hideHeaders&&r.isPainted){const o=e.store.sorters,i=o.length,n=new I;let s;for(const a of r.columns.visibleColumns){var l;const r=a.element,d=null===(l=a.textWrapper)||void 0===l?void 0:l.dataset;let c="none";(null==d?void 0:d.sortIndex)&&delete d.sortIndex,n.value=r.classList,!1!==a.sortable?(n.add(e.sortableCls),s=o.find((e=>e.field===a.field||e.sortFn&&e.sortFn===a.sortable.sortFn)),s?(i>1&&d&&(d.sortIndex=o.indexOf(s)+1),n.add(e.sortedCls),s.ascending?(n.add(e.sortedAscCls),n.remove(e.sortedDescCls),c="ascending"):(n.add(e.sortedDescCls),n.remove(e.sortedAscCls),c="descending")):(n.remove(e.sortedCls),n["b-group"]||(n.remove(e.sortedAscCls),n.remove(e.sortedDescCls)))):n.remove(e.sortableCls),t.syncClassList(r,n),t.setAttributes(r,{"aria-sort":c})}}}populateHeaderMenu({column:e,items:t}){const r=this,{store:l}=r,o=n(n({},e.sortable),{},{field:e.field,columnOwned:!0});if(!1!==e.sortable&&(t.sortAsc={text:"L{sortAscending}",localeClass:r,icon:"b-fw-icon b-icon-sort-asc",cls:"b-separator",weight:300,disabled:r.disabled,onItem:()=>l.sort(o,!0)},t.sortDesc={text:"L{sortDescending}",localeClass:r,icon:"b-fw-icon b-icon-sort-desc",weight:310,disabled:r.disabled,onItem:()=>l.sort(o,!1)},r.multiSort&&r.grid.columns.records.some((e=>e.sortable)))){const i=l.sorters.find((t=>t.field===e.field||e.sortable.sortFn&&e.sortable.sortFn===t.sortFn));t.multiSort={text:"L{multiSort}",localeClass:r,icon:"b-fw-icon b-icon-sort",weight:320,disabled:r.disabled,menu:{addSortAsc:{text:i?"L{toggleSortAscending}":"L{addSortAscending}",localeClass:r,icon:"b-fw-icon b-icon-sort-asc",disabled:i&&(null==i?void 0:i.ascending),weight:330,onItem:()=>l.addSorter(o,!0)},addSortDesc:{text:i?"L{toggleSortDescending}":"L{addSortDescending}",localeClass:r,icon:"b-fw-icon b-icon-sort-desc",disabled:i&&!i.ascending,weight:340,onItem:()=>l.addSorter(o,!1)},removeSorter:{text:"L{removeSorter}",localeClass:r,icon:"b-fw-icon b-icon-remove",weight:350,disabled:!i,onItem:()=>{l.removeSorter(o.field)}}}}}}getColumnDragToolbarItems(e,t){const r=this,{store:l,disabled:o}=r;if(!1!==e.sortable){const i=l.sorters.find((t=>t.field===e.field));t.push({text:"L{sortAscendingShort}",group:"L{sort}",localeClass:r,icon:"b-icon b-icon-sort-asc",ref:"sortAsc",cls:"b-separator",weight:105,disabled:o,onDrop:({column:e})=>l.sort(e.field,!0)},{text:"L{sortDescendingShort}",group:"L{sort}",localeClass:r,icon:"b-icon b-icon-sort-desc",ref:"sortDesc",weight:105,disabled:o,onDrop:({column:e})=>l.sort(e.field,!1)},{text:"L{addSortAscendingShort}",group:"L{multiSort}",localeClass:r,icon:"b-icon b-icon-sort-asc",ref:"multisortAddAsc",disabled:o||i&&i.ascending,weight:105,onDrop:({column:e})=>l.addSorter(e.field,!0)},{text:"L{addSortDescendingShort}",group:"L{multiSort}",localeClass:r,icon:"b-icon b-icon-sort-desc",ref:"multisortAddDesc",disabled:o||i&&!i.ascending,weight:105,onDrop:({column:e})=>l.addSorter(e.field,!1)},{text:"L{removeSorterShort}",group:"L{multiSort}",localeClass:r,icon:"b-icon b-icon-remove",ref:"multisortRemove",weight:105,disabled:o||!i,onDrop:({column:e})=>l.removeSorter(e.field)})}return t}onStoreBeforeSort({sorters:e}){const{columns:t}=this.client;for(let l=0;l<e.length;l++){var r;const o=e[l],i=(o.columnOwned||this.prioritizeColumns)&&t.get(o.field);null!=i&&null!==(r=i.sortable)&&void 0!==r&&r.sortFn&&(e[l]=n(n(n({},o),i.sortable),{},{columnOwned:!0}))}}onElementClick(e){const t=this,{store:r}=t,{target:l}=e,o=l.closest(".b-grid-header.b-sortable"),i=null==o?void 0:o.dataset.column;if(!(t.ignoreRe.test(l.className)||t.disabled||e.handled)&&o&&i){const l=t.grid.columns.getById(o.dataset.columnId);if(r.isGrouped&&r.groupers.find((e=>e.field===i))&&!e.shiftKey)return;if(l.sortable&&!e.shiftKey)if(e.ctrlKey&&e.altKey)r.removeSorter(l.field);else{const t={columnOwned:!0,field:l.field};"object"==typeof l.sortable&&s.assign(t,l.sortable),r.sort(t,null,e.ctrlKey)}}}renderHeader(){this.syncHeaderSortState()}onPaint(){this.syncHeaderSortState()}}Ee.featureClass="b-sort",Ee._$name="Sort",de.registerFeature(Ee,!0);class Fe extends g{static get $name(){return"Stripe"}construct(e,t){super.construct(e,t),e.ion({renderrow:"onRenderRow",thisObj:this})}doDisable(e){this.isConfiguring||this.client.refreshRows(),super.doDisable(e)}onRenderRow({row:e}){const{disabled:t}=this,r=e.dataIndex%2==0;e.assignCls({"b-even":!t&&r,"b-odd":!t&&!r})}}Fe._$name="Stripe",de.registerFeature(Fe);const Ie=document.createRange();class Me extends M{static get configurable(){return{cls:{$config:{equal:(e,t)=>(null==e?void 0:e.isDomClassList)&&(null==t?void 0:t.isDomClassList)&&e.isEqual(t)}}}}construct(e){Object.assign(this,{_elements:{},_elementsArray:[],_cells:{},_allCells:[],_regions:[],lastHeight:0,lastTop:-1,_dataIndex:0,_top:0,_height:0,_id:null,forceInnerHTML:!1,isGroupFooter:!1,cellContext:new Y({grid:e.grid,id:null,columnIndex:0})}),super.construct(e),"position"===this.grid.positionMode&&(this.translateElements=this.positionElements)}doDestroy(){const e=this;e.rowManager.isDestroying||(e.removeElements(),e.rowManager.idMap[e.id]===e&&delete e.rowManager.idMap[e.id]),super.doDestroy()}get index(){return this._index}set index(e){this._index=e}get dataIndex(){return this._dataIndex}set dataIndex(e){this._dataIndex!==e&&(this._dataIndex=e,this.eachElement((t=>{t.dataset.index=e,t.ariaRowIndex=this.grid.hideHeaders?e+1:e+2})))}get id(){return this._id}set id(e){const t=this,r={id:e},l=t.rowManager.idMap;t._id===e&&l[e]===t||(l[t._id]===t&&delete l[t._id],l[e]=t,t._id=e,t.eachElement((t=>{F.assign(t,r),t.dataset.id=e})),t.eachCell((e=>F.assign(e,r))))}addElement(e,t){const r=this;let l=t.firstElementChild;for(r._elements[e]=t,r._elementsArray.push(t),r._regions.push(e),F.assign(t,{index:r.index}),r._cells[e]=[];l;)r._cells[e].push(l),r._allCells.push(l),F.set(l,{column:l.dataset.column,columnId:l.dataset.columnId,rowElement:l.parentNode,row:r}),l=l.nextElementSibling;t.dataset.index=r.index,t.ariaRowIndex=r.grid.hideHeaders?r.index+1:r.index+2}getElement(e){return this._elements[e]}getRectangle(e){return H.from(this.getElement(e))}eachElement(e){this._elementsArray.forEach(e)}eachCell(e){this._allCells.forEach(e)}get elements(){return this._elements}get element(){const e=Object.keys(this._elements)[0];return this._elements[e]}get cells(){return this._allCells}getCells(e){return this._cells[e]}getCell(e){return this._allCells.find((t=>{const r=F.get(t);return r.columnId==e||r.column==e}))}removeElements(e=!1){const t=this;t.rowManager.trigger("removeRow",{row:t}),e||t.eachElement((e=>e.remove())),t._elements={},t._cells={},t._elementsArray.length=t._regions.length=t._allCells.length=t.lastHeight=t.height=0,t.lastTop=-1}get height(){return this._height}set height(e){this._height=e}get offsetHeight(){return this.height+this.grid._rowBorderHeight}updateElementsHeight(e){const t=this;e||t.rowManager.storeKnownHeight(t.id,t.height),t.lastHeight!==t.height&&(this.eachElement((e=>e.style.height=`${t.offsetHeight}px`)),t.lastHeight=t.height)}addCls(e){this.updateCls(this.cls.add(e))}removeCls(e){this.updateCls(this.cls.remove(e))}toggleCls(e,t){this.updateCls(this.cls[t?"add":"remove"](e))}assignCls(e){this.updateCls(this.cls.assign(e))}changeCls(e){return null!=e&&e.isDomClassList?e:new I(e)}updateCls(e){this.eachElement((r=>t.syncClassList(r,e)))}setAttribute(e,t){this.eachElement((r=>r.setAttribute(e,t)))}removeAttribute(e){this.eachElement((t=>t.removeAttribute(e)))}get isFirst(){return 0===this.dataIndex}get top(){return this._top}get bottom(){return this._top+this._height+this.grid._rowBorderHeight}setTop(e,t){this._top!==e&&(this._top=e,this.translateElements(t))}setBottom(e,t){this.setTop(e-this.offsetHeight,t)}translate(e,t=!1){return this.setTop(e,t),e+this.offsetHeight}translateElements(e){const t=this,{top:r,_elementsArray:l}=t;if(t.lastTop!==r){for(let e=0,{length:t}=l;e<t;e++)l[e].style.transform=`translate(0,${r}px)`;!e&&t.rowManager.trigger("translateRow",{row:t}),t.lastTop=r}}positionElements(e){const t=this,{top:r,_elementsArray:l}=t;if(t.lastTop!==r){for(let e=0,{length:t}=l;e<t;e++)l[e].style.top=`${r}px`;!e&&t.rowManager.trigger("translateRow",{row:t}),t.lastTop=r}}offset(e){let t=this._top+e;return t<0&&(e-=t,t=0),this.setTop(t),e}render(e,r,l=!0,o=!1,i=!1){var n,s,a,d;const c=this,{cellContext:u,cls:h,elements:g,cells:m,grid:f,rowManager:p,height:b,_id:C}=c,v=F.get(c._elementsArray[0]),w=p._rowHeight,{store:S}=f,{isTree:y}=S;let x,R=0;if(r||!1===r||(r=f.store.getById(v.id),e=f.store.indexOf(r)),!r)return;const E=null===(n=r)||void 0===n?void 0:n.cls,M=E?E.isDomClassList?E:new I(E):null;h.assign({"b-grid-row-updating":l&&f.transitionDuration&&!i,"b-selected":f.isSelected(null===(s=r)||void 0===s?void 0:s.id),"b-readonly":r.readOnly,"b-linked":r.isLinked,"b-original":r.hasLinks}),c.lastRecordCls&&h.remove(c.lastRecordCls),M?(h.add(M),c.lastRecordCls=Object.assign({},M)):c.lastRecordCls=null,p.trigger("beforeRenderRow",{row:c,record:r,recordIndex:e,oldId:C}),f.beforeRenderRow({row:c,record:r,recordIndex:e,oldId:C}),c.updateCls(h),l&&f.transitionDuration&&!i&&f.setTimeout((()=>{c.isDestroyed||(h.remove("b-grid-row-updating"),c.updateCls(h))}),f.transitionDuration),c.id=r.id,c.dataIndex=e;const H=!f.fixedRowHeight&&f.getRowHeight(r)||w;let _=c.maxRequestedHeight=null;if(y)for(const e in g){const l=g[e];var L,T;if(l.id=`${f.id}-${e}-${c.id}`,t.setAttributes(l,{"aria-level":r.childLevel+1,"aria-setsize":r.parent.children.length,"aria-posinset":r.parentIndex+1}),r.isExpanded(S))t.setAttributes(l,{"aria-expanded":!0,"aria-owns":null!==(L=r.children)&&void 0!==L&&L.length?null===(T=r.children)||void 0===T?void 0:T.map((t=>`${f.id}-${e}-${t.id}`)).join(" "):null});else r.isLeaf?l.removeAttribute("aria-expanded"):l.setAttribute("aria-expanded",!1),l.removeAttribute("aria-owns")}for(u._record=r,u._id=r.id,u._rowIndex=e,R=0;R<m.length;R++)u._columnId=m[R].dataset.columnId,u._column=f.columns.getById(u._columnId),u._columnIndex=R,u._cell=m[R],u.height=H,u.maxRequestedHeight=_,u.updatingSingleRow=l,x=c.renderCell(u),p.fixedRowHeight||null!=x.height&&(_=Math.max(_,x.height),x.transient||(c.maxRequestedHeight=_));const D=null!==(a=_)&&void 0!==a?a:H;c.height=null!==(d=f.processRowHeight(r,D))&&void 0!==d?d:D,c.updateElementsHeight(i),l&&!i&&(b!==c.height&&p.translateFromRow(c,o),p.trigger("updateRow",{row:c,record:r,recordIndex:e,oldId:C}),p.trigger("renderDone")),f.afterRenderRow({row:c,record:r,recordIndex:e,oldId:C,oldHeight:b,isExport:i}),p.trigger("renderRow",{row:c,record:r,recordIndex:e,oldId:C,isExport:i}),b&&c.height!==b&&p.trigger("rowRowHeight",{row:c,record:r,height:c.height,oldHeight:b}),c.forceInnerHTML=!1}renderCell(e){var r,l;e.isLocation||(e=new Y(e));let{cell:o,record:i}=e;const n=this,{grid:s,column:a,height:d,maxRequestedHeight:c,updatingSingleRow:u=!0,isMeasuring:h=!1}=e,g=null===(r=s.features)||void 0===r?void 0:r.cellEdit,m=F.get(o),f=m.rowElement,p=F.get(f);if(!i&&(i=e.record=s.store.getById(p.id),!i))return;let b=a.getRawValue(i);const C=i.fieldMap[a.field],v={configuredHeight:d,height:null,maxRequestedHeight:c},w=a.getCellClass(e),y={cellElement:o,dataField:C,rowElement:f,value:b,record:i,column:a,size:v,grid:s,row:m.row,updatingSingleRow:u,isMeasuring:h},x=a.renderer||a.defaultRenderer;s.beforeRenderCell(y),y.cellElement!==o&&(o=y.cellElement),t.syncClassList(o,w);let R=!0;x?(b=x.call(a,y),void 0===b&&!1===a.alwaysClearCell&&(R=!1)):C&&(b=C.print(b));const I=null===(l=s.hasFrameworkRenderer)||void 0===l?void 0:l.call(s,{cellContent:b,column:a});I&&i.isSpecialRow&&(b="");const M=I&&!a.data.tree&&!i.isSpecialRow;if(R&&!M){var H;let r=o;null!=g&&null!==(H=g.editorContext)&&void 0!==H&&H.equals(e)&&!g.editor.isFinishing&&(r=n.moveContentFromCell(o,g.editor.element));const l=null!=b&&"object"==typeof b,i="string"==typeof b,s=l||null==b?"":String(b);if(n.forceInnerHTML&&(r.innerHTML="",delete r._content,o.lastDomConfig=null),l||!a.htmlEncode||a.disableHtmlEncode?!a.autoSyncHtml||i&&!t.getChildElementCount(r)?l?E.sync({targetElement:r,domConfig:{onlyChildren:!0,children:S.asArray(b)}}):r._content!==s&&(r.innerHTML=r._content=s):i?t.sync(s,r.firstElementChild):l&&E.sync({domConfig:b,targetElement:r}):o._hasHtml?(r.innerText=s,o._hasHtml=!1):t.setInnerText(r,s),r!==o){const{firstChild:e}=o;for(const t of r.childNodes)o.insertBefore(t,e)}}var _;i.isSpecialRow||(null===(_=s.processCellContent)||void 0===_||_.call(s,{cellElementData:m,rendererData:y,rendererHtml:y.rendererHtml||b}));return a.autoHeight&&null==v.height&&(o.classList.add("b-measuring-auto-height"),v.height=Math.max(o.offsetHeight,s.rowHeight),o.classList.remove("b-measuring-auto-height")),h||n.rowManager.trigger("renderCell",y),v}moveContentFromCell(e,t){Ie.setStart(e,0),Ie.setEndBefore(t);const r=document.createElement("div");return r.appendChild(Ie.extractContents()),r}}u(Me,"$name","Row"),Me.initClass(),Me._$name="Row";class He extends e{static get $name(){return"Bar"}static get type(){return"gridbar"}static get defaultConfig(){return{htmlCls:"",scrollable:{overflowX:"hidden-scroll"}}}get columns(){return this._columns||this.subGrid.columns}set columns(e){this._columns=e}fixCellWidths(){const e=this,{hasFlex:r}=e.columns;let l;e.columns.traverse((r=>{const o=e.getBarCellElement(r.id),i=t.setLength(r.width),n=t.setLength(r.minWidth),s=t.setLength(r.maxWidth);if(o){if(l=i,o.style.maxWidth=s,r.isParent&&null==r.width&&null==r.flex){const e=r.children.reduce(((e,t)=>e+(!t.hidden&&t.flex||0)),0);o.style.flex=e>0?`${e} 0 auto`:"",o.style.minWidth=null,e>0&&r.traverse((e=>e.data.minWidth=null))}else if(parseInt(r.minWidth)>=0&&(o.style.minWidth=n),o.style.flex=o.style.flexBasis=o.style.width="",r.flex)!isNaN(parseInt(r.flex))&&r.children?o.style.flex=`${r.flex} 0 auto`:o.style.flex=r.flex;else if(parseInt(r.width)>=0){const t=r.parent;!e.isHeader||t.isRoot||t.width?o.style.flexBasis=l:o.style.width=i}r.height>=0&&(o.style.height=t.setLength(r.height))}})),e.scrollable.element.classList.toggle("b-has-flex",r)}getLrPadding(e){if(!this.cellLrPadding){const t=e.ownerDocument.defaultView.getComputedStyle(e);this.cellLrPadding=parseInt(t.getPropertyValue("padding-left"))+parseInt(t.getPropertyValue("padding-right"))+parseInt(t.getPropertyValue("border-left-width"))+parseInt(t.getPropertyValue("border-right-width"))}return this.cellLrPadding}getBarCellElement(e){return this.element.querySelector(`[data-column-id="${e}"]`)}}He.initClass(),He._$name="Bar";class _e extends He{static get $name(){return"Footer"}static get type(){return"gridfooter"}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}refreshContent(){this.element.firstElementChild.innerHTML=this.contentTemplate(),this.fixFooterWidths()}onPaint({firstPaint:e}){e&&this.refreshContent()}template(){const e=this.subGrid.region;return v.tpl`
            <div class="b-grid-footer-scroller b-grid-footer-scroller-${e}" role="presentation">
                <div data-reference="footersElement" class="b-grid-footers b-grid-footers-${e}" data-region="${e}" role="presentation"></div>
            </div>
        `}get overflowElement(){return this.footersElement}getFooter(e){return this.getBarCellElement(e)}contentTemplate(){return this.columns.visibleColumns.map((e=>v.tpl`
                <div
                    class="b-grid-footer ${e.align?`b-grid-footer-align-${e.align}`:""} ${e.cls||""}"
                    data-column="${e.field||""}" data-column-id="${e.id}" data-all-index="${e.allIndex}"
                    role="presentation">
                    ${e.footerText||""}
                </div>`)).join("")}fixFooterWidths(){this.fixCellWidths()}}_e.initClass(),_e._$name="Footer";class Le extends g{static get pluginConfig(){return{chain:["destroy"],assign:["rowHeight","topRow","bottomRow","firstVisibleRow","lastVisibleRow","firstFullyVisibleRow","lastFullyVisibleRow","getRowById","getRecordCoords","getRow","getRowFor","getRowFromElement"]}}static get defaultConfig(){return{prependRowBuffer:5,appendRowBuffer:5,rowHeight:null,fixedRowHeight:null,autoHeight:!1}}static get properties(){return{idMap:{},topIndex:0,lastScrollTop:0,_rows:[],heightMap:new Map,totalKnownHeight:0,_totalHeight:0,averageRowHeight:0,scrollTargetRecordId:null,refreshDetails:{topRowIndex:0,topRowTop:0}}}construct(e){e.grid._rowManager=this,super.construct(e.grid,e)}doDestroy(){this._rows.forEach((e=>e.destroy())),super.doDestroy()}initWithHeight(e,t=!1){const r=this;return r.autoHeight&&(e=r.store.allCount*r.preciseRowOffsetHeight),r.viewHeight=e,r.calculateRowCount(t),e}reinitialize(e=!1){const t=this;t.calculateRowCount(!1,!0,!0),t.topIndex+t.rowCount-1>t.store.count&&(e=!0);const r=t.topRow&&!e?t.topRow.top:0;t.scrollTargetRecordId=null,e&&(t.topIndex=t.lastScrollTop=0);const{topRow:l}=t;l&&(l.dataIndex=t.topIndex,l.setTop(r,!0)),t.estimateTotalHeight(),t.renderFromRow(l)}matchRowCount(e=!1){const r=this,{rows:l,grid:o}=r,i=l.length,n=i-r.rowCount;if(n)if(n<0){const t=[];for(let e=i,n=i?l[i-1].dataIndex+1:0;e<r.rowCount;e++,n++)t.push(new Me({cls:o.rowCls,rowManager:r,grid:o,index:e,dataIndex:n}));l.push.apply(l,t),r.trigger("addRows",{rows:t}),e||r.renderFromRow(l[Math.max(0,i-1)])}else{var s;const{focusedCell:e}=o,d=null!=(null==e?void 0:e.id)&&(null==e||null===(s=e.cell)||void 0===s?void 0:s.contains(t.getActiveElement(o))),c=l.splice(i-n,n);var a;if(d)n===i?o.onFocusedRowDerender():(null===(a=r.getRowFor(e._record))||void 0===a?void 0:a.index)>=l.length&&l[l.length-1].cells[e.columnIndex].focus();r.trigger("removeRows",{rows:c}),c.forEach((e=>e.destroy()))}}calculateRowCount(e=!1,t=!0,r=!1){var l;const o=this,{store:i}=o,n=Math.ceil(o.viewHeight/o.minRowOffsetHeight),s=n+o.prependRowBuffer+o.appendRowBuffer;if(null===(l=o.grid.columns)||void 0===l||!l.count||isNaN(n))return o.rowCount=0,0;if(s<o.rowCount&&!t)return o.rowCount;if(o.visibleRowCount=n,o.rowCount=Math.min(i.count,s),!e){var a;if(o.rows&&o.rowCount!==o.rows.length){if(o.matchRowCount(r),(null===(a=o.bottomRow)||void 0===a?void 0:a.dataIndex)>=i.count&&0!==o.topRow.dataIndex){const e=o.bottomRow.dataIndex-i.count+1;for(const t of o.rows)t.dataIndex-=e;o.topIndex-=e}}else o.rowCount||o.trigger("changeTotalHeight",{totalHeight:o.totalHeight});o.grid.toggleEmptyText()}return o.rowCount}removeAllRows(){const e=this,{topRow:t}=e,r=t?e.refreshDetails={topRowIndex:t.dataIndex,topRowTop:t.top}:e.refreshDetails,l=e.rows.slice();return e.trigger("removeRows",{rows:l}),e.rows.forEach((e=>e.destroy())),e.rows.length=0,e.idMap={},r}setPosition(e){const{topRow:t}=this,{topRowIndex:r,topRowTop:l}=e;t.setTop(l),t.dataIndex=r}get store(){return this.client.store}get rows(){return this._rows}getRow(e){if(this.rowCount)return this.rows[e-this.topIndex]}getRowById(e){return e&&e.isModel&&(e=e.id),this.idMap[e]}getRowFromElement(e){return(e=e.closest(".b-grid-row"))&&this.getRow(e.dataset.index)}getRowAt(e,r=!1){return r||(e-=H.from(this.grid.bodyContainer,null,!0).roundPx(1).top,e+=this.grid.scrollable.y),e=t.roundPx(e),this.rows.find((t=>e>=t.top&&e<t.bottom))}getRowFor(e){return e instanceof HTMLElement?this.getRowFromElement(e):this.getRowById(e)}getNextRow(e){const t="number"==typeof e?e:e.index;return this.getRow((t+1)%this.rowCount)}get topRow(){return this.rows[0]}get bottomRow(){const e=Math.min(this.rowCount,this.store.count);return this.rows[e-1]}get firstVisibleRow(){return this.rows.find((e=>e.bottom>Math.ceil(this.grid.scrollable.y)))}get firstFullyVisibleRow(){return this.rows.find((e=>e.top>=Math.ceil(this.grid.scrollable.y)))}get lastVisibleRow(){const{grid:e}=this;return S.findLast(this.rows,(t=>t.top<e.scrollable.y+e.bodyHeight))}get lastFullyVisibleRow(){const{grid:e}=this;return S.findLast(this.rows,(t=>t.bottom<e.scrollable.y+e.bodyHeight))}offsetRows(e){if(0!==e){const{rows:t}=this,{length:r}=t;for(let l=0;l<r;l++)t[l].offset(e)}this.trigger("offsetRows",{offset:e})}get prependBufferHeight(){return this.prependRowBuffer*this.rowOffsetHeight}get appendBufferHeight(){return this.appendRowBuffer*this.rowOffsetHeight}get rowHeight(){return this._rowHeight}set rowHeight(e){const t=this,{grid:r,fixedRowHeight:l}=t,o=t.rowHeight;if(o!==e){if(s.assertNumber(e,"rowHeight"),e<10&&(e=10),t.trigger("beforeRowHeight",{height:e}),t.minRowHeight=t._rowHeight=e,l&&(t.averageRowHeight=e),t.rows.length){const i=r.scrollable.y,n=t.getRowAt(i,!0),s=n?n.top-i:0;let a,d;l?(a=e,d=o):(d=a=t.averageRowHeight,t.clearKnownHeights(),a*=e/o),t.calculateRowCount(!1,!0,!0),t.topRow.setTop(t.topRow.dataIndex*(a+r._rowBorderHeight),!0),t.refresh();i*(a/d)!==i&&r.scrollRowIntoView(n.id,{block:"start",edgeOffset:s})}t.trigger("rowHeight",{height:e,oldHeight:o})}}get rowOffsetHeight(){return Math.floor(this.preciseRowOffsetHeight)}get preciseRowOffsetHeight(){return(this.averageRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get minRowOffsetHeight(){return(this.minRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get allHeightsKnown(){return this.fixedRowHeight||this.heightMap.size>=this.store.count}storeKnownHeight(e,t){const r=this,{heightMap:l}=r;r.fixedRowHeight||(l.has(e)&&(r.totalKnownHeight-=l.get(e)),l.set(e,t),r.totalKnownHeight+=t,t<r.minRowHeight&&(r.minRowHeight=t),r.averageRowHeight=r.totalKnownHeight/l.size)}getOffsetHeight(e){const t=this;return(e&&t.heightMap.get(e.id)||e&&t.grid.getRowHeight(e)||t.averageRowHeight||t.rowHeight)+t.grid._rowBorderHeight}invalidateKnownHeight(e){const t=this;if(!t.fixedRowHeight){const{heightMap:r}=t;(e=S.asArray(e)).forEach((e=>{e&&r.has(e.id)&&(t.totalKnownHeight-=r.get(e.id),r.delete(e.id))})),t.averageRowHeight=t.totalKnownHeight/r.size}}clearKnownHeights(){this.heightMap.clear(),this.averageRowHeight=this.totalKnownHeight=0}calculateTop(e){if(this.fixedRowHeight)return e*this.rowOffsetHeight;const{store:t}=this;let r=0;for(let l=0;l<e;l++){const e=t.getAt(l);r+=this.getOffsetHeight(e)}return Math.floor(r)}getRecordCoords(e,t=!1,r=!1){const l=this,o=l.getRowById(e);let i=l.client._bodyRectangle;return t||(i=l.client.refreshBodyRectangle()),o?new H(i.x,t?Math.round(o.top):Math.round(o.top+i.y-l.client.scrollable.y),i.width,o.offsetHeight):l.getRecordCoordsByIndex(l.store.indexOf(e),t,r)}getRecordCoordsByIndex(e,t=!1,r=!1){const l=this,{topRow:o,bottomRow:i}=l,n=l.client._bodyRectangle,{id:s}=l.store.getAt(e),a=l.preciseRowOffsetHeight,d=o.dataIndex,c=i.dataIndex,u=e>c?{index:e-c-1,y:i.bottom,from:"bottomRow"}:e>d/2?{index:e-d,y:o.top,from:"topRow"}:{index:e,y:0,from:"top"},h=l.allHeightsKnown&&!r?l.calculateTop(e):Math.floor(u.y+u.index*a),g=new H(n.x,t?h:h+n.y-l.client.scrollable.y,n.width,Math.floor(l.heightMap.get(s)||a));return g.virtual=!0,g.block=g.bottom<n.y?"start":g.y>n.bottom?"end":"nearest",g}get totalHeight(){return this._totalHeight}forEach(e){this.rows.forEach(e)}[Symbol.iterator](){return this.rows[Symbol.iterator]()}refreshCell(e,t){const r=new Y({grid:this.grid,record:e,columnId:t});return Boolean(r.cell&&r.row.renderCell(r))}returnToTop(){const e=this;e.topIndex=0,e.lastScrollTop=0,e.topRow&&(e.topRow.dataIndex=0,e.topRow.setTop(0,!0)),e.refresh(),e.grid.scrollable.y=0}renderFromRecord(e){const t=this.getRowById(e.id);t&&this.renderFromRow(t)}renderFromRow(e=null){const t=this,{rows:r,store:l}=t,o=l.count;if(0===t.calculateRowCount(!1,o<r.length,!0))return void t.estimateTotalHeight(!0);const i=e?r.indexOf(e):0;let n=e?e.dataIndex:r[0].dataIndex;const s=o-n-1,a=Math.min(r.length-1,i+s);let d,c=r.length-a-1,u=i>0?r[i-1].bottom:r[i].top;for(let e=i;e<=a;e++)d=r[e],d.dataIndex=n,d.setTop(u,!0),d.render(n,l.getAt(n++),!1),u+=d.offsetHeight;for(;c-- >0;)t.displayRecordAtTop();t.bottomRow.bottom<t.viewHeight&&t.calculateRowCount(),t.estimateTotalHeight(!0),t.trigger("renderDone")}renderRows(e){let t,r=!1;(e=Array.from(e)).sort(((e,t)=>e.dataIndex-t.dataIndex));for(const l of e)t=l.height,l.render(null,null,!1),r|=l.height!==t;r&&this.translateFromRow(e[0]),this.trigger("renderDone")}translateFromRow(e,t=!1){const r=this;let l,o,i=e.bottom;for(o=e.dataIndex+1,l=r.getRow(o);l;l=r.getRow(++o))i=l.translate(i);t||r.estimateTotalHeight(!0)}refresh(){const e=this,{topRow:t}=e;t&&!e.grid.refreshSuspended&&(e.idMap={},e.renderFromRow(t),e.trigger("refresh"))}jumpToPosition(e,t){const r=this,{store:l,heightMap:o}=r,i=l.count;if(r.allHeightsKnown&&!r.fixedRowHeight){const t=e-r.prependBufferHeight,n=r.grid._rowBorderHeight;let s=0,a=0;for(;s<t;){const e=l.getAt(a);s+=o.get(e.id)+n,a++}const d=Math.max(Math.min(a,i-r.rowCount),0);r.lastScrollTop=e,r.topRow.dataIndex=r.topIndex=d,r.topRow.setTop(r.calculateTop(d),!1),r.refresh()}else{const l=r.preciseRowOffsetHeight,o=null==t?Math.floor(e/l)-r.prependRowBuffer:t-Math.floor(r.rowCount/2),n=Math.max(Math.min(o,i-r.rowCount),0),s=r.client.scrollable.y,a=Math.min(r.client._bodyRectangle.height+s+r.appendBufferHeight,r.totalHeight);if(r.lastScrollTop=e,r.topRow.dataIndex=r.topIndex=n,r.topRow.setTop(Math.floor(n*l),!1),r.refresh(),r.bottomRow.bottom<a)for(r.calculateRowCount(!1,!1,!1);r.bottomRow.bottom<a&&r._rows[r.prependRowBuffer].top<s&&r.bottomRow.dataIndex<i-1;)r.displayRecordAtBottom();r.estimateTotalHeight()}if(null!=t){const{scrollable:l}=r.grid,o=r.getRow(t),i=o&&H.from(o._elementsArray[0]).center.y,n=l.viewport.center.y;o&&(l.y=e=Math.floor(l.y+(i-n)))}return e}warpIfNeeded(e){const t=this,r={newScrollTop:e,deltaTop:e-t.lastScrollTop};if(Math.abs(r.deltaTop)>t.rowCount*t.rowOffsetHeight*3){let l;t.scrollTargetRecordId&&(l=t.store.indexOf(t.scrollTargetRecordId)),t.grid.onFocusedRowDerender(),r.newScrollTop=t.jumpToPosition(e,l),r.deltaTop=0}return r}updateRenderedRows(e,t,r=!1){const l=this,o=l.client._bodyRectangle;if(0===l.rowCount)return 0;let i=l.totalHeight;if(t||Math.abs(e-l.lastScrollTop)>=l.rowOffsetHeight||l.topRow.top>e||l.bottomRow.bottom<e+o.height){const t=l.warpIfNeeded(e);l.scrollTargetRecordId=null,l.lastScrollTop=t.newScrollTop,t.deltaTop>0?l.fillBelow(t.newScrollTop):t.deltaTop<0&&l.fillAbove(t.newScrollTop),l.fixedRowHeight||r||l.correctError(t,o,e),i=l.estimateTotalHeight()}return i}correctError(e,t,r){const l=this;let o=0;(l.allHeightsKnown||e.deltaTop<0&&r<2*t.height||e.deltaTop>0&&r>l.totalHeight-2*t.height-3)&&(o=l.topRow.top-l.calculateTop(l.topRow.dataIndex)),o&&(l.offsetRows(-o),l.grid.scrollable.y=l.lastScrollTop=l.grid.scrollable.y-o)}fillAbove(e){const t=this,r=e-t.topRow.top-t.prependBufferHeight;let l=0;for(;l>r&&t.topIndex>0;)l-=t.displayRecordAtTop();t.trigger("renderDone")}fillBelow(e){const t=this,r=e-t.topRow.top-t.prependBufferHeight,l=t.store.count,o=t.rowCount;let i=0;for(;i<r&&t.topIndex+o<l&&t.topRow.top+t.topRow.offsetHeight<e;)i+=t.displayRecordAtBottom();t.trigger("renderDone")}estimateTotalHeight(e=!1){const t=this;if(t.grid.renderingRows)return;const r=t.store.count,l=r-t.heightMap.size,{bottomRow:o}=t;let i;if(t.fixedRowHeight)i=r*t.rowOffsetHeight;else{if(i=t.totalKnownHeight+t.heightMap.size*t.grid._rowBorderHeight+l*t.preciseRowOffsetHeight,o&&l){const e=o.bottom;(e>i||t.topIndex+t.rowCount>=r&&i>e&&e>0)&&(i=e,o.dataIndex<r-1&&(i+=(r-1-o.dataIndex)*t.preciseRowOffsetHeight))}i=Math.floor(i)}return i!==t.totalHeight&&!1!==t.trigger("changeTotalHeight",{totalHeight:i,immediate:e})&&(t._totalHeight=i),i}displayRecordAtTop(){var e;const t=this,{grid:r}=t,l=t.topIndex-1,o=t.store.getAt(l),i=t.bottomRow,n=i.top;return t.trigger("beforeTranslateRow",{row:i,newRecord:o}),i.dataIndex===(null===(e=r.focusedCell)||void 0===e?void 0:e.rowIndex)&&r.onFocusedRowDerender(),i._top=t.topRow.top-t.getOffsetHeight(o),i.estimatedTop=!t.fixedRowHeight,i.render(l,o,!1),i._top=n,i.setBottom(t.topRow.top),i.estimatedTop=!1,t.topIndex--,t._rows.unshift(t._rows.pop()),i.offsetHeight}displayRecordAtBottom(){var e;const t=this,{grid:r}=t,l=t.topIndex+t.rowCount,o=t.store.getAt(l),i=t.topRow;return t.trigger("beforeTranslateRow",{row:i,newRecord:o}),i.dataIndex===(null===(e=r.focusedCell)||void 0===e?void 0:e.rowIndex)&&r.onFocusedRowDerender(),i.dataIndex=l,i.setTop(t.bottomRow.bottom),i.render(l,o,!1),t.topIndex++,t._rows.push(t._rows.shift()),i.offsetHeight}}Le.featureClass="",Le._$name="RowManager";const Te={x:1};class De extends _{addScroller(e){(this.xScrollers||(this.xScrollers=[])).push(e)}addPartner(e,t=Te){"string"==typeof t&&(t={[t]:1}),t.x&&(e.owner.initScroll(),this.xScrollers.forEach(((t,r)=>t.addPartner(e.xScrollers[r],"x")))),t.y&&super.addPartner(e,"y")}removePartner(e){this.xScrollers.forEach(((t,r)=>{t.isDestroyed||t.removePartner(e.xScrollers[r])})),super.removePartner(e)}updateOverflowX(e){var t;const r=!1===e;null===(t=this.xScrollers)||void 0===t||t.forEach((e=>e.overflowX=r?"hidden":"hidden-scroll")),this.widget.virtualScrollers.classList.toggle("b-hide-display",r)}scrollIntoView(e,t){if(e.nodeType!==Element.ELEMENT_NODE||!this.element.contains(e))return super.scrollIntoView(e,t);for(const r of this.xScrollers)if(r.element.contains(e))return r.scrollIntoView(e,t)}hasOverflow(e="y"){return"y"===e&&this.scrollHeight>this.clientHeight}set x(e){this.xScrollers&&(this.xScrollers[0].x=e)}get x(){return this.xScrollers?this.xScrollers[0].x:0}}De._$name="GridScroller";class Ae extends He{static get $name(){return"Header"}static get type(){return"gridheader"}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}get region(){var e;return null===(e=this.subGrid)||void 0===e?void 0:e.region}changeElement(e,t){const{region:r}=this;return this.getConfig("columns"),super.changeElement({className:{"b-grid-header-scroller":1,[`b-grid-header-scroller-${r}`]:r},children:[{reference:"headersElement",className:{"b-grid-headers":1,[`b-grid-headers-${r}`]:r},dataset:{region:r,reference:"headersElement",maxDepth:this.maxDepth}}]},t)}get overflowElement(){return this.headersElement}getColumnConfig(e){const{id:t,align:r,resizable:l,isLeaf:o,isParent:i,isLastInSubGrid:s,cls:a,childLevel:d,field:c,tooltip:u,children:h,isFocusable:g,grid:m}=e,f=null==m?void 0:m.focusedCell,p=-1===(null==f?void 0:f.rowIndex)&&(null==f?void 0:f.column)===e;if(e.isVisible)return{className:{"b-grid-header":1,"b-grid-header-parent":i,[`b-level-${d}`]:1,[`b-depth-${e.meta.depth}`]:1,[`b-grid-header-align-${r}`]:r,"b-grid-header-resizable":l&&o,[a]:a,"b-collapsible":e.collapsible,"b-last-parent":i&&s,"b-last-leaf":o&&s},role:g?"columnheader":"presentation","aria-sort":"none","aria-label":e.ariaLabel,[g?"tabIndex":""]:p?0:-1,dataset:n(n({},x.encodeConfig(u)),{},{columnId:t,[c?"column":""]:c}),children:[{className:"b-grid-header-text",children:[{[m&&g?"id":""]:`${null==m?void 0:m.id}-column-${e.id}`,className:"b-grid-header-text-content"}]},h?{className:"b-grid-header-children",children:h.map((e=>this.getColumnConfig(e)))}:null,{className:"b-grid-header-resize-handle"}]}}calculateMinWidthForSafari(){let e=0;return this.columns.visibleColumns.forEach((t=>{e+=t.calculateMinWidth()})),e}fixHeaderWidths(){this.fixCellWidths()}refreshHeaders(){const e=this;e.columns.traverse((t=>{const r=e.getBarCellElement(t.id);if(r){let l=t.headerText;t.headerRenderer&&(l=t.headerRenderer.call(t.thisObj||e,{column:t,headerElement:r})),t.headerWidgetMap&&Object.values(t.headerWidgetMap).forEach((e=>{e.render(t.textWrapper)})),t.icon&&(l=`<i class="${a.encodeHtml(t.icon)}"></i>`+(l||""));const o=r.querySelector(".b-grid-header-text-content");o&&(o.innerHTML=l||"")}})),e.fixHeaderWidths()}get columns(){const e=this,t=super.columns;return e.columnsDetacher||(e.columnsDetacher=t.ion({change(){e.initDepths()},thisObj:e}),e.initDepths()),t}set columns(e){super.columns=e}initDepths(e=this.columns.topColumns,t=null){const r=this;let l=0;null!=t&&t.meta&&t.meta.depth++;for(const o of e){const{meta:e}=o;e.depth=0,o.children&&(r.initDepths(o.children.filter(r.columns.chainedFilterFn),o),e.depth&&t&&(t.meta.depth+=e.depth)),e.depth>l&&(l=e.depth)}return t||(r.maxDepth=l),l}getHeader(e){return this.getBarCellElement(e)}get contentElement(){return this.element.firstElementChild}refreshContent(){const e=this;E.sync({domConfig:{children:e.columns.topColumns.map((t=>e.getColumnConfig(t))),onlyChildren:!0,strict:!0,syncIdField:"columnId",releaseThreshold:0},targetElement:e.contentElement}),e.refreshHeaders()}onPaint({firstPaint:e}){e&&this.refreshContent()}}Ae.initClass(),Ae._$name="Header";const ke={touchstart:"onElementTouchStart",touchmove:"onElementTouchMove",touchend:"onElementTouchEnd",mouseover:"onElementMouseOver",mouseout:"onElementMouseOut",mousedown:"onElementMouseDown",mousemove:"onElementMouseMove",mouseup:"onElementMouseUp",click:"onHandleElementClick",dblclick:"onElementDblClick",keyup:"onElementKeyUp",keypress:"onElementKeyPress",contextmenu:"onElementContextMenu",pointerdown:"onElementPointerDown",pointerup:"onElementPointerUp"},Be=["pageX","pageY","clientX","clientY","screenX","screenY"];function Oe(e,t=!0){null==e||e.classList.toggle("b-hover",t)}function Pe(e,t,r=!0){t&&e&&Oe(t.getCell(e),r)}var Ge=e=>class extends(e||M){static get $name(){return"GridElementEvents"}static get configurable(){return{longPressTime:400,enableUndoRedoKeys:!0,keyMap:{"Ctrl+z":"undoRedoKeyPress","Ctrl+Shift+z":"undoRedoKeyPress"," ":{handler:"clickCellByKey",weight:1e3}}}}initInternalEvents(){const e=Object.keys(ke),t=e.length,r={element:this.bodyElement,thisObj:this};for(let l=0;l<t;l++){const t=e[l];r[t]={handler:"handleEvent"},t.startsWith("touch")&&(r[t].passive=!1)}C.on(r),C.on({focusin:"onGridBodyFocusIn",element:this.bodyElement,thisObj:this,capture:!0})}getCellDataFromEvent(e,t=!1){const r=this,{columns:l}=r,{target:o}=e;let i=o.closest(".b-grid-cell");if(!i&&t&&!o.classList.contains("b-grid-row")&&!o.classList.contains("b-grid-subgrid")){const{top:t,left:o,right:s,bottom:a}=r.bodyContainer.getBoundingClientRect();let d,{x:c,y:u}=e;var n;if(c>=o&&c<=s?u=d=Math.ceil(r[(u<t?"first":"last")+"FullyVisibleRow"].element.getBoundingClientRect().y):u>=t&&u<=a&&(c=d=Math.ceil(l.visibleColumns[c<o?0:l.visibleColumns.length-1].element.getBoundingClientRect().x)),void 0!==d)i=null===(n=document.elementFromPoint(c,u))||void 0===n?void 0:n.closest(".b-grid-cell")}if(i){const e=F.get(i),{id:t,columnId:o}=e,n=r.store.getById(t),s=l.getById(o);return n?{cellElement:i,cellData:e,columnId:o,id:t,record:n,column:s,cellSelector:{id:t,columnId:o}}:null}}getHeaderDataFromEvent(e){const t=e.target.closest(".b-grid-header");if(t){const e=s.assign({},t.dataset),{columnId:r}=e,l=this.columns.getById(r);return l?{headerElement:t,headerData:e,columnId:r,column:l}:null}}handleEvent(e){!this.disabled&&ke[e.type]&&this[ke[e.type]](e)}onElementTouchStart(e){const r=this,l=r.getCellDataFromEvent(e);t.isTouchEvent=!0,1===e.touches.length&&(r.longPressTimeout=r.setTimeout((()=>{r.onElementLongPress(e),e.preventDefault(),r.longPressPerformed=!0}),r.longPressTime)),l&&!e.defaultPrevented&&r.onFocusGesture(e)}onElementTouchMove(e){const t=this,{lastTouchTarget:r}=t,l=e.changedTouches[0],{pageX:o,pageY:i}=l,n=document.elementFromPoint(o,i);if(t.longPressTimeout&&(t.clearTimeout(t.longPressTimeout),t.longPressTimeout=null),n!==r){if(r){const t=new MouseEvent("mouseout",s.copyProperties({relatedTarget:n,pointerType:"touch",bubbles:!0},l,Be));t.preventDefault=()=>e.preventDefault(),null==r||r.dispatchEvent(t)}if(n){const t=new MouseEvent("mouseover",s.copyProperties({relatedTarget:r,pointerType:"touch",bubbles:!0},l,Be));t.preventDefault=()=>e.preventDefault(),null==n||n.dispatchEvent(t)}}t.lastTouchTarget=n}onElementTouchEnd(e){const t=this;t.longPressPerformed&&(e.cancelable&&e.preventDefault(),t.longPressPerformed=!1),t.longPressTimeout&&(t.clearTimeout(t.longPressTimeout),t.longPressTimeout=null)}onElementLongPress(e){}triggerCellMouseEvent(e,t,r=this.getCellDataFromEvent(t)){const l=this;if(r){const i=l.columns.getById(r.columnId),n={grid:l,record:r.record,column:i,cellSelector:r.cellSelector,cellElement:r.cellElement,target:t.target,event:t};var o;if(l.trigger("cell"+a.capitalize(e),n),"click"===e)null===(o=i.onCellClick)||void 0===o||o.call(i,n)}}onElementMouseDown(e){const t=this,r=t.getCellDataFromEvent(e);t.skipFocusSelection=!0,t.isScrollbarOrRowBorderOrSplitterClick(e)?e.preventDefault():(t.triggerCellMouseEvent("mousedown",e,r),r&&!e.defaultPrevented&&t.onFocusGesture(e))}isScrollbarOrRowBorderOrSplitterClick({target:e,x:r,y:l}){if(e.closest(".b-grid-splitter")||e.matches(".b-grid-row, .b-virtual-width"))return!0;if(e.matches(".b-vertical-overflow")){return r>e.getBoundingClientRect().right-t.scrollBarWidth}if(e.matches(".b-horizontal-overflow")){return l>e.getBoundingClientRect().bottom-t.scrollBarWidth-1}}onElementMouseMove(e){this.mouseMoveEvent=e}onElementMouseUp(e){}onElementPointerDown(e){}onElementPointerUp(e){}onHandleElementClick(e){!1!==this.trigger("beforeElementClick",{event:e})&&this.onElementClick(e)}onElementClick(e){const t=this,r=t.getCellDataFromEvent(e);r&&t.triggerCellMouseEvent("click",e,r)}onFocusGesture(e){const t=this,r=2===e.button,l=!r&&e.target.matches(".b-icon-tree-expand, .b-icon-tree-collapse"),o=!document.hasFocus()&&b.isMac&&r;var i;l||o?e.preventDefault():(t.navigationEvent=e,(r||null!==(i=t.focusedCell)&&void 0!==i&&i.equals(new Y(e.target)))&&t.focusCell(new Y(e.target)))}onElementDblClick(e){const{target:t}=e;if(this.triggerCellMouseEvent("dblClick",e),t.classList.contains("b-grid-header-resize-handle")){const e=t.closest(".b-grid-header");this.columns.getById(e.dataset.columnId).resizeToFitContent()}}onElementMouseOver(e){if(!this.scrolling){const t="number"!=typeof e.buttons||0===e.buttons,r=e.target.closest(".b-grid-cell");t&&!r&&e.target.classList.contains("b-grid-row")&&this.setHovered(document.elementFromPoint(e.x,e.y-2).closest(".b-grid-cell")),r&&(t&&this.setHovered(r),this.triggerCellMouseEvent("mouseOver",e)),this.trigger("mouseOver",{event:e})}}onElementMouseOut(e){if(this.setHovered(null),!this.scrolling){e.target.closest(".b-grid-cell")&&this.triggerCellMouseEvent("mouseOut",e),this.trigger("mouseOut",{event:e})}}setHovered(e){var t,r;const l=this,{selectionMode:o}=l,i=o.rowNumber&&(null===(t=l.columns.find((e=>"rownumber"==e.type)))||void 0===t?void 0:t.id),n=o.checkbox&&(null===(r=l.checkboxSelectionColumn)||void 0===r?void 0:r.id);if(l._hoveredCell){Oe(l._hoveredCell,!1);const e=F.get(l._hoveredCell),{row:t}=e;var s;if(t&&!t.isDestroyed&&(Pe(i,t,!1),Pe(n,t,!1)),null!=e&&e.columnId)Oe(null===(s=l.columns.getById(e.columnId))||void 0===s?void 0:s.element,!1);l._hoveredCell=null}if(l._hoveredRow&&!l._hoveredRow.isDestroyed&&l._hoveredRow.removeCls("b-hover"),l._hoveredRow=null,e&&!l.scrolling){const t=F.get(e),{row:r}=t;var a;if(r)if(o.cell&&t.columnId!==i&&t.columnId!==n)Oe(e),l._hoveredCell=e,Pe(n,r),Pe(i,r),Oe(null===(a=l.columns.getById(t.columnId))||void 0===a?void 0:a.element);else l._hoveredRow=r,r.addCls("b-hover")}}keyMapOnKeyDown(e){this.onElementKeyDown(e),super.keyMapOnKeyDown(e)}onElementKeyDown(e){if(e.handled)return;const t=this,r=t.focusedCell;if(null!=r&&r.isCell&&!r.isActionable){var l,o;const i=r.cell;null===(l=(o=t.columns.getById(i.dataset.columnId)).onCellKeyDown)||void 0===l||l.call(o,{event:e,cellElement:i})}}undoRedoKeyPress(e){var t;const{stm:r}=this.store;return!(!r||!this.enableUndoRedoKeys||null!==(t=this.features.cellEdit)&&void 0!==t&&t.isEditing)&&(r.onUndoKeyPress(e),!0)}clickCellByKey(e){const t=this,r=t.focusedCell,l=null==r?void 0:r.cell,o=t.columns.getById(l.dataset.columnId);return!(null==r||!r.isCell||r.isActionable||!o.onCellClick)&&(o.onCellClick({grid:t,column:o,record:t.store.getById(r.id),cellElement:l,target:e.target,event:e}),!0)}onElementKeyPress(e){}onElementKeyUp(e){}onElementContextMenu(e){const r=this,l=r.getCellDataFromEvent(e);l&&(r.triggerCellMouseEvent("contextMenu",e,l),t.isTouchEvent&&r.onFocusGesture(e))}onInternalResize(e,r,l,o,i){const n=this;n._devicePixelRatio&&n._devicePixelRatio!==globalThis.devicePixelRatio&&t.resetScrollBarWidth(),n._devicePixelRatio=globalThis.devicePixelRatio,n._bodyRectangle=H.client(n.bodyContainer),super.onInternalResize(...arguments),l!==i&&(n._bodyHeight=n.bodyContainer.offsetHeight,n.isPainted&&n.rowManager.initWithHeight(n._bodyHeight)),n.refreshVirtualScrollbars(),r!==o&&n.setTimeout((()=>{n.isDestroyed||n.updateResponsive(r,o)}),0)}get widgetClass(){}};const Ne={string:1,object:1,function:1};var $e=e=>class extends(e||M){static get $name(){return"GridFeatures"}set features(e){const t=this,r=de.getInstanceDefaultFeatures(this);e=t._features=s.assign({},e),r&&Object.keys(r).forEach((t=>{t in e||(e[t]=!0)}));const l=de.getInstanceFeatures(this);for(const r of Object.keys(e)){const o=e[r];if(o){const i=!globalThis.__bryntum_code_editor_changed;if(a.uncapitalize(r)!==r){const e=`Invalid feature name '${r}', must start with a lowercase letter`;if(i)throw new Error(e);console.error(e),t._errorDuringConfiguration=e}const n=l[r];if(!n){const e=`Feature '${r}' not available, make sure you have imported it`;if(i)throw new Error(e);return console.error(e),void(t._errorDuringConfiguration=e)}Reflect.defineProperty(e,r,t.createFeatureInitializer(e,r,n,o))}}}get features(){return this._features}createFeatureInitializer(e,t,r,l){const o=[this],i=r.prototype.construct;return!0===l&&(l={}),Ne[typeof l]&&(o[1]=l),{configurable:!0,get:()=>(delete e[t],r.prototype.construct=function(...l){e[t]=this,i.apply(this,l),r.prototype.construct=i},new r(...o))}}hasFeature(e){const{features:t}=this;if(t){const t=Object.getOwnPropertyDescriptor(this.features,e);if(t)return Boolean(t.value||t.get)}return!1}hasActiveFeature(e){var t,r;return Boolean((null===(t=this.features)||void 0===t?void 0:t[e])&&!(null!==(r=this.features)&&void 0!==r&&r[e].disabled))}getConfigValue(e,t){if("features"===e){const e={};for(const i in this.features){var r,l,o;const n=null===(r=this.features[i])||void 0===r||null===(l=(o=r).getCurrentConfig)||void 0===l?void 0:l.call(o,t);n?s.isEmpty(n)?de.isDefaultFeatureForInstance(this.features[i].constructor,this)||(e[i]=!0):e[i]=n:e[i]=!1}return e}return super.getConfigValue(e,t)}get widgetClass(){}};const We=Object.freeze({}),ze=Object.freeze({x:!1,y:!1}),Ve=function(e){return this.focusableFinderCell.contains(e)?t.isFocusable(e)&&!e.disabled?t.NodeFilter.FILTER_ACCEPT:t.NodeFilter.FILTER_SKIP:t.NodeFilter.FILTER_REJECT};var je=e=>{var r;return u(r=class extends(e||M){static get $name(){return"GridNavigation"}onStoreRecordIdChange(e){var t;null===(t=super.onStoreRecordIdChange)||void 0===t||t.call(this,e);const{focusedCell:r}=this,{oldValue:l,value:o}=e;r&&r.id===l&&(r._id=o)}onFocusedRowDerender(){const e=this,{focusedCell:r}=e;if(null!=(null==r?void 0:r.id)&&r.cell){const l=r.cell.contains(t.getActiveElement(e));if(e.hideHeaders)l&&e.revertFocus();else{const t=e.normalizeCellContext({rowIndex:-1,columnIndex:l?r.columnIndex:0});l?e.focusCell(t):t.cell.tabIndex=0}r.cell.tabIndex=-1}}navigateFirstCell(){this.focusCell(Y.FIRST_CELL)}navigateFirstColumn(){this.focusCell(Y.FIRST_COLUMN)}navigateLastCell(){this.focusCell(Y.LAST_CELL)}navigateLastColumn(){this.focusCell(Y.LAST_COLUMN)}navigatePrevPage(){this.focusCell(Y.PREV_PAGE)}navigateNextPage(){this.focusCell(Y.NEXT_PAGE)}activateHeader(e){if(e.target.classList.contains("b-grid-header")&&this.focusedCell.isColumnHeader){var t;const{column:r}=this.focusedCell;null===(t=r.onKeyDown)||void 0===t||t.call(r,e),this.getHeaderElement(r.id).click()}return!1}onEscape(e){const{focusedCell:t}=this;!e.target.closest(".b-dragging")&&null!=t&&t.isActionable&&(e.stopImmediatePropagation(),this._focusedCell=null,this.focusCell({rowIndex:t.rowIndex,column:t.column},{disableActionable:!0}))}onTab(e){const{target:r}=e,{focusedCell:l,bodyElement:o}=this,{isActionable:i,actionTargets:n}=l;if(i&&t.isEditable(r)&&!r.readOnly&&r===n[n.length-1])e.preventDefault(),this.navigateRight(e);else if(!i||r===n[n.length-1])return o.style.display="none",this.requestAnimationFrame((()=>o.style.display="")),!1}onShiftTab(e){const r=this,{target:l}=e,{focusedCell:o,bodyElement:i}=r,{cell:n,isActionable:s,actionTargets:a}=o,d=s&&t.isEditable(l)&&!l.readOnly,c=0===o.columnIndex&&o.rowIndex===(r.hideHeaders?0:-1);if(!c&&d&&l===a[0])e.preventDefault(),r.navigateLeft(e);else if(!s||l===a[0]){const e=!c&&!r.hideHeaders&&r.focusCell({rowIndex:-1,column:0},{disableActionable:!0});return e?(e.cell.tabIndex=-1,n.tabIndex=0,r._focusedCell=o):(i.style.display="none",r.requestAnimationFrame((()=>i.style.display=""))),!1}}onSpace(e){return this.focusedCell.isActionable||e.preventDefault(),!1}get focusedCell(){return this._focusedCell}get isActionableLocation(){var e;return null===(e=this._focusedCell)||void 0===e?void 0:e.isActionable}set focusedCell(e){this.focusCell(e)}get focusedRecord(){var e;return null===(e=this._focusedCell)||void 0===e?void 0:e.record}get cellCSSSelector(){const e=this._focusedCell;return e?`[data-index=${e.rowIndex}] [data-column-id=${e.columnId}]`:""}afterHide(){super.afterHide(...arguments),this.lastFocusedCell=null}isFocused(e){var t;return Boolean(null===(t=this._focusedCell)||void 0===t?void 0:t.equals(this.normalizeCellContext(e)))}get focusElement(){if(!this.isDestroying){let t;var e;if(this.store.count&&this._focusedCell)t=this._focusedCell.target;else t=this.normalizeCellContext({rowIndex:-1,columnIndex:(null===(e=this._focusedCell)||void 0===e?void 0:e.columnIndex)||0}).target;const r=super.focusElement;return!r||t&&t.compareDocumentPosition(r)!==Node.DOCUMENT_POSITION_PRECEDING?t:r}}onPaint({firstPaint:e}){var t;const r=this;null===(t=super.onPaint)||void 0===t||t.call(this,...arguments);const l=this.normalizeCellContext({rowIndex:r.hideHeaders?0:-1,column:r.hideHeaders?0:r.columns.find((e=>!e.hidden&&e.isFocusable))});if(l.cell){r._focusedCell=l;const{target:e}=l;e===l.cell&&(l.cell.tabIndex=0)}}onGridBodyFocusIn(e){const t=this,{bodyElement:r}=t,l=t.focusedCell,o=(null==l?void 0:l.initialTarget)||(null==l?void 0:l.target),{target:i,relatedTarget:n}=e,s=i.closest(t.focusableSelector);if(s&&(!f.currentMouseDown||f.isMouseDown(0)||f.isMouseDown(2))){var a;const u=new Y(i),{cell:h}=u,g=null==l?void 0:l.cell,m=u.actionTargets=t.findFocusables(s),p=(!t._fromFocusCell||t.selectOnFocus)&&(i===h||t._selectActionCell)&&!(null!=i&&i._isRevertingFocus);if(!t.store.getById(s.parentNode.dataset.id)&&h!==s)return void h.focus({preventScroll:!0});if(i.matches(t.focusableSelector)){if(t.disableActionable)u._target=h;else if(m.length){var d;return t._selectActionCell=(null===(d=f.currentMouseDown)||void 0===d?void 0:d.target)===i,m[0].focus(),void delete t._selectActionCell}}else{var c;if(null!=l&&l.target&&n&&(!f.isMouseDown()||!r.contains(null===(c=f.currentMouseDown)||void 0===c?void 0:c.target))&&!r.contains(n)&&!u.equals(l))return void o.focus();u._target=i}if(g&&(g.classList.remove("b-focused"),g.tabIndex=-1),h&&(h.classList.add("b-focused"),u.column.onCellFocus(u),h===i&&(h.tabIndex=0),h.contains(e.relatedTarget)&&o===i))return;t._focusedCell=u,null===(a=t.onCellNavigate)||void 0===a||a.call(t,t,l,u,p),t.trigger("navigate",{lastFocusedCell:l,focusedCell:u,event:e})}else null==o||o.focus()}findFocusables(e){const{focusableFinder:t}=this,r=[];t.currentNode=this.focusableFinderCell=e;for(let e=t.nextNode();e;e=t.nextNode())r.push(e);return r}get focusableFinder(){const e=this;return e._focusableFinder||(e._focusableFinder=e.setupTreeWalker(e.bodyElement,t.NodeFilter.SHOW_ELEMENT,{acceptNode:Ve.bind(e)})),e._focusableFinder}restoreActiveItem(e=this._focusedCell){if(this.rowManager.count)return isNaN(e)?e.isModel||(e=this.store.getById(e)):e=this.store.getAt(e),this.focusCell(e)}focusCell(e,t=We){var r,l;const o=this,{_focusedCell:i}=o,{scroll:n,disableActionable:s}=t;if(-1===(null===(r=e)||void 0===r?void 0:r.rowIndex)&&o.hideHeaders)return void o.revertFocus();e="number"==typeof e&&null!=i&&i.isLocation?i.move(e):o.normalizeCellContext(e);const a="doSelect"in t?t.doSelect:!e.isActionable||e.initialTarget===e.cell;var d;if(e.equals(i))return null===(d=o.onCellNavigate)||void 0===d||d.call(o,o,i,e,a),i;const c=o.getSubGridFromColumn(e.columnId),{cell:u}=e,h=u||o.getCell({rowIndex:o.rowManager.topIndex,columnId:e.columnId}),g=H.from(c.element),m=H.from(o.bodyElement),f=H.from(h).moveTo(null,g.y);return!1===n||-1===e.rowIndex?t=Object.assign({},t,ze):(t=Object.assign({},t,n),f.width>g.width||f.height>m.height?t.x=t.y=!1:t.column=e.columnId,o.scrollRowIntoView(e.id,t)),(o._hoveredRow||o._hoveredCell)&&o.setHovered(),o.disableActionable=s,o.selectOnFocus=a,o._fromFocusCell=!0,null===(l=e[s?"cell":"target"])||void 0===l||l.focus(),o.disableActionable=o.selectOnFocus=!1,delete o._fromFocusCell,e}blurCell(e){const t=this.getCell(e);t&&t.classList.remove("b-focused")}clearFocus(e){const t=this;t._focusedCell&&(t.lastFocusedCell=e?null:t._focusedCell,t.blurCell(t._focusedCell),t._focusedCell=null)}internalNextPrevCell(e=!0){const t=this,r=t._focusedCell;return r?t.focusCell({id:r.id,columnId:t.columns.getAdjacentVisibleLeafColumn(r.columnId,e,!0).id}):null}navigateRight(){var e;return null!==(e=arguments[0])&&void 0!==e&&e.fromKeyMap?this.focusCell(this.rtl?Y.PREV_CELL:Y.NEXT_CELL):(arguments[0]&&y.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevCell(!this.rtl))}navigateLeft(){var e;return null!==(e=arguments[0])&&void 0!==e&&e.fromKeyMap?this.focusCell(this.rtl?Y.NEXT_CELL:Y.PREV_CELL):(arguments[0]&&y.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevCell(Boolean(this.rtl)))}internalNextPrevRow(e,t=!0,r=!0){const l=this,o=l._focusedCell;if(!o)return!1;const i=l.store["get"+(e?"Next":"Prev")](o.id,!1,t);return i?l.focusCell({id:i.id,columnId:o.columnId,scroll:{x:!1}}):e||!r||o.isColumnHeader?void 0:(this.clearFocus(),this.getHeaderElement(o.columnId).focus())}navigateDown(){var e;return null!==(e=arguments[0])&&void 0!==e&&e.fromKeyMap?this.focusCell(Y.DOWN):(arguments[0]&&y.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevRow(!0,!1))}navigateUp(){var e;return null!==(e=arguments[0])&&void 0!==e&&e.fromKeyMap?this.focusCell(Y.UP):(arguments[0]&&y.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevRow(!1,!1))}get widgetClass(){}},"configurable",{focusable:!1,focusableSelector:".b-grid-cell,.b-grid-header.b-depth-0",keyMap:{ArrowUp:{handler:"navigateUp",weight:10},ArrowRight:{handler:"navigateRight",weight:10},ArrowDown:{handler:"navigateDown",weight:10},ArrowLeft:{handler:"navigateLeft",weight:10},"Ctrl+Home":"navigateFirstCell",Home:"navigateFirstColumn","Ctrl+End":"navigateLastCell",End:"navigateLastColumn",PageUp:"navigatePrevPage",PageDown:"navigateNextPage",Enter:"activateHeader",Escape:{handler:"onEscape",weight:10},"Shift+Tab":{handler:"onShiftTab",preventDefault:!1},Tab:{handler:"onTab",preventDefault:!1}," ":{handler:"onSpace",preventDefault:!1}}}),r},Ke=e=>class extends(e||M){static get $name(){return"GridResponsive"}static get defaultConfig(){return{responsiveLevels:Object.freeze({small:400,medium:600,large:"*"})}}getClosestBiggerLevel(e){const t=this,r=Object.keys(s.assign({},t.responsiveLevels));let l=null,o=99995,i=null;return r.forEach((r=>{let n=t.responsiveLevels[r];if(["number","string"].includes(typeof n)||(n=n.levelWidth),"*"===n)i=r;else if(e<n){const t=n-e;t<o&&(o=t,l=r)}})),l||i}get responsiveLevel(){return this.getClosestBiggerLevel(this.width)}updateResponsive(e,t){const r=this,l=r.getClosestBiggerLevel(t),o=r.getClosestBiggerLevel(e);if(0===t||l!==o){const i=r.responsiveLevels[o];["number","string"].includes(typeof i)||r.applyState(i),r.columns.forEach((e=>{const t=e.responsiveLevels;t&&(t[o]?e.applyState(t[o]):t["*"]&&e.applyState(t["*"]))})),r.element.classList.remove("b-responsive-"+l),r.element.classList.add("b-responsive-"+o),r.trigger("responsive",{level:o,width:e,oldLevel:l,oldWidth:t})}}get widgetClass(){}};const qe={string:1,number:1},Ue={dataset:1,batch:1};var Xe=e=>{var t;return u(t=class extends(e||M){static get $name(){return"GridSelection"}construct(e){this._selectedCells=[],super.construct(e),null!=e&&e.selectedRecords&&(this.selectedRecords=e.selectedRecords)}getDefaultGridSelection(e){return"GridSelection"===e.$name?e.configurable.selectionMode:e.superclass?this.getDefaultGridSelection(e.superclass):void 0}changeSelectionMode(e){const t=this;return t.selectionMode?(s.assign(t.selectionMode,e),t.selectionMode):(t.$defaultGridSelection=t.getDefaultGridSelection(t.constructor),new Proxy(e,{set(e,r,l){const o=s.assign({},e);return e[r]=l,t.updateSelectionMode(e,o),!0}}))}updateSelectionMode(e,t=this.$defaultGridSelection){const r=this,{columns:l,checkboxSelectionColumn:o}=r,i={},{rowReorder:a}=r.features;for(const r in e)e[r]!=t[r]&&(i[r]=e[r]);var d,c;(e.rowCheckboxSelection&&!e.checkboxOnly&&(e.checkboxOnly=!0,delete e.rowCheckboxSelection),i.column&&(e.cell=!0,e.multiSelect=!0),i.cell&&(e.checkboxOnly=!1),!1===i.cell&&(e.column=!1),i.checkboxOnly&&(e.checkbox||(e.checkbox=!0),e.cell=!1),!1===i.checkbox&&(i.checkboxOnly=!1,i.showCheckAll=!1),i.showCheckAll&&(e.checkbox=!0,e.multiSelect=!0),(i.includeChildren||i.includeParents)&&(e.multiSelect=!0),!1===i.multiSelect&&(e.column=e.showCheckAll=e.dragSelect=e.includeChildren=e.includeParents=!1),i.dragSelect&&(null!=a&&a.enabled&&!0!==a.gripOnly&&(a.showGrip=a.gripOnly=!0),e.multiSelect=!0,r._selectionListenersDetachers={}),!1===i.dragSelect&&r._selectionListenersDetachers)&&(null===(d=(c=r._selectionListenersDetachers).selectiondrag)||void 0===d||d.call(c),delete r._selectionListenersDetachers.selectiondrag);!t||void 0===i.cell&&void 0===i.deselectFilteredOutRecords&&void 0===i.multiSelect||r.deselectAll(),i.rowNumber?l.findRecord("type","rownumber")||(l.insert(0,n(n({},"object"==typeof e.rowNumber?e.rowNumber:{}),{},{type:"rownumber"})),r._selectionAddedRowNumberColumn=!0):!1===i.rowNumber&&r._selectionAddedRowNumberColumn&&(l.remove(l.findRecord("type","rownumber")),delete r._selectionAddedRowNumberColumn),(e.checkbox!==(null==t?void 0:t.checkbox)||e.checkbox&&e.showCheckAll!==(null==t?void 0:t.showCheckAll))&&(t&&r.deselectAll(),r.isConfiguring?r.shouldInitCheckboxSelection=!0:r.initCheckboxSelection()),t&&e.checkbox&&t.checkbox&&e.checkboxIndex!==t.checkboxIndex&&o&&o.parent.insertChild(o,l.getAt(r.checkboxSelectionColumnInsertIndex)),r.trigger("selectionModeChange",s.clone(e)),r.afterSelectionModeChange(e)}afterConfigure(){this.shouldInitCheckboxSelection&&(this.shouldInitCheckboxSelection=!1,this.initCheckboxSelection()),super.afterConfigure()}initCheckboxSelection(){const e=this,{selectionMode:t,columns:r,checkboxSelectionColumn:l}=e,{checkbox:o}=t;if(l&&(e.checkboxSelectionColumn=null,r.remove(l)),o){var i,n;const l=te.getColumnClass("check"),a=!0===o?null:o;if(!l)throw new Error("CheckColumn must be imported for checkbox selection mode to work");const d=e.checkboxSelectionColumn=new l(s.assign({id:`${e.id}-selection-column`,width:"4em",minWidth:"4em",field:null,sortable:!1,filterable:!1,cellCls:"b-checkbox-selection",region:null===(i=e.items)||void 0===i||null===(n=i[0])||void 0===n?void 0:n.region,showCheckAll:t.showCheckAll,draggable:!1,resizable:!1,widgets:[{type:"checkbox",valueProperty:"checked",ariaLabel:"L{Checkbox.toggleRowSelect}"}]},a),r,{isSelectionColumn:!0});d.meta.depth=0,d._grid=e;const c=d.renderer;d.renderer=t=>{t.value=e.isSelected(t.record),c.call(d,t)},d.ion({toggle:"onCheckChange",toggleAll:"onCheckAllChange",thisObj:e}),r.insert(e.checkboxSelectionColumnInsertIndex,d)}}get checkboxSelectionColumnInsertIndex(){const{columns:e}=this;let{checkboxIndex:t}=this.selectionMode;return t?"string"==typeof t&&(t=e.indexOf(e.getById(t))):t=e.indexOf(e.findRecord("type","rownumber"))+1,t}afterSelectionChange(){}afterSelectionModeChange(){}changeSelectedRecordCollection(e){return e instanceof L?e:new L(e)}updateSelectedRecordCollection(e){e.ion({change:"onSelectedRecordCollectionChange",thisObj:this})}onSelectedRecordCollectionChange({added:e=[],removed:t}){this.selectedRecordCollection._fromSelection||(e=e.filter((e=>this.isSelectable(e))),this.performSelection({selectedCells:[],deselectedCells:[],selectedRecords:e,deselectedRecords:t}))}changeSelectedRecordCollectionSilent(e){this.selectedRecordCollection._fromSelection=!0;const t=e(this.selectedRecordCollection);return delete this.selectedRecordCollection._fromSelection,t}bindStore(e){var t;this.detachListeners("selectionStoreFilter"),e.ion({name:"selectionStoreFilter",filter:"onStoreFilter",thisObj:this}),null===(t=super.bindStore)||void 0===t||t.call(this,e)}unbindStore(e){this.detachListeners("selectionStoreFilter"),super.unbindStore(e)}onStoreFilter({source:e}){const t=this,r=[];for(const l of t.selectedRecords)e.includes(l)||r.push(l);const l=t.prepareSelection(t.selectionMode.deselectFilteredOutRecords?r:[]);if(t.isCellSelectionMode){const{deselectedCells:e}=t.prepareSelection(t.getSelectedCellsForRecords(r));null!=e&&e.length&&(l.deselectedCells=(l.deselectedCells||[]).concat(e))}(l.deselectedCells.length||l.deselectedRecords.length)&&(t.performSelection(l,!1),t.updateCheckboxHeader())}onStoreRecordIdChange({record:e,oldValue:t}){var r;null===(r=super.onStoreRecordIdChange)||void 0===r||r.call(this,...arguments);this.selectedRecordCollection.get(t)===e&&this.selectedRecordCollection.rebuildIndices()}onStoreRemove(e){var t;if(null===(t=super.onStoreRemove)||void 0===t||t.call(this,e),!e.isCollapse){const t=this,r=e.records.filter((e=>this.isSelected(e)));if(r.length){const e=t.prepareSelection(r);if(t.isCellSelectionMode){const{deselectedCells:l}=t.prepareSelection(t.getSelectedCellsForRecords(r));null!=l&&l.length&&(e.deselectedCells=(e.deselectedCells||[]).concat(l))}t.performSelection(e)}}}onStoreDataChange({action:e,source:t}){var r;const l=this,{selectionMode:o}=l;let i;if(null===(r=super.onStoreDataChange)||void 0===r||r.call(this,...arguments),"pageLoad"===e)o.preserveSelectionOnPageChange||(i=l.prepareSelection(null,null,!0)),l.updateCheckboxHeader();else if(Ue[e]){const e=[];if(!1===o.preserveSelectionOnDatasetChange)i=l.prepareSelection(null,null,!0);else{e.push(...l.changeSelectedRecordCollectionSilent((e=>e.match(t.storage))));for(const r of l._selectedCells)t.getById(r.id)||e.push(r);i=l.prepareSelection(e)}}i&&(l.performSelection(i,!1),l.updateCheckboxHeader())}onStoreRemoveAll(){var e;null===(e=super.onStoreRemoveAll)||void 0===e||e.call(this),this.performSelection(this.prepareSelection(null,null,!0),!1)}onCheckChange({checked:e,record:t}){const r=this,l=!r.selectionMode.multiSelect&&e,o=l||e?null:[t],i=e?[t]:null;e&&!f.shiftKeyDown&&(r._lastSelectionChecked=t),e&&r._lastSelectionChecked&&f.shiftKeyDown?r.performSelection(r.internalSelectRange(r._lastSelectionChecked,t,!0)):r.performSelection(r.prepareSelection(o,i,l,!0))}updateCheckboxHeader(){const{selectionMode:e,checkboxSelectionColumn:t,store:r}=this;if(e.checkbox&&e.showCheckAll&&null!=t&&t.headerCheckbox){const e=r.count&&!r.some((e=>!this.isSelected(e)));t.headerCheckbox.checked!==e&&(t.suspendEvents(),t.headerCheckbox.checked=e,t.resumeEvents())}}onCheckAllChange({checked:e}){this[e?"selectAll":"deselectAll"](this.store.isPaged&&this.selectionMode.preserveSelectionOnPageChange)}onSelectionDrag(e){const t=this,{_selectionStartCell:r}=t;if(f.isMouseDown()||t.onSelectionEnd(),!r)return;const{items:l,_lastSelectionDragRegion:o}=t,i=t.getCellDataFromEvent(e,!0),n=null==i?void 0:i.column.region,s=(null==i?void 0:i.cellSelector)&&t.normalizeCellContext(i.cellSelector);if(s&&!s.equals(t._lastSelectionDragCell,!0)){if(t._isSelectionDragging||t.enableScrollingCloseToEdges(l),t._clearSelectionOnSelectionDrag&&!r.equals(s,!0)&&(t.deselectAll(),delete t._clearSelectionOnSelectionDrag),o&&n!==o){var a,d;const e=t.subGrids[o],r=t.subGrids[n],i=e.scrollable,s=r.scrollable,c=l.indexOf(e)-l.indexOf(r)<0;if(s.x=c?0:s.maxX,c?i.x<i.maxX-1:i.x>1)return;null===(a=t.scrollManager._activeScroll)||void 0===a||null===(d=a.horizontal)||void 0===d||d.stopScroll()}t._lastSelectionDragRegion=n,t._lastSelectionDragCell=s,t._isSelectionDragging=!0;const e=t._lastSelectionDragChange=t.internalSelectRange(r,s,t.isRowNumberSelecting(s)||t.isRowNumberSelecting(r));e.deselectedCells=e.deselectedCells.filter((e=>!t.isCellSelected(e))),e.deselectedRecords=e.deselectedRecords.filter((e=>!t.isSelected(e))),t.refreshGridSelectionUI(e),t.trigger("dragSelecting",e)}}onSelectionEnd(){var e,t;const r=this,l=r._lastSelectionDragChange;r._isSelectionDragging&&!r._selectionStartCell.equals(r._lastSelectionDragCell,!0)&&l&&r.performSelection(l,!1),r.disableScrollingCloseToEdges(r.items),r._isSelectionDragging=!1,r._lastSelectionDragChange=null,r._lastSelectionDragCell=null,null===(e=(t=r._selectionListenersDetachers).selectiondrag)||void 0===e||e.call(t),delete r._selectionListenersDetachers.selectiondrag}onHandleElementClick(e){const t=this;t.selectionMode.rowNumber&&e.target.closest(".b-rownumber-header")?(e.handled=!0,t.store.count&&t.store.some((e=>!t.isSelected(e)))?t.selectAll():t.deselectAll()):t.selectionMode.column&&e.target.closest(".b-grid-header")&&(e.handled=!0,t.selectColumn(e,e.ctrlKey)),super.onHandleElementClick(e)}selectColumn(e,t=!1){const r=this,{store:l}=r,{columnId:o}=r.getHeaderDataFromEvent(e);r._shiftSelectRange=null,e.shiftKey||(r._shiftSelectColumn=o);const i=e.shiftKey&&r._shiftSelectColumn||o,n=r.internalSelectRange(r.normalizeCellContext({id:l.first.id,columnId:i}),r.normalizeCellContext({id:l.last.id,columnId:o}));t&&!n.selectedCells.some((e=>!r.isCellSelected(e)))&&(n.deselectedCells=n.selectedCells,n.selectedCells=[]),t||(n.deselectedCells=r._selectedCells),r.cleanSelectionChange(n),r.performSelection(n)}isSelected(e){var t;return null!==(t=e)&&void 0!==t&&t.id&&(e=e.id),!!qe[typeof e]&&Boolean(this.selectedRecordCollection.get(e))}isCellSelected(e,t){return e=this.normalizeCellContext(e),this.isCellSelectionMode&&this._selectedCells.some((t=>e.equals(t,!0)))||t&&this.isSelected(e)}isSelectable(e){return this.normalizeCellContext({id:e.id||e}).isSelectable}get selectedRecord(){return this.selectedRecords[this.selectedRecords.length-1]||null}set selectedRecord(e){this.selectRow({record:e})}get selectedRecords(){return this.selectedRecordCollection.values}set selectedRecords(e){this.selectRows(e)}spliceSelectedRecords(e,t,r){const l=this;if("number"==typeof t){const o=[...l.selectedRecords];o.splice(e,t,...S.asArray(r)),l.performSelection(l.prepareSelection(null,o,!0,!0))}else l.performSelection(l.prepareSelection(t,r,!1,!0))}selectRow(e){"number"!=typeof e&&!e.isModel&&"record"in e||(e={records:[e]}),s.assignIf(e,{scrollIntoView:!0}),this.selectRows(e)}selectRows(e){(!e||Array.isArray(e)||e.isModel||"number"==typeof e||!("records"in e)&&!("record"in e))&&(e={records:S.asArray(e)||[]});const t=this,{store:r}=t,l=[],{records:o=(e.record?[e.record]:[]),column:i=t.columns.visibleColumns[0],scrollIntoView:n,addToSelection:s=arguments[1]}=e;for(let e of o)e=r.getById(e),e&&l.push(e);s||(t._shiftSelectRange=null),t.performSelection(t.prepareSelection(null,l,!s,!0)),l.length&&n&&t.scrollRowIntoView(l[0].id,{column:i})}selectAll(e=!1){const{store:t}=this,r=(t.isGrouped?t.allRecords:t.records).filter((e=>!e.isSpecialRow));this.performSelection(this.prepareSelection(null,r,!1,!0),!0,e)}deselectAll(e=!1,t=!1){const{store:r}=this,l=e?(r.isGrouped?r.allRecords:r.records).filter((e=>!e.isSpecialRow)):null;this.performSelection(this.prepareSelection(l,null,!e),!0,t)}deselectRow(e){this.deselectRows(e)}deselectRows(e){const{store:t}=this,r=S.asArray(e).map((e=>t.getById(e))).filter((e=>e));this.performSelection(this.prepareSelection(r))}selectRange(e,t,r=!1){const l=this,{store:o}=l,i=l.internalSelectRange(o.getById(e),o.getById(t),!0);l._shiftSelectRange=null,l.performSelection(i)}get selectedCell(){return this._selectedCells[this._selectedCells.length-1]}set selectedCell(e){this.selectCells([e])}get selectedCells(){return[...this._selectedCells]}set selectedCells(e){this.selectCells(e)}get selectedCellCSSSelector(){const e=this.selectedCell,t=e&&this.getRowById(e.id);return e&&t?`[data-index=${t.dataIndex}] [data-column-id=${e.columnId}]`:""}selectCell(e){var t;return"id"in e&&(e={cell:e},e=Object.assign({scrollIntoView:arguments[1],addToSelection:arguments[2],silent:arguments[3]},e)),null===(t=this.selectCells(e))||void 0===t?void 0:t[0]}selectCells(e){Array.isArray(e)&&(e={cells:e});const t=this,{cells:r=(e.cell?[e.cell]:[]),scrollIntoView:l=!0,addToSelection:o=!1,silent:i=!1}=e,n=t.prepareSelection(null,r,!o);return o||(t._shiftSelectRange=null),t.performSelection(n,!0,i),l&&t.scrollRowIntoView(r[0].id,{column:r[0].columnId}),t.isCellSelectionMode?n.selectedCells:n.selectedRecords}deselectCell(e){var t;return null===(t=this.deselectCells([e]))||void 0===t?void 0:t[0]}deselectCells(e){const t=this.prepareSelection(e);return this.performSelection(t),this.isCellSelectionMode?t.deselectedCells:t.deselectedRecords}toggleSelection(e){const t=this,{_focusedCell:r,selectionMode:l}=t,o=t.isRowNumberSelecting(r),i=t.isCellSelected(r,!0);if(!0===l.selectOnKeyboardNavigation||r.isActionable)return!1;t.performSelection(t.prepareSelection(i?r:null,i?null:r,!l.multiSelect,o)),e.preventDefault()}selectCellRange(e,t){this.performSelection(this.internalSelectRange(e,t))}getSelection(){return this.isRowSelectionMode?this.selectedRecords:this.selectedCells}cleanSelectionChange(e){const{deselectedRecords:t,selectedRecords:r,deselectedCells:l,selectedCells:o}=e;return null!=t&&t.length&&null!=r&&r.length&&(e.deselectedRecords=t.filter((e=>!r.some((t=>e===t))))),null!=l&&l.length&&null!=o&&o.length&&(e.deselectedCells=l.filter((e=>!o.some((t=>e.equals(t,!0)))))),e}getSelectedCellsForRecords(e){return this._selectedCells.filter((t=>t.id&&e.some((e=>e.id===t.id))))}delayUntilMouseUp(e){const t=C.on({element:globalThis,blur:r=>e(r,t),mouseup:r=>e(r,t),thisObj:this,once:!0})}get isRowSelectionMode(){return!this.isCellSelectionMode}get isCellSelectionMode(){return!0===this.selectionMode.cell}isRowNumberSelecting(...e){return this.selectionMode.rowNumber&&!e.some((e=>"rownumber"!==e.column.type))}extendSelectionLeft(){this.extendSelection("Left")}extendSelectionRight(){this.extendSelection("Right")}extendSelectionUp(){this.extendSelection("Up")}extendSelectionDown(){this.extendSelection("Down")}extendSelection(e){this._isKeyboardRangeSelecting=!0,this["navigate"+e](),this._isKeyboardRangeSelecting=!1}onCellNavigate(e,t,r,l){var o;const{selectionMode:i,_selectionListenersDetachers:n}=e,{rowReorder:s}=e.features,{multiSelect:a,deselectOnClick:d,dragSelect:c}=i,{ctrlKeyDown:u,shiftKeyDown:h}=f,g=f.isMouseDown(),m=f.isMouseDown(2),p=f.currentMouseDown||f.currentKeyDown,b=null==p?void 0:p.target;if(r=e.normalizeCellContext(r),!l||-1===r.rowIndex||null!==(o=r.record)&&void 0!==o&&o.isGroupHeader||null!=p&&p.fromKeyMap&&!i.selectOnKeyboardNavigation||e.columns.getById(r.columnId)===e.checkboxSelectionColumn||i.checkboxOnly||b&&null!=s&&s.gripOnly&&s.isElementDraggable(b,p)||!0===(null==p?void 0:p.handled))return;h||(e._isAddingToSelection=u&&a,e._selectionStartCell=r),a&&c&&g&&!n.selectiondrag&&(n.selectiondrag=C.on({name:"selectiondrag",element:globalThis,blur:"onSelectionEnd",mouseup:"onSelectionEnd",mousemove:"onSelectionDrag",thisObj:e}));const v=e._selectionStartCell,w=e._isAddingToSelection;if((h&&g||e._isKeyboardRangeSelecting)&&v&&a)e.performSelection(e.internalSelectRange(v,r,e.isRowNumberSelecting(v,r)));else{let t,l=!1,o=!0;if(e.isCellSelected(r,!0)){if(m)return;if(w||d)t=d?null:[r],o=!1;else if(e.selectedRecords.length+(e.isCellSelectionMode?e._selectedCells.length:0)<=1)return;l=d||a}t||w||(t=null,c&&l&&n.selectiondrag&&(e._clearSelectionOnSelectionDrag=!0));const i=(l,i)=>{var n;if(null==i||i(),(null==l||null===(n=l.target)||void 0===n?void 0:n.nodeType)===Node.ELEMENT_NODE){const e=new Y(l.target);if(null!=e&&e.grid&&!e.equals(r,!0))return}h||(e._shiftSelectRange=null),e.performSelection(e.prepareSelection(t,o&&[r],null===t,o&&e.isRowNumberSelecting(r)))};l?e.delayUntilMouseUp(i):i()}}prepareSelection(e,t,r=!1,l=!1){const o=this,i=o._isSelectionDragging,{includeParents:n}=o.selectionMode,s=[],a=[];let d=[],c=[];if(r)d=o._selectedCells,c=o.selectedRecords;else if(e)for(const t of S.asArray(e)){const e=o.normalizeCellContext(t),r=(null==e?void 0:e.record)||(t.isModel?t:o.store.getById(e.id));var u;if(!e.isSpecialRow)if(d.push(e),r&&!c.some((e=>e.id===r.id)))if((i||o.isSelected(r))&&c.push(r),o.selectionMode.includeChildren&&o.selectionMode.multiSelect&&!r.isLeaf&&null!==(u=r.allChildren)&&void 0!==u&&u.length)for(const e of r.allChildren)c.some((t=>t.id===e.id))||!i&&!o.isSelected(e)||c.push(e)}if(t)for(const e of S.asArray(t)){const t=o.normalizeCellContext(e),r=(null==t?void 0:t.record)||(e.isModel?e:o.store.getById(t.id));var h;if(r&&!t.isSpecialRow)if(o.isCellSelectionMode&&!l&&a.push(t),(o.isRowSelectionMode||l)&&!s.some((e=>e.id===r.id)))if(s.push(r),o.selectionMode.includeChildren&&o.selectionMode.multiSelect&&!r.isLeaf&&null!==(h=r.allChildren)&&void 0!==h&&h.length)for(const e of r.allChildren)s.some((t=>t.id===e.id))||s.push(e)}if(n&&(c.length||s.length)){const e=[...c,...s];S.unique(e.filter((t=>t.parent&&!t.allChildren.some((t=>e.includes(t))))).map((e=>e.parent))).forEach((e=>o.toggleParentSelection(e,s,c)))}return o.cleanSelectionChange({selectedCells:a,selectedRecords:s,deselectedCells:d,deselectedRecords:c,deselectAll:r,action:null!=s&&s.length||null!=a&&a.length?"select":"deselect"})}toggleParentSelection(e,t,r){if(!e||e.isRoot)return;const l=this.isSelected(e),o=t.includes(e),i=r.includes(e),n=e=>this.isSelected(e)&&!r.includes(e)||t.includes(e);"some"===this.selectionMode.includeParents?e.allChildren.some(n)?l&&!i||o||t.push(e):l&&!i&&r.push(e):l?i||o||!e.allChildren.some((e=>r.includes(e)))||r.push(e):o||e.allChildren.every(n)&&t.push(e),e.parent&&this.toggleParentSelection(e.parent,t,r)}internalSelectRange(e,t,r=!1){const l=this,o=l.isRowSelectionMode||r,i=l.prepareSelection(l._shiftSelectRange,l.getRange(e,t,o),!1,r);return l._shiftSelectRange=i["selected"+(o?"Records":"Cells")],i}getRange(e,t,r=!1){const l=this,{store:o}=l,i=l.normalizeCellContext(e),n=l.normalizeCellContext(t),s=Math.min(i.rowIndex,n.rowIndex),a=Math.max(i.rowIndex,n.rowIndex),d=[],c=Math.min(i.columnIndex,n.columnIndex),u=Math.max(i.columnIndex,n.columnIndex);if(-1===s||-1===a)throw new Error("Record not found in selectRange");if(r){const e=o.getRange(s,a+1,!1);n.rowIndex<i.rowIndex&&e.reverse(),d.push(...e)}else for(let e=s;e<=a;e++)for(let t=c;t<=u;t++)d.push({rowIndex:e,columnIndex:t});return d.map((e=>l.normalizeCellContext(e)))}performSelection(e,t=!0,r=!1){const l=this,{selectedRecords:o,selectedCells:i,deselectedRecords:n,deselectedCells:s,action:a}=e,d=l.isRowSelectionMode;if(!1!==l.trigger("beforeSelectionChange",{mode:d?"row":"cell",action:a,selected:(d?o:i)||[],deselected:(d?n:s)||[],selection:(d?l.selectedRecords:l.selectedCells)||[]})){if(l._selectedCells===s)l._selectedCells=[];else{const e=[];for(const t of l._selectedCells)s.some((e=>t.equals(e,!0)))||e.push(t);l._selectedCells=e}if(e.deselectedRecords=[...e.deselectedRecords],n===l.selectedRecords)l.changeSelectedRecordCollectionSilent((e=>e.clear()));else{const e=[];for(const t of l.selectedRecords)n.some((e=>t.id===e.id))||e.push(t);l.changeSelectedRecordCollectionSilent((t=>t.values=e))}if(i.length)for(const e of i)l._selectedCells.some((t=>t.equals(e,!0)))||l._selectedCells.push(e);o.length&&l.changeSelectedRecordCollectionSilent((e=>e.add(...o))),t&&l.refreshGridSelectionUI(e),l.afterSelectionChange(e),r||l.triggerSelectionChangeEvent(e)}}refreshGridSelectionUI({selectedRecords:e,selectedCells:t,deselectedRecords:r,deselectedCells:l}){const o=this,{checkboxSelectionColumn:i}=o;null==i||i.suspendEvents(),o.updateGridSelectionRecords(e,!0),o.updateGridSelectionRecords(r,!1),o.updateCheckboxHeader(),null==i||i.resumeEvents(),o.isCellSelectionMode&&(o.updateGridSelectionCells(t,!0),o.selectionMode.column&&o.updateGridSelectionColumns(t)),o.updateGridSelectionCells(l,!1)}updateGridSelectionRecords(e,t){const{checkboxSelectionColumn:r}=this;if(null!=e&&e.length)for(let l=0;l<e.length;l++){const o=this.getRowFor(e[l]);o&&(o.toggleCls("b-selected",t),o.setAttribute("aria-selected",t),!r||r.hidden||e[l].isSpecialRow||(o.getCell(r.id).widget.checked=t))}}updateGridSelectionCells(e,t){if(null!=e&&e.length)for(let r=0;r<e.length;r++){const l=this.getCell(e[r]);l&&(l.setAttribute("aria-selected",t),l.classList.toggle("b-selected",t))}}updateGridSelectionColumns(e){const{count:t}=this.store;for(const l of this.columns.visibleColumns){var r;null===(r=l.element)||void 0===r||r.classList.toggle("b-selected",(null==e?void 0:e.filter((e=>e.columnId===l.id)).length)===t)}}triggerSelectionChangeEvent(e){const t=this.isRowSelectionMode;this.trigger("selectionChange",{mode:t?"row":"cell",action:e.action,selected:(t?e.selectedRecords:e.selectedCells)||[],deselected:(t?e.deselectedRecords:e.deselectedCells)||[],selection:(t?this.selectedRecords:this.selectedCells)||[]})}doDestroy(){var e;null===(e=this.selectedRecordCollection)||void 0===e||e.destroy(),this._selectedCells.length=0;for(const e in this._selectionListenersDetachers)this._selectionListenersDetachers[e]();super.doDestroy()}get widgetClass(){}},"configurable",{selectionMode:{cell:!1,multiSelect:!0,checkboxOnly:!1,checkbox:!1,checkboxPosition:null,showCheckAll:!1,deselectFilteredOutRecords:!1,includeChildren:!1,includeParents:!1,preserveSelectionOnPageChange:!1,preserveSelectionOnDatasetChange:!0,deselectOnClick:!1,dragSelect:!1,selectOnKeyboardNavigation:!0,column:!1,rowNumber:!1},keyMap:{"Shift+ArrowUp":"extendSelectionUp","Shift+ArrowDown":"extendSelectionDown","Shift+ArrowLeft":"extendSelectionLeft","Shift+ArrowRight":"extendSelectionRight"," ":{handler:"toggleSelection",weight:10}},selectedRecordCollection:{}}),t};const Ye=e=>e.columns.suspendEvents(),Je=e=>e.columns.resumeEvents(),Qe=e=>{e.columns.clearCaches(),e.columns.fillFromMaster()},Ze=(e,t)=>e.stateSortIndex-t.stateSortIndex;var et=e=>class extends(e||M){static get $name(){return"GridState"}static get configurable(){return{statefulEvents:["subGridCollapse","subGridExpand","horizontalScroll","stateChange"]}}updateStore(e,t){var r;null===(r=super.updateStore)||void 0===r||r.call(this,e,t),this.detachListeners("stateStoreListeners"),null==e||e.ion({name:"stateStoreListeners",filter:"triggerUpdate",group:"triggerUpdate",sort:"triggerUpdate",thisObj:this})}updateColumns(e,t){var r;null===(r=super.updateColumns)||void 0===r||r.call(this,e,t),this.detachListeners("stateColumnListeners"),e.ion({name:"stateColumnListeners",change:"triggerUpdate",thisObj:this})}updateRowManager(e,t){var r;null===(r=super.updateRowManager)||void 0===r||r.call(this,e,t),this.detachListeners("stateRowManagerListeners"),e.ion({name:"stateRowManagerListeners",rowHeight:"triggerUpdate",thisObj:this})}triggerUpdate(){this.trigger("stateChange")}finalizeInit(){super.finalizeInit(),this.ion({selectionChange:"triggerUpdate",thisObj:this})}getState(){const e=this,t=e.element.style.cssText,r={rowHeight:e.rowHeight};if(t&&(r.style=t),e.selectedCell){const{id:t,columnId:l}=e.selectedCell;r.selectedCell={id:t,columnId:l}}return r.selectedRecords=e.selectedRecords.map((e=>e.id)),r.columns=e.columns.allRecords.map((e=>e.getState())),r.store=e.store.state,r.scroll=e.storeScroll(),r.subGrids={},e.eachSubGrid((e=>{var t;const l=r.subGrids[e.region]=r.subGrids[e.region]||{};e.isPainted?null==e.flex&&(l.width=e.width):null!=e.config.width?l.width=e.config.width:l.flex=e.config.flex,l.collapsed=null!==(t=e.collapsed)&&void 0!==t&&t,l.collapsed&&(l._beforeCollapseState=e._beforeCollapseState)})),r}applyState(e){const t=this;if(t.suspendRefresh(),"columns"in e){let r=!1,l=!1;t.columns.suspendEvents(),t.eachSubGrid(Ye),e.columns.forEach(((e,o)=>{const i=t.columns.getById(e.id);if(i){const t=i.generation;i.applyState(e),r=r||i.generation!==t,i.stateSortIndex=o,i.allIndex!==o&&(l=r=!0)}})),r&&t.eachSubGrid(Qe),l&&(t.eachSubGrid((e=>{e.columns.records.sort(Ze),e.columns.allRecords.sort(Ze)})),t.columns.sort({fn:Ze,ascending:!0})),t.isPainted&&r&&t.renderContents(),t.columns.resumeEvents(),t.eachSubGrid(Je)}"subGrids"in e&&t.eachSubGrid((t=>{if(t.region in e.subGrids){const r=e.subGrids[t.region];"width"in r?t.width=r.width:"flex"in r&&(t.flex=r.flex),"collapsed"in r&&(t.collapsed=r.collapsed,t._beforeCollapseState=r._beforeCollapseState)}t.clearWidthCache()})),"rowHeight"in e&&(t.rowHeight=e.rowHeight),"style"in e&&(t.style=e.style),"selectedCell"in e&&(t.selectedCell=e.selectedCell),"store"in e&&(t.store.state=e.store),"selectedRecords"in e&&(t.selectedRecords=e.selectedRecords),t.resumeRefresh(!0),t.eachSubGrid((e=>e.refreshFakeScroll())),"scroll"in e&&(t.restoreScroll(e.scroll),e.scroll.scrollTop&&t.element.querySelectorAll(".b-resize-monitored").forEach((e=>{const t=N.fromElement(e);t&&t.onElementResize(e)})))}get widgetClass(){}};const tt=Promise.resolve(),rt={block:"nearest"};class lt extends _{static get configurable(){return{propagate:!1,overflowX:"hidden-scroll"}}scrollIntoView(e,r=rt){const{xDelta:l,yDelta:o}=this.getDeltaTo(e,r),i=l||o?this.scrollBy(l,o,r):tt;return(r.highlight||r.focus)&&i.then((()=>{r.highlight&&(e instanceof H?e.translate(-l,-o).highlight():t.highlight(e)),r.focus&&e.focus&&e.focus()})),i}scrollBy(e,t,r){const l=t&&this.yScroller.scrollBy(0,t,r),o=e&&super.scrollBy(e,0,r);if(o&&o.cancel&&l&&l.cancel){const e=o.cancel,t=l.cancel;return o.cancel=l.cancel=()=>{e(),t()},Promise.all([o,l])}return o||l||tt}scrollTo(e,t,r){const l=null!=t&&this.yScroller.scrollTo(null,t,r),o=null!=e&&super.scrollTo(e,null,r);if(r&&r.animate||this.syncPartners(),o&&o.cancel&&l&&l.cancel){const e=o.cancel,t=l.cancel;return o.cancel=l.cancel=()=>{e(),t()},Promise.all([o,l])}return o||l||tt}get viewport(){const e=H.from(this.element);return e.intersect(H.from(this.yScroller.element))||new H(e.x,e.y,e.width,0)}set y(e){this.yScroller&&(this.yScroller.y=e)}get y(){return this.yScroller?this.yScroller.y:0}get maxY(){return this.yScroller?this.yScroller.maxY:0}get scrollHeight(){return this.yScroller?this.yScroller.scrollHeight:0}get clientHeight(){return this.yScroller?this.yScroller.clientHeight:0}}lt._$name="SubGridScroller";const ot=(e,t)=>e+t.getBoundingClientRect().width;class it extends e{static get $name(){return"SubGrid"}static get type(){return"subgrid"}static get defaultConfig(){return{insertRowsBefore:null,appendTo:null,monitorResize:!0,headerClass:null,footerClass:null,weight:null,collapsed:null,scrollable:{overflowX:"hidden-scroll"},scrollerClass:lt,hasCalculatedWidth:null,sealedColumns:null}}static get configurable(){return{element:!0,header:{},footer:{},virtualScrollerElement:!0,splitterElement:!0,headerSplitter:!0,scrollerSplitter:!0,footerSplitter:!0,resizable:null,role:"presentation"}}construct(e){const t=this;if(super.construct(e),this.rowManager.ion({addRows:"onAddRow",thisObj:this}),b.isFirefox){const{element:e}=t,r=t.grid.scrollable;let l=0;e.addEventListener("wheel",(({ctrlKey:o,deltaY:i,deltaX:n})=>{const s=Math.abs(i)>Math.abs(n);o||!s||t.scrollEndDetacher||r.y===l||(e.style.pointerEvents="none",l=r.y,t.scrollEndDetacher=r.ion({scrollEnd:async()=>{l=r.y,e.style.pointerEvents="",t.scrollEndDetacher=null},once:!0}))}))}}doDestroy(){var e;const t=this;t.header.destroy(),t.footer.destroy(),null===(e=t.fakeScroller)||void 0===e||e.destroy(),t.virtualScrollerElement.remove(),t.splitterElements.forEach((e=>e.remove())),super.doDestroy()}get barConfig(){const e=this,{width:t,flex:r}=e.element.style,l={subGrid:e,parent:e,maxWidth:e.maxWidth||void 0,minWidth:e.minWidth||void 0};return r?l.flex=r:t&&(l.width=t),l}changeHeader(e){return new this.headerClass(s.assign({id:this.id+"-header"},this.barConfig,e))}changeFooter(e){return new this.footerClass(s.assign({id:this.id+"-footer"},this.barConfig,e))}get splitterElements(){return[this.splitterElement,this.headerSplitter,this.scrollerSplitter,this.footerSplitter]}toggleSplitterCls(e,t=!0){this.splitterElements.forEach((r=>null==r?void 0:r.classList[t?"add":"remove"](e)))}hideSplitter(){this.splitterElements.forEach((e=>e.classList.add("b-hide-display"))),this.$showingSplitter=!1}showSplitter(){this.splitterElements.forEach((e=>e.classList.remove("b-hide-display"))),this.$showingSplitter=!0}changeElement(e,t){const{region:r}=this;return super.changeElement({"aria-label":r,className:{"b-grid-subgrid":1,[`b-grid-subgrid-${r}`]:r,"b-grid-subgrid-collapsed":this.collapsed},dataset:{region:r}},t)}get rowElementConfig(){const{grid:e}=this;return{role:"row",className:e.rowCls,children:this.columns.visibleColumns.map(((t,r)=>({role:"gridcell","aria-colindex":r+1,tabIndex:e.cellTabIndex,className:"b-grid-cell",dataset:{column:t.field||"",columnId:t.id}})))}}changeVirtualScrollerElement(){const e=t.createElement({role:"presentation",reference:"virtualScrollerElement",className:"b-virtual-scroller",tabIndex:-1,dataset:{region:this.region},children:[{reference:"virtualScrollerWidth",className:"b-virtual-width"}]});return this.virtualScrollerWidth=e.virtualScrollerWidth,e.virtualScrollerElement}changeSplitterElement(){const e=t.createElement({reference:"splitterElement",className:{"b-grid-splitter":1,"b-grid-splitter-collapsed":this.collapsed,"b-hide-display":1},dataset:{region:this.region},children:[b.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner b-grid-splitter-main",children:[{className:"b-grid-splitter-buttons",reference:"splitterButtons",children:[{className:"b-grid-splitter-button-collapse",children:[b.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-collapse-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M192 448c-8.188 0-16.38-3.125-22.62-9.375l-160-160c-12.5-12.5-12.5-32.75 0-45.25l160-160c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l137.4 137.4c12.5 12.5 12.5 32.75 0 45.25C208.4 444.9 200.2 448 192 448z"}]}]},{className:"b-grid-splitter-button-expand",children:[b.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-expand-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M64 448c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L178.8 256L41.38 118.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l160 160c12.5 12.5 12.5 32.75 0 45.25l-160 160C80.38 444.9 72.19 448 64 448z"}]}]}]}]}]});return this.splitterButtons=e.splitterButtons,e.splitterElement}get splitterConfig(){return{className:this.splitterElement.className.trim(),children:[b.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner"}],dataset:{region:this.region}}}changeHeaderSplitter(){return t.createElement(this.splitterConfig)}changeScrollerSplitter(){return t.createElement(this.splitterConfig)}changeFooterSplitter(){return t.createElement(this.splitterConfig)}render(...e){const t=this;super.render(...e),t.grid&&(t.updateHasFlex(),t.element.parentNode.insertBefore(t.splitterElement,t.element.nextElementSibling),t.splitterElements.forEach((e=>C.on({element:e,mouseenter:"onSplitterMouseEnter",mouseleave:"onSplitterMouseLeave",thisObj:t}))),t._collapsed&&t.collapse())}refreshHeader(){this.header.refreshContent()}refreshFooter(){var e;null===(e=this.footer)||void 0===e||e.refreshContent()}eachWidget(e,t=!0){const r=[this.header,this.footer];for(let l=0;l<r.length;l++){const o=r[l];if(!1===e(o))return;t&&o.eachWidget&&o.eachWidget(e,t)}}fixCellWidths(e){const{visibleColumns:r}=this.columns;let l=e.firstElementChild,o=0;for(;l;){const e=r[o],{element:i}=e;e.minWidth&&(l.style.minWidth=t.setLength(e.minWidth)),e.maxWidth&&(l.style.maxWidth=t.setLength(e.maxWidth)),e.flex?e.childLevel&&i?(l.style.flex=`0 0 ${i.getBoundingClientRect().width}px`,l.style.width=""):(l.style.flex=e.flex,l.style.width=""):e.width?l.style.width=t.setLength(e.width):l.style.flex=l.style.width=l.style.minWidth="",l=l.nextElementSibling,o++}}get totalFixedWidth(){return this.columns.totalFixedWidth}fixWidths(){const e=this,{element:t,header:r,footer:l}=e;if(!e.collapsed){if(e.flex)r.flex=e.flex,l&&(l.flex=e.flex),t.style.flex=e.flex;else{if(e.hasCalculatedWidth&&!e.columns.some((e=>!e.hidden&&e.flex))&&e.totalFixedWidth!==e.width)return e.width=e.totalFixedWidth,void(e.hasCalculatedWidth=!0);let o=e.width;if(!o&&e.hasCalculatedWidth){o=0;for(const t of e.columns)t.flex||t.hidden||(o+=t.width)}t.style.width=`${o}px`,r.width=o,l&&(l.width=o)}e.syncScrollingPartners(!1)}}fixRowWidthsInSafariEdge(){if(b.isSafari){const e=this,{region:t,header:r}=e,l=r.calculateMinWidthForSafari();e.rowManager.forEach((e=>{const r=e.getElement(t);r&&(r.style.width=`${l}px`)})),r.headersElement.style.width=`${l}px`}}set width(e){const t=this;t.hasCalculatedWidth=!1,super.width=e,t.header.width=e,t.footer.width=e,t.isPainted&&t.onElementResize()}get width(){return super.width}set flex(e){const t=this;t.hasCalculatedWidth=!1,t.header.flex=e,t.footer.flex=e,super.flex=e,t.isPainted&&t.onElementResize()}get flex(){return super.flex}onInternalResize(e,t,r,l,o){const i=this,{grid:n}=i;super.onInternalResize(...arguments),null!=n&&n.isPainted&&(i.syncSplitterButtonPosition(),t!==l&&(n.trigger("horizontalScroll",{grid:n,subGrid:i,scrollLeft:i.scrollable.element.scrollLeft,scrollX:i.scrollable.x}),i.fakeScroller&&i.refreshFakeScroll(),n.syncFlexedSubCols(),i.fixRowWidthsInSafariEdge()),r!==o&&n.onHeightChange(),i.trigger("afterInternalResize",i))}syncParallelSplitters(e){const t=this,{grid:r}=t;if(t.splitterElement&&t.$showingSplitter)t.toggleSplitterCls("b-grid-splitter-collapsed",e);else{const l=r.getSubGrid(r.getPreviousRegion(t.region));l&&l.splitterElement&&l.syncParallelSplitters(e)}}onSplitterMouseEnter(){const e=this,{nextSibling:t}=e;e.collapsed||t&&t.collapsed||e.toggleSplitterCls("b-hover"),e.startSplitterButtonSyncing()}onSplitterMouseLeave(){const e=this,{nextSibling:t}=e;e.toggleSplitterCls("b-hover",!1),e.collapsed||t&&t.collapsed||e.stopSplitterButtonSyncing()}startSplitterButtonSyncing(){const e=this;e.splitterElement&&(e.syncSplitterButtonPosition(),e.splitterSyncScrollListener||(e.splitterSyncScrollListener=e.grid.scrollable.ion({scroll:"syncSplitterButtonPosition",thisObj:e})))}stopSplitterButtonSyncing(){this.splitterSyncScrollListener&&(this.splitterSyncScrollListener(),this.splitterSyncScrollListener=null)}syncSplitterButtonPosition(){const{grid:e}=this;this.splitterButtons.style.top=`${e.scrollable.y+(e.bodyHeight-(this.headerSplitter?e.headerHeight:0))/2}px`}get viewRectangle(){const{scrollable:e}=this;return new H(e.x,e.y,this.width||0,this.rowManager.viewHeight)}updateHasFlex(){this.scrollable.element.classList.toggle("b-has-flex",this.columns.hasFlex)}updateResizable(e){this.splitterElements.forEach((r=>t.toggleClasses(r,["b-disabled"],!e)))}resizeColumnsToFitContent(){this.grid.beginGridMeasuring(),this.columns.visibleColumns.forEach((e=>{e.resizeToFitContent(null,null,!0)})),this.grid.endGridMeasuring()}get overflowingHorizontally(){return!this.collapsed&&this.scrollable.hasOverflow("x")}get overflowingVertically(){return!1}refreshFakeScroll(){const e=this,{element:t,virtualScrollerElement:r,virtualScrollerWidth:l,header:o,footer:i,scrollable:n}=e,s=[...o.contentElement.children].reduce(ot,0);n.scrollWidth=s,r.style.width=t.style.width,r.style.flex=t.style.flex,r.style.minWidth=t.style.minWidth,r.style.maxWidth=t.style.maxWidth,o.scrollable.syncOverflowState(),i.scrollable.syncOverflowState(),e.collapsed||(e.overflowingHorizontally?(l.style.width=`${n.scrollWidth||0}px`,e.grid.virtualScrollers.classList.remove("b-hide-display")):l.style.width=0)}initScroll(){const e=this,{scrollable:t,virtualScrollerElement:r}=e;e.syncPartnersOnFrame=e.createOnFrame(e.syncScrollingPartners),b.isFirefox&&t.element.addEventListener("wheel",(e=>{e.deltaX&&(t.x+=e.deltaX,e.preventDefault())})),t.yScroller=e.grid.scrollable,t.yScroller.addScroller(t),e.fakeScroller=new _({element:r,overflowX:!0,widget:e}),t.ion({scroll:"onSubGridScroll",scrollend:"onSubGridScrollEnd",thisObj:e}),t.addPartner(e.fakeScroller,"x"),t.addPartner(e.header.scrollable,"x"),t.addPartner(e.footer.scrollable,"x"),e.refreshFakeScroll()}onSubGridScrollEnd(){const e=this;e.forceScrollUpdate||e.syncScrollingPartners(),e.scrolling=!1,t.scrollBarWidth||(e.grid.virtualScrollers.classList.remove("b-scrolling"),e.hideOverlayScroller())}onSubGridScroll(){this.forceScrollUpdate?(this.syncScrollingPartners(),this.forceScrollUpdate=!1):this.syncPartnersOnFrame()}showOverlayScroller(){this.hideOverlayScroller.cancel(),this.virtualScrollerElement.classList.add("b-show-virtual-scroller")}hideOverlayScroller(){this.virtualScrollerElement.classList.remove("b-show-virtual-scroller")}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}syncScrollingPartners(e=!0){const r=this,{grid:l}=r;!r.scrolling&&e&&(r.scrolling=!0,t.scrollBarWidth||(l.virtualScrollers.classList.add("b-scrolling"),r.showOverlayScroller())),l.trigger("horizontalScroll",{subGrid:r,grid:l,scrollLeft:r.scrollable.element.scrollLeft,scrollX:r.scrollable.x})}scrollColumnIntoView(e,t){const{columns:r,header:l}=this,o=l.scrollable;if(e=e instanceof Q?e:r.get(e)||r.getById(e)||r.getAt(e)){const r=l.getHeader(e.id);if(r)return o.scrollIntoView(H.from(r,null,!0),t)}}onAddRow({rows:e,isExport:r}){const l=this,o=l.rowElementConfig,i=document.createDocumentFragment();e.forEach((e=>{const r=t.createElement(o);i.appendChild(r),e.addElement(l.region,r),l.fixCellWidths(r)})),r||(l.fixRowWidthsInSafariEdge(),l.element.insertBefore(i,l.insertRowsBefore))}get rowElements(){return this.fromCache(".b-grid-row",!0)}clearRows(){this.emptyCache();const e=this.element.querySelectorAll(".b-grid-row"),t=document.createRange();e.length&&(t.setStartBefore(e[0]),t.setEndAfter(e[e.length-1]),t.deleteContents())}addNewRowElement(){const e=t.append(this.element,this.rowElementConfig);return this.fixCellWidths(e),e}get store(){return this.grid.store}get rowManager(){var e;return null===(e=this.grid)||void 0===e?void 0:e.rowManager}toggleTransitionClasses(e=!1){const t=this,r=t.grid,l=r.getSubGrid(r.getNextRegion(t.region)),o=r.resolveSplitter(l);l.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),l.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),t.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),t.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),o.classList[e?"remove":"add"]("b-grid-splitter-animate")}get collapsed(){return this._collapsed}set collapsed(e){this.isConfiguring?this._collapsed=e:e?this.collapse():this.expand()}async collapse(){const e=this,{grid:t,element:r}=e,l=t.getSubGrid(t.getNextRegion(e.region)),o=e.splitterElement?e:e.previousSibling;let{_beforeCollapseState:i}=e,n=0;if(!t.rendered||!0!==e._collapsed)return t.eachSubGrid((t=>{t!==e&&!t._collapsed&&++n})),0===n&&await l.expand(),new Promise((t=>{if(i)t();else{i=e._beforeCollapseState={};let o=!1;e.width&&(o=!0,e.ion({afterinternalresize:()=>{t(e)},thisObj:e,once:!0})),i.width=e.width,i.elementWidth=r.style.width,""===l.element.style.flex&&(i.nextRegionWidth=l.width,l.width="",l.flex="1"),""!==r.style.flex&&(i.flex=r.style.flex,e.header.element.style.flex=r.style.flex=""),r.classList.add("b-grid-subgrid-collapsed"),e.virtualScrollerElement.classList.add("b-collapsed"),e.header.element.classList.add("b-collapsed"),e.footer.element.classList.add("b-collapsed"),e._collapsed=!0,e.width="",o||(e.syncParallelSplitters(!0),t(!1))}})).then((r=>{if(!e.isDestroyed){var l;if(!1!==r)t.refreshVirtualScrollbars(),e.syncParallelSplitters(!0),null===(l=o.startSplitterButtonSyncing)||void 0===l||l.call(o);t.trigger("subGridCollapse",{subGrid:e}),t.afterToggleSubGrid({subGrid:e,collapsed:!0})}}))}async expand(){const e=this,{grid:t,_beforeCollapseState:r}=e,l=t.getSubGrid(t.getNextRegion(e.region)),o=e.splitterElement?e:e.previousSibling;if(!t.rendered||!0===e._collapsed)return new Promise((t=>{if(null!=r){let i=!1;e.width!==r.elementWidth&&(i=!0,e.ion({afterinternalresize(){e.setTimeout((()=>t(e)),10)},thisObj:e,once:!0})),r.nextRegionWidth&&(l.width=r.nextRegionWidth,l.flex=null),e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,e.virtualScrollerElement.classList.remove("b-collapsed"),e.header.element.classList.remove("b-collapsed"),e.footer.element.classList.remove("b-collapsed"),r.flex?(e.width=r.width,e.header.flex=e.flex=r.flex,e.footer.flex=r.flex,e._width=null):e.width=r.elementWidth,e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,i?(o.stopSplitterButtonSyncing(),e.syncParallelSplitters(!1)):t(!1),delete e._beforeCollapseState}else t()})).then((r=>{!1===r||e.isDestroyed||(t.trigger("subGridExpand",{subGrid:e}),t.afterToggleSubGrid({subGrid:e,collapsed:!1}))}))}}u(it,"delayable",{hideOverlayScroller:1e3}),it.initClass(),it._$name="SubGrid";var nt=e=>class extends(e||M){static get $name(){return"GridSubGrids"}static get properties(){return{subGrids:{}}}changeSubGridConfigs(e){const t=this,r=new Set;for(const l of t.columns){const{region:t}=l;t&&(e[t]||(e[t]={}),r.add(t))}e.normal&&s.isEmpty(e.normal)&&(e.normal=ut.defaultConfig.subGridConfigs.normal);for(const l of r)t.createSubGrid(l,e[l]);return t.items=t.subGrids,e}createSubGrid(e,t=null){const r=this,l=r.columns.makeChained((t=>t.region===e),["region"]),o=s.assign({type:"subgrid",id:`${r.id}-${e}Subgrid`,parent:r,grid:r,region:e,headerClass:r.headerClass,footerClass:r.footerClass,columns:l,weight:e},t||r.subGridConfigs[e]);let i=!1;o.flex||o.width||(o.width=l.totalFixedWidth,i=!0);const n=r.subGrids[e]=it.create(o);return n.hasCalculatedWidth=i,e===r.regions[0]&&(n.isFirstRegion=!0),n}onChildAdd(e){if(e.isSubGrid){const r=this,{items:l,headerContainer:o,virtualScrollers:i,footerContainer:n}=r,s=2*l.indexOf(e);r.hideHeaders||(t.insertAt(o,e.headerSplitter,s),t.insertAt(o,e.header.element,s)),t.insertAt(i,e.scrollerSplitter,s),t.insertAt(i,e.virtualScrollerElement,s),t.insertAt(n,e.footerSplitter,s),t.insertAt(n,e.footer.element,s),l.forEach(((e,t)=>{t<l.length-1&&e.showSplitter()})),0===s&&r.emptyTextEl&&e.element.appendChild(r.emptyTextEl)}return super.onChildAdd(e)}onChildRemove(e){if(super.onChildRemove(e),e.isSubGrid){const{items:t}=this;delete this.subGrids[e.region],S.remove(this.regions,e.region),e.destroy(),t.length&&t[t.length-1].hideSplitter()}}doDestroy(){this.eachSubGrid((e=>e.destroy())),super.doDestroy()}eachSubGrid(e,t=null){this.items.forEach(((r,l)=>{r.isSubGrid&&e.call(t||r,r,l++)}))}callEachSubGrid(e,...t){let r=null;return this.items.forEach(((l,o)=>{if(l.isSubGrid&&l[e]){const i=l[e](...t);0===o&&(r=i)}})),r}get regions(){return this.items.map((e=>e.region))}getLastRegions(){const e=this.regions.slice(-2);return 2===e.length?e:[e[0],e[0]]}getNextRegion(e){const t=this.regions;return t[t.indexOf(e)+1]||t[t.length-2]}getPreviousRegion(e){return this.regions[this.regions.indexOf(e)-1]}getSubGrid(e){return this.subGrids[e]}getSubGridFromColumn(e){return e=e instanceof Q?e:this.columns.getById(e)||this.columns.get(e),this.getSubGrid(e.region)}resolveSplitter(e){const t=this.getLastRegions();let r=e instanceof it?e.region:e;return t[1]===r&&(r=t[0]),this.subGrids[r].splitterElement}get widgetClass(){}};const st={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",ColumnPicker:{column:"Column",columnsMenu:"Columns",hideColumn:"Hide column",hideColumnShort:"Hide",newColumns:"New columns"},Filter:{applyFilter:"Apply filter",filter:"Filter",editFilter:"Edit filter",on:"On",before:"Before",after:"After",equals:"Equals",lessThan:"Less than",moreThan:"More than",removeFilter:"Remove filter",disableFilter:"Disable filter"},FilterBar:{enableFilterBar:"Show filter bar",disableFilterBar:"Hide filter bar"},Group:{group:"Group",groupAscending:"Group ascending",groupDescending:"Group descending",groupAscendingShort:"Ascending",groupDescendingShort:"Descending",stopGrouping:"Stop grouping",stopGroupingShort:"Stop"},HeaderMenu:{moveBefore:e=>`Move before "${e}"`,moveAfter:e=>`Move after "${e}"`,collapseColumn:"Collapse column",expandColumn:"Expand column"},ColumnRename:{rename:"Rename"},MergeCells:{mergeCells:"Merge cells",menuTooltip:"Merge cells with same value when sorted by this column"},Search:{searchForValue:"Search for value"},Sort:{sort:"Sort",sortAscending:"Sort ascending",sortDescending:"Sort descending",multiSort:"Multi sort",removeSorter:"Remove sorter",addSortAscending:"Add ascending sorter",addSortDescending:"Add descending sorter",toggleSortAscending:"Change to ascending",toggleSortDescending:"Change to descending",sortAscendingShort:"Ascending",sortDescendingShort:"Descending",removeSorterShort:"Remove",addSortAscendingShort:"+ Ascending",addSortDescendingShort:"+ Descending"},Column:{columnLabel:e=>`${e.text?`${e.text} column. `:""}SPACE for context menu${e.sortable?", ENTER to sort":""}`,cellLabel:new String},Checkbox:{toggleRowSelect:"Toggle row selection",toggleSelection:"Toggle selection of entire dataset"},RatingColumn:{cellLabel:e=>{var t;return`${e.text?e.text:""} ${null!==(t=e.location)&&void 0!==t&&t.record?`rating : ${e.location.record[e.field]||0}`:""}`}},GridBase:{loadFailedMessage:"Data loading failed!",syncFailedMessage:"Data synchronization failed!",unspecifiedFailure:"Unspecified failure",networkFailure:"Network error",parseFailure:"Failed to parse server response",serverResponse:"Server response:",noRows:"No records to display",moveColumnLeft:"Move to left section",moveColumnRight:"Move to right section",moveColumnTo:e=>`Move column to ${e}`},CellMenu:{removeRow:"Delete"},RowCopyPaste:{copyRecord:"Copy",cutRecord:"Cut",pasteRecord:"Paste",rows:"rows",row:"row"},CellCopyPaste:{copy:"Copy",cut:"Cut",paste:"Paste"},PdfExport:{"Waiting for response from server":"Waiting for response from server...","Export failed":"Export failed","Server error":"Server error","Generating pages":"Generating pages...","Click to abort":"Cancel"},ExportDialog:{width:"40em",labelWidth:"12em",exportSettings:"Export settings",export:"Export",exporterType:"Control pagination",cancel:"Cancel",fileFormat:"File format",rows:"Rows",alignRows:"Align rows",columns:"Columns",paperFormat:"Paper format",orientation:"Orientation",repeatHeader:"Repeat header"},ExportRowsCombo:{all:"All rows",visible:"Visible rows"},ExportOrientationCombo:{portrait:"Portrait",landscape:"Landscape"},SinglePageExporter:{singlepage:"Single page"},MultiPageExporter:{multipage:"Multiple pages",exportingPage:({currentPage:e,totalPages:t})=>`Exporting page ${e}/${t}`},MultiPageVerticalExporter:{multipagevertical:"Multiple pages (vertical)",exportingPage:({currentPage:e,totalPages:t})=>`Exporting page ${e}/${t}`},RowExpander:{loading:"Loading",expand:"Expand",collapse:"Collapse"}};T.publishLocale(st);const at=new Promise((e=>e())),dt={block:"nearest",inline:"nearest"},ct={dataset:1,pageLoad:1,filter:1};class ut extends(D.mixin(A,k,Ge,$e,je,Ke,Xe,et,nt,B)){static get $name(){return"GridBase"}static get type(){return"gridbase"}static get delayable(){return{onGridVerticalScroll:{type:"raf"},bufferedAfterColumnsResized:250,bufferedElementResize:250}}static get configurable(){return{autoHeight:null,enableSticky:null,enableTextSelection:null,fillLastColumn:!0,positionMode:"translate",showDirty:null,subGridConfigs:{normal:{flex:1}},store:{value:{},$config:"nullify"},rowManager:{value:{},$config:["nullify","lazy"]},scrollManager:{value:{},$config:["nullify","lazy"]},columns:{value:[],$config:"nullify"},minHeight:"10em",hideFooters:!0,contentElMutationObserver:!1,trapFocus:!1,ariaElement:"bodyElement",cellTabIndex:-1,rowCls:{value:"b-grid-row",$config:{merge:this.mergeCls}},cellCls:{value:"b-grid-cell",$config:{merge:this.mergeCls}},emptyText:"L{noRows}",sortFeatureStore:"store"}}static get defaultConfig(){return{rowHeight:null,fixedRowHeight:null,defaultRowHeight:45,fullRowRefresh:!0,hideHeaders:null,preserveScrollOnDatasetChange:null,preserveFocusOnDatasetChange:!0,data:null,defaultRegion:"normal",destroyStore:null,maskDefaults:{cover:"body",target:"element"},columnLines:!0,resizeToFitIncludesHeader:!0,animateRemovingRows:!0,disableGridRowModelWarning:null,headerClass:Ae,footerClass:_e,testPerformance:!1,rowScrollMode:"move",monitorResize:!0,features:!0,scrollable:{overflowY:!0},scrollerClass:De,refreshSuspended:0,transitionDuration:500,contextMenuTriggerEvent:"contextmenu",localizableProperties:["emptyText"],asyncEventSuffix:"",testConfig:{transitionDuration:50}}}static get properties(){return{_selectedRecords:[],_verticalScrollHeight:0,virtualScrollHeight:0,_scrollTop:null}}finishConfigure(e){const t=this,{initScroll:r}=t;t.initScroll=()=>!t.scrollInitialized&&r.call(t),super.finishConfigure(e),O.ion({locale:"onBeforeLocaleChange",prio:1,thisObj:t}),O.ion({locale:"onLocaleChange",prio:-1,thisObj:t}),f.ion({theme:"onThemeChange",thisObj:t}),t.ion({subGridExpand:"onSubGridExpand",prio:-1,thisObj:t}),t.bufferedFixElementHeights=t.buffer("fixElementHeights",350,t),t.setGridClassList(t.element.classList)}onSubGridExpand(){this.renderContents()}onBeforeLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!0}onLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!1,this.isPainted&&this.renderContents()}finalizeInit(){super.finalizeInit(),this.store.isLoading&&this.onStoreBeforeRequest()}changeScrollManager(e,t){return null==t||t.destroy(),e?w.new({element:this.element,owner:this},e):null}doDestroy(){var e;const t=this;t.detachListeners("GridBase:store"),null===(e=t.scrollManager)||void 0===e||e.destroy();for(const e of Object.values(t.features)){var r;null===(r=e.destroy)||void 0===r||r.call(e)}t._focusedCell=null,t.columns.destroy(),super.doDestroy()}setGridClassList(e){Object.values(this.features).forEach((t=>{if(t.disabled)return;let r;r=Object.prototype.hasOwnProperty.call(t.constructor,"featureClass")?t.constructor.featureClass:`b-${t instanceof M?t.$$name:t.constructor.name}`,r&&e.add(r.toLowerCase())}))}compose(){const{autoHeight:e,enableSticky:t,enableTextSelection:r,fillLastColumn:l,positionMode:o,showDirty:i}=this;return{class:{[`b-grid-${o}`]:1,"b-enable-sticky":t,"b-grid-notextselection":!r,"b-autoheight":e,"b-fill-last-column":l,"b-show-dirty":i}}}get cellCls(){const{_cellCls:e}=this;return e.value||e}get bodyConfig(){const{autoHeight:e,hideFooters:r,hideHeaders:l}=this;return{reference:"bodyElement",className:{"b-autoheight":e,"b-grid-panel-body":1},[this.hasHeader?"ariaLabelledBy":""]:`${this.id}-panel-title`,children:{headerContainer:{tag:"header",role:"row","aria-rowindex":1,className:{"b-grid-header-container":1,"b-hidden":l}},bodyContainer:{className:"b-grid-body-container",tabIndex:-1,role:"presentation",children:{verticalScroller:{className:"b-grid-vertical-scroller"}}},virtualScrollers:{className:"b-virtual-scrollers b-hide-display",style:b.isFirefox&&t.scrollBarWidth?{height:`${t.scrollBarWidth}px`}:void 0},footerContainer:{tag:"footer",className:{"b-grid-footer-container":1,"b-hidden":r}}}}}get contentElement(){return this.verticalScroller}get overflowElement(){return this.bodyContainer}updateHideFooters(e){var t;null===(t=this.footerContainer)||void 0===t||t.classList[e?"add":"remove"]("b-hidden")}changeColumns(e,t){const r=this;if(!e&&t)return r.isDestroying?t.owner===r&&t.destroy():t.removeAll(),t;if(e.isStore)return(null==t?void 0:t.owner)===r&&t.destroy(),e.grid=r,e;if(Array.isArray(e)){if(t){r._suspendRenderContentsOnColumnsChanged=!0;const l=t.allRecords.filter((t=>!e.includes(t)&&t!==r.checkboxSelectionColumn));return t.remove(t.allRecords,!0),l.forEach((e=>{var t;return null===(t=e.destroy)||void 0===t?void 0:t.call(e)})),t.data=e,r._suspendRenderContentsOnColumnsChanged=!1,t}e={data:e}}if(t)throw new Error("Replacing ColumnStore is not supported");return te.new({grid:r,owner:r},e)}updateColumns(e,t){var r,l;const o=this;var i,n;null===(r=super.updateColumns)||void 0===r||r.call(this,e,t),e.ion({refresh:o.onColumnsChanged,change:o.onColumnsChanged,sort:o.onColumnsChanged,thisObj:o}),e.ion((i=o.onColumnsResized,n=o,{update:({store:e,record:t,changes:r})=>{let l=!0;return("width"in r||"minWidth"in r||"maxWidth"in r||"flex"in r)&&(l=i.call(n,{store:e,record:t,changes:r})),l}})),b.isTouchDevice&&(o.touch=!0,e.forEach((e=>{const{touchConfig:t}=e;t&&e.applyState(t)}))),null===(l=o.bodyElement)||void 0===l||l.setAttribute("aria-colcount",e.visibleColumns.length)}onColumnsChanged({type:e,action:t,changes:r,record:l,records:o,isMove:i}){const n=r&&1===Object.keys(r).length;if("refresh"===e&&"batch"!==t||"update"===t&&n&&"parentIndex"in r)return;const s=this,{columns:a,checkboxSelectionColumn:d}=s;if(s.isPainted&&(!i||"remove"!==t)){if("add"===t)for(const e of o){const{region:t}=e;s.subGrids[t]||s.add(s.createSubGrid(t,s.subGridConfigs[t]))}if("update"===t){if("width"in r||"minWidth"in r||"maxWidth"in r||"flex"in r){const e=l.region;return a.visibleColumns.forEach((t=>{t.region===e&&t.repaintOnResize&&s.refreshColumn(t)})),void s.afterColumnsChange({action:t,changes:r,column:l})}if("text"in r&&n)return void l.subGrid.refreshHeader();if("hidden"in r){const e=s.getSubGridFromColumn(l.id);e.header.fixHeaderWidths(),e.footer.fixFooterWidths(),e.updateHasFlex()}}if("dataset"===t||"batch"===t||"update"===t&&"region"in r){const e=a.getDistinctValues("region"),{toRemove:t,toAdd:r}=S.delta(e,s.regions,!0);s.remove(t.map((e=>s.getSubGrid(e)))),s.add(r.map((e=>s.createSubGrid(e))))}if(d&&!a.includes(d)){const e=a.indexOf(a.findRecord("type","rownumber"))+1;a.insert(e,d,!0)}s._suspendRenderContentsOnColumnsChanged||s.renderContents(),s.syncFlexedSubCols(),s.bodyElement.setAttribute("aria-colcount",a.visibleColumns.length),s.afterColumnsChange({action:t,changes:r,column:l})}}onColumnsResized({changes:e,record:r}){const l=this;if(l.isConfiguring)return;const o=t.setLength(r.width),i=t.setLength(r.minWidth),n=t.setLength(r.maxWidth),s=l.getSubGridFromColumn(r.id);if(s.header.fixHeaderWidths(),s.footer.fixFooterWidths(),s.updateHasFlex(),!r.flex||!r.childLevel){l.cellEls&&r===l.lastColumnResized||(l.cellEls=t.children(l.element,`.b-grid-cell[data-column-id="${r.id}"]`),l.lastColumnResized=r);for(const t of l.cellEls){var a;if("width"in e&&(t.style.width=o),"minWidth"in e&&(t.style.minWidth=i),"maxWidth"in e&&(t.style.maxWidth=n),"flex"in e)t.style.flex=null!==(a=r.flex)&&void 0!==a?a:null}}l.resizingColumns||l.afterColumnsResized(r),l.syncFlexedSubCols()}afterColumnsResized(e){const t=this;t.eachSubGrid((t=>{t.collapsed||e&&e.region!==t.region||(t.fixWidths(),t.fixRowWidthsInSafariEdge())})),t.lastColumnResized=t.cellEls=null,t.bufferedAfterColumnsResized(e),t.onHeightChange()}syncFlexedSubCols(){const e=this.columns.query((e=>e.flex&&e.childLevel&&e.element));if(e)for(const r of e){const e=r.element.getBoundingClientRect().width,l=t.children(this.element,`.b-grid-cell[data-column-id="${r.id}"]`);for(const t of l)t.style.flex=`0 0 ${e}px`}}bufferedAfterColumnsResized(e){this.columns.usesAutoHeight&&this.refreshRows(),this.refreshVirtualScrollbars(),this.eachSubGrid((t=>{t.collapsed||e&&e.region!==t.region||t.refreshFakeScroll()}))}bufferedElementResize(){this.refreshRows()}onInternalResize(e,r,l,o,i){t.scrollBarWidth&&r<o&&this.eachSubGrid((e=>{e.flex&&e.onElementResize(e.element)})),super.onInternalResize(...arguments),this.isPainted&&r!==o&&this.columns.usesFlexAutoHeight&&this.bufferedElementResize()}changeRowManager(e,t){const r=this;if(r._isRowMeasured||r.measureRowHeight(),null==t||t.destroy(),e){const t=Le.new({grid:r,rowHeight:r.rowHeight,rowScrollMode:r.rowScrollMode||"move",autoHeight:r.autoHeight,fixedRowHeight:r.fixedRowHeight,internalListeners:{changeTotalHeight:"onRowManagerChangeTotalHeight",requestScrollChange:"onRowManagerRequestScrollChange",thisObj:r}},e);return r.relayEvents(t,["beforeRenderRow","renderRow"]),r._rowManager=null,t}}getRowHeight(e){return e.rowHeight}processRowHeight(e,t){}bindStore(e){const t=this.asyncEventSuffix;e.ion({name:"GridBase:store",[`refresh${t}`]:"onStoreDataChange",[`add${t}`]:"onStoreAdd",[`remove${t}`]:"onStoreRemove",[`replace${t}`]:"onStoreReplace",[`removeAll${t}`]:"onStoreRemoveAll",[`move${t}`]:e.tree?null:"onFlatStoreMove",change:"relayStoreDataChange",idChange:"onStoreRecordIdChange",update:"onStoreUpdateRecord",beforeRequest:"onStoreBeforeRequest",afterRequest:"onStoreAfterRequest",exception:"onStoreException",commit:"onStoreCommit",thisObj:this}),super.bindStore(e)}unbindStore(e){this.detachListeners("GridBase:store"),this.destroyStore&&e.destroy()}changeStore(e){if(null==e)return null;var t;("string"==typeof e&&(e=d.getStore(e)),e.isStore)||((e=s.assign({data:this.data,tree:Boolean(null===(t=this.initialConfig.features)||void 0===t?void 0:t.tree)},e)).data||delete e.data,e.modelClass||(e.modelClass=X),e=new(e.readUrl?P:d)(e));return e}updateStore(e,t){var r;const l=this;var o;(null===(r=super.updateStore)||void 0===r||r.call(this,e,t),t&&l.unbindStore(t),e&&(t&&l.deselectAll(),l.bindStore(e)),l.trigger("bindStore",{store:e,oldStore:t}),l.isDestroying||!l.isPainted||l.refreshSuspended)||(null===(o=l._rowManager)||void 0===o||o.reinitialize())}onStoreUpdateRecord({source:e,record:t,changes:r}){const l=this;if(!l.refreshSuspended)if(l.forceFullRefresh)l.rowManager.refresh(),l.forceFullRefresh=!1;else{let o;if(t.isFieldModified("id")&&(o=l.getRowFor(t.meta.modified.id)),o=o||l.getRowFor(t),!o)return;if(l.fullRowRefresh||t.isSpecialRow){const r=e.indexOf(t);-1!==r&&o.render(r,t)}else l.columns.visibleColumns.forEach((e=>{const t=e.field;if(!(e.constructor.simpleRenderer&&!Object.prototype.hasOwnProperty.call(e.data,"renderer"))||r[t]){const e=o.getCell(t);e&&o.renderCell(e)}}))}}refreshFromRowOnStoreAdd(e,t){const r=this,{rowManager:l}=r;l.renderFromRow(e),l.trigger("changeTotalHeight",{totalHeight:l.totalHeight}),1===r.store.count&&r.callEachSubGrid("refreshFakeScroll")}onMaskAutoClose(e){super.onMaskAutoClose(e),this.toggleEmptyText()}onStoreAdd({source:e,records:t,index:r,oldIndex:l,isChild:o,oldParent:i,parent:n,isMove:s,isExpandAll:a}){if(!this.isPainted||a||this.refreshSuspended)return;const d=s&&t.some((t=>{if(s[t.id]){const r=e.getById(t.meta.modified.parentId);return(null==r?void 0:r.isExpanded(e))&&(null==r?void 0:r.ancestorsExpanded(e))}}));if(o&&!t[0].ancestorsExpanded(e)&&!d){if(!n.isLeaf){const e=this.rowManager.getRowById(n);e&&this.rowManager.renderRows([e])}return}this.rowManager.calculateRowCount(!1,!0,!0),e.isFiltered&&(r=e.indexOf(t[0]));const c=this,{rowManager:u}=c,{topIndex:h,rows:g,rowCount:m}=u,f=u.topIndex+u.rowCount-1,p=r,b=r+t.length-1,C=f>=e.count-t.length-1;i||l>-1||o&&s?u.refresh():p>=h&&p<h+m?c.refreshFromRowOnStoreAdd(g[p-h],...arguments):b>=h&&b<h+m?u.refresh():(C&&r>f&&u.fillBelow(c._scrollTop||0),u.estimateTotalHeight(!0))}onStoreException({action:e,type:t,response:r,exceptionType:l,error:o}){var i;const n=this;let s;switch(t){case"server":s=r.message||n.L("L{unspecifiedFailure}");break;case"exception":s="network"===l?n.L("L{networkFailure}"):(null==o?void 0:o.message)||(null==r||null===(i=r.parsedJson)||void 0===i?void 0:i.message)||n.L("L{parseFailure}")}n.applyMaskError(`<div class="b-grid-load-failure">\n                <div class="b-grid-load-fail">${n.L("read"===e?"L{loadFailedMessage}":"L{syncFailedMessage}")}</div>\n                ${null!=r&&r.url?`<div class="b-grid-load-fail">${r.url}</div>`:""}\n                <div class="b-grid-load-fail">${n.L("L{serverResponse}")}</div>\n                <div class="b-grid-load-fail">${s}</div>\n            </div>`)}onStoreDataChange({action:e,changes:t,source:r,syncInfo:l}){var o,i;if(this.refreshSuspended||!this.rowManager)return;const n=this,s=r.isGrouped&&t&&r.groupers.some((e=>e.field in t));null===(o=super.onStoreDataChange)||void 0===o||o.call(this,...arguments),"batch"===e&&null!=l&&null!==(i=l.removed)&&void 0!==i&&i.length?n.rowManager.renderFromRow(n.topRow):("dataset"===e&&n.rowManager.clearKnownHeights(),n.isPainted&&!s&&n.renderRows(Boolean(!(e in ct)||n.preserveScrollOnDatasetChange))),n.toggleEmptyText()}onStoreRecordIdChange(){super.onStoreRecordIdChange&&super.onStoreRecordIdChange(...arguments)}onStoreBeforeRequest(){this.applyLoadMask()}onStoreAfterRequest(e){this.loadMask&&!e.exception&&(this.masked=null,this.toggleEmptyText())}needsFullRefreshOnStoreRemove({isCollapse:e}){const t=this._features;return(null==t?void 0:t.group)&&!t.group.disabled||(null==t?void 0:t.groupSummary)&&!t.groupSummary.disabled||this.store.tree&&!e&&this.store.modelClass.convertEmptyParentToLeaf}onStoreRemove({records:e,isCollapse:t,isChild:r,isMove:l,isCollapseAll:o}){if(!this.isPainted||l||o)return;super.onStoreRemove&&super.onStoreRemove(...arguments);const i=this,{rowManager:n}=i;if(n.invalidateKnownHeight(e),i.animateRemovingRows&&!t&&!r){const t=e.reduce(((e,t)=>{const r=n.getRowById(t.id);return r&&e.push(r),e}),[]);if(t.length){const e=t[0];return i.isAnimating=!0,C.onTransitionEnd({element:e._elementsArray[0],property:"left",duration:i.transitionDuration,thisObj:i,handler:()=>{i.isAnimating=!1,t.forEach((e=>!e.isDestroyed&&e.removeCls("b-removing"))),n.refresh(),i.trigger("rowRemove"),i.afterRemove(arguments[0])}}),void t.forEach((e=>e.addCls("b-removing")))}}if(i.needsFullRefreshOnStoreRemove(...arguments))n.refresh(),i.afterRemove(arguments[0]);else{const r=n.topIndex;if(n.calculateRowCount(!1,!0,!0),n.topIndex!==r)n.renderFromRow(n.topRow);else{const{rows:t}=n,r=e.reduce(((e,r)=>{const l=n.getRowById(r.id);return l&&(e=Math.min(e,t.indexOf(l))),e}),t.length);t[r]?!i.refreshSuspended&&n.renderFromRow(t[r]):n.trigger("changeTotalHeight",{totalHeight:n.totalHeight})}i.trigger("rowRemove",{isCollapse:t}),i.afterRemove(arguments[0])}}onFlatStoreMove({from:e,to:t}){const{rowManager:r}=this,{topIndex:l,rowCount:o}=r,[i,n]=[e,t].sort(((e,t)=>e-t));i>=l&&i<l+o?r.renderFromRow(r.rows[i-l]):n>=l&&n<l+o&&r.refresh()}onStoreReplace({records:e,all:t}){const{rowManager:r}=this;if(t)r.clearKnownHeights(),r.refresh();else{const t=e.reduce(((e,[,t])=>{const r=this.getRowFor(t);return r&&e.push(r),e}),[]);r.invalidateKnownHeight(e),r.renderRows(t)}}relayStoreDataChange(e){if(this.ariaElement.setAttribute("aria-rowcount",this.store.count+1),!this.project)return this.trigger("dataChange",n(n({},e),{},{store:e.source,source:this}))}onStoreRemoveAll(){super.onStoreRemoveAll&&super.onStoreRemoveAll(...arguments),this.isPainted&&(this.rowManager.clearKnownHeights(),this.renderRows(!1),this.toggleEmptyText())}onStoreCommit({changes:e}){if(this.showDirty&&e.modified.length){const t=[];e.modified.forEach((e=>{const r=this.rowManager.getRowFor(e);r&&t.push(r)})),this.rowManager.renderRows(t)}}get data(){return this._store?this._store.records:this._data}set data(e){this._store?this._store.data=e:this._data=e}populateHeaderMenu({column:e,items:t}){const r=this,{subGrids:l,regions:o}=r,{parent:i}=e;let n=!0;Object.entries(l).forEach((([s,a])=>{if(!a.sealedColumns&&e.draggable&&s!==e.region&&(!i&&l[e.region].columns.count>1||i&&i.children.length>1)){const i=a.element.compareDocumentPosition(l[e.region].element)===document.DOCUMENT_POSITION_PRECEDING,d=r.rtl?!i:i,c=o.length>2?r.L("L{moveColumnTo}",r.optionalL(s)):r.L(d?"L{moveColumnRight}":"L{moveColumnLeft}");t[`${s}Region`]={targetSubGrid:s,text:c,icon:"b-fw-icon b-icon-column-move-"+(d?"right":"left"),separator:n,onItem:({item:t})=>{e.traverse((e=>e.region=s)),r.columns.insert(r.columns.indexOf(l[t.targetSubGrid].columns.last)+1,e),r.scrollColumnIntoView(e)}},n=!1}}))}populateCellMenu({record:e,items:t}){}getColumnDragToolbarItems(e,t){return t}normalizeCellContext(e){const t=this,{columns:r}=t;return e.isLocation?e:e.isModel?new Y({grid:t,id:e.id,columnId:r.visibleColumns[0].id}):new Y(s.assign({grid:t},e))}getCell(e){const{store:t,columns:r}=this,{visibleColumns:l}=this.columns,o=isNaN(e.row)?isNaN(e.rowIndex)?t.indexOf(e.record||e.id):e.rowIndex:e.row,i=isNaN(e.column)?isNaN(e.columnIndex)?l.indexOf(e.column||r.getById(e.columnId)||r.get(e.field)||l[0]):e.columnIndex:e.column;return o>-1&&o<t.count&&i>-1&&i<l.length&&this.normalizeCellContext(e).cell||null}getHeaderElement(e){return e.isModel&&(e=e.id),this.fromCache(`.b-grid-header[data-column-id="${e}"]`)}getHeaderElementByField(e){const t=this.columns.get(e);return t?this.getHeaderElement(t):null}get bodyHeight(){return this._bodyHeight}get headerHeight(){const e=this;return e.isPainted&&!e._headerHeight&&(e._headerHeight=e.headerContainer.offsetHeight),e._headerHeight}get footerHeight(){const e=this;return e.isPainted&&!e._footerHeight&&(e._footerHeight=e.footerContainer.offsetHeight),e._footerHeight}get isTreeGrouped(){var e;return Boolean(null===(e=this.features.treeGroup)||void 0===e?void 0:e.isGrouped)}getRecordFromElement(e){const t=e.closest(".b-grid-row");return t?this.store.getAt(t.dataset.index):null}getColumnFromElement(e){const t=e.closest(".b-grid-cell, .b-grid-header");if(!t)return null;if(t.matches(".b-grid-header"))return this.columns.getById(t.dataset.columnId);const r=F.get(t);return this.columns.getById(r.columnId)}updateAutoHeight(e){s.assertBoolean(e,"autoHeight")}get columnLines(){return this._columnLines}set columnLines(e){s.assertBoolean(e,"columnLines"),t.toggleClasses(this.element,"b-no-column-lines",!e),this._columnLines=e}get keyMapElement(){return this.bodyElement}fixSizes(){this.callEachSubGrid("fixWidths");const e=this.headerContainer.querySelectorAll(".b-grid-header.b-depth-0");for(let t=0,{length:r}=e;t<r;t++)e[t].setAttribute("aria-colindex",t+1)}onRowManagerChangeTotalHeight({totalHeight:e,immediate:t}){return this.refreshTotalHeight(e,t)}refreshTotalHeight(e=this.rowManager.totalHeight,t=!1){const r=this;if(r.renderingRows||!r.isVisible)return!1;const l=r.scrollable,o=Math.abs(r.virtualScrollHeight-e),i=r._bodyRectangle.height;if(o){const n=e-i-r._scrollTop<2*i||r._verticalScrollHeight&&r._verticalScrollHeight-i<r._scrollTop;l.scrollHeight=r.virtualScrollHeight=e,r.isPainted&&(r.scrolling&&!n||o<100)&&!t?r.bufferedFixElementHeights():(r.virtualScrollHeightDirty&&r.virtualScrollHeightDirty(),r.bufferedFixElementHeights.cancel(),r.fixElementHeights())}}fixElementHeights(){const e=this,t=e.virtualScrollHeight,r=`${t}px`;e._verticalScrollHeight=t,e.verticalScroller.style.height=r,e.virtualScrollHeightDirty=!1,e.autoHeight&&(e.bodyContainer.style.height=r,e._bodyHeight=t,e.refreshBodyRectangle()),e.refreshVirtualScrollbars()}refreshBodyRectangle(){return this._bodyRectangle=H.client(this.bodyContainer)}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}enableScrollingCloseToEdges(e){this.scrollManager.startMonitoring({scrollables:[{element:this.scrollable.element,direction:"vertical"},...S.asArray(e||[]).map((e=>({element:("string"==typeof e?this.subGrids[e]:e).scrollable.element})))],direction:"horizontal"})}disableScrollingCloseToEdges(e){this.scrollManager.stopMonitoring([this.scrollable.element,...S.asArray(e||[]).map((e=>("string"==typeof e?this.subGrids[e]:e).element))])}onRowManagerRequestScrollChange({bottom:e}){this.scrollable.y=e-this.bodyHeight}initScroll(){const e=this,{scrollable:t}=e;e.scrollInitialized||(e.scrollInitialized=!0,t.contentElement=e.contentElement,t.ion({scroll:"onGridVerticalScroll",scrollend:"onGridVerticalScrollEnd",thisObj:e}),e.callEachSubGrid("initScroll"),b.isMobileSafari&&(t.element.style.transform="translate3d(0, 0, 0)"))}onGridVerticalScroll({source:e}){const t=this,{y:r}=e;r!==t._scrollTop&&(t._scrollTop=r,t.scrolling||(t.scrolling=!0,t.eachSubGrid((e=>e.suspendResizeMonitor=!0))),t.rowManager.updateRenderedRows(r),t.afterScroll({scrollTop:r}),t.trigger("scroll",{scrollTop:r}))}onGridVerticalScrollEnd(){this.scrolling=!1,this.eachSubGrid((e=>e.suspendResizeMonitor=!1))}async scrollRowIntoView(e,t=dt){const r=this,l=t.block||"nearest",{rowManager:o}=r,i=r.store.getById(e);if(i){let e;if(-1===r.store.indexOf(i))return at;let s=r.scrollable,a=r.getRecordCoords(i);const d=H.from(s.element);if(!a.virtual){let{column:e}=t;if(e){if(e.isModel||(e=r.columns.getById(e)||r.columns.get(e)),e){s=r.getSubGridFromColumn(e).scrollable;const t=H.from(o.getRowFor(i).getCell(e.id));a.x=t.x,a.width=t.width}}else t.x=!1;return s.scrollIntoView(a,t)}{const c=a.block,u="nearest"!==l?t:{block:c};if(e=s.scrollIntoView(a,{block:"center"}),o.scrollTargetRecordId=i,o.updateRenderedRows(s.y,!0),a=r.getRecordCoords(i),o.lastScrollTop=s.y,a.virtual)return at;var n;if(t.animate)s.suspendEvents(),"end"===l||"nearest"===l&&"end"===c?s.y-=d.bottom-a.bottom:("start"===l||"nearest"===l&&"start"===c)&&(s.y+=a.y-d.y),o.updateRenderedRows(s.y,!1,!0),"end"===c?s.y-=o.appendRowBuffer*o.rowHeight-1:s.y+=o.prependRowBuffer*o.rowHeight-1,s.scrollIntoView(r.getRecordCoords(i),Object.assign({},t,u)),s.resumeEvents();else t.recursive||await e,await(null===(n=r.scrollRowIntoView)||void 0===n?void 0:n.call(r,i,Object.assign({recursive:!0},t,u)))}}}scrollColumnIntoView(e,t){return e=e instanceof Q?e:this.columns.get(e)||this.columns.getById(e)||this.columns.getAt(e),this.getSubGridFromColumn(e).scrollColumnIntoView(e,t)}scrollCellIntoView(e,t){return this.scrollRowIntoView(e.id,Object.assign({column:e.columnId},"boolean"==typeof t?{animate:t}:t))}scrollToBottom(e){return this.scrollRowIntoView(this.store.last,e)}scrollToTop(e){return this.scrollable.scrollBy(0,-this.scrollable.y,e)}storeScroll(){const e=this,t=e.storedScrollState={scrollTop:e.scrollable.y,scrollLeft:{}};return e.eachSubGrid((e=>{t.scrollLeft[e.region]=e.scrollable.x})),t}restoreScroll(e=this.storedScrollState){this.eachSubGrid((t=>{const r=e.scrollLeft[t.region];var l;null!=r&&(t.scrollable.updateX(r),t.header.scrollable.updateX(r),t.footer.scrollable.updateX(r),null===(l=t.fakeScroller)||void 0===l||l.updateX(r))})),this.scrollable.updateY(e.scrollTop)}beginGridMeasuring(){const e=this;if(e.$measureCellElements||(e.$measureCellElements=t.createElement({className:"b-grid-subgrid "+(!e._isRowMeasured&&e.hasFeature("stripe")?"b-stripe":""),reference:"subGridElement",style:{position:"absolute",top:"-10000px",left:"-100000px",visibility:"hidden",contain:"strict"},children:[{className:"b-grid-row",reference:"rowElement",children:[{className:"b-grid-cell",reference:"cellElement",style:{width:"auto",contain:b.isFirefox?"layout paint":"layout style paint"}}]}]})),e.getConfig("element"),e.verticalScroller.appendChild(e.$measureCellElements.subGridElement),!e.rendered){const r=e.appendTo||e.insertBefore||document.body,l=t.getRootElement("string"==typeof r?document.getElementById(r):r);e.adopt&&l.contains(e.element)||(l.appendChild(e.element),e.$removeAfterMeasuring=!0)}return e.$measureCellElements}endGridMeasuring(){this.$removeAfterMeasuring&&(this.element.remove(),this.$removeAfterMeasuring=!1),this.$measureCellElements.subGridElement.remove()}measureRowHeight(){const e=this,{rowElement:r}=e.beginGridMeasuring(),l=t.getStyleValue(r,["height","border-top-width","border-bottom-width"]),o=parseInt(l.height),i=b.isFirefox?globalThis.devicePixelRatio/Math.max(Math.trunc(globalThis.devicePixelRatio),1):1,n=l["border-top-width"]?Math.round(i*parseFloat(l["border-top-width"])):0,s=l["border-bottom-width"]?Math.round(i*parseFloat(l["border-bottom-width"])):0;null!=e.rowHeight&&e.rowHeight!==e._rowHeightFromStyle||(e.rowHeight=!isNaN(o)&&o?o:e.defaultRowHeight,e._rowHeightFromStyle=e.rowHeight),e._rowBorderHeight=n+s,e._isRowMeasured=!0,e.endGridMeasuring()}onThemeChange({theme:e}){this.whenVisible("measureRowHeight"),this.trigger("theme",{theme:e})}refreshRows(e=!1){const{element:t,rowManager:r}=this;t.classList.add("b-notransition"),e?r.returnToTop():r.refresh(),t.classList.remove("b-notransition")}refreshColumn(e){e.isVisible&&(e.isLeaf?this.rowManager.forEach((t=>t.renderCell(t.getCell(e.id)))):e.children.forEach((e=>this.refreshColumn(e))))}refreshVirtualScrollbars(){const e=this,{headerContainer:r,footerContainer:l,virtualScrollers:o,scrollable:i,hasVerticalOverflow:n}=e,{classList:s}=o,a=!s.contains("b-hide-display"),d=Object.values(e.subGrids).some((e=>e.overflowingHorizontally)),c=d!==a;if(c&&o.classList.toggle("b-hide-display",!d),t.scrollBarWidth){const t=n||"scroll"===i.overflowY;r.classList.toggle("b-show-yscroll-padding",t),l.classList.toggle("b-show-yscroll-padding",t),o.classList.toggle("b-show-yscroll-padding",t),c&&(d&&e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange())}}get hasVerticalOverflow(){return this.scrollable.hasOverflow("y")}get contentHeight(){const e=this.rowManager;return Math.max(e.totalHeight,e.bottomRow?e.bottomRow.bottom:0)}onContentChange(){const e=this,t=e.rowManager;e.isVisible?(t.estimateTotalHeight(),e.paintListener=null,e.refreshTotalHeight(e.contentHeight),e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange()):e.paintListener||(e.paintListener=e.ion({paint:"onContentChange",once:!0,thisObj:e}))}triggerPaint(){this.isPainted||this.refreshBodyRectangle(),super.triggerPaint()}onHeightChange(){const e=this;e.refreshBodyRectangle(),e._bodyHeight=e.autoHeight?e.contentHeight:e.bodyContainer.offsetHeight}suspendRefresh(){this.refreshSuspended++}resumeRefresh(e){this.refreshSuspended&&!--this.refreshSuspended&&(e&&this.refreshRows(),this.trigger("resumeRefresh",{trigger:e}))}renderRows(e=!0){const t=this,r=e&&t.storeScroll();t.refreshSuspended||(t.trigger("beforeRenderRows"),t.renderingRows=!0,t.element.classList.add("b-grid-refreshing"),e||(t.scrollable.y=t._scrollTop=0),t.rowManager.reinitialize(!e),t.trigger("renderRows"),t.renderingRows=!1,t.onContentChange(),e&&t.restoreScroll(r),t.element.classList.remove("b-grid-refreshing"))}renderContents(){const e=this,{element:t,headerContainer:r,footerContainer:l,rowManager:o}=e;if(e.emptyCache(),e.isPainted){e._headerHeight=null,e.callEachSubGrid("refreshHeader",r),e.callEachSubGrid("refreshFooter",l),e.renderHeader(r,t),e.renderFooter(l,t),e.fixSizes();const i=o.removeAllRows();o.calculateRowCount(!1,!0,!0),o.rowCount&&(o.setPosition(i),e.renderRows())}}onPaintOverride(){}onPaint({firstPaint:e}){var r;const l=this;if(l.ariaElement.setAttribute("aria-rowcount",l.store.count+1),null===(r=super.onPaint)||void 0===r||r.call(this,...arguments),l.onPaintOverride()||!e)return;const{rowManager:o,store:i,element:n,headerContainer:s,bodyContainer:a,footerContainer:d}=l,c=t.scrollBarPadElement;let u,h=0;l.role=null!=i&&i.isTree?"treegrid":"grid",l.columns.ion({change:()=>u=!0,once:!0}),l.updateResponsive(l.width,0),u&&(l.callEachSubGrid("refreshHeader",s),l.callEachSubGrid("refreshFooter",d)),l.renderHeader(s,n),l.renderFooter(d,n),t.append(s,c),t.append(d,c),t.append(l.virtualScrollers,c),l.refreshBodyRectangle();const g=l.bodyContainer.offsetHeight;if(l.autoHeight?(l._bodyHeight=o.initWithHeight(n.offsetHeight-s.offsetHeight-d.offsetHeight,!0),a.style.height=l.bodyHeight+"px"):(l._bodyHeight=g,o.initWithHeight(l._bodyHeight,!0)),l.eachSubGrid((e=>{e.header.maxDepth>h&&(h=e.header.maxDepth)})),s.dataset.maxDepth=h,l.fixSizes(),!i.count&&i.isLoading||l.renderRows(),l.columns.usesAutoHeight){const{fonts:e}=document;"loaded"!==(null==e?void 0:e.status)&&e.ready.then((()=>!l.isDestroyed&&l.refreshRows()))}l.initScroll(),l.initInternalEvents()}render(){const e=this;e.requireSize=Boolean(e.owner),super.render(...arguments),e.autoHeight||(e.headerContainer.offsetHeight&&!e.bodyContainer.offsetHeight&&console.warn("Grid element not sized correctly, please check your CSS styles and review how you size the widget"),"minHeight"in e.initialConfig||"height"in e.initialConfig||parseInt(globalThis.getComputedStyle(e.element).minHeight)!==e.height||console.warn(`The ${e.$$name} is sized by its predefined minHeight, likely this is not intended. Please check your CSS and review how you size the widget, or assign a fixed height in the config. For more information, see the "Basics/Sizing the component" guide in docs.`))}renderHeader(e,t){}renderFooter(e,t){}beforeRenderCell(){}beforeRenderRow(){}afterRenderRow(){}afterScroll(){}processCellEditor(e){}afterColumnsChange(){}afterRemove(e){}afterToggleGroup(){}afterToggleSubGrid(){}syncMaskCover(e=this.masked){if(e){const t="body"===e.cover&&this.rectangleOf("bodyContainer"),r=t&&this.rectangleOf("virtualScrollers"),{style:l}=e.element;l.marginTop=t?`${t.y}px`:"",l.height=t?`${t.height+((null==r?void 0:r.height)||0)}px`:""}}maskBody(e){let t;return this.bodyContainer&&(this.masked=G.mergeConfigs(this.loadMaskDefaults,e),t=this.masked),t}unmaskBody(){this.masked=null}updateEmptyText(e){var r,l;null===(r=this.emptyTextEl)||void 0===r||r.remove(),this.emptyTextEl=t.createElement({parent:null===(l=this.firstItem)||void 0===l?void 0:l.element,className:"b-empty-text",[null!=e&&e.includes("<")?"html":"text"]:e})}toggleEmptyText(){const{bodyContainer:e,store:t}=this;null==e||e.classList.toggle("b-grid-empty",!(t.count>0||t.isLoading||t.isCommitting))}updateReadOnly(e,t){if(super.updateReadOnly(e,t),!this.isConfiguring)for(const t of this.columns.bottomColumns){var r;null===(r=t.updateReadOnly)||void 0===r||r.call(t,e)}}getCurrentConfig(e){const t=super.getCurrentConfig(e),{store:r}=this,l=r.getInlineData(e),o=r.getCurrentConfig(e)||t.store;return l.length&&(t.data=l),o&&r.originalModelClass===X&&delete o.modelClass,s.isEmpty(o)||(t.store=o),t.store&&delete t.store.data,t}}ut.initClass(),y.setVersion("grid","5.3.0"),ut._$name="GridBase";export{He as Bar,ue as CellEdit,he as CellMenu,le as CheckColumn,Q as Column,ge as ColumnDragToolbar,me as ColumnPicker,fe as ColumnReorder,pe as ColumnResize,te as ColumnStore,we as Filter,ye as FilterBar,_e as Footer,ut as GridBase,Ge as GridElementEvents,de as GridFeatureManager,$e as GridFeatures,be as GridFieldFilterPicker,Ce as GridFieldFilterPickerGroup,Ke as GridResponsive,Xe as GridSelection,et as GridState,nt as GridSubGrids,xe as Group,Ae as Header,Re as HeaderMenu,Y as Location,Me as Row,Le as RowManager,oe as RowNumberColumn,Ee as Sort,Fe as Stripe,it as SubGrid,re as WidgetColumn};
//# sourceMappingURL=GridBase.js.map
