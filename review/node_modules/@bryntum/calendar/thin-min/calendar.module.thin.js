/*!
 *
 * Bryntum Calendar 5.3.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
import{_defineProperty as e,DateHelper as t,DomSync as n,DomHelper as a,Rectangle as r,Store as i,ObjectHelper as s,InstancePlugin as o,Factoryable as l,_objectSpread2 as d,Base as c,Tooltip as u,StringHelper as h,FunctionHelper as g,DomClassList as v,EventHelper as m,Widget as p,parseAlign as y,Delayable as f,BrowserHelper as w,TemplateHelper as D,TimeZoneHelper as C,ArrayHelper as b,LocaleHelper as E,Config as S,DayTime as k,Popup as R,Scroller as x,Objects as M,Toast as T,Button as N,Collection as W,Panel as P,GlobalEvents as H,ResizeMonitor as O,Container as L,MenuItem as I,Bag as $,State as V,DynamicObject as A,ScrollManager as F,VersionHelper as _}from"./chunks/Editor.js";import{ColumnStore as B,Column as j}from"./chunks/GridBase.js";import{CrudManager as z,PackMixin as Y,Describable as q,SchedulerEventSelection as U}from"./chunks/EventSelection.js";import{TimeSpan as K,ProjectModel as G,ResourceTimeRangeModel as Z,CrudManagerView as X}from"./chunks/ProjectModel.js";import{Draggable as Q,Droppable as J,AvatarRendering as ee}from"./chunks/AvatarRendering.js";import{Hoverable as te,Minifiable as ne}from"./chunks/Minifiable.js";import{ClockTemplate as ae,RecurrenceConfirmationPopup as re,EventMenu as ie,ScheduleMenu as se,AttachToProjectMixin as oe,ProjectConsumer as le,SchedulerEventNavigation as de,CurrentConfig as ce,RecurringEvents as ue}from"./chunks/EventNavigation.js";import{RecurrenceLegend as he,EventEditor as ge,EventEdit as ve,SchedulerDatePicker as me}from"./chunks/SchedulerDatePicker.js";import{MessageDialog as pe,Month as ye,CalendarPanel as fe}from"./chunks/MessageDialog.js";import{Exporter as we,PaperFormat as De}from"./chunks/Exporter.js";import{Grid as Ce}from"./chunks/Grid.js";import{Featureable as be,Responsive as Ee,Fencible as Se}from"./chunks/Responsive.js";import"./chunks/DateColumn.js";import"./chunks/Card.js";import{GridRowModel as ke}from"./chunks/GridRowModel.js";import{ButtonGroup as Re}from"./chunks/ButtonGroup.js";class xe extends j{static get type(){return"agendacolumn"}static get defaults(){return{id:"agenda",text:"Agenda",filterable:!1,sortable:!1,editor:!1,searchable:!1,autoHeight:!1,alwaysClearCell:!1}}construct(){super.construct(...arguments),this.grid.ion({beforeResponsiveStateChange:"onBeforeGridResponsiveStateChange",thisObj:this})}defaultRenderer({cellElement:e,record:i,grid:s,size:o}){var l;const d=this,{events:c,date:u}=i,h=[];for(let e=0;e<c.length;e++){const n=c[e],a=n.endDate||t.add(n.startDate,n.duration,n.durationUnit),r=n.startDate<u,o=a>i.tomorrow,l=s.createEventDomConfig({date:i.date,isAllDay:n.allDay||o||r,eventRecord:n});l.className["b-continues-future"]=o,l.className["b-continues-past"]=r,h.push({className:{"b-cal-agenda-event-row":1},dataset:{rowId:n.id},children:[s.eventListEventTimeRenderer(n,u),l],syncOptions:{syncIdField:"rowId",releaseThreshold:0,strict:!0}})}if(null===(l=s._cellRenderer)||void 0===l||l.call(s,...arguments),e.classList[i.isNonWorking?"add":"remove"](s.nonWorkingDayCls),n.sync({domConfig:{onlyChildren:!0,children:[s.agendaEventDateRenderer(u),{className:{"b-cal-event-bar-container":1},children:h}],syncOptions:{syncIdField:"date",releaseThreshold:0,strict:!0}},targetElement:e}),e.dataset.date=i.id,!d.autoHeight){const t=e.querySelector(".b-cal-agenda-date"),n=null!=d._cellTbPadding?d._cellTbPadding:d._cellTbPadding=a.getEdgeSize(e,"padding","tb").height,l=null!=d._containerPadding?d._containerPadding:d._containerPadding=a.getEdgeSize(e.querySelector(".b-cal-event-bar-container"),"margin","tb").height,c=null!=d._dateBlockHeight?d._dateBlockHeight:d._dateBlockHeight=r.outer(t).height;o.height=Math.max(i.events.length*(s.eventHeightInPixels+s.eventRowSpacing)-s.eventRowSpacing+n+l+("small"===s.responsiveState?c:0),86)}}onBeforeGridResponsiveStateChange(){this._cellTbPadding=this._containerPadding=this._dateBlockHeight=this._dateBlockHeight=null}getCellClass(e){const t=super.getCellClass(e);return t["b-sticky-cell"]=t[`b-day-of-week-${e.record.day}`]=1,t}headerRenderer({headerElement:e}){e.innerHTML="",n.sync({domConfig:{className:{"b-cal-agenda-header":1,"b-grid-header":1,"b-last-leaf":1},children:[{className:{"b-cal-agenda-header-date":1},text:"Date"},{className:{"b-cal-agenda-header-time":1},text:"Time"},{className:{"b-cal-agenda-header-event":1},text:"Event"}]},targetElement:e})}}e(xe,"$name","AgendaColumn"),B.registerColumnType(xe),xe._$name="AgendaColumn";class Me extends j{static get type(){return"calendarevents"}static get defaults(){return{id:"calendarevents",text:"Event Details",filterable:!1,sortable:!1,editor:!1,searchable:!1,autoHeight:!0,alwaysClearCell:!1}}renderer({cellElement:e,record:t,grid:a}){var r,i;const s=null===(r=a.calendar)||void 0===r?void 0:r.widgetMap.resourceFilter,o=s?t.resources.filter((e=>s.selected.includes(e))):t.resources;null===(i=a._cellRenderer)||void 0===i||i.call(a,...arguments),a.showResourceAvatars=!0,n.sync({domConfig:{onlyChildren:!0,children:[{class:"b-cal-event-resource-avatars",children:o.map((e=>({class:"b-cal-event-resource-avatar-row",children:[a.getResourceAvatar(e),{class:"b-cal-event-resource-avatar-desc",children:[{class:"b-event-column-resource-name",text:e.name},{class:"b-event-column-resource-role",text:e.role}]}]})))},{class:"b-cal-event-column-event-desc",children:[{class:"b-cal-event-column-event-name",text:t.name}]},{class:"b-cal-event-column-times",children:[a.eventListEventTimeRenderer(t)]}],syncOptions:{syncIdField:"date",releaseThreshold:0,strict:!0}},targetElement:e})}}B.registerColumnType(Me),Me.exposeProperties(),Me._$name="EventColumn";class Te extends K{afterConstruct(){this.endDate||(this.endDate=this.startDate)}}e(Te,"fields",[{name:"alignment",defaultValue:"start",internal:!0},{name:"color",internal:!0},{name:"footer",internal:!0},{name:"rotation",internal:!0}]),Te._$name="TimeRangeModel";class Ne extends i{}e(Ne,"$name","TimeRangeStore"),e(Ne,"defaultConfig",{modelClass:Te}),Ne.initClass(),Ne._$name="TimeRangeStore";class We extends G{}e(We,"$name","ProjectModel"),e(We,"configurable",{timeRangeStore:{modelClass:Te}}),e(We,"defaultConfig",{timeRangeModelClass:Te,timeRangeStoreClass:Ne}),We.applyConfigs=!0,We.initClass(),We._$name="ProjectModel";class Pe extends z{buildProjectConfig(){const e=super.buildProjectConfig(),{timeRangeStore:t}=this;return t&&(e.timeRangeStore=t),e}get timeRangeStore(){return super.timeRangeStore}set timeRangeStore(e){var t;e&&s.isObject(e)&&(e=s.assign({modelClass:this.timeRangeClass},e)),this.setFeaturedStore("_timeRangeStore",e,null===(t=this.project)||void 0===t?void 0:t.timeRangeStoreClass)}}e(Pe,"$name","CrudManager"),e(Pe,"configurable",{projectClass:We,timeRangeClass:Te}),Pe.initClass(),Pe._$name="CrudManager";class He extends(o.mixin(l)){static get factoryable(){return{}}static get configurable(){return{clientListeners:{paint:"onCalendarPaint"},disableOnReadOnly:null,zoneTypes:null}}getViewZoneType(e){const{zoneTypes:t}=this;let n;return t&&void 0===(n=t[e.type])&&(e.isWeekView&&void 0!==t.week?n=t.week:e.isDayView?n=t.day:e.isMonthView?n=t.month:e.isYearView?n=t.year:e.isResourceView?n=t.resource:e.isAgendaView&&(n=t.agenda)),n}updateDisableOnReadOnly(e){const t=this,{client:n}=t,a="readonlyToggle",r="onClientReadOnlyToggle";e?(t[r]({readOnly:n.readOnly}),n.ion({name:a,readOnly:r,thisObj:t})):t.detachListeners(a)}doDestroy(){this.syncModes(),super.doDestroy()}createZone(e,t){return new e(d({owner:this},t))}onClientReadOnlyToggle({readOnly:e}){this.disabled=e}updateDisabled(e,t){super.updateDisabled(e,t),this.client.isPainted&&this.syncModes()}onCalendarPaint({firstPaint:e}){e&&this.syncModes()}syncModes(){const e=this,{client:t,_modeDetacher:n,zones:a}=e;let r,i,o,l,d,c=null;if(e.disabled||e.isDestroying||!e.zoneTypes)null==n||n();else for(i in t.isCalendar?(n||(e._modeDetacher=t.ion({addMode:()=>e.syncModes()})),r=t.modes):r={view:t},r){var u;if(d=null==a?void 0:a[i],o=r[i],l=e.getViewZoneType(o),l)(s.isObject(d)?d.type:null===(u=d)||void 0===u?void 0:u.constructor)===l?delete a[i]:d=o.isPainted?e.createZone(l,{view:o}):e.whenPainted(i,o,l),(c||(c={}))[i]=d}if(e.zones=c,a)for(i in a)a[i].destroy()}whenPainted(e,t,n){const a=this,r={type:n,destroy:t.ion({once:!0,prio:1e4,paint(){a.zones[e]===r&&(a.zones[e]=a.createZone(n,{view:t}))}})};return r}}He._$name="CalendarFeature";class Oe extends c{updateView(e){const t=this,n=e&&t.viewListeners;t.detachListeners("viewListeners"),n&&(null==e||e.ion(s.merge({thisObj:t,name:"viewListeners"},n)))}}e(Oe,"$name","CalendarZone"),e(Oe,"configurable",{owner:null,view:{$config:"nullify",value:null},viewListeners:null}),Oe.initClass(),Oe._$name="CalendarZone";const Le=e=>e.eventStore;class Ie extends u{constructor(...t){super(...t),e(this,"clockTemplate",new ae({}))}static get $name(){return"EventTip"}static get type(){return"eventtip"}static get configurable(){return{align:{monitorResize:!0},dateFormat:"ll",eventRecord:{$config:"nullify",value:null},recurrenceHint:"",timeFormat:"LST",axisLock:"flexible",closable:null,forSelector:".b-cal-event-wrap",maxWidth:"30em",minWidth:"14em",scrollAction:"realign",cls:{"b-sch-event-tooltip":1},tools:{edit:{cls:"b-icon-edit",handler:"up.onEditClick",tooltip:"L{EventEdit.Edit event}",weight:100},delete:{cls:"b-icon-trash",handler:"up.onDeleteClick",tooltip:"L{SchedulerBase.Delete event}",weight:0},maximize:null},titleRenderer:e=>h.encodeHtml(e.name),extendAllDayEndDay:null,activeClient:null}}static get delayable(){return{refreshContent:20}}get owner(){return u.fromElement(this.activeTarget)||this.ownerFeature.client}onEditClick(){this.trigger("edit")}onDeleteClick(){this.trigger("delete")}getHtml(e){const t=this,{eventRecord:n}=t;if(n)return e.eventRecord=n,t.title=t.titleRenderer?t.callback(t.titleRenderer,t,[n]):"",t.callback(t.renderer||t.internalRenderer,t,[d(d({},e),{},{eventRecord:n})])}internalRenderer({eventRecord:e}){const{clockTemplate:n,dateFormat:a,recurrenceHint:r,timeFormat:i}=this,{allDay:s,endDate:o,startDate:l,recurrence:d}=e,c=s?this.extendAllDayEndDay?t.ceil(o,"1 day"):t.add(o,-1,"day"):o,u=t.clearTime(l),h=t.clearTime(c),g=u<h,v=!s&&u<l||h<c?g?`${a} ${i}`:i:a,m=d?he.getLegend(d):r,p=t.formatDelta(t.diff(l,o),s?{precision:"d"}:null),y=e.isMilestone||s&&!g;return n.mode=g?"day":"hour",n.template({date:l,text:t.format(l,v),cls:"b-sch-tooltip-startdate"})+(y?"":n.template({date:c,text:t.format(c,v),cls:"b-sch-tooltip-enddate"}))+(e.isMilestone?"":`<div class="b-cal-tooltip-duration b-icon b-icon-duration">${p}</div>`)+(m?`<div class="b-cal-tooltip-recurrence b-icon b-icon-recurring">${m}</div>`:"")}showByEvent(e,t=e.target){const n=this;return n.activeTarget=t,n.pointerEvent=e,n.updateContent(),"contextmenu"===e.type?n.showBy({position:{x:e.clientX,y:e.clientY},anchor:!1}):n.showBy(t)}afterShowByTarget(){var e;const{delete:t}=this.tools;this.activeClient=null===(e=u.fromElement(this.activeTarget))||void 0===e?void 0:e.closest(Le),super.afterShowByTarget(),t&&(t.disabled=this.ownerFeature.client.readOnly)}afterHide(){super.afterHide(...arguments),this.activeClient=null}updateActiveTarget(e,t){super.updateActiveTarget(...arguments),null==t||t.classList.remove("b-cal-event-reveal"),null!=e&&e.classList.contains("b-cal-in-cluster")&&e.classList.add("b-cal-event-reveal")}refreshContent(){this.updateContent()}updateEventRecord(e){var t;const n=this;null===(t=n._changeHook)||void 0===t||t.call(n),n._changeHook=e&&g.after(e,"afterChange",n.refreshContent,n),e&&(n.tools.delete&&(n.tools.delete.hidden=e.readOnly),n.tools.edit&&(n.tools.edit.hidden=e.readOnly),n.updateContent())}updateContent(){const{clockTemplate:e,element:t,eventRecord:n}=this,a=super.updateContent(),r=t.querySelector(".b-sch-tooltip-startdate"),i=t.querySelector(".b-sch-tooltip-enddate"),{edit:s,delete:o}=this.tools,{client:l}=this.ownerFeature,{eventEdit:d}=l.features,c=l.readOnly||n.readOnly;return r&&e.updateDateIndicator(r,n.startDate),i&&e.updateDateIndicator(i,n.endDate),s&&(s.hidden=c||!(null!=d&&d.enabled)),o&&(o.hidden=c),a}updateActiveClient(e){this.detachListeners("clientOverflowChange"),e&&e.ion({name:"clientOverflowChange",eventsPerCellChange:"onClientOverflowChange",thisObj:this})}onClientOverflowChange(){a.isVisible(this.lastAlignSpec.target)||this.hide()}onDocumentMouseDown({event:e}){if(e.button||"click"!==this.ownerFeature.showOn||!this.activeTarget.contains(e.target))return super.onDocumentMouseDown(...arguments)}}Ie.initClass(),Ie._$name="EventTip";const $e=/^b-hover-(top|right|bottom|left)$/,Ve=Symbol("eventDragMode"),Ae=(e,t)=>{let n;return"b-cal-event-body"===e.className?e.children.push(n=t):Array.isArray(e.children)&&e.children.forEach((e=>{!n&&e&&(n=Ae(e,t))})),n},Fe=e=>Object.freeze({type:e,create:!1,move:!1,resize:!1,[e]:!0}),_e={create:{finisher:"finishDropCreate",mode:Fe("create"),validatorFn:"validateCreateFn"},move:{finisher:"finishDropMove",mode:Fe("move"),validatorFn:"validateMoveFn"},resize:{finisher:"finishDropResize",mode:Fe("resize"),validatorFn:"validateResizeFn"}},Be={calendarrow:!0,monthview:!0};class je extends(Oe.mixin(Q,J,te)){static get $name(){return"Zone"}static get configurable(){return{droppableSelector:"*",droppable:!0,hoverable:null,hoverAnimationCls:"b-hover-anim",days:{$config:{equal:"array"},value:null},dragProxy:{type:"tip",tooltip:null},eventRecord:null,hit:null,dragItemSelector:".b-cal-event-wrap",overflow:{$config:"nullify",value:null},rootElement:null}}get dayTime(){var e;return null===(e=this.view)||void 0===e?void 0:e.dayTime}clearTime(e){return this.dayTime.startOfDay(e)}findRootElement(e){return e.contentElement}getDateFromPosition(e,t){return this.view.getDateFromPosition(e,t)}get dragEventer(){return this.owner}beforeDrag(e){const t=this,{owner:n}=t,a=t.hitTest(e),r=null==a?void 0:a.eventRecord,i=t.view.rtl?"right":"left";if(!a||null!=r&&r.readOnly||null!=r&&r.isCreating)return!1;let s,o;switch(a.date&&e.set("date",a.date),a.type){case"event":e.set("eventRecord",r),e.set("eventSourceHit",a),e.set("eventInset",a.eventElement.style[i]),e.set("eventWidth",a.eventElement.offsetWidth),s="move",o=!n.draggable||!r.isDraggable,o||t.captureDragOffset(r,a,e);break;case"resize":e.set("eventRecord",r),e.set("eventSourceHit",a),e.set("eventInset",a.eventWrap.style[i]),e.set("eventWidth",a.eventWrap.offsetWidth),s="resize",o=!n.resizable||!r.resizable;break;case"schedule":case"dayNumber":e.set("eventCreate",a),s="create",o=!n.creatable;break;default:return!1}if(o)return!1;e.set("eventDragMode",e[Ve]=_e[s].mode)}dragStart(){var e;const t=this,{dragging:n,owner:a,view:r}=t,{client:i}=a,s=()=>{n.lastMoveEvent&&n.move(n.lastMoveEvent)},o={scrollables:i.scrollManager?[{element:i.viewContainer.element,callback:s}]:[]};var l;((t.isResizing||t.isMoving)&&(t.refocus=a.client.captureFocus()),t.isResizing)&&(null===(l=n.itemElement)||void 0===l||l.classList.add("b-resizing"));r.scrollable&&o.scrollables.push({element:r.scrollable.element,callback:s}),r.horizontalScroller&&o.scrollables.push({element:r.horizontalScroller.element,callback:s}),null===(e=i.scrollManager)||void 0===e||e.startMonitoring(o)}captureDragOffset(){}cleanupDrag(){var e;const t=this,{dragProxy:n,dragging:a}=t,{tooltip:r}=n,i=t.view.isOverflowPopup?t.view.owner:t.view;null==a||null===(e=a.itemElement)||void 0===e||e.classList.remove("b-resizing"),i.ion({refresh(){var e;null===(e=t.refocus)||void 0===e||e.call(t,!1,!0),t.refocus=null},once:!0}),t.days=null,r&&(r.hide(),n.tooltip=null)}dragEnd(){var e,t;null===(e=this.owner.client)||void 0===e||null===(t=e.scrollManager)||void 0===t||t.stopMonitoring(),this.cleanupDrag()}makeDays(e,n){const{dayTime:a,startDate:r,endDate:i}=this.view,s=[];e=t.constrain(e,r,i),n=t.constrain(n,r,i);let o=a.startOfDay(e);for(const e=a.ceil(n);o<e;o=t.add(o,1,"day"))s.push(a.dateKey(o));return s}onShowOverflowPopup({overflowPopup:e}){this.overflow||(this.overflow=new Ke({owner:this.owner,view:e}))}get calendarCellSelector(){const{hideNonWorkingDays:e}=this.view;return`${this.view.visibleCellSelector}${e?":not(.b-nonworking-day)":""}`}get calendarCells(){const e=this.dropRootElement;return e&&a.children(e,this.calendarCellSelector)}get isCreating(){var e,t;return null===(e=this.dropping)||void 0===e||null===(t=e[Ve])||void 0===t?void 0:t.create}get isMoving(){var e,t,n;const a=(null===(e=this.dropping)||void 0===e?void 0:e[Ve])||(null===(t=this.dragging)||void 0===t?void 0:t[Ve]);return a?a.move:Boolean(null===(n=this.dropping)||void 0===n?void 0:n.peek("eventRecord"))}get isResizing(){var e,t;return null===(e=this.dragging)||void 0===e||null===(t=e[Ve])||void 0===t?void 0:t.resize}get recurrable(){return this.isDayZone||this.isMonthZone}cleanupDrop(){this.eventRecord=this.eventDom=this.days=null,this.noTip=!1}createEvent(e){var t;const n=(null===(t=this.dropping)||void 0===t?void 0:t[Ve])||_e.create;this.setupEvent(e,n.create)}async dragDrop(e){if(this.isResizing||e.target===this)return e.finalizer=this.finishDrop(e)}dragEnter(e){const t=this,n=e[Ve];if(t.isMoving)t.startMove(e.peek("eventRecord"));else{if(!n||e.source!==t)return!1;if(n.resize)t.startResize(e.peek("eventSourceHit"));else{if(!n.create)return!1;t.startCreate(e.peek("date"),e.peek("eventCreate"))}}}dragLeave(){this.isResizing||this.cleanupDrop()}dragMove(e){this.hit=this.pickDropTarget(e)}dropHitMove(e,n,a){const r=this,{endDate:i,startDate:s}=a.isScheduled?a:r.eventRecord,o=t.diff(s,i,"s");let{date:l}=n;l=r.clearTime(l),a.allDay||(l=t.add(l,t.diff(r.clearTime(s),s,"s"),"s")),l=r.applyDragOffset(l,e),r.setEventData({startDate:l,endDate:t.add(l,o,"s")})}dropHitNowhere(){this.days=null}dropHitResize(e,n,a){const r=this,{eventRecord:i}=r,{startDate:s,endDate:o}=i,l=r.clearTime(n.date);let d,c;a.atEnd?(c=t.add(l,1,"d"),d={startDate:s,endDate:s<c?c:t.add(s,1,"d")}):d={startDate:l<o?l:t.add(o,-1,"d"),endDate:o},d.duration=t.diff(d.startDate,d.endDate,i.durationUnit),r.setEventData(d)}async finishDrop(e){const t=this,{eventRecord:n,owner:a,view:r}=t,{eventStore:i}=r,s=e[Ve],o=_e[(null==s?void 0:s.type)||"move"];if(o&&t.hit){const r=!o.validatorFn||await a.callback(a[o.validatorFn],a,[{drag:e,eventRecord:n,event:e.event}]);!1!==r&&await t[o.finisher](e,a,n,i,r,(async i=>{let s={drag:e,eventRecord:n,validation:r,event:e.event,feature:a,view:e[t.isResizing?"source":"target"].view};return!1===await a.client.trigger("before"+h.capitalize(i),s)?s=!1:a.client.trigger(i,s),s}))}t.cleanupDrop()}async finishDropCreate(e,t,n,a,r,i){const s=!1!==(null==r?void 0:r.add);!1===await i("dragCreateEnd")?s&&a.remove(n):s&&!a.includes(n)&&a.add(n)}async finishDropMove(e,n,a,r,i,s){let o=await e.get("eventRecord");const l=this,{view:d}=l,c=o.isOccurrence?o.recurringTimeSpan:o,{source:u}=e,h=u!==l,g=h&&u.resource!==l.resource;if(!g&&e.source===e.target&&t.isEqual(a.startDate,o.startDate)&&t.isEqual(a.endDate,o.endDate)&&o.eventStore===r)return;if(!1!==await s("dragMoveEnd"))if(r.getByInternalId(c.internalId)){var v;if(o=await l.finishDropConfirm(o),o)if(await l.moveEventTo(e,o),g&&(o.assign(l.resource),o.unassign(u.resource)),h&&l.owner.client.activeView.eachView)d.refresh(),null===(v=d.getEventElement(o,o.startDate))||void 0===v||v.focus()}else{var m,p;const t=await e.get("sourceStore");t?(t.remove(o),await l.moveEventTo(e,o)):o=a;const n=null!==(m=null!==(p=o.resourceId)&&void 0!==p?p:l.resource)&&void 0!==m?m:this.owner.client.defaultCalendarId;delete o.resourceId,r.add(o),o.assign(g?l.resource:n)}}async finishDropResize(e,n,a,r,i,s){if(!1===await s("dragResizeEnd"))return;let{eventRecord:o}=await e.get("eventSourceHit");o=await this.finishDropConfirm(o),o&&o.set({startDate:a.startDate,endDate:a.endDate,duration:t.diff(a.startDate,a.endDate,o.durationUnit)})}async finishDropConfirm(e){return e.isOccurrence||e.isRecurring?new Promise((t=>{new re({owner:this.owner}).confirm({actionType:"update",eventRecord:e,cancelFn(){t(null)},changerFn(e){t(e)}})})):e}async moveEventTo(e,n){const a=this;let r=a.view.getDateFromElement(e.targetElement);if(n.startDate&&(r=t.copyTimeValues(a.clearTime(r),n.startDate)),r=a.applyDragOffset(r,e),!a.view.eventStore.getByInternalId(n.internalId)&&!n.startDate){const t=e.target.view.autoCreate||a.owner.client.autoCreate;r.setHours((null==t?void 0:t.startHour)||8)}await a.setStartDate(n,r)}pickDropTarget(e){var t;const n=this;let a=n.hitTest(e);return!a&&n.isResizing&&(a=n.hit),null!==(t=a)&&void 0!==t&&t.date?a:null}setStartDate(e,n){return e.set({startDate:n,endDate:t.add(n,this.eventRecord.duration,this.eventRecord.durationUnit)})}getHoverHandleCls(e){return e?"":"b-gripper-vert"}hoverEnter(){var e,t;const n=this,a=n.hitTest(n.hoverTarget),{gripper:r}=n.owner,i=n.getHoverHandleCls(),s=n.getHoverHandleCls(!0);s&&r.classList.remove(s),!1===(null==a||null===(e=a.eventRecord)||void 0===e?void 0:e.resizable)||null!=a&&null!==(t=a.eventRecord)&&void 0!==t&&t.readOnly||(i&&r.classList.add(i),n.hoverTarget.appendChild(r))}hoverLeave(e){const{gripper:t}=this.owner,n=this.getHoverHandleCls();t.parentNode===e&&(n&&t.classList.remove(n),e.removeChild(t))}applyDragOffset(e,n){const a=n.peek("eventOffset");var r;e&&null!=a&&a[0]&&(n.source.constructor===(null===(r=n.target)||void 0===r?void 0:r.constructor)&&(e=t.add(e,-a[0],a[1])));return e}hitTest(e){const t=this,n=null==e?void 0:e.isDragContext,r=n?e.event:e,i=n&&e.targetElement||a.getEventElement(r);let s,o,l=t.view,d=null;if(i){l.calendarHitTest||(l=t.owner.client);const e=l.rtl?"right":"left";d=l.calendarHitTest(i),d&&(d.eventWrap=o=i.closest(".b-cal-event-wrap"),i.classList.contains("b-gripper")?(d={type:"resize",cell:d.cell,date:d.date,edge:s={},eventRecord:d.eventRecord,eventWrap:o,gripper:i,view:d.view},v.normalize(o.className,"array").forEach((e=>{(e=$e.exec(e))&&(s[e[1]]=!0)})),d.atEnd=!(s.top||s[e])):d.eventRecord||(o=null),o&&(d.eventTop=o.style.top),i!==r&&(d.date=t.getDateFromPosition(r.clientX,r.clientY)||d.date))}return d}renderEvent(e,n,a){const{view:r}=this;Object.defineProperty(e,"resource",{configurable:!0,get:()=>r.defaultCalendar});const i=r.createEventDomConfig({eventRecord:e,isAllDay:Be[r.type]});if(i.className["b-cal-tentative-event"]=1,i.className["b-cal-tentative-event-first"]=n,i.className["b-cal-tentative-event-last"]=a,delete e.resource,a){const{footer:n}=this.owner;n&&Ae(i,s.assign({html:t.format(e.endDate,r.timeFormat)},n))}return i}setEventData(e,n){const a=this,{eventRecord:r,view:i}=a,{duration:s,startDate:o}=e;if(o&&null!=s&&!e.endDate&&(e=d(d({},e),{},{endDate:t.add(o,s,r.durationUnit)})),r.set(e),a.eventDom)a.eventDom.className[i.shortEventCls]=r.durationMS<=i.shortEventDuration;else{if(n){let{newName:e}=a.owner;"function"==typeof e&&(e=e(r)),r.set("name",e)}a.eventDom=a.renderEvent(r)}}setupEvent(e,t){var n;const a=this,{owner:r}=a,{defaultCalendar:i,eventStore:s}=a.view,{tooltip:o}=r,l=a.eventRecord=r.eventRecord=s.createRecord({}),d=t?new Set([new s.assignmentStore.modelClass({event:l,resource:i})]):e.assigned;Object.defineProperty(l,"assigned",{configurable:!0,get:()=>d}),a.setEventData(e,t),delete l.assigned,a.isCreating&&i&&s.assignmentStore.assignEventToResource(l,i);const{eventDom:c}=a;return c.className["b-cal-tentative-event"]=1,a.noTip||o.disabled||null===(n=a.dragging)||void 0===n||!n.has("eventCreate")||(o.eventRecord=l,o.recurrenceHint=t&&a.recurrable?r.recurrenceTip:"",a.dragProxy.tooltip=o),c}startCreate(e){this.createEvent({allDay:!0,startDate:e,endDate:t.add(e,1,"d")})}startMove(e){var n;const a=this,r=s.clone(e.data),i=null===(n=e.resource)||void 0===n?void 0:n.eventColor;if(!r.eventColor&&i&&(r.eventColor=i),r.assigned=e.assigned,!r.startDate){const n=a.pickDropTarget(a.dropping);r.startDate=(null==n?void 0:n.date)||new Date,r.endDate=t.add(r.startDate,e.duration||1,e.durationUnit||"h")}var o;r.resourceId||(r.resourceId=a.dropping.peek("resourceId")||(null===(o=a.owner.client)||void 0===o?void 0:o.defaultCalendarId));delete r.id,a.setupEvent(r)}startResize(e){var t;const{eventRecord:n}=e,a=n.data;this.createEvent(d(d({},a),{},{id:`dragResize-event-${a.id}`,eventColor:a.eventColor||(null===(t=n.resource)||void 0===t?void 0:t.eventColor),recurrenceRule:null,realEventId:a.id}))}configureListeners(e){const t=super.configureListeners(e);return t.element=this.view.rootElement,t}updateHit(e){const t=this,n=t.dropping,a=e&&n[Ve];e?t.isMoving?t.dropHitMove(n,e,n.peek("eventRecord")):null!=a&&a.create?t.dropHitCreate(n,e,n.peek("eventCreate")):null!=a&&a.resize&&t.dropHitResize(n,e,n.peek("eventSourceHit")):t.dropHitNowhere(n)}updateDays(e){const t=this,{calendarCells:n,eventDom:a,dayValues:r}=t,i=n&&{};let s,o,l,d,c,u=!0;if(t.dayValues=i,n&&a){for(d=0;d<n.length;++d)s=n[d],null!=e&&e.includes(s.dataset.date)&&(c=s);for(d=0;d<n.length;++d)s=n[d],o=s.dataset.date,null!=e&&e.includes(o)&&((l=null==r?void 0:r[o])?delete r[o]:(l=t.includeDay(o,s,u,s===c)||!0,u=!1),i[o]=l);if(r)for(d in r)t.removeDay(d,r[d])}}updateEventRecord(e){this.owner.eventRecord=e}updateOverflow(e,t){return!e&&t&&t.destroy(),e}updateOwner(e){this.hoverIgnoreElement=null==e?void 0:e.gripper}updateRootElement(e){const t=this;t.dragRootElement=e,t.dropRootElement=t.droppable?e:null,t.hoverRootElement=t.hoverable?e:null}updateView(e,t){var n;super.updateView(e,t);const a=this;a.rootElement=e?a.findRootElement(e):null,null===(n=a._overflowDetacher)||void 0===n||n.call(a),null!=e&&e.isDayCellRenderer&&(a._overflowDetacher=e.ion({thisObj:a,showOverflowPopup:"onShowOverflowPopup"}))}}je.prototype._eventRecord=null;class ze extends je{static get $name(){return"BaseDayZone"}static get configurable(){return{hoverSelector:".b-cal-event-wrap",draggingClsSelector:".b-dayview-content"}}getHoverHandleCls(e){let t=this.isAllDayZone;return e&&(t=!t),"b-gripper-"+(t?"vert":"horz")}}class Ye extends ze{static get $name(){return"AllDayZone"}static get configurable(){return{hoverEdges:"lr"}}beforeDrag(e){const t=super.beforeDrag(e);return!(!1!==t&&!this.draggable&&e[Ve].move)&&t}dragEnter(e){return this.view.eventsPerCell||this.view.expandGutter(),super.dragEnter(e)}dragLeave(e){this.view.collapseGutter(),super.dragLeave(e)}captureDragOffset(e,n,a){a.set("eventOffset",[Math.max(Math.floor(t.diff(e.startDate,n.date,"d")),0),"d"])}dropHitCreate(e,n,a){let r=this.clearTime(n.date),i=this.clearTime(a.date);r<i&&([i,r]=[r,i]),this.setEventData({startDate:i,duration:t.diff(i,r,"d")+1,durationUnit:"d"})}async moveEventTo(e,t){const n=this,a=n.hitTest(e),r=n.applyDragOffset(null==a?void 0:a.date,e),i=new Date(t.startDate);r&&(i.setFullYear(r.getFullYear()),i.setMonth(r.getMonth()),i.setDate(r.getDate()),n.view.dayTime.startShift?(i.setHours(r.getHours()),i.setMinutes(r.getMinutes()),i.setSeconds(r.getSeconds()),t.duration=1):n.view.isAllDayEvent(t)||(t.allDay=!0),await n.setStartDate(t,i))}setEventData(e,t){super.setEventData(e,t);const n=this,{eventRecord:a}=n,{startDate:r,endDate:i}=a;t&&!n.view.dayTime.startShift&&(a.allDay=!0),n.days=n.makeDays(r,i)}updateDays(e){const t=this;let{eventEl:n}=t;if(null!=e&&e.length){var r,i;n||(t.eventEl=n=a.createElement(d({},t.eventDom)),n.classList.add("b-allday"));const{dropRootElement:s}=t,{hideNonWorkingDays:o,visibleCellSelector:l,weekLength:c}=t.view,u=null===(r=t.dragging)||void 0===r||null===(i=r.peek("eventSourceHit"))||void 0===i?void 0:i.eventTop,h=a.children(s,`${l}${o?":not(.b-nonworking-day)":""}`),g=a.down(s,`${l}${o?":not(.b-nonworking-day)":""}[data-date='${e[e.length-1]}']`);a.down(g,".b-cal-event-bar-container").appendChild(n),n.style[t.view.rtl?"right":"left"]=a.percentify(100*(h.indexOf(g)-e.length+1)/c),n.style.width=a.percentify(100*e.length/c),u&&(n.style.top=u),t.view.scrollable.scrollIntoView(n,!0)}else n&&(n.classList.contains("b-cal-tentative-event")&&n.remove(),t.eventEl=null)}updateView(e,n){if(e){const n=t.diff(e.startDate,e.endDate,"d")>1;this.hoverable=this.draggable=n}super.updateView(e,n)}}class qe extends ze{static get $name(){return"DayZone"}static get configurable(){return{dragEventId:null,hoverable:!0,hoverEdges:"tb",times:{$config:{equal:"array"},value:null}}}construct(...e){const t=this;super.construct(...e),t.allDayZone=new Ye({active:t.active,owner:t.owner,view:t.view.allDayEvents,resource:t.resource})}syncDraggingElements(e,t){const{dragging:n}=this,{draggingItemCls:a}=n.source,r=n.itemElement.closest(".b-dayview-day-container").querySelectorAll(`[data-event-id="${e}"]`);for(const e of r)e.classList.toggle(a,t)}updateDragEventId(e,t){t&&this.syncDraggingElements(t,!1),e&&this.syncDraggingElements(e,!0)}get eventRecord(){var e;return super.eventRecord||(null===(e=this.allDayZone)||void 0===e?void 0:e.eventRecord)}set eventRecord(e){super.eventRecord=e}get recurring(){var e;return this.isCreating&&null!=(null===(e=this.eventRecord)||void 0===e?void 0:e.recurrenceRule)}get droppingAllDay(){var e,t;const n=null===(e=this.dropping)||void 0===e?void 0:e.peek("eventRecord");return(null==n?void 0:n.startDate)&&(null===(t=this.view)||void 0===t?void 0:t.isAllDayEvent(n))||!1}get useAllDay(){return this.droppingAllDay&&this.view.showAllDayHeader&&this.dropping.source!==this.allDayZone}get wasAllDay(){return this.droppingAllDay&&this.dropping.source===this.allDayZone}doDestroy(){var e;null===(e=this.allDayZone)||void 0===e||e.destroy(),super.doDestroy()}dragStart(){var e,t;super.dragStart(),this.dragEventId=null!==(e=null===(t=this.dragging.peek("eventRecord"))||void 0===t?void 0:t.id)&&void 0!==e?e:null}findRootElement(e){return e.eventContentElement}captureDragOffset(e,n,a){a.set("eventOffset",[Math.floor(t.diff(e.startDate,n.date,"m")),"m"])}cleanupDrag(){var e;this.dragEventId=null,super.cleanupDrag(),null===(e=this.allDayZone)||void 0===e||e.cleanupDrag()}cleanupDrop(){var e,t,n;super.cleanupDrop(),null===(e=this.owner.client)||void 0===e||null===(t=e.scrollManager)||void 0===t||t.stopMonitoring(),null===(n=this.allDayZone)||void 0===n||n.cleanupDrop()}dropHitCreate(e,n){const a=this,r=e.peek("eventCreate");let i,s,o=n.date,l=r.date,d=o,c=l;const u=!(a.clearTime(l)-a.clearTime(o)),h=e.ctrlKey&&!u;h||u?(d=a.clearTime(o),c=a.clearTime(l),l-=c,o-=d,d<c&&([c,d]=[d,c]),o<l&&([l,o]=[o,l]),c.setTime(c.getTime()+l),i=Math.max(a.view.increment,Math.floor(o-l))/6e4,h&&(s=t.diff(a.clearTime(c),a.clearTime(d),"d")+1)):(d<c&&([c,d]=[d,c]),i=Math.floor((d-c)/6e4)),a.setEventData({startDate:c,duration:i,recurrenceRule:h?`FREQ=DAILY;COUNT=${s}`:null})}dropHitMove(e,n,a){let r=n.date;const i=this,{view:s}=i,o=s.dayTime.startOfDay(r);i.useAllDay?i.allDayZone.dropHitMove(e,n,a):(a=i.eventRecord,r=i.applyDragOffset(r,e),s.showAllDayHeader&&r<o&&(r=o),i.setEventData({startDate:r,endDate:t.add(r,a.duration,a.durationUnit),duration:a.duration}))}dropHitResize(e,t,n){const a=this,{eventRecord:r}=a,i=t.date;n.atEnd?r.startDate<i&&a.setEventData({endDate:i}):i<r.endDate&&a.setEventData({startDate:i})}async moveEventTo(e,t){const n=this,a=n.hitTest(e),r=null==a?void 0:a.date;r&&(n.useAllDay?await n.allDayZone.moveEventTo(e,t):(n.wasAllDay&&(t.allDay=!1),await n.setStartDate(t,n.applyDragOffset(r,e))))}startCreate(e){this.createEvent({duration:0,durationUnit:"m",startDate:e})}includeDay(e,t,n,r){return a.createElement(d({parent:t.querySelector(".b-dayview-event-container")},this.renderEvent(this.eventRecord,n,r)))}removeDay(e,t){t.classList.contains("b-cal-tentative-event")&&t.remove()}setEventData(e,n){const a=this;if(a.useAllDay)return void a.allDayZone.setEventData(e,n);super.setEventData(e,n);const{eventRecord:r}=a,{endDate:i,startDate:s}=r,{dayTime:o}=a.view;let l=i;a.recurring&&(l=t.add(l,r.recurrence.count-1,"d")),a.days=a.makeDays(s,l),a.times=[o.delta(s,"s"),o.delta(i,"s")]}setupEvent(e,n){const a=this;a.useAllDay?a.allDayZone.setupEvent(e,n):(this.wasAllDay&&(e.allDay=!1,e.endDate=t.add(e.startDate,e.duration=1,e.durationUnit="hour")),super.setupEvent(e,n))}updateDays(e,t){super.updateDays(e,t),this.updateTimes(this.times,null)}updateTimes(e){if(!e)return;const r=this,{allDayZone:i,dayValues:s,dragging:o,eventRecord:l,recurring:d,view:c}=r,{dayTime:u,eventSpacing:h}=c,g=c.rtl?"right":"left",{endDate:v,startDate:m}=l,[p,y]=e,f=!(null!=o&&o.aborted)&&(null==o?void 0:o.peek("eventInset")),w=!(null!=o&&o.aborted)&&(null==o?void 0:o.peek("eventWidth")),D=u.dateKey(m),C=u.dateKey(v),b=u.startOfDay(m)<u.startOfDay(v),E=100/u.duration("s");let S,k,R,x,M,{days:T}=r;if(T){for(S in s)k=S===D,x=s[S].style,M=p*E,R=(y-p)*E,n.sync({targetElement:s[S],domConfig:r.renderEvent(r.eventRecord,k,S===T[T.length-1])}),!d&&b&&(R=k?100-M:S===C?M+R:100),x.top=d||k?a.percentify(M):0,x.height=a.percentify(R),x.paddingBottom=a.setLength(h),f&&(x[g]=f),w&&(x.width=`${w}px`);!T||T.length<2||d?(null==i||i.cleanupDrop(),T=null):i&&c.showAllDayHeader&&(i.eventRecord||(i.noTip=!0,i.createEvent({startDate:l.startDate,endDate:l.endDate})),i.eventRecord.set({startDate:l.startDate,endDate:t.add(l.startDate,T.length-1,"d")}),i.days=T)}}}class Ue extends je{static get $name(){return"MonthZone"}static get configurable(){return{coverage:{$config:{equal:s.isEqual},value:null},hoverable:!0,hoverEdges:"lr",hoverSelector:".b-cal-event-wrap.b-allday"}}findRootElement(e){return e.weeksElement}captureDragOffset(e,n,a){a.set("eventOffset",[Math.floor(t.diff(this.clearTime(e.startDate),n.date,"d")),"d"])}cleanupDrag(){super.cleanupDrag(),this.coverage=null}cleanupDrop(){var e,t;super.cleanupDrop(),null===(e=this.owner.client)||void 0===e||null===(t=e.scrollManager)||void 0===t||t.stopMonitoring(),this.coverage=null}dropHitCreate(e,n){const a=this,r=e.ctrlKey,i=e.peek("eventCreate");let s,o,l,d,c,u,h,g=null;d=a.clearTime(n.date),c=a.clearTime(i.date),o=i.dayNumber,l=n.dayNumber,u=i.weekOffset,h=n.weekOffset,h<u&&([u,h]=[h,u]),r?(s=h-u+1,g=s>1?`FREQ=WEEKLY;COUNT=${s}`:null,d<c?(c=d,o<l&&(c=t.add(c,o-l,"d"))):l<o&&(c=t.add(c,l-o,"d")),l<o&&([o,l]=[l,o])):d<c&&([c,d]=[d,c],[o,l]=[l,o]),a.setEventData({startDate:c,duration:(r?l-o:t.diff(c,d,"d"))+1,durationUnit:"d",recurrenceRule:g})}dropHitNowhere(e){super.dropHitNowhere(e),this.coverage=null}setEventData(e,n){super.setEventData(e,n);const{dropping:r,eventRecord:i,view:s}=this,{visibleCellSelector:o,hideNonWorkingDays:l}=s,d=a.children(s.weeksElement,"> .b-calendar-week"),c={},u=e=>{const{startDate:n,endDate:r}=e;for(let e,i,u,h,g=0;g<d.length;++g){for(e=a.children(d[g],`${o}${l?":not(.b-nonworking-day)":""}`),h=e.length,i="",u=0;u<h;++u){const a=s.getDateFromElement(e[u]),o=t.add(a,1,"d");n<o&&a<r&&(!u&&n<a&&(i="<"),i+=u,u===h-1&&o<r&&(i+=">"))}i&&(c[g]||(c[g]=[])).push(i)}};null!=r&&r.has("eventRecord")||!i.recurrence?u(i):i.recurrence.forEachOccurrence(s.startDate,s.endDate,u),this.coverage=c}updateCoverage(e){const t=this,{dragging:n,weekValues:r,view:i}=t,{rtl:s}=i,{visibleCellSelector:o,hideNonWorkingDays:l}=i,d=e&&(null==n?void 0:n.peek("eventSourceHit")),c=null==d?void 0:d.eventTop,u={},h=i.getWeekElementFor(null==d?void 0:d.eventElement),{weekElements:g}=i;let v,m,p,y,f,w,D,C,b,E,S;for(t.weekValues=u,b=0;b<g.length;++b)if(y=null==e?void 0:e[b])for(S=g[b],m=a.children(S,`${o}${l?":not(.b-nonworking-day)":""}`),E=0;E<y.length;++E){var k;(w=null==r||null===(k=r[b])||void 0===k?void 0:k.shift())||(w=a.createElement(t.eventDom)),(u[b]||(u[b]=[])).push(w),p=y[E],D=p.includes("<")?1:0,C=p.includes(">")?1:0,p=p.substr(D,p.length-C-D),w.classList[D?"add":"remove"]("b-continues-past"),w.classList[C?"add":"remove"]("b-continues-future"),w.style[s?"right":"left"]=a.percentify(100*Number(p[0])/m.length),w.style.width=a.percentify(100*p.length/m.length),c&&S===h&&(w.style.top=c),v=m[Number(p[p.length-1])],f=a.down(v,".b-cal-event-bar-container"),f!==w.parentNode&&f.appendChild(w)}if(r)for(b in r)r[b].forEach((e=>{e.classList.contains("b-cal-tentative-event")&&e.remove()}))}}class Ke extends je{static get $name(){return"OverflowZone"}static get configurable(){return{droppable:!1,dragProxy:{type:"default",open(e){const t=this,{owner:n}=e.source.view,a=e.element.closest(".b-cal-event-wrap");n.isYearView&&(t.proxyEl=a.cloneNode(!0),t.proxyEl.classList.add("b-cal-drag-proxy"),t.proxyEl.style.width=`${a.offsetWidth}px`,t.proxyOffset=m.getClientPoint(e.startEvent).getDelta(r.from(a)),n.contentElement.appendChild(t.proxyEl))},dragMove(e){this.proxyEl&&a.alignTo(this.proxyEl,m.getClientPoint(e.event).translate(10,10),{align:"t0-t0"})},close(){var e;null===(e=this.proxyEl)||void 0===e||e.remove()}}}}findRootElement(e){return e.contentElement}beforeDrag(e){const t=this.hitTest(e);if("event"!==(null==t?void 0:t.type)||!this.owner.draggable||!t.eventRecord.isDraggable)return!1;e.set("eventRecord",t.eventRecord),e.set("eventDragMode",e[Ve]=_e.move.mode)}dragStart(){this.view.hide()}}class Ge extends je{static get $name(){return"YearZone"}startCreate(){var e;null===(e=this.view._overflowPopup)||void 0===e||e.hide(),super.startCreate(...arguments)}dragEnter(e){const t=super.dragEnter(e);return!1!==t&&this.view.contentElement.classList.add(this.draggingCls),t}dragLeave(e){super.dragLeave(e),this.view.contentElement.classList.remove(this.draggingCls)}dropHitCreate(e,n,a){const r=this;let i=r.clearTime(n.date),s=r.clearTime(a.date);i<s&&([s,i]=[i,s]),r.setEventData({startDate:s,endDate:t.add(i,1,"d")}),r.days=r.makeDayRange(s,i)}dropHitMove(e,n,a){super.dropHitMove(e,n,a);const r=this,i=r.eventRecord;let{endDate:s}=i;i.allDay&&(s=t.add(s,-1,"d")),r.days=r.makeDayRange(i.startDate,s)}includeDay(e){const t=a.children(this.view.bodyElement,`[data-date='${e}']`);return t.forEach((e=>e.classList.add("b-cal-tentative-event"+(this.view.hideNonWorkingDays?":not(.b-nonworking-day)":"")))),t}makeDayRange(e,n){const a=[];for(let r=e;r<=n;r=t.add(r,1,"d"))a.push(t.format(r,"YYYY-MM-DD"));return a}removeDay(e,t){t.forEach((e=>e.classList.remove("b-cal-tentative-event")))}}class Ze extends c{static get configurable(){return{view:null,zones:{$config:["nullify"],value:[]}}}updateView(e){e.eachView((e=>{this.onResourceViewViewCreate({view:e})})),e.ion({viewCreate:"onResourceViewViewCreate",thisObj:this})}onResourceViewViewCreate({view:e}){const{zones:t,owner:n}=this,a=n.client.constructor.Modes,r=n.getViewZoneType(a.resolveType(e.type));r&&t.push(n.createZone(r,{view:e,resource:e.defaultCalendar}))}changeZones(e,t){if(null!=t&&t.length&&!e)for(let e=0,{length:n}=t;e<n;e++)t[e].destroy();return e}}class Xe extends He{static get $name(){return"CalendarDrag"}static get type(){return"drag"}static get configurable(){return{disableOnReadOnly:!0,localizableProperties:["newName","recurrenceTip"],creatable:!0,draggable:!0,footer:{className:"b-cal-event-footer"},gripper:{class:"b-gripper"},newName:"L{newEvent}",recurrenceTip:"(L{holdCtrlForRecurrence})",resizable:!0,tooltip:{$config:["lazy","nullify"],value:{type:"eventTip",disabled:!0,forSelector:null,tools:null}},validateCreateFn:()=>{},validateMoveFn:()=>{},validateResizeFn:()=>{},zoneTypes:{day:qe,month:Ue,year:Ge,resource:Ze}}}changeGripper(e,t){return null==t||t.remove(),e&&a.createElement(e)}changeTooltip(e,t){return e&&(e=!0===e?this.constructor.configurable.tooltip.value:e,this.initialConfig.tooltip&&(e.disabled=!1),e.ownerFeature=this),p.reconfigure(t,e,this)}}Xe.initClass(),Xe._$name="CalendarDrag";class Qe extends ge{static get $name(){return"EventEditor"}static get type(){return"calendareventeditor"}static get configurable(){return{align:{monitorResize:!0}}}updateRecord(e){this.fixTimeFieldVisibility(e.allDay),super.updateRecord(e)}onAllDayChange({value:e,userAction:t}){this.fixTimeFieldVisibility(e,t)}fixTimeFieldVisibility(e,t){const n=e?"hide":"show",a=e?"remove":"add",{startDateField:r,startTimeField:i,endDateField:s,endTimeField:o}=this.widgetMap;i&&i[n](),o&&o[n](),null==r||r.element.classList[a]("b-inline"),null==s||s.element.classList[a]("b-inline"),!e&&t&&(r&&(r.value=i.value=this.record.getData("startDate")),s&&(s.value=o.value=this.record.getData("endDate")))}onBeforeShow(){const{deleteButton:e}=this.widgetMap;super.onBeforeShow(...arguments),e&&!e.hidden&&this.record.isCreating&&e.hide()}onFocusOut(){super.onFocusOut(...arguments),this.owner=this.initialConfig.owner}}Qe.initClass(),Qe._$name="EventEditor";class Je extends ve{static get $name(){return"EventEdit"}static get type(){return"eventEdit"}static get configurable(){return{editorConfig:{type:"calendareventeditor",items:{resourceField:{label:"L{Calendar}",showEventColor:!0},allDay:{type:"checkbox",cls:"b-match-label",name:"allDay",weight:250,label:"L{All day}",internalListeners:{change:"up.onAllDayChange"}}}}}}construct(e){super.construct(e.client,e)}onDragCreateEnd({eventRecord:e}){this.editNewlyCreatedEvent(e)}onEventAutoCreated({eventRecord:e}){this.editNewlyCreatedEvent(e)}editNewlyCreatedEvent(e){if(!this.disabled)return e.isCreating=!0,this.editEvent(e)}async doEditEvent(e,n,r){var i,s,o;const l=this,{client:d}=l,{eventStore:c}=d;let u=d.eventSource||d.activeSubView,h=!1;if(u.isScheduler)return l.client=u,await super.doEditEvent(...arguments),void(l.client=d);if(!u.isCalendarMixin||null!==(i=u.features)&&void 0!==i&&null!==(s=i.cellEdit)&&void 0!==s&&s.isEditing)return;t.intersectSpans(e.startDate,e.endDate,u.startDate,u.endDate)||(d.date=e.startDate),e.isOccurrence||c.includes(e)||(h=e.isCreating=!0,await c.addAsync(e)),u.isAllDayEvent(e)&&u.allDayEvents&&u.showAllDayHeader&&(u=u.allDayEvents);const{_overflowPopup:g}=u,v=u.getDateFromElement(r);let m=null==g?void 0:g.isVisible,p=m?g.getEventElement(e):u.getEventElement(e,v);var y,f,w,D;(m&&(p?m=!1:p=g.getEventElement(e)),e.isCreating)&&(null===(y=d.onEventCreated)||void 0===y||y.call(d,e));!p&&u.isEventList&&(p=null===(f=u)||void 0===f||null===(w=f.rowManager)||void 0===w||null===(D=w.getRowFor(e))||void 0===D?void 0:D.element);const C=p&&!a.isInView(p)||!e.isCreating||!h;if(m)p.focus();else if(p){var b,E;if(C&&null!==(b=u.scrollable)&&void 0!==b&&b.hasOverflow())await(null===(E=u.scrollable)||void 0===E?void 0:E.scrollIntoView(p,{animate:!0,focus:!0}));else a.focusWithoutScrolling(p)}else{if(!u.isAllDayEvent(e)&&u.hiddenNonWorkingDays[e.startDate.getDay()])return void l.internalShowEditor(e,null,{target:!0});C?await u.scrollTo(e):await u.await("refresh",!1),p=u.getEventElement(e)}p||r||!u.isDayCellRenderer||(p=u.getCell(e.startDate)),l.internalShowEditor(e,null,{target:p||r,allowTargetOut:u.isAnimating}),null!==(o=l.editor)&&void 0!==o&&o.lastAlignSpec&&(l.editor.lastAlignSpec.allowTargetOut=!1)}async onSaveClick(){const e=this,{eventRecord:t}=e,{isCreating:n}=t.meta;e.isValid&&(t.isCreating=!1);const a=await super.onSaveClick(...arguments);var r;n&&a&&(e.eventStore.added.add(t),e.eventStore.usesSingleAssignment||e.assignmentStore.added.add(t.assignments),null!==(r=e.client.crudManager)&&void 0!==r&&r.autoSync&&e.client.crudManager.scheduleAutoSync())}internalShowEditor(){var e,t,n,a;const{client:r,startTimeField:i,endTimeField:s,editor:o}=this,l=null!==(e=null===(t=r.activeView)||void 0===t?void 0:t.autoCreate)&&void 0!==e?e:r.autoCreate||r.constructor.configurable.autoCreate,d=null==l?void 0:l.step,{activeSubView:c}=r,u=null==c?void 0:c._overflowPopup;null===(n=r.features.eventTooltip)||void 0===n||null===(a=n._tooltip)||void 0===a||a.hide(),o.owner=null!=u&&u.isVisible?u:c,!1!==super.internalShowEditor(...arguments)?d&&(i&&(i.step=d),s&&(s.step=d)):o.owner=o.initialConfig.owner}}He.register(Je.type,Je),Je._$name="EventEdit";const et=e=>e.eventStore;class tt extends ie{static get $name(){return"EventMenu"}static get type(){return"eventMenu"}populateEventMenu({items:e,eventRecord:t,assignmentRecord:n}){super.populateEventMenu(...arguments);const{client:a}=this;e.duplicate={disabled:t.readOnly||(null==n?void 0:n.readOnly),hidden:a.readOnly}}getDataFromEvent(e){const{client:t}=this,{activeView:n}=t;n.isScheduler&&(this.client=n);const a=super.getDataFromEvent(e);return this.client=t,a}changeMenu(){const e=this,t=super.changeMenu(...arguments);return null==t||t.ion({beforeShow({source:t}){const{activeSubView:n}=e.client,{_overflowPopup:a}=n;t.owner=null!=a&&a.containsFocus?a:n}}),t}changeItems(e){return(e=super.changeItems(...arguments)).unassignEvent=null,e}}e(tt,"configurable",{items:{duplicate:{text:"L{EventMenu.duplicateEvent}",icon:"b-icon b-icon-copy",weight:400,onItem({eventRecord:e}){const t=e.copy(null,{skipFieldIdentifiers:!0}),{eventStore:n}=this.up(et),{resources:a}=e;t.name=`${e.name} (${this.L("copy")})`,t.recurrence=null,null!=a&&a.length&&n.assignmentStore.assignEventToResource(t,a),n.add(t)}}}}),He.register(tt.type,tt),tt._$name="EventMenu";const nt=e=>e.eventStore,at=["activeElement","client","clientListeners","disabled","showOn","tooltip"];class rt extends He{static get $name(){return"EventTooltip"}static get type(){return"eventTooltip"}static get configurable(){return{showOn:"click",closable:!0,axisLock:"flexible",tooltip:{$config:["lazy","nullify"],value:{type:"eventTip",align:{monitorResize:!0}}},titleRenderer:e=>h.encodeHtml(e.name),renderer:null,recurrenceConfirmation:{$config:["lazy","nullify"],value:{type:"recurrenceconfirmation"}},extendAllDayEndDay:null,align:null}}static get pluginConfig(){return{chain:["render"]}}get isVisible(){return!0}changeRecurrenceConfirmation(e,t){return e&&(e.rootElement=this.owner.rootElement),p.reconfigure(t,e,{owner:this})}changeTooltip(e,t){return p.reconfigure(t,e,{owner:this,setup:"setupTooltip"})}setupTooltip(e){const t=this,n=t.config;return at.forEach((e=>delete n[e])),Ie.mergeConfigs(n,{ownerFeature:t,id:`${t.client.id}-event-tip`,forSelector:"hover"===t.showOn&&".b-cal-event-wrap:not(.b-editing)",cls:{"b-eventedit":t.client.features.eventEdit},disabled:t.disabled,internalListeners:{thisObj:t,delete:"onDeleteClick",edit:"onEditClick",pointerOver:"onTipPointerOver"}},e)}render(){const e=this,t={eventsPerCellChange:"onClientEventsPerCellChange",navigate:"onClientNavigate",thisObj:e};"hover"===e.showOn?e.getConfig("tooltip"):t[`event${e.showOn}`]="onClientTooltipGesture",e.client.ion(t)}get owner(){var e;return null!==(e=this.client.activeView._overflowPopup)&&void 0!==e&&e.containsFocus?this.client.activeView.overflowPopup:this.client}addListener(...e){var t;null===(t=this.tooltip)||void 0===t||t.addListener(...e)}removeListener(...e){var t;null===(t=this.tooltip)||void 0===t||t.removeListener(...e)}onEditClick(){var e,t;const{client:n,activeClient:a,tooltip:r}=this,{overflowPopup:i}=a,s=(null==a||null===(e=a.features)||void 0===e?void 0:e.eventEdit)||n.features.eventEdit,o=(null==i||null===(t=i.element)||void 0===t?void 0:t.contains(r.activeTarget))?i.targetCell:r.activeTarget;s&&!s.disabled&&(s.editEvent(this.eventRecord,null,o),r.hide())}onDeleteClick(){this.activeClient.calendar.removeEvents([this.eventRecord],(()=>{var e;return null===(e=this.tooltip)||void 0===e?void 0:e.hide()}),this.tooltip)}onClientEventsPerCellChange(){var e,t;null===(e=this._tooltip)||void 0===e||e.requestAnimationFrame(null===(t=this._tooltip)||void 0===t?void 0:t.hide)}onClientNavigate(e){var t;const{_tooltip:n}=this;null==n||!n.activeTarget||this.owner.owns(e.event)&&e.item===n.activeTarget||n.owns(null===(t=e.event)||void 0===t?void 0:t.relatedTarget)||n.hide()}onClientTooltipGesture({domEvent:e,event:t,eventElement:n,eventRecord:a,source:r}){const{tooltip:i}=this;e=e||t,!1!==this.onTipPointerOver({event:e,target:n,eventRecord:a,owningCalendarWidget:r})&&(n.classList.contains("b-cal-in-cluster")&&2===y(i.align.align).edgeAligned?i.setTimeout({fn:"showByEvent",args:[e,n],delay:130}):i.showByEvent(e,n))}onTipPointerOver({target:e,owningCalendarWidget:t,eventRecord:n}){var a,r,i;t||(t=null===(i=p.fromElement(e))||void 0===i?void 0:i.closest(nt));return n||(n=t.getEventRecord(e)),(null===(a=this.client.features)||void 0===a||null===(r=a.eventEdit)||void 0===r||!r.isEditing)&&(t&&(this.tooltip.activeTarget=e,this.activeClient=t,n=t.getEventRecord(e),this.tooltip.eventRecord=this.eventRecord=n),null!=n)}updateDisabled(e,t){super.updateDisabled(e,t),this._tooltip&&(this._tooltip.disabled=e)}}rt.initClass(),rt._$name="EventTooltip";const it={magnitude:1,unit:"hour"};class st extends(c.mixin(Q)){static get configurable(){return{dragItemSelector:".b-grid-row",droppable:!1,dragProxy:{type:"default",open(e){return this.owner.owner.openProxy(e)},dragMove(e){return this.owner.owner.moveProxy(e)},close(){var e;null===(e=this.owner.owner.proxyEl)||void 0===e||e.remove()}}}}beforeDrag(e){return this.owner.onDragStart(e)}}class ot extends(He.mixin(f)){static get $name(){return"ExternalEventSource"}static get delayable(){return{onCalendarPaint:"raf"}}static get type(){return"externalEventSource"}static get configurable(){return{grid:{$config:["lazy"],value:null},dragRootElement:null,dragItemSelector:null,getRecordFromElement:function(e){const t=this.grid||(this.grid=p.fromElement(e,"grid"));return t?t.getRecordFromElement(e):e.innerText},hideExternalProxy:!0,draggable:{$config:["lazy"],value:{}}}}onCalendarPaint({firstPaint:e}){e&&this.getConfig("draggable")}onDragStart(e){var n;const a=this,{client:r}=a,{eventStore:i}=r,{modelClass:s}=i;if(!e.itemElement)return!1;let o=a.callback(a.getRecordFromElement,a,[e.itemElement]);if(o.isModel)o.isEventModel||(o=i.createRecord(o.data));else{if("string"==typeof o){const e=r.activeView.autoCreate||r.autoCreate,n=t.parseDuration((null==e?void 0:e.duration)||it);o={[s.getFieldDataSource("name")]:o,[s.getFieldDataSource("duration")]:n.magnitude,[s.getFieldDataSource("durationUnit")]:n.unit}}o=i.createRecord(o)}e.set("sourceStore",null===(n=a.grid)||void 0===n?void 0:n.store),e.set("eventRecord",o)}openProxy(e){const{grid:t}=this,n=e.element.closest(this.draggable.dragItemSelector),i=n.querySelector('[data-column="name"]'),s=this.proxyEl=a.createElement({className:"b-grid-to-cal-drag-proxy"});s.innerHTML=i?i.innerHTML:e.peek("eventRecord").name,this.proxyOffset=m.getClientPoint(e.startEvent).getDelta(r.from(n)),((null==t?void 0:t.element)||this.dragRootElement).parentNode.appendChild(s)}moveProxy(e){const{proxyEl:t}=this;t&&(this.client.owns(e.targetElement)&&this.hideExternalProxy?t.classList.add("b-hide-display"):(t.classList.remove("b-hide-display"),a.alignTo(t,m.getClientPoint(e.event).translate(10,10),{align:"t0-t0"})))}changeDragRootElement(e){return"string"==typeof e&&(e=document.querySelector(e)||document.getElementById(e)),e}changeDraggable(e){const{grid:t}=this,n=(null==t?void 0:t.contentElement)||this.dragRootElement,{dragItemSelector:a}=this;return e=ot.mergeConfigs({owner:this,grid:t},e),n&&(e.dragRootElement=n),a&&(e.dragItemSelector=a),new st(e)}changeGrid(e){return"string"==typeof e&&(e=p.getById(e)),e}}ot.initClass(),ot._$name="ExternalEventSource";class lt extends He{static get configurable(){return{startDateParamName:"startDate",endDateParamName:"endDate",dateFormat:"YYYY-MM-DD",beforeRequest:null,alwaysLoadNewRange:null,clearOnNewRange:null}}construct(e){const{client:t}=e;t.ion({dateRangeRequested:"onClientDateRangeRequested",thisObj:this}),t.crudManager.ion({beforeLoadApply:"onCrudManagerBeforeApply",thisObj:this,prio:9999}),super.construct(...arguments)}hasOutstandingLoadFor(e,n){const{load:a}=this.client.crudManager.activeRequests;if(a){var r;const i=null===(r=a.options)||void 0===r?void 0:r.dateRangeRequested;if(i&&t.timeSpanContains(i.startDate,i.endDate,e,n))return!0}}onCrudManagerBeforeApply({response:e,options:t}){this.lastRangeLoaded=e.success&&(null==t?void 0:t.dateRangeRequested)}onClientDateRangeRequested({new:{startDate:e,endDate:n},changed:r}){const i=this,{client:s}=i;if(!r&&i.alwaysLoadNewRange)return;r&&(a.addTemporaryClass(s.element,"b-notransition",100,s),i.clearOnNewRange&&(s.eventStore.clear(!0),i.lastRangeLoaded=null));const{lastRangeLoaded:o}=i;if(o&&!i.alwaysLoadNewRange){const{startDate:a,endDate:r}=i.lastRangeLoaded;if(t.timeSpanContains(a,r,e,n))return}i.disabled||i.hasOutstandingLoadFor(e,n)||i.loadDateRange(e,n)}refresh(){const{lastRangeLoaded:e}=this;e&&this.loadDateRange(e.startDate,e.endDate)}loadDateRange(e,n){const a=this,{pendingLoad:r}=a;r?(r.startDate=t.min(e,r.startDate),r.endDate=t.max(n,r.endDate)):(a.pendingLoad={startDate:e,endDate:n},a.client.requestAnimationFrame((()=>a.load())))}async load(){const e=this,{client:n,beforeRequest:a,dateFormat:r}=e,{crudManager:i}=n,{load:s}=i.activeRequests,{startDate:o,endDate:l}=e.pendingLoad,d={dateRangeRequested:e.pendingLoad,request:{params:{[e.startDateParamName]:t.format(o,r),[e.endDateParamName]:t.format(l,r)}}};if(e.pendingLoad=null,a&&e.callback(a,n,[d]),s){if(e.hasOutstandingLoadFor(o,l))return;try{await i.cancelRequest(s.desc,s.reject)}catch(e){}}try{await i.load(d)}catch(e){n.isDestroyed||!1===n.trigger("loadOnDemandFail",e)||pe.alert({title:n.L("L{Calendar.loadFail}"),message:e.message})}!n.isDestroyed&&n.trigger("dateRangeLoad",{startDate:o,endDate:l})}}e(lt,"$name","LoadOnDemand"),e(lt,"type","loadOnDemand"),lt.initClass(),lt._$name="LoadOnDemand";class dt extends we{restoreState({client:e}){}saveState({client:e}){}cloneElement(e,t=this.element,n=!0){n&&(t.innerHTML=""),t.appendChild(e.cloneNode(!0))}pageTpl(e){const{config:t,title:n,header:a,footer:r,styles:i,htmlClasses:s,bodyStyle:o,bodyClasses:l=[`b-${this.constructor.type}`,...this.owner.bodyClasses,...p.outerCls],paperHeight:d,paperWidth:c,html:u}=e,h=w.isSafari?"":"window.removeElement && window.removeElement();",g=null!=t&&t.debug?"":`<script type="text/javascript">window.addEventListener('load', function() { window.print(); ${h} });<\/script>`;return D.tpl`
            <!DOCTYPE html>
            <html class="${s}" style="width: ${c}in; height: ${d}in;">
                <head>
                    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
                    <title>${n}</title>
                    ${i.join("")}
                </head>
                <body class="b-print ${l.join(" ")}" style="width: ${c}in; height: ${d}in; ${o}">
                    <div class="b-print-content">
                        ${a&&`<div class="b-print-header" style="width: 100%">${a}</div>`}
                        <div class="b-print-body"><div class="b-print-viewport">${u}</div></div>
                        ${r&&`<div class="b-print-footer" style="width: 100%">${r}</div>`}
                    </div>
                    ${g}
                </body>
            </html>`}}dt._$name="Printer";const ct={configurable:!0,get:()=>Number.MAX_SAFE_INTEGER};class ut extends dt{static get $name(){return"CalendarPrinter"}static get type(){return"calendar"}getTotalHeight(e){const{activeView:t}=e;switch(e.mode){case"agenda":return t.virtualScrollHeight;case"day":case"week":return t.dayContentElement.scrollHeight+t.alldayRowElement.offsetHeight;case"month":if(this.owner.wysiwyg)return t.weeksElement.scrollHeight+t.weekdaysHeader.offsetHeight+10;break;case"year":return this.inchToPx(De.A4.width)}}getTotalWidth(e){switch(e.mode){case"year":return this.inchToPx(De.A4.height);default:return this.inchToPx(De.A4.width)}}async prepareComponent(e){const t=this,{owner:n}=t,{wysiwyg:a}=n,r=!a,{client:i}=e,{activeView:s}=i;if(t.exportMeta={title:n.callback(n.titleRenderer,n,[s]),totalWidth:t.getTotalWidth(i),totalHeight:t.getTotalHeight(i),subGrids:{}},"month"===i.mode&&r&&(Object.defineProperty(s,"eventsPerCell",ct),s.doRefresh()),t.cloneElement(s.currentElement),"month"===i.mode){let e;r&&(e=s.shrinkwrapRowHeights,delete s.eventsPerCell,s.doRefresh(),t.exportMeta.totalHeight=s.weekdaysHeader.offsetHeight+e.reduce(((e,t)=>e+t),5)),s.weekElements.forEach(((n,i)=>{const s=t.element.querySelector(`[data-week="${n.dataset.week}"]`);s.style.minHeight="",s.style.flex=r?`0 0 ${e[i]}px`:a?`1 0 ${n.offsetHeight}px`:`1 0 ${250/6}mm`}))}}pxToInch(e){return(e/96).toFixed(2)}}ut.prototype.pagesExtractor=async function*(e){const t=this,{totalHeight:n,totalWidth:a,title:r}=t.exportMeta;yield{html:t.pageTpl({config:e,title:r,html:t.prepareExportElement(),styles:t.stylesheets,paperWidth:t.pxToInch(a),paperHeight:t.pxToInch(n)})}},ut._$name="CalendarPrinter";const ht=Object.freeze([]);class gt extends He{static get $name(){return"Print"}static get type(){return"print"}static get configurable(){return{printer:{$config:["lazy","nullify"],value:{type:"calendar"}},wysiwyg:!1,titleRenderer:e=>e.description,printers:new Map([[ut.type,ut]])}}construct(){super.construct(...arguments),this.client.print=this.print.bind(this)}changePrinter(e){const t=this,n=t.printersMap||(t.printersMap=new Map);if(e){let a;const{type:r}=e;if(n.has(r))a=n.get(r),a.setConfig(e);else{const i=t.printers.get(r);if(!i)throw new Error(`Printer type ${r} is not found. Make sure you've configured it`);(e=s.clone(e)).owner=t,a=new i(e),a.relayAll(t),n.set(r,a)}return a}n.forEach((e=>e.destroy()))}get bodyClasses(){return this.shrinkwrapRowHeights?["b-shrinkwrap-row-heights"]:ht}async print(e={}){const t=this,{client:n,printer:r}=t,i=`${n.id}-print-iframe`;if(!1!==n.trigger("beforePrint",{config:e,printer:r})){e.client=n;const r=await t.printer.export(e);if(!e.debug){var s;null===(s=document.getElementById(i))||void 0===s||s.remove();const e=a.createElement({id:i,class:"b-calendar-print-iframe",tag:"iframe",parent:document.body});return e.contentWindow.removeElement=()=>{e.remove(),n.trigger("print",r)},e.contentWindow.document.write(r[0].html),e.contentWindow.document.close(),r}n.trigger("print",r)}}}gt.initClass(),gt._$name="Print";class vt extends se{static get $name(){return"ScheduleMenu"}static get type(){return"scheduleMenu"}getDataFromEvent(e){const{client:t}=this,{activeView:n}=t,a=t.resolveResourceRecord(e)||t.defaultCalendar;n.isScheduler&&(this.client=n);const r=super.getDataFromEvent(e);return r.resourceRecord||(r.resourceRecord=a),this.client=t,r}shouldShowMenu({date:e,targetElement:t}){const{client:n}=this,{activeView:a}=n;if(a.isScheduler){this.client=a;const e=super.shouldShowMenu(...arguments);return this.client=n,e}return Boolean(e&&!t.closest(n.eventSelector))}}He.register(vt.type,vt),vt._$name="ScheduleMenu";const mt=/^[+-]?\d+(?:\.\d+)?(?:%|px)?$/;class pt{static from(e){return null==e?null:e instanceof pt?e:(Array.isArray(e)||"string"==typeof e&&isNaN(e)||(e=(e=Number(e))<1?[e,0]:[0,e]),new pt(...e))}static get(e){return pt.from(e)||pt.ZERO}constructor(e,t){this.r=e,this.d=t}add(e){return(e=pt.from(e))?new pt(this.r+e.r,this.d+e.d):this}adjust(e,t){return this.r+=e||0,this.d+=t||0,this}freeze(){return Object.freeze(this)}px(e){return this.r*(e||100)+this.d}sub(e){return(e=pt.from(e))?new pt(this.r-e.r,this.d-e.d):this}*[Symbol.iterator](){yield"r",yield"d"}stringify(){const e=this.toString();return mt.test(e)?e:`calc(${e})`}toString(){const{r:e,d:t}=this;let n;return e?(n=a.percentify(100*e),t&&(n=`${n} + ${t}px`.replace("+ -","- "))):n=t?`${t}px`:"0",n}}pt.ZERO=new pt(0,0).freeze(),pt._$name="LayoutDim";const yt=e=>({className:e.cls,style:e.style}),ft={end:"pos",start:"neg"},wt={end:"start",start:"end"},Dt=Object.entries({alignment:"alignment",color:"color",footer:"footer",header:"name",rotation:"rotation"});class Ct extends Oe{onBeforeLayoutEvents({source:e,context:t}){const n=e.getTimeRanges(t.cellData.date,t.cellData.tomorrow);if(n.length){const{layout:e}=t,a={},r={},i=[],s=[];let o,l;t.timeRangeHeaders=r,t.timeRanges=n;for(const d of n)l=e.createLayoutItem(d,t),l.values=Object.fromEntries(Dt.map((([e,t])=>[e,d[t]]))),l.values.rotation=l.values.rotation||ft[l.values.alignment],e.clusterize(i,s,l,t),o=t.dayDomConfig.children.inset,o=o.children||(o.children=[]),o.push(this.renderTimeSpan(t,l,r,a));(r.end||a.end)&&(t.dayDomConfig.className["b-dayview-inset-after"]=1),(r.start||a.start)&&(t.dayDomConfig.className["b-dayview-inset-before"]=1)}}renderPart(e,t,n,a,r,i,o){var l,d,c;const u="footer"===a,{record:h}=n,g={timeRange:h};let v,m,p,y=n;if("string"==typeof a?(n[a]=y=s.merge({part:a,record:h,outer:n,cls:{[`b-cal-timerange-${a}`]:1}},o),p=n.values[a],null!=p&&(g.value=y.value=p)):(m=a,a="outer"),e=null===(l=e)||void 0===l?void 0:l[a],t=null===(d=t)||void 0===d?void 0:d[a],g.renderData=y,g.domConfig=m,t){y.style={};const e=t(g);"string"==typeof e?m=Object.assign({html:e},m):s.isObject(e)&&(v=e)}return v=v||(null===(c=e)||void 0===c?void 0:c(g)),m&&(v=s.merge(v||{},m)),r&&v&&(r[i=u&&wt[i]||i]=(r[i]||0)+1),y.domConfig=v,v}renderTimeSpan(e,t,n,r){const i=this,{owner:s}=i,{defaultRenderer:o,renderer:l}=s,d=t.eventRecord,c=Math.abs(t.end-t.start),u=c>1,h=!u,{rtl:g}=e.layout.owner,{values:v}=t,{alignment:m,color:p,rotation:y}=v,f={color:p,values:v,record:d,layoutContext:e,cls:{"b-readonly":d.readOnly,"b-rtl":g,"b-cal-timerange":1,"b-cal-timerange-line":h,"b-cal-timerange-narrow":u&&c<=60*s.narrowThreshold,[`b-cal-timerange-align-${m}`]:m,[`b-cal-timerange-rotate-${y}`]:u&&y}};u&&t.height.adjust(0,-1);const w=t.getStyles(g);return a.normalizeChildren(i.renderPart(o,l,f,{dataset:{"timerange-id":d.id,btip:h&&v.header||null},className:{[d.cls]:d.cls},elementData:{timeRange:d},style:{top:w.top,height:w.height},children:u&&{header:i.renderPart(o,l,f,"header",n,m,{cls:{[d.iconCls]:d.iconCls}}),body:i.renderPart(o,l,f,"body"),footer:i.renderPart(o,l,f,"footer",r,m)}}))}}e(Ct,"$name","DayZone"),e(Ct,"configurable",{viewListeners:{beforeLayoutEvents:"onBeforeLayoutEvents"}});class bt extends(He.mixin(oe)){attachToProject(e){var t,n;super.attachToProject(e),this.detachListeners("project"),null===(t=e.timeRangeStore)||void 0===t||t.ion({name:"project",change:"refresh",thisObj:this}),null===(n=e.resourceTimeRangeStore)||void 0===n||n.ion({name:"project",change:"refresh",thisObj:this})}changeRenderer(e){return"function"==typeof e&&(e={header:e}),e}updateHeaderWidth(e){var t;const n=null===(t=this.owner)||void 0===t?void 0:t.element;var a;n&&n.style.setProperty("--timerange-header-width",null===(a=pt.from(e))||void 0===a?void 0:a.toString())}refresh(){this.client.queryAll((e=>e.isResourceView)).forEach((e=>e.eachView("refresh")))}}e(bt,"$name","TimeRanges"),e(bt,"type","timeRanges"),e(bt,"configurable",{defaultRenderer:{outer({renderData:e}){var t;const n=yt(e),{color:r}=e;return r&&(a.isNamedColor(r)?n.className[`b-cal-color-${r}`]=1:(n.style||(n.style={}))["--timerange-color"]=r),n.className["b-cal-timerange-has-header"]=null===(t=e.header)||void 0===t?void 0:t.domConfig,n},body:({renderData:e})=>yt(e),header:({renderData:e,value:t})=>t?d(d({},yt(e)),{},{children:[{className:{"b-cal-timerange-header-text":1},text:t}]}):null,footer:({renderData:e,value:t})=>t?d(d({},yt(e)),{},{children:[{className:{"b-cal-timerange-footer-text":1},text:t}]}):null},headerWidth:40,narrowThreshold:60,renderer:null,zoneTypes:{day:Ct,resource:Ct}}),He.register(bt.type,bt),bt._$name="TimeRanges";class Et extends He{static get $name(){return"WeekExpander"}static get type(){return"weekExpander"}static get pluginConfig(){return{chain:["render"]}}render(){const{client:e}=this,t=this.monthView=e.isMonthView?e:e.modes.month;if(t){const{weekRenderer:e}=this;t.showWeekColumn=!0,t.weekRenderer=t.weekRenderer?g.createSequence(t.weekRenderer,e):e,t.ion({weeknumberclick:"onWeekNumberClick",thisObj:this,prio:1e4})}}weekRenderer(e,[t,n]){e.querySelector(".b-week-toggle-tool-wrap")||a.createElement({parent:e,className:"b-week-toggle-tool-wrap",children:[{className:"b-icon b-week-toggle-tool",dataset:{btip:this.L("L{WeekExpander.expandTip}")}}]})}onWeekNumberClick({domEvent:e,date:t}){const n=e.target.closest(".b-week-toggle-tool");if(n&&!this.disabled){const a=e.target.closest(".b-calendar-row");return a.classList.contains("b-shrinkwrapped")?(this.monthView.flexWeekRow(t),n.dataset.btip=this.L("L{expandTip}")):a.classList.contains("b-has-overflow")&&(this.monthView.shrinkwrapWeekRow(t),n.dataset.btip=this.L("L{collapseTip}")),!1}}updateDisabled(e,t){super.updateDisabled(e,t),this.client.element.classList.toggle("b-weekexpander",!e)}}Et.initClass(),Et._$name="WeekExpander";const St=function(e){var t,n;const a=this;return{[e?"right":"left"]:null===(t=a.left)||void 0===t?void 0:t.stringify(),top:a.top.stringify(),width:null===(n=a.width)||void 0===n?void 0:n.stringify(),height:a.height.stringify(),minWidth:a.minWidth}};class kt extends(c.mixin(l)){beforeLayoutEvents(e){return this.owner.trigger("beforeLayoutEvents",{context:e}),e}clusterize(e,t,n,a){const r=e[e.length-1]||null;t.push(n),r&&this.overlaps(r,n)?(n.cluster=r,r.end=Math.max(r.end,n.end),r.items.push(n)):e.push(n.cluster={context:a,start:n.start,end:n.end,items:[n]})}createLayoutContext(e,t){const n=null==e?void 0:e.events;return{cellData:e,dayDomConfig:t,events:(null==n?void 0:n.length)>1?e.dayTime.sortEvents(e.date,n.slice()):n||[],clusters:[],items:[],layout:this}}layoutEvents(e,t){const n=this,a=n.beforeLayoutEvents(n.createLayoutContext(e,t)),{clusters:r,events:i,items:s}=a;let o,l,d,c;for(o of i)d=n.createLayoutItem(o,a),n.clusterize(r,s,d,a);for(l=0,c=r.length;l<c;++l)n.layoutCluster(r[l]);return n.owner.trigger("layoutEvents",{context:a}),a}createLayoutItem(e,t){const{date:n,tomorrow:a,dayEnd:r,dayTime:i}=t.cellData,{allDay:s,startDate:o,endingDate:l}=e,d=s||o<n?0:i.delta(o,"s"),c=s||l>=a?r:i.delta(l,"s"),u=Math.max(d,0),h=Math.min(c,r),g=pt.from(u/r);return{eventRecord:e,getStyles:St,start:u,end:h,top:g,id:e.id,height:new pt(h/r,0).sub(g),startsBefore:o<n||d<0,endsAfter:a<l||c>r}}overlaps(e,t,n,a){var r;return"string"==typeof n&&(a=n,n=null),a=a||"end",n=null!==(r=n)&&void 0!==r?r:60*this.overlapTolerance||0,e.start<t[a]-n&&t.start<e[a]-n}syncGutter(){this.owner.setStyle("--dayview-cell-gutter",String(pt.get(this.gutter&&this.gutterWidth)))}updateGutter(){this.syncGutter()}updateGutterWidth(){this.syncGutter()}updateInset(e){this.owner.setStyle("--dayview-cell-inset-size",String(pt.get(e)))}}e(kt,"factoryable",{}),e(kt,"configurable",{gutter:!0,gutterWidth:5,inset:40,overlapTolerance:null,owner:null}),kt._$name="DayLayout";class Rt extends(Y()){static get defaultConfig(){return{coordProp:"left",sizeProp:"width"}}pack(e){const t=e.map((e=>{const{startDate:t}=e.eventRecord,n=new Date(t);return n.setSeconds(n.getSeconds()+e.maxEnd-e.start),{item:e,start:t,end:n,x:0}}));this.packEventsInBands(t,((e,t,n,a)=>{e.width=a,e.w=a*xt,e.x+=(e.left=n.start+t*a)*xt,e.item.x=e.x,e.item.w=e.w}))}}const xt=1e4,Mt=Object.freeze([]),Tt=new Rt;class Nt extends kt{createLayoutContext(e,t){const n=this,a=super.createLayoutContext(e,t),{staggerWidth:r}=n;return Object.assign(a,{indentWidth:pt.get(n.indentWidth),stagger:new pt,staggerMaximum:pt.from(n.staggerMaximum),staggerMinimum:n.staggerMinimum,staggerWidth:pt.from(!0===r?n.gutterWidth:r),stretch:n.stretch})}layoutCluster(e){const{context:t,items:n}=e,{indentWidth:a,stagger:r,staggerMaximum:i,staggerMinimum:s,staggerWidth:o,stretch:l}=t,d=this.treeify(n);this._assignSizes(n,d);for(const e of n){const t=e.depth,n=new pt,d=new pt,c=e.majorParent||e;for(const e of r)r[e]=o[e]*(t.height+t.overlap),r[e]=null!=i&&i[e]?Math.min(i[e],r[e]):r[e];n.r=c.x+t.minor*a.r*c.w,n.d=t.minor*a.d,d.r=l?1-n.r:c.w-n.r+c.x,d.d=-n.d,s&&(e.minWidth=`calc(${s} * (${d}))`),d.r-=r.r*c.w,d.d-=r.d,e.left=n,e.width=d}}treeify(e){const t=[];for(let n=0;n<e.length;n++)this._addChild(e[n],n,t);return t}_addChild(e,t,n){const a=this,{clearanceMinutes:r,escapeMinutes:i,stretch:s}=a,o=60*r,l=o+60*i,d=60*(a.overlapTolerance||0),c=e=>10*e.depth.minor+e.depth.major*(s?1:0),u={depth:0,height:0,heightMajor:0,overlap:0,major:0,minor:0};if(e.parent=null,e.maxEnd=e.maxEndMajor=e.end,e.depth=u,e.order=t,!n.length)return n[0]=e,void(e.barriers=Mt);let h,g,v,m,p,y,f=0;for(m of n){if(h=m.lastItem||m,!a.overlaps(e,m,d,"maxEnd")){p=m.parent,g=!0;break}if(w=e,D=h,Math.abs(D.start-w.start)>=o){for(v=!0,g&&(g=!1,p=null);h!==m&&!a.overlaps(h,e,d);h=h.parent);y=c(h),(!p||y<f)&&(p=h,f=y)}else v||(g=!0,p=m)}var w,D;if(g)v=0,g=p?p.depth.major+1:0,m=p=n[g-1]||null;else{for(m=p.majorParent||p;l&&p!==m&&!(a.overlaps(p,e,d)&&e.start-p.start<l);p=p.parent);v=p.depth.minor+1,g=p.depth.major}e.parent=p,u.major=g,u.minor=v,u.depth=p?p.depth.depth+1:0,v?(e.majorParent=m,e.previousItem=m.lastItem,m.lastItem=e):a._addMajor(e,n),a._adjustOverlap(e),a._adjustParents(e)}_addMajor(e,t){const n=this,{stretch:a}=n;if(t[e.depth.major]=e,e.barriers=n._getOverlaps(t,e,1),a||e.barriers.length)for(const r of n._getOverlaps(t,e,-1)){const t=r.barriers.filter((t=>!e.barriers.includes(t)));(a||t.length<r.barriers.length)&&(r.barriers=t,t.push(e))}}_adjustOverlap(e){if(e.depth.minor){let t,n;for(n=e;n.depth.minor>1;n=n.parent);for(t=0;n=n.previousItem;)this.overlaps(n,e)&&(t=Math.max(t,n.depth.height+n.depth.overlap+1));e.depth.overlap=t}}_adjustParents(e){const{depth:t,end:n}=e,a=t.minor+t.overlap;for(let r,i=e;i=i.parent;)if(r=i.depth,r.major===t.major)for(i.maxEnd=Math.max(i.maxEnd,n);r.height<a-r.minor;)++r.height,r.overlap&&--r.overlap;else r.heightMajor=Math.max(r.heightMajor,t.major-r.major)}_assignSizes(e,t){const{complexityLimit:n,stretch:a}=this,r=e.filter((e=>!e.depth.minor));if(n)for(const e of r){const r=e.barriers.map((e=>[e])),{parent:i}=e,s=e.depth.heightMajor+1;e.x=i?i.x+i.w:0;let o,l,d,c,u,h,g,v=(1-e.x)/s;if(r.length){for(o=0;o<r.length;){if(c=r[o],d=d||c,o>n){v=1/t.length;break}if(u=c[c.length-1],u.order<e.order)++o,g=u.x,l=0;else{if(u.barriers.length){r.splice(o,1,...u.barriers.map((e=>c.concat(e)))),d===c&&(d=null);continue}++o,g=1,l=1}h=(g-e.x)/(l+c.length),h<v&&(v=h,d=c)}if(a){for(h=d.reduce(((e,t)=>e+t.depth.height+1),0),o=e.lastItem;o;o=o.previousItem)o.depth.overlap+=h;e.depth.overlap+=h}}e.w=v}else{Tt.pack(r);for(const e of r)e.x/=xt,e.w/=xt}}_getOverlaps(e,t,n){const{end:a}=t,r=n<0?-1:e.length;let i,s,o,{start:l}=t;for(i=t.depth.major+n;i!==r&&l<a;i+=n)s=e[i],l<s.maxEnd&&s.start<a&&((o||(o=[])).push(s),l=s.maxEnd);return o||Mt}}e(Nt,"type","fluid"),e(Nt,"configurable",{clearanceMinutes:45,complexityLimit:2e3,escapeMinutes:null,indentWidth:10,staggerMaximum:null,staggerMinimum:.4,staggerWidth:!0,stretch:null}),Nt.initClass(),Nt._$name="FluidDayLayout";var Wt=t=>{var n;return n=class extends(le(t||c)){static get projectStores(){return{resourceStore:{dataName:"resources",listeners:{changePreCommit:"onCalendarStoreChange"}},eventStore:{dataName:"events",listeners:{changePreCommit:"onCalendarStoreChange"}},assignmentStore:{dataName:"assignments"},timeRangeStore:{dataName:"timeRanges",modelClass:Te},resourceTimeRangeStore:{dataName:"resourceTimeRanges",modelClass:Z}}}changeCrudManager(e){var t;const n=this;if(e&&!e.isCrudManager){e=(e.type||n.crudManagerClass).new({scheduler:n},e)}n._crudManager=e,null===(t=n.bindCrudManager)||void 0===t||t.call(n,e)}updateTimeZone(e){this.project.timeZone=e}onTimeZoneChange({timeZone:e,oldTimeZone:t}){const n=this,a=n.isCalendar?n.activeView:!n.calendar&&n;if(a){const n=t?C.fromTimeZone(a.date,t):a.date;(a.calendar||a).date=e?C.toTimeZone(n,e):n}}get defaultCalendar(){const{eventStore:e}=this,t=s.hasOwn(this,"_defaultCalendar")?this._defaultCalendar:e.defaultCalendarId;if(null!==t)return null!=t?t.isResourceModel?t:e.resourceStore.getById(t):e.resourceStore.first}get defaultCalendarId(){return this.eventStore.modelClass.asId(this.defaultCalendar)}updateProject(e,t){super.updateProject(e,t),this.getConfig("timeZone"),this.detachListeners("CalendarStores"),e.ion({name:"CalendarStores",dataReady:"onCalendarStoreChange",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh({source:e,isInitialCommit:t}){t&&e.eventStore.invalidateDayIndices()}updateEventStore(e,t){if(t&&delete t.createRecord,e&&!e.isCalendarEventStore){const t=this;Object.defineProperty(e,"defaultCalendar",{get:()=>t.defaultCalendar}),e.isCalendarEventStore=!0}}get widgetClass(){}},e(n,"$name","CalendarStores"),e(n,"configurable",{defaultCalendar:null,crudManagerClass:Pe,crudManager:null,timeZone:{$config:"lazy",value:null}}),e(n,"defaultConfig",{projectModelClass:We}),n};class Pt extends Array{constructor(...t){super(...t),e(this,"firstFreeSlot",0)}set(e,t){const n=this;if(null==e)return n.add(t);if(n[e]=t,n.firstFreeSlot===e)for(;n[n.firstFreeSlot];)n.firstFreeSlot++}add(e){const t=this.firstFreeSlot;for(this[t]=e;this[this.firstFreeSlot];)this.firstFreeSlot++;return t}setEvents(e){const t=this.length=this.firstFreeSlot=e.length;for(let n=0;n<t;n++)this[n]=e[n]}}Pt._$name="EventSlots";class Ht extends c{static defaultSorterFn(e,t){e=e.eventRecord||e,t=t.eventRecord||t;const{startDate:n}=e,{startDate:a}=t;return n?a?n-a||t.durationMS-e.durationMS:1:-1}static interDaySorterFn(e,t){e=e.eventRecord||e,t=t.eventRecord||t;const{startDate:n,isInterDay:a}=e,{startDate:r,isInterDay:i}=t;return n?r?a!==i?Number(i)-Number(a):n-r||t.durationMS-e.durationMS:1:-1}}Ht._$name="EventSorter";const Ot=e=>e.isCalendarMixin&&e.eventStore,Lt=/(touch|mouse|pointer|key|context|dbl)(.*)/,It=(e,t,n)=>`${h.capitalize(t)}${h.capitalize(n)}`;var $t=e=>class extends(e||c){static get $name(){return"SchedulerInterface"}calendarHitTest(e){const{activeView:t}=this,n=a.getEventElement(e);return null!=t&&t.element.contains(n)?t.calendarHitTest(e):null}get timeAxis(){const e=this;return e._timeAxis||(e._timeAxis={get startDate(){return e.activeView.startDate},get endDateDate(){return e.activeView.endDate},isTimeSpanInAxis(e){return t.intersectSpans(e.startDate,e.endDate,this.startDate,this.endDate)}}),this._timeAxis}get timeAxisViewModel(){const e=this;return e._timeAxisViewModel||(e._timeAxisViewModel={get timeResolution(){return e.activeView.timeResolution||{}}}),this._timeAxisViewModel}resolveEventRecord(e){var t;e instanceof Event&&(e=e.target);const n=null===(t=this.constructor.fromElement(e))||void 0===t?void 0:t.closest(Ot);return null==n?void 0:n.getEventRecord(e)}resolveAssignmentRecord(){}resolveResourceRecord(e){var t;const{activeView:n}=this;if(n.isResourceView){const t=(e.nodeType===Node.ELEMENT_NODE?e:e.target).closest(".b-overflowpopup"),a=t?bryntum.fromElement(t,"overflowpopup").owner:bryntum.fromElement(e,n.viewType.type);if(a)return a.resource}return null===(t=this.resolveEventRecord(e))||void 0===t?void 0:t.resource}handleEvent(e){const t=(e=>e.type.replace(Lt,It))(e);if(super.handleEvent)super.handleEvent(e);else if(!e.handled&&!e.schedulerRedirected){var n;if(!1!==this.trigger(`beforeElement${t}`,{event:e}))null===(n=this[`onElement${t}`])||void 0===n||n.call(this,e);e.schedulerRedirected=!0}}onInternalKeyDown(e){var t;null===(t=this.onCalendarPointerInteraction)||void 0===t||t.call(this,e)}getCellDataFromEvent(e){var t;return null===(t=super.getCellDataFromEvent)||void 0===t?void 0:t.call(this,e)}getDateFromDomEvent(e){var t;const n=null===(t=this.constructor.fromElement(e))||void 0===t?void 0:t.closest(Ot);if(n)return n.getDateFromDomEvent(e)}createEvent(){this.activeView.createEvent(...arguments)}get enableRecurringEvents(){return!0}getRowFor(){}suspendRefresh(){}resumeRefresh(){}get widgetClass(){}};const Vt=new String("");var At=n=>{var r;return e(r=class extends(n||c){createEventDomConfig(e,n=this.eventRenderer){var r,i,s;const o=this,{eventHeight:l,intradayCls:d,alldayCls:c,solidBarCls:u,pastEventCls:h,showTime:g,timeFormat:m,rtl:p}=o,y=o.up("calendar"),{eventRecord:f,minimal:w}=e,D=e.eventEndDate||f.endingDate,C=f.isOccurrence?f.recurringEvent.resource:f.resource,E=f.isRecurring||f.isOccurrence,S="isAllDay"in e?e.isAllDay:null===(r=o.isAllDayEvent)||void 0===r?void 0:r.call(o,f),k={height:"auto"!==l?a.setLength(l):null},R=null==y?void 0:y.eventSelectedCls,x=e.dataset={eventId:f.id};let M=o.internalBodyContentRenderer(f),T="string"!=typeof M,N=T?"children":"html",W=f.color||f.eventColor||(null==C?void 0:C.eventColor)||Vt;if(e.cls=f.cls.clone(),e.solidBar=S||w,e.iconStyle="header"===o.iconTarget&&o.showTime&&!a.isNamedColor(W)?{color:W}:{},e.iconCls=new v(f.iconCls),e.style=Object.assign(a.parseStyle(null==C?void 0:C.eventStyle),a.parseStyle(f.style)),e.eventColor=W,e.eventHeight=l,e.cls[o.shortEventCls]=f.durationMS<=o.shortEventDuration,null!=C&&C.cls&&e.cls.add(C.cls),n&&!w){const t=o.callback(n,o,[{eventRecord:f,resourceRecord:C,renderData:e}]);e.eventHeight!==l&&(k.height=a.setLength(e.eventHeight)),null!=t&&(T=!0,M=t,"string"!=typeof M&&(M=b.asArray(M),N="children")),"string"==typeof e.cls&&(e.cls=new v(e.cls)),"string"==typeof e.iconCls&&(e.iconCls=new v(e.iconCls)),"string"==typeof e.style&&(e.style=a.parseStyle(e.style))}M=[{className:{"b-cal-event-desc":1,"b-cal-event-desc-complex":T},[N]:M}],Object.assign(e.cls,{"b-cal-event-wrap":1,"b-iscreating":f.isCreating,"b-readonly":f.readOnly,"b-minimal":w,[c]:c&&S,[u]:u&&e.solidBar,[d]:d&&!S,[h]:h&&D<new Date,[R]:R&&(null==y?void 0:y.isEventSelected(f)),"b-rtl":p}),W=e.eventColor,null!==(i=W)&&void 0!==i&&i.length&&(a.isNamedColor(W)?e.cls[`b-cal-color-${W}`]=1:e.solidBar?k["background-color"]=W:k[o.eventColourStyleProperty]=W),!g||S&&this.showAllDayHeader||M.unshift({className:"b-event-header",children:[{className:"b-event-time",html:t.format(f.startDate,m)}]});const P=Boolean(null===(s=e.iconCls)||void 0===s?void 0:s.length),H=!P&&E,O=o.showCircle&&!P&&!E,L={tag:"i",className:Object.assign({"b-cal-event-icon":!H,"b-cal-recurrence-icon":H,"b-icon":1,"b-fw-icon":1,"b-icon-circle":O,"b-icon-recurring":H},e.iconCls),style:e.iconStyle},I=[{className:"b-cal-event-body",children:M}],$="header"===o.iconTarget&&o.showTime?M[0].children.length>0?M[0].children:M:I;return(P||H||O)&&("header"===o.iconTarget&&o.showTime?$.push(L):$.unshift(L)),P&&E&&$.push({tag:"i",className:{"b-cal-recurrence-icon":1,"b-icon":1,"b-fw-icon":1,"b-icon-recurring":1},style:e.iconStyle}),{tabIndex:w?null:0,dataset:x,className:e.cls,style:e.style,children:[{className:"b-cal-event",style:k,children:w?null:I}]}}internalBodyContentRenderer(e){var t;const n=h.encodeHtmlBR(e.name),{showResourceAvatars:a}=this;if(a&&null!==(t=e.assigned)&&void 0!==t&&t.size){const t=[{class:"b-cal-event-resource-avatars",children:e.resources.map((e=>this.getResourceAvatar(e)))},{tag:"span",class:"b-cal-event-name",html:n}];return"last"===a?t.reverse():t}return n}},"$name","EventRenderer"),e(r,"configurable",{eventRenderer:null}),r};E.publishLocale({localeName:"En",localeDesc:"English (US)",localeCode:"en-US",EventEdit:{Calendar:"Calendar","All day":"All day",day:"Day",week:"Week",month:"Month",year:"Year",decade:"Decade"},EventMenu:{duplicateEvent:"Duplicate event",copy:"copy"},Calendar:{Today:"Today",next:e=>`Next ${e}`,previous:e=>`Previous ${e}`,plusMore:e=>`+${e} more`,allDay:"All day",endsOn:e=>`Ends ${e}`,weekOfYear:([e,t])=>`Week ${t}, ${e}`,loadFail:"Calendar data load failed. Please contact your system administrator"},CalendarDrag:{holdCtrlForRecurrence:"Hold CTRL for a recurring event"},CalendarMixin:{eventCount:e=>`${e||"No"} event${1===e?"":"s"}`},EventTip:{"Edit event":"Edit event",timeFormat:"LST"},ModeSelector:{includeWeekends:"Include weekends",weekends:"Weekends"},AgendaView:{Agenda:"Agenda"},MonthView:{Month:"Month",monthUnit:"month"},WeekView:{weekUnit:"week"},YearView:{Year:"Year",yearUnit:"year"},EventList:{List:"List",Start:"Start",Finish:"End"},DayView:{Day:"Day",dayUnit:"day",daysUnit:"days",expandAllDayRow:"Expand all-day section",collapseAllDayRow:"Collapse all-day section",timeFormat:"LST"},Sidebar:{"Filter events":"Filter events"},WeekExpander:{expandTip:"Click to expand row",collapseTip:"Click to collapse row"}});const Ft=Promise.resolve(),_t=Object.freeze({}),{eventNameMap:Bt}=m,jt=e=>e.isCalendarMixin&&e.containsFocus;var zt=n=>{var i;return i=class e extends((n||c).mixin(q,$t,be,Wt,At,Ee)){static get configurable(){return{localizableProperties:["autoCreate.newName"],eventStore:null,resourceStore:null,eventSorter:Ht.defaultSorterFn,responsive:{},hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",weekStartDay:t.weekStartDay,nonWorkingDays:{value:t.nonWorkingDays,$config:{merge:"replace"}},nonWorkingDayCls:"b-nonworking-day",dayCellCls:"b-calendar-cell",weekendCls:"b-weekend",todayCls:"b-today",pastEventCls:"b-past-event",shortEventCls:"b-short-event",shortEventDuration:"30 minutes",eventHeight:25,eventSpacing:2,intradayCls:"b-intraday",alldayCls:"b-allday",solidBarCls:"b-solid-bar",dayNameSelector:".b-day-name",showTime:!1,timeFormat:"LT",showCircle:!0,eventColourStyleProperty:"color",handlePointerInteraction:!0,shortDateFormat:"ll",shortDateTimeFormat:"ll LT",readOnly:null,autoCreate:{gesture:"dblclick",newName:"L{Object.newEvent}",step:"15 minutes",duration:"1 hour",startHour:8},autoRefresh:{$config:{merge:"classList"},value:null},allowOverlap:!0,syncViewDate:!0,focusable:!1,avatarRendering:{$config:"lazy",value:null},showResourceAvatars:null,resourceImagePath:null,minDate:null,maxDate:null,animateTimeShift:!0,includeTimeRanges:null,testConfig:{animateTimeShift:!1}}}static get delayable(){return{refreshSoon:{type:"raf",cancelOutstanding:!0}}}static get featureable(){return{factory:He}}construct(e){var t;const n=this;super.construct(e),n.isYearView||-1===n.element.tabIndex||-1===(null===(t=n.contentElement)||void 0===t?void 0:t.tabIndex)||((n.contentElement||n.element).tabIndex=-1),n.getConfig("avatarRendering"),m.on({element:n.element,keydown:"onCalendarKeyDown",thisObj:n}),n.handlePointerInteraction&&m.on({element:n.element,mouseover:"onEventMouseOverOut",mouseout:"onEventMouseOverOut",mousedown:"onCalendarPointerInteraction",mouseup:"onCalendarPointerInteraction",click:{handler:"onCalendarPointerInteraction",block:300},dblclick:"onCalendarPointerInteraction",contextmenu:"onCalendarPointerInteraction",thisObj:n})}getTimeRanges(e,t){const{resourceId:n,project:a}=this,r=!n||this.owner.includeTimeRanges,i=null==n||r?null==a?void 0:a.getTimeRanges(e,t):[];if(null!=n){const r=null==a?void 0:a.getResourceTimeRanges(e,t).filter((e=>e.resourceId==n));r.forEach((e=>{e.color||(e.color=this.resource.eventColor)})),i.push(...r)}return i}updateIncludeTimeRanges(){this.isConfiguring||this.refresh()}onConfigChange(e){var t;null!==(t=this.autoRefresh)&&void 0!==t&&t[null==e?void 0:e.name]&&this.refreshSoon(),super.onConfigChange(e)}changeAvatarRendering(e){return ee.new({element:this.element},e)}updateShowResourceAvatars(e){e&&(this.avatarRendering||(this.avatarRendering=!0))}getResourceAvatar(e){return this.avatarRendering.getResourceAvatar({resourceRecord:e,imageUrl:!1===e.image?null:e.imageUrl||e.image&&this.resourceImagePath+e.image,color:e.eventColor,initials:e.initials,dataset:{btip:h.encodeHtml(e.name),resourceId:e.id}})}updateEventHeight(e){const{style:t}=this.element;this._eventHeightInPixels=null,t.setProperty("--event-height",a.setLength(e)),t.setProperty("--arrow-width","calc(var(--event-height) / 3)"),t.setProperty("--arrow-margin","calc(var(--event-height) / -3)"),this.isConfiguring||this.refreshSoon()}get eventHeightInPixels(){const e=this,{eventHeight:t}=e;let n=e._eventHeightInPixels;return"auto"!==t&&(n||(n=e._eventHeight,"string"==typeof n&&(n=a.measureSize(n,e.contentElement.querySelector(`.${e.eventBarContainerCls}`),!1)),e._eventHeightInPixels=n)),n}get visibleCellSelector(){const e=[];return this.hideOtherMonthCells&&e.push(`.${this.otherMonthCls}`),this.hideNonWorkingDays&&e.push(`.${this.nonWorkingDayCls}`),`.${this.dayCellCls}${e.length?`:not(${e.join(",")})`:""}`}get activeView(){return this}get activeSubView(){var e;const{items:t}=this;return(null===(e=t.filter(jt))||void 0===e?void 0:e[0])||this}eachView(e,t,n=null){this.callback(e,n||this,t||[this])}get focusElement(){const{calendar:e}=this;if(e){const{navigator:t}=e;return t.activeItem||t.previousActiveItem||this.element.querySelector(t.itemSelector)||super.focusElement}}captureFocusItem(e){const t=this.getEventRecord(e),n=super.captureFocusItem(e);return(e=!0)=>{const r=t&&this.getEventElement(t);r?e?r.focus():a.focusWithoutScrolling(r):null==n||n(e)}}refresh(){this.refreshSoon.cancel(),this.month&&this.element.style.setProperty("--week-length",this.month.weekLength),this.whenVisible("refreshNow")}refreshNow(){const e=this.captureFocus();this.doRefresh(),e()}get displayName(){return h.capitalize(this.title||this.type)}get hiddenNonWorkingDays(){return this.hideNonWorkingDays?this.nonWorkingDays||this.month.nonWorkingDays:_t}changeAutoCreate(t){const n=e.$meta.config.autoCreate;return!0===t?n:("string"==typeof t&&(t={gesture:t}),S.merge(t,n))}updateDateSeparator(){this.refreshCalendarDescription()}updateDescriptionFormat(){this.refreshCalendarDescription()}refreshCalendarDescription(){const{calendar:e}=this;null!=e&&e.isPainted&&e.activeView===this&&e.updateViewDescription()}changeShortEventDuration(e){return isNaN(e)?t.as("ms",e):Number(e)}updateShortEventDuration(){this.isConfiguring||this.refresh()}updateLocalization(){"weekStartDay"in this.initialConfig||(this.weekStartDay=t.weekStartDay),"nonWorkingDays"in this.initialConfig||(this.nonWorkingDays=t.nonWorkingDays),super.updateLocalization(),this.refreshCalendarDescription()}updateAutoCreate(e){this.updateLocalization()}updateWeekStartDay(e){var t;const{refreshCount:n,month:a}=this;null===(t=super.updateWeekStartDay)||void 0===t||t.call(this,e),a&&(a.weekStartDay=e),this.isPainted&&this.refreshCount===n&&this.refresh()}changeNonWorkingDays(e){const t=this;return new Proxy(s.assign({},e),{set(e){const n=Reflect.set(...arguments);return t.updateNonWorkingDays(e),n},deleteProperty(e){const n=Reflect.deleteProperty(...arguments);return t.updateNonWorkingDays(e),n}})}updateNonWorkingDays(e){var t;const{refreshCount:n,month:a}=this;null===(t=super.updateNonWorkingDays)||void 0===t||t.call(this,e),a&&(a.nonWorkingDays=e),this.isPainted&&this.refreshCount===n&&this.refresh()}dayOfDate(e){return t.clearTime(e)}ingestDate(e){if(e="string"==typeof e?t.parse(e):new Date(e),isNaN(e))throw new Error("Calendar widget date ingestion must be passed a Date, or a YYYY-MM-DD date string");return this.dayOfDate(e)}changeDate(e,t){if(e=this.ingestDate(e),this.isInIsValidTargetDate||this.isValidTargetDate(e))return(!t||e-t)&&!1!==this.trigger("beforeDateChange",{date:e,oldDate:t})?e:void 0}isValidTargetDate(e,t){var n,a;const r=this,i=r.minDate||(null===(n=r.calendar)||void 0===n?void 0:n.minDate),s=r.maxDate||(null===(a=r.calendar)||void 0===a?void 0:a.maxDate);if(!isNaN(i)||!isNaN(s)){this.isInIsValidTargetDate=!0;const n=t?r[`change${h.capitalize(t)}Date`](e,null):e;if(r.isInIsValidTargetDate=!1,!isNaN(i)&&n<i)return!1;if(!isNaN(s))return!("end"===t?n>s:n>=s)}return!0}changeStartDate(e){if(e&&(e=this.ingestDate(e),this.isInIsValidTargetDate||this.isValidTargetDate(e,"start")))return e}changeEndDate(e){if(e&&(e=this.ingestDate(e),this.isInIsValidTargetDate||this.isValidTargetDate(e,"end")))return e}async scrollTo(e,n={animate:!0}){const i=this,{scrollable:s}=i;let o=Ft;if(i.scrollPromise&&await i.scrollPromise,e.isEvent){const n=e;t.intersectSpans(i.startDate,i.endDate,e.startDate,e.endDate)||(i.date=e.startDate),(e=i.getEventElement(e))||(i.refresh(),e=i.getEventElement(n))}else e=i.changeDate(e),t.betweenLesser(e,i.startDate,i.endDate)&&i.getDayElement(e,!0)||(i.date=e),e=i.getDayElement(e);return s?o=s.scrollIntoView(e,n):n.highlight&&("boolean"==typeof n.highlight?a.highlight(r.from(e)):i.callback(n.highlight,i,[e,i])),i.scrollPromise=o}async checkAutoCreateGesture(e,t){var n,a;if(t&&this.isVisible&&!this.readOnly&&e.type===(null===(n=this.autoCreate)||void 0===n||null===(a=n.gesture)||void 0===a?void 0:a.toLowerCase()))return this.createEvent(t)}createEvent(e){var t;(this.calendar||(null===(t=this.owner)||void 0===t?void 0:t.calendar)||this).doCreateEvent(e,this)}async doCreateEvent(e,n=this){var a;const r=this.autoCreate;r||(this.autoCreate=!0);const i=this,s=i.calendar||(null===(a=i.owner)||void 0===a?void 0:a.calendar),{eventStore:o}=s,{autoCreate:l,defaultCalendar:d}=i,{modelClass:c}=o,{newName:u}=l,h=t.startOf(e,void 0,void 0,i.weekStartDay),g=isNaN(l.startHour)?t.getTimeOfDay(t.parse(l.startHour,"HH:mm:ss")):1e3*l.startHour*60*60,v=i.isDayView?t.round(e,l.step):t.add(h,g),m=t.parseDuration(l.duration),p=t.as("ms",m),y=t.add(v,p),f=i.resolveCallback(u,i,!1)?i.callback(u,i,[i,v]):u,w={[c.getFieldDataSource("name")]:f,[c.getFieldDataSource("startDate")]:v,[c.getFieldDataSource("endDate")]:y,[c.getFieldDataSource("duration")]:m.magnitude,[c.getFieldDataSource("durationUnit")]:m.unit,allDay:1===t.diff(v,y,"day")},D=o.createRecord(w);null!=s&&s.features.eventEdit&&!s.features.eventEdit.disabled&&(D.isCreating=!0),d&&o.assignmentStore.assignEventToResource(D,d),await o.addAsync(D),n.editAutoCreatedEvent(D),r||(i.autoCreate=!1)}editAutoCreatedEvent(e){this.trigger("eventAutoCreated",{eventRecord:e})}get duration(){return this.endDate?this.calculateDuration(this.startDate,this.endDate):1}calculateDuration(e,n){return t.diff(e,n,"day")}next(){this.date=t.add(this.date,this.duration,"day")}previous(){this.date=t.add(this.date,-this.duration,"day")}get eventContentElement(){return this.contentElement}get firstVisibleCell(){return this.eventContentElement.querySelector(this.visibleCellSelector)}get lastVisibleCell(){const e=this.contentElement.querySelectorAll(this.visibleCellSelector);return e[e.length-1]}get firstVisibleDate(){const e=new Date(this.startDate),{month:t}=this.month;for(;this.hideOtherMonthCells&&e.getMonth()!==t||this.hiddenNonWorkingDays[e.getDay()];)e.setDate(e.getDate()+1);return e}get lastVisibleDate(){const e=t.add(this.endDate,-1,"d"),{month:n}=this.month;for(;this.hideOtherMonthCells&&e.getMonth()!==n||this.hiddenNonWorkingDays[e.getDay()];)e.setDate(e.getDate()-1);return e}updateHideNonWorkingDays(e){var t,n;const a=this,{month:r,calendar:i}=a;if(null===(t=a.contentElement)||void 0===t||t.classList[e?"add":"remove"](a.hideNonWorkingDaysCls),null==r)return;let s,o,l;var d;!a.isConfiguring&&e&&(o=a.date,l=null===(d=o)||void 0===d?void 0:d.getDay(),o&&a.nonWorkingDays[l]&&a.getDayElement(o)&&(s=r.visibleDayColumnIndex[l]));if(r.hideNonWorkingDays=e,null===(n=super.updateHideNonWorkingDays)||void 0===n||n.call(this,e),"number"==typeof s){const e=r.getWeekStart(r.getWeekNumber(o)),t=Math.min(s,r.visibleColumnCount-1);for(let n=-1;"number"!=typeof r.visibleDayColumnIndex[e.getDay()]||++n!==t;e.setDate(e.getDate()+1));a.date=e,i&&(i.date=o)}}onCalendarStoreChange({source:e,action:t}){const n=this;var a;("dataset"!==t||e.isChained)&&(n.project.isInitialCommitPerformed&&!n.project.isWritingData&&(null===(a=n._cellMap)||void 0===a||a.clear(),n.refreshSoon()))}refreshSoon(){this.refresh()}onEventCreated(e){}getEventRecord(e){var t;let n=e instanceof Event?e.target:e;return n=(null===(t=n)||void 0===t?void 0:t.closest("[data-event-id]"))||null,n&&this.eventStore.getById(n.dataset.eventId)}resolveEventRecord(e){return this.getEventRecord(e)}getDateFromElement(e){let t=null==e?void 0:e.closest("[data-date],[data-header-date],[data-month-date]");return t?this.dayTime.parseKey(t.dataset.date||t.dataset.headerDate||t.dataset.monthDate):(t=null==e?void 0:e.closest("[data-week]"),t?null===(n=this.month)||void 0===n?void 0:n.getWeekStart(t.dataset.week.split(",").map(Number)):void 0);var n}getDateFromDomEvent(e){return this.getDateFromElement(a.getEventElement(e))}getDateFromPosition(){return null}dateKey(e){return t.makeKey(e)}getDayElement(e,t){return"string"!=typeof e&&(e=this.dateKey(e)),this.eventContentElement.querySelector(`[data-date="${e}"]`)}getEventElement(e,t=Math.max(e.startDate,this.firstVisibleDate||this.startDate)){var n;const r=this,i=null===(n=r.calendar)||void 0===n?void 0:n.navigator.activeItem,s=r.getDateFromElement(i),o=r.eventStore.modelClass.asId(e);if(document.contains(i)&&(null==i?void 0:i.dataset.eventId)===String(o)&&s&&!(t-s))return i;if(t){const e=r.getDayElement(t);if(e)return a.down(e,`[data-event-id="${o}"]`)}return r.getEventElements(e)[0]}getEventElements(e){const t=this.eventStore.modelClass.asId(e);return this.eventContentElement.querySelectorAll(`[data-event-id="${t}"]`)}onEventMouseOverOut(e){const t=this,{currentOverEventEl:n}=t,a="mouseout"===e.type,r=e[a?"relatedTarget":"target"],i=(null==r?void 0:r.closest(".b-cal-event-wrap"))||null;if(i!==(n||null))return a?(t.currentOverEventEl=null,n&&Object.defineProperty(e,"target",{configurable:!0,get:()=>n}),t.onCalendarPointerInteraction(e)):(t.currentOverEventEl=i,t.onCalendarPointerInteraction(e))}calendarHitTest(e){const t=this,{monthSelector:n}=t,r=t.getDateFromDomEvent(e),i=a.getEventElement(e);let s,o=null;if(s=i.closest(".b-cal-event-wrap"))o={type:"event",eventElement:s,eventRecord:t.eventStore.getById(s.dataset.eventId)};else if(s=i.closest(t.dayNameSelector))o={type:"dayNumber",dayNumberElement:s};else if(s=i.closest(".b-week-num,.b-week-number-cell")){const e=i.closest(".b-calendar-week");e&&e.dataset.week&&(o={type:"weekNumber",week:e.dataset.week.split(",").map(Number),weekNumberElement:s,weekElement:e})}else n&&i.closest(n)&&(o={type:"monthName",month:r.getMonth(),date:r});return o||((s=i.closest(".b-cal-cell-overflow"))?o={type:"cellOverflow",cellOverflowElement:s}:r&&(o={type:"schedule"})),o&&(o.cell=i.closest(".b-calendar-cell"),o.date=r,o.view=t),o}onCalendarPointerInteraction(e){const t=this,{monthSelector:n}=t,{target:a}=e,r=Boolean(a.closest(".b-overflowpopup")),i=Bt[e.type],s=t.getDateFromDomEvent(e),o=a.closest(".b-cal-event-wrap"),l=o?t.eventStore.getById(o.dataset.eventId):t.getEventRecord(a),d=o||l&&t.getEventElement(l,s),c=a.closest("[data-resource-id]"),u=c&&t.resourceStore.getById(c.dataset.resourceId);let h;if(u&&(h=t.trigger(`resource${i}`,{domEvent:e,date:s,eventElement:d,eventRecord:l,resourceRecord:u,fromOverflowPopup:r})),r||t.eventContentElement.contains(a)){if(!1!==h&&l){const n=t.trigger(`event${i}`,{domEvent:e,date:s,eventElement:d,eventRecord:l,resourceRecord:u,fromOverflowPopup:r});n&&(h=n)}if(l||u)return h;if(a.closest(t.dayNameSelector)&&(h=t.trigger(`dayNumber${i}`,{domEvent:e,date:s,cellData:t.cellMap.get(s)||t.createCellData(s),fromOverflowPopup:r}),!1===h))return h;if(a.closest(".b-week-num,.b-week-number-cell")){const n=e.target.closest("[data-week]");if(n)return t.trigger(`weekNumber${i}`,{domEvent:e,week:n.dataset.week.split(",").map(Number),date:t.getDateFromElement(n.querySelector(".b-calendar-cell")),fromOverflowPopup:r})}if(n&&a.closest(n))return t.trigger(`monthName${i}`,{domEvent:e,month:s.getMonth(),date:s,fromOverflowPopup:r});if(!a.closest(".b-cal-cell-overflow")||!1===t.trigger(`cellOverflow${i}`,{domEvent:e,date:s,fromOverflowPopup:r}))return s&&t.dayCellCls&&e.target.closest(`.${t.dayCellCls}`)&&(h=t.trigger(`schedule${i}`,{domEvent:e,date:s,fromOverflowPopup:r}),!1===h)||t.checkAutoCreateGesture(e,s),h}}onCalendarKeyDown(e){var t,n,a;e.ctrlKey&&"z"===e.key.toLowerCase()&&null!==(t=this.calendar)&&void 0!==t&&t.enableUndoRedoKeys?null===(n=this.project)||void 0===n||null===(a=n.stm)||void 0===a||a.onUndoKeyPress(e):this.onCalendarPointerInteraction(e)}isAllDayEvent(e){return e.allDay||(e.isScheduled&&this.dayTime?this.dayTime.isInterDay(e):e.isInterDay)}sortEvents(e){e.sort(this.eventSorter)}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.calendar,delete e.project}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.project,t}},e(i,"$name","CalendarMixin"),i};const Yt=({key:e},{key:t})=>e<t?-1:t<e?1:0,qt=e=>e.endDate||t.add(e.startDate,e.duration,e.durationUnit);var Ut=e=>class extends(e||c){static get $name(){return"DayCellCollecter"}static get configurable(){return{eventFilter:null}}get dayTime(){return k.MIDNIGHT}get cellMonth(){return this._cellMonth||(this._cellMonth=new ye({}))}createCellMap(e={}){const n=this,{filter:a,skipPropagate:r}=e,{eventFilter:i,cellMonth:o,lastVisibleDate:l}=n,d=e.cellMap||n._cellMap||(n._cellMap=new Kt);l&&l.setDate(l.getDate()+1);let c=e.startDate||n.firstVisibleDate||n.startDate,u=e.endDate||l||n.endDate;if(o.configure({weekBase:null,weekStartDay:n.weekStartDay,nonWorkingDays:n.nonWorkingDays,hideNonWorkingDays:n.hideNonWorkingDays,sixWeeks:n.sixWeeks,date:c}),n.eventStore){e=s.assign({dayTime:k.MIDNIGHT},e,{filter:a&&i?e=>a(e)&&i(e):a||i,dateMap:d,startDate:c,endDate:u}),n.collectEvents(e),c=e.startDate,u=e.endDate;for(const[a,i]of d){let s=0;n.sortEvents(i);const o=e.dayTime,l=o.dayOfDate(t.parseKey(a)),h=n.createCellData(l);if(e.rawEvents?(s=Math.min(u,Math.max.apply(Math,i.map(qt))),h.events=i):h.events=i.map((e=>{const t=e.endingDate,a=t>h.tomorrow,i={isAllDay:n.isAllDayEvent(e),isOverflow:e.startDate<h.date&&l-c,eventRecord:e,eventEndDate:t,overflows:a,date:l};return r||(s=Math.min(u,Math.max(s,t)),a&&(i.propagateEndDate=n.calculatePropagateEndDate(i,u))),i})),!r)for(;l<s;l.setDate(l.getDate()+1)){const e=o.dateKey(l);d.has(e)||d.set(e,[])}d.set(a,h)}if(d.size){const e=[...d.values()].sort(Yt);let t;d.clear(),e.forEach((e=>{d.set(e.key,e),t&&(t.nextEvents=e,e.previousEvents=t),t=e})),r||n.propagateCellEvents(e[0],d)}}return d.populated=!0,d}calculatePropagateEndDate(e,n=this.endDate){const{eventEndDate:a}=e,r=this.dayTime.startOfDay(a);return e.propagateEndDate=new Date(Math.min(a>r?t.add(r,1,"day"):a,n)),this.trigger("eventPropagate",e),e.propagateEndDate}collectEvents(e){return this.eventStore.getEvents(e)}propagateCellEvents(e,n){const{events:a,renderedEvents:r,previousEvents:i,nextEvents:s,date:o}=e,l=this.getEventsPerCell(o),{length:d}=a;for(let t=0;t<d;t++){const n=a[t],{eventRecord:i,propagateEndDate:o,eventEndDate:l}=n;let d=r.add(n);if(n.overflows){let t,a=e.visible;for(let e=s;e&&e.date<o;e=e.nextEvents)e.columnIndex||(d=e.renderedEvents.firstFreeSlot),e.renderedEvents.set(d,t={eventRecord:i,eventEndDate:l,propagateEndDate:o,isAllDay:n.isAllDay,isOverflow:a,overflows:!0}),a=a||e.visible;t&&(t.overflows=!1)}}e.maxRow=r.length;const c=r[l-1];if(r.length===l)null!=c&&c.isOverflow&&null!=i&&i.hasOverflow&&(e.maxRow--,e.hasOverflow=!0);else if(r.length>l&&(e.maxRow=l-1,e.hasOverflow=!0,null!=c&&c.isOverflow)){const a=this.firstVisibleDate,r=t.clearTime(c.eventRecord.startDate).valueOf();let i=n.get(t.makeKey(new Date(Math.max(a,r))));for(;i.key!==e.key;)i.hasOverflow=!0,i.maxRow=l-1,i=i.nextEvents}s&&this.propagateCellEvents(s,n)}createCellData(e){return Object.assign(this.cellMonth.getCellData(e,this.month,this.dayTime),{events:[],renderedEvents:new Pt})}};class Kt extends Map{constructor(...t){super(...t),e(this,"populated",!1)}get(e,n){return super.get(t.makeKey(e),n)}set(e,n){return e=t.makeKey(e),this.has(e)||(this.generation=(this.generation||0)+1),super.set(e,n)}delete(e,n){return e=t.makeKey(e),this.has(e)&&this.generation++,super.delete(e,n)}has(e){return super.has(t.makeKey(e))}clear(){return this.populated=!1,this.generation=(this.generation||0)+1,super.clear()}}class Gt extends R{static get $name(){return"OverflowPopup"}static get type(){return"overflowpopup"}static get configurable(){return{textContent:!1,autoShow:!1,floating:!1,cls:"b-cal-event-list",closable:!0,draggable:{handleSelector:":not(.b-cal-event-wrap)"},anchor:!0,layout:"vbox",eventRenderer:null,eventSorter:Ht.interDaySorterFn,eventList:{type:"widget",cls:"b-cal-event-bar-container",weight:500},items:{},tools:{maximize:null},dateFormat:"dddd, MMM DD",activeDate:{$config:{equal:"date"},value:null},scrollAction:"hide",align:{axisLock:"flexible",constrainPadding:20,minHeight:400},scrollable:{overflowY:"auto"},onlyShowOverflow:null}}calendarHitTest(e){const t=a.getEventElement(e).closest(".b-cal-event-wrap");return t?{type:"event",eventElement:t,eventRecord:this.owner.eventStore.getById(t.dataset.eventId),view:this}:null}onHeaderClick({event:e}){var t;e.target.closest(".b-header-title")?null===(t=this.owner)||void 0===t||t.trigger("dayNumberClick",{domEvent:e,date:this.activeDate,cellData:this.cellData,source:this.owner,fromOverflowPopup:!0}):super.onHeaderClick(...arguments)}get focusElement(){var e,t;const n=a.getActiveElement(this);return this.element.contains(n)?n:(null===(e=this.eventList)||void 0===e||null===(t=e.element)||void 0===t?void 0:t.firstElementChild)||super.focusElement}getDateFromPosition(){return this.activeDate}getEventElement(e){return this.contentElement.querySelector(`[data-event-id="${e.id}"]`)}showOverflow(e,t){const n=this.activeDate=t.date;var a;(this.cellData=t,this.targetCell=e,this.refresh(t),this.showBy(e),this.isVisible)&&(null===(a=this.owner)||void 0===a||a.trigger("showOverflowPopup",{cell:e,cellData:t,date:n,overflowPopup:this}))}onCalendarStoreChange(){const e=this;e.isVisible&&(e.cellData=e.owner.cellMap.get(t.makeKey(e.activeDate)),e.refresh(e.cellData))}refresh(e){var t,a;if(!this.eventList)return;e?this.cellData=e:e=this.cellData;const r=this,{owner:i,eventRenderer:s}=r,{element:o}=r.eventList,l=r.onlyShowOverflow?Math.max(i.eventsPerCell-1,0):0,d=null===(t=e)||void 0===t?void 0:t.renderedEvents.slice(l).sort(r.eventSorter),c=[];if(null==d||!d.length||(null===(a=e)||void 0===a||!a.hasOverflow)&&!i.isYearView)return r.hide();for(let t=0,n=0,{length:a}=d;t<a;t++,n++){const n=d[t];if(n){const t=i.createEventDomConfig(n,s);Object.assign(t.className,{"b-continues-past":n.eventRecord.startDate<e.date,"b-continues-future":n.eventRecord.endDate>e.tomorrow}),t.style.marginBottom=`${i.eventSpacing}px`,c.push(t)}}n.sync({domConfig:{children:c},targetElement:o}),o.dataset.date=e.key,o.classList.add(`b-day-of-week-${e.day}`),o.classList.remove(`b-day-of-week-${r.lastRefreshDay}`),r.lastRefreshDay=e.day,r.realign()}changeItems(e){const{eventList:t}=this;t&&(e.eventList=t);const n=super.changeItems(e);return t&&(this.eventList=this.widgetMap.eventList),n}changeActiveDate(e,n){if(e="string"==typeof date?t.parse(e):new Date(e),isNaN(e))throw new Error("OverflowPopup date ingestion must be passed a Date, or a YYYY-MM-DD date string");return e}updateActiveDate(e){this.element.dataset.date=t.makeKey(e),this.title=t.format(e,this.dateFormat)}onDocumentMouseDown({event:e}){var t;const n=null===(t=this.lastAlignSpec)||void 0===t?void 0:t.target,{target:a}=e;if(null!=n&&n.contains(a)){const t=a.closest(".b-cal-cell-overflow");if(a.closest(".b-cal-event-bar-container")||a.matches(".b-cal-cell-overflow")||1===(null==t?void 0:t.children.length))return e.preventDefault()}super.onDocumentMouseDown(...arguments)}}Gt.initClass(),Gt._$name="OverflowPopup";const Zt=()=>{},{eventNameMap:Xt}=m;var Qt=e=>class extends(e||c){static get $name(){return"DayCellRenderer"}static get configurable(){return{monitorResize:!0,dayCellRenderer:null,dynamicHideNonWorkingdayCls:"b-dynamic-nonworking-day",overflowPopup:{$config:["lazy","nullify"],value:{type:"overflowpopup"}},overflowPopupTrigger:"click",eventBarContainerCls:"b-cal-event-bar-container",overflowButtonRenderer:null,dayCellNameFormat:null,eventSpacing:2,emptyCellCls:"b-cal-empty-cell",emptyCellRenderer:null}}onCalendarStoreChange(){var e;super.onCalendarStoreChange(...arguments),null!==(e=this._overflowPopup)&&void 0!==e&&e.isVisible&&this._overflowPopup.onCalendarStoreChange(...arguments)}onCellOverflowGesture({domEvent:e,date:n}){const a=this,r=a.cellMap.get(t.makeKey(n));if(r){const{overflowPopup:t}=a,i=a.getCellFromEvent(e);t&&a.trigger("beforeShowOverflowPopup",{cell:i,cellData:r,date:n,overflowPopup:t})&&t.showOverflow(i,r)}}getCellFromEvent(e){return e.target.closest(".b-calendar-cell[data-date]")}updateOverflowPopupTrigger(e){this.onCellOverflowClick=this.onCellOverflowMouseOver=Zt,"mouseover"!==(e=e.toLowerCase())&&"hover"!==e||(e="mouseOver"),this[`onCellOverflow${h.capitalize(e)}`]=this.onCellOverflowGesture}changeOverflowPopup(e,t){const n=this,a=n.up("calendar")||n.owner||n,r=Gt.reconfigure(t,e,{owner:n,defaults:{owner:n,align:{constrainTo:globalThis}}});if(r){const{element:e}=r,{eventHeightInPixels:i}=n;r.element.classList.add(`b-${n.type}-overflowpopup`),r.floating||(r.positioned=!0,r.render(a.isCalendar?a.element:a.contentElement)),i&&(e.style.setProperty("--event-height",`${i}px`),e.style.setProperty("--arrow-width",i/3+"px")),r!==t&&a!==n&&(m.on({thisObj:n,element:r.bodyElement,delegate:".b-cal-event-wrap",mouseover:"onEventMouseOverOut",mouseout:"onEventMouseOverOut",mousedown:"onCalendarPointerInteraction",mouseup:"onCalendarPointerInteraction",click:"onCalendarPointerInteraction",dblclick:"onCalendarPointerInteraction",contextmenu:"onCalendarPointerInteraction"}),r.headerElement&&m.on({thisObj:n,element:r.headerElement,mousedown:"onCalendarPointerInteraction",mouseup:"onCalendarPointerInteraction",click:"onCalendarPointerInteraction",dblclick:"onCalendarPointerInteraction",contextmenu:"onCalendarPointerInteraction"}))}return r}onInternalResize(e,t,n,a,r){const{_eventsPerCell:i,_eventContainerTop:s}=this;super.onInternalResize(e,t,n,a,r),this.rendered&&n!==r&&this.performResizeRefresh(i,s)}performResizeRefresh(e,n,a){this._eventsPerCell=this._eventContainerTop=this._eventContainerHeight=null;const r=this,{eventsPerCell:i,_overflowPopup:s}=r;i!==e&&r.trigger("eventsPerCellChange",{value:i,oldValue:e}),r.eventContainerTop===n&&i===e||(a?r.doRefresh():r.refresh(),null!=s&&s.isVisible&&s.refresh(r._cellMap.get(t.makeKey(s.activeDate))))}updateEventHeight(){super.updateEventHeight(...arguments),this._eventsPerCell=null}updateEventSpacing(){this._eventsPerCell=null,this.isConfiguring||this.refreshSoon()}get weeksElement(){return this.contentElement}get eventContainerHeight(){if(null==this._eventContainerHeight&&this.isVisible&&!this.isConfiguring){const{firstVisibleCell:e}=this;this._eventContainerHeight=e?e.offsetHeight-this.eventContainerTop:NaN}return this._eventContainerHeight}get eventContainerTop(){const e=this;if(null==e._eventContainerTop&&e.isVisible&&!e.isConfiguring){const{firstVisibleCell:t}=e,n=t&&t.querySelector(`.${e.eventBarContainerCls}`),a=n?n.getBoundingClientRect().top-n.offsetParent.getBoundingClientRect().top:0;e._eventContainerTop=0===a?null:a}return e._eventContainerTop||0}getEventsPerCell(e){return this.eventsPerCell}get eventsPerCell(){const e=this;return null==e._eventsPerCell&&(e._eventsPerCell=Math.floor((e.eventContainerHeight+e.eventSpacing)/(e.eventHeightInPixels+e.eventSpacing))),e._eventsPerCell}get cellMap(){var e;return null!==(e=this._cellMap)&&void 0!==e&&e.populated?this._cellMap:this.createCellMap()}cellRenderer({cell:e}){const t=this.getCellDomConfig(...arguments);n.sync({domConfig:t,targetElement:e})}getCellDomConfig({cell:e,columnIndex:n,row:r,date:i,day:o,dayTime:l=k.MIDNIGHT,visibleColumnIndex:d,key:c}){var u;const h=this,{eventHeightInPixels:g,eventSpacing:m,weekLength:p,todayCls:y,emptyCellRenderer:f}=h,w=h.dayTime.startOfDay((null===(u=h.calendar)||void 0===u?void 0:u.dateTimeNow)||new Date),D=i.getTime()===w.getTime(),C=i.getDate(),E={className:h.eventBarContainerCls,role:"presentation",children:[],syncOptions:{syncIdField:"eventId",releaseThreshold:0,strict:!0}},S={style:{},className:new v({"b-cal-cell-header":!0,[y]:D})},R={dataset:{},style:{},className:new v(null==e?void 0:e.className),children:[S,E]},x=!(i-(h.firstVisibleDate||-1));R.className[y]=D;let M,T,N=!h.isConfiguring&&h.cellMap.get(t.makeKey(i));if(h.addCellHeaderContent?M=h.addCellHeaderContent(S,N||(N=h.createCellData(i))):S.children=[M={className:{"b-day-name":!0}}],h.dayCellRenderer&&!h.isConfiguring){N||(N=h.createCellData(i)),N.style=R.style,N.cls=R.className,N.headerStyle=S.style,N.headerCls=S.className;const e=N&&N.isNonWorking,t=h.callback(h.dayCellRenderer,h,[N,R]);"string"==typeof N.cls&&(R.className=new v(N.cls)),"string"==typeof N.style&&(R.style=a.parseStyle(N.style)),"string"==typeof N.headerCls&&(S.className=new v(N.headerCls)),"string"==typeof N.headerStyle&&(S.style=a.parseStyle(N.headerStyle)),null!=t&&("string"==typeof t?M.html=t:(M.text=null,M.children=b.asArray(t))),T=!e&&N.isNonWorking}if(M&&(M.text||M.html||(M.text=h.dayCellNameFormat?t.format(i,h.dayCellNameFormat):C),(M.text||M.html)==C&&(M.className["b-day-num"]=!0)),N.visible){const{hasOverflow:e,renderedEvents:c,maxRow:u}=N,v=c,{length:y}=v,w=E.children;R.className[h.nonWorkingDayCls]=N.isNonWorking,R.className[h.dynamicHideNonWorkingdayCls]=T,R.className[h.weekendCls]=t.weekends[o];for(let e=0,t=0;e<u;e++,t++){const n=v[e];if(n){const{eventRecord:e,isOverflow:r,propagateEndDate:o}=n,c=n.eventEndDate||e.endingDate,u=h.getDaySpan(i,o||c,l),v=h.getDaySpan(i,c,l,!0),y=p-d,f=d&&r,D=a.percentify(s.round((f?1:Math.min(u,y))/p*100,4)),C=h.createEventDomConfig(n);Object.assign(C.style,{width:D,top:`${t*g+t*m+h.eventContainerTop}px`}),Object.assign(C.className,{"b-overflow":f,"b-continues-past":!f&&(!d||x)&&e.startDate<i,"b-continues-future":!f&&(v>y||v>u)}),w.push(C)}}e?(r.classList.add("b-has-overflow"),R.children.push(h.getOverflowButtonDomConfig(y-Math.max(0,u)))):n||r.classList.remove("b-has-overflow");if((R.className[h.emptyCellCls]=!v.length)&&f){const e=typeof f,t="function"===e||"string"===e?h.resolveCallback(f,h,!1):null;(null!=t&&t.handler?t.handler.call(t.thisObj,N):f)&&(E.children[0]={tag:"button",class:"b-cal-cell-no-content",children:[null!=t&&t.handler?t.handler.call(t.thisObj,N):f]})}}return R}onCalendarPointerInteraction(e){const t=this,{target:n}=e;return!(n.closest(`.${t.emptyCellCls} .${t.eventBarContainerCls}`)&&(!t.emptyCellRenderer||n.closest(".b-cal-cell-no-content"))&&!1===t.trigger(`emptyCell${Xt[e.type]}`,{date:t.getDateFromDomEvent(e),domEvent:e}))&&super.onCalendarPointerInteraction(e)}getDaySpan(e,n,a,r){if(this.hideNonWorkingDays&&!r){let t=0;for(const r=new Date(e),i=a.ceil(n,"1 day");r<i;r.setDate(r.getDate()+1))this.nonWorkingDays[r.getDay()]||t++;return t}return Math.max(t.diff(e,a.ceil(n,"1 day"),"day"),1)}getOverflowButtonDomConfig(e){const{overflowButtonRenderer:t}=this,n={tag:"button",className:{"b-cal-cell-overflow":1},text:this.L("L{Calendar.plusMore}",e),style:{lineHeight:`${this.eventHeightInPixels}px`,marginBottom:`${this.eventSpacing}px`},dataset:{eventId:"overflow"}};return t?this.callback(t,this,[n,e]):n}getCell(e){return"string"!=typeof e&&(e=this.dayTime.dateKey(e)),this.contentElement.querySelector(`[data-date="${e}"]`)}getCellOverflowButton(e){var t;return null===(t=this.getCell(e))||void 0===t?void 0:t.querySelector(".b-cal-cell-overflow")}};const Jt={day:1,week:1,month:1,year:1,decade:1},en=(e,t)=>(null==e?void 0:e.unit)===(null==t?void 0:t.unit)&&(null==e?void 0:e.magnitude)===(null==t?void 0:t.magnitude);var tn=n=>{var a;return e(a=class extends(n||c){previous(){const{range:e}=this;this.date=e?t.add(this.date,-e.magnitude,e.unit):t.add(this.date,-this.duration,"day")}next(){const{range:e}=this;this.date=e?t.add(this.date,e.magnitude,e.unit):t.add(this.date,this.duration,"day")}changeDate(e){if(e=super.changeDate(e||this.startDate),this.isConfiguring||this.isValidRange(this.range,e))return e}updateDate(e){var n;const a=this,{startDate:r,endDate:i,_month:s}=a,o=a.changeStartDate(e),l=null==s?void 0:s.generation;if(!r||o-r)if(a.hasConfig("endDate")){const n=t.diff(r,i,"d");!r||!i||e<r?a.startDate=e:e>=i&&(a.startDate=t.add(e,-(n-1),"day"))}else a.startDate=t.floor(e,a.range,void 0,a.weekStartDay);s&&s.generation===l&&(a._month.date=e),null===(n=super.updateDate)||void 0===n||n.call(this,...arguments)}changeStartDate(e,t){return super.changeStartDate(this.snapDate(this.ingestDate(e)),t)}updateStartDate(e,n){var a;const r=this,{refreshCount:i,_month:s}=r;if(r.date||(r.date=e),s&&(s.date=e),null===(a=super.updateStartDate)||void 0===a||a.call(this,...arguments),r.hasConfig("endDate")){const a=t.diff(n||e,r.endDate,"day");r.endDate=t.add(e,a,"day")}var o;r.isConfiguring||r.refreshCount===i&&(null===(o=r._cellMap)||void 0===o||o.clear(),r.refresh())}changeEndDate(e,t){return super.changeEndDate(this.snapDate(this.ingestDate(e),!0),t)}get range(){return this.hasConfig("endDate")?null:this._range}get endDate(){return this.hasConfig("endDate")?this._endDate:this.startDate&&t.add(this.startDate,this.range.magnitude,this.range.unit)}snapDate(e,n){const a=this.hasConfig("endDate")?null:this.range;return a&&"day"!==a.unit&&e?t[n?"ceil":"floor"](e,a,void 0,this.weekStartDay):e}changeRange(e){if(e){if("string"==typeof e)e=t.parseTimeUnit(e)?{magnitude:1,unit:e}:t.parseDuration(e);else if("number"==typeof e)return{magnitude:e,unit:"day"};if(!Jt[e.unit])throw new Error("Range must be in days, weeks, months, years or decades");if(this._date&&!this.isValidRange(e))return}return e}isValidRange(e,t=this.date){var n,a;const r=this.minDate||(null===(n=this.calendar)||void 0===n?void 0:n.minDate),i=this.maxDate||(null===(a=this.calendar)||void 0===a?void 0:a.maxDate);if(e&&!isNaN(r)||!isNaN(i)){const n=this.calculateDateRange(e,t);if(!isNaN(r)&&n.startDate<r)return!1;if(!isNaN(i)&&n.endDate>i)return!1}return!0}updateRange(e){const t=this,{date:n}=t;e&&n&&!t.hasConfig("endDate")&&(t.startDate=n)}calculateDateRange(e,n){if(n)return"day"!==e.unit?{startDate:t.floor(n,e,void 0,this.weekStartDay),endDate:t.ceil(t.add(n,1,"day"),e,void 0,this.weekStartDay)}:{startDate:n,endDate:t.add(n,e.magnitude,"day")}}changeMonth(e){var t;const n=this,{date:a}=n;return super.changeMonth?super.changeMonth(...arguments):(null!==(t=e)&&void 0!==t&&t.isMonth||(e=new ye({date:a,weekStartDay:n.weekStartDay,hideNonWorkingDays:n.hideNonWorkingDays,nonWorkingDays:n.nonWorkingDays}),null==n.nonWorkingDays&&(n.nonWorkingDays=e.nonWorkingDays),null==n.weekStartDay&&(n.weekStartDay=e.weekStartDay)),e)}get dateBounds(){return[this.startDate,this.lastDate]}get duration(){const{range:e}=this;return e?t.as("d",e.magnitude,e.unit):super.duration}get lastDate(){const e=this.endDate;return e&&t.add(e,-1,"day")}},"$name","DateRangeOwner"),e(a,"configurable",{month:!0,date:{$config:{equal:"date"},value:null},range:{$config:{lazy:!0,equal:en},value:null},startDate:{$config:{equal:"date"}},endDate:{$config:{equal:"date"}}}),a};const nn=Object.freeze({}),an={shrinkwrap:1,expand:1},rn=(e,n,a,r,i)=>{const s=t.format(a,e);return r?`${s}${i?n.trim():n}${t.format(r,e).slice(i?-1:0)}`:s};class sn extends(p.mixin(zt,Ut,Qt,tn)){constructor(...t){super(...t),e(this,"heightAnimation",Promise.resolve)}static get $name(){return"CalendarRow"}static get type(){return"calendarrow"}static get configurable(){return{cls:"b-calendar-days",animate:!0,autoHeight:null,autoRefresh:["dayNameFormat","dayNumberCompress","dayNumberFormat","daySeparator"],descriptionFormat:[!0,!0],dayStartShift:null,dayTime:0,defaultEventRowCount:3,fullWeek:null,minDayWidth:null,scrollable:{overflowX:"hidden",overflowY:"hidden"},headerScroller:{$config:["lazy","nullify"],value:{overflowX:"hidden",overflowY:"hidden"}},dayNameFormat:"ddd",dayNumberCompress:null,dayNumberFormat:"D",daySeparator:"-",responsive:{small:{dayNameFormat:"d1",dayNumberCompress:!0,daySeparator:"/"},"*":{dayNameFormat:"ddd",dayNumberCompress:!1,daySeparator:"-"}},dayNameSelector:".b-cal-cell-header",monitorResize:!1,eventRenderer:null,gutterHeight:null,expanded:null,overflowClickAction:"popup",dayHeaderRenderer:null}}compose(){return{children:{headerElement:{className:"b-calendarrow-header",children:{headerCellContainer:{className:"b-calendarrow-header-container"},scrollPadElement:d({},a.scrollBarPadElement)}},bodyElement:{className:"b-calendarrow-body",children:{cellContainer:{reference:"cellContainer",className:"b-calendarrow-cell-container"}}}}}}onPaint({firstPaint:e}){if(e){const e=this,{fonts:t}=document,n=()=>{e._eventContainerTop=e._eventContainerHeight=null,e.eventStore.count&&e.performResizeRefresh(null,null,!0)};"loaded"!==(null==t?void 0:t.status)&&t.ready.then((()=>!e.isDestroyed&&n())),n()}}changeDaySeparator(e){return Array.isArray(e)?e:[e,e]}changeElement(){const e=super.changeElement(...arguments);return this.scrollable.addPartner(this.headerScroller,"x"),e}changeHeaderScroller(e,t){return e?e=x.new({element:this.headerCellContainer,widget:this},e):null==t||t.destroy(),e}async scrollTo(e){const n=this,{eventFilter:a}=n;return e.isEvent&&(!a||a(e))&&t.intersectSpans(n.startDate,n.endDate,e.startDate,e.endDate)&&(n.getEventElement(e)||n.expanded||n.autoHeight||n.toggleExpandCollapse()),super.scrollTo(...arguments)}updateDate(e,t){var n,a,r;let i=t&&this.getDayHeader(t);null===(n=i)||void 0===n||n.classList.remove("b-selected-date"),null===(a=super.updateDate)||void 0===a||a.call(this,e,t),i=e&&this.getDayHeader(e),null===(r=i)||void 0===r||r.classList.add("b-selected-date")}getDayHeader(e){return"string"!=typeof e&&(e=this.dateKey(e)),this.headerCellContainer.querySelector(`.b-cal-cell-header[data-header-date="${e}"]`)}get overflowElement(){return this.bodyElement}createCellMap(e={}){const t=this,n=t.hideNonWorkingDays?t.nonWorkingDays:nn,{maxEventCount:a}=t,r=s.assign({dayTime:t.dayTime},e),i=super.createCellMap(r);let o,l=0;return i.forEach((e=>{n[e.day]||(o=e),l=Math.max(l,e.renderedEvents.length)})),t.maxEventCount=l,l!==a?(i.clear(),t.createCellMap(r)):(o&&(o.isRowEnd=!0),i)}collectEvents(e){return e=s.assign({dayTime:this.dayTime},e,{getDateIndex:e=>e>(this.firstVisibleDate||this.startDate)?"startDate":"date"}),this.eventStore.getEvents(e)}createCellData(e){const n=this,a=t.diff(n.startDate,e,"day"),r=a;return Object.assign(n.cellMonth.getCellData(e,n.month,n.dayTime),{visibleColumnIndex:r,columnIndex:a,isRowStart:0===r,isRowEnd:!1,renderedEvents:new Pt})}get dayStartShift(){var e,t;return null!==(e=null===(t=this.dayTime)||void 0===t?void 0:t.startShift)&&void 0!==e?e:this._dayStartShift}updateDayStartShift(e){this.element.classList.toggle("b-shifted-day",Boolean(e)),this.dayTime=new k(e)}changeDayTime(e){var t;if(e||(e=new k(this.dayStartShift)),e.isDayTime||(e=new k(e)),null===(t=this._dayTime)||void 0===t||!t.equals(e))return e}dayOfDate(e){return this.dayTime.dayOfDate(e)}updateMinDayWidth(e){const{scrollable:t,headerScroller:n}=this,{element:r}=t;this.contentElement.style.setProperty("--min-day-width",e?a.setLength(e):0),e&&r.scrollWidth>r.clientWidth?t.overflowX=n.overflowX="hidden-scroll":t.overflowX=n.overflowX=!1}updateEventHeight(){super.updateEventHeight(...arguments),this.autoHeight||this.isConfiguring||this.expanded||this.setEventContentHeight(this.cellContentHeight)}updateGutterHeight(){this.isConfiguring||this.setEventContentHeight(this.cellContentHeight)}get stepUnit(){return this.duration>1?`${this.duration} ${this.L("L{DayView.daysUnit}")}`:this.L("L{DayView.dayUnit}")}updateNonWorkingDays(){this.onVisibleDateRangeChange()}updateHideNonWorkingDays(){super.updateHideNonWorkingDays(...arguments),this.onVisibleDateRangeChange()}onCellOverflowGesture({date:e}){an[this.overflowClickAction.toLowerCase()]?this.expanded=!0:super.onCellOverflowGesture(...arguments)}onVisibleDateRangeChange(){var e;this.isConfiguring||(null===(e=this._cellMap)||void 0===e||e.clear(),this.refresh())}changeAutoHeight(e){const t=this,{eventsPerCell:n}=t;t._autoHeight=e,t.setEventContentHeight(t.cellContentHeight),t.performResizeRefresh(n,t.eventContainerTop,!0)}async setEventContentHeight(e,t){const n=this,{cellContainer:r,parent:i}=n;if(n._eventContentHeight!==e){var s;if(!t&&null!=i&&i.isDayView&&null!==(s=i.parent)&&void 0!==s&&s.isResourceView){const t=i.parent.items.map((e=>e.allDayEvents)).filter((e=>e&&e!==n));e=Math.max(e||0,...t.filter((e=>!e.owner.isResourceDayViewTimeAxis)).map((e=>e.calculateCellContentHeight()||0))),null==t||t.forEach((t=>{t.setEventContentHeight(e,!0)}))}const{height:d}=n;let{animate:c}=n;n.isAnimating=c;const u=a.getPropertyTransitionDuration(r,"height");if(u||(n.isAnimating=c=!1),r.style.height=`${e}px`,n.bodyElement.classList.toggle("b-zero-height",!Boolean(e)),c&&await(n.heightAnimation=m.waitForTransitionEnd({property:"height",element:r,duration:u})),!n.isDestroyed){var o,l;const{height:t}=n;n.isAnimating=!1,n._eventContentHeight=e,null===(o=n.owner)||void 0===o||null===(l=o.syncScrollbarPadding)||void 0===l||l.call(o),t!==d&&n.trigger("heightChange",{height:t,oldHeight:d})}}}get hasOverflow(){return!this.autoHeight&&this.maxEventCount>this.defaultEventRowCount}get eventsPerCell(){const e=this,{maxEventCount:t}=e;return e.expanded||e.autoHeight?t:Math.min(t,e.defaultEventRowCount)}get cellContentHeight(){return this.calculateCellContentHeight()}calculateCellContentHeight(){const e=this,{gutterHeight:t}=e;let n=Math.ceil(e.eventContainerTop+e.eventsPerCell*(e.eventHeightInPixels+e.eventSpacing));return t&&(e.eventsPerCell&&(n-=e.eventSpacing),isNaN(t)?n=`calc(${n}px + ${t})`:n+=Number(t)),n}getDateFromPosition(e,t){const n=this,{hideNonWorkingDays:a,contentElement:r}=n,i=r.querySelectorAll(`${n.visibleCellSelector}${a?":not(.b-nonworking-day":""}`),s=r.getBoundingClientRect(),o=n.rtl?s.right-e:e-s.left,l=i.length,{width:d}=s,c=Math.floor(o*l/d);if(o<0||d<o||t<s.top||s.bottom<t)return null;if(n.hideNonWorkingDays){return Array.from(i).map((e=>n.getDateFromElement(e)))[c]}{const e=n.getDateFromElement(i[0]);return e.setDate(e.getDate()+c),e}}async toggleExpandCollapse(){const{expanded:e}=this;await this.updateExpanded(!Boolean(e),e)}async updateExpanded(e,t){const n=this;n._expanded=t;const{eventsPerCell:a}=n;n._expanded=e,n.expanded?(n.performResizeRefresh(a,n.eventContainerTop,!0),await n.heightAnimation):(n.scrollable.overflowY="hidden",await n.setEventContentHeight(n.cellContentHeight),t&&!n.isDestroyed&&n.performResizeRefresh(a,n.eventContainerTop,!0))}doRefresh(){var e,a;null===(e=this._cellMap)||void 0===e||e.clear();const r=this,{dayTime:i,fullWeek:s,startDate:o,endDate:l,headerCellContainer:d,cellContainer:c,dayHeaderRenderer:u}=r,h=(o||l)&&r.cellMap,g=null!==(a=r.nonWorkingDays)&&void 0!==a?a:r.month.nonWorkingDays,v=r.hideNonWorkingDays?g:nn,m=[],p=[],y=[];if(!h)return;let f,w,D,C=0,b=0,E=new Date(o),S=l;s&&(E=r.month.getWeekStart(r.month.getWeekNumber(E)),S=t.add(E,7,"d"));for(const e=E;e<S;e.setDate(e.getDate()+1),C++){const t=h.get(i.dateKey(e))||r.createCellData(e);t.columnIndex=t.cellIndex=C,v[t.day]?t.visibleColumnIndex=void 0:(t.isRowStart=0===b,t.visibleColumnIndex=b,s||b++),m.push(t)}r.weekLength=s?1:b;const k=m.length;for(w=0;w<k;w++){const e=m[w],{day:n,key:a}=e;if(!v[n]){const i=g[n],o=`b-day-of-week-${n}`;f=!(e.date-r.date),e.cell=r.getCell(a),e.row=r.cellContainer;const l=r.getCellDomConfig(e),d=M.merge({dataset:{headerDate:a}},l.children[0]);d.className["b-selected-date"]=f,d.className["b-current-date"]=s&&f,d.className[o]=1,u&&r.callback(u,r,[d,e]),l.dataset.date=a,Object.assign(l.className,{"b-dayview-allday":1,[r.nonWorkingDayCls]:i,[r.weekendCls]:t.weekends[n],[r.dayCellCls]:1,[o]:1}),l.children.shift(),y.push(d),s&&!f||(p.push(l),i||(D=l))}}D&&(D.className["b-last-working-day"]=1),n.sync({targetElement:d,domConfig:{children:y,syncOptions:{releaseThreshold:0,strict:!0}}}),n.sync({targetElement:c,domConfig:{children:p,syncOptions:{releaseThreshold:0,strict:!0}}}),r.refreshCount=(r.refreshCount||0)+1,r.collapseGutter(),r.setEventContentHeight(r.cellContentHeight),r.trigger("refresh")}get eventContainerTop(){return 0}async expandGutter(){const e=this;e._isTemporarilyExpanded||(e.gutterHeight=(e.gutterHeight||0)+e.eventHeightInPixels+e.eventSpacing,await e.setEventContentHeight(e.cellContentHeight),e._isTemporarilyExpanded=!0)}async collapseGutter(){const e=this;e._isTemporarilyExpanded&&(e.gutterHeight=e.gutterHeight-(e.eventHeightInPixels+e.eventSpacing),await e.setEventContentHeight(e.cellContentHeight),e._isTemporarilyExpanded=!1)}addCellHeaderContent(e,n){var a;const r=this,{date:i,day:s,tomorrow:o}=n,{dayNameFormat:l,dayNumberCompress:d,daySeparator:c}=r,u=null==r||null===(a=r.dayTime)||void 0===a?void 0:a.startShift;e.children=[{className:"b-day-name-part b-day-name-day"+(d?" b-day-name-short":""),html:rn(l,c[0],i,u&&o)},{className:"b-day-name-part b-day-name-date",html:rn(r.dayNumberFormat,c[1],i,u&&o,d)}],e.className[r.nonWorkingDayCls]=n.isNonWorking,e.className[r.weekendCls]=t.weekends[s]}updateLocalization(){this.isConfiguring||this.refresh(),super.updateLocalization()}}sn.initClass(),sn._$name="CalendarRow";class on extends sn{afterConfigure(){var e;const n=this,{owner:a}=n;super.afterConfigure(),null===(e=a.scrollable)||void 0===e||e.ion({overflowChange:"onOwnerOverflowChange",thisObj:n}),a.descriptionRenderer=n.descriptionRenderer.bind(n),a.previous=function(){this.date=t.add(a.date,-a.duration,"d")},a.next=function(){this.date=t.add(a.date,a.duration,"d")},g.before(a,"updateDate",this.beforeOwnerDateUpdate,this)}beforeOwnerDateUpdate(e){this.date=e}onOwnerOverflowChange({y:e}){this.headerElement.classList.toggle("b-show-yscroll-padding",Boolean(e))}onDayNumberClick({date:e}){return this.owner&&(this.owner.date=e),!1}descriptionRenderer(){const{startDate:e,endDate:n,owner:a}=this,r=e.getMonth()===n.getMonth()?t.format(e,"MMMM"):`${t.format(e,"MMM")} - ${t.format(n,"MMM")}`,i=a.month.getWeekNumber(e);return`${this.L("L{Object.Week}")} ${i[1]}, ${r} ${i[0]}`}}e(on,"$name","DaySelector"),e(on,"type","dayselector"),e(on,"configurable",{readOnly:!0,autoCreate:!1,flex:"0 0 auto",dock:"top"}),on.initClass(),on._$name="DaySelector";var ln=e=>class extends(e||c){static get $name(){return"CalendarMixin"}static get configurable(){return{daySelector:null}}changeDaySelector(e,t){const n=this;if(e){n.range="1 day",n.settings=null,n.hideHeaders=!0;const a=n.dayTime.shiftDate(n.month.getWeekStart(n.month.getWeekNumber(n.startDate))),r=on.reconfigure(t,e,{owner:n,defaults:{type:"dayselector",calendar:n.calendar,parent:n,cls:{[`b-${n.type}-dayselector`]:1},dayStartShift:n.dayStartShift,dayTime:n.dayTime,month:n.month,date:n.date,startDate:a,range:{magnitude:1,unit:"week"},hideNonWorkingDays:n.hideNonWorkingDays,nonWorkingDays:n.nonWorkingDays,nonWorkingDayCls:n.nonWorkingDayCls,weekendCls:n.weekendCls,weekStartDay:n.weekStartDay}});return n.element.classList.add(`b-${n.type}-with-dayselector`),n.tbar=r,r}null==t||t.destroy()}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.daySelector,t}};const dn=(e,t)=>e.startDate.valueOf()-t.startDate.valueOf(),cn=(e,t)=>{if(t){if(e=e.data||e,s.isObject(e)){const n=t.slice();for(const t in e){const a=e[t],r=n.findIndex((e=>e.id===t||e.field===t));if(a){const e=S.merge(a,n[r]);e.id=t,n[-1===r?n.length:r]=e}else r>-1&&n.splice(r,1)}return n}t=new W({values:t,idProperty:"field"});for(let n=0,{length:a}=e;n<a;n++){const a=e[n],r=t.get(a.field);r&&(e[n]=S.merge(a,r),t.remove(r))}return e.push(...t.values),e}return e};class un extends(Ce.mixin(zt,Ut,ln,tn)){static get $name(){return"EventList"}static get type(){return"eventlist"}static get configurable(){return{cls:"b-slide-vertical",eventFilter:null,localizableProperties:["title","text"],title:"L{List}",range:"1 month",month:!0,columns:{$config:{merge:cn},value:[{text:"L{EventEdit.Name}",field:"name",flex:1},{text:"L{EventList.Start}",type:"date",editor:{type:"datetime",dateField:{step:null},timeField:{step:null}},field:"startDate",width:"16.5em",format:"L LT",renderer({record:e,value:n}){return e.allDay?t.format(n,"L"):this.defaultRenderer(...arguments)}},{text:"L{EventList.Finish}",type:"date",editor:{type:"datetime",dateField:{step:null},timeField:{step:null}},field:"endDate",width:"16.5em",format:"L LT",renderer({record:e,value:n}){return e.allDay?t.format(n,"L"):this.defaultRenderer(...arguments)}},{type:"widget",text:"Resources",field:"resources",minWidth:250,autoHeight:!0,widgets:[{type:"chipview",valueProperty:"items",displayField:"name",itemsFocusable:!1,navigator:null,closable:!1,style:{flexFlow:"row nowrap",display:"flex",padding:"5px 0 3px 0"},scrollable:{overflowX:"hidden-scroll",overflowY:!1},getItemCls:e=>a.isNamedColor(e.eventColor)?` b-sch-${e.eventColor}`:"",getItemStyle:e=>"color:#fff;"+(e.eventColor&&!a.isNamedColor(e.eventColor)?`background-color:${e.eventColor}`:"")}],editor:!1}]},features:{group:!1,rowCopyPaste:!1,columnPicker:{createColumnsFromModel:!0}},internalListeners:{beforeCellEditStart({editorContext:e}){var t,n,a,r;const{editor:i,record:s}=e;if(s.isRecurring||s.isOccurrence)return T.show({html:"Please use EventEdit to edit recurring events"}),!1;null===(t=this.calendar)||void 0===t||null===(n=t.features.eventTooltip)||void 0===n||null===(a=n._tooltip)||void 0===a||a.hide(),null===(r=i.timeField)||void 0===r||r[s.allDay?"hide":"show"]()}},settings:{$config:"lazy",value:null},eventListTimeFormat:"HH:mm"}}static get delayable(){return{populateStoreSoon:{type:"raf",cancelOutstanding:!0}}}doRefresh(){this.refreshRows()}eventListEventTimeRenderer(e){const n=this,a=t.diff(t.clearTime(e.startDate),t.clearTime(e.endDate),"day");return{className:{"b-cal-eventlist-event-time":1},text:n.eventTimeRenderer?n.callback(n.eventTimeRenderer,n,arguments):a>1?n.L("L{Calendar.endsOn}",t.format(e.endDate,"DD MMM")):e.allDay?n.L("L{Calendar.allDay}"):`${t.format(e.startDate,n.eventListTimeFormat)} - ${t.format(e.endDate,n.eventListTimeFormat)}`}}agendaEventDateRenderer(e){return{className:{"b-day-name":1,"b-cal-agenda-date":1,"b-today":!Boolean(t.clearTime(new Date)-t.clearTime(e))},children:[{className:{"b-cal-agenda-date-date-number":1},text:e.getDate()},{className:{"b-cal-agenda-date-date-text":1},children:[{text:t.format(e,"dddd")},{text:t.format(e,"MMM YYYY")}]}]}}destroy(){for(const t of Object.values(this.features)){var e;null===(e=t.destroy)||void 0===e||e.call(t)}super.destroy()}populateHeaderMenu({items:e}){e.listRangeItem={weight:-1e3,icon:"b-icon-calendar-week",text:"List Range",menu:this.listRangeMenu},super.populateHeaderMenu(...arguments)}refreshVirtualScrollbars(){super.refreshVirtualScrollbars(),this.bodyElement.classList[a.scrollBarWidth&&this.hasVerticalOverflow?"add":"remove"]("b-has-scrollbar")}get listRangeMenu(){const e=this,{unit:t}=e.range;if(!e._listRangeMenu){const t=`${e.id}-range-items`;e._listRangeMenu={anchor:!0,onToggle:t=>{t.checked&&(e.range=t.item.range,t.bubbles=!1),a.scrollBarWidth&&t.menu.realign()},items:{listRangeDayItem:{toggleGroup:t,range:"day",text:"L{EventEdit.day}",_unit:"day"},listRangeWeekItem:{toggleGroup:t,range:"week",text:"L{EventEdit.week}",_unit:"week"},listRangeMonthItem:{toggleGroup:t,range:"month",text:"L{EventEdit.month}",_unit:"month"},listRangeYearItem:{toggleGroup:t,range:"year",text:"L{EventEdit.year}",_unit:"year"},listRangeDecadeItem:{toggleGroup:t,range:"decade",text:"L{EventEdit.decade}",_unit:"decade"}}}}for(const n of Object.values(e._listRangeMenu.items))n.checked=n._unit===t;return e._listRangeMenu}updateRowManager(e){var t;null===(t=super.updateRowManager)||void 0===t||t.call(this,...arguments),e.ion({beforeRenderRow:"onBeforeRenderRow",thisObj:this})}onBeforeRenderRow({row:e,record:n}){const{_elementsArray:a}=e,{id:r,startDate:i}=n;if(n.isEventModel){for(let e=0,{length:n}=a;e<n;e++)a[e].dataset.eventId=r,a[e].dataset.date=t.makeKey(i);e.cls[`b-day-of-week-${i.getDay()}`]=1}}onInternalKeyDown(e){}handleEvent(e){this.preventScroll=!0,super.handleEvent(e),this.preventScroll=!1}get displayName(){let e=this.title;return"string"!=typeof e&&(e=this.type),h.capitalize(e)}async scrollTo(e,n={animate:!0}){const r=this;if(e instanceof r.store.modelClass)await r.scrollRowIntoView(e,Object.assign({},n,{highlight:!1})),n.highlight&&(e=r.getEventElement(e,e.startDate),"boolean"==typeof n.highlight?a.highlight(e,r):(r.widget||r).callback(n.highlight,null,[e]));else if(s.isDate(e)&&r.store.count){const a=r.dateIndex,i=t.makeKey(e);if(a[i])await r.scrollRowIntoView(a[i],n),r.scrolledToDate=e;else{let n=Number.MAX_SAFE_INTEGER;const i=Object.keys(a);for(let a=0,{length:r}=i;a<r;a++){const r=t.parseKey(i[a]);Math.abs(r-e)<Math.abs(n-e)&&(n=r)}await r.scrollTo(n)}}}updateStartDate(){const{refreshCount:e}=this;this.preventScroll=!0,super.updateStartDate(...arguments),this.preventScroll=!1,this.isConfiguring||this.refreshCount!==e||this.populateStoreSoon()}updateEndDate(){var e;const{refreshCount:t}=this;null===(e=super.updateEndDate)||void 0===e||e.call(this,...arguments),this.isConfiguring||this.refreshCount!==t||this.populateStoreSoon()}updateRange(){var e;const{refreshCount:t}=this;null===(e=super.updateRange)||void 0===e||e.call(this,...arguments),this.isConfiguring||this.refreshCount!==t||this.populateStoreSoon()}descriptionRenderer(){const e=this,{date:n,startDate:a,endDate:r,range:i,count:s}=e;let o;if(1===i.magnitude)switch(i.unit){case"day":o=t.format(n,"L");break;case"week":{const n=a.getMonth()===r.getMonth()?t.format(a,"MMMM"):`${t.format(a,"MMM")} - ${t.format(r,"MMM")}`,i=e.month.getWeekNumber(a);o=`${e.L("L{Object.Week}")} ${i[1]}, ${n} ${i[0]}`;break}case"month":o=t.format(n,"MMMM, YYYY");break;case"year":o=t.format(n,"YYYY");break;case"decade":o=`${t.format(a,"YYYY")}s`}else o=`${t.format(e.startDate,"L")} - ${t.format(e.endDate,"L")}`;return`${o}. ${e.L("eventCount",s)}`}get count(){return this.store.count}get stepUnit(){const{range:e}=this;return 1===e.magnitude?e.unit:this.range}updateEventStore(e){var t;null===(t=super.updateEventStore)||void 0===t||t.call(this,e),e.ion({refresh:"onCalendarStoreChange",thisObj:this}),this.populateStoreSoon()}changeStore(e){var t;const n=this;return e&&(e=i.mergeConfigs({useRawData:{ignoreDefaults:!0,disableDefaultValue:!0,disableTypeConversion:!0,enabled:!0},modelClass:n.modelClass},e)),null!==(t=e=super.changeStore(e))&&void 0!==t&&t.modelClass.isEventModel&&(n.nonWorkingDaysFilter=e.addFilter({id:`${n.id}-nonworkingday-filter`,filterBy:e=>!n.dayTime.isIntraDay(e)||!n.hiddenNonWorkingDays[e.startDate.getDay()],disabled:!n.hideNonWorkingDays},!0)),e}updateHideNonWorkingDays(e){const t=this,{store:n}=t;super.updateHideNonWorkingDays(e),n&&(t.nonWorkingDaysFilter.disabled=!e,n.filter()),t.trigger("refresh")}afterRemove({records:e}){this.eventStore.remove(e),super.afterRemove(...arguments)}get modelClass(){return this.eventStore.modelClass}populateStoreSoon(){const e=this,{project:t}=e;e.isVisible?(t.isInitialCommitPerformed&&!t.isWritingData||!t.eventStore.count)&&e.populateStore():e.whenVisible("populateStore")}populateStore(){var e;const n=this,a=n.eventStore.getEvents({startDate:n.startDate,endDate:n.endDate,filter:n.eventFilter}).sort(dn);n.dateIndex=a.reduce(((e,n)=>{const a=t.makeKey(n.startDate);return e[a]||(e[a]=n),e}),{}),n.store.data=a,n.trigger("refresh"),null===(e=n.calendar)||void 0===e||e.syncUIWithActiveView(this)}changeMonth(){const e=super.changeMonth(...arguments);return e.ion({dateChange:"onMonthChange",thisObj:this}),e}onMonthChange({newDate:e}){const t=this,{startDate:n}=t,a=t.changeStartDate(e);(!n||a-n)&&t.updateRange(t.range),!t.preventScroll&&t.isVisible&&t.store.count&&(t.populateStoreSoon.flush(),t.scrollTo(e))}onCalendarStoreChange({source:e}){this.date||(this.date=e.map((e=>e.startDate)).sort(((e,t)=>e.valueOf()-t.valueOf()))[0]),this.populateStoreSoon()}changeSettings(e,t){return e&&N.reconfigure(t,N.mergeConfigs({type:"button",positioned:!0,icon:"b-icon-cog",menuIcon:null,cls:"b-blue b-cal-widget-settings-button",appendTo:this.bodyElement},e),this)}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.store,delete t.data,t}}un.initClass(),un._$name="EventList";const hn={mouseover:1,mouseout:1},gn={mousedown:1,mouseup:1,click:1,dblclick:1,contextmenu:1};class vn extends(un.mixin(Ee)){static get $name(){return"AgendaView"}static get type(){return"agendaview"}static get configurable(){return{features:null,eventSorter:Ht.interDaySorterFn,eventRowSpacing:8,title:"L{Agenda}",range:"year",hideEventOverflow:null,offsetStartsBeforeEvents:!0,handlePointerInteraction:!1,dayCellRenderer:null,eventRenderer:null,hideHeaders:!0,columns:{name:null,startDate:null,endDate:null,resources:null,agenda:{type:"agendacolumn"}},eventTimeRenderer:null,enableSticky:!0,preserveScrollOnDatasetChange:!0,positionMode:"position",settings:{},cellTabIndex:null,rowCls:{"b-cal-agenda-grid-row":1},cellCls:{"b-calendar-cell":1},eventBarContainerCls:"b-cal-event-bar-container",keyMap:null}}construct(e){Object.defineProperty(this,"features",{get:()=>({}),set:()=>{}}),super.construct(e),this.bodyContainer.removeAttribute("tabIndex")}onResponsiveStateChange({state:e,oldState:t}){var n;null===(n=super.onResponsiveStateChange)||void 0===n||n.call(this,...arguments),!t||"small"!==t&&"small"!==e||this.refresh()}changeColumns(){var e;const t=super.changeColumns(...arguments);return null==t||null===(e=t.forEach)||void 0===e||e.call(t,(e=>{e.autoHeight=Boolean(!e.isAgendaColumn||e.renderer||this.eventRenderer)})),t}onFocusGesture(){}onGridElementFocus(){}onGridBodyFocusIn(){}focusCell(){}setHoveredRow(){}onElementKeyDown(){}onElementMouseDown(){}editAutoCreatedEvent(e,t){this.populateStoreSoon.now(),super.editAutoCreatedEvent(e,t)}handleEvent(e){const{type:t}=e;super.handleEvent(e),hn[e.type]?this.onEventMouseOverOut(e):gn[t]&&this.onCalendarPointerInteraction(e)}getCellDataFromEvent(e){if(e.target.closest(".b-grid-cell")){const t=super.getCellDataFromEvent(e);return t&&(t.record=this.getEventRecord(e.target)),t}}updateOffsetStartsBeforeEvents(e){this.element.classList.toggle("b-offset-continues-past",Boolean(e))}updateEventRowSpacing(e){this.contentElement.style.setProperty("--event-row-spacing",a.setLength(e))}updateSuppressLongEvents(){this.fillFromMaster()}onCalendarStoreChange({action:e,oldCount:n,records:a,removed:r,added:i}){const s=this;if(s.isPainted){if(!("filter"!==e||null!=r&&r.length||null!=i&&i.length))return;if("dataset"===e)return;if("remove"===e&&1===a.length&&a[0].isEventModel){const{store:e}=s,n=a[0],r=t.clearTime(n.startDate),i=t.clearTime(n.endDate);do{const a=t.makeKey(r),i=s.cellMap.get(a);i&&(b.remove(i.events,n),i.events.length?s.onStoreUpdateRecord({source:e,record:s.store.getById(a),changes:{}}):(s.cellMap.delete(a),delete s.dateIndex[a],e.remove(a,!0))),r.setDate(r.getDate()+1)}while(r<i);return}}s.populateStoreSoon()}get cellMap(){var e;return null!==(e=this._cellMap)&&void 0!==e&&e.populated?this._cellMap:this.createCellMap({rawEvents:!0,skipPropagate:!0})}populateStore(){var e,n,a,r,i;null===(e=this._cellMap)||void 0===e||e.clear();const s=this,{store:o,eventStore:l,rowManager:d}=s,{rowHeight:c}=d,u=null===(n=d.rows)||void 0===n?void 0:n.length,h=isNaN(s.eventHeight)?25:s.eventHeight;s.eventCount=0,s.date||(s.isConfiguring=!0,s.date=l.map((e=>e.startDate)).sort(((e,t)=>e.valueOf()-t.valueOf()))[0],s.isConfiguring=!1);const{cellMap:g}=s,v=[...g.values()];s.dateIndex={};for(let e=0,{length:n}=v;e<n;e++){const n=v[e],{events:a,date:r}=n;for(let n=0,{length:i}=a;n<i;n++){const i=a[n];s.isAllDayEvent(i)&&e&&t.clearTime(i.startDate).valueOf()!==r.valueOf()||s.eventCount++}s.dateIndex[n.id]=v[e]=o.createRecord(n)}const m=s.eventCount?v.map((e=>e.events.length)).reduce(((e,t)=>e+t),0)/v.length:0;o.suspendEvents(),o.loadData(v),o.resumeEvents(),d._rowHeight=20,o.count&&(d.rowHeight=Math.max(m*(h+s.eventSpacing),70)),u&&o.count&&d.rowHeight!==c||(d.calculateRowCount(),d.estimateTotalHeight(!0)),s.refreshCount=(s.refreshCount||0)+1,s.trigger("refresh"),null===(a=s.calendar)||void 0===a||a.syncUIWithActiveView(s),s.columns.forEach((e=>{var t,n;return null===(t=(n=e.constructor).exposeProperties)||void 0===t?void 0:t.call(n)})),null===(r=s.settings)||void 0===r||null===(i=r._menu)||void 0===i||i.realign()}get count(){return this.eventCount}collectEvents(e){return e.getDateIndex=e=>e>this.startDate&&this.hideEventOverflow?"startDate":"date",this.eventStore.getEvents(e)}changeStore(e){return(e=super.changeStore(e))&&(this.nonWorkingDaysFilter=e.addFilter({id:`${this.id}-nonworkingday-filter`,filterBy:e=>!e.isNonWorking,disabled:!this.hideNonWorkingDays},!0),this.detachListeners("agendaStoreFilter"),e.on({name:"agendaStoreFilter",filter:"onAgendaStoreFilter",thisObj:this})),e}get modelClass(){return ke}onAgendaStoreFilter(){const e=this;e.eventCount=e.store.reduce(((n,a,r)=>{const{events:i,date:s}=a;for(let a=0,{length:o}=i;a<o;a++){const o=i[a];e.isAllDayEvent(o)&&r&&t.clearTime(o.startDate).valueOf()!==s.valueOf()||n++}return n}),0)}updateHideEventOverflow(){this.populateStore()}doRefresh(){this.populateStore()}createCellData(e){return Object.assign(this.cellMonth.getCellData(e,this.month),{id:t.makeKey(e),events:[]})}set cellRenderer(e){this._cellRenderer=e}changeSettings(e){return e&&super.changeSettings({menu:d({align:{align:"t100-b100"}},this.listRangeMenu)})}}vn.initClass(),vn._$name="AgendaView";class mn extends(me.mixin(At)){construct(e){if(!e.eventStore){var t;const n=null===(t=e.owner||e.parent)||void 0===t?void 0:t.up("calendar");n&&(e.eventStore=n.eventStore)}super.construct(...arguments)}updateMaxDots(){this.refresh()}refreshEventsMap(){const e=this;e.showEvents&&(e.eventsMap=e.eventStore["dots"===e.showEvents?"getEvents":"getEventCounts"]({startDate:e.startDate,endDate:e.endDate,dateMap:e.eventsMap||(e.eventsMap=new Map)}))}cellRenderer({cell:e,date:n}){var r,i;const{showEvents:s}=this,o="count"===s,l="dots"===s,d=null===(r=this.eventsMap)||void 0===r||null===(i=r.get)||void 0===i?void 0:i.call(r,t.makeKey(n)),c=l?null==d?void 0:d.length:d,u=o?"b-cell-events-badge":l?"b-cal-minimal-event-container":"b-icon b-icon-circle";if(l&&(e.innerHTML="",a.createElement({class:"b-date-cell-inner",text:n.getDate(),parent:e})),delete e.parentNode.dataset.btip,c){!o&&this.eventCountTip&&(e.parentNode.dataset.btip=this.L("L{ResourceInfoColumn.eventCountText}",c));const t={dataset:{count:c},class:{[u]:1,[me.getEventCountClass(c)]:1},parent:e,[o?"text":""]:c};if(l){const e=t.children=[];for(let t=0;t<Math.min((null==d?void 0:d.length)||0,this.maxDots);t++){const n=this.createEventDomConfig({eventRecord:d[t],minimal:!0});e.push(n)}}a.createElement(t)}}static setupClass(e){e.replaceType=!0,super.setupClass(e)}}e(mn,"$name","CalendarDatePicker"),e(mn,"type","datepicker"),e(mn,"configurable",{showEvents:null,maxDots:4,eventCountTip:null,alwaysRefreshOnMonthChange:!0}),mn.initClass(),mn._$name="CalendarDatePicker";const{MILLIS_PER_HOUR:pn}=k,yn=new Date(2020,10,22,22,59,59),fn={paint:1,refresh:1,resize:1,eventspercellchange:1},wn=e=>{e.stopImmediatePropagation(),e.cancelBubble=!0},Dn=e=>e.ctrlKey&&e.preventDefault(),Cn={level:0,step:"1 hour"},bn=new r(0,0,0,0),En=["30 minutes","15 minutes","10 minutes","5 minutes"],Sn=["30 minutes","12 minutes","6 minutes"];class kn extends(P.mixin(zt,Ut,ln,tn)){static get $name(){return"DayView"}static get type(){return"dayview"}static get delayable(){return{updateElementLayout:{type:"raf",cancelOutstanding:!0},refreshDayBackground:{type:"raf",cancelOutstanding:!0}}}static get configurable(){return{textContent:!1,scrollable:{overflowY:!0},title:"L{Day}",eventRenderer:null,eventHeight:"auto",hourHeight:42,range:{magnitude:1,unit:"day"},fixedDuration:null,visibleStartTime:7,dayStartShift:null,dayStartTime:null,dayEndTime:null,dayTime:0,increment:"15 min",intradayCls:null,showTime:!0,showCircle:!1,iconTarget:"header",eventLayout:{type:"fluid"},minDayWidth:null,eventColourStyleProperty:"backgroundColor",monitorResize:Boolean(a.scrollBarWidth),eventFilter:void 0,timeFormat:"LST",allDayEvents:{$config:["lazy","nullify"],value:{}},overflowPopup:null,showAllDayHeader:{value:null,$config:null,default:!0},eventSpacing:1,responsive:{small:{descriptionFormat:"MMMM YYYY"},"*":{descriptionFormat:null}},maxAllDayHeight:null,fitHours:null,dayCellRenderer:null,coreHours:null,zoomOnMouseWheel:!w.isTouchDevice,hourHeightBreakpoints:[70,140,300,500],sixMinuteTicks:null,minEventHeight:"1em",shortEventHeight:32,currentTimeIndicatorRenderer:()=>({className:"b-current-time-indicator",retainElement:!0})}}construct(e){var t;const n=this;n.configuredHiddenVerticalScroll="hidden-scroll"===(null===(t=e.scrollable)||void 0===t?void 0:t.overflowY),n.cellMapEventFilter=n.cellMapEventFilter.bind(n),super.construct(...arguments),n.startDate||(n.startDate=n.month.date),H.ion({theme:"onThemeChange",thisObj:n})}get hasNonWorkingDays(){return!0}updateZoomOnMouseWheel(e){var t;e?this.zoomListener=m.on({element:this.dayContentElement,wheel:"onDayContentMousewheel",thisObj:this,throttled:{buffer:100,alt:Dn}}):null===(t=this.zoomListener)||void 0===t||t.call(this)}get childItems(){const{allDayEvents:e}=this,t=super.childItems;return e&&t.push(e),t}get dayEndTime(){var e,t;return null!==(e=null===(t=this.dayTime)||void 0===t?void 0:t.timeEnd)&&void 0!==e?e:this._dayEndTime}get dayStartTime(){var e,t;return null!==(e=null===(t=this.dayTime)||void 0===t?void 0:t.timeStart)&&void 0!==e?e:this._dayStartTime}get dayStartShift(){var e,t;return null!==(e=null===(t=this.dayTime)||void 0===t?void 0:t.startShift)&&void 0!==e?e:this._dayStartShift}updateDayEndTime(e){this._dayTime=null,this.dayTime=new k({startShift:this.dayStartShift,timeStart:this.dayStartTime,timeEnd:e})}updateDayStartTime(e){this._dayTime=null,this.dayTime=new k({startShift:this.dayStartShift,timeStart:e,timeEnd:this.dayEndTime})}updateDayStartShift(e){this._dayTime=null,this.dayTime=new k({startShift:e,timeStart:this.dayStartTime,timeEnd:this.dayEndTime})}changeDayTime(e){var t;if(e||(e=new k(this)),null===(t=this._dayTime)||void 0===t||!t.equals(e))return e}updateDayTime(e,t){const n=this,{eventStore:a}=n;if(a&&(a.registerDayIndex(e),t&&a.unregisterDayIndex(t)),!n.isConfiguring){var r;const{startDate:t}=n;n.syncHours(),n.setConfig({date:t,startDate:t}),null===(r=n.allDayEvents)||void 0===r||r.setConfig({date:t,dayTime:e,startDate:t})}}dateKey(e){return this.dayTime.dateKey(e)}dayOfDate(e){return e&&this.dayTime.dayOfDate(e)}async scrollTo(e,n={animate:!0}){const a=this,{allDayEvents:r}=a;if(a.scrollPromise&&await a.scrollPromise,await(null==r?void 0:r.heightAnimation),a.isDestroyed)return;"number"==typeof e&&(e=t.add(a.startDate,e,"hour"));const i=Boolean(e.getHours);return await super.scrollTo(e,Object.assign({},n,{y:!i})),i?(e=e.getHours()+e.getMinutes()/60,a.scrollable.scrollTo(null,a.getPositionFromTime(e),n)):void 0}getEventElement(e,t){var n;return super.getEventElement(e,t)||(null===(n=this.allDayEvents)||void 0===n?void 0:n.getEventElement(e,t))}getEventElements(e){var t;return super.getEventElements(e)||(null===(t=this.allDayEvents)||void 0===t?void 0:t.getEventElements(e))}getPositionFromTime(e){return k.parse(e)<k.parse(this.dayStartTime)-this.dayStartShift?0:this.dayTime.delta(e,"h")*this.hourHeight}updateShowAllDayHeader(e){var t,n;const a=this,{_allDayEvents:r}=a;null===(t=a._cellMap)||void 0===t||t.clear(),null==r||null===(n=r._cellMap)||void 0===n||n.clear(),r&&(r.element.classList.toggle("b-hide-allday-header",!e),r.refresh()),a.refresh()}changeAllDayEvents(e,t){if(!e)return null==t?void 0:t.destroy();this.getConfig("date");const n=this,{autoCreate:a,dayHeaderRenderer:r,overflowButtonRenderer:i,overflowClickAction:s,overflowPopup:o,avatarRendering:l,range:d}=n,c=sn.reconfigure(t,e,{owner:n,defaults:{type:"calendarrow",calendar:n.calendar,parent:n,rtl:n.rtl,cls:{"b-dayview-schedule-container":1,"b-dayview-initializing":1},[void 0!==o?"overflowPopup":"_"]:o,[i?"overflowButtonRenderer":"_"]:i,[s?"overflowClickAction":"_"]:s,[r?"dayHeaderRenderer":"_"]:r,[l?"avatarRendering":"_"]:l,autoCreate:a?{newName:a.newName,gesture:a.gesture,startHour:0,duration:"1 day"}:null,dayNameSelector:".b-day-name-date",eventFilter:e=>n.showAllDayHeader&&n.isAllDayEvent(e)&&(!n.eventFilter||n.eventFilter(e)),dayStartTime:n.dayStartTime,dayEndTime:n.dayEndTime,dayStartShift:n.dayStartShift,eventRenderer:n.eventRenderer,eventStore:n.eventStore,month:n.month,fullWeek:1===n.duration,startDate:n.startDate,[d?"range":"_"]:d,[d?"_":"endDate"]:n.endDate,nonWorkingDays:n.nonWorkingDays,nonWorkingDayCls:n.nonWorkingDayCls,weekendCls:n.weekendCls,weekStartDay:n.weekStartDay,defaultCalendar:n.defaultCalendar,emptyCellRenderer:n.emptyCellRenderer,internalListeners:{heightChange:"updateElementLayout",refresh:"updateElementLayout",catchall:"relayAllDayEvents",showoverflowpopup:"onAllDayOverflowPopupShown",thisObj:n},editAutoCreatedEvent(e){(n.showAllDayHeader?this:n).trigger("eventAutoCreated",{eventRecord:e})},createCellMap(){return n.showAllDayHeader?this.constructor.prototype.createCellMap.call(this,...arguments):n.emptyMap||(n.emptyMap=new Map)}},setup(e){e.hideNonWorkingDays=!(1===n.duration&&!e.fullWeek)&&n._hideNonWorkingDays}});return c&&(c.height=c.flex=null,n.originalAllDayEventsScrollTo=c.scrollTo,c.scrollTo=n.allDayEventsScrollTo.bind(n)),c}onAllDayOverflowPopupShown({overflowPopup:e}){this._overflowPopup=e}allDayEventsScrollTo(e){const n=this,a=e.isEvent?e.startDate:n.changeEndDate(e);return(e.isEvent?t.intersectSpans(n.startDate,n.endDate,e.startDate,e.endDate):t.betweenLesser(a,n.startDate,n.endDate))||(n.date=a),n.originalAllDayEventsScrollTo.call(n.allDayEvents,...arguments)}updateAutoCreate(e){var t;const{_allDayEvents:n}=this;null===(t=super.updateAutoCreate)||void 0===t||t.call(this,e),n&&(n.autoCreate=!!e&&{newName:e.newName,gesture:e.gesture,startHour:0,duration:"1 day"})}updateWeekStartDay(e,t){var n;null===(n=super.updateWeekStartDay)||void 0===n||n.call(this,e),!this.isConfiguring&&this.allDayEvents&&(this.allDayEvents.weekStartDay=e)}updateEventStore(e,t){super.updateEventStore(e,t);const{dayTime:n}=this;n&&(null==e||e.registerDayIndex(n),null==t||t.unregisterDayIndex(n))}get overflowPopup(){var e;return(null===(e=this._allDayEvents)||void 0===e?void 0:e.overflowPopup)||this._overflowPopup}get stepUnit(){return this.duration>1?`${this.duration} ${this.L("L{daysUnit}")}`:this.L("L{dayUnit}")}get eventContentElement(){return this.dayContainerElement}getDateFromDomEvent(e,n=!1){let r=super.getDateFromDomEvent(e);const i=this,s=a.getEventElement(e);return r&&s!==e&&i.dayContainerElement.contains(s)&&(r=t.add(r,i.dayStartHour-i.dayStartShift/36e5+(e.clientY-i.scrollable.element.getBoundingClientRect().y+i.scrollable.y)/i.hourHeight,"hour"),n||(r=t.round(r,i.increment))),r}getDateFromPosition(e,n,a=!1){const i=this,{eventContentElement:s,allDayEvents:o}=i,l=i.dayContainerElement.querySelectorAll(`.${i.dayCellCls}`),d=a?bn:r.fromScreen(s).roundPx().translate(-s.scrollLeft),c=s.scrollWidth,{height:u}=r.fromScreen(l[0]).roundPx(),h=a?e:e-d.x,g=i.rtl?i.eventContentElement.offsetWidth-h:h,v=n-d.y,m=l.length,p=Math.min(Math.floor(g/c*m),l.length-1);if(o&&(g<0||c<g||v<0||u<v))return o.getDateFromPosition(e,n);let y=i.getDateFromElement(l[0]);if(i.hideNonWorkingDays){y=Array.from(l).map((e=>i.getDateFromElement(e)))[p]}else p&&y.setDate(y.getDate()+p);return t.clearTime(y,!1),y.setMilliseconds(y.getMilliseconds()+i.dayStartMs+Math.floor(v/u*i.getDayLength())),t.round(y,i.increment)}doRefresh(){const e=this;if(e.isVisible){var t;a.addTemporaryClass(e.element,"b-no-transitions",200,e);const r=[];e.today=e.dayTime.startOfDay((null===(t=e.calendar)||void 0===t?void 0:t.dateTimeNow)||new Date);for(const t=new Date(e.startDate);t<e.endDate;t.setDate(t.getDate()+1))r.push(e.getDayDomConfig(t));n.sync({targetElement:e.dayContainerElement,domConfig:{onlyChildren:!0,children:r,syncOptions:{syncIdField:"date",releaseThreshold:0,strict:!0}}}),e.refreshDayBackground(),e.refreshCount=(e.refreshCount||0)+1,e.syncCurrentTimeIndicator(),e.trigger("refresh")}}getBaseDayDomConfig(e){const n=this,a=n.dayTime.dateKey(e),r=n.cellMap.get(a)||n.createCellData(e),i=r.day,s=n.nonWorkingDays||n.month.nonWorkingDays;return(!n.hiddenNonWorkingDays[e.getDay()]||1===n.duration)&&[r,{dataset:{date:a},className:{"b-dayview-day-detail":1,[n.dayCellCls]:1,[n.nonWorkingDayCls]:s[i]||!1,[n.weekendCls]:t.weekends[i],[n.todayCls]:!(e-n.today),"b-last-cell":!(e-n.lastVisibleDate),[`b-day-of-week-${i}`]:1},style:{},children:{inset:{className:{"b-dayview-inset":1}},events:{className:{"b-dayview-event-container":1},children:[]}},syncOptions:{syncIdField:"eventId",releaseThreshold:0,strict:!0}}]}getDayDomConfig(e){const t=this,n=t.getBaseDayDomConfig(e);if(n){const{dayCellRenderer:r}=t,[i,s]=n;return t.coreHours&&(s.style.backgroundImage=t.getCoreHoursGradient(t.getCoreHoursForDate(e))),t.renderEvents(i,s),a.normalizeChildren(r?t.callback(r,t,[s,i]):s)}}getCoreHoursGradient(e){if(!e)return"";const{dayTime:t}=this,n=t.duration("h"),r=["linear-gradient(to bottom"];e=b.asArray(e);let i=0;for(let s=0,{length:o}=e;s<o;s++){const l=e[s],d=Math.max(t.delta(l.start,"h"),0)/n*100,c=Math.min(t.delta(l.end,"h"),n)/n*100;if(1===o&&0===d&&100===c)return"";i<d&&r.push(`var(--dayview-outside-core-hours-color) ${a.percentify(i)}, var(--dayview-outside-core-hours-color) ${a.percentify(d)}`),r.push(`transparent ${a.percentify(d)}, transparent ${a.percentify(c)}`),i=c}return i<100&&r.push(`var(--dayview-outside-core-hours-color) ${a.percentify(i)}, var(--dayview-outside-core-hours-color) 100%`),r.join(",")+")"}getCoreHoursForDate(e){const{coreHours:t}=this;return 7===t.length?t[e.getDay()]:"object"==typeof t?t.overlayDay?t:null:this.callback(t,this,[e])}refreshDayEvents(e){const t=this;e=t.changeEndDate(e),t.today=t.dayTime.startOfDay(new Date);const r=t.getDayDomConfig(e);a.addTemporaryClass(t.element,"b-no-transitions",200,t),r.onlyChildren=!0,n.sync({targetElement:t.getDayElement(e),domConfig:r})}renderEvents(e,t){const n=this,a=n.eventLayout.layoutEvents(e,t),{items:r}=a,{eventSpacing:i,rtl:s}=n;for(const e of r){const a=n.createEventDomConfig({eventRecord:e.eventRecord});a.className["b-starts-above"]=e.startsBefore,a.className["b-ends-below"]=e.endsAfter,e.cluster.items.length>1&&(a.className["b-cal-in-cluster"]=1),Object.assign(a.style,d({[i?"padding-bottom":""]:`${i}px`},e.getStyles(s))),t.children.events.children.push(a)}n.trigger("renderEvents",{context:a})}get overflowElement(){return this.dayContentElement}get cellMap(){var e;return null!==(e=this._cellMap)&&void 0!==e&&e.populated?this._cellMap:this.createCellMap()}get bodyConfig(){const e=this,{allDayEvents:t,maxAllDayHeight:n}=e;return Object.assign(super.bodyConfig,{children:{alldayRowElement:t?{className:{"b-dayview-allday-row":1},style:{[n?"maxHeight":""]:a.setLength(n)},children:{cornerElement:{className:{"b-dayview-allday-row-start":1,"b-dayview-allday-autoheight":t.autoHeight},children:{allDayTextElement:{className:"b-dayview-allday-text",html:e.L("L{EventEdit.All day}")},allDayToggleIcon:{tag:"button",className:"b-expand-allday-button b-icon b-icon-expand-row",dataset:{btip:"L{DayView.expandAllDayRow}"}}}},allDayEvents:null==t?void 0:t.element,$scrollerPad:a.scrollBarPadElement}}:null,dayContentElement:{tabIndex:-1,className:{"b-dayview-day-content":1},children:{timeAxisElement:{children:e.getTimeElementConfigs(),className:{"b-timeaxis-container":1}},dayContainerElement:{className:{"b-dayview-day-container":1}}}},horizontalScrollerElement:{className:"b-virtual-scrollers b-hide-display",children:[{className:"b-virtual-scroller"},a.scrollBarPadElement]}}})}onDayContentMousewheel(e){if(e.ctrlKey){e.preventDefault();const t=e.clientY-this.scrollable.element.getBoundingClientRect().y,n=-Math.min(Math.abs(e.deltaY),10)*Math.sign(e.deltaY);this.zoomBy(n,t)}}zoomBy(e,n=Math.min(this.scrollable.scrollHeight,this.scrollable.clientHeight)/2-1){this.updateElementLayout.cancel();const a=this,{scrollable:r,hourHeight:i}=a,s=t.round("number"==typeof n?a.getDateFromPosition(a.dayContainerElement.offsetWidth/2,n+r.y,!0):t.parse(n,"HH:mm:ss"),a.increment),o=a.getDayLength("h"),l=Math.max(i+e,a.dayContentClientHeight/o),d=a.getPositionFromTime(s)-r.y;a.ion({layoutUpdate:()=>{r.scrollTo(null,a.getPositionFromTime(s)-d),r.syncPartners(!1,!0)},once:!0,prio:1e3}),a.fitHours=!1,a.hourHeight=l}zoomTo(e,t){this.zoomBy(e-this.hourHeight,t)}createCellMap(){const{showAllDayHeader:e}=this;return super.createCellMap({dayTime:this.dayTime,startOnly:e,allowPartial:!e,skipPropagate:!0,rawEvents:!0,filter:this.cellMapEventFilter})}cellMapEventFilter(e){const{dayTime:t,hiddenNonWorkingDays:n,showAllDayHeader:a}=this;return(!a||t.isIntraDay(e)&&!e.allDay)&&t.intersects(e)&&!n[t.dayOfWeek(e.startDate)]}getDayLength(e="ms"){return this.dayTime.duration(e)}changeIncrement(e){return"string"==typeof e?(e=t.parseDuration(e),t.as("ms",e.magnitude,e.unit)):e}get dayStartHour(){return null==this.dayStartTime?0:Math.floor(this.dayStartTime/pn)}get dayEndHour(){return null==this.dayEndTime?24:Math.ceil(this.dayEndTime/pn)}get dayStartMs(){return null==this.dayStartTime?0:this.dayStartTime}get dayEndMs(){return null==this.dayEndTime?24*pn:this.dayEndTime}get dayStartOffset(){return this.dayTime.startTimeOffsetMs/pn*this.hourHeight}changeEventFilter(e){return void 0===e&&(e=e=>!this.isAllDayEvent(e)),e}changeEventLayout(e,t){return kt.reconfigure(t,e,{owner:this,defaults:{owner:this}})}updateNonWorkingDays(e){var t;const n=this;var a;(null===(t=super.updateNonWorkingDays)||void 0===t||t.call(this,e),n._allDayEvents&&(n._allDayEvents.nonWorkingDays=e),n.isConfiguring)||(null===(a=n._cellMap)||void 0===a||a.clear(),n.refresh())}updateMaxAllDayHeight(e){a.setLength(this.alldayRowElement,"max-height",e)}get hideNonWorkingDays(){return(!0!==this._hideNonWorkingDays||1!==this.duration)&&this._hideNonWorkingDays}set hideNonWorkingDays(e){super.hideNonWorkingDays=e}updateHideNonWorkingDays(e){const t=this,{_allDayEvents:n}=t;var a;(super.updateHideNonWorkingDays(e),n&&(n.hideNonWorkingDays=!(1===t.duration&&!n.fullWeek)&&t._hideNonWorkingDays),t.isConfiguring)||(null===(a=t._cellMap)||void 0===a||a.clear(),t.refresh())}syncHours(){var e;const t=this;null===(e=t._cellMap)||void 0===e||e.clear(),n.sync({targetElement:t.timeAxisElement,childrenOnly:!0,domConfig:{children:t.getTimeElementConfigs()}}),t.updateElementLayout.now(),t.refresh()}syncCurrentTimeIndicator(){var e;const n=this,r=(null===(e=n.calendar)||void 0===e?void 0:e.dateTimeNow)||new Date,i=n.getDayElement(r),{currentTimeIndicator:s,dayTime:o,endDate:l,startDate:d}=n;if(d&&l)if(i&&t.betweenLesser(r,d,l)&&o.contains(r)){const e=n.getDayLength("ms"),t=o.delta(r,"ms");s.parentNode!==i&&(null==i||i.appendChild(s)),s.style.top=a.percentify(t/e*100)}else s.remove()}get currentTimeIndicator(){return this._currentTimeIndicator||(this._currentTimeIndicator=a.createElement(this.callback(this.currentTimeIndicatorRenderer,this)))}getTimeElementConfigs(){const e=this,n=[],{dayTime:a}=e,{startHour:r}=a,i=new Date(2e3,5,15,r,0,0),s=a.duration("h");for(let a,r=1;r<=s;r++){const r=e.createLeafTicks(i);i.setHours(a=i.getHours()+1),i.setMinutes(0),n.push({className:`b-dayview-timeaxis-time b-dayview-timeaxis-time-${a<10?"0":""}${a}`,children:r.concat([{className:"b-dayview-timeaxis-tick b-dayview-hour-tick",text:t.format(i,e.timeFormat)}])})}return e.coreHours&&e._simpleCoreHours&&n.unshift({className:"b-dayview-timeaxis-background",style:{backgroundImage:e.getCoreHoursGradient(e.coreHours)}}),n}createLeafTicks(e){return this[this.sixMinuteTicks?"createSixMinuteTicks":"createFiveMinuteTicks"](e)}createFiveMinuteTicks(e){const n=[];for(let a=1;a<12;a++)e.setMinutes(5*a),n.push({className:{"b-dayview-timeaxis-tick":1,"b-dayview-tick-level-4":1,"b-dayview-tick-level-3":!(1&a),"b-dayview-tick-level-2":!(a%3),"b-dayview-tick-level-1":6===a},text:t.format(e,this.timeFormat)});return n}createSixMinuteTicks(e){const n=[];for(let a=1;a<10;a++)e.setMinutes(6*a),n.push({className:{"b-dayview-timeaxis-tick":1,"b-dayview-tick-level-3":1,"b-dayview-tick-level-2":!(1&a),"b-dayview-tick-level-1":5===a},text:t.format(e,this.timeFormat)});return n}changeCoreHours(e){const t=this;return t._simpleCoreHours=s.isObject(e)||Array.isArray(e)&&7!==e.length,t._simpleCoreHours&&((e=s.clone(e))._overlayDay=e.overlayDay,Object.defineProperty(e,"overlayDay",{set(e){this._overlayDay=e,t.updateCoreHours()},get(e){return this._overlayDay}})),e}updateCoreHours(){this.isConfiguring||this.syncHours()}changeStartDate(){return this.dayOfDate(super.changeStartDate(...arguments))}updateStartDate(e){const{_allDayEvents:t}=this;t&&this._allDayEvents.setConfig({date:this.date,startDate:e}),super.updateStartDate(...arguments)}changeEndDate(){return this.dayOfDate(super.changeEndDate(...arguments))}updateEndDate(e){var t;const{_allDayEvents:n}=this;null===(t=super.updateEndDate)||void 0===t||t.call(this,...arguments),n&&!this.updatingRange&&this._allDayEvents.setConfig({date:this.date,endDate:e})}changeMinDayWidth(e){return"number"==typeof e?Math.max(e,50):null}updateMinDayWidth(e){this.contentElement.style.setProperty("--min-day-width",a.setLength(e)),this._allDayEvents&&(this._allDayEvents.minDayWidth=e),this.updateElementLayout()}updateHourHeight(e){this.shortEventDuration=36e5/(e/this.shortEventHeight),this.isConfiguring||(this.updateElementLayout(),this.fitHours&&this.refresh())}updateShortEventHeight(e){this.updateHourHeight(this.hourHeight)}updateMinEventHeight(e){this.contentElement.style.setProperty("--dayview-min-event-height",a.setLength(e))}get hourHeight(){return!this.isConfiguring&&this.fitHours?Math.max(this.dayContentClientHeight/this.getDayLength("hour"),this.minHourHeight):this._hourHeight}changeFitHours(e){return null!=e&&e.minHeight?this.minHourHeight=Math.max(e.minHeight,9):this.minHourHeight=17,e}get dayContentClientHeight(){return a.floorPx(r.client(this.dayContentElement).height)}updateFitHours(e){const t=this;t.isConfiguring||e&&(t.hourHeight=Math.max(t.dayContentClientHeight/t.getDayLength("hour"),t.minHourHeight)),t.element.classList.toggle("b-fit-hours",Boolean(e)),t.monitorResize=a.scrollBarWidth||e}updateEventSpacing(){var e;this.isConfiguring||(null===(e=this._cellMap)||void 0===e||e.clear(),this.refresh())}onPaint({firstPaint:e}){const t=this,{dayContainerElement:n,horizontalScrollerElement:r}=t,{scrollBarWidth:i}=a;if(e){const{allDayEvents:e}=t;t.horizontalScroller=new x({widget:t,element:n,overflowX:!i||"hidden-scroll",overflowY:"clip"}),e&&(e.element.classList.remove("b-dayview-initializing"),t.horizontalScroller.addPartner(e.headerScroller)),O.addResizeListener(t.dayContainerElement,t.onDayContainerResize.bind(t)),t.scrollbarScroller=new x({widget:t,element:r.firstChild,scrollWidth:n.scrollWidth-i,overflowX:!0,overflowY:!1}),t.horizontalScroller.addPartner(t.scrollbarScroller),t.refresh(),t.updateElementLayout.now(),t.setInterval(t.syncCurrentTimeIndicator.bind(t),3e4,"syncCurrentTimeIndicator"),e&&(m.on({click:{element:t.cornerElement,handler:"onCornerClick"},mousemove:{element:t.allDayEvents.element.nextSibling,handler:wn,capture:!0},thisObj:t}),t.scrollable.ion({overflowChange:"syncScrollbarPadding",thisObj:t})),t.scrollToVisibleStartTime()}}scrollToVisibleStartTime(){if(null!=this.visibleStartTime){const e=this,{scrollable:t}=e,n=e.getPositionFromTime(e.visibleStartTime),a=()=>{t.scrollTo(null,n,{animate:!1,block:"start"})};n>t.maxY&&!e.scrollToStartTimer&&e.allDayEvents?e.scrollToStartTimer=e.allDayEvents.ion({heightChange:a,once:!0,expires:{delay:5e3,alt:a},name:"scrollToVisibleStartTime"}):a()}}relayAllDayEvents(e){const{type:t}=e;if(!fn[t])return this.trigger(t,e)}async onCornerClick(){const{allDayEvents:e}=this;e.isAnimating||(await e.toggleExpandCollapse(),this.isDestroyed||(this.allDayToggleIcon.dataset.btip=e.expanded?this.L("L{collapseAllDayRow}"):this.L("L{expandAllDayRow}")))}syncScrollbarPadding(){if(!this.configuredHiddenVerticalScroll&&this.allDayEvents)if(a.scrollBarWidth){if(!this.allDayEvents.isAnimating){const{allDayEvents:e,alldayRowElement:t,scrollable:n}=this,a=this.fitHours&&n.clientHeight/this.getDayLength("hour")>=this.minHourHeight,r=!a&&n.hasOverflow(),{headerElement:i,scrollable:s}=e,o=e.expanded||e.autoHeight,l=Boolean(o&&s.hasOverflow());r&&l?(i.classList.add("b-show-yscroll-padding"),t.classList.remove("b-show-yscroll-padding"),n.overflowY=s.overflowY="auto"):l!==r?l?(i.classList.add("b-show-yscroll-padding"),s.overflowY="auto",n.overflowY="scroll"):(i.classList.remove("b-show-yscroll-padding"),t.classList.add("b-show-yscroll-padding"),s.overflowY="hidden",n.overflowY=!a&&"auto"):(t.classList.remove("b-show-yscroll-padding"),i.classList.remove("b-show-yscroll-padding"),n.overflowY=!a&&"auto",s.overflowY="hidden")}}else this.scrollable.overflowY=this.allDayEvents.scrollable.overflowY="auto"}onInternalResize(e,t,n,a,r){const{_allDayEvents:i}=this;super.onInternalResize(e,t,n,a,r),r&&(null==i||i.performResizeRefresh(i.eventsPerCell,i.eventContainerTop),n!==r&&(this.updateElementLayout(),this.syncScrollbarPadding()))}onThemeChange(){this.updateElementLayout()}onDayContainerResize(e,{height:t}={},{height:n}){t&&(n!==t||a.scrollBarWidth&&this.minDayWidth)&&(this.updateElementLayout(),this.fitHours&&this.updateFitHours(this.fitHours))}async updateElementLayout(){var e;if(!this.refreshCount||null!==(e=this.owner)&&void 0!==e&&e.isDestroyed)return;const t=this,{dayContainerElement:n,horizontalScrollerElement:r,horizontalScroller:i,allDayEvents:s}=t,o=n.querySelectorAll(`.${t.dayCellCls}`),{scrollBarWidth:l}=a;let d,c;if(s){const e=t.cornerElement.classList;s.hasOverflow?(e.add("b-has-cell-overflow"),e.toggle("b-expanded",Boolean(s.expanded))):e.remove("b-has-cell-overflow")}for(t.refreshDayBackground.now(),d=0,c=o.length-1;d<=c;d++)o[d].classList.toggle("b-last-cell",d===c);if(s&&t.syncScrollbarPadding(),l&&r.classList.toggle("b-show-yscroll-padding",t.scrollable.hasOverflow()),o.length)if(t.minDayWidth&&n.scrollWidth>n.clientWidth){const e=(t.minDayWidth||(o.length?o[0].offsetWidth:0))*o.length;r.classList.remove("b-hide-display"),t.scrollbarScroller.scrollWidth=e,i.overflowX="hidden-scroll"}else r.classList.add("b-hide-display"),i.overflowX=!1;t.trigger("layoutUpdate")}refreshDayBackground(){const e=this,{contentElement:n,hourHeight:a,dayStartOffset:r,_hourHeightLevel:i,hourHeightLevel:s}=e,o=e.dayContentElement.classList,l=e.getDayLength("hour"),d=a*l,c=(a-1)/2,u=(a-1)/12,h=(a-1)/10,g=n.style,v=Math.ceil(t.format(yn,e.timeFormat).length/2);o.remove("b-dayview-hourheight-level-1","b-dayview-hourheight-level-2","b-dayview-hourheight-level-3","b-dayview-hourheight-level-4"),o.add(`b-dayview-hourheight-level-${s.level}`),g.setProperty("--time-axis-width",`${v}em`),g.setProperty("--day-length",l),g.setProperty("--day-height",`${d}px`),g.setProperty("--hour-height",`${a}px`),g.setProperty("--half-hour-height",`${c}px`),g.setProperty("--five-minute-height",`${u}px`),g.setProperty("--leaf-tick-height",`${e.sixMinuteTicks?h:u}px`),g.setProperty("--day-start-offset",`${r}px`),s.level!==(null==i?void 0:i.level)&&e.trigger("tickChange",{old:i||Cn,new:s})}updateSixMinuteTicks(){this.isConfiguring||this.updateElementLayout()}changeHourHeightBreakpoints(e){return Array.isArray(e)?e:Object.values(e)}updateHourHeightBreakpoints(){this.isConfiguring||this.updateElementLayout()}get hourHeightLevel(){const e=this,{hourHeight:t,hourHeightBreakpoints:n,sixMinuteTicks:a}=e,r=a?Sn:En;for(let i=a?2:3;i>=0;i--)if(t>=n[i])return e._hourHeightLevel={level:i+1,step:r[i]};return e._hourHeightLevel=Cn}updateLocalization(){!this.isConfiguring&&this.allDayTextElement&&n.sync({targetElement:this.allDayTextElement,domConfig:{html:this.L("L{EventEdit.All day}")}}),super.updateLocalization()}}kn.initClass(),kn._$name="DayView";class Rn extends(L.mixin(Se,ne,Ee)){get hideNonWorkingDays(){var e;return null===(e=this.calendar)||void 0===e?void 0:e.hideNonWorkingDays}set hideNonWorkingDays(e){const{calendar:t}=this;t&&(e||null!=t.hideNonWorkingDays)&&(t.hideNonWorkingDays=e)}changeIncludeWeekendsButton(e,t){var n;const a=this,r=e&&(null===(n=a.calendar)||void 0===n?void 0:n.includeWeekendsButton);return r&&(e=N.mergeConfigs(e,r)),e&&!t?a.add(e):N.reconfigure(t,e,a)}updateIncludeWeekendsButton(e){e&&(e.toggleGroup=null),this.syncFullWeek()}changeIncludeWeekendsMenuItem(e,t){var n;const a=null==this||null===(n=this.button)||void 0===n?void 0:n.menu;return e&&!t?null==a?void 0:a.add(e):I.reconfigure(t,e,a)}updateIncludeWeekendsMenuItem(){this.syncFullWeek()}onBeforeFirstShowModeMenu({menu:e}){const t=this,{calendar:n}=t,{activeView:a}=n,r=Object.values(n.modes);let i,s;for(s of r)i=s.$modeMenuItem,e.add(i),i.checked=s===a,i.onToggle="up.onToggleMenuItem";t.getConfig("includeWeekendsMenuItem"),t.syncFullWeek(),t.menuReady=!0}addMode(e,t,n){const a=this,{buttonBar:r}=a,i=t.$modeMenuItem=I.reconfigure(t.$modeMenuItem,I.mergeConfigs({type:I,view:t,ref:`${e}ShowMenuItem`,checked:!1,closeParent:!0,toggleGroup:`${a.id}-modeSelectorMenuItem`,localizable:!1,text:t.displayName,weight:0},n)),s=r.add(N.mergeConfigs({view:t,ref:`${e}ShowButton`,toggleGroup:`${a.id}-modeSelectorButton`,text:t.displayName,localizable:!1,onBeforeToggle:"up.onBeforeToggleButton",onToggle:"up.onToggleButton",weight:0},n));a.getConfig("includeWeekendsButton"),t.ion({thisObj:a,localized(){s.text=t.displayName,i.text=t.displayName}})}onBeforeToggleButton({pressed:e}){if(e&&this.calendar.viewContainer.layout.isChangingCard)return!1}onToggleButton({source:e,pressed:t}){t&&(this.calendar.mode=e.view)}updateDisabled(e){this.buttonBar.items.forEach((t=>{e&&t.containsFocus||(t.disabled=e)}))}onToggleMenuItem({source:e,checked:t}){t&&(this.calendar.mode=e.view)}onToggleWorkingDaysButton({pressed:e}){this.hideNonWorkingDays=!e}onToggleWorkingDaysMenu({checked:e}){this.hideNonWorkingDays=!e}syncActiveMode(e){const t=this,n=t.buttonBar.items;let a;for(a of(t.button.text=e.displayName,t.includeWeekendsButton.hidden=!e.hasNonWorkingDays,t.syncFullWeek(),n))a.view&&(a.pressed=a.view===e);if(t.menuReady)for(a of t.button.menu.items){var r;(null===(r=a.view)||void 0===r?void 0:r.$modeMenuItem)===a&&(a.checked=a.view===e)}t[n.length>1?"show":"hide"]()}syncFullWeek(){const{calendar:e,hideNonWorkingDays:t,_includeWeekendsButton:n,_includeWeekendsMenuItem:a}=this,r=!t;e.isConfiguring||(n&&(n.pressed=r),a&&(a.checked=r))}changeButton(e,t){return N.reconfigure(t,e)}updateButton(e){e&&this.add(e)}changeButtonBar(e,t){return Re.reconfigure(t,e)}updateButtonBar(e){e&&this.add(e)}changeCalendar(e){return e&&!e.isWidget&&(e=this.up(e)),e}updateCalendar(e){this.detachListeners("cal"),this.syncFullWeek(),null==e||e.ion({name:"cal",changeHideNonWorkingDays:"syncFullWeek",thisObj:this})}}e(Rn,"$name","ModeSelector"),e(Rn,"type","calendarmodeselector"),e(Rn,"configurable",{minifiable:!0,minified:null,button:{type:"button",icon:"b-icon-calendar-days",cls:"b-calendar-mode-button",menuIcon:null,menu:[],internalListeners:{beforeShowMenu:"up.onBeforeFirstShowModeMenu",once:!0}},buttonBar:{type:"buttongroup",ignoreParentReadOnly:!0},calendar:{value:"calendar",$config:"lazy"},includeWeekendsButton:{$config:"lazy",value:{type:"button",cls:"b-calendar-fullweek-button",toggleGroup:"no",text:"L{ModeSelector.weekends}",tooltip:"L{ModeSelector.includeWeekends}",onToggle:"up.onToggleWorkingDaysButton",weight:-1}},includeWeekendsMenuItem:{$config:"lazy",value:{separator:!0,text:"L{ModeSelector.includeWeekends}",checked:!1,onToggle:"up.onToggleWorkingDaysMenu",weight:10}},layout:{type:"box",wrap:!1},overflowable:"none",responsive:{large:{minifiable:!0,minified:null},"*":{minifiable:!1,minified:!0}},responsiveTarget:"@calendar"}),e(Rn,"fenced",{onToggleButton:!0,onToggleMenuItem:!0,syncFullWeek:!0,syncActiveMode:{all:"syncActiveMode",lock:["onToggleButton","onToggleMenuItem","syncActiveMode"]}}),Rn.initClass(),Rn._$name="ModeSelector";const xn=/^(\d+)ev$/,Mn={shrinkwrap:1,expand:1};class Tn extends(fe.mixin(zt,Ut,Qt)){static get $name(){return"MonthView"}static get type(){return"monthview"}static get configurable(){return{eventSorter:Ht.interDaySorterFn,localizableProperties:["title","stepUnit"],title:"L{Month}",stepUnit:"L{monthUnit}",localeClass:this,descriptionFormat:"MMMM, YYYY",dayNumberCentered:null,eventHeight:20,minHeight:485,autoRowHeight:{$config:"lazy",value:!1},maxEventsPerCell:100,minRowHeight:null,overflowClickAction:"popup",alwaysRefreshOnMonthChange:!0}}static get delayable(){return{syncCalendarWeekDaysWithScrollable:{type:"raf",cancelOutstanding:!0},onAllWeekElementsCollapsed:{type:"raf",cancelOutstanding:!0}}}onCalendarStoreChange(){super.onCalendarStoreChange(...arguments),this.syncShrinkwrappedRows()}onDateChange({changes:e}){e.m&&this.syncShrinkwrappedRows()}onCellOverflowGesture({date:e}){Mn[this.overflowClickAction.toLowerCase()]?this.shrinkwrapWeekRow(e):super.onCellOverflowGesture(...arguments)}addCellHeaderContent(e,t){const n={className:{"b-day-name":!0}};return e.children=[t.visibleColumnIndex||this.showWeekColumn?null:{className:"b-week-num",text:t.week[1]},n],n}get shrinkwrappedRows(){return this.weeksElement.querySelectorAll(".b-shrinkwrapped")}get shrinkwrapRowHeights(){const e=this,n=[],{cellMap:a}=e;return e.month.eachWeek(((e,[r])=>{let i=0;for(let e=0;e<7;e++,r.setDate(r.getDate()+1)){const e=a.get(t.makeKey(r));e&&(i=Math.max(i,e.renderedEvents.length))}n.push(i)})),n.map((t=>e.eventHeightInPixels*t+e.eventSpacing*(t+1)+Math.ceil(e._eventContainerTop)))}getEventsPerCell(e){const n=this;if(n.hasShrinkwrappedRows){const a=Math.floor(t.diff(n.startDate,e,"d")/7);if(n.weekElements[a].classList.contains("b-shrinkwrapped"))return n.maxEventsPerCell;{const e=n.weekElements[a].querySelector(n.visibleCellSelector).offsetHeight-n.eventContainerTop;return Math.floor((e+n.eventSpacing)/(n.eventHeightInPixels+n.eventSpacing))}}return n.eventsPerCell}getMaxEventsForWeek(e){const{row:t}=this.getWeekContext(e);return Math.max(...Array.from(t.querySelectorAll(this.visibleCellSelector)).map((e=>{const t=this.cellMap.get(e.dataset.date);return(null==t?void 0:t.renderedEvents.length)||0})))}getWeekContext(e){let n,a;if("number"==typeof e)a=e,n=t.parseKey(this.weekElements[e].querySelector(this.visibleCellSelector).dataset.date);else if(1===e.nodeType)n=t.parseKey(e.closest(".b-calendar-row").querySelector("[data-date]").dataset.date),a=Math.floor(t.diff(this.startDate,n,"d")/7);else{const r=(e.getDay(e)-t.weekStartDay+7)%7;n=t.add(t.clearTime(e),-r,"d"),a=Math.floor(t.diff(this.startDate,e,"d")/7)}return{rowIndex:a,weekStart:n,row:this.weekElements[a]}}shrinkwrapWeekRow(e,t=!0){const n=this,{weekStart:r,row:i}=n.getWeekContext(e),{weekElements:s}=n,o=i.classList.contains("b-shrinkwrapped"),l=n.getMaxEventsForWeek(e),d=n.eventHeightInPixels*l+n.eventSpacing*(l+1)+Math.ceil(n._eventContainerTop);for(let e=0,{length:t}=s;e<t;e++){const t=s[e];t.classList.contains("b-shrinkwrapped")||(t.style.flex=`0 0 ${a.percentify(1/n.visibleWeekCount*100)}`)}t&&(n.scrollable={overflowY:"auto"});const c=i.getBoundingClientRect();if(i.classList.add("b-shrinkwrapped"),d>c.height&&i.classList.add("b-expanded"),n.hasShrinkwrappedRows=!0,i.style.flex=`0 0 ${d}px`,t&&n.refresh(),o||n.trigger("weekShrinkwrap",{weekStart:r,element:i}),t)return n.isAnimating||(n.isAnimating=!0),new Promise((e=>{m.onTransitionEnd({element:i,property:"flex-basis",handler:"onAllWeekElementsExpanded",thisObj:n,args:[e]})}))}onAllWeekElementsExpanded(e,t,n){this.isAnimating=!1,this.syncCalendarWeekDaysWithScrollable(),n()}flexWeekRow(e,t=!0){const n=this,{weekStart:r,row:i}=n.getWeekContext(e);if(i.classList.contains("b-shrinkwrapped")){i.style.flex=`0 0 ${a.percentify(1/n.visibleWeekCount*100)}`,i.classList.add("b-flexing"),n._autoRowHeight=!1,n.trigger("weekFlex",{weekStart:r,element:i}),t&&!n.isAnimating&&(n.isAnimating=!0);return new Promise((e=>{m.onTransitionEnd({element:i,property:"flex-basis",handler:t?"onAllWeekElementsCollapsed":"onWeekElementCollapsed",thisObj:n,args:[e]})}))}}onWeekElementCollapsed(e,t,n){e.classList.remove("b-shrinkwrapped","b-flexing","b-expanded"),n()}onAllWeekElementsCollapsed(e,t,n){const a=this,{weekElements:r}=a;if(a.scrollable.overflowY=a.scrollable.hasOverflow("y"),e.classList.remove("b-shrinkwrapped","b-flexing","b-expanded"),!a.contentElement.querySelector(".b-calendar-week.b-shrinkwrapped"))for(let e=0,{length:t}=r;e<t;e++){const t=r[e];t.classList.contains("b-shrinkwrapped")||(t.style.flex="")}a.isAnimating=!1,a.hasShrinkwrappedRows=a.shrinkwrappedRows.length,a.refresh(),a.syncCalendarWeekDaysWithScrollable(),n()}syncCalendarWeekDaysWithScrollable(){var e;this.weekdaysHeader.classList[null!==(e=this.scrollable)&&void 0!==e&&e.hasScrollbar()?"add":"remove"]("b-show-yscroll-padding")}updateHideOtherMonthCells(){super.updateHideOtherMonthCells(...arguments),this.refresh()}updateEventHeight(e,t){const n=this;if(super.updateEventHeight(e,t),!n.isConfiguring){var r;null!==(r=n.minRowHeight)&&void 0!==r&&r.match(xn)&&n.updateMinRowHeight(n._minRowHeight),n.syncShrinkwrappedRows();const e=a.getEdgeSize(n.element,"padding","tb");n.minHeight=6*(2*(n.eventHeightInPixels+1)+3*n.eventSpacing+Math.ceil(n.eventContainerTop))+n.weekdaysHeader.offsetHeight+7+e.height}}updateMinRowHeight(e){var t,n,r;const i=this,s=parseInt(null===(t=e)||void 0===t||null===(n=t.match)||void 0===n||null===(r=n.call(t,xn))||void 0===r?void 0:r[1]);if(!isNaN(s)){if(i.isConfiguring)return i.ion({paint:"updateMinRowHeight",args:[e],once:!0});e=i.eventHeightInPixels*s+i.eventSpacing*(s+1)+Math.ceil(i.eventContainerTop)}i.cssMinRowHeight=a.setLength(e),super.updateMinRowHeight(e),i.isAnimating?i.ion({animationEnd:"performResizeRefresh",thisObj:i,args:[i._eventsPerCell,i._eventContainerTop],once:!0}):i.performResizeRefresh(i._eventsPerCell,i._eventContainerTop)}async updateAutoRowHeight(e,t){var n,a;if(this.initializingAutoRowHeight&&e===Boolean(t))return;const r=this,{weekElements:i}=r,{length:s}=i,o=null===(n=r.features||(null===(a=r.calendar)||void 0===a?void 0:a.features))||void 0===n?void 0:n.weekExpander;let l;if(o&&e&&(o.disabled=o.disabledByAutoRowHeight=!0),e)for(let e=0;e<s;e++)l=r.shrinkwrapWeekRow(e,e===s-1);else for(let e=0;e<s;e++)l=r.flexWeekRow(e,e===s-1);await l,o&&!e&&o.disabledByAutoRowHeight&&(o.disabled=o.disabledByAutoRowHeight=!1),e||(r._eventContainerHeight=r._eventsPerCell=null,r.refresh())}syncShrinkwrappedRows(){if(this.isVisible){const{shrinkwrappedRows:e}=this;for(let t=0,{length:n}=e;t<n;t++)this.shrinkwrapWeekRow(e[t],t===n-1)}}changeScrollable(e,t){var n;return null!==(n=e=super.changeScrollable(e,t))&&void 0!==n&&n.overflowX&&(this.weekdaysScrollable||(this.weekdaysScrollable=new x({widget:this,element:this.weekdaysHeader,overflowX:"hidden-scroll"})),e.addPartner(this.weekdaysScrollable,"x")),e}collectEvents(e){if(this.hideOtherMonthCells){const{year:t,month:n}=this.month;e.startDate=new Date(t,n,1),e.endDate=new Date(t,n+1,1)}return e.getDateIndex=e=>e>(this.firstVisibleDate||this.startDate)?"startDate":"date",this.eventStore.getEvents(e)}getDayElement(e,n){if("string"!=typeof e&&(e=t.makeKey(e)),!n||parseInt(e.substr(5,2))===this.month.month+1)return super.getDayElement(e)}calendarHitTest(e){const t=super.calendarHitTest(e),n=a.getEventElement(e);if(t){var r;if(t.date.getMonth()!==this.month.month&&(this.disableOtherMonthCells||this.hideOtherMonthCells))return;const e=n.closest(".b-calendar-week"),a=null==e||null===(r=e.dataset.week)||void 0===r?void 0:r.split(",").map(Number);var i;if(a)t.cell=t.cell||n.closest(".b-calendar-cell"),t.dayNumber=Number(null===(i=t.cell)||void 0===i?void 0:i.dataset.columnIndex),t.week=a,t.weekElement=e,t.weekNumber=a[1],t.weekOffset=a[1]-Number(this.weeksElement.firstElementChild.dataset.week.split(",")[1])}return t}getDateFromPosition(e,t){const n=this,a=n.weeksElement.childNodes;for(let r,i=0;i<a.length;++i)if(r=a[i].getBoundingClientRect(),r.top<=t&&t<r.bottom&&r.left<=e&&e<r.right){const t=n.rtl?r.right-e:e-r.x,s=Math.floor(t*n.weekLength/r.width);if(n.hideNonWorkingDays){return Array.from(a[i].querySelectorAll(n.visibleCellSelector)).map((e=>n.getDateFromElement(e)))[s]}{const e=n.getDateFromElement(a[i].querySelector(n.visibleCellSelector));return e.setDate(e.getDate()+s),e}}return null}getWeekElementFor(e){const t=a.getEventElement(e);return(null==t?void 0:t.closest(".b-calendar-week"))||null}updateEventStore(e,t){var n;null===(n=super.updateEventStore)||void 0===n||n.call(this,e,t),fe.prototype.doRefresh.call(this)}updateOverflowClickAction(){this.refresh()}updateSixWeeks(){this._eventsPerCell=this._eventContainerTop=this._eventContainerHeight=null,super.updateSixWeeks(...arguments)}onMonthDateChange({changes:e}){e.r&&!this.sixWeeks&&(this._eventsPerCell=this._eventContainerTop=this._eventContainerHeight=null),super.onMonthDateChange(...arguments)}doRefresh(){var e;this.isConfiguring||(this.getConfig("autoRowHeight"),null===(e=this._cellMap)||void 0===e||e.clear());const t=super.doRefresh();return this.syncCalendarWeekDaysWithScrollable(),t}showEvent(e){this.setDate(e.startDate)}changeDayNumberCentered(e){return Boolean(e)}updateShowWeekColumn(e){e||this.element.querySelector(".b-week-num")||this.doRefresh(),super.updateShowWeekColumn(e)}updateHideNonWorkingDays(e){var t;null===(t=super.updateHideNonWorkingDays)||void 0===t||t.call(this,e),this.isConfiguring||this.refresh()}updateDayNumberCentered(e){const t=this;t._dayNumberCentered||"nonCenteredDayNumShowWeekColumn"in t||(t.nonCenteredDayNumShowWeekColumn=t.showWeekColumn),t._dayNumberCentered=e,t.element.classList[e?"add":"remove"]("day-number-center"),t.showWeekColumn=!!e||t.nonCenteredDayNumShowWeekColumn}get dayNameSelector(){return this.showWeekColumn?".b-cal-cell-header":super.dayNameSelector}set dayNameSelector(e){this._dayNameSelector=e}isValidTargetDate(e){if(e.getMonth()!==this.month.month){var n,a;const r=this.minDate||(null===(n=this.calendar)||void 0===n?void 0:n.minDate),i=this.maxDate||(null===(a=this.calendar)||void 0===a?void 0:a.maxDate);if(!isNaN(r)||!isNaN(i)){const{cellMonth:n}=this;if(n.date=e,!isNaN(r)&&n.startDate<r)return!1;if(!isNaN(i)&&t.add(n.endDate,1,"d")>i)return!1}}return!0}set startDate(e){this.date=e}get startDate(){return super.startDate}next(){this.date=t.add(this.date||this.startDate,1,"month")}previous(){this.date=t.add(this.date||this.startDate,-1,"month")}}Tn.initClass(),Tn._$name="MonthView";const Nn=new Date(0),Wn=t.add(Nn,1,"day"),Pn=Object.freeze(new Map),Hn={hourHeight:1,showAllDayHeader:1};class On extends(P.mixin(zt)){constructor(...t){super(...t),e(this,"sharedConfigs",["allowOverlap","timeFormat","fitHours","hourHeight","visibleStartTime","dateFormat","dayStartTime","dayEndTime","hideNonWorkingDays","readOnly","zoomOnMouseWheel"]),e(this,"timeAxisConfigs",["allDayEvents"].concat(this.sharedConfigs))}static get $name(){return"ResourceView"}static get type(){return"resourceview"}static get configurable(){return{textContent:!1,scrollable:{overflowX:!0},date:{$config:{equal:"date"},value:null},view:{type:"weekview"},stableResourceOrder:!0,resourceWidth:null,hideNonWorkingDays:null,viewCache:{$config:["lazy","nullify"],value:!0},avatarRendering:{},meta:null,showAvatars:!0,includeTimeRanges:null}}construct(){var e,t;super.construct(...arguments),null===(e=this.calendar.sidebar)||void 0===e||null===(t=e.widgetMap.resourceFilter)||void 0===t||t.ion({change:"onResourceFilterSelectionChange",thisObj:this})}get isAnimating(){return super.isAnimating||this.items.some((e=>e.isAnimating))}get hasNonWorkingDays(){return!0}changeView(e){const t=this,n=new Proxy(s.assign({},e),{set(e,n,a){const r=Reflect.set(...arguments);return t.syncViewConfig(n,a),r},deleteProperty(e,n){const a=Reflect.deleteProperty(...arguments);return t.syncViewConfig(n,null),a}});return t.viewType=bryntum.Calendar.Modes.resolveType(e.type),n}eachView(e,t,n=null){const a=null==t,r=[...this.viewCache];for(let i=0,{length:s}=r;i<s;i++){const s=r[i];if(a&&(t=[s,i]),!1===s.callback(e,n||s,t))return}}get views(){return[...this.viewCache]}updateResourceStore(e){var t;this.detachListeners("resourceViewResourceChange"),null===(t=super.updateResourceStore)||void 0===t||t.call(this,e),e.ion({name:"resourceViewResourceChange",change:"onResourceStoreChange",sort:"onResourceStoreSort",thisObj:this}),this.refreshSoon()}onResourceStoreChange(){this.refreshSoon()}onResourceStoreSort({source:e}){const t=this.items.filter((e=>e.isVisible&&!e.isResourceDayViewTimeAxis)),n=e.map((e=>this.createViewId(e))),a=t.map((e=>e.id));s.isEqual(n,a)||(this.remove(...t),this.refreshSoon())}onResourceFilterSelectionChange(){this.refreshSoon()}changeViewCache(e,t){if(e)return new $;t&&(t.forEach((e=>e.destroy())),t.clear())}getResourceView(e){return this.viewCache.get(this.createViewId(e))||this.createView(e)}doRefresh(){var e,n;const r=this,{scrollBarWidth:i}=a,{calendar:s,_items:o,resourceStore:l}=r,{resourceFilter:d}=null==s?void 0:s.widgetMap,c=d?r.resourceStore.records.filter((e=>d.value.includes(e))):r.resourceStore.records,{length:u}=c,h=[],g=[],v={};if(!l.count){const{weekStartDay:e}=r,n=t.getFirstDateOfMonth(r.date),a=t.add(n,1,"month");r.eventStore.getEvents({startDate:t.add(n,-(n.getDay()-e+7)%7,"d"),endDate:t.add(a,7-(a.getDay()-e+7)%7,"d")})}r.refreshSoon.cancel();let m=0;for(let e=0;e<u;e++){const t=r.getResourceView(c[e]),n=o.includes(t);l.getById(t.resourceId)?(t.title=r.titleTemplate(t.resource),n?m++:h.push(t),v[t.id]=1):n&&g.push(t)}m<o.count&&(r.eachView((e=>{v[e.id]||g.push(e)})),r.remove(g)),r.viewType.isDayView&&(o.includes(r.dayViewTimeAxis)||h.unshift(r.dayViewTimeAxis),i&&!o.includes(r.dayViewScroller)&&h.push(r.dayViewScroller));const p=null===(e=r.items[0])||void 0===e||null===(n=e.scrollable)||void 0===n?void 0:n.y;if(r.add(...h),null!=p&&h.forEach((e=>{e.scrollable.element.scrollTop=p})),h.length||g.length){let e;for(let t=0,{items:n}=r,{length:a}=n;t<a;t++){var y;const a=n[t],{scrollable:r}=a;a.element.classList.remove("b-last-resource-view"),a.isResourceDayViewTimeAxis||(a.element.classList[t>1?"remove":"add"]("b-first-resource-view"),e=a),r&&(r.clearPartners(),t&&a.scrollable.addPartner(n[t-1].scrollable,"y")),null===(y=a.allDayEvents)||void 0===y||y.refresh()}if(e&&e.element.classList.add("b-last-resource-view"),r.viewType.isDayView){const e=r.views.filter((e=>e.allDayEvents&&e.isVisible)),t=e.length&&Math.max(...e.map((e=>e.allDayEvents.cellContentHeight)));t&&o.forEach((e=>{var n;null===(n=e.allDayEvents)||void 0===n||n.setEventContentHeight(t,!1,!0)}))}}r.viewType.isDayView&&r.syncDayViewScrollerVisibility(),r.refreshCount=(r.refreshCount||0)+1,r.trigger("refresh")}onCalendarPointerInteraction(){}onCalendarStoreChange(){}onChildAdd(e){super.onChildAdd(e),g.before(e,"onConfigChange","onChildViewConfigChange",this,{return:!1})}onChildViewConfigChange({name:e,value:t}){if(!this.syncingChildViewConfigs&&this.timeAxisConfigs.includes(e)){const n=new Set(this.items.concat([...this.viewCache]));this.syncingChildViewConfigs=!0,n.forEach((n=>{e in n&&(n[e]=t)})),this.syncingChildViewConfigs=!1}}createView(e){var t;const n=this,{id:r}=e,{resourceStore:i,viewCache:o}=n,{project:l}=i,d=M.merge({project:l,calendar:n.calendar,id:n.createViewId(e),cls:"b-resourceview-resource",defaultCalendar:r,resource:e,resourceId:r,includeTimeRanges:n.includeTimeRanges,hideNonWorkingDays:n.hideNonWorkingDays,parent:n,date:n.date,dateFormat:n.dateFormat,title:n.titleTemplate(e)},n.view);s.copyProperties(d,[...o][0]||n,n.sharedConfigs),a.scrollBarWidth&&n.viewType.isDayView&&(d.scrollable={overflowX:!1,overflowY:"hidden-scroll"});const c=bryntum.Calendar.Modes.create(d);return c.ion({catchAll:"onChildViewCatchAll",thisObj:n}),c.element.removeAttribute("tabIndex"),c.element.dataset.viewResourceId=e.id,null===(t=c.contentElement)||void 0===t||t.removeAttribute("tabIndex"),Object.defineProperty(c,"weight",{get:()=>n.stableResourceOrder?i.allIndexOf(r):0}),Object.defineProperty(c,"resource",{get:()=>i.getById(r)}),Object.defineProperty(c,"eventFilter",{get(){return e=>e.resources.includes(this.resource)}}),o.add(c),n.trigger("viewCreate",{view:c}),c}onChildViewCatchAll(e){e.resourceRecord=e.source.resource,"paint"!==e.type&&this.trigger(e.type,e),"heightchange"===e.type&&this.syncDayViewScrollerVisibility()}changeAvatarRendering(e){if(e)return ee.new({element:this.element},e)}titleTemplate(e){const t=this,{meta:n}=t,r="string"==typeof n?e[n]:null==n?void 0:n(e),i=a.isNamedColor(e.eventColor)&&e.eventColor,s=!i&&e.eventColor;return{class:{"b-resourceview-title":1,"b-has-meta":r},children:[t.showAvatars&&{class:{"b-resource-avatar-container":1,[`b-sch-foreground-${i}`]:i},style:{color:s||null},children:[t.getResourceAvatar(e)]},{class:"b-resource-name",text:e.name},r&&{class:"b-resource-meta",text:r}]}}getEventElement(e,t=e.startDate){var n;return null===(n=this.getResourceView(e.resource))||void 0===n?void 0:n.getEventElement(e,t)}get dayViewTimeAxis(){const e=this;if(!e._dayViewTimeAxis){const t=s.copyProperties({},e.view,e.timeAxisConfigs);e._dayViewTimeAxis=Ln.create(d(d({},t),{},{weight:-1,project:e.project,type:"resourcedayviewtimeaxis",minWidth:0,cls:"b-resource-dayview-timeaxis",startDate:Nn,endDate:Wn,scrollable:{overflowX:!1,overflowY:"hidden-scroll"},onCornerClick(){const{expanded:t}=e.firstChild.allDayEvents,n=[];let a=null;e.eachView((({allDayEvents:e})=>{t?(!a||e.maxEventCount<a.maxEventCount)&&(a=e):(!a||e.maxEventCount>a.maxEventCount)&&(a=e)}));const r=a.refreshCount;a.expanded=!t,a.refreshCount===r&&n.push(a),e.items.forEach((e=>{if(e!==a){const{allDayEvents:a}=e,r=a.refreshCount;e.allDayEvents.expanded=!t,a.refreshCount===r&&n.push(a)}}));for(let e=0,{length:t}=n;e<t;e++)n[e].doRefresh()}}),e),O.addResizeListener(e._dayViewTimeAxis.timeAxisElement,e.syncDayViewScrollerVisibility.bind(e))}return e._dayViewTimeAxis}get dayViewScroller(){const e=this;if(!e._dayViewScroller){const t=s.copyProperties({},e.view,e.timeAxisConfigs);e._dayViewScroller=Ln.create(d(d({},t),{},{weight:999,project:e.project,type:"resourcedayviewtimeaxis",flex:`0 0 ${a.scrollBarWidth}px`,minWidth:a.scrollBarWidth,cls:"b-resource-dayview-scroller",startDate:Nn,endDate:Wn,scrollable:{overflowX:!1,overflowY:"scroll"}}),e),e._dayViewScroller.scrollable.addPartner(e.dayViewTimeAxis.scrollable,"y"),e.monitorResize=!0}return e._dayViewScroller}onElementResize(){super.onElementResize(),this.syncDayViewScrollerVisibility()}syncDayViewScrollerVisibility(){if(this.dayViewScroller){const e=this.dayViewTimeAxis.scrollable.hasOverflow("y");this.dayViewScroller.isVisible!==e&&this.dayViewScroller[e?"show":"hide"]()}}scrollTo(e){const{items:t}=this;if(e.isEventModel){const n=t.find((t=>t.eventStore.includes(e)));return null==n?void 0:n.scrollTo(e)}return t[0].scrollTo(e)}createViewId(e){return`${this.id}-resource${this.config.view.type}-${e.id}`}updateDate(e){this.suspendVisibility(),this.viewCache.forEach((t=>{t.isResourceDayViewTimeAxis||(t.date=e)})),this.resumeVisibility(),this.viewType.isDayView&&this.items.forEach((e=>{var t,n;null===(t=e.allDayEvents)||void 0===t||t.setEventContentHeight(null===(n=e.allDayEvents)||void 0===n?void 0:n.cellContentHeight)}))}updateResourceWidth(e){this.contentElement.style.setProperty("--resource-width",a.setLength(e))}updateHideNonWorkingDays(e){this.isConfiguring||this.syncViewConfig("hideNonWorkingDays",e)}updateNonWorkingDays(e){this.isConfiguring||this.syncViewConfig("nonWorkingDays",e)}updateIncludeTimeRanges(e){this.isConfiguring||this.syncViewConfig("includeTimeRanges",e)}syncViewConfig(e,t){const n=n=>{n[e]=t};Hn[e]?this.items.forEach(n):this.eachView(n)}descriptionRenderer(){var e;return(null===(e=[...this.viewCache.items][0])||void 0===e?void 0:e.description)||"No resources"}get startDate(){return new Date(Math.min(...this.items.reduce(((e,t)=>(t.isResourceDayViewTimeAxis||e.push(t.startDate),e)),[])))}get endDate(){return new Date(Math.max(...this.items.reduce(((e,t)=>(t.isResourceDayViewTimeAxis||e.push(t.endDate),e)),[])))}get stepUnit(){const e=[...this.viewCache][0];return null==e?void 0:e.stepUnit}get firstChild(){return this.items.filter((e=>!e.isResourceDayViewTimeAxis))[0]}previous(){const e=[...this.viewCache][0];e&&(this.date=t.add(this.date,-e.duration,"day"))}next(){const e=[...this.viewCache][0];e&&(this.date=t.add(this.date,e.duration,"day"))}}class Ln extends kn{static get $name(){return"ResourceDayViewTimeAxis"}static get type(){return"resourcedayviewtimeaxis"}static get configurable(){return{allDayEvents:{type:"resourcedayviewalldayevents"}}}compose(){const e=super.compose();return e["aria-hidden"]=!0,e}scrollToVisibleStartTime(){}createCellMap(){return Pn}calculateCellContentHeight(){return 0}getDateFromPosition(e,n,a=!1){const r=this,i=r.startDate,s=a?0:r.dayContentElement.getBoundingClientRect().y,o=r.timeAxisElement.offsetHeight,l=n-s;return t.round(t.add(t.clearTime(i),r.dayStartMs+Math.floor(l/o*r.getDayLength()),"ms"),r.increment)}}(class extends sn{static get $name(){return"ResourceDayViewAllDayEvents"}static get type(){return"resourcedayviewalldayevents"}get hasOverflow(){return this.up("resourceview").views.some((e=>{var t;return null===(t=e.allDayEvents)||void 0===t?void 0:t.hasOverflow}))}createCellMap(){return Pn}}).initClass(),Ln.initClass(),On.initClass(),On._$name="ResourceView";class In extends(P.mixin(Ee)){static get $name(){return"Sidebar"}static get type(){return"sidebar"}static get configurable(){return{focusable:!1,bbar:{cls:"b-cal-nav-item",layout:{justify:"center"},items:{todayButtonSidebar:{text:"L{Calendar.Today}",onClick:"up.shiftToNow",weight:200},prevButtonSidebar:{onClick:"up.shiftPrevious",cls:"b-borderless",icon:"b-icon-previous",weight:300},nextButtonSidebar:{onClick:"up.shiftNext",cls:"b-borderless",icon:"b-icon-next",weight:400}}},items:{datePicker:{type:"datepicker",weight:100,internalListeners:{selectionChange:"up.onMonthSelectionChange"}},eventFilter:{type:"filterfield",field:"name",weight:150,placeholder:"L{Filter events}",localeClass:this},resourceFilter:{ignoreParentReadOnly:!0}},date:{$config:{equal:"date"},value:null},eventStore:null,responsive:{},stepUnitText:null,side:"left",collapsible:{tool:null},resourceFilter:{type:"resourcefilter",flex:"1 1 auto",weight:200,minHeight:110,scrollable:{overflowY:"auto"},store:{sorters:[{field:"name",ascending:!0}]},masterFilter(e){return this.eventStore.resourceStore.isAvailable(e)}}}}setupWidgetConfig(e,t){let n=super.setupWidgetConfig(...arguments);return"eventFilter"===n.ref&&(n.store=this.initialConfig.eventStore),"resourceFilter"===n.ref&&(n.type&&n.type!==this.resourceFilter.type||(n=In.mergeConfigs(this.resourceFilter,n))),"datepicker"===n.type&&(this.element.classList.add("b-has-datepicker"),this.element.classList.toggle("b-datepicker-with-events",Boolean(n.events))),n}updateSide(e,t){const{classList:n}=this.element;n.remove(`b-sidebar-${t}`),n.add(`b-sidebar-${e}`),this.collapsible&&(this.collapsible.direction=e)}updateStepUnitText(e){const t=this,{prevButtonSidebar:n,nextButtonSidebar:a}=t.widgetMap;n&&(n.tooltip=e?t.L("L{Calendar.previous}",e):"",n.disabled=!e),a&&(a.tooltip=e?t.L("L{Calendar.next}",e):"",a.disabled=!e)}updateEventStore(e){const{resourceFilter:t,datePicker:n}=this.widgetMap;t&&(t.eventStore=e),n&&(n.eventStore=e)}onMonthSelectionChange({selection:e,userAction:t}){this.UIdateChange=t,this.date=e[0],this.UIdateChange=!1}changeDate(e,n){if(e="string"==typeof e?t.parse(e):new Date(e),isNaN(e))throw new Error("Calendar widget date ingestion must be passed a Date, or a YYYY-MM-DD date string");if(e=t.clearTime(e),!n||e-n)return e}updateDate(e){const{datePicker:t}=this.widgetMap;t&&(t.value=e),this.trigger("dateChange",{date:e,userAction:Boolean(this.UIdateChange)})}}In.initClass(),In._$name="Sidebar";class $n extends kn{static get $name(){return"WeekView"}static get type(){return"weekview"}static get configurable(){return{localizableProperties:["title","stepUnit"],title:"L{Week}",stepUnit:"L{weekUnit}",range:{magnitude:1,unit:"week"},responsive:{small:{descriptionFormat:"MMMM YYYY"},large:{descriptionFormat:["MMMM YYYY (Wp)","S{MMM} - E{MMM YYYY} (S{Wp})"]},"*":{descriptionFormat:["MMMM YYYY","S{MMM} - E{MMM YYYY}"]}},week:null,fixedDuration:!0}}calculateDuration(){return 7}updateWeekStartDay(e,t){var n;if(null===(n=super.updateWeekStartDay)||void 0===n||n.call(this,e),!this.isConfiguring){const n=new Date(this.startDate);n.setDate(n.getDate()+e-t),this.startDate=n}}changeMonth(){const e=super.changeMonth(...arguments);return e.ion({weekChange:"onMonthWeekChange",thisObj:this}),e}onMonthWeekChange({source:e,newDate:t}){this.week=e.getWeekNumber(t)}changeWeek(e,n){const a=this;if(e=Array.isArray(e)?e:[a.month.year,e],!s.isEqual(e,n)){var r,i;const n=a.minDate||(null===(r=a.calendar)||void 0===r?void 0:r.minDate),s=a.maxDate||(null===(i=a.calendar)||void 0===i?void 0:i.maxDate);if(!isNaN(n)||!isNaN(s)){const r=a.month.getWeekStart(e),i=t.add(r,a.duration,"d");if(!isNaN(n)&&r<n)return;if(!isNaN(s)&&i>s)return}return e}}updateWeek(e){const t=this,{month:n,date:a,dayTime:r}=t,i=r.shiftDate(n.getWeekStart(e));a&&s.isEqual(n.getWeekNumber(a),e)?t.startDate=i:t.date=i,t.week=n.getWeekNumber(t.date)}}$n.initClass(),$n._$name="WeekView";const Vn={hover:1,mouseover:1};class An extends(P.mixin(zt,Ut,Qt)){static get $name(){return"YearView"}static get type(){return"yearview"}static get configurable(){return{textContent:!1,localizableProperties:["title","stepUnit"],title:"L{Year}",scrollable:{overflowY:!0},stepUnit:"L{yearUnit}",month:!0,date:{$config:{equal:"date"},value:null},descriptionFormat:"YYYY",year:null,monitorResize:!1,showWeekColumn:!0,hideWeekColumnCls:"b-hide-week-numbers",otherMonthCls:"b-other-month",sixWeeks:!0,dayCellRenderer:null,monthSelector:".b-yearview-month-name",focusable:!1,showEvents:"heatmap",maxDots:4,eventCountTip:null}}createCellMap(e){const t=super.createCellMap(e=d({skipPropagate:!0},e));for(const e of t.values())e.renderedEvents.setEvents(e.events);return t}get date(){return this._date||!this.isConfiguring&&this.firstEventDate||this.startDate}next(){this.date=new Date(this.year+1,this.date.getMonth(),this.date.getDate())}previous(){this.date=new Date(this.year-1,this.date.getMonth(),this.date.getDate())}get firstEventDate(){const e=[...this.cellMap.values()];if(e.length)return e[0].date}get lastEventDate(){const e=[...this.cellMap.values()];if(e.length)return e[e.length-1].date}onCalendarPointerInteraction(e){var t,n;const a=this,r=super.onCalendarPointerInteraction,{target:i,type:s}=e;if(("mousedown"===s||s.endsWith("click"))&&a.clearTimeout(a.cellOverflowTimer),"mousedown"===s&&null!==(t=a._overflowPopup)&&void 0!==t&&t.isVisible&&i.closest(".b-cal-cell-overflow")&&e.preventDefault(),"click"!==a.overflowPopupTrigger||"dblclick"!==(null===(n=a.autoCreate)||void 0===n?void 0:n.gesture)||"click"!==s||!i.closest(`.${a.emptyCellCls}`)||a.emptyCellRenderer)return r.apply(a,arguments);a.cellOverflowTimer=a.setTimeout({fn:r,delay:300,args:[e]})}changeMonth(e,t){const n=this,a={name:"yearChangeListener",yearChange:"onMonthYearChange",thisObj:n};return n.detachListeners("yearChangeListener"),e instanceof ye?(e.ion(a),n._year=e.year):e=new ye({date:new Date(n.year||(new Date).getFullYear(),0,1),weekStartDay:n.weekStartDay,hideNonWorkingDays:n.hideNonWorkingDays,nonWorkingDays:n.nonWorkingDays,sixWeeks:n.sixWeeks,listeners:a}),null==n.nonWorkingDays&&(n.nonWorkingDays=n._month.nonWorkingDays),n._year=e.year,e}onMonthYearChange({source:e}){const t=this;t._year=e.year,t.isConfiguring||(t._cellMap&&t._cellMap.clear(),t.date=e.date,t.refresh())}get eventsPerCell(){return 0}get startDate(){return this.month.getOtherMonth(new Date(this.year,0,1)).startDate}get endDate(){return t.add(this.month.getOtherMonth(new Date(this.year,11,1)).endDate,1,"day")}set startDate(e){this.date=e}isValidTargetDate(e){const n=e.getFullYear();if(n!==this.year){var a,r;const e=this.minDate||(null===(a=this.calendar)||void 0===a?void 0:a.minDate),i=this.maxDate||(null===(r=this.calendar)||void 0===r?void 0:r.maxDate);if(!isNaN(e)||!isNaN(i)){const{cellMonth:a}=this;if(!isNaN(e)){if(a.getWeekStart(a.getWeekNumber(new Date(n,0,1)))<e)return!1}if(!isNaN(i)&&(a.date=new Date(n,11,31),t.add(a.endDate,1,"d")>i))return!1}}return!0}updateDate(e){this.month.date=e}changeYear(e){return this.isConfiguring?e:(this.month.year=e,this.month.year)}changeShowEvents(e,t){return!0===e?"heatmap":e}updateShowEvents(e,t){const{classList:n}=this.contentElement;e&&n.add(`b-show-events-${e}`),n.remove(`b-show-events-${t}`),this.isConfiguring||this.doRefresh()}updateShowWeekNumber(){this.bodyElement.classList[this.showWeekColumn?"remove":"add"](this.hideWeekColumnCls)}doRefresh(){var e;const a=this,{bodyElement:r,month:i,dayCellCls:s,otherMonthCls:o,weekendCls:l,todayCls:d,nonWorkingDayCls:c,emptyCellCls:u,cellMap:h,showEvents:g}=a,v=[],m=(null===(e=a.calendar)||void 0===e?void 0:e.today)||new Date,p=t.makeKey(m);for(let e=0;e<12;e++){i.month=e;const n={tag:"button",className:"b-yearview-month-name",html:t.getMonthName(e),dataset:{monthDate:t.makeKey(new Date(a.year,e,1))}},r=[{className:"b-week-number-cell"}],m={className:"b-yearview-month",children:[n,{className:"b-calendar-week b-calendar-weekdays",children:r}]},y=m.children;v.push(m);let f=0;i.eachWeek(((e,n)=>{if(1===r.length)for(let e=0;e<7;e++)r.push({className:{"b-yearview-weekday-cell":1,[c]:a.nonWorkingDays[i.canonicalDayNumbers[e]]},text:t.format(n[e],"d1")});const v={className:"b-calendar-week",dataset:{week:`${e[0]},${e[1]}`}},m=v.children=[{tag:"button",ariaLabel:a.L("L{Calendar.weekOfYear}",e),className:"b-week-number-cell",html:e[1]}];y.push(v);for(let e=0;e<7;e++){const r=n[e],v=r.getMonth()!==i.month,y=t.makeKey(r),D=r.getDay(),C=!a.isConfiguring&&h.get(y),b=null==C?void 0:C.events,E=(null==b?void 0:b.length)||0,S=!v&&E,k={style:{},className:{"b-day-name":1,[s]:1,[u]:!E},dataset:{date:y,cellIndex:f,columnIndex:e}};let R=String(r.getDate());if(Object.assign(k.className,{[l]:t.weekends[D],[d]:y===p&&!v,[c]:a.nonWorkingDays[D],[o]:v,"b-cal-cell-overflow":S,[me.getEventCountClass(E)]:S,[`b-day-of-week-${D}`]:1}),a.dayCellRenderer){var w;const e=a.callback(a.dayCellRenderer,a,[{cellConfig:k,date:r,events:(null==C||null===(w=C.events)||void 0===w?void 0:w.map((e=>e.eventRecord)))||[]}]);null!=e&&(R=e)}if(E&&a.eventCountTip&&!Vn[a.overflowPopupTrigger]&&(k.dataset.btip=a.L("L{ResourceInfoColumn.eventCountText}",E)),"dots"===g){const e=[];for(let t=0;t<Math.min((null==b?void 0:b.length)||0,a.maxDots);t++){const n=a.createEventDomConfig({eventRecord:b[t].eventRecord,minimal:!0});e.push(n)}R=["object"==typeof R?R:{tag:"span",html:R},{className:"b-cal-minimal-event-container",children:e}]}k.children=[{className:"b-calendar-cell-inner",["string"==typeof R?"html":"children"]:R}],m.push(k),f++}}))}n.sync({targetElement:r,domConfig:{children:v}}),a.refreshCount=(a.refreshCount||0)+1,a.trigger("refresh")}getDayElement(e,n){if("string"!=typeof e&&(e=t.makeKey(e)),!n||parseInt(e.substr(0,4))===this.year)return this.contentElement.querySelector(`.b-calendar-cell[data-date="${e}"]:not(.b-other-month)`)}getCell(){return this.getDayElement(...arguments)}onPaint({firstPaint:e}){e&&this.refresh()}}An.initClass(),An._$name="YearView";const Fn=e=>e.isCalendarMixin;var _n=e=>class extends(de(e||c)){static get configurable(){return{navigator:{allowCtrlKey:!0,scrollSilently:!0,datasetIdProperty:"eventId",itemsTabbable:!0,keys:{ArrowUp:null,ArrowDown:null,Escape:null,Tab:null,"SHIFT+Tab":null}}}}normalizeTarget(e){return e.eventRecord}changeNavigator(e){const t=this;return t.getConfig("eventCls"),super.changeNavigator(t.constructor.mergeConfigs({target:t.element,itemSelector:`.b-cal-cell-overflow,.b-cal-cell-no-content,${t.eventSelector}`,skipScrollIntoView:!0},e))}onViewRefresh(){var e,t;if(null===(e=super.onViewRefresh)||void 0===e||e.call(this,...arguments),this.navigator.activeItem&&(null===(t=this.activeView.overflowPopup)||void 0===t||!t.containsFocus)){const e=this.getEventRecord(this.navigator.activeItem);e&&this.navigator.updateActiveItem(this.getElementFromEventRecord(e))}}onCalendarStoreChange({action:e,records:t}){var n;const r=this,{navigator:i}=r,s=null==i?void 0:i.activeItem;if(s&&!r.eventStore.includes(s.dataset.eventId)){const e=r.constructor.fromElement(s,Fn)||r.activeView,{_overflowPopup:t}=e,n=i.next;if(n!==s.nextSibling||n.parentNode.syncIdMap){let o=n||i.previous;if(null!=t&&t.containsFocus&&!t.contentElement.contains(o)){const{target:e}=t.lastAlignSpec;o=i.getAdjacent(1,e.nextSibling)||i.getAdjacent(-1,e)}if(o){const t=e.getDateFromElement(o),n=o.dataset.eventId,l=r.constructor.fromElement(o).closest(Fn);o.focus(),l.ion({refresh:()=>{o=l.getEventElement(n,t),o&&(o===a.getActiveElement(o)?i.triggerNavigate({eventPhase:Event.BUBBLING_PHASE,target:o},o):o.focus()),i.updateActiveItem(o,s)},once:!0})}else r.widgetMap.viewContainer.revertFocus(!0)}else i.triggerNavigate({eventPhase:Event.BUBBLING_PHASE,target:n},n)}null===(n=super.onCalendarStoreChange)||void 0===n||n.call(this,...arguments)}onElementKeyDown(e){var t;e.target.closest(this.navigator.itemSelector)&&(null===(t=super.onElementKeyDown)||void 0===t||t.call(this,e))}get activeEvent(){const{activeItem:e}=this.navigator;if(e)return this.resolveEventRecord(e)}get widgetClass(){}},Bn=e=>class extends(U(e||c)){normalizeTarget(e){return e.eventRecord}onSelectedCollectionChange({added:e,removed:t}){const n=this,a=n.selectedCollection,r=e||[],i=t||[];if(n.updateSelected(),!n.silent){const e=a.count>0?r.length>0&&i.length>0?"update":r.length>0?"select":"deselect":"clear";n.trigger("selectionChange",{action:e,selection:a.values,selected:r,deselected:i})}}onCalendarStoreChange({action:e,records:t}){var n;"remove"===e&&this.selectedCollection.remove(...t),null===(n=super.onCalendarStoreChange)||void 0===n||n.call(this,...arguments)}clearEventSelection(){this.selectedCollection.clear()}get selectedEvents(){return this.selectedCollection.values}set selectedEvents(e){e=b.asArray(e),this.selectedCollection.splice(0,this.selectedCollection.count,e)}isEventSelected(e){return this.selectedCollection.includes(e)}select(e,t=!1){this.selectEvent(e,t)}selectEvent(e,t=!1){const{selectedCollection:n}=this;this.isEventSelected(e)||!1===this.isEventSelectable(e)||(t?n.add(e):n.splice(0,n.count,e))}deselect(e){this.deselectEvent(e)}deselectEvent(e){this.isEventSelected(e)&&this.selectedCollection.remove(e)}selectEvents(e){this.selectedCollection.add(e.filter((e=>!1!==this.isEventSelectable(e))))}deselectEvents(e){this.selectedCollection.remove(e)}onEventSelectionClick(e){this.isEventSelected(e)?H.ctrlKeyDown&&this.deselectEvent(e):this.selectEvent(e,this.multiEventSelect&&H.ctrlKeyDown)}onEventNavigate({event:e,item:t}){if(t){const n=this.activeView.getEventRecord(t);if(n){if(2===e.button&&this.isEventSelected(n))return;this.onEventSelectionClick(n)}else this.clearEventSelection()}}get widgetClass(){}};const jn=(e,t)=>(e.weight||0)-(t.weight||0),zn=/(?:.)cell|number|name|overflow|mouse|down|up|dbl|click|over|out|context|menu|date|change|element|popup/g,Yn=/^.*event.*|.*resource.*|.*cell.*|.*row.*|.*schedule.*|daynumber.*|weeknumber.*|monthname.*|weekname.*$|beforedatechange|tickchange|.*showoverflowpopup/,qn=e=>h.capitalize(e),Un=e=>e.isCalendarMixin&&e.containsFocus;class Kn extends(P.mixin($t,Wt,be,X,_n,Bn,ce,Ee,V,ue)){static get $name(){return"Calendar"}static get type(){return"calendar"}static get configurable(){return{enableRecurringEvents:!0,localizableProperties:["autoCreate.newName"],crudManager:null,features:{drag:{},eventEdit:{},eventTooltip:{},eventMenu:{}},navigatorPlacement:null,responsive:{small:{when:600,once:{mode:"day"}},medium:{when:800},large:{overlaySidebar:!1},"*":{overlaySidebar:!0,once:{mode:"week"}}},responsiveRoot:!0,stateful:["hideNonWorkingDays","mode"],tbar:{cls:"b-calendar-toolbar",items:{toggleSideBar:{icon:"b-icon-menu-vertical",cls:"b-sidebar-toggle b-borderless b-transparent",onClick:"up.onToggleSidebarClick",weight:100},todayButton:{text:"L{Calendar.Today}",cls:"b-cal-nav-item b-calendar-today-button",icon:"b-icon-calendar-day",onClick:"up.shiftToNow",weight:200},prevButton:{onClick:"up.shiftPrevious",cls:"b-cal-nav-item b-borderless b-transparent",icon:"b-icon-previous",weight:300},nextButton:{onClick:"up.shiftNext",cls:"b-cal-nav-item b-borderless b-transparent",icon:"b-icon-next",weight:400},viewDescription:{cls:"b-calendar-view-desc",type:"widget",flex:"",html:"",overflowable:"none",weight:500},spacer:{type:"widget",cls:"b-toolbar-fill",weight:600},modeSelector:{type:"calendarModeSelector",weight:700}}},items:{viewContainer:{type:"container",cls:"b-calendar-viewcontainer",flex:"1 1 100%",layout:{type:"card"},scrollable:{overflowY:!0,overflowX:!0},suppressChildHeaders:!0,layoutStyle:{padding:0},internalListeners:{beforeActiveItemChange:"up.onBeforeModeChange",activeItemChange:"up.onModeChange"}}},includeWeekendsButton:!1,layoutStyle:{padding:0,flexFlow:"row nowrap"},modes:{day:{fixedDuration:!0},week:{},month:{},year:{},agenda:{}},mode:"week",modeDefaults:{value:null},sidebar:{$config:{merge:"objects"},value:{type:"sidebar",side:"left",scrollable:{overflowY:!0},internalListeners:{dateChange:"up.onCalendarDateChange"}}},datePicker:{$config:{merge:"objects"},value:{weight:100,dayNameFormat:"d1",editMonth:null,focusable:!1,trapFocus:!1}},overlaySidebar:null,date:{$config:{equal:"date"},value:new Date},dateFormat:"MMMM DD, YYYY",scrollManager:{$config:["lazy","nullify"],value:{direction:"vertical"}},viewUpdateDelay:2e3,readOnly:null,allowOverlap:!0,testConfig:{viewUpdateDelay:5,loadMask:{text:"L{GridBase.loadMask}",showDelay:0}},highlightDate:null,autoCreate:{gesture:"dblclick",newName:"L{Object.newEvent}",step:"15 minutes",duration:"1 hour",startHour:8},focusable:!1,eventCls:"b-cal-event",weekStartDay:!1,hideNonWorkingDays:null,nonWorkingDays:!1,coreHours:null,contextMenuTriggerEvent:"contextmenu",enableUndoRedoKeys:!0,resourceImagePath:null,minDate:null,maxDate:null}}static get delayable(){return{refresh:{type:"raf",cancelOutstanding:!0},syncUIWithActiveView:{type:"buffer",delay:1,cancelOutstanding:!0}}}compose(){const{includeWeekendsButton:e,navigatorPlacement:t}=this;return{class:{[`b-calendar-nav-${t||"toolbar"}`]:1,"b-calendar-include-weekends-button":e}}}onPaintOverride(){}onPaint(){this.onPaintOverride()||super.onPaint()}onShowOverflowPopup({overflowPopup:e}){this.element.classList.add("b-overflow-popup-visible"),e.ion({hide:()=>this.element.classList.remove("b-overflow-popup-visible"),once:!0})}static get featureable(){return{factory:He}}get dateTimeNow(){return null!=this.timeZone?C.toTimeZone(new Date,this.timeZone):new Date}get today(){const e=this.dateTimeNow;return e.setHours(0,0,0,0),e}finalizeInit(){var e;super.finalizeInit();const t=this,n=null===(e=t.activeView)||void 0===e?void 0:e.hideNonWorkingDays;null!=n&&null==t.hideNonWorkingDays&&(t.hideNonWorkingDays=n)}toggleEmptyText(){const{crudManager:e}=this,{eventStore:t}=e||this;a.toggleClasses(this.contentElement,"b-calendar-empty",!(t.count||null!=e&&e.isLoading))}refresh(){this.eachView((e=>{var t;return null===(t=e.refresh)||void 0===t?void 0:t.call(e)}))}get views(){const{modes:e}=this;return e?Object.values(e):[]}get activeView(){return this.viewContainer.layout.activeItem}get activeSubView(){var e;const{activeView:t}=this,{items:n}=t;return(null===(e=n.filter(Un))||void 0===e?void 0:e[0])||t}captureFocus(){return this.activeView.captureFocus()}getEventRecord(e){return this.activeView.getEventRecord(e)}resolveEventRecord(e){return this.getEventRecord(e)}onBeforeModeChange({prevActiveItem:e,activeItem:t}){var n,a;if(!1===this.trigger("beforeActiveItemChange",arguments[0]))return!1;if(null===(n=e._overflowPopup)||void 0===n||null===(a=n.hide)||void 0===a||a.call(n),"date"in t&&!1!==t.syncViewDate){const n=this.date||e.date;n&&(t.date=n)}}onModeChange(e){this.trigger("activeItemChange",e)}onToggleSidebarClick(){const{sidebar:e}=this,{collapsible:t}=e;null!=t&&t.isPanelCollapserOverlay?t.toggleReveal(!e.revealed):e.toggleCollapsed()}shiftToNow(){var e;const n=this,a=null===(e=n.sidebar)||void 0===e?void 0:e.widgetMap.datePicker,{dayTime:r}=n.activeView,i=new Date,s=r?r.startOfDay(i):t.clearTime(i);n.date=s,a&&(a.date=s),n.updateViewDescription()}shiftPrevious(){const{activeItem:e}=this.viewContainer.layout;null!=e&&e.previous&&(e.previous(),this.updateViewDescription(e),e.animateTimeShift&&a.slideIn(e.contentElement,-1))}shiftNext(){const{activeItem:e}=this.viewContainer.layout;null!=e&&e.next&&(e.next(),this.updateViewDescription(e),e.animateTimeShift&&a.slideIn(e.contentElement,1))}async onCalendarDateChange({date:e,userAction:n}){const i=this,{activeItem:s}=i.viewContainer.layout,{date:o,highlightDate:l}=i;if(s&&!1!==s.syncViewDate&&"date"in s){const{getDayElement:o}=s;var d,c;if(!t.betweenLesser(e,s.startDate,s.endDate))null===(d=s._overflowPopup)||void 0===d||null===(c=d.hide)||void 0===c||c.call(d);if(s.date=e,n&&l&&o){var u;s.scrollTo&&(await s.scrollTo(e),s.scrolledToDate&&(e=s.scrolledToDate));const t=null===(u=s.getDayElement)||void 0===u?void 0:u.call(s,e);t&&(isNaN(l)?i.callback(l,i,[t,i]):a.highlight(r.from(t)))}}i.trigger("dateChange",{oldDate:o,date:e})}updateViewDescription(e=this.activeView){const t=this,{tbar:n,widgetMap:a}=t,{viewDescription:r}=a,i=`<span class="b-calendar-view-desc-text">${(null==e?void 0:e.description)||""}</span>`;if(t.element.dataset.mode=t.activeView.modeName,e){n&&r&&r.content!==i&&(r.content=i);const t=e.date||e.startDate;t&&(this.date=t)}}getStepUnitText(e=this.activeView){return e.stepUnit}syncUIWithActiveView(e=this.activeView){const t=this,{tbar:n,sidebar:a,widgetMap:r}=t,{toggleSideBar:i}=r;if(n&&null!=e&&e.isVisible){const{prevButton:n,nextButton:i,modeSelector:s}=r,o=t.getStepUnitText(e);null==s||s.syncActiveMode(e),a&&(a.stepUnitText=o),t.updateViewDescription(e),n&&(n.tooltip=o?t.L("L{previous}",o):"",n.disabled=!o),i&&(i.tooltip=o?t.L("L{next}",o):"",i.disabled=!o)}a||null==i||i.hide()}updateEventStore(e){this.detachListeners("eventStoreDateRange"),this.features.loadOnDemand,this.processConfiguredListeners(),e.ion({loadDateRange:"onEventStoreDateRangeRequested",name:"eventStoreDateRange",thisObj:this}),this.sidebar&&(this.sidebar.eventStore=e)}eachView(e,t,n=null){const a=null==t;for(const r of this.views)if(a&&(t=[r]),!1===r.callback(e,n||r,t))return}onEventStoreDateRangeRequested(e){e.changed&&this.trigger("dateRangeChange",e),this.trigger("dateRangeRequested",e)}async onModeSelectorToggle({source:e,pressed:t}){if(t){const t=this,{layout:n}=t.viewContainer,{view:a}=e;await t.modeSelectionPromise,t.modeSelectionPromise=n.setActiveItem(a).promise}}updateMode(e){const t=this,n=t.initialConfig||{};t.isConfiguring||t._responsiveUpdating&&("mode"in n||"activeIndex"in n)||(e="string"==typeof e?t.modes[e]:e)&&e!==t.activeView&&t.viewContainer.layout.setActiveItem(e,void 0,{animation:!t.isResponsiveUpdating})}onEventStoreRefresh(){this.isConfiguring||this.syncUIWithActiveView(this.viewContainer.layout.activeItem)}handleViewPaint({source:e}){this.syncUIWithActiveView(e),this._mode=e.modeName,this.trigger("viewPaint",d({},arguments[0]))}onViewRefresh({source:e}){var t;null===(t=super.onViewRefresh)||void 0===t||t.call(this,...arguments),e.isVisible&&(e===this.activeView?this.updateViewDescription(e):this.activeView.owns(e)&&this.syncUIWithActiveView(this.activeView))}updateEventCls(e){this.initialConfig.eventInnerSelector||(this.eventInnerSelector=`.${e}`),this.initialConfig.eventSelector||(this.eventSelector=`${this.eventInnerSelector}-wrap`)}changeModes(e,t){const n=this,{mode:a}=n;if(n.getConfig("crudManager"),n.getConfig("defaultCalendar"),a&&a in e){const t=[];let i,o=null,l=0;for(const n in e){var r;if(i=e[n],i)"object"==typeof i&&"weight"in i?o=null:i&&n===a&&(o=l),t.push(s.assign({modeType:n,weight:null!==(r=i.weight)&&void 0!==r?r:0},i)),l++;else t.push(!1)}if(null==o){e={},t.sort(jn);for(let n=0,{length:r}=t;n<r;n++)i=t[n],e[i.modeType]=i,t[n].modeType===a&&(o=n)}n.activeModeIndex=o}const{tbar:i,element:o}=n,l={thisObj:n,descriptionChange:"onViewDescriptionChange",weekNumberClick:"onViewWeekNumberClick",monthNameClick:"onViewMonthNameClick",dayNumberClick:"onViewDayNumberClick",beforeEventAdd:"onViewBeforeEventAdd",catchAll:{fn:"onViewCatchAll",prio:1e4},paint:"handleViewPaint",refresh:"onViewRefresh"},d=n.$modes||(n.$modes=new A({factory:Gn,inferType:!0,owner:n,ownerName:"calendar",created(e,t){var a;if(e.modeName=t,e.isScheduler){const{eventEdit:t}=n.features;t&&(t.applyPluginConfig(e),e.editEvent=n.editEvent.bind(n))}!1!==e.autoCreate&&(e.autoCreate=n.autoCreate),o.classList.add(`b-cal-${t}`),e.ion(l),n.relayEvents(e,["eventPropagate"]),n.isConfiguring||n.trigger("addMode",{mode:e});const r=null==i||null===(a=i.widgetMap)||void 0===a?void 0:a.modeSelector;r&&(r.calendar=n,r.addMode(t,e))},setup(e){const{defaultCalendar:t,hideNonWorkingDays:a,modeDefaults:r}=n,i=Gn.resolveType(e.type);if(r&&(e=s.merge({},r,e)),i.isScheduler){const t=e.features||(e.features={});t.eventTooltip=t.eventMenu=t.eventEdit=t.scheduleMenu=!1}else e.eventSelector=n.eventSelector,e.eventInnerSelector=n.eventInnerSelector;return e.rtl=n.rtl,e.project=n.project,e.readOnly=n.readOnly,e.allowOverlap=n.allowOverlap,e.hidden=!0,e.weekStartDay=n.weekStartDay,e.nonWorkingDays=n.nonWorkingDays,e.timeZone=n.timeZone,n.coreHours&&(e.coreHours=n.coreHours),n.resourceImagePath&&(e.resourceImagePath=n.resourceImagePath),s.hasOwn(n,"_defaultCalendar")?e.defaultCalendar=n._defaultCalendar:null!=t&&(e.defaultCalendar=t),null!=a&&(e.hideNonWorkingDays=a),n.date&&!e.date&&(e.date=n.date),e.dateFormat||(e.dateFormat=n.dateFormat),n.visibleStartTime&&(e.visibleStartTime=n.visibleStartTime),e}}));if(d.update(e),!t)return d.target}changeModeDefaults(e){const t=this;return new Proxy(s.assign({},e),{set(e,n,a){const r=Reflect.set(...arguments);return t.updateModeDefaults({[n]:a}),r},deleteProperty(e,n){const a=Reflect.deleteProperty(...arguments);return t.updateModeDefaults({[n]:null}),a}})}updateModeDefaults(e){this.isConfiguring||this.eachView((t=>t.setConfig(e)))}get collapsibleConfig(){const e=this.peekConfig("overlaySidebar"),t={type:e?"overlay":"inline",tool:null};return e&&(t.recollapseTool=null),t}updateOverlaySidebar(e){const{sidebar:t,collapsibleConfig:n}=this,a=null==t?void 0:t.collapsible;a&&(a.type!==n.type&&(t.collapsible=n),e?t.collapsed||(t.collapsed=!0,t.collapsedDueToOverlay=!0):(t.collapsedDueToOverlay||t.isVisible&&a.isPanelCollapserOverlay)&&(t.collapsed=!1,t.collapsedDueToOverlay=!1))}changeSidebar(e,t){const n=this,{datePicker:a,statefulId:r}=n;if(e){const t=e.items||(e.items={}),n=t.datePicker;a?null!==n&&!1!==n&&(t.datePicker=Kn.mergeConfigs(t.datePicker,a)):t.datePicker=null}return In.reconfigure(t,e,{owner:n,setup:(e,t)=>n.setupWidgetConfig(e,t),defaults:{stateId:r&&`${r}:sidebar`,eventStore:n.eventStore,date:n.date,weight:"right"===(null==e?void 0:e.side)?10:-10,collapsible:n.collapsibleConfig,items:{datePicker:{weekStartDay:n.weekStartDay}}}})}changeDatePicker(e){if(e)return Object.assign(e,{eventStore:this.eventStore,date:this.date})}get datePicker(){return this.isConfiguring?this._datePicker:this.sidebar.widgetMap.datePicker}changeItems(e){const{modes:t,sidebar:n}=this,{viewContainer:a}=e;n&&(e.sidebar=n),a&&(a.items=t),this.activeModeIndex&&(a.layout.activeIndex=this.activeModeIndex);const r=super.changeItems(e);return this.viewContainer=this.widgetMap.viewContainer,r}onViewCatchAll(e){const t=this,{fromOverflowPopup:n,type:r,source:i}=e;if(e.bubbles)return;let s,o,{domEvent:l}=e;if(!l&&a.isDOMEvent(e.event)&&(l=e.event),t.eventSource=i,!l||!1!==t.handleEvent(l)){var c;const a=r.startsWith("emptycell");if(r.endsWith("click")&&t.activeView.isCalendarMixin&&(o=e.date||(null===(c=i.getDateFromDomEvent)||void 0===c?void 0:c.call(i,l)))){const e=n||"celloverflowclick"===r||l.target.closest(".b-cal-cell-overflow"),s=i.getDayElement&&!i.getDayElement(o,!0);!(n&&s||a||"daynumberclick"!==r&&s&&(e||r.startsWith("event")||r.startsWith("schedule")))&&(t.date=o)}(a||Yn.test(r))&&(s=t.trigger(r.replaceAll(zn,qn),d(d({},e),{},{view:i})))}return t.eventSource=null,s}onViewDescriptionChange(){this.updateViewDescription()}onViewWeekNumberClick({week:e}){const t=this.modes.week||this.viewContainer.query((e=>{var t;return"weekview"===(null===(t=e.view)||void 0===t?void 0:t.type.toLowerCase())}));t&&(t.week=e,this.viewContainer.layout.activeItem=t)}onViewMonthNameClick({date:e}){const t=this.modes.month||this.viewContainer.query((e=>{var t;return"monthview"===(null===(t=e.view)||void 0===t?void 0:t.type.toLowerCase())}));t&&(t.date=e,this.viewContainer.layout.activeItem=t)}onViewDayNumberClick({source:e,date:t,cellData:n,fromOverflowPopup:a,domEvent:r}){var i;const s=e.isYearView&&("click"!==e.overflowPopupTrigger||a||!(null!==(i=n.events)&&void 0!==i&&i.length)&&!e.emptyCellRenderer);if(e.isCalendarRow||e.isMonthView||s||e.isAgendaView){const{viewContainer:n}=this,a=this.modes.day||n.query((e=>{var t;return"dayview"===(null===(t=e.view)||void 0===t?void 0:t.type.toLowerCase())}));if(a&&e!==a.allDayEvents){const{layout:e}=n,{activeItem:r}=e,{syncViewDate:i}=r;return r.syncViewDate=!1,this.date=t,n.layout.activeItem=a,r.syncViewDate=i,!1}}}onViewBeforeEventAdd({eventRecord:e,assignmentRecords:t}){const{eventEdit:n}=this.features,a=n&&!n.disabled;e.isCreating=a,null==t||t.forEach((e=>e.isCreating=a))}createEvent(e=this.date){this.doCreateEvent(e)}doCreateEvent(e,t=this.activeView){const{modes:n}=this,a=t.isYearView&&(n.week||n.month||n.day)||t;if(this.activeView.owns(a))t.doCreateEvent(e);else{const{viewContainer:n}=this.widgetMap,{layout:r}=n;if(a)return n.ion({activeItemChange:"doCreateEvent",thisObj:t,once:!0,args:[e,a]}),a.date=e,r.activeItem=a,!1}}changeDate(e,n){if(e="string"==typeof e?t.parse(e):new Date(e),isNaN(e))throw new Error("Calendar widget date ingestion must be passed a Date, or a YYYY-MM-DD date string");if(e=t.clearTime(e),!n||e-n)return e}updateAutoCreate(){this.isConfiguring||this.syncCommonConfig("autoCreate")}updateDate(e,t){if(!this.isConfiguring){const{sidebar:t}=this;t?t.date=e:this.onCalendarDateChange({date:e})}}updateDateFormat(){this.isConfiguring||this.syncCommonConfig("dateFormat")}changeIncludeWeekendsButton(e){return!0===e?{}:e}updateIncludeWeekendsButton(e){!this.isConstructing&&e&&s.isObject(e)&&(this.widgetMap.modeSelector.includeWeekendsButton=e)}changeScrollManager(e,t){if(null==t||t.destroy(),!this.isDestroying)return new F(Object.assign({element:this.element},e))}updateDefaultCalendar(){this.isConfiguring||this.syncCommonConfig("defaultCalendar")}changeWeekStartDay(e){return!1===e&&(e=t.weekStartDay),e}updateReadOnly(){super.updateReadOnly(...arguments),this.isConfiguring||this.syncCommonConfig("readOnly")}updateWeekStartDay(e){var t;this.isConfiguring||(this.syncCommonConfig("weekStartDay"),null!==(t=this.sidebar)&&void 0!==t&&t.widgetMap.datePicker&&(this.sidebar.widgetMap.datePicker.weekStartDay=e))}updateHideNonWorkingDays(e,t){this.isConfiguring||(this.syncCommonConfig("hideNonWorkingDays"),this.trigger("changeHideNonWorkingDays",{value:e,was:t}))}changeNonWorkingDays(e){return!1===e&&(e=s.assign({},t.nonWorkingDays)),e}updateNonWorkingDays(){this.isConfiguring||this.syncCommonConfig("nonWorkingDays")}updateCoreHours(){this.isConfiguring||this.syncCommonConfig("coreHours")}syncCommonConfig(e){this.eachView((t=>{t[e]=this[e]}))}onCalendarStoreChange(){var e;null===(e=super.onCalendarStoreChange)||void 0===e||e.call(this,...arguments)}updateSelected(){const e=this.viewContainer.contentElement.querySelectorAll(".b-cal-event-wrap");for(let t=0,{length:n}=e;t<n;t++)e[t].classList[this.isEventSelected(e[t].dataset.eventId)?"add":"remove"]("b-selected")}getElementFromEventRecord(e){return this.activeView.getEventElement(e)}updateLocalization(){const e=this;if(e.isPainted){let n=!1;"weekStartDay"in e.initialConfig||e.weekStartDay===t.weekStartDay||(e.weekStartDay=t.weekStartDay,n=!0),"nonWorkingDays"in e.initialConfig||s.isEqual(e.nonWorkingDays,t.nonWorkingDays)||(e.nonWorkingDays=t.nonWorkingDays,n=!0),n||e.refresh(),e.syncUIWithActiveView()}super.updateLocalization()}}Kn.initClass(),globalThis.bryntum&&(globalThis.bryntum.Calendar=Kn);class Gn extends(c.mixin(l)){static get factoryable(){return{extends:p}}}Gn.register("agenda",vn),Gn.register("year",An),Gn.register("month",Tn),Gn.register("week",$n),Gn.register("day",kn),Gn.register("list",un),Gn.register("resource",On),Kn.Modes=Gn,_.setVersion("calendar","5.3.0"),Kn._$name="Calendar";export{xe as AgendaColumn,vn as AgendaView,Kn as Calendar,mn as CalendarDatePicker,Xe as CalendarDrag,He as CalendarFeature,zt as CalendarMixin,sn as CalendarRow,Wt as CalendarStores,Pe as CrudManager,tn as DateRangeOwner,Ut as DayCellCollecter,Qt as DayCellRenderer,kt as DayLayout,ln as DaySelectable,on as DaySelector,kn as DayView,Me as EventColumn,Je as EventEdit,Qe as EventEditor,un as EventList,tt as EventMenu,_n as EventNavigation,At as EventRenderer,Bn as EventSelection,Pt as EventSlots,Ht as EventSorter,Ie as EventTip,rt as EventTooltip,ot as ExternalEventSource,Nt as FluidDayLayout,pt as LayoutDim,lt as LoadOnDemand,Rn as ModeSelector,Tn as MonthView,Gt as OverflowPopup,gt as Print,We as ProjectModel,On as ResourceView,vt as ScheduleMenu,In as Sidebar,Te as TimeRangeModel,Ne as TimeRangeStore,bt as TimeRanges,Et as WeekExpander,$n as WeekView,An as YearView};
//# sourceMappingURL=calendar.module.thin.js.map
