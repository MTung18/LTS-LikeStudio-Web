<!-- Vue 3 wrapper for Bryntum Calendar -->

<template>
    <div ref="refElement">

        <!-- Container for Vue components used in cells, hidden from view -->
        <div
            ref="teleportsHolder"
            style="display: none"
        >
            <!-- Vue components rendered in the grid cells -->
            <teleport
                v-for="item in teleports.values()"
                :key="item.key"
                :to="item.to"
            >
                <component
                    :is="item.is"
                    :ref="item.key"
                    :data-key="item.key"
                    :data-generation="item.generation"
                    v-bind="item.bind"
                    data-vue
                />
            </teleport>
        </div>

    </div>
</template>

<script>
import { AssignmentModel, AssignmentStore, Calendar, EventModel, EventStore, Layout, Mask, Model, PanelCollapser, ProjectModel, Rectangle, ResourceModel, ResourceStore, SchedulerCrudManager, SchedulerProjectModel, Scroller, StateProvider, Tool, Widget } from '@bryntum/calendar';
import { getCurrentInstance, onBeforeUnmount, onMounted, ref, watch, provide } from 'vue';
import useWrapperHelper from './WrapperHelper.js';
import useWrapperHelperVue3 from './WrapperHelperVue3.js';

export default {
    name : 'BryntumCalendar',

    props : {

         // Configs only
        adopt                            : { type : [HTMLElement, String], default : undefined },
        align                            : { type : [Object, String], default : undefined },
        allowOverlap                     : { type : Boolean, default : undefined },
        anchor                           : { type : Boolean, default : undefined },
        ariaDescription                  : { type : String, default : undefined },
        ariaLabel                        : { type : String, default : undefined },
        autoCreate                       : { type : [Object, String, Boolean], default : undefined },
        autoUpdateRecord                 : { type : Boolean, default : undefined },
        bbar                             : { type : Object, default : undefined },
        bodyCls                          : { type : [String, Object], default : undefined },
        breakpoints                      : { type : Object, default : undefined },
        bubbleEvents                     : { type : Object, default : undefined },
        callOnFunctions                  : { type : Boolean, default : undefined },
        centered                         : { type : Boolean, default : undefined },
        collapsed                        : { type : Boolean, default : undefined },
        collapsible                      : { type : [Boolean, PanelCollapser], default : undefined },
        config                           : { type : Object, default : undefined },
        constrainTo                      : { type : [HTMLElement, Widget, Rectangle], default : undefined },
        contentElementCls                : { type : [String, Object], default : undefined },
        contextMenuTriggerEvent          : { type : String, default : undefined },
        crudManagerClass                 : { type : SchedulerCrudManager, default : undefined },
        dateFormat                       : { type : String, default : undefined },
        datePicker                       : { type : [Object, Boolean], default : undefined },
        defaultBindProperty              : { type : String, default : undefined },
        defaultFocus                     : { type : Function, default : undefined },
        defaults                         : { type : Object, default : undefined },
        deselectOnClick                  : { type : Boolean, default : undefined },
        destroyStores                    : { type : Boolean, default : undefined },
        dock                             : { type : [String, Object], default : undefined },
        draggable                        : { type : [Boolean, Object], default : undefined },
        enableDeleteKey                  : { type : Boolean, default : undefined },
        enableRecurringEvents            : { type : Boolean, default : undefined },
        enableUndoRedoKeys               : { type : Boolean, default : undefined },
        eventSelectionDisabled           : { type : Boolean, default : undefined },
        floating                         : { type : Boolean, default : undefined },
        footer                           : { type : [Object, String], default : undefined },
        header                           : { type : [String, Boolean, Object], default : undefined },
        hideAnimation                    : { type : [Boolean, Object], default : undefined },
        hideWhenEmpty                    : { type : Boolean, default : undefined },
        highlightDate                    : { type : [Boolean, Function], default : undefined },
        highlightPredecessors            : { type : Boolean, default : undefined },
        highlightSuccessors              : { type : Boolean, default : undefined },
        htmlCls                          : { type : [String, Object], default : undefined },
        ignoreParentReadOnly             : { type : Boolean, default : undefined },
        includeWeekendsButton            : { type : [Boolean, Object], default : undefined },
        itemCls                          : { type : String, default : undefined },
        lazyItems                        : { type : [Object, Array], default : undefined },
        listeners                        : { type : Object, default : undefined },
        loadMask                         : { type : [String, Object, null], default : undefined },
        loadMaskDefaults                 : { type : [Object, Mask], default : undefined },
        loadMaskError                    : { type : [Object, Mask, Boolean], default : undefined },
        localeClass                      : { type : Function, default : undefined },
        localizable                      : { type : Boolean, default : undefined },
        localizableProperties            : { type : Array, default : undefined },
        maintainSelectionOnDatasetChange : { type : Boolean, default : undefined },
        maskDefaults                     : { type : Object, default : undefined },
        masked                           : { type : [Boolean, String, Object], default : undefined },
        monitorResize                    : { type : Boolean, default : undefined },
        multiEventSelect                 : { type : Boolean, default : undefined },
        namedItems                       : { type : Object, default : undefined },
        navigatorPlacement               : { type : String, default : undefined },
        nonWorkingDays                   : { type : Object, default : undefined },
        overlaySidebar                   : { type : Boolean, default : undefined },
        owner                            : { type : Widget, default : undefined },
        positioned                       : { type : Boolean, default : undefined },
        preventTooltipOnTouch            : { type : Boolean, default : undefined },
        relayStoreEvents                 : { type : Boolean, default : undefined },
        resourceImagePath                : { type : String, default : undefined },
        responsive                       : { type : Object, default : undefined },
        responsiveRoot                   : { type : Boolean, default : undefined },
        responsiveState                  : { type : String, default : undefined },
        responsiveTarget                 : { type : [String, Widget], default : undefined },
        ripple                           : { type : [Boolean, Object], default : undefined },
        rootElement                      : { type : ShadowRoot, default : undefined },
        scrollAction                     : { type : [String, null], default : undefined },
        showAnimation                    : { type : [Boolean, Object], default : undefined },
        showRecurringUI                  : { type : Boolean, default : undefined },
        showTooltipWhenDisabled          : { type : Boolean, default : undefined },
        sidebar                          : { type : [Object, Boolean], default : undefined },
        stateful                         : { type : [Boolean, Object, Array], default : undefined },
        statefulEvents                   : { type : [Object, Array], default : undefined },
        stateId                          : { type : String, default : undefined },
        stateProvider                    : { type : StateProvider, default : undefined },
        strips                           : { type : Object, default : undefined },
        syncMask                         : { type : [String, Object, null], default : undefined },
        tab                              : { type : [Boolean, Object], default : undefined },
        tag                              : { type : String, default : undefined },
        tbar                             : { type : Object, default : undefined },
        textAlign                        : { type : String, default : undefined },
        textContent                      : { type : Boolean, default : undefined },
        timeZone                         : { type : [String, Number], default : undefined },
        trapFocus                        : { type : Boolean, default : undefined },
        triggerSelectionChangeOnRemove   : { type : Boolean, default : undefined },
        ui                               : { type : [String, Object], default : undefined },
        weekStartDay                     : { type : Number, default : undefined },
        weight                           : { type : Number, default : undefined },

         // Configs and properties
        alignSelf          : { type : String, default : undefined },
        appendTo           : { type : [HTMLElement, String], default : undefined },
        assignments        : { type : [Array, Object], default : undefined },
        assignmentStore    : { type : AssignmentStore, default : undefined },
        cls                : { type : [String, Object], default : undefined },
        content            : { type : String, default : undefined },
        crudManager        : { type : [SchedulerCrudManager, Object], default : undefined },
        dataset            : { type : Object, default : undefined },
        date               : { type : Date, default : undefined },
        defaultCalendar    : { type : [ResourceModel, String], default : undefined },
        disabled           : { type : Boolean, default : undefined },
        events             : { type : [Array, Object], default : undefined },
        eventStore         : { type : EventStore, default : undefined },
        extraData          : { type : [String, Number, Boolean, Object], default : undefined },
        features           : { type : Object, default : undefined },
        flex               : { type : [Number, String], default : undefined },
        height             : { type : [Number, String], default : undefined },
        hidden             : { type : Boolean, default : undefined },
        hideNonWorkingDays : { type : Boolean, default : undefined },
        html               : { type : [String, Function], default : undefined },
        id                 : { type : String, default : undefined },
        insertBefore       : { type : [HTMLElement, String], default : undefined },
        insertFirst        : { type : [HTMLElement, String], default : undefined },
        isEventSelectable  : { type : Function, default : undefined },
        items              : { type : [Array, Object], default : undefined },
        layout             : { type : [Layout, String, Object], default : undefined },
        layoutStyle        : { type : Object, default : undefined },
        margin             : { type : [Number, String], default : undefined },
        maxDate            : { type : [Date, String], default : undefined },
        maxHeight          : { type : [String, Number], default : undefined },
        maxWidth           : { type : [String, Number], default : undefined },
        minDate            : { type : [Date, String], default : undefined },
        minHeight          : { type : [String, Number], default : undefined },
        minWidth           : { type : [String, Number], default : undefined },
        mode               : { type : String, default : undefined },
        modeDefaults       : { type : Object, default : undefined },
        modes              : { type : Object, default : undefined },
        project            : { type : [ProjectModel, SchedulerProjectModel, Object], default : undefined },
        readOnly           : { type : Boolean, default : undefined },
        resources          : { type : [Array, Object], default : undefined },
        resourceStore      : { type : ResourceStore, default : undefined },
        scrollable         : { type : [Scroller, Boolean, Object], default : undefined },
        title              : { type : String, default : undefined },
        tools              : { type : Object, default : undefined },
        tooltip            : { type : [String, Object], default : undefined },
        width              : { type : [Number, String], default : undefined },
        x                  : { type : Number, default : undefined },
        y                  : { type : Number, default : undefined },

         // Properties only
        activeSubView       : { type : Widget, default : undefined },
        activeView          : { type : Widget, default : undefined },
        anchorSize          : { type : Array, default : undefined },
        isEngineReady       : { type : Boolean, default : undefined },
        isSettingValues     : { type : Boolean, default : undefined },
        isValid             : { type : Boolean, default : undefined },
        record              : { type : Model, default : undefined },
        selectedAssignments : { type : Array, default : undefined },
        selectedEvents      : { type : Array, default : undefined },
        state               : { type : Object, default : undefined },
        type                : { type : String, default : undefined },
        values              : { type : Object, default : undefined },
        views               : { type : Array, default : undefined },

         // Events
        onActiveItemChange                : { type : Function, default : undefined },
        onAfterEventEdit                  : { type : Function, default : undefined },
        onAfterEventSave                  : { type : Function, default : undefined },
        onAssignmentSelectionChange       : { type : Function, default : undefined },
        onBeforeActiveItemChange          : { type : Function, default : undefined },
        onBeforeAssignmentDelete          : { type : Function, default : undefined },
        onBeforeAssignmentSelectionChange : { type : Function, default : undefined },
        onBeforeDestroy                   : { type : Function, default : undefined },
        onBeforeDragCreateEnd             : { type : Function, default : undefined },
        onBeforeDragMoveEnd               : { type : Function, default : undefined },
        onBeforeDragResizeEnd             : { type : Function, default : undefined },
        onBeforeEventDelete               : { type : Function, default : undefined },
        onBeforeEventEdit                 : { type : Function, default : undefined },
        onBeforeEventEditShow             : { type : Function, default : undefined },
        onBeforeEventSave                 : { type : Function, default : undefined },
        onBeforeEventSelectionChange      : { type : Function, default : undefined },
        onBeforeHide                      : { type : Function, default : undefined },
        onBeforePrint                     : { type : Function, default : undefined },
        onBeforeResponsiveStateChange     : { type : Function, default : undefined },
        onBeforeSetRecord                 : { type : Function, default : undefined },
        onBeforeShow                      : { type : Function, default : undefined },
        onCatchAll                        : { type : Function, default : undefined },
        onCellOverflowClick               : { type : Function, default : undefined },
        onContextMenuItem                 : { type : Function, default : undefined },
        onContextMenuToggleItem           : { type : Function, default : undefined },
        onDataChange                      : { type : Function, default : undefined },
        onDateChange                      : { type : Function, default : undefined },
        onDateRangeChange                 : { type : Function, default : undefined },
        onDateRangeRequested              : { type : Function, default : undefined },
        onDayNumberClick                  : { type : Function, default : undefined },
        onDestroy                         : { type : Function, default : undefined },
        onDragCreateEnd                   : { type : Function, default : undefined },
        onDragMoveEnd                     : { type : Function, default : undefined },
        onDragResizeEnd                   : { type : Function, default : undefined },
        onEmptyCellClick                  : { type : Function, default : undefined },
        onEventAutoCreated                : { type : Function, default : undefined },
        onEventClick                      : { type : Function, default : undefined },
        onEventContextMenu                : { type : Function, default : undefined },
        onEventDblClick                   : { type : Function, default : undefined },
        onEventEditBeforeSetRecord        : { type : Function, default : undefined },
        onEventMenuBeforeShow             : { type : Function, default : undefined },
        onEventMenuItem                   : { type : Function, default : undefined },
        onEventMenuShow                   : { type : Function, default : undefined },
        onEventMouseDown                  : { type : Function, default : undefined },
        onEventMouseOut                   : { type : Function, default : undefined },
        onEventMouseOver                  : { type : Function, default : undefined },
        onEventMouseUp                    : { type : Function, default : undefined },
        onEventPropagate                  : { type : Function, default : undefined },
        onEventSelectionChange            : { type : Function, default : undefined },
        onFocusIn                         : { type : Function, default : undefined },
        onFocusOut                        : { type : Function, default : undefined },
        onHide                            : { type : Function, default : undefined },
        onLoadOnDemandFail                : { type : Function, default : undefined },
        onMonthNameClick                  : { type : Function, default : undefined },
        onNavigate                        : { type : Function, default : undefined },
        onPaint                           : { type : Function, default : undefined },
        onReadOnly                        : { type : Function, default : undefined },
        onRecompose                       : { type : Function, default : undefined },
        onRefresh                         : { type : Function, default : undefined },
        onResize                          : { type : Function, default : undefined },
        onResponsiveHeightChange          : { type : Function, default : undefined },
        onResponsiveStateChange           : { type : Function, default : undefined },
        onResponsiveWidthChange           : { type : Function, default : undefined },
        onScheduleClick                   : { type : Function, default : undefined },
        onScheduleDblClick                : { type : Function, default : undefined },
        onScheduleMenuBeforeShow          : { type : Function, default : undefined },
        onScheduleMenuItem                : { type : Function, default : undefined },
        onScheduleMenuShow                : { type : Function, default : undefined },
        onScheduleMouseDown               : { type : Function, default : undefined },
        onScheduleMouseOut                : { type : Function, default : undefined },
        onScheduleMouseOver               : { type : Function, default : undefined },
        onScheduleMouseUp                 : { type : Function, default : undefined },
        onSelectionChange                 : { type : Function, default : undefined },
        onShow                            : { type : Function, default : undefined },
        onTimeRangeHeaderClick            : { type : Function, default : undefined },
        onTimeRangeHeaderContextMenu      : { type : Function, default : undefined },
        onTimeRangeHeaderDblClick         : { type : Function, default : undefined },
        onToolClick                       : { type : Function, default : undefined },
        onViewPaint                       : { type : Function, default : undefined },
        onWeekNumberClick                 : { type : Function, default : undefined },

         // Features
        dragFeature                : { type : [Object, Boolean, String], default : undefined },
        eventEditFeature           : { type : [Object, Boolean, String], default : undefined },
        eventMenuFeature           : { type : [Object, Boolean, String], default : undefined },
        eventTooltipFeature        : { type : [Object, Boolean, String], default : undefined },
        externalEventSourceFeature : { type : [Object, Boolean, String], default : undefined },
        loadOnDemandFeature        : { type : [Object, Boolean, String], default : undefined },
        printFeature               : { type : [Object, Boolean, String], default : undefined },
        scheduleMenuFeature        : { type : [Object, Boolean, String], default : undefined },
        timeRangesFeature          : { type : [Object, Boolean, String], default : undefined },
        weekExpanderFeature        : { type : [Object, Boolean, String], default : undefined },

    },

    emits : [
        'activeitemchange',
        'aftereventedit',
        'aftereventsave',
        'assignmentselectionchange',
        'beforeactiveitemchange',
        'beforeassignmentdelete',
        'beforeassignmentselectionchange',
        'beforedestroy',
        'beforedragcreateend',
        'beforedragmoveend',
        'beforedragresizeend',
        'beforeeventdelete',
        'beforeeventedit',
        'beforeeventeditshow',
        'beforeeventsave',
        'beforeeventselectionchange',
        'beforehide',
        'beforeprint',
        'beforeresponsivestatechange',
        'beforesetrecord',
        'beforeshow',
        'catchall',
        'celloverflowclick',
        'contextmenuitem',
        'contextmenutoggleitem',
        'datachange',
        'datechange',
        'daterangechange',
        'daterangerequested',
        'daynumberclick',
        'destroy',
        'dragcreateend',
        'dragmoveend',
        'dragresizeend',
        'emptycellclick',
        'eventautocreated',
        'eventclick',
        'eventcontextmenu',
        'eventdblclick',
        'eventeditbeforesetrecord',
        'eventmenubeforeshow',
        'eventmenuitem',
        'eventmenushow',
        'eventmousedown',
        'eventmouseout',
        'eventmouseover',
        'eventmouseup',
        'eventpropagate',
        'eventselectionchange',
        'focusin',
        'focusout',
        'hide',
        'loadondemandfail',
        'monthnameclick',
        'navigate',
        'paint',
        'recompose',
        'refresh',
        'resize',
        'responsiveheightchange',
        'responsivestatechange',
        'responsivewidthchange',
        'scheduleclick',
        'scheduledblclick',
        'schedulemenubeforeshow',
        'schedulemenuitem',
        'schedulemenushow',
        'schedulemousedown',
        'schedulemouseout',
        'schedulemouseover',
        'schedulemouseup',
        'selectionchange',
        'show',
        'timerangeheaderclick',
        'timerangeheadercontextmenu',
        'timerangeheaderdblclick',
        'toolclick',
        'viewpaint',
        'weeknumberclick'
    ],

    data : () => {
        return {
            instanceClass : Calendar,
            instanceName : 'Calendar',

            isView : true,

            dataStores : {
                'assignmentStore': 'assignments',
                'dependencyStore': 'dependencies',
                'eventStore': 'events',
                'resourceStore': 'resources',
                'resourceTimeRangeStore': 'resourceTimeRanges',
                'timeRangeStore': 'timeRanges'
            },

            projectStores : true,

            featureNames : [
                'dragFeature',
                'eventEditFeature',
                'eventMenuFeature',
                'eventTooltipFeature',
                'externalEventSourceFeature',
                'loadOnDemandFeature',
                'printFeature',
                'scheduleMenuFeature',
                'timeRangesFeature',
                'weekExpanderFeature'
            ],

            configNames : [
                'adopt',
                'align',
                'allowOverlap',
                'anchor',
                'ariaDescription',
                'ariaLabel',
                'autoCreate',
                'autoUpdateRecord',
                'bbar',
                'bodyCls',
                'breakpoints',
                'bubbleEvents',
                'callOnFunctions',
                'centered',
                'collapsed',
                'collapsible',
                'config',
                'constrainTo',
                'contentElementCls',
                'contextMenuTriggerEvent',
                'crudManagerClass',
                'dateFormat',
                'datePicker',
                'defaultBindProperty',
                'defaultFocus',
                'defaults',
                'deselectOnClick',
                'destroyStores',
                'dock',
                'draggable',
                'enableDeleteKey',
                'enableRecurringEvents',
                'enableUndoRedoKeys',
                'eventSelectionDisabled',
                'floating',
                'footer',
                'header',
                'hideAnimation',
                'hideWhenEmpty',
                'highlightDate',
                'highlightPredecessors',
                'highlightSuccessors',
                'htmlCls',
                'ignoreParentReadOnly',
                'includeWeekendsButton',
                'itemCls',
                'lazyItems',
                'listeners',
                'loadMask',
                'loadMaskDefaults',
                'loadMaskError',
                'localeClass',
                'localizable',
                'localizableProperties',
                'maintainSelectionOnDatasetChange',
                'maskDefaults',
                'masked',
                'monitorResize',
                'multiEventSelect',
                'namedItems',
                'navigatorPlacement',
                'nonWorkingDays',
                'overlaySidebar',
                'owner',
                'positioned',
                'preventTooltipOnTouch',
                'relayStoreEvents',
                'resourceImagePath',
                'responsive',
                'responsiveRoot',
                'responsiveState',
                'responsiveTarget',
                'ripple',
                'rootElement',
                'scrollAction',
                'showAnimation',
                'showRecurringUI',
                'showTooltipWhenDisabled',
                'sidebar',
                'stateful',
                'statefulEvents',
                'stateId',
                'stateProvider',
                'strips',
                'syncMask',
                'tab',
                'tag',
                'tbar',
                'textAlign',
                'textContent',
                'timeZone',
                'trapFocus',
                'triggerSelectionChangeOnRemove',
                'ui',
                'weekStartDay',
                'weight'
            ],

            propertyConfigNames : [
                'alignSelf',
                'appendTo',
                'assignments',
                'assignmentStore',
                'cls',
                'content',
                'crudManager',
                'dataset',
                'date',
                'defaultCalendar',
                'disabled',
                'events',
                'eventStore',
                'extraData',
                'features',
                'flex',
                'height',
                'hidden',
                'hideNonWorkingDays',
                'html',
                'id',
                'insertBefore',
                'insertFirst',
                'isEventSelectable',
                'items',
                'layout',
                'layoutStyle',
                'margin',
                'maxDate',
                'maxHeight',
                'maxWidth',
                'minDate',
                'minHeight',
                'minWidth',
                'mode',
                'modeDefaults',
                'modes',
                'onActiveItemChange',
                'onAfterEventEdit',
                'onAfterEventSave',
                'onAssignmentSelectionChange',
                'onBeforeActiveItemChange',
                'onBeforeAssignmentDelete',
                'onBeforeAssignmentSelectionChange',
                'onBeforeDestroy',
                'onBeforeDragCreateEnd',
                'onBeforeDragMoveEnd',
                'onBeforeDragResizeEnd',
                'onBeforeEventDelete',
                'onBeforeEventEdit',
                'onBeforeEventEditShow',
                'onBeforeEventSave',
                'onBeforeEventSelectionChange',
                'onBeforeHide',
                'onBeforePrint',
                'onBeforeResponsiveStateChange',
                'onBeforeSetRecord',
                'onBeforeShow',
                'onCatchAll',
                'onCellOverflowClick',
                'onContextMenuItem',
                'onContextMenuToggleItem',
                'onDataChange',
                'onDateChange',
                'onDateRangeChange',
                'onDateRangeRequested',
                'onDayNumberClick',
                'onDestroy',
                'onDragCreateEnd',
                'onDragMoveEnd',
                'onDragResizeEnd',
                'onEmptyCellClick',
                'onEventAutoCreated',
                'onEventClick',
                'onEventContextMenu',
                'onEventDblClick',
                'onEventEditBeforeSetRecord',
                'onEventMenuBeforeShow',
                'onEventMenuItem',
                'onEventMenuShow',
                'onEventMouseDown',
                'onEventMouseOut',
                'onEventMouseOver',
                'onEventMouseUp',
                'onEventPropagate',
                'onEventSelectionChange',
                'onFocusIn',
                'onFocusOut',
                'onHide',
                'onLoadOnDemandFail',
                'onMonthNameClick',
                'onNavigate',
                'onPaint',
                'onReadOnly',
                'onRecompose',
                'onRefresh',
                'onResize',
                'onResponsiveHeightChange',
                'onResponsiveStateChange',
                'onResponsiveWidthChange',
                'onScheduleClick',
                'onScheduleDblClick',
                'onScheduleMenuBeforeShow',
                'onScheduleMenuItem',
                'onScheduleMenuShow',
                'onScheduleMouseDown',
                'onScheduleMouseOut',
                'onScheduleMouseOver',
                'onScheduleMouseUp',
                'onSelectionChange',
                'onShow',
                'onTimeRangeHeaderClick',
                'onTimeRangeHeaderContextMenu',
                'onTimeRangeHeaderDblClick',
                'onToolClick',
                'onViewPaint',
                'onWeekNumberClick',
                'project',
                'readOnly',
                'resources',
                'resourceStore',
                'scrollable',
                'title',
                'tools',
                'tooltip',
                'width',
                'x',
                'y'
            ],

            propertyNames : [
                'activeSubView',
                'activeView',
                'anchorSize',
                'isEngineReady',
                'isSettingValues',
                'isValid',
                'record',
                'selectedAssignments',
                'selectedEvents',
                'state',
                'type',
                'values',
                'views'
            ],

            eventNames : [
                'activeItemChange',
                'afterEventEdit',
                'afterEventSave',
                'assignmentSelectionChange',
                'beforeActiveItemChange',
                'beforeAssignmentDelete',
                'beforeAssignmentSelectionChange',
                'beforeDestroy',
                'beforeDragCreateEnd',
                'beforeDragMoveEnd',
                'beforeDragResizeEnd',
                'beforeEventDelete',
                'beforeEventEdit',
                'beforeEventEditShow',
                'beforeEventSave',
                'beforeEventSelectionChange',
                'beforeHide',
                'beforePrint',
                'beforeResponsiveStateChange',
                'beforeSetRecord',
                'beforeShow',
                'catchAll',
                'cellOverflowClick',
                'contextMenuItem',
                'contextMenuToggleItem',
                'dataChange',
                'dateChange',
                'dateRangeChange',
                'dateRangeRequested',
                'dayNumberClick',
                'destroy',
                'dragCreateEnd',
                'dragMoveEnd',
                'dragResizeEnd',
                'emptyCellClick',
                'eventAutoCreated',
                'eventClick',
                'eventContextMenu',
                'eventDblClick',
                'eventEditBeforeSetRecord',
                'eventMenuBeforeShow',
                'eventMenuItem',
                'eventMenuShow',
                'eventMouseDown',
                'eventMouseOut',
                'eventMouseOver',
                'eventMouseUp',
                'eventPropagate',
                'eventSelectionChange',
                'focusIn',
                'focusOut',
                'hide',
                'loadOnDemandFail',
                'monthNameClick',
                'navigate',
                'paint',
                'recompose',
                'refresh',
                'resize',
                'responsiveHeightChange',
                'responsiveStateChange',
                'responsiveWidthChange',
                'scheduleClick',
                'scheduleDblClick',
                'scheduleMenuBeforeShow',
                'scheduleMenuItem',
                'scheduleMenuShow',
                'scheduleMouseDown',
                'scheduleMouseOut',
                'scheduleMouseOver',
                'scheduleMouseUp',
                'selectionChange',
                'show',
                'timeRangeHeaderClick',
                'timeRangeHeaderContextMenu',
                'timeRangeHeaderDblClick',
                'toolClick',
                'viewPaint',
                'weekNumberClick'
            ]
        };
    },

    setup(props, { emit }) {
        const instance = {};
        const refElement = ref(null);

        // Storage for teleports (in-cell Vue component instances)
        // automatically renderer by template
        const teleports = ref(new Map());

        const { createWidget, relayStores, watchProps } = useWrapperHelper();
        const { processCellContent, hasFrameworkRenderer } = useWrapperHelperVue3();

        // Provide teleports for processCellContent
        provide('teleports', teleports);

        onMounted(() => {
            const
                me = getCurrentInstance(),
                uncapitalize = str => str.charAt(0).toLowerCase() + str.slice(1),
                eventName = str => uncapitalize(str.slice(2)),
                // Collect event listeners from me.props where they are `on` functions
                listeners = Object.keys(me.props)
                    .filter(prop => typeof me.props[prop] === 'function' && prop.startsWith('on') && prop.length > 2)
                    .map(eventName);

            instance.value = createWidget({
                me,
                props   : me.props,
                data    : me.data,
                listeners,
                emit,
                element : refElement.value,
                processCellContent,
                hasFrameworkRenderer
            });
            relayStores(me.data, instance.value);

            const watcher = (prop, newValue) => watch(() => me.props[prop], newValue);
            watchProps(me, instance.value, me.props, me.data, watcher);
        });

        onBeforeUnmount(() => {
            if (instance.value) {
                instance.value.destroy();
            }
        });

        return { instance, refElement, teleports };
    }
};
</script>
