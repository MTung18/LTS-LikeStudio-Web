{"version":3,"file":"Scale.js","sources":["../../../../Core/lib/Core/widget/graph/Histogram.js","../../../../Core/lib/Core/widget/graph/Scale.js"],"sourcesContent":["import Widget from '../Widget.js';\nimport StringHelper from '../../helper/StringHelper.js';\nimport DomSync from '../../helper/DomSync.js';\nimport Tooltip from '../Tooltip.js';\n\n/**\n * @module Core/widget/graph/Histogram\n */\nconst\n    ns = 'http://www.w3.org/2000/svg',\n    // Outline series must overlay bars\n    typePrio = {\n        bar     : 1,\n        outline : 2,\n        text    : 3\n    },\n    byDatasetOrder = (l, r) => parseInt(l.dataset.order, 10) - parseInt(r.dataset.order, 10),\n    getField = s => s.field,\n    returnFalse = () => false;\n\n/**\n * Displays a simple bar histogram based upon an array of data objects passed in the {@link #config-data} config.\n * @extends Core/widget/Widget\n * @classtype histogram\n */\nexport default class Histogram extends Widget {\n    //region Config\n\n    static get type() {\n        return 'histogram';\n    }\n\n    static get $name() {\n        return 'Histogram';\n    }\n\n    static get defaultConfig() {\n        return {\n            /**\n             * An array of data objects used to drive the histogram. The property/properties used\n             * are defined in the {@link #config-series} option.\n             * @config {Object[]}\n             * @default\n             */\n            data : null,\n\n            /**\n             * The values to represent in bar form.\n             * @config {Number[]}\n             */\n            values : null,\n\n            /**\n             * Each item in the array must contain two properties:\n             *  - `type` A String, either `'bar'` or `'outline'`\n             *  - `field` A String, the name of the property to use from the data objects in the {@link #config-data} option.\n             * @config {Object[]}\n             */\n            series : null,\n\n            /**\n             * By default, the bars are scaled based upon the detected max value across all the series.\n             * A specific top value to represent the 100% height may be configured.\n             * @config {Number}\n             */\n            topValue : null,\n\n            element : {\n                children : [{\n                    ns,\n                    tag                 : 'svg',\n                    reference           : 'svgElement',\n                    width               : '100%',\n                    height              : '100%',\n                    preserveAspectRatio : 'none',\n                    children            : [{\n                        ns,\n                        tag       : 'g',\n                        reference : 'scaledSvgGroup'\n                    }, {\n                        ns,\n                        tag       : 'g',\n                        reference : 'unscaledSvgGroup'\n                    }]\n                }]\n            },\n\n            /**\n             * By default, all bars are rendered, even those with zero height. Configure this as `true`\n             * to omit zero height bars.\n             * @config {Number}\n             */\n            omitZeroHeightBars : null,\n\n            monitorResize : true,\n\n            /**\n             * A Function which returns a CSS class name to add to a rectangle element.\n             * The following parameters are passed:\n             * @param {Object} series - The series being rendered\n             * @param {Object} rectConfig - The rectangle configuration object\n             * @param {Object} datum - The datum being rendered\n             * @param {Number} index - The index of the datum being rendered\n             * @config {Function}\n             */\n            getRectClass : null,\n\n            /**\n             * A Function which returns the tooltip text to display when hovering a bar.\n             * The following parameters are passed:\n             * @param {Object} series - The series being rendered\n             * @param {Object} rectConfig - The rectangle configuration object\n             * @param {Object} datum - The datum being rendered\n             * @param {Number} index - The index of the datum being rendered\n             * @config {Function}\n             */\n            getBarTip : null,\n\n            /**\n             * A Function which returns the text to render inside a bar.\n             * The following parameters are passed:\n             * @param {Object} datum - The datum being rendered\n             * @param {Number} index - The index of the datum being rendered\n             * @config {Function}\n             */\n            getBarText : null,\n\n            getBarTextRenderData : null,\n\n            getBarTextTip : null\n        };\n    }\n\n    //endregion\n\n    //region Init\n\n    construct(config) {\n        super.construct(config);\n        this.scheduleRefresh = this.createOnFrame(this.refresh, [], this, true);\n        this.refresh();\n    }\n\n    set tip(tip) {\n        const me = this;\n\n        me.tip?.destroy();\n\n        if (tip) {\n            me._tip = Tooltip.new({\n                owner             : me,\n                forElement        : me.svgElement,\n                forSelector       : 'rect',\n                internalListeners : {\n                    beforeShow : 'up.onBeforeTipShow'\n                }\n            }, tip);\n        }\n        else {\n            me._tip = null;\n        }\n    }\n\n    onElementResize() {\n        super.onElementResize(...arguments);\n\n        const svgRect = this.svgElement.getBoundingClientRect();\n\n        this.scaledSvgGroup.setAttribute('transform', `scale(${svgRect.width} ${svgRect.height})`);\n    }\n\n    onBeforeTipShow({ source : tip }) {\n        const index = parseInt(tip.activeTarget.dataset.index);\n\n        tip.html = tip.contentTemplate({\n            histogram : this,\n            index\n        });\n    }\n\n    set series(value) {\n        const\n            me     = this,\n            series = me._series = {};\n\n        for (const id in value) {\n            // Providing\n            //\n            // \"series\" : {\n            //     \"foo\" : false\n            //     ...\n            //\n            // disables the \"foo\" serie (that could be defined on a prototype level for example)\n\n            if (value[id] !== false) {\n                const data = series[id] = Object.assign({}, value[id]);\n\n                // support type & field provided on config prototype level\n\n                if (!data.type && value[id].type) {\n                    data.type = value[id].type;\n                }\n\n                if (!data.field && value[id].field) {\n                    data.field = value[id].field;\n                }\n\n                if (!('order' in series)) {\n                    data.order = typePrio[data.type];\n                }\n\n                data.id = id;\n            }\n        }\n\n        me.scheduleRefresh();\n    }\n\n    get series() {\n        return this._series;\n    }\n\n    set data(data) {\n        const me = this;\n\n        // TODO:\n        // me.topValue = undefined;\n\n        me._data = data;\n\n        // Calculate the top value from all the series\n        if (!me.topValue) {\n            const fields   = Object.values(me.series).map(getField);\n\n            for (let i = 0, { length } = data; i < length; i++) {\n                for (let j = 0, { length } = fields; j < length; j++) {\n                    me.topValue = Math.max(me.topValue || 0, data[i][fields[j]]);\n                }\n            }\n        }\n\n        me.scheduleRefresh();\n    }\n\n    get data() {\n        return this._data;\n    }\n\n    set topValue(value) {\n        this._topValue = value;\n\n        this.scheduleRefresh();\n    }\n\n    get topValue() {\n        return this._topValue;\n    }\n\n    // Must exist from the start because configuration setters call it.\n    // Once configured, will be replaced with a function which schedules a refresh for the next animation frame.\n    scheduleRefresh() {\n\n    }\n\n    refresh() {\n        const\n            me             = this,\n            {\n                series,\n                _tip\n            }              = me,\n            histogramElements = [];\n\n        for (const id in series) {\n            const\n                data     = series[id],\n                elConfig = me[`draw${StringHelper.capitalize(data.type)}`](data);\n\n            if (Array.isArray(elConfig)) {\n                histogramElements.push.apply(histogramElements, elConfig);\n            }\n            else {\n                histogramElements.push(elConfig);\n            }\n        }\n\n        histogramElements.sort(byDatasetOrder);\n\n        DomSync.syncChildren({\n            domConfig      : { children : histogramElements },\n            configEquality : returnFalse\n        }, me.scaledSvgGroup);\n\n        DomSync.syncChildren({\n            domConfig : { children : me.drawText() }\n        }, me.unscaledSvgGroup);\n\n        if (_tip && _tip.isVisible) {\n            me.onBeforeTipShow({ source : _tip });\n        }\n    }\n\n    drawBar(series) {\n        const\n            me           = this,\n            {\n                topValue,\n                data,\n                omitZeroHeightBars,\n                barStyle\n            }            = me,\n            {\n                field,\n                order\n            }            = series,\n            defaultWidth = 1 / data.length,\n            children     = [];\n\n        let\n            width;\n\n        for (let index = 0, x = 0, { length } = data; index < length; index++, x += width) {\n            const\n                datum = data[index],\n                value = datum[field],\n                // limit height with topValue otherwise the histogram looks fine\n                // yet the bar tooltip picks wrong Y-coordinate and there is an empty space between it and the bar\n                height = datum.height || (value > topValue ? topValue : value) / topValue,\n                y = 1 - height,\n                rectConfig = (datum.rectConfig = {\n                    ns,\n                    tag     : 'rect',\n                    dataset : {}\n                }),\n                barTip = me.callback('getBarTip', me, [series, rectConfig, datum, index]);\n\n            // use either provided width or the calculated value\n            width = datum.width || defaultWidth;\n\n            if (barStyle) {\n                rectConfig.style = barStyle;\n            }\n            else {\n                delete rectConfig.style;\n            }\n            Object.assign(rectConfig.dataset, {\n                index,\n                order\n            });\n            Object.assign(rectConfig, {\n                x,\n                y,\n                width,\n                height,\n                class : me.callback('getRectClass', me, [series, rectConfig, datum, index])\n            });\n\n            if (barTip) {\n                rectConfig.dataset.btip = barTip;\n            }\n            else {\n                delete rectConfig.dataset.btip;\n            }\n\n            if (height || !omitZeroHeightBars) {\n                children.push(rectConfig);\n            }\n        }\n        return children;\n    }\n\n    drawOutline(series) {\n        const\n            me           = this,\n            {\n                topValue,\n                data\n            }            = me,\n            {\n                field,\n                order\n            }            = series,\n            defaultWidth = 1 / data.length,\n            coords       = ['M 0,1'],\n            result       = series.outlineElement || (series.outlineElement = {\n                ns,\n                tag     : 'path',\n                dataset : {\n                    order\n                }\n            });\n\n        let\n            barWidth,\n            command1 = 'M',\n            command2 = 'L';\n\n        for (let i = 0, x = 0, { length } = data; i < length; i++) {\n            const barHeight = 1 - data[i][field] / topValue;\n\n            // use either provided with or the calculated value\n            barWidth = data[i].width || defaultWidth;\n\n            coords.push(`${command1} ${x},${barHeight} ${command2} ${x += barWidth},${barHeight}`);\n            command1 = command2 = '';\n        }\n        // coords.push('1,1');\n\n        result.d = coords.join(' ');\n\n        return result;\n    }\n\n    drawText() {\n        const\n            me                = this,\n            { data }          = me,\n            defaultWidth      = 1 / data.length,\n            defaultY          = '100%',\n            unscaledSvgGroups = [];\n\n        for (let index = 0, width, x = 0, { length } = data; index < length; index++, x += width) {\n            width = data[index].width || defaultWidth;\n\n            const barText = me.callback('getBarText', me, [data[index], index]);\n\n            if (barText) {\n\n                const renderData = me.callback('getBarTextRenderData', me, [{\n                    ns,\n                    tag       : 'text',\n                    className : 'b-bar-legend',\n                    html      : barText,\n                    x         : `${(x + width / 2) * 100}%`,\n                    y         : data[index].y !== undefined ? data[index].y : defaultY,\n                    dataset   : {\n                        index\n                    }\n                }, data[index], index]);\n\n                const barTip = me.callback('getBarTextTip', me, [renderData, data[index], index]);\n                if (barTip) {\n                    renderData.dataset.btip = barTip;\n                }\n                else {\n                    delete renderData.dataset.btip;\n                }\n\n                unscaledSvgGroups.push(renderData);\n            }\n        }\n\n        return unscaledSvgGroups;\n    }\n\n    //endregion\n\n    // Injectable method\n    getBarText(datum, index) {\n        return '';\n    }\n\n    // Injectable method\n    getBarTextRenderData(renderData, datum, index) {\n        return renderData;\n    }\n\n    // Injectable method\n    getBarTip(series, rectConfig, datum, index) {\n\n    }\n\n    // Injectable method\n    getBarTextTip(renderData, datum, index) {\n\n    }\n\n    // Injectable method\n    getRectClass(series, rectConfig, datum, index) {\n        return '';\n    }\n}\n\nHistogram.initClass();\n","import Widget from '../Widget.js';\nimport DomSync from '../../helper/DomSync.js';\n\n/**\n * @module Core/widget/graph/Scale\n */\nconst\n    ns = 'http://www.w3.org/2000/svg';\n\n/**\n * Displays a scale with ticks and labels.\n * @extends Core/widget/Widget\n * @classtype scale\n */\nexport default class Scale extends Widget {\n    //region Config\n\n    static get type() {\n        return 'scale';\n    }\n\n    static get $name() {\n        return 'Scale';\n    }\n\n    static get configurable() {\n        return {\n            scalePoints : null,\n\n            // Padding after the max scale point.\n            // Expressed as the share of the height.\n            scaleMaxPadding : 0.1,\n\n            /**\n             * Configure as `true` to create a horizontal scale. Scales are vertical by default.\n             * @config {Boolean}\n             */\n            horizontal : false,\n\n            /**\n             * Side to align the scale to. Defaults to `bottom` for {@link #config-horizontal} Scales\n             * and `right` for vertical Scales.\n             * @config {String}\n             */\n            align : {\n                value   : false,\n                $config : {\n                    merge : 'replace'\n                }\n            },\n\n            element : {\n                children : [{\n                    ns,\n                    tag                 : 'svg',\n                    reference           : 'svgElement',\n                    width               : '100%',\n                    height              : '100%',\n                    preserveAspectRatio : 'none',\n                    children            : [{\n                        ns,\n                        tag       : 'g',\n                        reference : 'scaledSvgGroup',\n                        children  : [{\n                            ns,\n                            tag       : 'path',\n                            reference : 'pathElement'\n                        }]\n                    }, {\n                        ns,\n                        tag       : 'g',\n                        reference : 'unscaledSvgGroup'\n                    }]\n                }]\n            },\n\n            monitorResize : true\n        };\n    }\n\n    //endregion\n\n    //region Init\n\n    construct(config) {\n        super.construct(config);\n        this.scheduleRefresh = this.createOnFrame(this.refresh, [], this, true);\n        this.refresh();\n    }\n\n    changeAlign(align) {\n        if (!align) {\n            align = this.horizontal ? 'bottom' : 'right';\n        }\n        return align;\n    }\n\n    updateAlign(align, oldAlign) {\n        this.element.classList.remove(`b-align-${oldAlign}`);\n        this.element.classList.add(`b-align-${align}`);\n    }\n\n    updateHorizontal(horizontal, oldHorizontal) {\n        this.element.classList.remove(`b-scale-${oldHorizontal ? 'horizontal' : 'vertical'}`);\n        this.element.classList.add(`b-scale-${horizontal ? 'horizontal' : 'vertical'}`);\n    }\n\n    onElementResize() {\n        super.onElementResize(...arguments);\n        this.scheduleRefresh();\n    }\n\n    // Must exist from the start because configuration setters call it.\n    // Once configured, will be replaced with a function which schedules a refresh for the next animation frame.\n    scheduleRefresh() {\n\n    }\n\n    refresh() {\n        const\n            me             = this,\n            {\n                horizontal,\n                width,\n                height,\n                align,\n                scalePoints,\n                scaleMaxPadding\n            }                  = me,\n            scaleMax           = scalePoints[scalePoints.length - 1].value,\n            path               = [],\n            labels             = [];\n\n        const posFactor = 1 / (scaleMax + scaleMaxPadding * scaleMax);\n\n        me.scaledSvgGroup.setAttribute('transform', `scale(${horizontal ? width : 1} ${horizontal ? 1 : height})`);\n\n        for (const point of scalePoints) {\n            const isLabelStep = Boolean(point.text),\n                pos = posFactor * point.value;\n\n            if (isLabelStep) {\n                const label = {\n                    ns,\n                    tag       : 'text',\n                    className : 'b-scale-tick-label',\n                    html      : point.text,\n                    dataset   : {\n                        tick : point.value\n                    }\n                };\n\n                if (horizontal) {\n                    label.x = `${pos * 100}%`;\n                    label.y = align === 'top' ? '1.6em' : height - 12;\n                }\n                else {\n                    label.x = align === 'left' ? '12' : `${width - 12}`;\n                    label.y = `${(1 - pos) * 100}%`;\n                }\n                labels.push(label);\n            }\n\n            if (horizontal) {\n                if (align === 'top') {\n                    path.push(`M${pos},0 L${pos},${isLabelStep ? 10 : 5}`);\n                }\n                else {\n                    path.push(`M${pos},${height} L${pos},${height - (isLabelStep ? 10 : 5)}`);\n                }\n            }\n            else {\n                if (align === 'left') {\n                    path.push(`M0,${1 - pos} L${isLabelStep ? 10 : 5},${1 - pos}`);\n                }\n                else {\n                    path.push(`M${width},${1 - pos} L${width - (isLabelStep ? 10 : 5)},${1 - pos}`);\n                }\n            }\n        }\n        me.pathElement.setAttribute('d', path.join(''));\n        DomSync.syncChildren({\n            domConfig : { children : labels }\n        }, me.unscaledSvgGroup);\n    }\n\n    //endregion\n}\nScale.initClass();\n"],"names":["ns","typePrio","bar","outline","text","byDatasetOrder","l","r","parseInt","dataset","order","getField","s","field","returnFalse","Histogram","Widget","type","$name","defaultConfig","data","values","series","topValue","element","children","tag","reference","width","height","preserveAspectRatio","omitZeroHeightBars","monitorResize","getRectClass","getBarTip","getBarText","getBarTextRenderData","getBarTextTip","construct","config","scheduleRefresh","createOnFrame","refresh","tip","_me$tip","me","destroy","_tip","Tooltip","new","owner","forElement","svgElement","forSelector","internalListeners","beforeShow","onElementResize","arguments","svgRect","getBoundingClientRect","scaledSvgGroup","setAttribute","onBeforeTipShow","source","index","activeTarget","html","contentTemplate","histogram","value","_series","id","Object","assign","_data","fields","map","i","length","j","Math","max","_topValue","histogramElements","elConfig","StringHelper","capitalize","Array","isArray","push","apply","sort","DomSync","syncChildren","domConfig","configEquality","drawText","unscaledSvgGroup","isVisible","drawBar","barStyle","defaultWidth","x","datum","y","rectConfig","barTip","callback","style","class","btip","drawOutline","coords","result","outlineElement","barWidth","command1","command2","barHeight","d","join","defaultY","unscaledSvgGroups","barText","renderData","className","undefined","initClass","_$name","Scale","configurable","scalePoints","scaleMaxPadding","horizontal","align","$config","merge","changeAlign","updateAlign","oldAlign","classList","remove","add","updateHorizontal","oldHorizontal","scaleMax","path","labels","posFactor","point","isLabelStep","Boolean","pos","label","tick","pathElement"],"mappings":"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"}