/*!
 *
 * Bryntum Grid 5.3.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
import{Base as e,DomHelper as t,GlobalEvents as n,Rectangle as i,Delayable as r,EventHelper as a,Events as l,ObjectHelper as s,_defineProperty as o,BrowserHelper as c,Widget as u,Point as d,Mask as g,Toast as h,StringHelper as m,LocaleManagerSingleton as p,DateHelper as f,DayTime as y,Panel as v,Tooltip as b,TimeZoneHelper as k,ArrayHelper as D,Field as C,_objectSpread2 as x,TextField as w,Combo as S,PickerField as M,Container as T,Duration as E,VersionHelper as F,DomClassList as L,Popup as P}from"./Editor.js";var O=r=>class extends(r||e){static get $name(){return"DragHelperContainer"}initContainerDrag(){const e=this;if(e.mode||(e.mode="container"),"container"===e.mode&&!e.containers)throw new Error("Container drag mode must specify containers")}grabContainerDrag(e){const n=this;if(!n.ignoreSelector||!e.target.closest(n.ignoreSelector)){const i=t.getAncestor(e.target,n.containers,n.outerElement);if(i){const t=i.getBoundingClientRect();n.context={element:i,valid:!0,action:"container",offsetX:e.pageX-t.left,offsetY:e.pageY-t.top,originalPosition:{parent:i.parentElement,prev:i.previousElementSibling,next:i.nextElementSibling}}}return!0}return!1}startContainerDrag(e){var n;const i=this,{context:r,floatRootOwner:a}=i,{element:l}=r,s=l.cloneNode(!0),o=l.getBoundingClientRect(),c=null==a?void 0:a.element.closest(".b-outer");s.classList.add(i.dragProxyCls),s.classList.add(i.draggingCls),((null==a?void 0:a.floatRoot)||t.getRootElement(l)).appendChild(s),r.dragProxy=s,s.style.width=o.width+"px",s.style.height=o.height+"px",t.setTranslateXY(r.dragProxy,o.left,o.top),r.dragging=l,l.classList.add(i.dropPlaceholderCls),null!=c&&null!==(n=c.parentElement)&&void 0!==n&&n.matches(".b-float-root")&&(s.style.zIndex=a.floatRootMaxZIndex+1)}updateContainerDrag(e){var i;const r=this,{context:a}=r;if(!a.started||!a.targetElement)return;const l=t.getAncestor(a.targetElement,r.containers,"b-gridbase"),s=null===(i=a.dragging)||void 0===i?void 0:i.contains(t.getActiveElement(a.dragging));l&&t.isDescendant(a.element,l)||(s&&n.suspendFocusEvents(),l&&a.valid?r.moveNextTo(l,e):r.revertPosition(),s&&n.resumeFocusEvents(),e.preventDefault())}finishContainerDrag(e){const t=this,{context:n}=t,{dragging:i,dragProxy:r,valid:a,draggedTo:l,insertBefore:s,originalPosition:o}=n;i&&(n.valid=a&&l&&(i!==s||o.parent!==l),n.finalize=(e=n.valid)=>{!e&&t.context&&t.revertPosition(),i.classList.remove(t.dropPlaceholderCls),r.remove(),t.reset()},n.async=!1,t.trigger("drop",{context:n,event:e}),n.async||n.finalize())}abortContainerDrag(e=!1,t=null,n=!1){const i=this,{context:r}=i;r.dragging&&(r.dragging.classList.remove(i.dropPlaceholderCls),r.dragProxy.remove(),i.revertPosition()),n||i.trigger(e?"drop":"abort",{context:r,event:t}),i.reset()}updateContainerProxy(e){const n=this,{context:i}=n,r=i.dragProxy;let a,l=e.pageX-i.offsetX,s=e.pageY-i.offsetY;if("number"==typeof n.minX&&(l=Math.max(n.minX,l)),"number"==typeof n.maxX&&(l=Math.min(n.maxX-r.offsetWidth,l)),"number"==typeof n.minY&&(s=Math.max(n.minY,s)),"number"==typeof n.maxY&&(s=Math.min(n.maxY-r.offsetHeight,s)),n.lockX?t.setTranslateY(r,s):n.lockY?t.setTranslateX(r,l):t.setTranslateXY(r,l,s),"touchmove"===e.type){const n=e.changedTouches[0];a=t.elementFromPoint(n.clientX,n.clientY)}else a=e.target;i.targetElement=a}moveNextTo(e,t){const{context:n}=this,r=n.dragging,a=e.parentElement;if(e!==r){const l=i.from(e).center.x;this.isRTL&&t.pageX>l||!this.isRTL&&t.pageX<l?(a.insertBefore(r,e),n.insertBefore=e):e.nextElementSibling?e.nextElementSibling!==r?(n.insertBefore=e.nextElementSibling,a.insertBefore(r,e.nextElementSibling)):n.insertBefore||r.parentElement.lastElementChild===r||(n.insertBefore=e.nextElementSibling):(a.appendChild(r),n.insertBefore=null),n.draggedTo=a}}revertPosition(){const{context:e}=this,{dragging:t}=e,{parent:n,next:i}=e.originalPosition;if(i){i.previousSibling===t||!i&&t===n.lastChild||n.insertBefore(t,i)}else n.appendChild(t);e.draggedTo=null}};const Y={pageXOffset:0,pageYOffset:0};var _=n=>class extends(r(n||e)){static get $name(){return"DragHelperTranslate"}static get configurable(){return{positioning:null,skipUpdatingElement:null}}initTranslateDrag(){const e=this;!e.isElementDraggable&&e.targetSelector&&(e.isElementDraggable=t=>t.closest(e.targetSelector))}grabTranslateDrag(e){const t=this.getTarget(e);return!!t&&(this.context={valid:!0,element:t,startPageX:e.pageX,startPageY:e.pageY,startClientX:e.clientX,startClientY:e.clientY},!0)}getTarget(e){return e.target.closest(this.targetSelector)}getX(e){return"absolute"===this.positioning?parseFloat(e.style.left,10):t.getTranslateX(e)}getY(e){return"absolute"===this.positioning?parseFloat(e.style.top,10):t.getTranslateY(e)}getXY(e){return"absolute"===this.positioning?[e.offsetLeft,e.offsetTop]:t.getTranslateXY(e)}setXY(e,n,i){this.skipUpdatingElement||("absolute"===this.positioning?(e.style.left=n+"px",e.style.top=i+"px"):t.setTranslateXY(e,n,i))}startTranslateDrag(e){const n=this,{context:r,outerElement:a,proxySelector:l}=n,s=n.dragWithin=n.dragWithin||n.cloneTarget&&document.body;let o=r.dragProxy||r.element;const c=o,u=o.parentElement;if(n.cloneTarget){const t=l?o.querySelector(l):o,{width:a,height:u,x:d,y:g}=i.from(t,s);o=n.createProxy(o);let h=d,m=g;if(n.autoSizeClonedTarget&&(o.style.width=`${a}px`,o.style.height=`${u}px`),o.classList.add(n.dragProxyCls,n.draggingCls),o.classList.remove("b-hover","b-selected","b-focused"),s.appendChild(o),!n.autoSizeClonedTarget||l){const t=o.getBoundingClientRect(),{x:n,y:i}=s.getBoundingClientRect(),a=e.clientX-n,l=e.clientY-i+(s!==document.body?document.body.getBoundingClientRect().y:0);h=a-t.width/2,m=l-t.height/2,r.startPageX=e.pageX,r.startPageY=e.pageY}n.setXY(o,h,m),c.classList.add("b-drag-original"),n.hideOriginalElement&&c.classList.add("b-hidden")}o.classList.add(n.draggingCls),Object.assign(r,{element:o,grabbed:c,grabbedParent:u,grabbedNextSibling:o.nextElementSibling,elementStartX:n.getX(o),elementStartY:n.getY(o),elementX:t.getOffsetX(o,s||a),elementY:t.getOffsetY(o,s||a),scrollX:0,scrollY:0,scrollManagerElementContainsDragProxy:!n.cloneTarget||s===a}),s&&(r.parentElement=o.parentElement,s!==o.parentElement&&s.appendChild(o),n.updateTranslateProxy(e))}onDragStarted(){var e;const t=this,{context:n}=t;let{relatedElements:r}=n;if(t.unifiedProxy&&n.element.classList.add("b-drag-main","b-drag-unified-proxy"),(null===(e=r)||void 0===e?void 0:e.length)>0){n.relatedElStartPos=[],n.relatedElDragFromPos=[];const{proxySelector:e}=t;let[l,s]=[n.elementStartX,n.elementStartY];n.originalRelatedElements=r,r=n.relatedElements=r.map(((r,a)=>{const o=e?r.querySelector(e):r,{x:c,y:u,width:d,height:g}=i.from(o,t.dragWithin),h=t.cloneTarget?t.createProxy(r):r;return h.classList.add(t.draggingCls),h.classList.remove("b-hover","b-selected","b-focused"),t.cloneTarget&&(t.setXY(h,c,u),t.dragWithin.appendChild(h),h.classList.add(t.dragProxyCls),t.autoSizeClonedTarget&&(h.style.width=`${d}px`,h.style.height=`${g}px`),t.hideOriginalElement&&r.classList.add("b-hidden"),r.classList.add("b-drag-original")),n.relatedElStartPos[a]=n.relatedElDragFromPos[a]=t.getXY(h),t.unifiedProxy&&(h.classList.add("b-drag-unified-animation","b-drag-unified-proxy"),l+=t.unifiedOffset,s+=t.unifiedOffset,t.setXY(h,l,s),n.relatedElDragFromPos[a]=[l,s],h.style.zIndex=100-a),h})),t.unifiedProxy&&r&&r.length>0&&a.onTransitionEnd({element:r[0],property:"transform",handler(){r.forEach((e=>e.classList.remove("b-drag-unified-animation")))},thisObj:t,once:!0})}}applyConstraints(e,t,n){const i=this,{constrain:r,dragWithin:a}=i,{pageXOffset:l,pageYOffset:s}=a===document.body?globalThis:Y;return a&&r&&(t<0&&(t=0),t+e.offsetWidth>a.scrollWidth&&(t=a.scrollWidth-e.offsetWidth),n<0&&(n=0),n+e.offsetHeight>a.scrollHeight&&(n=a.scrollHeight-e.offsetHeight)),"number"==typeof i.minX&&(t=Math.max(i.minX+l,t)),"number"==typeof i.maxX&&(t=Math.min(i.maxX+l,t)),"number"==typeof i.minY&&(n=Math.max(i.minY+s,n)),"number"==typeof i.maxY&&(n=Math.min(i.maxY+s,n)),{constrainedX:t,constrainedY:n}}updateTranslateProxy(e,t){const n=this,{lockX:i,lockY:r,context:a}=n,l=a.dragProxy||a.element,{relatedElements:s,relatedElDragFromPos:o}=a;a.scrollManagerElementContainsDragProxy&&t&&(a.scrollX=t.getRelativeLeftScroll(l),a.scrollY=t.getRelativeTopScroll(l)),a.pageX=e.pageX,a.pageY=e.pageY,a.clientX=e.clientX,a.clientY=e.clientY;let c=a.elementStartX+e.pageX-a.startPageX+a.scrollX,u=a.elementStartY+e.pageY-a.startPageY+a.scrollY;if(n.snapCoordinates){const e=n.snapCoordinates({element:l,newX:c,newY:u});c=e.x,u=e.y}const{constrainedX:d,constrainedY:g}=n.applyConstraints(l,c,u);if((a.started||d!==c||g!==u)&&n.setXY(l,i?void 0:d,r?void 0:g),s){const e=i?0:d-a.elementStartX,t=r?0:g-a.elementStartY;s.forEach(((i,r)=>{const[a,l]=o[r];n.setXY(i,a+e,l+t)}))}a.newX=d,a.newY=g}async finishTranslateDrag(e){const t=this,n=t.context,{target:r}=e,a=!t.lockX&&Math.round(n.newX)!==Math.round(n.elementStartX),l=!t.lockY&&Math.round(n.newY)!==Math.round(n.elementStartY),s=n.dragProxy||n.element,{relatedElements:o}=n;if(!t.ignoreSamePositionDrop||a||l)if(!1===n.valid)await t.abortTranslateDrag(!0,e);else{const a=!t.allowDropOutside&&i.from(t.dragWithin||t.outerElement);a&&("number"!=typeof t.minX&&!0!==t.minX&&e.pageX<a.left||"number"!=typeof t.maxX&&!0!==t.maxX&&e.pageX>a.right||"number"!=typeof t.minY&&!0!==t.minY&&e.pageY<a.top||"number"!=typeof t.maxY&&!0!==t.maxY&&e.pageY>a.bottom)?(n.valid=!1,await t.abortTranslateDrag(!0,e)):(n.finalize=async(i=n.valid)=>{n.finalized?console.warn("DragHelper: Finalizing already finalized drag"):(n.finalized=!0,!i&&t.context&&await t.abortTranslateDrag(!0,null,!0),t.isDestroyed||(t.trigger("dropFinalized",{context:n,event:e,target:r}),t.reset()),t.cloneTarget||s.parentElement===n.grabbedParent||[s,...o||[]].forEach((e=>e.style.transform="")))},n.async=!1,await t.trigger("drop",{context:n,event:e,target:r}),n.async||await n.finalize())}else t.abortTranslateDrag(!1,e)}async abortTranslateDrag(e=!1,n=null,r=!1){var l,s;const o=this,{cloneTarget:c,context:u,proxySelector:d,dragWithin:g,draggingCls:h}=o,{relatedElements:m,relatedElStartPos:p,grabbed:f}=u,y=u.dragProxy||u.element;if(null===(l=o.scrollManager)||void 0===l||l.stopMonitoring(),u.aborted)return void console.warn("DragHelper: Aborting already aborted drag");let{elementStartX:v,elementStartY:b}=u;if(y&&u.started){if(!c&&g&&g!==u.grabbedParent&&u.grabbedParent.insertBefore(y,u.grabbedNextSibling),c&&d){const e=f.querySelector(d)||f,{x:t,y:n}=i.from(e);v=t,b=n}y.classList.add("b-aborting"),o.setXY(y,v,b),null==m||m.forEach(((e,t)=>{e.classList.remove(h),e.classList.add("b-aborting"),o.setXY(e,p[t][0],p[t][1])})),r||o.trigger(e?"drop":"abort",{context:u,event:n}),t.isOrphaned(y)||o.isDestroying||await a.waitForTransitionEnd({element:y,property:t.getPropertyTransitionDuration(y,"transform")?"transform":"all",thisObj:o,once:!0,runOnDestroy:!0}),o.isDestroyed||o.trigger("abortFinalized",{context:u,event:n})}null!==(s=o.context)&&void 0!==s&&s.started&&o.reset()}cleanUp(){const{context:e,cloneTarget:t,draggingCls:n,dragProxyCls:i}=this,r=e.dragProxy||e.element,{relatedElements:a,originalRelatedElements:l,grabbed:s}=e,o=t&&(this.removeProxyAfterDrop||!e.valid),c=[n,"b-aborting",i,"b-drag-main","b-drag-unified-proxy"];r.classList.remove(...c),o&&r.remove(),null==a||a.forEach((e=>{o?e.remove():e.classList.remove(...c)})),s.classList.remove("b-drag-original","b-hidden"),null==l||l.forEach((e=>e.classList.remove("b-hidden","b-drag-original")))}};const V="onMouseMove",A="onMouseUp",W="onDocumentClick",N="onTouchMove",R="onTouchEnd",I="onKeyDown";class H extends(e.mixin(l,O,_)){static get defaultConfig(){return{dragProxyCls:"b-drag-proxy",invalidCls:"b-drag-invalid",draggingCls:"b-dragging",dropPlaceholderCls:"b-drop-placeholder",dragThreshold:5,outerElement:document.body,dragWithin:null,unifiedProxy:null,monitoringConfig:null,constrain:!0,minX:null,maxX:null,minY:null,maxY:null,mode:"translateXY",isElementDraggable:null,targetSelector:null,dropTargetSelector:null,dropTargetCls:null,proxySelector:null,cloneTarget:!1,autoSizeClonedTarget:!0,hideOriginalElement:!1,containers:null,ignoreSelector:null,startEvent:null,lockX:!1,lockY:!1,touchStartDelay:300,scrollManager:null,snapCoordinates:null,unifiedOffset:5,removeProxyAfterDrop:!0,clickSwallowDuration:50,ignoreSamePositionDrop:!0,allowDropOutside:null,floatRootOwner:null,mouseMoveListenerElement:document,testConfig:{transitionDuration:10,clickSwallowDuration:50,touchStartDelay:100},rtlSource:null,createProxy:null}}construct(e){const t=this;super.construct(e),t.initListeners(),t.isContainerDrag?t.initContainerDrag():t.initTranslateDrag(),t.onScrollManagerScrollCallback=t.onScrollManagerScrollCallback.bind(t)}doDestroy(){this.reset(!0),super.doDestroy()}initListeners(){const e=this,{outerElement:t}=e,n={element:t,pointerdown:"onPointerDown",thisObj:e};e.mouseMoveListenerElement=e.getMouseMoveListenerTarget(t),a.on(n)}getMouseMoveListenerTarget(e){const t=e.getRootNode();let n=this.mouseMoveListenerElement;return t.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&"closed"===t.mode&&(n=e.closest(".b-outer")||n),n}get isRTL(){var e;return Boolean(null===(e=this.rtlSource)||void 0===e?void 0:e.rtl)}onPointerDown(e){const n=this;if(0!==e.button||!t.isVisible(e.target)||n.context)return;if(n.isElementDraggable&&!n.isElementDraggable(e.target,e))return;n.startEvent=e;if(n.isContainerDrag?n.grabContainerDrag(e):n.grabTranslateDrag(e)){n.blurDetacher=a.on({element:globalThis,blur:n.onWindowBlur,thisObj:n});const t={element:n.mouseMoveListenerElement,thisObj:n,capture:!0,keydown:I};if("touch"===e.pointerType?(n.touchStartTimer=n.setTimeout((()=>n.touchStartTimer=null),n.touchStartDelay,"touchStartDelay"),t.touchmove={handler:N,passive:!1},t.touchend=t.pointerup=R):(t.pointermove=V,t.pointerup=A),n.dragListenersDetacher=a.on(t),n.dragWithin&&n.dragWithin!==n.outerElement&&n.outerElement.contains(n.dragWithin)){const e=i.from(n.dragWithin,n.outerElement);n.minY=e.top,n.maxY=e.bottom,n.minX=e.left,n.maxX=e.right}}}internalMove(e){var n;if(e.scrollInitiated)return;const i=this,{context:r}=i,l=a.getDistanceBetween(i.startEvent,e);if(i.touchStartTimer&&l>i.dragThreshold)i.abort(!0);else if(!i.touchStartTimer&&null!=r&&r.element&&(r.started||l>=i.dragThreshold)&&(null===(n=e.target)||void 0===n?void 0:n.nodeType)===Node.ELEMENT_NODE){if(!r.started){var o,c;if(!1===i.trigger("beforeDragStart",{context:r,event:e}))return i.abort();i.isContainerDrag?i.startContainerDrag(e):i.startTranslateDrag(e),r.started=!0,null===(o=i.scrollManager)||void 0===o||o.startMonitoring(s.merge({scrollables:[{element:i.dragWithin||i.outerElement}],callback:i.onScrollManagerScrollCallback},i.monitoringConfig)),r.outermostEl=t.getOutermostElement(e.target),r.outermostEl.classList.add("b-draghelper-active"),i.dropTargetSelector&&i.dropTargetCls&&t.getRootElement(i.outerElement).querySelectorAll(i.dropTargetSelector).forEach((e=>e.classList.add(i.dropTargetCls))),i.trigger("dragStart",{context:r,event:e}),null===(c=i.onDragStarted)||void 0===c||c.call(i),i.trigger("afterDragStart",{context:r,event:e})}i.update(e),"touchmove"===e.type&&(e.preventDefault(),e.stopImmediatePropagation())}}onScrollManagerScrollCallback(e){var t;const{lastMouseMoveEvent:n}=this;null!==(t=this.context)&&void 0!==t&&t.element&&n&&(n.isScroll=!0,this.update(n,e))}onTouchMove(e){this.internalMove(e)}onMouseMove(e){this.internalMove(e)}update(e,n){const i=this,{context:r}=i,a=document.scrollingElement||document.body;let l=i.getMouseMoveEventTarget(e);if("touchmove"===e.type){const n=e.changedTouches[0];l=t.elementFromPoint(n.clientX+a.scrollLeft,n.clientY+a.scrollTop)}r.target=l;let s=i.allowDropOutside||!i.dragWithin||i.dragWithin.contains(e.target);var o;s&&i.dropTargetSelector&&(s=s&&Boolean(null===(o=l)||void 0===o?void 0:o.closest(i.dropTargetSelector)));i.isContainerDrag?i.updateContainerProxy(e,n):i.updateTranslateProxy(e,n),r.valid=s,i.trigger("drag",{context:r,event:e}),i.isContainerDrag&&i.updateContainerDrag(e,n),r.valid=r.valid&&s;for(const e of i.draggedElements)e.classList.toggle(i.invalidCls,!r.valid);e&&(i.lastMouseMoveEvent=e)}get draggedElements(){var e;const{context:t}=this;return[t.dragProxy||t.element,...null!==(e=t.relatedElements)&&void 0!==e?e:[]]}async abort(e=!1){var t,n;const i=this,{context:r}=i;null===(t=i.scrollManager)||void 0===t||null===(n=t.stopMonitoring)||void 0===n||n.call(t),i.removeListeners(),null!=r&&r.started&&!r.aborted?(r.element.getBoundingClientRect(),r.valid=!1,i.isContainerDrag?i.abortContainerDrag(void 0,void 0,e):i.abortTranslateDrag(void 0,void 0,e),r.aborted=!0):i.reset(!0)}removeListeners(){var e,t;null===(e=this.dragListenersDetacher)||void 0===e||e.call(this),null===(t=this.blurDetacher)||void 0===t||t.call(this)}reset(e){const n=this,{context:i}=n;if(null!=i&&i.started){for(const e of n.draggedElements)e.classList.remove(n.invalidCls);i.outermostEl.classList.remove("b-draghelper-active"),n.isContainerDrag?i.dragProxy.remove():n.cleanUp(),n.dropTargetSelector&&n.dropTargetCls&&t.getRootElement(n.outerElement).querySelectorAll(n.dropTargetSelector).forEach((e=>e.classList.remove(n.dropTargetCls)))}n.removeListeners(),e||n.trigger("reset"),n.context=n.lastMouseMoveEvent=null}onTouchEnd(e){this.onMouseUp(e)}onDocumentClick(e){e.stopPropagation()}onMouseUp(e){const t=this,{context:n}=t;var i;(t.removeListeners(),n)&&(null===(i=t.scrollManager)||void 0===i||i.stopMonitoring(),n.started?(e.stopPropagation(),n.finalizing=!0,t.isContainerDrag?t.finishContainerDrag(e):t.finishTranslateDrag(e),a.on({element:document,thisObj:t,click:W,capture:!0,expires:t.clickSwallowDuration,once:!0})):t.reset(!0))}onKeyDown(e){var t;null!==(t=this.context)&&void 0!==t&&t.started&&"Escape"===e.key&&(e.stopImmediatePropagation(),this.abort())}onWindowBlur(){this.context&&!this.context.finalizing&&this.abort()}createProxy(e){this.proxySelector&&(e=e.querySelector(this.proxySelector)||e);const t=e.cloneNode(!0);return t.removeAttribute("id"),t}get isContainerDrag(){return"container"===this.mode}async animateProxyTo(e,n={align:"c-c"}){const{context:r,draggedElements:l}=this,{element:s}=r,o=e.isRectangle?e:i.from(e);l.forEach((e=>{e.classList.add("b-drag-final-transition"),t.alignTo(e,o,n)})),await a.waitForTransitionEnd({element:s,property:"all",thisObj:this,once:!0}),l.forEach((e=>e.classList.remove("b-drag-final-transition")))}get isDragging(){var e;return Boolean(null===(e=this.context)||void 0===e?void 0:e.started)}getMouseMoveEventTarget(e){return e.isScroll?t.elementFromPoint(e.clientX,e.clientY):e.target}}H._$name="DragHelper";const z={down:"onMouseDown",move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:{handler:"onTouchStart",passive:!1},touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"};class B extends(l(e)){static get defaultConfig(){return{resizingCls:"b-resizing",dragThreshold:5,handleSize:10,dynamicHandleSize:null,reservedSpace:10,touchHandleSize:30,minWidth:1,maxWidth:0,minHeight:1,maxHeight:0,outerElement:document.body,scroller:null,allowResize:null,dragWithin:null,isElementResizable:null,targetSelector:null,leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSelector:null,handleContainerSelector:null,startEvent:null,grab:null,invalidCls:"b-resize-invalid",handleVisibilityThreshold:null,skipTranslate:!1,direction:"horizontal",clickSwallowDuration:50,rtlSource:null}}construct(e){const t=this;super.construct(e),t.handleSelector||c.isHoverableDevice||(t.handleSize=t.touchHandleSize),t.handleVisibilityThreshold=t.handleVisibilityThreshold||2*t.handleSize,t.initListeners(),t.initResize()}doDestroy(){this.abort(!0),super.doDestroy()}updateSkipUpdatingElement(e){e&&(this.skipTranslate=!0)}initResize(){const e=this;if(!e.isElementResizable&&e.targetSelector&&(e.isElementResizable=t=>t.closest(e.targetSelector)),e.grab){const{edge:n,element:i,event:r}=e.grab;e.startEvent=r;const a=e.getCursorOffsetToElementEdge(r,i,n);e.context={element:i,edge:n,valid:!0,async:!1,elementStartX:t.getTranslateX(i)||i.offsetLeft,elementStartY:t.getTranslateY(i)||i.offsetTop,newX:t.getTranslateX(i)||i.offsetLeft,newY:t.getTranslateY(i)||i.offsetTop,elementWidth:i.offsetWidth,elementHeight:i.offsetHeight,cursorOffset:a,startX:r.clientX+a.x+e.scrollLeft,startY:r.clientY+a.y+e.scrollTop,finalize:()=>{var t;return null===(t=e.reset)||void 0===t?void 0:t.call(e)}},i.classList.add(e.resizingCls),e.internalStartResize(e.isTouch)}}initListeners(){const e=this,t={element:e.outerElement,mousedown:z.down,touchstart:z.touchstart,thisObj:e};!e.handleSelector&&c.isHoverableDevice&&(t.mousemove={handler:z.move,delegate:e.targetSelector},t.mouseleave={handler:"onMouseLeaveTarget",delegate:e.targetSelector,capture:!0}),a.on(t)}get isRTL(){var e;return Boolean(null===(e=this.rtlSource)||void 0===e?void 0:e.rtl)}get scrollLeft(){return this.scroller?this.scroller.x:this.outerElement.scrollLeft}get scrollTop(){return this.scroller?this.scroller.y:this.outerElement.scrollTop}internalStartResize(e){const t={element:document,keydown:z.keydown,thisObj:this};e?(t.touchmove=z.touchmove,t.touchend=t.pointerup=z.touchend):(t.mousemove=z.move,t.mouseup=z.up),this.removeDragListeners=a.on(t)}removeDragListeners(){}reset(){var e;null===(e=this.removeDragListeners)||void 0===e||e.call(this),this.context=null,this.trigger("reset")}canResize(e,t){return!this.isElementResizable||this.isElementResizable(e,t)}onPointerDown(e,t){const n=this;n.startEvent=t,n.canResize(t.target,t)&&n.grabResizeHandle(e,t)&&(t.stopImmediatePropagation(),"touchstart"===t.type&&t.preventDefault(),n.internalStartResize(e))}onTouchStart(e){e.touches.length>1||this.onPointerDown(!0,e)}onMouseDown(e){0===e.button&&this.onPointerDown(!1,e)}internalMove(e,t){const n=this,{context:i,direction:r}=n;if(null!=i&&i.element&&(i.started||a.getDistanceBetween(n.startEvent,t)>=n.dragThreshold)){var l;if(!i.started)null===(l=n.scrollManager)||void 0===l||l.startMonitoring(s.merge({scrollables:[{element:n.dragWithin||n.outerElement,direction:r}],callback:e=>{var t;return(null===(t=n.context)||void 0===t?void 0:t.element)&&n.lastMouseMoveEvent&&n.update(n.lastMouseMoveEvent,e)}},n.monitoringConfig)),n.trigger("resizeStart",{context:i,event:t}),i.started=!0;n.update(t)}else e||n.handleSelector||n.checkResizeHandles(t)}onTouchMove(e){this.internalMove(!0,e)}onMouseMove(e){this.internalMove(!1,e)}onPointerUp(e,t){var n;const i=this,r=i.context;var l,s;(null===(n=i.removeDragListeners)||void 0===n||n.call(i),r)?(null===(l=i.scrollManager)||void 0===l||l.stopMonitoring(),r.started&&a.on({element:document,thisObj:i,click:z.docclick,expires:i.clickSwallowDuration,capture:!0,once:!0}),i.finishResize(t)):null===(s=i.reset)||void 0===s||s.call(i)}onTouchEnd(e){this.onPointerUp(!0,e)}onMouseUp(e){this.onPointerUp(!1,e)}onDocumentClick(e){e.stopPropagation()}onKeyDown(e){"Escape"===e.key&&this.abort()}update(e){const t=this,n=t.context,r=i.from(t.outerElement);n.currentX=Math.max(Math.min(e.clientX+n.cursorOffset.x,r.right),r.x)+t.scrollLeft,n.currentY=Math.max(Math.min(e.clientY+n.cursorOffset.y,r.bottom),r.y)+t.scrollTop,e&&(t.updateResize(e)&&(t.trigger("resizing",{context:n,event:e}),n.element.classList.toggle(t.invalidCls,!1===n.valid)),t.lastMouseMoveEvent=e)}abort(e=!1){var t,n;const i=this;null===(t=i.scrollManager)||void 0===t||null===(n=t.stopMonitoring)||void 0===n||n.call(t),i.context?i.abortResize(null,e):i.isDestroyed||i.reset()}grabResizeHandle(e,n){const i=this;if(i.allowResize&&!i.allowResize(n.target,n))return!1;const r=i.handleSelector,a="touchstart"===n.type?n.changedTouches[0]:n,l=a.clientX,s=a.clientY,o=i.targetSelector?n.target.closest(i.targetSelector):n.target;if(o){let c;if(r){if(!n.target.matches(r))return!1;c="horizontal"===i.direction?n.pageX<t.getPageX(o)+o.offsetWidth/2?i.isRTL?"right":"left":i.isRTL?"left":"right":n.pageY<t.getPageY(o)+o.offsetHeight/2?"top":"bottom"}else if("horizontal"===i.direction?i.overLeftHandle(n,o)?c=i.isRTL?"right":"left":i.overRightHandle(n,o)&&(c=i.isRTL?"left":"right"):i.overTopHandle(n,o)?c="top":i.overBottomHandle(n,o)&&(c="bottom"),!c)return i.context=null,!1;"touchstart"===n.type&&n.preventDefault();const u=i.getCursorOffsetToElementEdge(a,o,c);if(!1!==i.trigger("beforeResizeStart",{element:o,event:n}))return i.context={element:o,edge:c,isTouch:e,valid:!0,async:!1,direction:i.direction,elementStartX:t.getTranslateX(o)||o.offsetLeft,elementStartY:t.getTranslateY(o)||o.offsetTop,newX:t.getTranslateX(o)||o.offsetLeft,newY:t.getTranslateY(o)||o.offsetTop,elementWidth:o.offsetWidth,elementHeight:o.offsetHeight,cursorOffset:u,startX:l+u.x+i.scrollLeft,startY:s+u.y+i.scrollTop,finalize:()=>{var e;return null===(e=i.reset)||void 0===e?void 0:e.call(i)}},o.classList.add(i.resizingCls),!0}return!1}getCursorOffsetToElementEdge(e,t,n){const r=i.from(t);let a=0,l=0;switch(n){case"left":a=r.x-(this.isRTL?r.width:0)-e.clientX;break;case"right":a=r.x+(this.isRTL?0:r.width)-e.clientX;break;case"top":l=r.y-e.clientY;break;case"bottom":l=r.y+r.height-e.clientY}return{x:a,y:l}}checkResizeHandles(e){const t=this,n=t.targetSelector?e.target.closest(t.targetSelector):e.target;if(!n||t.allowResize&&!t.allowResize(e.target,e))t.currentElement&&t.unHighlightHandle();else if(t.currentElement=t.handleContainerSelector?e.target.closest(t.handleContainerSelector):e.target,t.currentElement){let i;i="horizontal"===t.direction?t.overLeftHandle(e,n)||t.overRightHandle(e,n):t.overTopHandle(e,n)||t.overBottomHandle(e,n),i?t.highlightHandle():t.unHighlightHandle()}}onMouseLeaveTarget(e){const t=this;t.currentElement=t.handleContainerSelector?e.target.closest(t.handleContainerSelector):e.target,t.currentElement&&t.unHighlightHandle()}updateResize(e){const n=this,{context:i,allowEdgeSwitch:r,skipTranslate:a,skipUpdatingElement:l}=n;let s;r&&("horizontal"===n.direction?i.edge=i.currentX>i.startX?"right":"left":i.edge=i.currentY>i.startY?"bottom":"top");const{element:o,elementStartX:c,elementStartY:u,elementWidth:d,elementHeight:g,edge:h}=i,{style:m}=o,p=i.currentX-i.startX,f=i.currentY-i.startY,y=t.getExtremalSizePX(o,"minWidth")||n.minWidth,v=t.getExtremalSizePX(o,"maxWidth")||n.maxWidth,b=t.getExtremalSizePX(o,"minHeight")||n.minHeight,k=t.getExtremalSizePX(o,"maxHeight")||n.maxHeight,D="right"===h&&!n.isRTL||"bottom"===h?1:-1,C=d+p*D,x=g+f*D;let w=Math.max(y,C),S=Math.max(b,x);if(v>0&&(w=Math.min(w,v)),k>0&&(S=Math.min(S,k)),m.flex&&(m.flex=""),"horizontal"===n.direction&&d!==w){if(l||(m.width=Math.abs(w)+"px"),i.newWidth=w,"left"===h||w<0){const e=Math.max(Math.min(c+d-n.minWidth,c+p),0);a||t.setTranslateX(o,Math.round(e)),i.newX=e}else"right"===h&&r&&!a&&t.setTranslateX(o,c);s=!0}else"vertical"===n.direction&&g!==x&&(l||(m.height=Math.abs(S)+"px"),i.newHeight=S,"top"===h||S<0?(i.newY=Math.max(Math.min(u+g-n.minHeight,u+f),0),a||t.setTranslateY(o,i.newY)):"bottom"===h&&r&&!a&&t.setTranslateY(o,u),s=!0);return s}finishResize(e){const t=this,n=t.context,i={context:n,event:e};if(n.element.classList.remove(t.resizingCls),n.started){let e=!1;e="horizontal"===t.direction?n.newWidth&&n.newWidth!==n.elementWidth:n.newHeight&&n.newHeight!==n.elementHeight,t.trigger(e?"resize":"cancel",i),n.async||n.finalize()}else{var r;null===(r=t.reset)||void 0===r||r.call(t)}}abortResize(e=null,n=!1){const i=this,r=i.context;r.element.classList.remove(i.resizingCls),"horizontal"===i.direction?(("left"===r.edge||r.allowEdgeSwitch&&!r.skipTranslate)&&t.setTranslateX(r.element,r.elementStartX),r.element.style.width=r.elementWidth+"px"):(t.setTranslateY(r.element,r.elementStartY),r.element.style.height=r.elementHeight+"px"),!n&&i.trigger("cancel",{context:r,event:e}),i.isDestroyed||i.reset()}highlightHandle(){const e=this,t=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;e.currentElement.classList.add("b-resize-handle"),t.classList.add("b-over-resize-handle")}unHighlightHandle(){const e=this,t=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;t&&t.classList.remove("b-over-resize-handle"),e.currentElement.classList.remove("b-resize-handle"),e.currentElement=null}overAnyHandle(e,t){return this.overStartHandle(e,t)||this.overEndHandle(e,t)}overStartHandle(e,t){return"horizontal"===this.direction?this.overLeftHandle(e,t):this.overTopHandle(e,t)}overEndHandle(e,t){return"horizontal"===this.direction?this.overRightHandle(e,t):this.overBottomHandle(e,t)}getDynamicHandleSize(e,t){const n=e?2:1,{handleSize:i}=this;return this.dynamicHandleSize&&i*n>t-this.reservedSpace?Math.max(Math.floor((t-this.reservedSpace)/n),0):i}overLeftHandle(e,t){const n=this,{offsetWidth:r}=t;if(n.leftHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const l=i.from(t);return l.width=n.getDynamicHandleSize(n.rightHandle,r),l.width>0&&l.contains(a.getPagePoint(e))}return!1}overRightHandle(e,t){const n=this,{offsetWidth:r}=t;if(n.rightHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const l=i.from(t);return l.x=l.right-n.getDynamicHandleSize(n.leftHandle,r),l.width>0&&l.contains(a.getPagePoint(e))}return!1}overTopHandle(e,t){const n=this,{offsetHeight:r}=t;if(n.topHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const l=i.from(t);return l.height=n.getDynamicHandleSize(n.bottomHandle,r),l.height>0&&l.contains(a.getPagePoint(e))}return!1}overBottomHandle(e,t){const n=this,{offsetHeight:r}=t;if(n.bottomHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const l=i.from(t);return l.y=l.bottom-n.getDynamicHandleSize(n.bottomHandle,r),l.height>0&&l.contains(a.getPagePoint(e))}return!1}}o(B,"configurable",{skipUpdatingElement:null}),B._$name="ResizeHelper";class X{static getById(e){return u.getById(e)}static fromElement(e,t,n){return u.fromElement(e,t,n)}static createWidget(e={}){return e.isWidget?e:u.create(e)}static append(e,t){if(e=Array.isArray(e)&&e||[e],(t instanceof HTMLElement||"string"==typeof t)&&(t={appendTo:t}),t.insertFirst){const e="string"==typeof t.insertFirst?document.getElementById(t.insertFirst):t.insertFirst;e.firstChild?t.insertBefore=e.firstChild:t.appendTo=e}return e.map((e=>u.create(s.assign({},t||{},e))))}static openPopup(e,t){return u.create(s.assign({forElement:e},"string"==typeof t?{html:t}:t),"popup")}static showContextMenu(e,t){const n=this;return n.currentContextMenu&&n.currentContextMenu.destroy(),e instanceof HTMLElement?t.forElement=e:Array.isArray(e)?t.forElement={target:new d(...e)}:e instanceof d&&(t.forElement={target:e}),n.currentContextMenu=u.create(t,"menu"),n.currentContextMenu.ion({destroy:()=>{n.currentContextMenu=null}}),n.currentContextMenu}static attachTooltip(e,t){return u.attachTooltip(e,t)}static hasTooltipAttached(e){return u.resolveType("tooltip").hasTooltipAttached(e)}static destroyTooltipAttached(e){return u.resolveType("tooltip").destroyTooltipAttached(e)}static mask(e,t="Loading"){if(e)return e instanceof HTMLElement&&(e={target:e,text:t}),g.mask(e,e.target)}static unmask(e,t=!0){e.mask&&(t?e.mask.close():e.mask.hide())}static toast(e){return h.show(e)}}X._$name="WidgetHelper";const $=Object.prototype.hasOwnProperty;let U=null;class j{constructor(e){this.formatter=e}format(e){return this.formatter.defaultFormat(e)}parse(e,t){return this.formatter.defaultParse(e,t)}resolvedOptions(){return null}}class K{static get(e){if(null==e)return this.NULL;if(e instanceof this)return e;const t="string"==typeof e?e:JSON.stringify(e),n=this.cache;let i=n.get(t);return i||(U=t,i=new this(e),n.set(t,i)),i}static get cache(){return $.call(this,"_cache")&&this._cache||(this._cache=new Map)}static get NULL(){return $.call(this,"_null")?this._null:this._null=new this(null)}constructor(e){const t=this;if(t.cacheKey=U,U=null,t.initialize(),null===e)t.formatter=new j(t);else{t.configure(e);for(const[e,n]of Object.entries(t.resolvedOptions()))null!=n&&e in t.defaults&&(t[e]=n)}}get parser(){return e=this,t=new this.constructor.Parser(this),Object.defineProperty(e,"parser",{value:t}),t;var e,t}defaultFormat(e){return null==e?e:String(e)}defaultParse(e){return e}format(e){return null==e?e:this.formatter.format(e)}parse(e,t){return null==e?e:this.parser.parse(e,t)}parseStrict(e){return this.parse(e,!0)}resolvedOptions(){return this.formatter.resolvedOptions()}}K._$name="Formatter";const q=m.escapeRegExp,G=/[\d+-]/g,Z=(e,t)=>new Intl.NumberFormat(e||void 0,t),J=/^(?:([$])\s*)?(?:(\d+)>)?\d+(,\d+)?(?:\.((\d*)(?:#*)|[*]))?(?:\s*([%])?)?$/;class Q extends K{static get $name(){return"NumberFormat"}initialize(){this._as={},this.is={decimal:!1,currency:!1,percent:!1,null:!0,from:null}}get truncator(){const e=this.maximumFractionDigits;return null==e?null:this.as({style:"decimal",maximumFractionDigits:Math.min(20,e+1)},"truncator")}configure(e){const t=this;"string"!=typeof e?Object.assign(t,e):t.template=e;const n={},i=t.locale?p.locales[t.locale]:p.locale,r=i&&i.NumberFormat,a=t.template;if(r)for(const e in r)null==t[e]&&"function"!=typeof r[e]&&(t[e]=r[e]);if(a){const e=J.exec(a),n=e[2],i=e[4];t.useGrouping=!!e[3],t.style=e[1]?"currency":e[6]?"percent":"decimal",n&&(t.integer=+n),"*"===i?t.fraction=[0,20]:null!=i&&(t.fraction=[e[5].length,i.length])}t._minMax("fraction",!0,!0),t._minMax("integer",!0,!1),t._minMax("significant",!1,!0);for(const e in t.defaults)null!=t[e]&&(n[e]=t[e]);t.is.from=t.from&&t.from.is,t.is[t.style]=!(t.is.null=!1),t.formatter=Z(t.locale,n)}as(e,t=null){const n=this.resolvedOptions()||{template:"9.*"},i=this._as;let r=t&&i[t];return r||("string"==typeof e?n.style=e:Object.assign(n,e),n.from=this,r=new Q(n)),t&&(i[t]=r),r}defaultParse(e,t){return null==e?e:t?Number(e):parseFloat(e)}format(e){if("string"==typeof e){const t=Number(e);e=isNaN(t)?this.parse(e):t}return super.format(e)}round(e){return this.parse(this.format(e))}truncate(e){const t=this,n=t.maximumFractionDigits,{truncator:i}=t;let r,a=t.parse(e);return i&&(a=i.format(a),r=a.indexOf(i.parser.decimal),r>-1&&a.length-r-1>n&&(a=a.substr(0,r+n+1)),a=i.parse(a)),a}resolvedOptions(){const e=super.resolvedOptions();for(const t in e)void 0===e[t]&&(e[t]=this[t]);return e}_minMax(e,t,n){const i=this,r=i[e];if(null!=r){const a=m.capitalize(e),l=`maximum${a}Digits`,s=`minimum${a}Digits`;"number"==typeof r?(t&&(i[s]=r),n&&(i[l]=r)):(i[s]=r[0],i[l]=r[1])}}}Q.Parser=class{constructor(e){const t=this,n=e.locale,i=Z(n,{maximumFractionDigits:3}),r=e.is.currency?t._decodeStyle(n,{style:"currency",currency:e.currency,currencyDisplay:e.currencyDisplay}):null,a=e.is.percent?t._decodeStyle(n,{style:"percent"}):null,l=i.format(1.2).replace(G,"")[0],s=i.format(1e9).replace(G,"")[0]||"";Object.assign(t,{currency:r,decimal:l,formatter:e,grouper:s,percent:a}),t.decimal=l,t.decimalRe=q(l,"g"),t.grouper=s,t.stripRe=new RegExp(`(?:\\s+|${q(s)})`+(r?`|(?:${q(r.text)})`:"")+(a?`|(?:${q(a.text)})`:""),"g")}decimalPlaces(e){const t=(e=e.replace(this.stripRe,"")).indexOf(this.decimal)+1;return t&&e.length-t}parse(e,t){return"string"==typeof e&&(e=e.replace(this.stripRe,"").replace(this.decimalRe,".").replace("âˆ’","-"),e=t?Number(e):parseFloat(e),this.formatter.is.percent&&(e/=100)),e}_decodeStyle(e,t){const n=Z(e,t),i=Z(e,Object.assign(n.resolvedOptions(),{style:"decimal"})),r=n.format(0),a=i.format(0);return{suffix:r.startsWith(a),text:r.replace(a,"").trim()}}},Object.assign(Q.prototype,{defaults:{style:"decimal",currency:null,currencyDisplay:"symbol",locale:null,maximumFractionDigits:null,minimumFractionDigits:null,minimumIntegerDigits:null,maximumSignificantDigits:null,minimumSignificantDigits:null,useGrouping:!0},fraction:null,from:null,integer:null,significant:null,template:null}),Object.assign(Q.prototype,Q.prototype.defaults),K.number=(e,t)=>Q.format(e,t),Q._$name="NumberFormat";class ee extends(l(e)){static get configurable(){return{date:{$config:{equal:"date"},value:f.clearTime(new Date)},month:null,year:null,weekStartDay:null,hideNonWorkingDays:null,nonWorkingDays:null,sixWeeks:null}}configure(e){super.configure(e),this.updateDayNumbers(),e.date&&(this.date=e.date),this.generation=0}changeDate(e){if(!this.isConfiguring){if(e="string"==typeof e?f.parse(e,"YYYY-MM-DD"):new Date(e),isNaN(e))throw new Error("Month date ingestion must be passed a Date, or a valid YYYY-MM-DD date string");return e}}updateDate(e,t){const n=this,{dayColumnIndex:i,weekCount:r}=n,a=f.getFirstDateOfMonth(e),l=f.getLastDateOfMonth(a),s=i[a.getDay()],o=i[l.getDay()],c=!t||e.getFullYear()!==t.getFullYear(),u=!t||e.getMonth()!==t.getMonth(),d=n.eventListeners&&(t?e.getDate()!==t.getDate()|(n.getWeekId(e)!==n.getWeekId(t))<<1|u<<2|c<<3:15);if(n._year=e.getFullYear(),n._month=e.getMonth(),n.startDayOfMonth=1-s,n.endDayOfMonth=l.getDate()+(6-o),n.sixWeeks&&(n.endDayOfMonth+=7*(6-n.weekCount)),n.weekBase&&!c||n.calculateWeekBase(),(u||c)&&n.generation++,d){const i={newDate:e,oldDate:t,changes:{d:!0,w:Boolean(2&d),m:Boolean(12&d),y:Boolean(8&d),r:n.weekCount!==r}};n.trigger("dateChange",i),2&d&&n.trigger("weekChange",i),12&d&&n.trigger("monthChange",i),8&d&&n.trigger("yearChange",i)}}calculateWeekBase(){const e=this,{dayColumnIndex:t}=e,n=new Date(e.year,0,1),i=new Date(e.year,11,31),r=e.month?e.getOtherMonth(n):e;e.dayColumnIndex[n.getDay()]>3?e.weekBase=r.startDate:e.weekBase=new Date(e.year,0,r.startDayOfMonth-7);const a=Math.floor(f.diff(e.weekBase,i,"day")/7);e.has53weeks=53===a&&t[i.getDay()]>2}getWeekStart(e){if("number"==typeof e)return f.add(this.weekBase,7*Math.max(e,1),"day");const t=this,[n,i]=e;return n===t.year?t.getWeekStart(i):t.getOtherMonth(new Date(n,0,1)).getWeekStart(i)}getOtherMonth(e){const t=this,n=t===te?new ee(null):te;return n.configure({weekBase:null,weekStartDay:t.weekStartDay,nonWorkingDays:t.nonWorkingDays,hideNonWorkingDays:t.hideNonWorkingDays,sixWeeks:t.sixWeeks,date:new Date(e.getFullYear(),0,1)}),n.date=e,n.updateDate(n.date,n.date),n}changeYear(e){const t=new Date(this.date);t.setFullYear(e),this.date=t}changeMonth(e){const t=new Date(this.date);t.setMonth(e),this.date=t}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:f.weekStartDay}updateWeekStartDay(){const e=this;e.updateDayNumbers(),!e.isConfiguring&&e.date&&(e.weekBase=null,e.updateDate(e.date,e.date))}get nonWorkingDays(){return this._nonWorkingDays||f.nonWorkingDays}changeNonWorkingDays(e){return s.assign({},e)}updateNonWorkingDays(){this.updateDayNumbers()}updateHideNonWorkingDays(){this.updateDayNumbers()}updateSixWeeks(){this.isConfiguring||this.updateDate(this.date,this.date)}get dayCount(){return this.endDayOfMonth+1-this.startDayOfMonth}get weekCount(){return this.dayCount/7}get startDate(){const e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month,e.startDayOfMonth)}get endDate(){const e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month,e.endDayOfMonth)}eachDay(e){for(let t=this.startDayOfMonth;t<=this.endDayOfMonth;t++)e(new Date(this.year,this.month,t))}eachWeek(e){const t=this,{weekCount:n}=t;for(let i=t.startDayOfMonth,r=0;r<n;r++){const n=[],r=t.getWeekNumber(new Date(t.year,t.month,i));for(let e=0;e<7;e++,i++)n.push(new Date(t.year,t.month,i));e(r,n)}}getWeekNumber(e){const t=this;if((e=f.clearTime(e)).getFullYear()!==t.year)return t.getOtherMonth(new Date(e.getFullYear(),0,1)).getWeekNumber(e);let n=Math.floor(f.diff(t.weekBase,e,"day")/7),i=e.getFullYear();return n?(53!==n||t.has53weeks?n>53&&(n%=52):(n=1,i++),[i,n]):t.getOtherMonth(new Date(t.year-1,0,1)).getWeekNumber(new Date(t.year,0,0))}getWeekId(e){const t=this.getWeekNumber(e);return 100*t[0]+t[1]}getCellData(e,t,n=y.MIDNIGHT){const i=this,r=e.getDay(),a=i.visibleDayColumnIndex[r],l=i.nonWorkingDays[r],s=i.hideNonWorkingDays&&l;return(e<i.startDate||e>i.endDate)&&(i.month=e.getMonth()),{day:r,dayTime:n,visibleColumnIndex:a,isNonWorking:l,week:i.getOtherMonth(e).getWeekNumber(e),key:f.format(e,"YYYY-MM-DD"),columnIndex:i.dayColumnIndex[r],date:new Date(e),dayEnd:n.duration("s"),tomorrow:n.dayOfDate(f.add(e,1,"day")),isOtherMonth:Math.sign(e.getMonth()+12*e.getFullYear()-(t.month+12*t.year)),visible:!s&&e>=t.startDate&&e<f.add(t.endDate,1,"day"),isRowStart:0===a,isRowEnd:a===i.visibleColumnCount-1}}updateDayNumbers(){const e=this,{weekStartDay:t,nonWorkingDays:n,hideNonWorkingDays:i}=e,r=e.dayColumnIndex=[],a=e.canonicalDayNumbers=[],l=e.visibleDayColumnIndex=[];let o=0;for(let e=0;e<7;e++){const s=(t+e)%7;a[e]=s,r[s]=e,i&&n[s]||(l[s]=o++)}e.visibleColumnCount=o,e.weekLength=i?7-s.keys(n).length:7}}o(ee,"$name","Month");const te=new ee(null);ee._$name="Month";class ne extends v{static get $name(){return"CalendarPanel"}static get type(){return"calendarpanel"}static get configurable(){return{textContent:!1,date:{$config:{equal:"date"},value:null},month:{},year:null,weekStartDay:null,sixWeeks:!0,showWeekNumber:null,showWeekColumn:null,disabledDates:null,headerRenderer:null,weekRenderer:null,cellRenderer:null,disableWeekends:null,hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",nonWorkingDays:null,tip:null,dayCellCls:"b-calendar-cell",dayHeaderCls:"b-calendar-day-header",disabledCls:"b-disabled-date",otherMonthCls:"b-other-month",weekendCls:"b-weekend",todayCls:"b-today",nonWorkingDayCls:"b-nonworking-day",dayNameFormat:"ddd",minRowHeight:{$config:["lazy"],value:null},minColumnWidth:{$config:["lazy"],value:null},disableOtherMonthCells:null,disableOtherMonthCellsCls:"b-disable-othermonth-cells",hideOtherMonthCells:null,hideOtherMonthCellsCls:"b-hide-othermonth-cells",animateTimeShift:!0}}construct(e){super.construct(e),this.refreshCount||this.refresh()}onPaint({firstPaint:e}){var t;null===(t=super.onPaint)||void 0===t||t.call(this,...arguments),e&&(this.refreshCount||this.refresh(),this.getConfig("minColumnWidth"),this.getConfig("minRowHeight"))}get overflowElement(){return this.weeksElement}doDestroy(){var e;null===(e=this.tip)||void 0===e||e.destroy(),super.doDestroy()}changeMinRowHeight(e){const n=parseInt(t.getStyleValue(this.element,"--min-row-height"),10)||75;return isNaN(e)?e:Math.max(parseInt(e)||0,n)}updateMinRowHeight(e){this.weekElements.forEach((n=>t.setLength(n,"minHeight",e))),this.scrollable={overflowY:!!e&&"auto"}}changeMinColumnWidth(e){const n=parseInt(t.getStyleValue(this.element,"--min-column-width"),10)||75;return null==e?e:Math.max(parseInt(e)||0,n)}updateMinColumnWidth(e){const n=this;n.weekdayCells.forEach((n=>t.setLength(n,"minWidth",e))),n.cellElements.forEach((i=>i.matches(`.${n.dayCellCls}`)&&t.setLength(i,"minWidth",e))),n.scrollable={overflowX:!!e&&"auto"},n.overflowElement.classList[e?"add":"remove"]("b-min-columnwidth")}getDateFromDomEvent(e){const t=(e.nodeType===Element.ELEMENT_NODE?e:e.target).closest(`#${this.id} [data-date]`);if(t)return f.parseKey(t.dataset.date)}changeTip(e,t){const n=this;return b.reconfigure(t,e,{owner:n,defaults:{type:"tooltip",owner:n,id:`${n.id}-cell-tip`,forElement:n.bodyElement,forSelector:`.${n.dayCellCls}`}})}updateTip(e){this.detachListeners("tip"),null==e||e.ion({pointerOver:"onTipOverCell",name:"tip",thisObj:this})}updateElement(e,t){const n=this;super.updateElement(e,t),n.updateHideNonWorkingDays(n.hideNonWorkingDays),n.weekdayCells=Array.from(e.querySelectorAll(".b-calendar-day-header")),n.weekElements=Array.from(e.querySelectorAll(".b-calendar-week")),n.weekDayElements=Array.from(e.querySelectorAll(".b-calendar-days")),n.cellElements=[];for(let e=0,{length:t}=n.weekDayElements;e<t;e++)n.cellElements.push(n.weekDayElements[e].previousSibling,...n.weekDayElements[e].children)}changeDate(e){if(e="string"==typeof e?f.parse(e):new Date(e),isNaN(e))throw new Error("CalendarPanel date ingestion must be passed a Date, or a YYYY-MM-DD date string");return f.clearTime(e)}updateDate(e){this.month.date=e}updateDayNameFormat(){const e=new Date("2000-06-04T12:00:00");this.shortDayNames=[];for(let t=4;t<11;t++)e.setDate(t),this.shortDayNames.push(f.format(e,this.dayNameFormat))}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:f.weekStartDay}updateWeekStartDay(e){const t=this;if(t._month){t.month.weekStartDay=e,t.dayNames=[];for(let e=0;e<7;e++)t.dayNames[e]=t.shortDayNames[t.canonicalDayNumbers[e]];t.refreshCount&&t.refresh()}}updateHideNonWorkingDays(e){var t;this.contentElement.classList.toggle(this.hideNonWorkingDaysCls,Boolean(e)),null===(t=this.scrollable)||void 0===t||t.syncOverflowState(),this._month&&(this.month.hideNonWorkingDays=e),this.isConfiguring||this.refresh()}updateHideOtherMonthCells(e){var t;this.element.classList.toggle(this.hideOtherMonthCellsCls,Boolean(e)),null===(t=this.scrollable)||void 0===t||t.syncOverflowState()}updateDisableOtherMonthCells(e){var t;this.element.classList.toggle(this.disableOtherMonthCellsCls,Boolean(e)),null===(t=this.scrollable)||void 0===t||t.syncOverflowState()}get nonWorkingDays(){return this._nonWorkingDays||this._localeNonWorkingDays||(this._localeNonWorkingDays=f.nonWorkingDays)}get weekends(){return this._localeWeekends||(this._localeWeekends=f.weekends)}changeNonWorkingDays(e){return s.assign({},e)}updateNonWorkingDays(e){var t;this._month&&(this.month.nonWorkingDays=e,this.refresh(),null===(t=this.scrollable)||void 0===t||t.syncOverflowState())}get visibleDayColumnIndex(){return this.month.visibleDayColumnIndex}get dayColumnIndex(){return this.month.dayColumnIndex}get canonicalDayNumbers(){return this.month.canonicalDayNumbers}get visibleColumnCount(){return this.month.visibleColumnCount}get weekLength(){return this.month.weekLength}get startDate(){return this.month.startDate}get duration(){return f.diff(this.month.startDate,this.month.endDate,"day")+1}get endDate(){const{endDate:e}=this.month;if(e)return f.add(e,1,"day")}changeMonth(e,t){const n=this;if(!(e instanceof ee)){if("number"==typeof e){if(t)return void(t.month=e);const i=n.date||f.clearTime(new Date);i.setMonth(e),e={date:i}}e=ee.new({weekStartDay:n.weekStartDay,nonWorkingDays:n.nonWorkingDays,hideNonWorkingDays:n.hideNonWorkingDays,sixWeeks:n.sixWeeks},e)}return e.ion({dateChange:"onMonthDateChange",thisObj:n}),e}onMonthDateChange({source:e,newDate:n,oldDate:i,changes:r}){const a=this;a.year=e.year,a.isConfiguring||((!a.getCell(n)||r.m||r.y)&&(a.refresh(),a.animateTimeShift&&a.isVisible&&t.slideIn(a.contentElement,n>i?1:-1)),a.trigger("dateChange",{changes:r,value:n,oldValue:i}))}updateYear(e){this.month.year=e}updateShowWeekNumber(e){this.updateShowWeekColumn(e)}updateShowWeekColumn(e){const t=this;t.element.classList[e?"add":"remove"]("b-show-week-column"),t.floating&&(t.isAligning||t.realign())}updateSixWeeks(e){this.month&&(this.month.sixWeeks=e,this.refresh())}refresh(){this.doRefresh()}doRefresh(){var e;this.getConfig("element");const n=this,i=null!=n.timeZone?n.timeZone:null===(e=n.project)||void 0===e?void 0:e.timeZone,r=null!=i?k.toTimeZone(new Date,i):new Date,{weekElements:a,weekDayElements:l,date:s,month:o,dayCellCls:c,dayHeaderCls:u,disabledCls:d,otherMonthCls:g,weekendCls:h,todayCls:m,nonWorkingDayCls:p,nonWorkingDays:y,canonicalDayNumbers:v,sixWeeks:b}=n;if(r.setHours(0,0,0,0),!s)return void(n.date=r);n.trigger("beforeRefresh"),n.getConfig("dayNameFormat");for(let e=0;e<7;e++){const i=n.weekdayCells[e],r=n.canonicalDayNumbers[e],a={[u]:1,[h]:f.weekends[r],[p]:y[r]};n.headerRenderer?(i.innerHTML="",n.callback(n.headerRenderer,n,[i,e,r])):t.setInnerText(i,n.shortDayNames[r]),t.syncClassList(i,a),i.dataset.columnIndex=e,i.dataset.cellDay=r}let D=0,C=0,x=6;for(let e=6;e>=0;e--)if(!y[v[e]]){x=e;break}a[4].classList.toggle("b-hide-display",o.weekCount<5&&!b),a[5].classList.toggle("b-hide-display",o.weekCount<6&&!b),o.eachWeek(((e,i)=>{const s=l[D],u=[s.previousSibling,...s.children];a[D].dataset.week=`${e[0]},${e[1]}`,n.weekRenderer?n.callback(n.weekRenderer,n,[u[0],e]):u[0].innerText=e[1];for(let l=0;l<7;l++){const s=i[l],v=s.getDay(),b=y[v],k=u[l+1],w={[c]:1,[d]:n.isDisabledDate(s),[g]:s.getMonth()!==o.month,[h]:f.weekends[v],[m]:s.getTime()===r.getTime(),[p]:b,"b-last-working-day":l===x,"b-first-visible-cell":!(s-(n.firstVisibleDate||-1)),"b-last-visible-cell":!(s-(n.lastVisibleDate||-1)),[`b-day-of-week-${v}`]:1};t.syncClassList(k,w),k.dataset.date=f.makeKey(s),k.dataset.cellIndex=C,k.dataset.columnIndex=l,k.lastDomConfig&&(delete k.lastDomConfig.class,delete k.lastDomConfig.className),n.cellRenderer?n.callback(n.cellRenderer,n,[{cell:k,date:s,day:v,row:a[D],rowIndex:D,cellIndex:C,columnIndex:l,visibleColumnIndex:n.visibleDayColumnIndex[v],week:e}]):k.innerHTML=s.getDate(),C++}D++})),n.visibleWeekCount=D,n.floating&&(n.isAligning||n.realign()),n.refreshCount=(n.refreshCount||0)+1,n.trigger("refresh")}isDisabledDate(e){const t=e.getDay(),{disabledDates:n,nonWorkingDays:i}=this;return!(!this.disableWeekends||!i[t])||(n?Array.isArray(n)?(e=f.clearTime(e,!0),n.some((t=>!(f.clearTime(t,!0)-e)))):this.callback(this.disabledDates,this,[e]):void 0)}get bodyConfig(){const e=super.bodyConfig,n=[];e.children=[{tag:"div",className:"b-calendar-row b-calendar-weekdays",reference:"weekdaysHeader",children:[{class:"b-week-number-cell"},...D.fill(7,{class:this.dayHeaderCls}),t.scrollBarPadElement]},{className:"b-weeks-container notranslate",reference:"weeksElement",children:n}];for(let e=0;e<6;e++){const t={className:"b-calendar-row b-calendar-week",dataset:{rowIndex:e},children:[{className:"b-week-number-cell"},{className:"b-calendar-days",children:[{},{},{},{},{},{},{}],syncOptions:{ignoreRefs:!0,strict:!1}}]};n.push(t)}return e}get firstVisibleDate(){if(this.hideOtherMonthCells){const{year:e,month:t}=this.month;return new Date(e,t,1)}for(const e=this,t=e.month.startDate;;t.setDate(t.getDate()+1))if(!e.hideNonWorkingDays||!e.nonWorkingDays[t.getDay()])return t}get lastVisibleDate(){const e=f.add(this.endDate,-1,"d");if(this.hideOtherMonthCells)return e;for(const t=this,n=e;;n.setDate(n.getDate()-1))if(!t.hideNonWorkingDays||!t.nonWorkingDays[n.getDay()])return n}getCell(e,t){"string"!=typeof e&&(e=f.makeKey(e));const n=this.weeksElement.querySelector(`[data-date="${e}"]`);if(n&&(!t||!n.classList.contains(this.otherMonthCls)))return n}onTipOverCell({source:e,target:t}){e.date=f.parseKey(t.dataset.date)}updateLocalization(){this._localeNonWorkingDays=this._localeWeekends=null,this.updateDayNameFormat(),this.updateWeekStartDay(this.weekStartDay),super.updateLocalization()}}ne.initClass(),ne._$name="CalendarPanel";const ie=e=>!e.value;class re extends C{static get $name(){return"Checkbox"}static get type(){return"checkbox"}static get alias(){return"check"}static get configurable(){return{inputType:"checkbox",autoCollapse:null,containerDefaults:{syncableConfigs:{disabled:e=>e.disabled||!e.value},syncConfigTriggers:{autoCollapse:1,value:1}},text:"",checkedValue:!0,uncheckedValue:!1,color:null,value:"",toggleGroup:null,localizableProperties:["label","text"]}}construct(e){"checked"in e&&((e=s.assign({},e)).value=e.checked,delete e.checked),super.construct(e),this.syncHasText()}get textLabelCls(){return"b-checkbox-label"}get innerElements(){return[this.inputElement,{tag:"label",class:this.textLabelCls,for:`${this.id}-input`,reference:"textLabel",html:this.text||""}]}get inputElement(){const e=super.inputElement;return this.toggleGroup&&(e.dataset={group:this.toggleGroup}),e.listeners={click:"internalOnClick",change:"internalOnChange",input:"internalOnInput"},e}get checked(){return this.value}set checked(e){this.value=e}syncHasText(){this.element.classList[this.text?"add":"remove"]("b-text")}updateText(e){this.textLabel&&(this.syncHasText(),this.textLabel.innerHTML=e)}afterSyncChildConfigs(e){super.afterSyncChildConfigs(e);let{autoCollapse:t}=this;t&&(t=!0===t?ie:t,e.collapsed=t(this))}assignFieldValue(e,t,n){this.value=n===this.checkedValue||n!==this.uncheckedValue&&null}fetchInputValue(){this.readOnly||(this.value=this.input.checked)}gatherValue(e){var t;const n=this,i=n.value?n.checkedValue:n.uncheckedValue,r=void 0!==i,{valueName:a}=n;r&&(e[a]=i),n.gatherValues(e,r),!0===i&&(null===(t=e[a])||void 0===t?void 0:t.value)===i&&delete e[a].value}changeValue(e){return"false"!==e&&Boolean(e)}updateValue(e){var t;const n=this,i=n.input.checked!==e;n.input.checked=e,null===(t=n.container)||void 0===t||t.syncChildConfigs(),!i||n.inputting||n.isConfiguring||(n.uncheckToggleGroupMembers(),n.triggerChange(!1))}get inputValueAttr(){return"checked"}updateColor(e,t){const n=this.element.classList;t&&n.remove(t),e&&n.add(e)}getToggleGroupMembers(){const e=this,{checked:n,toggleGroup:i,input:r,type:a}=e,l=[];return n&&i&&t.forEachSelector(e.rootElement,`input[type=${a}][data-group=${i}]`,(e=>{if(e!==r){const t=u.fromElement(e);t&&l.push(t)}})),l}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach((e=>e.checked=!1))}check(){this.checked=!0}uncheck(){this.checked=!1}toggle(){this.checked=!this.checked}internalOnClick(e){return this.readOnly?(e.preventDefault(),!1):this.trigger("click",{event:e})}internalOnChange(e){const t=this;t.readOnly&&t.value!==t.input.checked?t.input.checked=t.value:(t.value=t.input.checked,t.inputting||(t.inputting=!0,t.triggerChange(!0),t.inputting=!1))}updateInputReadOnly(e){}triggerChange(e){const t=this,{checked:n}=t.input,i={checked:n,value:n,userAction:e,valid:!0};if(!(!n&&e&&t.toggleGroup&&t.getToggleGroupMembers().filter((e=>e.isVisible&&!e.disabled)).length||!1===t.trigger("beforeChange",i)))return t.triggerFieldChange(i,!1),e&&t.uncheckToggleGroupMembers(),t.trigger("action",i),t.trigger("change",i),!0;t.input.checked=t._value=!n}}re.initClass(),re._$name="Checkbox";class ae extends v{construct(e){super.construct(x({year:(new Date).getFullYear()},e)),a.on({element:this.contentElement,click:"onYearClick",delegate:".b-yearpicker-year",thisObj:this})}get focusElement(){return this.getYearButton(this.year)||this.getYearButton(this.startYear)}getYearButton(e){return this.contentElement.querySelector(`.b-yearpicker-year[data-year="${e}"]`)}get value(){return this.year}set value(e){this.year=e}onYearClick({target:e}){const t=Math.min(Math.max(parseInt(e.innerText),this.minYear||1),this.maxYear||9999);this.year===t?this.trigger("select",{oldValue:t,value:t}):this.year=t}handleTitleClick(e){this.trigger("titleClick",e)}previous(){this.startYear=this.startYear-this.yearButtonCount}next(){this.startYear=this.endYear+1}ingestYear(e){if(!isNaN(e))return s.isDate(e)?e.getFullYear():e}changeYear(e){if(e=this.ingestYear(e))return Math.min(Math.max(e,this.minYear||1),this.maxYear||9999)}updateYear(e,t){const n=this;!n.startYear||e>n.endYear?n.startYear=e:e<n.startYear&&(n.startYear=e-(n.yearButtonCount-1)),n.isConfiguring||n.trigger("select",{oldValue:t,value:e})}get endYear(){return this.startYear+this.yearButtonCount-1}changeStartYear(e){if(e=this.ingestYear(e))return e=this.minYear?Math.max(e,this.minYear):e,this.maxYear?Math.min(e,this.maxYear-(this.yearButtonCount-1)):e}async updateStartYear(e,n){this.isVisible&&t.slideIn(this.contentElement,Math.sign(e-n))}composeBody(){this.getConfig("year");const{startYear:e}=this,t=super.composeBody(),n=t.children[this.tbar?1:0].children=[];this.widgetMap.title.text=`${`000${e}`.slice(-4)} - ${`000${this.endYear}`.slice(-4)}`;for(let t=0,i=e;t<this.yearButtonCount;t++,i++)n.push({tag:"button",dataset:{year:i},class:{"b-yearpicker-year":1,"b-selected":i===this.year},text:`000${i}`.slice(-4)});return t}}o(ae,"$name","YearPicker"),o(ae,"type","yearpicker"),o(ae,"configurable",{textContent:!1,tbar:{overflow:null,items:{previous:{type:"tool",cls:"b-icon b-icon-previous",onAction:"up.previous",weight:100},title:{type:"button",cls:"b-yearpicker-title",weight:200,onAction:"up.handleTitleClick"},next:{type:"tool",cls:"b-icon b-icon-next",onAction:"up.next",weight:300}}},itemCls:"b-year-container",yearButtonCount:12,year:null,minYear:null,maxYear:null,startYear:null}),ae.initClass(),ae._$name="YearPicker";class le extends w{static get $name(){return"DisplayField"}static get type(){return"displayfield"}static get alias(){return"display"}static get configurable(){return{readOnly:!0,editable:!1,cls:"b-display-field",template:null,ariaElement:"displayElement"}}get focusElement(){}changeReadOnly(){return!0}changeEditable(){return!1}get inputElement(){return{tag:"span",id:`${this.id}-input`,reference:"displayElement",html:this.template?this.template(this.value):m.encodeHtml(this.value)}}}le.initClass(),le._$name="DisplayField";const se=()=>f.getMonthNames().map(((e,t)=>[t,e])),oe=(e,t)=>e.valueOf()-t.valueOf(),ce=Object.freeze([]);(class extends S{static get $name(){return"ReadOnlyCombo"}static get type(){return"readonlycombo"}static get configurable(){return{editable:!1,inputAttributes:{tag:"div",tabIndex:-1},inputValueAttr:"innerHTML",highlightExternalChange:!1,monitorResize:!1,triggers:{expand:!1},picker:{align:{align:"t-b",axisLock:!0,matchSize:!1},cls:"b-readonly-combo-list",scrollable:{overflowX:!1}}}}}).initClass();class ue extends ne{static get $name(){return"DatePicker"}static get type(){return"datepicker"}static get delayable(){return{refresh:"raf"}}static get configurable(){return{activeDate:{value:new Date,$config:{equal:"date"}},focusable:!0,textContent:!1,tbar:{overflow:null,items:{prevYear:{cls:"b-icon b-icon-first",onAction:"up.gotoPrevYear",tooltip:"L{DatePicker.gotoPrevYear}"},prevMonth:{cls:"b-icon b-icon-previous",onAction:"up.gotoPrevMonth",tooltip:"L{DatePicker.gotoPrevMonth}"},fields:{type:"container",cls:"b-datepicker-title",items:{monthField:{type:"readonlycombo",cls:"b-datepicker-monthfield",items:se(),internalListeners:{select:"up.onMonthPicked"}},yearButton:{type:"button",cls:"b-datepicker-yearbutton",internalListeners:{click:"up.onYearPickerRequested"}}}},nextMonth:{cls:"b-icon b-icon-next",onAction:"up.gotoNextMonth",tooltip:"L{DatePicker.gotoNextMonth}"},nextYear:{cls:"b-icon b-icon-last",onAction:"up.gotoNextYear",tooltip:"L{DatePicker.gotoNextYear}"}}},yearPicker:{value:{type:"YearPicker",yearButtonCount:16,trapFocus:!0,positioned:!0,hidden:!0,internalListeners:{titleClick:"up.onYearPickerTitleClick",select:"up.onYearPicked"}},$config:"lazy"},date:null,minDate:{value:null,$config:{equal:"date"}},maxDate:{value:null,$config:{equal:"date"}},focusDisabledDates:null,multiSelect:!1,selection:{$config:{equal:(e,t)=>e&&e.equals(t)},value:null},editMonth:!0,dayNameFormat:"dd",trapFocus:!0,role:"grid",focusDescendant:!0,alwaysRefreshOnMonthChange:null}}static get prototypeProperties(){return{outOfRangeCls:"b-out-of-range",activeCls:"b-active-date",selectedCls:"b-selected-date"}}construct(e){const t=this;super.construct(e),t.externalCellRenderer=t.cellRenderer,t.cellRenderer=t.internalCellRenderer,t.element.setAttribute("aria-activedescendant",`${t.id}-active-day`),t.weeksElement.setAttribute("role","grid"),t.weekElements.forEach((e=>e.setAttribute("role","row"))),t.element.setAttribute("ariaLabelledBy",t.widgetMap.fields.id),a.on({element:t.weeksElement,click:{handler:"onCellClick",delegate:`.${t.dayCellCls}:not(.${t.disabledCls}):not(.${t.outOfRangeCls})`},mousedown:{handler:"onCellMousedown",delegate:`.${t.dayCellCls}`},thisObj:t}),t.widgetMap.monthField.readOnly=t.widgetMap.yearButton.disabled=!t.editMonth,t.refresh.flush()}afterHide(){var e;null===(e=this._yearPicker)||void 0===e||e.hide(),super.afterHide(...arguments)}doDestroy(){var e,t;null===(e=this.yearButton)||void 0===e||e.destroy(),null===(t=this.monthField)||void 0===t||t.destroy(),super.doDestroy()}get focusElement(){return this.weeksElement.querySelector(`.${this.dayCellCls}[tabIndex="0"]`)}doRefresh(){const e=this,t=e.focusElement,n=f.betweenLesser(e.activeDate,e.month.startDate,e.month.endDate)?e.activeDate:e._activeDate=e.date;super.doRefresh(...arguments);const i=f.parseKey(null==t?void 0:t.dataset.date);n-i&&e.syncActiveDate(n,i)}internalCellRenderer({cell:e,date:n}){const i=this,{activeCls:r,selectedCls:a,externalCellRenderer:l}=i,s=i.isSelectedDate(n),o={[r]:r&&i.isActiveDate(n),[a]:s,[i.outOfRangeCls]:i.minDate&&n<i.minDate||i.maxDate&&n>i.maxDate};if(s&&i.multiSelect){const e=!i.isSelectedDate(f.add(n,-1,"d")),t=!i.isSelectedDate(f.add(n,1,"d"));o["b-range-start"]=e,o["b-range-end"]=t,o["b-in-range"]=!e&&!t}t.updateClassList(e,o),e.innerHTML=`<div class="b-datepicker-cell-inner">${n.getDate()}</div>`,e.setAttribute("role","gridcell"),e.setAttribute("aria-label",f.format(n,"MMMM D, YYYY")),i.isActiveDate(n)?e.id=`${i.id}-active-day`:e.removeAttribute("id"),l&&(arguments[0].cell=e.firstChild,i.callback(l,this,arguments))}onCellMousedown(e){const t=e.target.closest("[data-date]");e.preventDefault(),t.focus(),this.activeDate=f.parseKey(t.dataset.date)}onCellClick(e){const t=e.target.closest("[data-date]");this.onUIDateSelect(f.parseKey(t.dataset.date),e)}onMonthDateChange({newDate:e,changes:t}){this.getConfig("tbar"),super.onMonthDateChange(...arguments),(t.m||t.y)&&(this.widgetMap.monthField.value=e.getMonth(),this.widgetMap.yearButton.text=e.getFullYear())}onUIDateSelect(e,t){const n=this,{lastClickedDate:i,multiSelect:r}=n;n.lastClickedDate=e,n.isDisabledDate(e)||(n.activatingEvent=t,r?n.handleMultiSelect(i,e,t):(n.selection=e,n.floating&&n.hide()),n.activatingEvent=null)}handleMultiSelect(e,t,n){const i=this,{multiSelect:r,_selection:a}=i,l=a.dates,s="range"===r,{size:o,generation:c}=a,u=o&&{[f.makeKey(f.add(l[0],-1,"d"))]:1,[f.makeKey(l[0])]:1,[f.makeKey(l[l.length-1])]:1,[f.makeKey(f.add(l[l.length-1],1,"d"))]:1},d=a.has(t)?"delete":"add",g=s&&(null==u?void 0:u[f.makeKey(t)]);if(n.ctrlKey)!0!==r&&o&&!g||(a[d](t),s&&!a.has(i.rangeStartDate)&&i.rangeStartDate.setDate(i.rangeStartDate.getDate()+(t<l[1]?1:-1)));else if(n.shiftKey&&o){const[n,r]=[new Date(s?i.rangeStartDate||(i.rangeStartDate=l[0]):e),t].sort(oe);s&&a.clear();for(const e=n;e<=r;e.setDate(e.getDate()+1))a.add(e)}else a.has(t)&&1===a.size||(a.clear(),a.add(t));const h=a.size;1===h?i.rangeStartDate=t:h||(i.rangeStartDate=null),a.generation!==c&&i.updateSelection(a)}changeSelection(e){const t=this;let n,i;if(e)if(e.forEach||(e=[e]),e.forEach(((n,i)=>e[i]=t.changeDate(n))),i=e[0],e.sort(oe),"range"===t.multiSelect&&2===e.length){n=new de;for(const t=new Date(e[0]);t<=e[1];t.setDate(t.getDate()+1))n.add(t)}else i=e[0],n=new de(e);else n=new de;return i&&(t.activeDate=t.rangeStartDate=f.clearTime(i)),n}updateSelection(e){const t=this,{dates:n}=e,i="range"===t.multiSelect?[n[0],n[n.length-1]]:n;n.length&&(t.date=n[0]),t.isConfiguring||(t.refresh.now(),t.trigger("selectionChange",{selection:i,userAction:Boolean(t.activatingEvent)}))}get selection(){const{_selection:e}=this,t=e?e.dates:ce;return"range"===this.multiSelect&&t.length?[t[0],t[t.length-1]]:t}onInternalKeyDown(e){const t=this,n=e.key.trim()||e.code,i=t.activeDate;let r=new Date(i);if("Escape"===n&&t.floating)return t.hide();if(i&&t.weeksElement.contains(e.target)){do{switch(n){case"ArrowLeft":e.preventDefault(),e.ctrlKey?r=t.gotoPrevMonth():r.setDate(r.getDate()-1);break;case"ArrowUp":e.preventDefault(),r.setDate(r.getDate()-7);break;case"ArrowRight":e.preventDefault(),e.ctrlKey?r=t.gotoNextMonth():r.setDate(r.getDate()+1);break;case"ArrowDown":e.preventDefault(),r.setDate(r.getDate()+7);break;case"Enter":return t.onUIDateSelect(i,e)}}while(t.isDisabledDate(r)&&!t.focusDisabledDates);if(t.minDate&&r<t.minDate)return;if(t.maxDate&&r>t.maxDate)return;t.activeDate=r}}changeMinDate(e){return e&&ne.prototype.changeDate.apply(this,arguments)}updateMinDate(e){this._yearpicker&&(this._yearpicker.minYear=null==e?void 0:e.getFullYear()),this.refresh()}changeMaxDate(e){return e&&ne.prototype.changeDate.apply(this,arguments)}updateMaxDate(e){this._yearpicker&&(this._yearpicker.maxYear=null==e?void 0:e.getFullYear()),this.refresh()}changeDate(e){return f.clamp(super.changeDate(e),this.minDate,this.maxDate)}updateDate(e){const t=this;t.isConfiguring&&!t.initializingActiveDate&&(t.selection=e),t.month.date&&e.getMonth()!==t.month.month&&t.getCell(e)&&!t.alwaysRefreshOnMonthChange&&!t.isNavigating||super.updateDate(e)}changeActiveDate(e,t){if(!1!==this.trigger("beforeActiveDateChange",{activeDate:e,oldActiveDate:t})){if(e=e?this.changeDate(e):this.date||(this.date=f.clearTime(new Date)),isNaN(e))throw new Error("DatePicker date ingestion must be passed a Date, or a YYYY-MM-DD date string");return f.clamp(e,this.minDate,this.maxDate)}}updateActiveDate(e,t){const n=this,{isConfiguring:i}=n;!i&&n.getCell(e)||(n.initializingActiveDate=i,n.date=e,n.initializingActiveDate=!1),i||n.refresh.isPending||n.syncActiveDate(e,t)}syncActiveDate(e,n){const i=this,{activeCls:r}=i,a=i.getCell(e),l=n&&i.getCell(n),s=t.getActiveElement(i.element);a.setAttribute("tabIndex",0),r&&a.classList.add(r),a.id=`${i.id}-active-day`,i.weeksElement.contains(s)&&a.focus(),l&&l!==a&&(l.removeAttribute("tabIndex"),r&&l.classList.remove(r),l.removeAttribute("id"))}set value(e){const t=this;e?void 0!==(e=t.changeDate(e,t.value))&&(t.selection=e):(t.date=new Date,t.selection=null)}get value(){return this.selection[this.selection.length-1]}gotoPrevYear(){return this.goto(-1,"year")}gotoPrevMonth(){return this.goto(-1,"month")}gotoNextMonth(){return this.goto(1,"month")}gotoNextYear(){return this.goto(1,"year")}goto(e,t){const n=this,{activeDate:i}=n,r=i&&n.getCell(i);let a;a="month"===t&&r&&(null==i?void 0:i.getMonth())===n.month.month+e?i:f.add(r?i:n.date,e,t);const l=new Date(a);l.setDate(1);const s=f.add(f.add(l,1,"month"),-1,"day");if(n.minDate&&e<0&&s<n.minDate||n.maxDate&&e>0&&l>n.maxDate)return;n.isNavigating=!0;const o=n.date=a;return r&&(n.activeDate=a),n.isNavigating=!1,o}isActiveDate(e){return!(e-this.activeDate)}isSelectedDate(e){var t;return null===(t=this._selection)||void 0===t?void 0:t.has(e)}onMonthPicked({record:e,userAction:t}){var n;t&&(this.activeDate=f.add(this.activeDate,e.value-this.activeDate.getMonth(),"month"),null===(n=this.focusElement)||void 0===n||n.focus())}onYearPickerRequested(){const{yearPicker:e}=this;e.isVisible?e.hide():(e.year=e.startYear=this.activeDate.getFullYear(),e.show(),e.focus())}onYearPickerTitleClick(){this.yearPicker.hide()}onYearPicked({value:e,source:n}){const i=new Date(this.activeDate);i.setFullYear(e),this.activeDate=i,this.focusElement&&t.focusWithoutScrolling(this.focusElement),n.hide()}changeYearPicker(e,t){var n,i;return ae.reconfigure(t,e?ae.mergeConfigs({owner:this,appendTo:this.element,minYear:null===(n=this.minDate)||void 0===n?void 0:n.getFullYear(),maxYear:null===(i=this.maxDate)||void 0===i?void 0:i.getFullYear()},e):null,this)}get childItems(){const{_yearPicker:e}=this,t=super.childItems;return e&&t.push(e),t}updateLocalization(){const{monthField:e}=this.widgetMap,t=se();this.isConfiguring||t.every(((t,n)=>t[1]===e.store.getAt(n).text))||(t[e.value].selected=!0,e.items=t),super.updateLocalization()}}class de extends Set{add(e){return e=f.makeKey(e),this.has(e)||(this.generation=(this.generation||0)+1),super.add(e)}delete(e){return e=f.makeKey(e),this.has(e)&&this.generation++,super.delete(e)}has(e){return super.has(f.makeKey(e))}clear(){return this.size&&this.generation++,super.clear()}equals(e){return Array.isArray(e)&&(e=new de(e)),e.size===this.size&&[...this].every((t=>e.has(t)))}get dates(){return[...this].sort().map((e=>f.parseKey(e)))}}ue.initClass(),ue._$name="DatePicker";class ge extends M{static get $name(){return"DateField"}static get type(){return"datefield"}static get alias(){return"date"}static get configurable(){return{format:"L",strictParsing:!1,fallbackFormat:"YYYY-MM-DD",timeFormat:"HH:mm:ss:SSS",keepTime:!1,pickerFormat:null,validateDateOnly:null,triggers:{expand:{cls:"b-icon-calendar",handler:"onTriggerClick",weight:200},back:{cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick",align:"start",weight:100},forward:{cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick",align:"end",weight:100}},calendarContainerCls:"",min:null,max:null,step:!1,stepTriggers:null,weekStartDay:null,picker:{type:"datepicker",role:"dialog",floating:!0,scrollAction:"realign",align:{align:"t0-b0",axisLock:!0}},value:null}}changePicker(e,t){const n=this,i={owner:n,forElement:n[n.pickerAlignElement],minDate:n.min,maxDate:n.max,weekStartDay:n._weekStartDay,align:{anchor:n.overlayAnchor,target:n[n.pickerAlignElement]},onSelectionChange:({selection:e,source:t})=>{t.isVisible&&(n._isUserAction=n._isPickerInput=!0,n.value=e[0],n._isPickerInput=n._isUserAction=!1,t.hide())}};n.calendarContainerCls&&(i.cls=n.calendarContainerCls),n.value?i.value=n.value:i.activeDate=new Date;const r=ue.reconfigure(t,e,{owner:n,defaults:i});return null==r||r.refresh.flush(),r}get backShiftDate(){return f.add(this.value,-1*this._step.magnitude,this._step.unit)}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const n=e.backShiftDate;(!t||t.getTime()<=n)&&(e._isUserAction=!0,e.value=n,e._isUserAction=!1)}}get forwardShiftDate(){return f.add(this.value,this._step.magnitude,this._step.unit)}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const n=e.forwardShiftDate;(!t||t.getTime()>=n)&&(e._isUserAction=!0,e.value=n,e._isUserAction=!1)}}showPicker(e){if(this.readOnly)return;const t=this,{_picker:n}=t;if(n){const e={minDate:t.min,maxDate:t.max};t.value?e.value=t.value:e.activeDate=new Date,n.setConfig(e)}super.showPicker(e)}focusPicker(){this.picker.focus()}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let t=e.value;if(t){const{min:n,max:i,validateDateOnly:r}=e;if(r&&(t=f.clearTime(t,!1)),n&&t<n)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(i&&t>i)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}transformDateValue(e){const t=this;return null!=e&&(f.isDate(e)||(e="string"==typeof e?f.parse(e,t.format,t.strictParsing)||f.parse(e,t.fallbackFormat,t.strictParsing):new Date(e)),f.isValidDate(e))?(!t.min||e-t.min>-f.MS_PER_DAY)&&(!t.max||e<=t.max)?t.transformTimeValue(e):e:null}transformTimeValue(e){const t=this,{keepTime:n}=t;if(e=f.clone(e),n)if("entered"!==n){const i=f.parse(n,t.timeFormat);f.isValidDate(i)?f.copyTimeValues(e,i):f.isValidDate(t.value)&&f.copyTimeValues(e,t.value)}else t._isPickerInput&&f.isValidDate(t.value)&&f.copyTimeValues(e,t.value);else f.clearTime(e,!1);return e}changeMin(e){return this.transformDateValue(e)}updateMin(e){const{input:t,_picker:n}=this;t&&(null==e?t.removeAttribute("min"):t.min=e),n&&(n.minDate=e),this.syncInvalid()}changeMax(e){return this.transformDateValue(e)}updateMax(e){const{input:t,_picker:n}=this;t&&(null==e?t.removeAttribute("max"):t.max=e),n&&(n.maxDate=e),this.syncInvalid()}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:f.weekStartDay}updateWeekStartDay(e){this._picker&&(this._picker.weekStartDay=e)}changeValue(e,t){const n=this,i=n.transformDateValue(e);if(!e||i){if(n.clearError("L{invalidDate}"),n.hasChanged(t,i))return super.changeValue(i,t);n.inputting||n.syncInputFieldValue()}else n.setError("L{invalidDate}")}updateValue(e,t){const n=this._picker;n&&!this.inputting&&(n.value=e),super.updateValue(e,t)}changeStep(e,t){const n=typeof e;return e?("number"===n?e={magnitude:Math.abs(e),unit:t?t.unit:"day"}:"string"===n&&(e=f.parseDuration(e)),e&&e.unit&&e.magnitude?(e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e):void 0):null}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}hasChanged(e,t){return null!=e&&e.getTime&&null!=t&&t.getTime&&"entered"!==this.keepTime?!f.isEqual(f.clearTime(e),f.clearTime(t)):super.hasChanged(e&&e.getTime(),t&&t.getTime())}get inputValue(){const e=this.value;return e?f.format(e,this.format):""}updateFormat(){this.isConfiguring||this.syncInputFieldValue(!0)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}internalOnKeyEvent(e){super.internalOnKeyEvent(e),"Enter"===e.key&&this.isValid&&this.picker.hide()}}ge.initClass(),ge._$name="DateField";class he extends C{static get $name(){return"NumberField"}static get type(){return"numberfield"}static get alias(){return"number"}static get configurable(){return{min:null,max:null,step:1,largeStep:0,value:null,format:"",decimalPrecision:null,leadingZeroes:null,triggers:{spin:{type:"spintrigger"}},changeOnSpin:!0,inputType:null}}construct(e){super.construct(e);const t=this;t.input.addEventListener("dblclick",(()=>{t.select()})),"number"==typeof t.changeOnSpin&&(t.bufferedSpinChange=t.buffer(t.triggerChange,t.changeOnSpin))}acceptValue(e,t){let n=!isNaN(e);if(n&&!this.hasTextSelection){n=!1;const e=this.input.value,i=parseFloat(e);e!==t&&(n=!this.acceptValue(i,e))}return n}okMax(e){return isNaN(this.max)||e<=this.max}okMin(e){return isNaN(this.min)||e>=this.min}internalOnKeyEvent(e){if("keydown"===e.type){const t=this,n=e.key;let i;if("ArrowUp"===n)t.doSpinUp(e.shiftKey),i=!0;else if("ArrowDown"===n)t.doSpinDown(e.shiftKey),i=!0;else if(!e.altKey&&!e.ctrlKey&&n&&1===n.length){const e=t.getAfterValue(n),r=t.formatter.parseStrict(e);i=!(r===t.value||"-"===e&&(isNaN(t.min)||t.min<0))&&!t.acceptValue(r,e)}"Enter"===n&&t._changedBySilentSpin&&(t.triggerChange(e,!0),t._changedBySilentSpin=!1),i&&e.preventDefault()}super.internalOnKeyEvent(e)}doSpinUp(e=!1){const t=this;if(t.readOnly)return;let n=(t.value||0)+(e?t.largeStep:t.step);t.okMin(n)||(n=t.min),t.okMax(n)&&t.applySpinChange(n)}doSpinDown(e=!1){const t=this;if(t.readOnly)return;let n=(t.value||0)-(e?t.largeStep:t.step);t.okMax(n)||(n=t.max),t.okMin(n)&&t.applySpinChange(n)}applySpinChange(e){const t=this;t._isUserAction=!0,!0!==t.changeOnSpin&&(t._changedBySilentSpin=!0,t.silenceChange=!0,t.bufferedSpinChange&&t.bufferedSpinChange(null,!0)),t.value=e,t._isUserAction=!1,t.silenceChange=!1}triggerChange(){this.silenceChange||super.triggerChange(...arguments)}onFocusOut(e){var t,n,i;super.onFocusOut(...arguments);const r=this,{input:a}=r,l=a.value,s=r.formatter.truncate(l),o=isNaN(s)?l:r.formatValue(s);null===(t=r.triggers)||void 0===t||null===(n=t.spin)||void 0===n||null===(i=n.clickRepeater)||void 0===i||i.cancel(),l!==o&&(a.value=o),r._changedBySilentSpin&&(r.triggerChange(e,!0),r._changedBySilentSpin=!1)}internalOnInput(e){const t=this,{formatter:n,input:i}=t,{parser:r}=n,a=i.value,l=r.decimalPlaces(a);if(n.truncator&&l){let e=a;const s=n.truncate(a);if(!isNaN(s)&&(e=t.formatValue(s),r.decimalPlaces(e)<l)){const n=a.length-t.caretPos;i.value=e,t.caretPos=e.length-n}}super.internalOnInput(e)}formatValue(e){return this.formatter.format(e)}changeFormat(e){const t=this;if(""===e){const{leadingZeroes:n,decimalPrecision:i}=t;e=n?`${n}>9`:null,null!=i?e=`${e||""}9.${"#".repeat(i)}`:e&&(e+=".*")}return e}get formatter(){const e=this,t=e.format;let n=e._formatter;return n&&e._lastFormat===t||(n=Q.get(e._lastFormat=t),e._formatter=n),n}updateStep(e){this.element.classList[e?"remove":"add"]("b-hide-spinner"),this._step=e}changeLargeStep(e){return e||10*this.step}get validity(){const e=this.value,t={};return null!=e&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}changeValue(e,t){const n=this;if(e||0===e){let t;"number"!=typeof e&&(e="string"==typeof e?n.formatter.parse(e):Number(e),t=isNaN(e),t&&(e="")),!t&&n.format&&(e=n.formatter.round(e))}else e=void 0;return super.changeValue(e,t)}get inputValue(){let e=this.value;return null!=e&&this.format&&(e=this.formatValue(e)),e}}he.initClass(),he._$name="NumberField";class me extends T{static get $name(){return"TimePicker"}static get type(){return"timepicker"}construct(e){super.construct(e),this.refresh()}updateSeconds(e){this.widgetMap.second[e?"show":"hide"]()}onFieldChange(){this.isConfiguring||this.isRefreshing||(this.value=this.pickerToTime())}onAmPmButtonClick({source:e}){this._pm="pmButton"===e.ref,this._value&&(this.value=this.pickerToTime())}onInternalKeyDown(e){var t;const n=this;switch(e.key){case"Escape":return n.triggerTimeChange(n._initialValue),n.hide(),void e.preventDefault();case"Enter":return n.value=n.pickerToTime(),n.hide(),void e.preventDefault()}null===(t=super.onInternalKeyDown)||void 0===t||t.call(this,e)}pickerToTime(){const e=this,t=e._pm,{hour:n,minute:i,second:r}=e.widgetMap;n.format=e._is24Hour?"2>9":null;let a=n.value,l=new Date(e.value);return e._is24Hour||(t&&a<12&&(a+=12),t||12!==a||(a=0)),l.setHours(a),l.setMinutes(i.value),e.seconds&&l.setSeconds(r.value),e._min&&(l=f.max(e._min,l)),e._max&&(l=f.min(e._max,l)),l}triggerTimeChange(e){this.trigger("timeChange",{time:e})}updateInitialValue(e){this.value=e}changeValue(e){var t;return e&&(e="string"==typeof e?f.parse(e,this.format):e),this.isVisible||(this._initialValue=e),null!==(t=e)&&void 0!==t?t:f.getTime(0)}updateValue(e){this.isVisible&&this.triggerTimeChange(e),this.refresh()}updateFormat(e){this._is24Hour=f.is24HourFormat(e),this.refresh()}changeMin(e){return"string"==typeof e?f.parse(e,this.format):e}changeMax(e){return"string"==typeof e?f.parse(e,this.format):e}refresh(){const e=this;if(!e.isConfiguring&&e.value){e.isRefreshing=!0;const{hour:t,minute:n,second:i,amButton:r,pmButton:a}=e.widgetMap,l=e.value,s=e._is24Hour,o=l.getHours(),c=e._pm=o>=12;e.element.classList[s?"add":"remove"]("b-24h"),t.min=s?0:1,t.max=s?23:12,t.value=s?o:o%12||12,n.value=l.getMinutes(),i.value=l.getSeconds(),r.pressed=!c,a.pressed=c,r.hidden=a.hidden=s,e.isRefreshing=!1}}}o(me,"configurable",{floating:!0,items:{hour:{label:"L{TimePicker.hour}",type:"number",min:0,max:23,highlightExternalChange:!1,format:"2>9"},minute:{label:"L{TimePicker.minute}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9"},second:{hidden:!0,label:"L{TimePicker.second}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9"},amButton:{type:"button",text:"AM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"},pmButton:{type:"button",text:"PM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"}},autoShow:!1,trapFocus:!0,seconds:null,value:{$config:{equal:"date"},value:null},format:null,max:null,min:null,initialValue:null}),me.initClass(),me._$name="TimePicker";class pe extends M{static get $name(){return"TimeField"}static get type(){return"timefield"}static get alias(){return"time"}static get configurable(){return{picker:{type:"timepicker",align:{align:"t0-b0",axisLock:!0}},format:"LT",triggers:{expand:{align:"end",handler:"onTriggerClick",compose:()=>({children:[{class:{"b-icon-clock-live":1}}]})},back:{align:"start",cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick"},forward:{align:"end",cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick"}},min:null,max:null,step:"5m",stepTriggers:null,value:null,keepDate:!1}}changePicker(e,t){const n=this;return me.reconfigure(t,e,{owner:n,defaults:{value:n.value,forElement:n[n.pickerAlignElement],owner:n,align:{anchor:n.overlayAnchor,target:n[n.pickerAlignElement]},onTimeChange({time:e}){n._isUserAction=!0,n.value=e,n._isUserAction=!1}}})}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const n=f.add(e.value,-1*e.step.magnitude,e.step.unit);(!t||t.getTime()<=n)&&(e._isUserAction=!0,e.value=n,e._isUserAction=!1)}}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const n=f.add(e.value,e.step.magnitude,e.step.unit);(!t||t.getTime()>=n)&&(e._isUserAction=!0,e.value=n,e._isUserAction=!1)}}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let t=e.value;if(t){if(t=t.getTime(),e._min&&e._min.getTime()>t)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(e._max&&e._max.getTime()<t)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}hasChanged(e,t){return null!=e&&e.getTime&&null!=t&&t.getTime?e.getHours()!==t.getHours()||e.getMinutes()!==t.getMinutes()||e.getSeconds()!==t.getSeconds()||e.getMilliseconds()!==t.getMilliseconds():super.hasChanged(e,t)}showPicker(){const e=this,{picker:t,value:n}=e;e.readOnly||(t.value=n,t.format=e.format,t.maxTime=e.max,t.minTime=e.min,n||(e.value=t.value),super.showPicker(!0))}onPickerShow(){var e;super.onPickerShow(),this.pickerKeyDownRemover=null===(e=this.pickerKeyDownRemover)||void 0===e?void 0:e.call(this)}focusPicker(){this.picker.focus()}transformTimeValue(e){return null!=e&&("string"==typeof e?(e=f.parse(e,this.format),this.keepDate&&(e=f.copyTimeValues(new Date(this.value),e))):e=new Date(e),f.isValidDate(e))?this.keepDate?e:f.getTime(e):null}changeMin(e){return this.transformTimeValue(e)}updateMin(e){const{input:t}=this;t&&(null==e?t.removeAttribute("min"):t.min=e),this.syncInvalid()}changeMax(e){return this.transformTimeValue(e)}updateMax(e){const{input:t}=this;t&&(null==e?t.removeAttribute("max"):t.max=e),this.syncInvalid()}changeValue(e,t){const n=this,i=n.transformTimeValue(e);if(e&&!i||n.isRequired&&""===e)n.setError("L{invalidTime}");else{if(n.clearError("L{invalidTime}"),n.hasChanged(t,i))return super.changeValue(i,t);n.inputting||n.syncInputFieldValue(!0)}}updateValue(e,t){const{expand:n}=this.triggers;n&&e&&(n.element.firstElementChild.style.animationDelay=-(60*e.getHours()+e.getMinutes())/10+"s"),super.updateValue(e,t)}changeStep(e,t){var n,i;const r=typeof e;return e?("number"===r?e={magnitude:Math.abs(e),unit:t?t.unit:"hour"}:"string"===r&&(e=f.parseDuration(e)),null!==(n=e)&&void 0!==n&&n.unit&&null!==(i=e)&&void 0!==i&&i.magnitude?(e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e):void 0):null}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}updateFormat(){this.syncInputFieldValue(!0)}get inputValue(){return f.format(this.value,this.format)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}}pe.initClass(),pe._$name="TimeField";class fe extends w{static get $name(){return"DurationField"}static get type(){return"durationfield"}static get alias(){return"duration"}static get defaultConfig(){return{value:null,step:1,unit:null,defaultUnit:"day",magnitude:null,useAbbreviation:!1,allowNegative:!1,decimalPrecision:null,triggers:{spin:{type:"spintrigger"}},nullValue:null}}static get configurable(){return{min:null,max:null,allowedUnits:null}}changeMin(e){return"string"==typeof e?new E(e):e}changeMax(e){return"string"==typeof e?new E(e):e}changeAllowedUnits(e){return"string"==typeof e&&(e=e.split(",")),e}updateAllowedUnits(e){this.allowedUnitsRe=new RegExp(`(${e.join("|")})`,"i")}get inputValue(){return null==this.value?"":this.calcValue(!0).toString(this.useAbbreviation)}set unit(e){this._unit=e,this.value=this.calcValue()}get unit(){return this._unit}get unitWithDefault(){return this._unit||fe.defaultConfig.defaultUnit}set magnitude(e){this.clearError("L{invalidUnit}"),this._magnitude=e,super.value=this.calcValue()}get magnitude(){return this._magnitude}roundMagnitude(e){return e&&null!=this.decimalPrecision?s.round(e,this.decimalPrecision):e}get allowDecimals(){return 0!==this.decimalPrecision}get isValid(){const e=this,t=null==e.value||e.value&&null==e.value.magnitude;return super.isValid&&(t&&!e.required||!t&&(e.allowNegative||e.value.magnitude>=0))}internalOnChange(e){const t=this,n=t.value,i=t._lastValue;t.hasChanged(i,n)&&(t._lastValue=n,t.triggerFieldChange({value:n,event:e,userAction:!0,valid:t.isValid}))}onFocusOut(e){var t,n,i;return this.syncInputFieldValue(!0),null===(t=this.triggers)||void 0===t||null===(n=t.spin)||void 0===n||null===(i=n.clickRepeater)||void 0===i||i.cancel(),super.onFocusOut(e)}set value(e){const t=this;let n,i;if(this.clearError("L{invalidUnit}"),"number"==typeof e)n=e,i=t._unit;else if("string"==typeof e)if(/^\s*$/.test(e))n=null;else{const r=f.parseDuration(e,t.allowDecimals,t.unitWithDefault);r&&(!t.allowedUnitsRe||t.allowedUnitsRe.test(r.unit)?(i=r.unit,n=r.magnitude):t.setError("L{invalidUnit}"))}else e&&"unit"in e&&"magnitude"in e?(i=e.unit,n=e.magnitude):(i=null,n=null);t._magnitude===n&&t._unit==i||(t._magnitude=n,i&&(t._unit=i),super.value=t.calcValue())}okMax(e){return"number"==typeof e&&(e=new E({unit:this.unitWithDefault,magnitude:e})),null==this.max||e<=this.max}okMin(e){return"number"==typeof e&&(e=new E({unit:this.unitWithDefault,magnitude:e})),null==this.min||e>=this.min}get validity(){const e=this.value,t={};return null!=e&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}get value(){return super.value}calcValue(e=!1){const t=this;return t._unit&&null!=t._magnitude||!t.clearable?new E(e?this.roundMagnitude(t._magnitude):this._magnitude,t.unitWithDefault):null}hasChanged(e,t){return t&&!e||!t&&e||t&&e&&!e.isEqual(t)}get milliseconds(){return this.value?this.value.milliseconds:0}onInternalKeyDown(e){"ArrowUp"===e.key?this.doSpinUp():"ArrowDown"===e.key&&this.doSpinDown()}doSpinUp(){const e=this;if(e.readOnly)return;let t=(e.magnitude||0)+e.step;e._isUserAction=!0,e.okMin(t)||(t=e.min),e.okMax(t)&&(e.value=t),e._isUserAction=!1}doSpinDown(){const e=this;if(e.readOnly)return;let t=(e.magnitude||0)-e.step;e.okMax(t)||(t=e.max),e.okMin(t)&&(e.allowNegative||(e.magnitude||0)>0)&&(e._isUserAction=!0,e.value=t,e._isUserAction=!1)}}fe.initClass(),fe._$name="DurationField";const ye=["number","boolean","string","date","duration"],ve=e=>{var t;return"duration"===(null===(t=e.column)||void 0===t?void 0:t.type)};class be extends T{static get $name(){return"FieldFilterPicker"}static get type(){return"fieldfilterpicker"}static get defaultValueFieldPlaceholders(){return{string:"L{enterAValue}",number:"L{enterANumber}",date:"L{selectADate}",list:"L{selectOneOrMoreValues}",duration:"L{enterAValue}"}}afterConstruct(){const e=this;if(!e._fields)throw new Error(`${be.name} requires 'fields' to be configured.`);if(!e._filter)throw new Error(`${be.name} requires 'filter' to be configured.`);super.afterConstruct();const{widgetMap:{propertyPicker:t,operatorPicker:n,caseSensitive:i}}=e;t.ion({select:"onPropertySelect",thisObj:e}),n.ion({select:"onOperatorSelect",thisObj:e}),i.ion({change:"onCaseSensitiveChange",thisObj:e}),e.propertyFieldConfig&&t.setConfig(e.propertyFieldConfig),e.operatorFieldConfig&&n.setConfig(e.operatorFieldConfig),t.cls=e.allPropertyPickerClasses,n.cls=e.allOperatorPickerClasses,e.populateUIFromFilter()}changeDateFormat(e){return this.L(e)}get allChildInputs(){const{propertyPicker:e,operatorPicker:t,caseSensitive:n}=this.widgetMap;return[e,t,...this.valueFields,n]}updateDisabled(e){this.allChildInputs.forEach((t=>t.disabled=e))}updateReadOnly(e){const{propertyPicker:t,operatorPicker:n}=this.widgetMap;this.allChildInputs.forEach((t=>t.readOnly=e)),t.readOnly=t.readOnly||e,n.readOnly=n.readOnly||e}updatePropertyLocked(e){this.widgetMap.propertyPicker.readOnly=e||this.readOnly,this.widgetMap.propertyPicker.cls=this.allPropertyPickerClasses}updateOperatorLocked(e){this.widgetMap.operatorPicker.readOnly=e||this.readOnly,this.widgetMap.operatorPicker.cls=this.allOperatorPickerClasses}changeOperators(e){const t=null!=e?e:be.defaultOperators;return Object.keys(t).reduce(((e,n)=>x(x({},e),{},{[n]:t[n].map((e=>x(x({},e),{},{text:this.L(e.text)})))})),{})}changeFields(e){let t=e;return Array.isArray(e)&&(F.deprecate("Core","6.0.0","FieldOption[] deprecated, use Object<String, FieldOption> keyed by field name instead"),t=D.keyBy(t,"name")),t}get isMultiSelectValueField(){var e;return["isIncludedIn","isNotIncludedIn"].includes(null===(e=this._filter)||void 0===e?void 0:e.operator)}get allPropertyPickerClasses(){var e;return new L(`b-${be.type}-property`,null===(e=this.propertyFieldConfig)||void 0===e?void 0:e.cls,{[`b-${be.type}-combo-locked`]:this.propertyLocked})}get allOperatorPickerClasses(){var e;return new L(`b-${be.type}-operator`,null===(e=this.operatorFieldConfig)||void 0===e?void 0:e.cls,{[`b-${be.type}-combo-locked`]:this.operatorLocked})}getValueFieldConfigs(){const e=this,{valueFieldCls:t,fieldType:n,_filter:{operator:i},onValueChange:r,filterValues:a,isMultiSelectValueField:l,operatorArgCount:o,getValueFieldConfig:c}=e,u=s.merge({},be.defaultValueFieldPlaceholders,e.valueFieldPlaceholders);if(!n||!i||0===o)return[];let d={type:"textfield",listeners:{change:r,input:r,thisObj:e},cls:t,dataset:{type:n},placeholder:e.L(u[l?"list":n])};return l?d=x(x({},d),{},{type:"combo",multiSelect:!0,createOnUnmatched:!0,items:this.getUniqueDataValues(a),value:null!=a?a:[]}):["number","date","boolean"].includes(n)?d.type=`${n}field`:"duration"===n&&(d.type="durationfield"),c&&(d=e.callback(c,e,[e.filter,d])),l?[d]:D.populate(o,(t=>[{type:"widget",tag:"div",cls:`b-${be.type}-value-separator`,content:e.L("L{FieldFilterPicker.and}")},x(x({},d),{},{value:a[t]})])).flat().slice(1)}getUniqueDataValues(e=[]){var t;const n=this,{fieldType:i}=n;if(!n.store||null===(t=n._filter)||void 0===t||!t.property)return[];const{relatedDisplayField:r}=n.selectedField;let a,l;if(n.fieldIsRelation){const{foreignStore:e}=n.currentPropertyRelationConfig;r?(a=e.allRecords.reduce(((e,t)=>(null!=t.id&&e.push({text:t[r],value:t.id}),e)),[]),l=a.sort(((e,t)=>n.sortStrings(e.text,t.text)))):a=e.allRecords.map((e=>e.id))}else a=n.store.allRecords.map((e=>e[n._filter.property]));if(!l){a.push(...e);const t=D.unique(a.reduce(((e,t)=>(null!=t&&""!==String(t).trim()&&("date"===i?e.push(t.valueOf()):"duration"===i?e.push(t.toString()):e.push(t)),e)),[]));l="string"===i?t.sort(n.sortStrings):"duration"===i?t.map((e=>new E(e))).filter((e=>e.isValid)).sort(n.sortDurations):t.sort(n.sortNumerics),"date"===i?l=l.map((e=>{const t=new Date(e);return{text:f.format(t,n.dateFormat),value:e}})):"duration"===i&&(l=l.map((e=>e.toString())))}return l}sortStrings(e,t){return(null!=e?e:"").localeCompare(null!=t?t:"")}sortNumerics(e,t){return e-t}sortDurations(e,t){return e.valueOf()-t.valueOf()}get fieldType(){var e;return null===(e=this.selectedField)||void 0===e?void 0:e.type}get selectedField(){var e,t;return null===(e=this.fields)||void 0===e?void 0:e[null===(t=this._filter)||void 0===t?void 0:t.property]}get propertyOptions(){var e;return Object.entries(null!==(e=this.fields)&&void 0!==e?e:{}).filter((([,e])=>ye.includes(e.type)||ve(e))).map((([e,{title:t}])=>({value:e,text:null!=t?t:e}))).sort(((e,t)=>e.text.localeCompare(t.text)))}get operatorOptions(){return this.operators[this.fieldIsRelation?"relation":this.fieldType]}get fieldIsRelation(){return Boolean(this.currentPropertyRelationConfig)}get currentPropertyRelationConfig(){var e,t;return null===(e=this.store)||void 0===e||null===(t=e.modelRelations)||void 0===t?void 0:t.find((({foreignKey:e})=>{var t;return e===(null===(t=this._filter)||void 0===t?void 0:t.property)}))}updateOperators(){delete this._operatorArgCountLookup}get operatorArgCountLookup(){return this._operatorArgCountLookup||(this._operatorArgCountLookup=be.buildOperatorArgCountLookup(this.operators))}updateFilter(){this._filter&&this.onFilterChange()}updateStore(e){var t;null===(t=this._store)||void 0===t||t.un(this),null==e||e.ion({refresh:"onStoreRefresh",thisObj:this})}onStoreRefresh({action:e}){this.isMultiSelectValueField&&["dataset","create","update","delete"].includes(e)&&(this.valueFields[0].items=this.getUniqueDataValues(this.filterValues))}refreshValueFields(){const e=this,{valueFieldRow:t}=e.widgetMap;t.removeAll(),t.add(e.getValueFieldConfigs()),delete e._valueFields,e.refreshCaseSensitive()}refreshCaseSensitive(){var e,t;const n=this,{fieldType:i,operatorArgCount:r,isMultiSelectValueField:a}=n,l=null===(e=n._filter)||void 0===e?void 0:e.operator,{caseSensitive:s}=n.widgetMap;s.hidden="string"!==i||!l||a||0===r,s.checked=!1!==(null===(t=n._filter)||void 0===t?void 0:t.caseSensitive)}onPropertySelect(e){var t;const n=this,{_filter:i}=n;i.property=(null===(t=e.record)||void 0===t?void 0:t.data.value)||null,n.fieldType!==n._fieldType&&(i.operator=null,i.value=null),n._fieldType=i.type=n.fieldType,n.refreshOperatorPicker(),n.refreshValueFields(),n.triggerChange()}onCaseSensitiveChange({checked:e}){this._filter.caseSensitive=e,this.triggerChange()}onOperatorSelect(e){var t;const n=this,i=n.isMultiSelectValueField,r=this.operatorArgCount;n._filter.operator=(null===(t=e.record)||void 0===t?void 0:t.data.value)||null,n.operatorArgCount!==r&&(n._filter.value=null),n.isMultiSelectValueField&&!i&&(n._filter.value=[]),n.refreshValueFields(),n.triggerChange()}triggerChange(){const{filter:e,isValid:t}=this;this.trigger("change",{filter:e,isValid:t})}onValueChange(){const{isMultiSelectValueField:e,fieldType:t,_filter:n}=this,i=this.valueFields.map((e=>e.value));e&&"date"===t?n.value=i[0].map((e=>new Date(e))):e&&"duration"===t?n.value=i[0].map((e=>new E(e))):("date"===t&&"between"===n.operator&&f.isValidDate(i[1])&&i[1].setHours(23,59,59,999),n.value=1===i.length?i[0]:i),this.triggerChange()}refreshOperatorPicker(){const{operatorPicker:e}=this.widgetMap,{_filter:{operator:t,property:n},operatorOptions:i}=this;e.items=i,e.value=t,e.hidden=null===n}populateUIFromFilter(e=!1){const t=this,{filterValues:n,widgetMap:{propertyPicker:i,operatorPicker:r},_filter:{property:a,operator:l,disabled:s},propertyOptions:o,operatorOptions:c,isMultiSelectValueField:u}=t;i.items=o,r.items=c,r.hidden=null===a;let d=e;i.value!==a&&(i.value=a,t.refreshOperatorPicker(),d=!0),r.value!==l&&(null===l?r.clear():r.value=l,d=!0),d&&t.refreshValueFields(),t.refreshCaseSensitive(),t.valueFields.forEach(((e,i)=>{u&&(e.value.length>0||n.length>0)?"date"===t.fieldType?e.value=n.map((e=>null==e?void 0:e.valueOf())):"duration"===t.fieldType?e.value=n.map((e=>null==e?void 0:e.toString())):e.value=n:i>=n.length?e.clear():e.value=n[i]})),t.allChildInputs.forEach((e=>e.disabled=t.disabled||s))}get valueFields(){return this._valueFields||(this._valueFields=this.widgetMap.valueFieldRow.queryAll((e=>["textfield","datefield","numberfield","durationfield","combo"].includes(e.type))))}get filterValues(){var e;return null==(null===(e=this._filter)||void 0===e?void 0:e.value)?[]:D.asArray(this._filter.value)}onFilterChange(){const e=this,t=e.fieldType,n=t!==e._fieldType;e._fieldType=e._filter.type=t,e.populateUIFromFilter(n)}get operatorArgCount(){const{fieldType:e,filter:{operator:t},operatorArgCountLookup:n}=this;return e&&t?n[e][t]:1}get isValid(){const{filter:e,fieldType:t,filterValues:n,isMultiSelectValueField:i,operatorArgCount:r}=this,{operator:a}=e,l=r>0&&null==(null==e?void 0:e.value);return t&&a&&!l&&(i&&n.length>0||n.length===r)&&n.every((e=>null!=e&&("duration"!==t||e.isValid)))}}o(be,"operators",{empty:{value:"empty",text:"L{isEmpty}",argCount:0},notEmpty:{value:"notEmpty",text:"L{isNotEmpty}",argCount:0},"=":{value:"=",text:"L{equals}"},"!=":{value:"!=",text:"L{doesNotEqual}"},">":{value:">",text:"L{isGreaterThan}"},"<":{value:"<",text:"L{isLessThan}"},">=":{value:">=",text:"L{isGreaterThanOrEqualTo}"},"<=":{value:"<=",text:"L{isLessThanOrEqualTo}"},between:{value:"between",text:"L{isBetween}",argCount:2},notBetween:{value:"notBetween",text:"L{isNotBetween}",argCount:2},isIncludedIn:{value:"isIncludedIn",text:"L{isOneOf}"},isNotIncludedIn:{value:"isNotIncludedIn",text:"L{isNotOneOf}"}}),o(be,"defaultOperators",{string:[be.operators.empty,be.operators.notEmpty,be.operators["="],be.operators["!="],{value:"includes",text:"L{contains}"},{value:"doesNotInclude",text:"L{doesNotContain}"},{value:"startsWith",text:"L{startsWith}"},{value:"endsWith",text:"L{endsWith}"},be.operators.isIncludedIn,be.operators.isNotIncludedIn],number:[be.operators.empty,be.operators.notEmpty,be.operators["="],be.operators["!="],be.operators[">"],be.operators["<"],be.operators[">="],be.operators["<="],be.operators.between,be.operators.notBetween,be.operators.isIncludedIn,be.operators.isNotIncludedIn],date:[be.operators.empty,be.operators.notEmpty,be.operators["="],be.operators["!="],{value:"<",text:"L{isBefore}"},{value:">",text:"L{isAfter}"},be.operators.between,{value:"isToday",text:"L{isToday}",argCount:0},{value:"isTomorrow",text:"L{isTomorrow}",argCount:0},{value:"isYesterday",text:"L{isYesterday}",argCount:0},{value:"isThisWeek",text:"L{isThisWeek}",argCount:0},{value:"isNextWeek",text:"L{isNextWeek}",argCount:0},{value:"isLastWeek",text:"L{isLastWeek}",argCount:0},{value:"isThisMonth",text:"L{isThisMonth}",argCount:0},{value:"isNextMonth",text:"L{isNextMonth}",argCount:0},{value:"isLastMonth",text:"L{isLastMonth}",argCount:0},{value:"isThisYear",text:"L{isThisYear}",argCount:0},{value:"isNextYear",text:"L{isNextYear}",argCount:0},{value:"isLastYear",text:"L{isLastYear}",argCount:0},{value:"isYearToDate",text:"L{isYearToDate}",argCount:0},be.operators.isIncludedIn,be.operators.isNotIncludedIn],boolean:[{value:"isTrue",text:"L{isTrue}",argCount:0},{value:"isFalse",text:"L{isFalse}",argCount:0}],duration:[be.operators.empty,be.operators.notEmpty,be.operators["="],be.operators["!="],be.operators[">"],be.operators["<"],be.operators[">="],be.operators["<="],be.operators.between,be.operators.notBetween,be.operators.isIncludedIn,be.operators.isNotIncludedIn],relation:[be.operators.isIncludedIn,be.operators.isNotIncludedIn]}),o(be,"configurable",{fields:null,disabled:!1,readOnly:!1,layout:"vbox",propertyLocked:!1,operatorLocked:!1,filter:null,propertyFieldConfig:null,operatorFieldConfig:null,valueFieldCls:null,items:{propertyAndOperator:{type:"container",layout:"box",items:{propertyPicker:{type:"combo",items:{},cls:`b-${be.type}-property`,placeholder:"L{FieldFilterPicker.selectAProperty}"},operatorPicker:{type:"combo",items:{},cls:`b-${be.type}-operator`,placeholder:"L{FieldFilterPicker.selectAnOperator}"}}},valueFieldRow:{type:"container",cls:`b-${be.type}-values`,items:{}},caseSensitive:{type:"checkbox",text:"L{FieldFilterPicker.caseSensitive}",cls:`b-${be.type}-case-sensitive`}},operators:be.defaultOperators,dateFormat:"L{FieldFilterPicker.dateFormat}",store:null,valueFieldPlaceholders:null,getValueFieldConfig:null}),o(be,"buildOperatorArgCountLookup",(e=>D.keyBy(Object.entries(e),(([e])=>e),(([,e])=>D.keyBy(e,(({value:e})=>e),(({argCount:e})=>void 0===e?1:e)))))),be.initClass(),be._$name="FieldFilterPicker";class ke extends u{compose(){const{text:e,html:t}=this;return{tag:"label",text:e,html:t}}}o(ke,"$name","Label"),o(ke,"type","label"),o(ke,"configurable",{text:null,localizableProperties:["text"]}),ke.initClass(),ke._$name="Label";class De extends T{static get $name(){return"FieldFilterPickerGroup"}static get type(){return"fieldfilterpickergroup"}afterConstruct(){const e=this;e.validateConfig();const{addFilterButton:t}=e.widgetMap;t.ion({click:"addFilter",thisObj:e}),t.text=e.L(t.text),e.store&&e.updateStore(e.store),super.afterConstruct()}changeDateFormat(e){return this.L(e)}validateConfig(){if(!this.fields&&!this.store)throw new Error("FieldFilterPickerGroup requires either a 'fields' or 'store' config property.")}get someFiltersNotShown(){return this.store&&this.store.filters.count>this.filters.length}updateFields(e){this.widgetMap.pickers.childItems.forEach((t=>t.fields=e))}updateFilters(e,t){const n=this;t&&t.filter((t=>!e.find((e=>e.id===t.id)))).forEach((e=>{var t;return null===(t=n.store)||void 0===t?void 0:t.removeFilter(e.id)})),e.forEach((e=>e.id=e.id||n.nextFilterId)),n.widgetMap.pickers.items=(null==e?void 0:e.map((e=>n.getPickerRowConfig(e))))||[]}changeFilters(e){const{canManageFilter:t}=this;return e&&t?e.filter((e=>this.callback(t,this,[e]))):e}updateStore(e){const t=this;t.detachListeners("store"),e&&(t.widgetMap.pickers.childItems.forEach((({widgetMap:{filterPicker:{filter:t,isValid:n}}})=>{e.removeFilter(t.id,!0),n&&e.addFilter(t,!0)})),e.filter(),t.appendFiltersFromStore(),e.ion({name:"store",filter:"onStoreFilter",thisObj:t})),t.widgetMap.pickers.childItems.forEach((t=>t.store=e))}updateShowAddFilterButton(e){this.widgetMap.addFilterButton.hidden=!e}updateAddFilterButtonText(e){this.widgetMap.addFilterButton.text=null!=e?e:De.addFilterButtonDefaultText}appendFiltersFromStore(){const e=this;e.store.filters.forEach((t=>{var n;const i=e.canManage(t),{property:r,operator:a,value:l,id:s,disabled:o=!1,caseSensitive:c}=t;i&&r&&a&&(null===(n=e.filters)||void 0===n||!n.find((e=>e.id===s)))&&e.appendFilter({id:s,property:r,operator:a,value:l,disabled:o,caseSensitive:c})}))}canManage(e){const t=this;return!t.canManageFilter||!0===t.callback(t.canManageFilter,t,[e])}getFilterPickerConfig(e){const t=this,{fields:n,store:i,disabled:r,readOnly:a,valueFieldCls:l,operators:s,limitToProperty:o,dateFormat:c,getFieldFilterPickerConfig:u}=t;return x({type:t.constructor.childPickerType,fields:null!=n?n:t.getFieldsFromStore(i),filter:e,store:i,disabled:r,readOnly:a,propertyLocked:Boolean(o),valueFieldCls:l,operators:s,dateFormat:c,internalListeners:{change:"onFilterPickerChange",thisObj:t},flex:1},u?t.callback(u,t,[e]):void 0)}getFieldsFromStore(e){var t,n;return Object.fromEntries(null!==(t=null===(n=e.fields)||void 0===n?void 0:n.map((({name:e,type:t})=>[e,{type:t}])))&&void 0!==t?t:[])}getPickerRowConfig(e){const t=this,{disabled:n,readOnly:i,canDeleteFilter:r}=t;return{type:"container",layout:"box",layoutStyle:{alignItems:"start"},cls:`b-${De.type}-row`,dataset:{separatorText:t.L("L{FieldFilterPicker.and}")},items:{activeCheckbox:{type:"checkbox",disabled:n,readOnly:i,checked:!Boolean(e.disabled),listeners:{change:"onFilterActiveChange",thisObj:t},cls:`b-${De.type}-filter-active`},filterPicker:t.getFilterPickerConfig(e),removeButton:{type:"button",ref:"removeButton",disabled:n,readOnly:i,hidden:r&&!1===t.callback(r,t,[e]),cls:`b-transparent b-${De.type}-remove`,icon:"b-fa-trash",internalListeners:{click:"removeFilter",thisObj:t}}}}}get allInputs(){const e=[this.constructor.childPickerType,"button","checkbox"];return this.queryAll((t=>e.includes(t.type)))}updateDisabled(e){this.allInputs.forEach((t=>t.disabled=e))}updateReadOnly(e){this.allInputs.forEach((t=>t.readOnly=e))}onFilterActiveChange({source:e,checked:t}){const n=this,i=n.getFilterIndex(e),r=n.filters[i],a=n.getFilterPicker(i);r.disabled=!t,a.onFilterChange(),n.store&&a.isValid&&n.store.addFilter(r,!0),n.updateStoreFilter(),n.triggerChange()}onFilterPickerChange({source:e,filter:t,isValid:n}){const i=this,{store:r}=i,a=i.getFilterIndex(e);r&&(r.removeFilter(t.id,!0),n&&r.addFilter(t,!0),i.updateStoreFilter()),Object.assign(i.filters[a],t),i.triggerChange()}getFilterIndex(e){return this.widgetMap.pickers.childItems.indexOf(e.containingWidget)}getPickerRow(e){return this.widgetMap.pickers.childItems[e]}getFilterPicker(e){return this.getPickerRow(e).widgetMap.filterPicker}get nextFilterId(){return this._nextId=(this._nextId||0)+1,`${this.id}-filter-${this._nextId}`}removeFilter({source:e}){const t=this,n=t.getFilterIndex(e),i=t.filters[n],r=t.getPickerRow(n),a=t.query((e=>e.isFocusable&&"container"!==e.type&&!r.contains(e)));a&&a.focus(),t.removeFilterAt(n),t.store&&(t.store.removeFilter(i.id,!0),t.updateStoreFilter()),t.trigger("remove",{filter:i}),t.triggerChange()}addFilter({property:e=null,operator:t=null,value:n=null}={}){const i=this,{filters:r}=i,a={property:i.limitToProperty||e,operator:t,value:n,disabled:!1,id:i.nextFilterId,caseSensitive:!1};var l;(i.appendFilter(a),i.getFilterPicker(r.length-1).isValid)&&(null===(l=i.store)||void 0===l||l.addFilter(a,!0),i.store&&i.updateStoreFilter());i.trigger("add",{filter:a}),i.triggerChange()}appendFilter(e){const t=this;t.limitToProperty&&e.property!==t.limitToProperty||(t.filters.push(e),t.widgetMap.pickers.add(t.getPickerRowConfig(e,t.filters.length-1)))}onStoreFilter(e){const t=this;if(t._isUpdatingStore)return;const{filters:n}=e,i=n.values.reduce(((e,t)=>x(x({},e),{},{[t.id]:t})),{});for(let e=t.filters.length-1;e>=0;e--){const n=t.filters[e],r=i[n.id],a=t.getPickerRow(e);if(a){const{filterPicker:i,activeCheckbox:l}=a.widgetMap;if(!r&&i.isValid)t.removeFilterAt(e);else if(void 0!==r){const{operator:e,value:t,property:a,disabled:s,caseSensitive:o}=r;n!==r&&Object.assign(n,{operator:e,value:t,property:a,disabled:s,caseSensitive:o}),i.filter=n,i.onFilterChange(),l.checked=!s}}}t.appendFiltersFromStore(),t.triggerChange()}removeFilterAt(e){const{widgetMap:{pickers:t},filters:n}=this;t.remove(t.childItems[e]),n.splice(e,1),this.triggerChange()}updateStoreFilter(){this._isUpdatingStore=!0,this.store.filter(),this._isUpdatingStore=!1}get value(){return this.filters}triggerChange(){this.trigger("change",{filters:this.value})}activateAll(){this.setAllActiveStatus(!0)}deactivateAll(){this.setAllActiveStatus(!1)}setAllActiveStatus(e){const t=this,{_filters:n,store:i}=t;n.forEach(((n,r)=>{if(e===n.disabled){const{filterPicker:a,activeCheckbox:l}=t.getPickerRow(r).widgetMap;n.disabled=!e,a.onFilterChange(),l.checked=e,e&&i&&a.isValid&&i.addFilter(n,!0)}})),t.updateStoreFilter()}}o(De,"addFilterButtonDefaultText","L{FieldFilterPickerGroup.addFilter}"),o(De,"configurable",{filters:[],fields:null,disabled:!1,readOnly:!1,layout:"vbox",store:null,limitToProperty:null,valueFieldCls:null,showAddFilterButton:!0,canDeleteFilter:null,getFieldFilterPickerConfig:null,canManageFilter:null,addFilterButtonText:null,items:{pickers:{type:"container",layout:"vbox",scrollable:!0,items:{}},addFilterButton:{type:"button",text:De.addFilterButtonDefaultText,cls:`b-${De.type}-add-button`,hidden:!0}},operators:null,dateFormat:"L{FieldFilterPicker.dateFormat}"}),o(De,"childPickerType","fieldfilterpicker"),De.initClass(),De._$name="FieldFilterPickerGroup";const Ce=[{ref:"cancelButton",cls:"b-messagedialog-cancelbutton b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick"},{ref:"okButton",cls:"b-messagedialog-okbutton b-raised b-blue",text:"L{Object.Ok}",onClick:"up.onOkClick"}];c.isWindows&&Ce.reverse();class xe extends P{static get $name(){return"MessageDialog"}static get type(){return"messagedialog"}static get configurable(){return{centered:!0,modal:!0,hidden:!0,autoShow:!1,closeAction:"hide",title:"Â ",lazyItems:{$config:["lazy"],value:[{cls:"b-messagedialog-message",ref:"message"},{type:"textfield",cls:"b-messagedialog-input",ref:"input"}]},showClass:null,bbar:{overflow:null,items:Ce}}}construct(){this.okButton=this.yesButton=1,this.cancelButton=3,super.construct(...arguments)}destroy(){}async confirm(){return this.showDialog("confirm",...arguments)}async alert(){return this.showDialog("alert",...arguments)}async prompt({textField:e}){const t=this.widgetMap.input;return u.reconfigure(t,e),t.value="",this.showDialog("prompt",...arguments)}showDialog(e,{message:t="",title:n="Â ",cancelButton:i,okButton:r,rootElement:a=document.body}){const l=this;return l.rootElement=a,l.getConfig("lazyItems"),l.title=l.optionalL(n),l.widgetMap.message.html=l.optionalL(t),l.showClass=`b-messagedialog-${e}`,r&&(r="string"==typeof r?{text:r}:r),i&&(i="string"==typeof i?{text:i}:i),r=Object.assign({},l.widgetMap.okButton.initialConfig,r),i=Object.assign({},l.widgetMap.cancelButton.initialConfig,i),r.text=l.optionalL(r.text),i.text=l.optionalL(i.text),u.reconfigure(l.widgetMap.okButton,r),u.reconfigure(l.widgetMap.cancelButton,i),l.show(),l.promise=new Promise((e=>{l.resolve=e}))}show(){const e=t.getActiveElement(this.element);return this.owner=this.element.contains(e)?null:xe.fromElement(document.activeElement),super.show(...arguments)}updateShowClass(e,t){const{classList:n}=this.element;t&&n.remove(t),e&&n.add(e)}doResolve(e){const t=this,{resolve:n}=t;if(n){const i="b-messagedialog-prompt"===t.showClass;if(i&&e===t.okButton&&!t.widgetMap.input.isValid)return;t.resolve=t.reject=t.promise=null,n(i?{button:e,text:t.widgetMap.input.value}:e),t.hide()}}onInternalKeyDown(e){"Escape"===e.key&&(e.stopImmediatePropagation(),this.onCancelClick()),"Enter"===e.key&&(e.stopImmediatePropagation(),e.preventDefault(),this.onOkClick()),super.onInternalKeyDown(e)}onOkClick(){this.doResolve(we.okButton)}onCancelClick(){this.doResolve(we.cancelButton)}}xe.initClass();const we=new Proxy({},{get(e,t){const n=e.instance||(e.instance=new xe({rootElement:document.body})),i=n[t];return"function"==typeof i?i.bind(n):i}});export{ne as CalendarPanel,re as Checkbox,ge as DateField,ue as DatePicker,le as DisplayField,H as DragHelper,fe as DurationField,be as FieldFilterPicker,De as FieldFilterPickerGroup,K as Formatter,ke as Label,we as MessageDialog,ee as Month,he as NumberField,Q as NumberFormat,B as ResizeHelper,ye as SUPPORTED_FIELD_DATA_TYPES,pe as TimeField,me as TimePicker,X as WidgetHelper,ae as YearPicker,ve as isSupportedDurationField};
//# sourceMappingURL=MessageDialog.js.map
