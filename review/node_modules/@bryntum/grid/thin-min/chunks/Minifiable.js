/*!
 *
 * Bryntum Grid 5.3.0
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
import{Delayable as e,DomClassList as t,EventHelper as l,Rectangle as o,Widget as n,PanelCollapser as r,Animator as a,DomHelper as s,_objectSpread2 as i,ObjectHelper as v,_defineProperty as c,Base as d}from"./Editor.js";import{DragProxy as h}from"./AvatarRendering.js";const u="b-hover-edge",g="b-hover-top",p="b-hover-right",m="b-hover-bottom",f="b-hover-left",b={[u]:1,[g]:1,[p]:1,[m]:1,[f]:1},C={t:[u,g],r:[u,p],b:[u,m],l:[u,f],tr:[u,g,p],bl:[u,m,f],tl:[u,g,f],br:[u,m,p]};var y=o=>class extends(o.mixin(e)){static get $name(){return"Hoverable"}static get configurable(){return{hoverCls:null,hoverAnimationCls:null,hoverRootCls:null,hoverRootActiveCls:null,hoverDelay:null,hoverElement:null,hoverIgnoreElement:null,hoverEdges:null,hoverEdgeSize:10,hoverRootElement:{$config:"nullify",value:null},hoverSelector:null,hoverTarget:{$config:"nullify",value:null},hoverTrack:null,hoverZone:null}}static get delayable(){return{setHoverTarget:0}}hoverEnter(e){}hoverIgnore(e){var t;return null===(t=this.hoverIgnoreElement)||void 0===t?void 0:t.contains(e)}hoverLeave(e){}hoverMove(e){}onHoverMouseMove(e){const t=this,{hoverEdges:l,hoverEdgeSize:o,hoverTarget:n}=t;if(n){if(l){const{top:r,left:a,width:s,height:i,right:v,bottom:c}=n.getBoundingClientRect(),{clientX:d,clientY:h}=e,u=a+s/2,g=r+i/2,p=h<(o?r+o:g),m=d>=(o?v-o:u),f=h>=(o?c-o:g),b=d<(o?a+o:u),C=p||f?p?"t":"b":"",y=m||b?m?"r":"l":"";t.hoverZone=(l.includes(C)?C:"")+(l.includes(y)?y:"")}t.hoverEvent=e,t.hoverTrack&&t.hoverMove(e)}}onHoverMouseOver(e){this.hoverEvent=e,this.hoverElement=e.target}onHoverMouseOut(e){this.hoverEvent=e,this.hoverElement=e.relatedTarget}updateHoverDelay(e){this.setHoverTarget.delay=e}changeHoverEdges(e){return!0===e?"trbl":(e||"").replace("v","tb").replace("h","lr")}updateHoverEdges(){this.syncHoverListeners()}changeHoverElement(e){if(!this.hoverIgnore(e))return e}updateHoverElement(e){const{hoverSelector:t}=this;var l;t&&(e=null===(l=e)||void 0===l?void 0:l.closest(t));this.setHoverTarget(e)}updateHoverRootElement(e,t){const{hoverRootCls:l}=this;l&&(null==t||t.classList.remove(l),null==e||e.classList.add(l)),this.syncHoverListeners()}changeHoverTarget(e,t){return t&&(this.hoverZone=null),e}updateHoverTarget(e,t){const l=this,{hoverCls:o,hoverAnimationCls:n,hoverRootActiveCls:r,hoverRootElement:a}=l;r&&(null==a||a.classList[e?"add":"remove"](r)),t&&(o&&t.classList.remove(o),n&&t.classList.remove(n),l.hoverLeave(t)),e&&(o&&e.classList.add(o),l.hoverEnter(t),l.hoverTrack&&l.hoverMove(l.hoverEvent),n&&(e.getBoundingClientRect(),e.classList.add(n)))}updateHoverTrack(){this.syncHoverListeners()}updateHoverZone(e){const{hoverAnimationCls:l,hoverTarget:o}=this;if(o){const{className:n}=o,r=t.change(n,e?C[e]:null,b);n!==r&&(o.className=r,e&&l&&(o.classList.remove(l),o.getBoundingClientRect(),o.classList.add(l)))}}setHoverTarget(e){this.hoverTarget=e}syncHoverListeners(){var e;const t=this,o=t.hoverRootElement,n={element:o,thisObj:t,mouseover:"onHoverMouseOver",mouseout:"onHoverMouseOut"};(t.hoverTrack||t.hoverEdges)&&(n.mousemove="onHoverMouseMove"),null===(e=t._hoverRootDetacher)||void 0===e||e.call(t),t._hoverRootDetacher=o&&l.on(n)}};class E extends h{static get type(){return"tip"}static get configurable(){return{align:"t10-b50",offset:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip"}}}}open(){this.getConfig("tooltip")}close(){var e;null===(e=this.tooltip)||void 0===e||e.hide()}dragMove(e){const{offset:t,tooltip:l}=this,{event:n}=e;l&&(l.isVisible||l.show(),l.alignTo({align:this.align,target:new o(n.clientX-t,n.clientY-t,2*t,2*t)}))}changeTooltip(e,t){return n.reconfigure(t,e,this)}}E.initClass(),E._$name="DragTipProxy";const{dockIsHorz:H}=r.maps,D={top:0,down:0,left:1,bottom:2,up:2,right:3},T={},L={up:{from:"translate(0,0)",to:"translate(0,-100%)"},down:{from:"translate(0,0)",to:"translate(0,100%)"},left:{from:"translate(0,0)",to:"translate(-100%,0)"},right:{from:"translate(0,0)",to:"translate(100%,0)"}};class k extends(r.mixin(e)){static get $name(){return"PanelCollapserOverlay"}static get type(){return"overlay"}static get configurable(){return{autoCloseDelay:1e3,autoClose:!0,revealing:{value:null,$config:null,default:!1},recollapseTool:{type:"collapsetool",cls:"b-recollapse",collapsify:"overlay",handler(){var e;null===(e=this.collapsible)||void 0===e||e.toggleReveal()}}}}static get delayable(){return{doAutoClose:0}}doAutoClose(){this.toggleReveal(!1)}updateAutoCloseDelay(e){const{doAutoClose:t}=this;(t.suspended=null==e||e<0)||(t.delay=e,t.immediate=!e)}changeRecollapseTool(e){const t=this,{panel:l}=t;if(t.isConfiguring||t.isDestroying||!l||l.isDestroying)return e;l.tools={recollapse:e}}beforeCollapse(e){if(!1===super.beforeCollapse(e))return!1;this.panel.revealed&&(e.animation=null)}applyHeaderDock(e,t=!0){var l;null===(l=this.panel)||void 0===l||l.recompose(),super.applyHeaderDock(e,t)}collapseBegin(e){const t=this,{collapseDir:l,innerElement:o}=t,{animation:n}=e,{collapseTool:r,panel:s}=t;t.configuredWidth=s._lastWidth,t.configuredHeight=s._lastHeight,t.applyHeaderDock(!0),t.lockInnerSize(),null==r||r.element.classList.add("b-collapsed"),n&&(s.element.classList.add("b-collapsing"),n.element=o,n.transform=L[l],e.animation=a.run(n))}onComplete(e){var t,o;super.onComplete(e);const n=this,{panel:r}=n,{element:a}=r;n.autoCloseLeaveDetacher=null===(t=n.autoCloseLeaveDetacher)||void 0===t?void 0:t.call(n),n.autoCloseClickDetacher=null===(o=n.autoCloseClickDetacher)||void 0===o?void 0:o.call(n),n.doAutoClose.cancel(),"reveal"===e&&n.autoClose&&(r.containsFocus&&(n.autoCloseLeaveDetacher=l.on({element:a,mouseenter:e=>{n.doAutoClose.cancel()},mouseleave:e=>{n.doAutoClose()}})),n.autoCloseClickDetacher=l.on({element:document.body,thisObj:r,mousedown:e=>{if(e.target!==a&&!a.contains(e.target)&&null!=n.autoCloseDelay){var t;const l=r.containsFocus&&(null===(t=r.focusInEvent)||void 0===t?void 0:t.relatedTarget)||s.getActiveElement(a);null!=l&&l.contains(e.target)||n.doAutoClose.now()}}}))}expandBegin(e){const t=this,{animation:l}=e,{collapseDir:o,collapseTool:n,innerElement:r,panel:s}=t,{element:i}=s;i.classList.remove("b-collapsed","b-collapsing"),t.restoreConfiguredSize(),t.lockInnerSize(!1),t.lockInnerSize(),null==n||n.element.classList.remove("b-collapsed"),l&&(i.classList.add("b-collapsed","b-expanding"),l.element=r,l.transform={from:L[o].to,to:L[o].from},e.animation=a.run(l))}expandEnd(e){super.expandEnd(e);const{panel:t}=this;e.completed&&(t.revealed=!1),t.element.classList.remove("b-expanding")}expandRevert(e){super.expandRevert(e),this.panel.element.classList.add("b-expanding")}get innerElement(){return this.panel.overlayElement}get innerSizeElement(){return this.panel.element}get toolsConfig(){const{direction:e}=this,t=super.toolsConfig,l=this.recollapseTool;return l?i(i({},t),{},{recollapse:l&&v.assign({direction:e.toLowerCase()},l)}):t}lockInnerSize(e=!0){const t=this,{panel:l}=t,o=e&&l.rectangle(),n=e?[0,0,0,0]:"",r=super.lockInnerSize(e);return e&&(n[D[t.collapseDir]]=`-${o[t.collapseDim]+10}px`),l.element.style.clipPath=e?`inset(${n.join(" ")})`:"",r}onOverlayTransitionDone(e){const t=this,{panel:l}=t;e.srcElement===l.overlayElement&&t.revealing&&(t.revealing=!1,t.onComplete(l.revealed?"reveal":"unreveal"))}onRevealerClick(){this.toggleReveal()}splitHeaderItems({as:e,dock:t}=T){var l;return null===(l=this.panel)||void 0===l?void 0:l.splitHeaderItems({as:e,dock:t,overlay:!0})}toggleReveal(e){const{panel:t}=this,{element:l}=t;t.collapsed&&(null==e&&(e=!t.revealed),t.revealed!==e&&!1!==t.trigger("beforeToggleReveal",{reveal:e})&&(!e&&l.contains(s.getActiveElement(l))&&t.revertFocus(!0),this.revealing=!0,t.revealed=e))}updateRevealing(e){const t=this,{panel:l}=t,o=/left|right/i.test(t.collapseDir)?"height":"width";l&&(t.innerElement.style[o]="0px",t.innerElement.style[`min-${o}`]="100%",l.element.classList[e?"add":"remove"]("b-panel-overlay-revealing"))}wrapCollapser(e,l){var o;const n=this,{collapseDir:r,panel:a}=n,{expandedHeaderDock:s,header:v,uiClassList:c}=a,d=null===(o=a.tools)||void 0===o?void 0:o.recollapse,[h,u]=n.splitHeaderItems({dock:n.collapseDock,as:"element"}),g=H[s],p=a.hasHeader?a.title||(null==v?void 0:v.title)||"Â ":null;return d&&(d.direction=r),["overlayElement",{class:i(i({},c),{},{[`b-panel-overlay-header-${s}`]:1,[`b-panel-overlay-${r}`]:1,[`b-${g?"h":"v"}box`]:1,"b-panel-overlay":1,"b-box-center":1}),listeners:{transitionend:e=>n.onOverlayTransitionDone(e)},children:{overlayHeaderElement:p&&{tag:"header",class:new t(i(i({},c),{},{[`b-dock-${s}`]:1,"b-panel-header":1,"b-panel-overlay-header":1}),null==v?void 0:v.cls),children:[...h,{reference:"overlayTitleElement",html:p,class:i(i({},c),{},{[`b-align-${(null==v?void 0:v.titleAlign)||"start"}`]:1,"b-header-title":1})},...u]},[e]:l}}]}}k.initClass(),k._$name="PanelCollapserOverlay";var R=e=>{var t;return c(t=class extends(e||d){compose(){const{minified:e}=this;return{class:{"b-minified":e}}}get widgetClass(){}},"$name","Minifiable"),c(t,"configurable",{minifiable:!0,minified:null}),t};export{E as DragTipProxy,y as Hoverable,R as Minifiable,k as PanelCollapserOverlay};
//# sourceMappingURL=Minifiable.js.map
