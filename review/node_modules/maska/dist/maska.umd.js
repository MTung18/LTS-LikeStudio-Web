/*! maska v2.1.6 | (c) Alexander Shabunevich | Released under the MIT license */
(function(c,h){typeof exports=="object"&&typeof module<"u"?h(exports):typeof define=="function"&&define.amd?define(["exports"],h):(c=typeof globalThis<"u"?globalThis:c||self,h(c.Maska={}))})(this,function(c){"use strict";var I=Object.defineProperty;var x=(c,h,u)=>h in c?I(c,h,{enumerable:!0,configurable:!0,writable:!0,value:u}):c[h]=u;var g=(c,h,u)=>(x(c,typeof h!="symbol"?h+"":h,u),u);const h={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}};class u{constructor(t={}){g(this,"opts",{});g(this,"memo",new Map);var e;const s={...t};if(s.tokens!=null){s.tokens=s.tokensReplace?{...s.tokens}:{...h,...s.tokens};for(const a of Object.values(s.tokens))typeof a.pattern=="string"&&(a.pattern=new RegExp(a.pattern))}else s.tokens=h;Array.isArray(s.mask)&&(s.mask.length>1?s.mask.sort((a,i)=>a.length-i.length):s.mask=(e=s.mask[0])!=null?e:""),s.mask===""&&(s.mask=null),this.opts=s}masked(t){return this.process(t,this.findMask(t))}unmasked(t){return this.process(t,this.findMask(t),!1)}isEager(){return this.opts.eager===!0}isReversed(){return this.opts.reversed===!0}completed(t){const s=this.findMask(t);if(this.opts.mask==null||s==null)return!1;const e=this.process(t,s).length;return typeof this.opts.mask=="string"?e>=this.opts.mask.length:typeof this.opts.mask=="function"?e>=s.length:this.opts.mask.filter(a=>e>=a.length).length===this.opts.mask.length}findMask(t){var a,i;const s=this.opts.mask;if(s==null)return null;if(typeof s=="string")return s;if(typeof s=="function")return s(t);const e=this.process(t,(a=s.slice(-1).pop())!=null?a:"",!1);return(i=s.find(p=>this.process(t,p,!1).length>=e.length))!=null?i:""}escapeMask(t){const s=[],e=[];return t.split("").forEach((a,i)=>{a==="!"&&t[i-1]!=="!"?e.push(i-e.length):s.push(a)}),{mask:s.join(""),escaped:e}}process(t,s,e=!0){var C;if(s==null)return t;const a=`value=${t},mask=${s},masked=${e?1:0}`;if(this.memo.has(a))return this.memo.get(a);const{mask:i,escaped:p}=this.escapeMask(s),r=[],d=this.opts.tokens!=null?this.opts.tokens:{},l=this.isReversed()?-1:1,E=this.isReversed()?"unshift":"push",y=this.isReversed()?0:i.length-1,L=this.isReversed()?()=>o>-1&&k>-1:()=>o<i.length&&k<t.length,J=m=>!this.isReversed()&&m<=y||this.isReversed()&&m>=y;let R,M=-1,o=this.isReversed()?i.length-1:0,k=this.isReversed()?t.length-1:0;for(;L();){const m=i.charAt(o),f=d[m],v=(f==null?void 0:f.transform)!=null?f.transform(t.charAt(k)):t.charAt(k);if(!p.includes(o)&&f!=null){if(v.match(f.pattern)!=null)r[E](v),f.repeated?(M===-1?M=o:o===y&&o!==M&&(o=M-l),y===M&&(o-=l)):f.multiple&&(o-=l),o+=l;else if(f.multiple){const N=((C=r[k-l])==null?void 0:C.match(f.pattern))!=null,P=i.charAt(o+l);N&&P!==""&&d[P]==null?(o+=l,k-=l):r[E]("")}else v===R?R=void 0:f.optional&&(o+=l,k-=l);k+=l}else e&&!this.isEager()&&r[E](m),v===m&&!this.isEager()?k+=l:R=m,this.isEager()||(o+=l);if(this.isEager())for(;J(o)&&(d[i.charAt(o)]==null||p.includes(o));)e?r[E](i.charAt(o)):i.charAt(o)===t.charAt(k)&&(k+=l),o+=l}return this.memo.set(a,r.join("")),this.memo.get(a)}}const T=n=>JSON.parse(n.replaceAll("'",'"')),w=(n,t={})=>{const s={...t};return n.dataset.maska!=null&&n.dataset.maska!==""&&(s.mask=V(n.dataset.maska)),n.dataset.maskaEager!=null&&(s.eager=A(n.dataset.maskaEager)),n.dataset.maskaReversed!=null&&(s.reversed=A(n.dataset.maskaReversed)),n.dataset.maskaTokensReplace!=null&&(s.tokensReplace=A(n.dataset.maskaTokensReplace)),n.dataset.maskaTokens!=null&&(s.tokens=W(n.dataset.maskaTokens)),s},A=n=>n!==""?Boolean(JSON.parse(n)):!0,V=n=>n.startsWith("[")&&n.endsWith("]")?T(n):n,W=n=>{if(n.startsWith("{")&&n.endsWith("}"))return T(n);const t={};return n.split("|").forEach(s=>{const e=s.split(":");t[e[0]]={pattern:new RegExp(e[1]),optional:e[2]==="optional",multiple:e[2]==="multiple",repeated:e[2]==="repeated"}}),t};class O{constructor(t,s={}){g(this,"items",new Map);g(this,"beforeinputEvent",t=>{const s=t.target,e=this.items.get(s);e.isEager()&&"inputType"in t&&t.inputType.startsWith("delete")&&e.unmasked(s.value).length<=1&&this.setMaskedValue(s,"")});g(this,"inputEvent",t=>{if(t instanceof CustomEvent&&t.type==="input"&&t.detail!=null&&typeof t.detail=="object"&&"masked"in t.detail)return;const s=t.target,e=this.items.get(s),a=s.value,i=s.selectionStart,p=s.selectionEnd;let r=a;if(e.isEager()){const d=e.masked(a),l=e.unmasked(a);l===""&&"data"in t&&t.data!=null?r=t.data:l!==e.unmasked(d)&&(r=l)}if(this.setMaskedValue(s,r),"inputType"in t&&(t.inputType.startsWith("delete")||i!=null&&i<a.length))try{s.setSelectionRange(i,p)}catch{}});this.options=s,typeof t=="string"?this.init(Array.from(document.querySelectorAll(t)),this.getMaskOpts(s)):this.init("length"in t?Array.from(t):[t],this.getMaskOpts(s))}destroy(){for(const t of this.items.keys())t.removeEventListener("input",this.inputEvent),t.removeEventListener("beforeinput",this.beforeinputEvent);this.items.clear()}needUpdate(t,s){const e=this.items.get(t),a=new u(w(t,this.getMaskOpts(s)));return JSON.stringify(e.opts)!==JSON.stringify(a.opts)}getMaskOpts(t){const{onMaska:s,preProcess:e,postProcess:a,...i}=t;return i}init(t,s){for(const e of t){const a=new u(w(e,s));this.items.set(e,a),e.value!==""&&this.setMaskedValue(e,e.value),e.addEventListener("input",this.inputEvent),e.addEventListener("beforeinput",this.beforeinputEvent)}}setMaskedValue(t,s){const e=this.items.get(t);this.options.preProcess!=null&&(s=this.options.preProcess(s));const a=e.masked(s),i=e.unmasked(e.isEager()?a:s),p=e.completed(s),r={masked:a,unmasked:i,completed:p};s=a,this.options.postProcess!=null&&(s=this.options.postProcess(s)),t.value=s,t.dataset.maskaValue=s,this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(d=>d(r)):this.options.onMaska(r)),t.dispatchEvent(new CustomEvent("maska",{detail:r})),t.dispatchEvent(new CustomEvent("input",{detail:r}))}}const S=new WeakMap,b=n=>{const t=n.dataset.maskaValue;(t==null&&n.value!==""||t!=null&&t!==n.value)&&n.dispatchEvent(new CustomEvent("input"))},j=(n,t)=>{const s=n instanceof HTMLInputElement?n:n.querySelector("input"),e={...t.arg};if(s==null)return;const a=S.get(s);if(a!=null){if(b(s),!a.needUpdate(s,e))return;a.destroy()}if(t.value!=null){const i=t.value,p=r=>{i.masked=r.masked,i.unmasked=r.unmasked,i.completed=r.completed};e.onMaska=e.onMaska==null?p:Array.isArray(e.onMaska)?[...e.onMaska,p]:[e.onMaska,p]}S.set(s,new O(s,e)),setTimeout(()=>{b(s)})};c.Mask=u,c.MaskInput=O,c.tokens=h,c.vMaska=j,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
